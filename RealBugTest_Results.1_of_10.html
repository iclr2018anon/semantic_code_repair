<html><head><style>
.ast { font-family: monospace; font-size: 12pt; }
.correct_node { font-weight: bold; background-color: green; color: white; }
.incorrect_node { font-weight: bold; background-color: red; color: white; }
.ref_node { font-weight: bold; background-color: blue; color: white; }
.location_node { font-weight: bold; background-color: #ff00ff; color: white; }
.other_trans { color: #3333ff; }
.whitespace { background-color: white; color: black; }
.pred_rank_wrapper { font-weight: bold; }
.correct_pred_rank { font-weight: bold; color: green;}
.incorrect_pred_rank { font-weight: bold; color: red; }
.rank_type { font-weight: bold; }
.description { font-size: 16pt; }
</style></head><body><div class="description">
<div><b>This is part 2/10 of the system predictions for the Real-Bug Test set. This system achieves 41% Repair Accuracy and 54% Location Accuracy.</b></div><br /><div><b>Annotations</b>:</div><ul><li><span class="correct_node">foo &rarr; bar</span> - The bug was located at this node, and the system <i>correctly</i> predicted both the location and the repair as its top prediction.</li><li><span class="incorrect_node">foo &rarr; bar</span> - The system <i>incorrectly</i> predicted this repair as its top prediction.</li><li><span class="ref_node">foo &rarr; bar</span> - If the system incorrectly predicted the repair, this was the correct repair it should have made.</li><li><span class="location_node">foo &rarr; bar, pred: zap</span> - The system predicted the correct <i>location</i> of the repair, but the wrong repair label. It should have predicted 'bar', but it predicted 'zap' instead.</li></ul><div>The part before the arrow ('foo') is what the system actually saw at test time. Other candidate repair locations which the system could have chosen are marked in <span class="other_trans">this color</span>. For clarity the actual labels for those locations are not shown.</div></div><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;documents_per_topic(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>topic_associations</span>&nbsp;=&nbsp;<span id="ast-6">{}</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-8" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">range</span>(<span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.corpus</span>.size</span>)</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>topic_id</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.most_likely_topic_for_document</span>(<span id="ast-19" class="other_trans">i</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans">topic_associations</span>.get</span>(<span id="ast-24" class="other_trans">topic_id</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>documents</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">topic_associations</span>[<span id="ast-29"><span id="ast-30" class="other_trans">topic_id</span></span>]</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>documents</span>.append</span>(<span id="ast-35" class="incorrect_node">i&nbsp;&rarr;&nbsp;topic_id&nbsp;</span>)</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>topic_associations</span>[<span id="ast-39"><span id="ast-40" class="other_trans">topic_id</span></span>]</span>&nbsp;=&nbsp;<span id="ast-41" class="other_trans">documents</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>documents</span>&nbsp;=&nbsp;<span id="ast-44">[<span id="ast-45" class="ref_node">topic_id&nbsp;&rarr;&nbsp;i&nbsp;</span>]</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>topic_associations</span>[<span id="ast-49"><span id="ast-50" class="other_trans">topic_id</span></span>]</span>&nbsp;=&nbsp;<span id="ast-51" class="other_trans">documents</span></span></span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-53" class="other_trans">topic_associations</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">key</span>,&nbsp;<span id="ast-5" class="other_trans">ocrasuite_description</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.key</span>&nbsp;=&nbsp;<span id="ast-9" class="other_trans">key</span></span><span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ocrasuite</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">str2ocrasuite</span>(<span id="ast-15" class="other_trans">ocrasuite_description</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="correct_node">ocrasuite&nbsp;&rarr;&nbsp;self.&nbsp;</span>.data_input</span>.Q</span>)</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-23" class="other_trans">ValueError</span>,&nbsp;<span id="ast-24">(<span id="ast-25">'Ocrasuite&nbsp;must&nbsp;have&nbsp;a&nbsp;Q&nbsp;descriptor'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">config</span>,&nbsp;<span id="ast-7" class="other_trans">location</span>,&nbsp;**kwargs</span>):<span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">get_logger</span>(<span id="ast-14">self</span>)</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.mount_config</span>&nbsp;=&nbsp;<span id="ast-18" class="other_trans">config</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.debug</span>(<span id="ast-24"><span id="ast-25"><span id="ast-26">'Mount&nbsp;config:&nbsp;{}'</span>.format</span>(<span id="ast-27" class="other_trans">config</span>)</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.config</span>&nbsp;=&nbsp;<span id="ast-31" class="other_trans">config</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.commands</span>&nbsp;=&nbsp;<span id="ast-35" class="other_trans">None</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37">(<span id="ast-38"><span id="ast-39" class="other_trans">len</span>(<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">kwargs</span>.get</span>(<span id="ast-43">'commands'</span>,&nbsp;<span id="ast-44">[]</span>)</span>)</span><span id="ast-45" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-46">0</span>)</span>:<span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.commands</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52">self</span>._setup_commands</span>(<span id="ast-53"><span id="ast-54" class="incorrect_node">kwargs&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-55"><span id="ast-56">'commands'</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;confirm_registration_view(<span id="ast-2"><span id="ast-3" class="other_trans">context</span>,&nbsp;<span id="ast-4" class="other_trans">request</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>form</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">Form</span>(<span id="ast-9"><span id="ast-10">Confirm</span>()</span>,&nbsp;buttons=<span id="ast-12">(<span id="ast-13">'confirm'</span>)</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pending</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">request</span>.registry</span>.queryAdapter</span>(<span id="ast-20" class="other_trans">context</span>,&nbsp;<span id="ast-21" class="other_trans">IRegistrations</span>,&nbsp;name=<span id="ast-23">'pending'</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-26" class="other_trans">pending</span><span id="ast-27" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-28" class="other_trans">None</span>)</span>:<span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pending</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">PendingRegistrations</span>(<span id="ast-33" class="other_trans">context</span>)</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36">'confirm'</span><span id="ast-37">&nbsp;in&nbsp;</span><span id="ast-38"><span id="ast-39">request</span>.POST</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>appstruct</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">form</span>.validate</span>(<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">request</span>.POST</span>.items</span>()</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-51">ValidationFailure</span>&nbsp;as&nbsp;<span id="ast-52">e</span>:<span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rendered_form</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">e</span>.render</span>()</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;repr(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">client</span>,&nbsp;<span id="ast-5" class="other_trans">changed_widgets</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'It&nbsp;is&nbsp;used&nbsp;to&nbsp;automatically&nbsp;represent&nbsp;the&nbsp;object&nbsp;to&nbsp;HTML&nbsp;format\\u000a&nbsp;&nbsp;&nbsp;&nbsp;packs&nbsp;all&nbsp;the&nbsp;attributes,&nbsp;children&nbsp;and&nbsp;so&nbsp;on.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;client&nbsp;(App):&nbsp;The&nbsp;client&nbsp;instance.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;changed_widgets&nbsp;(dict):&nbsp;A&nbsp;dictionary&nbsp;containing&nbsp;a&nbsp;collection&nbsp;of&nbsp;tags&nbsp;that&nbsp;have&nbsp;to&nbsp;be&nbsp;updated.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;tag&nbsp;that&nbsp;have&nbsp;to&nbsp;be&nbsp;updated&nbsp;is&nbsp;the&nbsp;key,&nbsp;and&nbsp;the&nbsp;value&nbsp;is&nbsp;its&nbsp;textual&nbsp;repr.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>local_changed_widgets</span>&nbsp;=&nbsp;<span id="ast-11">{}</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>innerHTML</span>&nbsp;=&nbsp;<span id="ast-14">''</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18">self</span>._render_children_list</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20"><span id="ast-21">isinstance</span>(<span id="ast-22" class="other_trans">s</span>,&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">type</span>(<span id="ast-25">''</span>)</span>)</span>:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>innerHTML</span>&nbsp;=&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">innerHTML</span>&nbsp;+&nbsp;<span id="ast-31" class="other_trans">s</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">isinstance</span>(<span id="ast-35" class="other_trans">s</span>,&nbsp;<span id="ast-36"><span id="ast-37">type</span>(<span id="ast-38">u''</span>)</span>)</span>:<span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>innerHTML</span>&nbsp;=&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">innerHTML</span>&nbsp;+&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans">s</span>.encode</span>(<span id="ast-47">'utf-8'</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>innerHTML</span>&nbsp;=&nbsp;<span id="ast-50">(<span id="ast-51" class="other_trans">innerHTML</span>&nbsp;+&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">s</span>.repr</span>(<span id="ast-56" class="incorrect_node">client&nbsp;&rarr;&nbsp;s&nbsp;</span>,&nbsp;<span id="ast-57" class="other_trans">local_changed_widgets</span>)</span>)</span></span></span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59">(<span id="ast-61"><span id="ast-62"><span id="ast-63">self</span>._ischanged</span>()</span>&nbsp;or&nbsp;<span id="ast-64">(<span id="ast-65"><span id="ast-66">len</span>(<span id="ast-67" class="ref_node">changed_widgets&nbsp;&rarr;&nbsp;local_changed_widgets&nbsp;</span>)</span><span id="ast-68" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-69">0</span>)</span>)</span>:<span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.attributes</span>[<span id="ast-74"><span id="ast-75">'style'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-76"><span id="ast-77" class="other_trans">jsonize</span>(<span id="ast-78"><span id="ast-79">self</span>.style</span>)</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._backup_repr</span>&nbsp;=&nbsp;<span id="ast-83">(<span id="ast-84">'&lt;%s&nbsp;%s&gt;%s&lt;/%s&gt;'</span>&nbsp;%&nbsp;<span id="ast-86">(<span id="ast-87"><span id="ast-88">self</span>.type</span>,&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91">'&nbsp;'</span>.join</span>(<span id="ast-92">(<span id="ast-93"><span id="ast-98">(<span id="ast-99">'%s="%s"'</span>&nbsp;%&nbsp;<span id="ast-101">(<span id="ast-102" class="other_trans">k</span>,&nbsp;<span id="ast-103" class="other_trans">v</span>)</span>)</span>&nbsp;if&nbsp;<span id="ast-94">(<span id="ast-95" class="other_trans">v</span><span id="ast-96" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-97" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-104" class="other_trans">k</span></span><span id="ast-105">&nbsp;for&nbsp;<span id="ast-106">(<span id="ast-107" class="other_trans">k</span>,&nbsp;<span id="ast-108" class="other_trans">v</span>)</span>&nbsp;in&nbsp;<span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112">self</span>.attributes</span>.items</span>()</span></span>)</span>)</span>,&nbsp;<span id="ast-113" class="other_trans">innerHTML</span>,&nbsp;<span id="ast-114"><span id="ast-115">self</span>.type</span>)</span>)</span></span></span><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-117"><span id="ast-118"><span id="ast-119">self</span>._ischanged</span>()</span>:<span id="ast-120"><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>changed_widgets</span>[<span id="ast-123"><span id="ast-124">self</span></span>]</span>&nbsp;=&nbsp;<span id="ast-125"><span id="ast-126">self</span>._backup_repr</span></span><span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._set_updated</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>changed_widgets</span>.update</span>(<span id="ast-135">local_changed_widgets</span>)</span></span></span><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-137"><span id="ast-138">self</span>._backup_repr</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;import_pip(<span id="ast-2"><span id="ast-3" class="other_trans">name</span>,&nbsp;<span id="ast-4" class="other_trans">package</span>,&nbsp;<span id="ast-6" class="other_trans">default</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>package</span>&nbsp;=&nbsp;<span id="ast-10">(<span id="ast-12" class="other_trans">package</span>&nbsp;or&nbsp;<span id="ast-13" class="other_trans">name</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>module</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">__import__</span>(<span id="ast-19" class="incorrect_node">name&nbsp;&rarr;&nbsp;package&nbsp;</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-23">pip</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26" class="other_trans">default</span></span></span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pip</span>.main</span>(<span id="ast-32">[<span id="ast-33">'install'</span>,&nbsp;<span id="ast-34" class="other_trans">name</span>]</span>)</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-37" class="other_trans">default</span></span></span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>module</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">__import__</span>(<span id="ast-43" class="ref_node">name&nbsp;&rarr;&nbsp;package&nbsp;</span>)</span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46" class="other_trans">default</span></span></span></span></span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-48" class="other_trans">module</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>message_buffer</span>&nbsp;=&nbsp;<span id="ast-6">''</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-8">True</span>:<span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message_buffer</span>&nbsp;+=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.read</span>()</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-16">True</span>:<span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-19" class="other_trans">message</span>,&nbsp;<span id="ast-20" class="other_trans">message_buffer</span>,&nbsp;<span id="ast-21" class="other_trans">byte_count</span>)</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24">self</span>._parse_message</span>(<span id="ast-25" class="other_trans">message_buffer</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">message</span><span id="ast-29" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-30" class="other_trans">None</span>)</span>:<span id="ast-31"><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.bytes_received</span>&nbsp;+=&nbsp;<span id="ast-35" class="other_trans">byte_count</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37">(<span id="ast-38" class="correct_node">callback&nbsp;&rarr;&nbsp;self.&nbsp;</span><span id="ast-39" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-40" class="other_trans">None</span>)</span>:<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.callback</span>(<span id="ast-45" class="other_trans">message</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;conquerable_stations(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>api_result</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="correct_node">api&nbsp;&rarr;&nbsp;self.&nbsp;</span>.get</span>(<span id="ast-9">'eve/ConquerableStationlist'</span>)</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>results</span>&nbsp;=&nbsp;<span id="ast-12">{}</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rowset</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">api_result</span>.find</span>(<span id="ast-18">'rowset'</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-20" class="other_trans">row</span>&nbsp;in&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans">rowset</span>.findall</span>(<span id="ast-24">'row'</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>station</span>&nbsp;=&nbsp;<span id="ast-27">{<span id="ast-28">'id'</span>:&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">int</span>(<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">row</span>.attrib</span>[<span id="ast-38"><span id="ast-39">'stationID'</span></span>]</span>)</span>,&nbsp;<span id="ast-29">'name'</span>:&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">row</span>.attrib</span>[<span id="ast-43"><span id="ast-44">'stationName'</span></span>]</span>,&nbsp;<span id="ast-30">'type_id'</span>:&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">int</span>(<span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">row</span>.attrib</span>[<span id="ast-50"><span id="ast-51">'stationTypeID'</span></span>]</span>)</span>,&nbsp;<span id="ast-31">'system_id'</span>:&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">int</span>(<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">row</span>.attrib</span>[<span id="ast-57"><span id="ast-58">'solarSystemID'</span></span>]</span>)</span>,&nbsp;<span id="ast-32">'corp'</span>:&nbsp;<span id="ast-59">{<span id="ast-60">'id'</span>:&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">int</span>(<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">row</span>.attrib</span>[<span id="ast-67"><span id="ast-68">'corporationID'</span></span>]</span>)</span>,&nbsp;<span id="ast-61">'name'</span>:&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">row</span>.attrib</span>[<span id="ast-72"><span id="ast-73">'corporationName'</span></span>]</span>}</span>}</span></span><span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>results</span>[<span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans">station</span>[<span id="ast-80"><span id="ast-81">'id'</span></span>]</span></span>]</span>&nbsp;=&nbsp;<span id="ast-82" class="other_trans">station</span></span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-84" class="other_trans">results</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;write_bytecode(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">f</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Dump&nbsp;the&nbsp;bytecode&nbsp;into&nbsp;the&nbsp;file&nbsp;or&nbsp;file&nbsp;like&nbsp;object&nbsp;passed.'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10">self</span>.code</span><span id="ast-11" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-12" class="other_trans">None</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">TypeError</span>(<span id="ast-16">"can't&nbsp;write&nbsp;empty&nbsp;bucket"</span>)</span></span></span><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-21" class="other_trans">bc_magic</span>)</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pickle</span>.dump</span>(<span id="ast-26"><span id="ast-27">self</span>.checksum</span>,&nbsp;<span id="ast-28" class="other_trans">f</span>,&nbsp;<span id="ast-29">2</span>)</span></span><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>marshal_dump</span>(<span id="ast-33" class="correct_node">code&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-34" class="other_trans">f</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>po_files</span>&nbsp;=&nbsp;<span id="ast-6">[]</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mo_files</span>&nbsp;=&nbsp;<span id="ast-9">[]</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12">not</span>&nbsp;<span id="ast-13"><span id="ast-14">self</span>.input_file</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16"><span id="ast-17">self</span>.locale</span>:<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>po_files</span>.append</span>(<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-26"><span id="ast-27">self</span>.directory</span>,&nbsp;<span id="ast-28"><span id="ast-29">self</span>.locale</span>,&nbsp;<span id="ast-30">'LC_MESSAGES'</span>,&nbsp;<span id="ast-31">(<span id="ast-32"><span id="ast-33">self</span>.domain</span>&nbsp;+&nbsp;<span id="ast-35">'.po'</span>)</span>)</span>)</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mo_files</span>.append</span>(<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-44"><span id="ast-45">self</span>.directory</span>,&nbsp;<span id="ast-46"><span id="ast-47">self</span>.locale</span>,&nbsp;<span id="ast-48">'LC_MESSAGES'</span>,&nbsp;<span id="ast-49">(<span id="ast-50"><span id="ast-51">self</span>.domain</span>&nbsp;+&nbsp;<span id="ast-53">'.mo'</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-55" class="other_trans">locale</span>&nbsp;in&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">os</span>.listdir</span>(<span id="ast-59"><span id="ast-60">self</span>.directory</span>)</span>:<span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>po_file</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-67"><span id="ast-68">self</span>.directory</span>,&nbsp;<span id="ast-69" class="other_trans">locale</span>,&nbsp;<span id="ast-70">'LC_MESSAGES'</span>,&nbsp;<span id="ast-71">(<span id="ast-72"><span id="ast-73">self</span>.domain</span>&nbsp;+&nbsp;<span id="ast-75">'.po'</span>)</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-81" class="other_trans">po_file</span>)</span>:<span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>po_files</span>.append</span>(<span id="ast-86" class="other_trans">po_file</span>)</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mo_files</span>.append</span>(<span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94">os</span>.path</span>.join</span>(<span id="ast-95"><span id="ast-96">self</span>.directory</span>,&nbsp;<span id="ast-97" class="other_trans">locale</span>,&nbsp;<span id="ast-98">'LC_MESSAGES'</span>,&nbsp;<span id="ast-99">(<span id="ast-100"><span id="ast-101">self</span>.domain</span>&nbsp;+&nbsp;<span id="ast-103">'.mo'</span>)</span>)</span>)</span></span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>po_files</span>.append</span>(<span id="ast-108"><span id="ast-109">self</span>.output_file</span>)</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-111"><span id="ast-112">self</span>.output_file</span>:<span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mo_files&nbsp;&rarr;&nbsp;po_files&nbsp;</span>.append</span>(<span id="ast-117"><span id="ast-118">self</span>.output_file</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mo_files</span>.append</span>(<span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-127"><span id="ast-128">self</span>.directory</span>,&nbsp;<span id="ast-129" class="ref_node">locale&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-130">'LC_MESSAGES'</span>,&nbsp;<span id="ast-131">(<span id="ast-132"><span id="ast-133">self</span>.domain</span>&nbsp;+&nbsp;<span id="ast-135">'.mo'</span>)</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__call__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">task</span>,&nbsp;<span id="ast-5" class="other_trans">return_val</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;FOr&nbsp;now,&nbsp;assume&nbsp;mutex&nbsp;is&nbsp;held&nbsp;by&nbsp;caller\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-12">(<span id="ast-13">'%s&nbsp;finished'</span>&nbsp;%&nbsp;<span id="ast-15"><span id="ast-16">repr</span>(<span id="ast-17" class="other_trans">task</span>)</span>)</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20" class="other_trans">return_val</span><span id="ast-21" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-22" class="other_trans">None</span>)</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>._state</span>&nbsp;=&nbsp;<span id="ast-26">T_ERROR</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">Exception</span>(<span id="ast-30">'Got&nbsp;None&nbsp;return&nbsp;value'</span>)</span></span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34">len</span>(<span id="ast-35"><span id="ast-36" class="other_trans">task</span>._outputs</span>)</span><span id="ast-37" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-38">1</span>)</span>:<span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>._state</span>&nbsp;=&nbsp;<span id="ast-42">T_DONE_SUCCESS</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>._outputs</span>[<span id="ast-49"><span id="ast-50">0</span></span>]</span>._set</span>(<span id="ast-51">return_val</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return_vals</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56">tuple</span>(<span id="ast-57">return_val</span>)</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-59" class="other_trans">TypeError</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>._state</span>&nbsp;=&nbsp;<span id="ast-63">T_ERROR</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-65"><span id="ast-66">Exception</span>(<span id="ast-67">(<span id="ast-68">'Expected&nbsp;tuple&nbsp;or&nbsp;list&nbsp;of&nbsp;length&nbsp;%d&nbsp;as&nbsp;output,&nbsp;but&nbsp;got&nbsp;something&nbsp;not&nbsp;iterable'</span>&nbsp;%&nbsp;<span id="ast-70"><span id="ast-71" class="other_trans">len</span>(<span id="ast-72"><span id="ast-73" class="other_trans">task</span>._outputs</span>)</span>)</span>)</span></span></span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-75">(<span id="ast-76"><span id="ast-77">len</span>(<span id="ast-78" class="other_trans">return_vals</span>)</span><span id="ast-79" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-80"><span id="ast-81" class="other_trans">len</span>(<span id="ast-82"><span id="ast-83" class="other_trans">task</span>._outputs</span>)</span>)</span>:<span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>._state</span>&nbsp;=&nbsp;<span id="ast-87" class="other_trans">T_ERROR</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-89"><span id="ast-90">Exception</span>(<span id="ast-91">(<span id="ast-92">'Expected&nbsp;tuple&nbsp;or&nbsp;list&nbsp;of&nbsp;length&nbsp;%d&nbsp;as&nbsp;output,&nbsp;but&nbsp;got&nbsp;something&nbsp;of&nbsp;length'</span>&nbsp;%&nbsp;<span id="ast-94">(<span id="ast-95"><span id="ast-96">len</span>(<span id="ast-97"><span id="ast-98" class="other_trans">task</span>._outputs</span>)</span>,&nbsp;<span id="ast-99"><span id="ast-100" class="other_trans">len</span>(<span id="ast-101" class="other_trans">return_vals</span>)</span>)</span>)</span>)</span></span></span><span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>._state</span>&nbsp;=&nbsp;<span id="ast-105">T_DONE_SUCCESS</span></span><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-107">(<span id="ast-108" class="other_trans">val</span>,&nbsp;<span id="ast-109" class="other_trans">chan</span>)</span>&nbsp;in&nbsp;<span id="ast-110"><span id="ast-111">zip</span>(<span id="ast-112" class="other_trans">return_vals</span>,&nbsp;<span id="ast-113"><span id="ast-114" class="other_trans">task</span>._outputs</span>)</span>:<span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>chan</span>._set</span>(<span id="ast-119" class="other_trans">val</span>)</span></span></span></span><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-121">(<span id="ast-122"><span id="ast-123">self</span>.contstack</span><span id="ast-124" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-125">None</span>)</span>:<span id="ast-126"><span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resume_continuation</span>(<span id="ast-129"><span id="ast-130">self</span>.contstack</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_cache(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">func</span>,&nbsp;<span id="ast-5" class="other_trans">memory_level</span>,&nbsp;**kwargs</span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Return&nbsp;a&nbsp;joblib.Memory&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;memory_level&nbsp;determines&nbsp;the&nbsp;level&nbsp;above&nbsp;which&nbsp;the&nbsp;wrapped\\u000a&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;output&nbsp;is&nbsp;cached.&nbsp;By&nbsp;specifying&nbsp;a&nbsp;numeric&nbsp;value&nbsp;for\\u000a&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;level,&nbsp;the&nbsp;user&nbsp;can&nbsp;to&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;cache&nbsp;memory\\u000a&nbsp;&nbsp;&nbsp;&nbsp;used.&nbsp;This&nbsp;function&nbsp;will&nbsp;cache&nbsp;the&nbsp;function&nbsp;call&nbsp;or&nbsp;not\\u000a&nbsp;&nbsp;&nbsp;&nbsp;depending&nbsp;on&nbsp;the&nbsp;cache&nbsp;level.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;func:&nbsp;function\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;function&nbsp;the&nbsp;output&nbsp;of&nbsp;which&nbsp;is&nbsp;to&nbsp;be&nbsp;cached.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;memory_level:&nbsp;int\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;memory_level&nbsp;from&nbsp;which&nbsp;caching&nbsp;must&nbsp;be&nbsp;enabled&nbsp;for&nbsp;the&nbsp;wrapped\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;mem:&nbsp;joblib.Memory\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;that&nbsp;wraps&nbsp;the&nbsp;function&nbsp;func.&nbsp;This&nbsp;object&nbsp;may&nbsp;be\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;no-op,&nbsp;if&nbsp;the&nbsp;requested&nbsp;level&nbsp;is&nbsp;lower&nbsp;than&nbsp;the&nbsp;value&nbsp;given\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;_cache()).&nbsp;For&nbsp;consistency,&nbsp;a&nbsp;joblib.Memory&nbsp;object&nbsp;is&nbsp;always\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;returned.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11">not</span>&nbsp;<span id="ast-12"><span id="ast-13">hasattr</span>(<span id="ast-14">self</span>,&nbsp;<span id="ast-15">'memory_level'</span>)</span>)</span>:<span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.memory_level</span>&nbsp;=&nbsp;<span id="ast-19">0</span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22">not</span>&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">hasattr</span>(<span id="ast-25">self</span>,&nbsp;<span id="ast-26">'memory'</span>)</span>)</span>:<span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.memory</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31">Memory</span>(cachedir=<span id="ast-33" class="other_trans">None</span>)</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37">self</span>.memory_level</span><span id="ast-38" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39">0</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-43"><span id="ast-44">isinstance</span>(<span id="ast-45"><span id="ast-46">self</span>.memory</span>,&nbsp;<span id="ast-47" class="other_trans">basestring</span>)</span>&nbsp;or&nbsp;<span id="ast-48">(<span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>.memory</span>.cachedir</span><span id="ast-52" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-53" class="other_trans">None</span>)</span>)</span>:<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>.warn</span>(<span id="ast-58">'memory_level&nbsp;is&nbsp;currently&nbsp;set&nbsp;to&nbsp;0&nbsp;but&nbsp;a&nbsp;Memory&nbsp;object&nbsp;has&nbsp;been&nbsp;provided.&nbsp;Setting&nbsp;memory_level&nbsp;to&nbsp;1.'</span>)</span></span><span id="ast-59"><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.memory_level</span>&nbsp;=&nbsp;<span id="ast-62">1</span></span></span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>verbose</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66">getattr</span>(<span id="ast-67">self</span>,&nbsp;<span id="ast-68">'verbose'</span>,&nbsp;<span id="ast-69">0</span>)</span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-71">(<span id="ast-72"><span id="ast-73">self</span>.memory_level</span><span id="ast-74" class="ref_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-75" class="other_trans">memory_level</span>)</span>:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mem</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79" class="other_trans">Memory</span>(cachedir=<span id="ast-81">None</span>,&nbsp;verbose=<span id="ast-83" class="other_trans">verbose</span>)</span></span><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans">mem</span>.cache</span>(<span id="ast-88" class="other_trans">func</span>,&nbsp;**<span id="ast-89" class="other_trans">kwargs</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>memory</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93">self</span>.memory</span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95"><span id="ast-96">isinstance</span>(<span id="ast-97" class="other_trans">memory</span>,&nbsp;<span id="ast-98" class="other_trans">basestring</span>)</span>:<span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>memory</span>&nbsp;=&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">Memory</span>(cachedir=<span id="ast-104" class="other_trans">memory</span>,&nbsp;verbose=<span id="ast-106" class="other_trans">verbose</span>)</span></span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-108">(<span id="ast-109">not</span>&nbsp;<span id="ast-110"><span id="ast-111" class="other_trans">isinstance</span>(<span id="ast-112" class="other_trans">memory</span>,&nbsp;<span id="ast-113" class="other_trans">memory_classes</span>)</span>)</span>:<span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-115"><span id="ast-116">TypeError</span>(<span id="ast-117">"'memory'&nbsp;argument&nbsp;must&nbsp;be&nbsp;a&nbsp;string&nbsp;or&nbsp;a&nbsp;joblib.Memory&nbsp;object."</span>)</span></span></span><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-119">(<span id="ast-120"><span id="ast-121" class="other_trans">memory</span>.cachedir</span><span id="ast-122" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-123">None</span>)</span>:<span id="ast-124"><span id="ast-125"><span id="ast-126"><span id="ast-127" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>.warn</span>(<span id="ast-128">(<span id="ast-129">'Caching&nbsp;has&nbsp;been&nbsp;enabled&nbsp;(memory_level&nbsp;=&nbsp;%d)&nbsp;but&nbsp;no&nbsp;Memory&nbsp;object&nbsp;or&nbsp;path&nbsp;has&nbsp;been&nbsp;provided&nbsp;(parameter&nbsp;memory).&nbsp;Caching&nbsp;deactivated&nbsp;for&nbsp;function&nbsp;%s.'</span>&nbsp;%&nbsp;<span id="ast-131">(<span id="ast-132"><span id="ast-133">self</span>.memory_level</span>,&nbsp;<span id="ast-134"><span id="ast-135" class="other_trans">func</span>.func_name</span>)</span>)</span>)</span></span></span><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-137"><span id="ast-138"><span id="ast-139" class="other_trans">memory</span>.cache</span>(<span id="ast-140" class="other_trans">func</span>,&nbsp;**<span id="ast-141">kwargs</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;view_markup(<span id="ast-2"><span id="ast-3">request</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cfg</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">request</span>.cfg</span></span><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-10" class="other_trans">path</span>,&nbsp;<span id="ast-11" class="other_trans">rev</span>)</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">_orig_path</span>(<span id="ast-14" class="other_trans">request</span>)</span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-17" class="other_trans">fp</span>,&nbsp;<span id="ast-18" class="other_trans">revision</span>)</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">request</span>.repos</span>.openfile</span>(<span id="ast-23">path</span>,&nbsp;<span id="ast-24" class="other_trans">rev</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26"><span id="ast-27">check_freshness</span>(<span id="ast-28" class="other_trans">request</span>,&nbsp;<span id="ast-29">None</span>,&nbsp;<span id="ast-30">revision</span>,&nbsp;weak=<span id="ast-32">1</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fp</span>.close</span>()</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41">nav_header_data</span>(<span id="ast-42" class="other_trans">request</span>,&nbsp;<span id="ast-43" class="other_trans">revision</span>,&nbsp;<span id="ast-44" class="other_trans">path</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>.update</span>(<span id="ast-49">{<span id="ast-50">'mime_type'</span>:&nbsp;<span id="ast-52"><span id="ast-53">request</span>.mime_type</span>,&nbsp;<span id="ast-51">'log'</span>:&nbsp;<span id="ast-54">None</span>}</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58" class="incorrect_node">cfg&nbsp;&rarr;&nbsp;request&nbsp;</span>.options</span>.show_log_in_markup</span>:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>options</span>&nbsp;=&nbsp;<span id="ast-61">{<span id="ast-62">'svn_latest_log'</span>:&nbsp;<span id="ast-63">1</span>}</span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>revs</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">request</span>.repos</span>.itemlog</span>(<span id="ast-70" class="other_trans">path</span>,&nbsp;<span id="ast-71" class="ref_node">rev&nbsp;&rarr;&nbsp;revision&nbsp;</span>,&nbsp;<span id="ast-72" class="other_trans">options</span>)</span></span><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76" class="other_trans">revs</span>[<span id="ast-77"><span id="ast-78">-1</span></span>]</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>.update</span>(<span id="ast-83">{<span id="ast-84">'date'</span>:&nbsp;<span id="ast-96"><span id="ast-97">make_time_string</span>(<span id="ast-98"><span id="ast-99" class="other_trans">entry</span>.date</span>,&nbsp;<span id="ast-100" class="other_trans">cfg</span>)</span>,&nbsp;<span id="ast-85">'ago'</span>:&nbsp;<span id="ast-101" class="other_trans">None</span>,&nbsp;<span id="ast-86">'author'</span>:&nbsp;<span id="ast-102"><span id="ast-103">entry</span>.author</span>,&nbsp;<span id="ast-87">'branches'</span>:&nbsp;<span id="ast-104">None</span>,&nbsp;<span id="ast-88">'tags'</span>:&nbsp;<span id="ast-105" class="other_trans">None</span>,&nbsp;<span id="ast-89">'branch_points'</span>:&nbsp;<span id="ast-106">None</span>,&nbsp;<span id="ast-90">'changed'</span>:&nbsp;<span id="ast-107"><span id="ast-108">entry</span>.changed</span>,&nbsp;<span id="ast-91">'log'</span>:&nbsp;<span id="ast-109"><span id="ast-110" class="other_trans">htmlify</span>(<span id="ast-111"><span id="ast-112" class="other_trans">entry</span>.log</span>)</span>,&nbsp;<span id="ast-92">'size'</span>:&nbsp;<span id="ast-113"><span id="ast-114" class="other_trans">entry</span>.size</span>,&nbsp;<span id="ast-93">'state'</span>:&nbsp;<span id="ast-115">None</span>,&nbsp;<span id="ast-94">'vendor_branch'</span>:&nbsp;<span id="ast-116" class="other_trans">None</span>,&nbsp;<span id="ast-95">'prev'</span>:&nbsp;<span id="ast-117" class="other_trans">None</span>}</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>model</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans">json</span>.loads</span>(<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14">urllib2</span>.urlopen</span>(<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">os</span>.environ</span>[<span id="ast-18"><span id="ast-19">'MODEL'</span></span>]</span>)</span>.readline</span>()</span>.strip</span>()</span>)</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>split</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-28"><span id="ast-29" class="other_trans">float</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32">os</span>.environ</span>[<span id="ast-33"><span id="ast-34">'SPLIT'</span></span>]</span>)</span>&nbsp;if&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26">os</span>.environ</span>.has_key</span>(<span id="ast-27">'SPLIT'</span>)</span>&nbsp;else&nbsp;<span id="ast-35">0.3</span></span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>W</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans">collections</span>.defaultdict</span>(<span id="ast-41" class="other_trans">float</span>)</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-43">(<span id="ast-44" class="other_trans">f</span>,&nbsp;<span id="ast-45" class="other_trans">w</span>)</span>&nbsp;in&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">model</span>[<span id="ast-50"><span id="ast-51">'parameters'</span></span>]</span>.items</span>()</span>:<span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>W</span>[<span id="ast-55"><span id="ast-56" class="other_trans">f</span></span>]</span>&nbsp;=&nbsp;<span id="ast-57" class="other_trans">w</span></span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-59" class="other_trans">line</span>&nbsp;in&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">sys</span>.stdin</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>x</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">json</span>.loads</span>(<span id="ast-67" class="other_trans">line</span>)</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans">x</span>.has_key</span>(<span id="ast-74">'class'</span>)</span>&nbsp;and&nbsp;<span id="ast-75">(<span id="ast-76"><span id="ast-77" class="other_trans">x</span>[<span id="ast-78"><span id="ast-79">'random_key'</span></span>]</span><span id="ast-80" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-81" class="other_trans">split</span>)</span>)</span>:<span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>prediction</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-112">1</span>&nbsp;if&nbsp;<span id="ast-85">(<span id="ast-86">0.0</span><span id="ast-87" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-88"><span id="ast-89" class="other_trans">sum</span>(<span id="ast-90">[<span id="ast-91">(<span id="ast-92"><span id="ast-93" class="other_trans">W</span>[<span id="ast-94"><span id="ast-95" class="other_trans">j</span></span>]</span>&nbsp;*&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans">x</span>[<span id="ast-100"><span id="ast-101">'features'</span></span>]</span>[<span id="ast-102"><span id="ast-103" class="other_trans">j</span></span>]</span>)</span><span id="ast-104">&nbsp;for&nbsp;<span id="ast-105" class="other_trans">j</span>&nbsp;in&nbsp;<span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans">x</span>[<span id="ast-110"><span id="ast-111">'features'</span></span>]</span>.keys</span>()</span></span>]</span>)</span>)</span>&nbsp;else&nbsp;<span id="ast-113">0</span></span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-115">(<span id="ast-116">'%d\\u0009%d'</span>&nbsp;%&nbsp;<span id="ast-118">(<span id="ast-119" class="other_trans">prediction</span>,&nbsp;<span id="ast-120"><span id="ast-121" class="other_trans">x</span>[<span id="ast-122"><span id="ast-123">'class'</span></span>]</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_template_from_request(<span id="ast-2"><span id="ast-3" class="other_trans">request</span>,&nbsp;<span id="ast-4" class="other_trans">page</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Gets&nbsp;a&nbsp;valid&nbsp;template&nbsp;from&nbsp;different&nbsp;sources&nbsp;or&nbsp;falls&nbsp;back&nbsp;to&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;default&nbsp;template.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>page_templates</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">settings</span>.get_page_templates</span>()</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15"><span id="ast-16" class="other_trans">len</span>(<span id="ast-17" class="other_trans">page_templates</span>)</span><span id="ast-18" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-19">0</span>)</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-21"><span id="ast-22">settings</span>.DEFAULT_PAGE_TEMPLATE</span></span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>template</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">request</span>.REQUEST</span>.get</span>(<span id="ast-29">'template'</span>,&nbsp;<span id="ast-30" class="other_trans">None</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-34">(<span id="ast-35" class="other_trans">template</span><span id="ast-36" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-37">None</span>)</span>&nbsp;and&nbsp;<span id="ast-38">(<span id="ast-40">(<span id="ast-41" class="other_trans">template</span><span id="ast-42">&nbsp;in&nbsp;</span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans">dict</span>(<span id="ast-47" class="other_trans">page_templates</span>)</span>.keys</span>()</span>)</span>&nbsp;or&nbsp;<span id="ast-48">(<span id="ast-49" class="other_trans">template</span><span id="ast-50" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-51"><span id="ast-52">settings</span>.DEFAULT_PAGE_TEMPLATE</span>)</span>)</span>)</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-54" class="other_trans">template</span></span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">(<span id="ast-57" class="other_trans">page</span><span id="ast-58" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-59" class="other_trans">None</span>)</span>:<span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">page</span>.get_template</span>()</span></span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">settings</span>.DEFAULT_PAGE_TEMPLATE</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;merge_record_fields(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">lResult</span>,&nbsp;<span id="ast-5" class="other_trans">rResult</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tGap</span>&nbsp;=&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12" class="other_trans">rResult</span>[<span id="ast-13"><span id="ast-14">'tStart'</span></span>]</span>&nbsp;-&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">lResult</span>[<span id="ast-18"><span id="ast-19">'tEnd'</span></span>]</span>)</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>qGap</span>&nbsp;=&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24" class="other_trans">rResult</span>[<span id="ast-25"><span id="ast-26">'qStart'</span></span>]</span>&nbsp;-&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">lResult</span>[<span id="ast-30"><span id="ast-31">'qEnd'</span></span>]</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lqEnd</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">lResult</span>[<span id="ast-36"><span id="ast-37">'qEnd'</span></span>]</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lResult</span>[<span id="ast-41"><span id="ast-42">'blockSizes'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-43">(<span id="ast-44"><span id="ast-45">str</span>(<span id="ast-46">(<span id="ast-47"><span id="ast-48" class="other_trans">int</span>(<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="ref_node">rResult&nbsp;&rarr;&nbsp;lResult&nbsp;</span>[<span id="ast-53"><span id="ast-54">'blockSizes'</span></span>]</span>.rstrip</span>(<span id="ast-55">','</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-57">1</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-59">','</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61">(<span id="ast-62" class="other_trans">qGap</span><span id="ast-63" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-64">0</span>)</span>:<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rResult</span>[<span id="ast-68"><span id="ast-69">'blockSizes'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-70">(<span id="ast-71"><span id="ast-72">str</span>(<span id="ast-73">(<span id="ast-74"><span id="ast-75">int</span>(<span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans">rResult</span>[<span id="ast-80"><span id="ast-81">'blockSizes'</span></span>]</span>.rstrip</span>(<span id="ast-82">','</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-84" class="other_trans">qGap</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-86">','</span>)</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rResult</span>[<span id="ast-90"><span id="ast-91">'matches'</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-93">(<span id="ast-94" class="other_trans">qGap</span>&nbsp;-&nbsp;<span id="ast-96">1</span>)</span></span></span><span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>keys</span>&nbsp;=&nbsp;<span id="ast-99">[<span id="ast-100">'matches'</span>,&nbsp;<span id="ast-101">'mismatches'</span>,&nbsp;<span id="ast-102">'repmatches'</span>,&nbsp;<span id="ast-103">'ncount'</span>,&nbsp;<span id="ast-104">'qNumInsert'</span>,&nbsp;<span id="ast-105">'qBaseInsert'</span>,&nbsp;<span id="ast-106">'tNumInsert'</span>,&nbsp;<span id="ast-107">'tBaseInsert'</span>]</span></span><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-109" class="other_trans">key</span>&nbsp;in&nbsp;<span id="ast-110" class="other_trans">keys</span>:<span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lResult</span>[<span id="ast-114"><span id="ast-115" class="other_trans">key</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-117"><span id="ast-118" class="other_trans">rResult</span>[<span id="ast-119"><span id="ast-120">key</span></span>]</span></span></span><span id="ast-121"><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lResult</span>[<span id="ast-124"><span id="ast-125">'qEnd'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-126"><span id="ast-127" class="other_trans">rResult</span>[<span id="ast-128"><span id="ast-129">'qEnd'</span></span>]</span></span><span id="ast-130"><span id="ast-131"><span id="ast-132" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lResult</span>[<span id="ast-133"><span id="ast-134">'tEnd'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-135"><span id="ast-136" class="other_trans">rResult</span>[<span id="ast-137"><span id="ast-138">'tEnd'</span></span>]</span></span><span id="ast-139"><span id="ast-140"><span id="ast-141" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lResult</span>[<span id="ast-142"><span id="ast-143">'blockCount'</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-145">1</span></span><span id="ast-146"><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lResult</span>[<span id="ast-149"><span id="ast-150">'blockSizes'</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-152"><span id="ast-153">rResult</span>[<span id="ast-154"><span id="ast-155">'blockSizes'</span></span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_convert_feed(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">feed</span>,&nbsp;<span id="ast-5" class="other_trans">since</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Take&nbsp;the&nbsp;user's&nbsp;atom&nbsp;feed.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>items</span>&nbsp;=&nbsp;<span id="ast-10">[]</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-12" class="other_trans">entry</span>&nbsp;in&nbsp;<span id="ast-13" class="other_trans">feed</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">entry</span>.has_key</span>(<span id="ast-20">'public'</span>)</span>&nbsp;and&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">entry</span>[<span id="ast-23"><span id="ast-24">'public'</span></span>]</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>created</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28" class="correct_node">_convert_date&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-29" class="other_trans">entry</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;render(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">request</span>,&nbsp;<span id="ast-5">context</span>,&nbsp;*args,&nbsp;**kwargs</span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>breadcrumb</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">data</span>(<span id="ast-10">self</span>,&nbsp;<span id="ast-11" class="other_trans">request</span>,&nbsp;<span id="ast-12" class="other_trans">context</span>,&nbsp;*<span id="ast-13" class="other_trans">args</span>,&nbsp;**<span id="ast-14" class="other_trans">kwargs</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16"><span id="ast-17">breadcrumb</span>.parent</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent_data</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">breadcrumb</span>.parent</span>(<span id="ast-23">self</span>,&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">breadcrumb</span>.application</span>,&nbsp;<span id="ast-26">request</span>,&nbsp;<span id="ast-27" class="other_trans">context</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent</span>&nbsp;=&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32" class="other_trans">parent_data</span>.title</span>,&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">parent_data</span>.url</span>(<span id="ast-36"><span id="ast-37" class="ref_node">breadcrumb&nbsp;&rarr;&nbsp;parent_data&nbsp;</span>.application</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent</span>&nbsp;=&nbsp;<span id="ast-40" class="other_trans">None</span></span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index_view</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">resolve</span>(<span id="ast-46"><span id="ast-47">reverse</span>(<span id="ast-48">(<span id="ast-49">'%s:index'</span>&nbsp;%&nbsp;<span id="ast-51"><span id="ast-52">breadcrumb</span>.application</span>)</span>)</span>)</span>[<span id="ast-53"><span id="ast-54">0</span></span>]</span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">index_view</span>.breadcrumb</span>.data</span>(<span id="ast-61" class="other_trans">index_view</span>,&nbsp;<span id="ast-62" class="other_trans">request</span>,&nbsp;<span id="ast-63" class="other_trans">context</span>)</span></span><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index</span>&nbsp;=&nbsp;<span id="ast-66">(<span id="ast-67"><span id="ast-68" class="incorrect_node">index&nbsp;&rarr;&nbsp;breadcrumb&nbsp;</span>.title</span>,&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71">index</span>.url</span>(<span id="ast-72"><span id="ast-73" class="other_trans">breadcrumb</span>.application</span>)</span>)</span></span><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parent_is_index</span>&nbsp;=&nbsp;<span id="ast-76">(<span id="ast-77" class="other_trans">index</span><span id="ast-78" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-79" class="other_trans">parent</span>)</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-81">(<span id="ast-82"><span id="ast-83" class="other_trans">breadcrumb</span>.application</span>,&nbsp;<span id="ast-84" class="other_trans">index</span>,&nbsp;<span id="ast-85" class="other_trans">parent</span>,&nbsp;<span id="ast-86">parent_is_index</span>,&nbsp;<span id="ast-87"><span id="ast-88" class="other_trans">breadcrumb</span>.title</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_environment(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">message</span>,&nbsp;<span id="ast-5" class="other_trans">slot</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>project</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">message</span>[<span id="ast-10"><span id="ast-11">'_project'</span></span>]</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.initenv</span>.copy</span>()</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>[<span id="ast-21"><span id="ast-22">'SCRAPY_SLOT'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">str</span>(<span id="ast-25" class="other_trans">slot</span>)</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>[<span id="ast-29"><span id="ast-30">'SCRAPY_PROJECT'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-31" class="other_trans">project</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>[<span id="ast-35"><span id="ast-36">'SCRAPY_SPIDER'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">message</span>[<span id="ast-39"><span id="ast-40">'_spider'</span></span>]</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>[<span id="ast-44"><span id="ast-45">'SCRAPY_JOB'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">message</span>[<span id="ast-48"><span id="ast-49">'_job'</span></span>]</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52" class="other_trans">project</span><span id="ast-53">&nbsp;in&nbsp;</span><span id="ast-54"><span id="ast-55">self</span>.settings</span>)</span>:<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>[<span id="ast-59"><span id="ast-60">'SCRAPY_SETTINGS_MODULE'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63">self</span>.settings</span>[<span id="ast-64"><span id="ast-65" class="other_trans">project</span></span>]</span></span></span><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-67"><span id="ast-68">self</span>.logs_dir</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>[<span id="ast-72"><span id="ast-73">'SCRAPY_LOG_FILE'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76">self</span>._get_file</span>(<span id="ast-77" class="other_trans">message</span>,&nbsp;<span id="ast-78"><span id="ast-79">self</span>.logs_dir</span>,&nbsp;<span id="ast-80">'log'</span>)</span></span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-82"><span id="ast-83">self</span>.items_dir</span>:<span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>[<span id="ast-87"><span id="ast-88">'SCRAPY_FEED_URI'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90" class="correct_node">_get_feed_uri&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-91" class="other_trans">message</span>,&nbsp;<span id="ast-92">'jl'</span>)</span></span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-94" class="other_trans">env</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get(<span id="ast-2"><span id="ast-3" class="other_trans">name</span>,&nbsp;<span id="ast-4" class="other_trans">import_str</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Helper&nbsp;function&nbsp;to&nbsp;use&nbsp;inside&nbsp;the&nbsp;package.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-10" class="other_trans">None</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">getattr</span>(<span id="ast-16" class="other_trans">default_settings</span>,&nbsp;<span id="ast-17" class="other_trans">name</span>)</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">getattr</span>(<span id="ast-22" class="other_trans">settings</span>,&nbsp;<span id="ast-23" class="other_trans">name</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-25" class="other_trans">AttributeError</span>:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-29">(<span id="ast-30" class="other_trans">value</span><span id="ast-31" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-32" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-33">(<span id="ast-34" class="ref_node">value&nbsp;&rarr;&nbsp;name&nbsp;</span><span id="ast-35">&nbsp;in&nbsp;</span><span id="ast-36"><span id="ast-37" class="other_trans">default_settings</span>.required_attrs</span>)</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">Exception</span>(<span id="ast-41">(<span id="ast-42">(<span id="ast-43">'You&nbsp;must&nbsp;set&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-45" class="other_trans">name</span>)</span>&nbsp;+&nbsp;<span id="ast-47">'&nbsp;in&nbsp;your&nbsp;settings.'</span>)</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;handle_error(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">req</span>,&nbsp;<span id="ast-5">client</span>,&nbsp;<span id="ast-6">addr</span>,&nbsp;<span id="ast-7" class="other_trans">exc</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>request_start</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">datetime</span>.now</span>()</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>addr</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-17" class="other_trans">addr</span>&nbsp;or&nbsp;<span id="ast-18">(<span id="ast-19">''</span>,&nbsp;<span id="ast-20">-1</span>)</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22"><span id="ast-23">isinstance</span>(<span id="ast-24">exc</span>,&nbsp;<span id="ast-25">(<span id="ast-26">InvalidRequestLine</span>,&nbsp;<span id="ast-27">InvalidRequestMethod</span>,&nbsp;<span id="ast-28">InvalidHTTPVersion</span>,&nbsp;<span id="ast-29">InvalidHeader</span>,&nbsp;<span id="ast-30">InvalidHeaderName</span>,&nbsp;<span id="ast-31">LimitRequestLine</span>,&nbsp;<span id="ast-32">LimitRequestHeaders</span>,&nbsp;<span id="ast-33">InvalidProxyLine</span>,&nbsp;<span id="ast-34">ForbiddenProxyRequest</span>)</span>)</span>:<span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>status_int</span>&nbsp;=&nbsp;<span id="ast-37">400</span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reason</span>&nbsp;=&nbsp;<span id="ast-40">'Bad&nbsp;Request'</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42"><span id="ast-43">isinstance</span>(<span id="ast-44" class="other_trans">exc</span>,&nbsp;<span id="ast-45" class="other_trans">InvalidRequestLine</span>)</span>:<span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-48">(<span id="ast-49">"&lt;p&gt;Invalid&nbsp;Request&nbsp;Line&nbsp;'%s'&lt;/p&gt;"</span>&nbsp;%&nbsp;<span id="ast-51"><span id="ast-52">str</span>(<span id="ast-53">exc</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-55"><span id="ast-56">isinstance</span>(<span id="ast-57">exc</span>,&nbsp;<span id="ast-58">InvalidRequestMethod</span>)</span>:<span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-61">(<span id="ast-62">"&lt;p&gt;Invalid&nbsp;Method&nbsp;'%s'&lt;/p&gt;"</span>&nbsp;%&nbsp;<span id="ast-64"><span id="ast-65">str</span>(<span id="ast-66" class="other_trans">exc</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-68"><span id="ast-69">isinstance</span>(<span id="ast-70" class="other_trans">exc</span>,&nbsp;<span id="ast-71">InvalidHTTPVersion</span>)</span>:<span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-74">(<span id="ast-75">"&lt;p&gt;Invalid&nbsp;HTTP&nbsp;Version&nbsp;'%s'&lt;/p&gt;"</span>&nbsp;%&nbsp;<span id="ast-77"><span id="ast-78" class="other_trans">str</span>(<span id="ast-79">exc</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-81"><span id="ast-82">isinstance</span>(<span id="ast-83" class="other_trans">exc</span>,&nbsp;<span id="ast-84">(<span id="ast-85">InvalidHeaderName</span>,&nbsp;<span id="ast-86" class="other_trans">InvalidHeader</span>)</span>)</span>:<span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-89">(<span id="ast-90">'&lt;p&gt;%s&lt;/p&gt;'</span>&nbsp;%&nbsp;<span id="ast-92"><span id="ast-93">str</span>(<span id="ast-94">exc</span>)</span>)</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96">(<span id="ast-98">(<span id="ast-99">not</span>&nbsp;<span id="ast-100">req</span>)</span>&nbsp;and&nbsp;<span id="ast-101"><span id="ast-102">hasattr</span>(<span id="ast-103">exc</span>,&nbsp;<span id="ast-104">'req'</span>)</span>)</span>:<span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>req</span>&nbsp;=&nbsp;<span id="ast-107"><span id="ast-108" class="other_trans">exc</span>.req</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-110"><span id="ast-111">isinstance</span>(<span id="ast-112">exc</span>,&nbsp;<span id="ast-113">LimitRequestLine</span>)</span>:<span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-116">(<span id="ast-117">'&lt;p&gt;%s&lt;/p&gt;'</span>&nbsp;%&nbsp;<span id="ast-119"><span id="ast-120">str</span>(<span id="ast-121">exc</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-123"><span id="ast-124">isinstance</span>(<span id="ast-125" class="other_trans">exc</span>,&nbsp;<span id="ast-126">LimitRequestHeaders</span>)</span>:<span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-129">(<span id="ast-130">"&lt;p&gt;Error&nbsp;parsing&nbsp;headers:&nbsp;'%s'&lt;/p&gt;"</span>&nbsp;%&nbsp;<span id="ast-132"><span id="ast-133">str</span>(<span id="ast-134">exc</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-136"><span id="ast-137" class="other_trans">isinstance</span>(<span id="ast-138">exc</span>,&nbsp;<span id="ast-139">InvalidProxyLine</span>)</span>:<span id="ast-140"><span id="ast-141"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-142">(<span id="ast-143">"&lt;p&gt;'%s'&lt;/p&gt;"</span>&nbsp;%&nbsp;<span id="ast-145"><span id="ast-146">str</span>(<span id="ast-147" class="other_trans">exc</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-149"><span id="ast-150">isinstance</span>(<span id="ast-151">exc</span>,&nbsp;<span id="ast-152">ForbiddenProxyRequest</span>)</span>:<span id="ast-153"><span id="ast-154" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reason</span>&nbsp;=&nbsp;<span id="ast-155">'Forbidden'</span></span><span id="ast-156"><span id="ast-157" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-158">'&lt;p&gt;Request&nbsp;forbidden&lt;/p&gt;'</span></span><span id="ast-159"><span id="ast-160" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>status_int</span>&nbsp;=&nbsp;<span id="ast-161">403</span></span></span><span id="ast-162"><span id="ast-163"><span id="ast-164"><span id="ast-165"><span id="ast-166"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.debug</span>(<span id="ast-167"><span id="ast-168"><span id="ast-169">'Invalid&nbsp;request&nbsp;from&nbsp;ip={ip}:&nbsp;{error}'</span>.format</span>(ip=<span id="ast-171"><span id="ast-172" class="other_trans">addr</span>[<span id="ast-173"><span id="ast-174">0</span></span>]</span>,&nbsp;error=<span id="ast-176"><span id="ast-177">str</span>(<span id="ast-178">exc</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-179"><span id="ast-180"><span id="ast-181"><span id="ast-182"><span id="ast-183"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.exception</span>(<span id="ast-184">'Error&nbsp;handling&nbsp;request'</span>)</span></span><span id="ast-185"><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>status_int</span>&nbsp;=&nbsp;<span id="ast-187">500</span></span><span id="ast-188"><span id="ast-189" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reason</span>&nbsp;=&nbsp;<span id="ast-190">'Internal&nbsp;Server&nbsp;Error'</span></span><span id="ast-191"><span id="ast-192"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mesg</span>&nbsp;=&nbsp;<span id="ast-193">''</span></span></span><span id="ast-194"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-195">(<span id="ast-196">req</span><span id="ast-197" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-198">None</span>)</span>:<span id="ast-199"><span id="ast-200"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>request_time</span>&nbsp;=&nbsp;<span id="ast-201">(<span id="ast-202"><span id="ast-203"><span id="ast-204">datetime</span>.now</span>()</span>&nbsp;-&nbsp;<span id="ast-206" class="other_trans">request_start</span>)</span></span><span id="ast-207"><span id="ast-208"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>environ</span>&nbsp;=&nbsp;<span id="ast-209"><span id="ast-210">default_environ</span>(<span id="ast-211" class="other_trans">req</span>,&nbsp;<span id="ast-212">client</span>,&nbsp;<span id="ast-213"><span id="ast-214">self</span>.cfg</span>)</span></span><span id="ast-215"><span id="ast-216"><span id="ast-217"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>environ</span>[<span id="ast-218"><span id="ast-219">'REMOTE_ADDR'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-220"><span id="ast-221" class="other_trans">addr</span>[<span id="ast-222"><span id="ast-223">0</span></span>]</span></span><span id="ast-224"><span id="ast-225"><span id="ast-226" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>environ</span>[<span id="ast-227"><span id="ast-228">'REMOTE_PORT'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-229"><span id="ast-230">str</span>(<span id="ast-231"><span id="ast-232" class="other_trans">addr</span>[<span id="ast-233"><span id="ast-234">1</span></span>]</span>)</span></span><span id="ast-235"><span id="ast-236" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resp</span>&nbsp;=&nbsp;<span id="ast-237"><span id="ast-238">Response</span>(<span id="ast-239">req</span>,&nbsp;<span id="ast-240" class="other_trans">client</span>,&nbsp;<span id="ast-241" class="ref_node">cfg&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-242"><span id="ast-243"><span id="ast-244" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resp</span>.status</span>&nbsp;=&nbsp;<span id="ast-245">(<span id="ast-246">'%s&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-248">(<span id="ast-249" class="other_trans">status_int</span>,&nbsp;<span id="ast-250" class="other_trans">reason</span>)</span>)</span></span><span id="ast-251"><span id="ast-252"><span id="ast-253" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resp</span>.response_length</span>&nbsp;=&nbsp;<span id="ast-254"><span id="ast-255" class="other_trans">len</span>(<span id="ast-256">mesg</span>)</span></span><span id="ast-257"><span id="ast-258"><span id="ast-259"><span id="ast-260"><span id="ast-261"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.access</span>(<span id="ast-262" class="other_trans">resp</span>,&nbsp;<span id="ast-263">req</span>,&nbsp;<span id="ast-264" class="other_trans">environ</span>,&nbsp;<span id="ast-265">request_time</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;add_user_data(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Wrapper&nbsp;method&nbsp;to&nbsp;encapsulate&nbsp;process&nbsp;of&nbsp;constructing&nbsp;userdata&nbsp;for&nbsp;the&nbsp;autoscaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Sets&nbsp;self.user_data_payload&nbsp;constructed&nbsp;from&nbsp;the&nbsp;passed&nbsp;in&nbsp;user_data&nbsp;and&nbsp;env_vars&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.user_data_payload</span>&nbsp;=&nbsp;<span id="ast-9">{}</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11"><span id="ast-12">self</span>.user_data</span>:<span id="ast-13"><span id="ast-14" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>user_data_payload&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.build_bootstrap</span>(bootstrap_files=<span id="ast-19">[<span id="ast-20"><span id="ast-21">self</span>.user_data</span>]</span>,&nbsp;variable_declarations=<span id="ast-23">[<span id="ast-24">(<span id="ast-25">'%s=%s'</span>&nbsp;%&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">k</span>,&nbsp;<span id="ast-29" class="other_trans">v</span>)</span>)</span><span id="ast-30">&nbsp;for&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">k</span>,&nbsp;<span id="ast-33" class="other_trans">v</span>)</span>&nbsp;in&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">self</span>.env_vars</span>.iteritems</span>()</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;sample(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">x</span>,&nbsp;<span id="ast-5" class="other_trans">y</span>,&nbsp;<span id="ast-6" class="other_trans">method</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Return&nbsp;the&nbsp;values&nbsp;nearest&nbsp;(`x`,&nbsp;`y`),&nbsp;where&nbsp;`x`&nbsp;and&nbsp;`y`&nbsp;may&nbsp;be\\u000a&nbsp;&nbsp;&nbsp;&nbsp;equal&nbsp;length&nbsp;vectors.&nbsp;*method*&nbsp;may&nbsp;be&nbsp;one&nbsp;of&nbsp;`nearest`,&nbsp;`linear`.&nbsp;'</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">method</span><span id="ast-13" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-14">'nearest'</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-16"><span id="ast-17" class="correct_node">sample_nearest&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-18" class="other_trans">x</span>,&nbsp;<span id="ast-19" class="other_trans">y</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">method</span><span id="ast-23" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-24">'linear'</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-26">scipy.interpolate</span></span><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-29" class="other_trans">Xd</span>,&nbsp;<span id="ast-30" class="other_trans">Yd</span>)</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>.center_coords</span>()</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">scipy</span>.interpolate</span>.griddata</span>(<span id="ast-39">(<span id="ast-40"><span id="ast-41" class="other_trans">Xd</span>.flat</span>,&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">Yd</span>.flat</span>)</span>,&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46">self</span>.data</span>.flat</span>,&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">x</span>,&nbsp;<span id="ast-49" class="other_trans">y</span>)</span>,&nbsp;method=<span id="ast-51">'linear'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">ValueError</span>(<span id="ast-55"><span id="ast-56"><span id="ast-57">'method&nbsp;"{0}"&nbsp;not&nbsp;understood'</span>.format</span>(<span id="ast-58" class="other_trans">method</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_call_term(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">term</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Responsible&nbsp;for&nbsp;looking&nbsp;up&nbsp;and&nbsp;calling&nbsp;a&nbsp;merit&nbsp;value.&nbsp;Returns&nbsp;result&nbsp;of&nbsp;that&nbsp;call.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;term(str):&nbsp;&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;term&nbsp;to&nbsp;be&nbsp;called.&nbsp;Term&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.debug</span>(<span id="ast-12"><span id="ast-13"><span id="ast-14">'\\u0009&nbsp;Weight:&nbsp;{}'</span>.format</span>(<span id="ast-15" class="other_trans">term</span>)</span>)</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>term_function</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">getattr</span>(<span id="ast-20" class="other_trans">merit_functions</span>,&nbsp;<span id="ast-21" class="other_trans">term</span>)</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.debug</span>(<span id="ast-27"><span id="ast-28"><span id="ast-29">'\\u0009Term&nbsp;Function:&nbsp;{}'</span>.format</span>(<span id="ast-30" class="incorrect_node">term_function&nbsp;&rarr;&nbsp;term&nbsp;</span>)</span>)</span></span><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-33" class="other_trans">merit_value</span>,&nbsp;<span id="ast-34" class="other_trans">observable</span>)</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36" class="ref_node">term_function&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-37" class="other_trans">term</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_context(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">request</span>,&nbsp;<span id="ast-5" class="other_trans">category</span>,&nbsp;<span id="ast-7" class="other_trans">year</span>,&nbsp;<span id="ast-9">month</span>,&nbsp;<span id="ast-11">day</span>,&nbsp;<span id="ast-13">content_type</span>,&nbsp;<span id="ast-15">paginate_by</span></span>):<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-21">(<span id="ast-22">'p'</span><span id="ast-23">&nbsp;in&nbsp;</span><span id="ast-24"><span id="ast-25">request</span>.GET</span>)</span>&nbsp;and&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30">request</span>.GET</span>[<span id="ast-31"><span id="ast-32">'p'</span></span>]</span>.isdigit</span>()</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>page_no</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36">int</span>(<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">request</span>.GET</span>[<span id="ast-40"><span id="ast-41">'p'</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>page_no</span>&nbsp;=&nbsp;<span id="ast-44">1</span></span></span><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>category_title_page</span>&nbsp;=&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">page_no</span><span id="ast-49" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-50">1</span>)</span></span><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kwa</span>&nbsp;=&nbsp;<span id="ast-53">{}</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55" class="other_trans">year</span>:<span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>category_title_page</span>&nbsp;=&nbsp;<span id="ast-58">False</span></span><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>year</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62">int</span>(<span id="ast-63" class="other_trans">year</span>)</span></span><span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwa</span>[<span id="ast-67"><span id="ast-68">'publish_from__year'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-69">year</span></span></span><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>is_homepage</span>&nbsp;=&nbsp;<span id="ast-72">(<span id="ast-74">(<span id="ast-75">not</span>&nbsp;<span id="ast-76"><span id="ast-77">bool</span>(<span id="ast-78">category</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-79">(<span id="ast-80" class="other_trans">page_no</span><span id="ast-81" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-82">1</span>)</span>&nbsp;and&nbsp;<span id="ast-83">(<span id="ast-84" class="other_trans">year</span><span id="ast-85" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-86">None</span>)</span>)</span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-88">month</span>:<span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>month</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93">int</span>(<span id="ast-94">month</span>)</span></span><span id="ast-95"><span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>date</span>(<span id="ast-98">year</span>,&nbsp;<span id="ast-99" class="other_trans">month</span>,&nbsp;<span id="ast-100">1</span>)</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-102">ValueError</span>:<span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-104"><span id="ast-105"><span id="ast-106">self</span>._handle_404</span>(<span id="ast-107">(<span id="ast-108"><span id="ast-109">_</span>(<span id="ast-110">'Invalid&nbsp;month&nbsp;value&nbsp;%r'</span>)</span>&nbsp;%&nbsp;<span id="ast-112">month</span>)</span>,&nbsp;<span id="ast-113" class="other_trans">is_homepage</span>)</span></span></span></span><span id="ast-114"><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwa</span>[<span id="ast-117"><span id="ast-118">'publish_from__month'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-119" class="other_trans">month</span></span></span><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-121">day</span>:<span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-123"><span id="ast-124" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>day</span>&nbsp;=&nbsp;<span id="ast-125"><span id="ast-126">int</span>(<span id="ast-127">day</span>)</span></span><span id="ast-128"><span id="ast-129"><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>date</span>(<span id="ast-131" class="other_trans">year</span>,&nbsp;<span id="ast-132">month</span>,&nbsp;<span id="ast-133" class="other_trans">day</span>)</span></span><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-135" class="other_trans">ValueError</span>:<span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-137"><span id="ast-138"><span id="ast-139">self</span>._handle_404</span>(<span id="ast-140">(<span id="ast-141"><span id="ast-142">_</span>(<span id="ast-143">'Invalid&nbsp;day&nbsp;value&nbsp;%r'</span>)</span>&nbsp;%&nbsp;<span id="ast-145" class="ref_node">year&nbsp;&rarr;&nbsp;day&nbsp;</span>)</span>,&nbsp;<span id="ast-146" class="other_trans">is_homepage</span>)</span></span></span></span><span id="ast-147"><span id="ast-148"><span id="ast-149" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwa</span>[<span id="ast-150"><span id="ast-151">'publish_from__day'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-152" class="other_trans">day</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;find(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">data</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-6">[<span id="ast-7" class="other_trans">subdata</span><span id="ast-8">&nbsp;for&nbsp;<span id="ast-9" class="other_trans">subdata</span>&nbsp;in&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.left</span>.find</span>(<span id="ast-14" class="other_trans">data</span>)</span>&nbsp;if&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.right</span>.find</span>(<span id="ast-19" class="correct_node">data&nbsp;&rarr;&nbsp;subdata&nbsp;</span>)</span></span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">configurables</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>configurables_from_apps</span>&nbsp;=&nbsp;<span id="ast-7">[]</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-9" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-10" class="other_trans">configurables</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">hasattr</span>(<span id="ast-14" class="other_trans">c</span>,&nbsp;<span id="ast-15">'configurations'</span>)</span>:<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>configurables_from_apps</span>.append</span>(<span id="ast-20"><span id="ast-21" class="other_trans">c</span>.configurations</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>configurables&nbsp;&rarr;&nbsp;configurables_from_apps&nbsp;</span>.append</span>(<span id="ast-26" class="other_trans">c</span>)</span></span></span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.configurables</span>&nbsp;=&nbsp;<span id="ast-30" class="other_trans">configurables_from_apps</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">privkey</span>,&nbsp;<span id="ast-6" class="other_trans">md</span>,&nbsp;**kwargs</span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10">not</span>&nbsp;<span id="ast-11" class="other_trans">privkey</span>)</span>:<span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.privkey</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">RSAPrivateKey</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.privkey</span>&nbsp;=&nbsp;<span id="ast-20" class="other_trans">privkey</span></span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pk</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">EVP</span>.PKey</span>()</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pk</span>.assign_rsa</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32" class="location_node">privkey&nbsp;&rarr;&nbsp;self.,&nbsp;pred:&nbsp;pk&nbsp;</span>.get_m2_rsa</span>()</span>,&nbsp;capture=<span id="ast-34">0</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;to_python(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">value</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-8">(<span id="ast-9" class="other_trans">value</span><span id="ast-10" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>&nbsp;or&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">value</span><span id="ast-14" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-15">''</span>)</span>)</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-17" class="other_trans">None</span></span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-19" class="other_trans">m</span>&nbsp;in&nbsp;<span id="ast-20"><span id="ast-21">self</span>.enum</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">value</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26" class="other_trans">m</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28" class="correct_node">value&nbsp;&rarr;&nbsp;m&nbsp;</span></span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-32">(<span id="ast-33" class="other_trans">value</span><span id="ast-34" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-35"><span id="ast-36" class="other_trans">m</span>.value</span>)</span>&nbsp;or&nbsp;<span id="ast-37">(<span id="ast-38"><span id="ast-39" class="other_trans">str</span>(<span id="ast-40" class="other_trans">value</span>)</span><span id="ast-41" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-42"><span id="ast-43" class="other_trans">str</span>(<span id="ast-44"><span id="ast-45" class="other_trans">m</span>.value</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-46">(<span id="ast-47"><span id="ast-48" class="other_trans">str</span>(<span id="ast-49" class="other_trans">value</span>)</span><span id="ast-50" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-51"><span id="ast-52" class="other_trans">str</span>(<span id="ast-53" class="other_trans">m</span>)</span>)</span>)</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-55" class="other_trans">m</span></span></span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">ValidationError</span>(<span id="ast-59">(<span id="ast-60">'%s&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;for&nbsp;enum&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-62">(<span id="ast-63" class="other_trans">value</span>,&nbsp;<span id="ast-64"><span id="ast-65">self</span>.enum</span>)</span>)</span>,&nbsp;code=<span id="ast-67">'invalid_enum_value'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_udp_riemann(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>event</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">Event</span>(<span id="ast-8">'ok'</span>,&nbsp;<span id="ast-9">'sky'</span>,&nbsp;<span id="ast-10">'Sky&nbsp;has&nbsp;not&nbsp;fallen'</span>,&nbsp;<span id="ast-11">1.0</span>,&nbsp;<span id="ast-12">60.0</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>protocol</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">riemann</span>.RiemannUDP</span>(<span id="ast-18">'127.0.0.1'</span>,&nbsp;<span id="ast-19">5555</span>)</span></span><span id="ast-20"><span id="ast-21" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>endpoint&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">reactor</span>.listenUDP</span>(<span id="ast-25">0</span>,&nbsp;<span id="ast-26" class="other_trans">protocol</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;private_encrypt(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">value</span>,&nbsp;<span id="ast-5" class="other_trans">padding</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>buf</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">create_string_buffer</span>(<span id="ast-11" class="other_trans">value</span>,&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">len</span>(<span id="ast-14" class="other_trans">value</span>)</span>)</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">RSA_size</span>(<span id="ast-19"><span id="ast-20">self</span>.key</span>)</span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24">create_string_buffer</span>(<span id="ast-25" class="other_trans">size</span>)</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">RSA_private_encrypt</span>(<span id="ast-30"><span id="ast-31" class="other_trans">len</span>(<span id="ast-32" class="other_trans">buf</span>)</span>,&nbsp;<span id="ast-33" class="other_trans">buf</span>,&nbsp;<span id="ast-34" class="other_trans">output</span>,&nbsp;<span id="ast-35"><span id="ast-36">self</span>.key</span>,&nbsp;<span id="ast-37" class="other_trans">padding</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40" class="other_trans">ret</span><span id="ast-41" class="location_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-42">0</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">SSLError</span>(<span id="ast-46">'Unable&nbsp;to&nbsp;encrypt&nbsp;data'</span>)</span></span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">output</span>.raw</span>[<span id="ast-51">:<span id="ast-52" class="other_trans">ret</span></span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;to_dict(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>&nbsp;=&nbsp;<span id="ast-6">{<span id="ast-7">'key'</span>:&nbsp;<span id="ast-9"><span id="ast-10">self</span>.key</span>,&nbsp;<span id="ast-8">'name'</span>:&nbsp;<span id="ast-11"><span id="ast-12">self</span>.name</span>}</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15"><span id="ast-16">self</span>.status</span><span id="ast-17" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-18" class="other_trans">None</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-22"><span id="ast-23">'status'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25">self</span>.status</span></span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28"><span id="ast-29">self</span>.data</span><span id="ast-30" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-31" class="other_trans">None</span>)</span>:<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-35"><span id="ast-36">'data'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-37" class="correct_node">data&nbsp;&rarr;&nbsp;self.&nbsp;</span></span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41">self</span>.network</span><span id="ast-42" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-43" class="other_trans">None</span>)</span>:<span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-47"><span id="ast-48">'network'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59">self</span>.network</span>.to_dict</span>()</span>&nbsp;if&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">INetwork</span>.implementedBy</span>(<span id="ast-53"><span id="ast-54"><span id="ast-55">self</span>.network</span>.__class__</span>)</span>&nbsp;else&nbsp;<span id="ast-60"><span id="ast-61">self</span>.network</span></span></span></span><span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-65"><span id="ast-66">'deviceClass'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77">self</span>.device_class</span>.to_dict</span>()</span>&nbsp;if&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans">IDeviceClass</span>.implementedBy</span>(<span id="ast-71"><span id="ast-72"><span id="ast-73">self</span>.device_class</span>.__class__</span>)</span>&nbsp;else&nbsp;<span id="ast-78"><span id="ast-79">self</span>.device_class</span></span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-81">(<span id="ast-82"><span id="ast-83">self</span>.equipment</span><span id="ast-84" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-85" class="other_trans">None</span>)</span>:<span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-89"><span id="ast-90">'equipment'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-91">[<span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans">x</span>.to_dict</span>()</span><span id="ast-95">&nbsp;for&nbsp;<span id="ast-96" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-97"><span id="ast-98">self</span>.equipment</span></span>]</span></span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-100" class="other_trans">res</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;encounter_pokemon(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">pokemon_data</span>,&nbsp;<span id="ast-5" class="other_trans">retry</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.update_player_inventory</span>()</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14">not</span>&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.inventory</span>.can_attempt_catch</span>()</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-24">'No&nbsp;balls&nbsp;to&nbsp;catch&nbsp;%s,&nbsp;exiting&nbsp;encounter'</span>,&nbsp;<span id="ast-25"><span id="ast-26">self</span>.inventory</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28">False</span></span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>encounter_id</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">pokemon_data</span>[<span id="ast-33"><span id="ast-34">'encounter_id'</span></span>]</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>spawn_point_id</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">pokemon_data</span>[<span id="ast-39"><span id="ast-40">'spawn_point_id'</span></span>]</span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>position</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45">self</span>.get_position</span>()</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-51">'Trying&nbsp;initiate&nbsp;catching&nbsp;Pokemon:&nbsp;%s'</span>,&nbsp;<span id="ast-52"><span id="ast-53">Pokemon</span>(<span id="ast-54">pokemon_data</span>,&nbsp;<span id="ast-55"><span id="ast-56">self</span>.pokemon_names</span>)</span>)</span></span><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>encounter</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65">self</span>.encounter</span>(encounter_id=<span id="ast-67" class="other_trans">encounter_id</span>,&nbsp;spawn_point_id=<span id="ast-69" class="other_trans">spawn_point_id</span>,&nbsp;player_latitude=<span id="ast-71"><span id="ast-72" class="other_trans">position</span>[<span id="ast-73"><span id="ast-74">0</span></span>]</span>,&nbsp;player_longitude=<span id="ast-76"><span id="ast-77" class="other_trans">position</span>[<span id="ast-78"><span id="ast-79">1</span></span>]</span>)</span>.call</span>()</span>[<span id="ast-80"><span id="ast-81">'responses'</span></span>]</span>[<span id="ast-82"><span id="ast-83">'ENCOUNTER'</span></span>]</span></span><span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.debug</span>(<span id="ast-89">'Attempting&nbsp;to&nbsp;Start&nbsp;Encounter:&nbsp;%s'</span>,&nbsp;<span id="ast-90" class="other_trans">encounter</span>)</span></span><span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pokemon</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94">Pokemon</span>(<span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans">encounter</span>.get</span>(<span id="ast-100">'wild_pokemon'</span>,&nbsp;<span id="ast-101">{}</span>)</span>.get</span>(<span id="ast-102">'pokemon_data'</span>,&nbsp;<span id="ast-103">{}</span>)</span>,&nbsp;<span id="ast-104"><span id="ast-105">self</span>.pokemon_names</span>)</span></span><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110" class="other_trans">encounter</span>.get</span>(<span id="ast-111">'status'</span>,&nbsp;<span id="ast-112">-1</span>)</span></span><span id="ast-113"><span id="ast-114" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>capture_probability</span>&nbsp;=&nbsp;<span id="ast-115"><span id="ast-116" class="incorrect_node">create_capture_probability&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-117"><span id="ast-118"><span id="ast-119">encounter</span>.get</span>(<span id="ast-120">'capture_probability'</span>,&nbsp;<span id="ast-121">{}</span>)</span>)</span></span><span id="ast-122"><span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.debug</span>(<span id="ast-127">'Attempt&nbsp;Encounter&nbsp;Capture&nbsp;Probability:&nbsp;%s'</span>,&nbsp;<span id="ast-128"><span id="ast-129"><span id="ast-130" class="other_trans">json</span>.dumps</span>(<span id="ast-131" class="other_trans">encounter</span>,&nbsp;indent=<span id="ast-133">4</span>,&nbsp;sort_keys=<span id="ast-135">True</span>)</span>)</span></span><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-137">(<span id="ast-138">result</span><span id="ast-139" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-140">1</span>)</span>:<span id="ast-141"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-142"><span id="ast-143"><span id="ast-144">self</span>.do_catch_pokemon</span>(<span id="ast-145" class="other_trans">encounter_id</span>,&nbsp;<span id="ast-146">spawn_point_id</span>,&nbsp;<span id="ast-147">capture_probability</span>,&nbsp;<span id="ast-148">pokemon</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-150">(<span id="ast-151" class="other_trans">result</span><span id="ast-152" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-153">7</span>)</span>:<span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-159">"Couldn't&nbsp;catch&nbsp;%s&nbsp;Your&nbsp;pokemon&nbsp;bag&nbsp;was&nbsp;full,&nbsp;attempting&nbsp;to&nbsp;clear&nbsp;and&nbsp;re-try"</span>,&nbsp;<span id="ast-160" class="other_trans">pokemon</span>)</span></span><span id="ast-161"><span id="ast-162"><span id="ast-163"><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cleanup_pokemon</span>()</span></span><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-166">(<span id="ast-167">not</span>&nbsp;<span id="ast-168">retry</span>)</span>:<span id="ast-169"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-170"><span id="ast-171"><span id="ast-172">self</span>.encounter_pokemon</span>(<span id="ast-173" class="ref_node">pokemon&nbsp;&rarr;&nbsp;pokemon_data&nbsp;</span>,&nbsp;retry=<span id="ast-175">True</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-176"><span id="ast-177"><span id="ast-178"><span id="ast-179"><span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-181">'Could&nbsp;not&nbsp;start&nbsp;encounter&nbsp;for&nbsp;pokemon:&nbsp;%s'</span>,&nbsp;<span id="ast-182" class="other_trans">pokemon</span>)</span></span></span><span id="ast-183"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-184">False</span></span><span id="ast-185"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-186">Exception</span>&nbsp;as&nbsp;<span id="ast-187" class="other_trans">e</span>:<span id="ast-188"><span id="ast-189"><span id="ast-190"><span id="ast-191"><span id="ast-192"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.error</span>(<span id="ast-193">'Error&nbsp;in&nbsp;pokemon&nbsp;encounter&nbsp;%s'</span>,&nbsp;<span id="ast-194" class="other_trans">e</span>)</span></span><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-196">False</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;server_create(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">label</span>,&nbsp;<span id="ast-5" class="other_trans">vpsplanid</span>,&nbsp;<span id="ast-6">osid</span>,&nbsp;<span id="ast-7" class="other_trans">dcid</span>,&nbsp;<span id="ast-8" class="other_trans">sshkeyid</span>,&nbsp;<span id="ast-9" class="other_trans">enable_private_network</span>,&nbsp;<span id="ast-10" class="other_trans">enable_backups</span></span>):<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-13">{<span id="ast-14">'label'</span>:&nbsp;<span id="ast-21" class="other_trans">label</span>,&nbsp;<span id="ast-15">'VPSPLANID'</span>:&nbsp;<span id="ast-22" class="other_trans">vpsplanid</span>,&nbsp;<span id="ast-16">'OSID'</span>:&nbsp;<span id="ast-23" class="other_trans">osid</span>,&nbsp;<span id="ast-17">'DCID'</span>:&nbsp;<span id="ast-24" class="other_trans">dcid</span>,&nbsp;<span id="ast-18">'SSHKEYID'</span>:&nbsp;<span id="ast-25" class="other_trans">sshkeyid</span>,&nbsp;<span id="ast-19">'enable_private_network'</span>:&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28">self</span>.yn</span>(<span id="ast-29" class="other_trans">enable_private_network</span>)</span>,&nbsp;<span id="ast-20" class="other_trans">enable_backups</span>:&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32">self</span>.yn</span>(<span id="ast-33" class="other_trans">enable_backups</span>)</span>}</span></span><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">requests</span>.post</span>(<span id="ast-39">(<span id="ast-40"><span id="ast-41">self</span>.API_BASE_URL</span>&nbsp;+&nbsp;<span id="ast-43">'/server/create'</span>)</span>,&nbsp;params=<span id="ast-45">{<span id="ast-46">'api_key'</span>:&nbsp;<span id="ast-47"><span id="ast-48">self</span>.API_KEY</span>}</span>,&nbsp;data=<span id="ast-50" class="other_trans">data</span>)</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52">(<span id="ast-53"><span id="ast-54" class="other_trans">r</span>.status_code</span><span id="ast-55" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-56">200</span>)</span>:<span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-58"><span id="ast-59">Exception</span>(<span id="ast-60">'API&nbsp;Error'</span>,&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">r</span>.text</span>)</span></span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>json</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans">r</span>.json</span>()</span></span><span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>servers</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71" class="ref_node">server_list&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;delete_(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">url</span>,&nbsp;<span id="ast-5" class="other_trans">ok</span>,&nbsp;<span id="ast-7" class="other_trans">aux</span></span>):<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-10"><span id="ast-11" class="correct_node">request_&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-12"><span id="ast-13" class="other_trans">_Params</span>(<span id="ast-14" class="other_trans">url</span>,&nbsp;<span id="ast-15">'DELETE'</span>,&nbsp;ok=<span id="ast-17" class="other_trans">ok</span>,&nbsp;aux=<span id="ast-19" class="other_trans">aux</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;restoreConfig(<span id="ast-2"><span id="ast-3" class="other_trans">ldifFolder</span>,&nbsp;<span id="ast-4" class="other_trans">newLdif</span>,&nbsp;<span id="ast-5" class="other_trans">ldifModFolder</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.info</span>(<span id="ast-10">'Comparing&nbsp;old&nbsp;LDAP&nbsp;data&nbsp;and&nbsp;creating&nbsp;`modify`&nbsp;files.'</span>)</span></span><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ignoreList</span>&nbsp;=&nbsp;<span id="ast-13">[<span id="ast-14">'objectClass'</span>,&nbsp;<span id="ast-15">'ou'</span>]</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_config_dns</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">getDns</span>(<span id="ast-20" class="other_trans">newLdif</span>)</span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>oldDnMap</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24">getOldEntryMap</span>(<span id="ast-25" class="other_trans">ldifFolder</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-27" class="other_trans">dn</span>&nbsp;in&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">oldDnMap</span>.keys</span>()</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>old_entry</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">getEntry</span>(<span id="ast-35">(<span id="ast-36">'%s/%s'</span>&nbsp;%&nbsp;<span id="ast-38">(<span id="ast-39">ldifFolder</span>,&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">oldDnMap</span>[<span id="ast-42"><span id="ast-43" class="other_trans">dn</span></span>]</span>)</span>)</span>,&nbsp;<span id="ast-44" class="other_trans">dn</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">(<span id="ast-47" class="other_trans">dn</span><span id="ast-48">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-49" class="other_trans">current_config_dns</span>)</span>:<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addEntry</span>(<span id="ast-53" class="other_trans">dn</span>,&nbsp;<span id="ast-54" class="other_trans">old_entry</span>,&nbsp;<span id="ast-55" class="other_trans">ldifModFolder</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_entry</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60">getEntry</span>(<span id="ast-61" class="other_trans">newLdif</span>,&nbsp;<span id="ast-62" class="other_trans">dn</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-64" class="other_trans">attr</span>&nbsp;in&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67" class="incorrect_node">old_entry&nbsp;&rarr;&nbsp;current_config_dns&nbsp;</span>.keys</span>()</span>:<span id="ast-68"><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_fn</span>&nbsp;=&nbsp;<span id="ast-70">(<span id="ast-71">(<span id="ast-72"><span id="ast-73" class="other_trans">str</span>(<span id="ast-74"><span id="ast-75" class="other_trans">len</span>(<span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans">dn</span>.split</span>(<span id="ast-79">','</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-81">'_'</span>)</span>&nbsp;+&nbsp;<span id="ast-83"><span id="ast-84" class="other_trans">str</span>(<span id="ast-85"><span id="ast-86"><span id="ast-87">uuid</span>.uuid4</span>()</span>)</span>)</span></span><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-90">(<span id="ast-91">'%s/%s.ldif'</span>&nbsp;%&nbsp;<span id="ast-93">(<span id="ast-94" class="ref_node">ldifFolder&nbsp;&rarr;&nbsp;ldifModFolder&nbsp;</span>,&nbsp;<span id="ast-95">new_fn</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_swap_memory(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mem</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">psutil</span>.swap_memory</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12" class="other_trans">mem</span>.total</span><span id="ast-13" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-14">0</span>)</span>,&nbsp;<span id="ast-15" class="other_trans">mem</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19" class="other_trans">mem</span>.used</span><span id="ast-20" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-21">0</span>)</span>,&nbsp;<span id="ast-22" class="other_trans">mem</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">mem</span>.free</span><span id="ast-27" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-28">0</span>)</span>,&nbsp;<span id="ast-29" class="other_trans">mem</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-31">(<span id="ast-32">0</span><span id="ast-33" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-35"><span id="ast-36" class="other_trans">mem</span>.percent</span><span id="ast-34" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-37">100</span>)</span>,&nbsp;<span id="ast-38" class="other_trans">mem</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-40">(<span id="ast-41"><span id="ast-42" class="other_trans">mem</span>.sin</span><span id="ast-43" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-44">0</span>)</span>,&nbsp;<span id="ast-45" class="other_trans">mem</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-47">(<span id="ast-48"><span id="ast-49" class="other_trans">mem</span>.sout</span><span id="ast-50" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-51">0</span>)</span>,&nbsp;<span id="ast-52" class="other_trans">mem</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;do_package_save(<span id="ast-2"><span id="ast-3" class="other_trans">mc</span>,&nbsp;<span id="ast-4" class="other_trans">args</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Save&nbsp;a&nbsp;package.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;will&nbsp;download&nbsp;package(s)&nbsp;with&nbsp;all&nbsp;dependencies\\u000a&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;specified&nbsp;path.&nbsp;If&nbsp;path&nbsp;doesn't&nbsp;exist&nbsp;it&nbsp;will&nbsp;be&nbsp;created.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>base_url</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">args</span>.murano_repo_url</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">args</span>.path</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16">not</span>&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">os</span>.path</span>.exists</span>(<span id="ast-21"><span id="ast-22" class="other_trans">args</span>.path</span>)</span>)</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.makedirs</span>(<span id="ast-27"><span id="ast-28" class="other_trans">args</span>.path</span>)</span></span></span><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dst</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32">args</span>.path</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dst</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37">os</span>.getcwd</span>()</span></span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>version</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">args</span>.version</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-45" class="other_trans">version</span>&nbsp;and&nbsp;<span id="ast-46">(<span id="ast-47"><span id="ast-48">len</span>(<span id="ast-49"><span id="ast-50">args</span>.filename</span>)</span><span id="ast-51" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-52">2</span>)</span>)</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-54">'Requested&nbsp;to&nbsp;save&nbsp;more&nbsp;than&nbsp;one&nbsp;package,&nbsp;ignoring&nbsp;version.'</span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version</span>&nbsp;=&nbsp;<span id="ast-57">''</span></span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>total_reqs</span>&nbsp;=&nbsp;<span id="ast-60">{}</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-62" class="other_trans">package</span>&nbsp;in&nbsp;<span id="ast-63"><span id="ast-64" class="other_trans">args</span>.package</span>:<span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_file</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">utils</span>.to_url</span>(<span id="ast-70" class="other_trans">package</span>,&nbsp;version=<span id="ast-72" class="other_trans">version</span>,&nbsp;base_url=<span id="ast-74">base_url</span>,&nbsp;extension=<span id="ast-76">'.zip'</span>,&nbsp;path=<span id="ast-78">'apps/'</span>)</span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pkg</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">utils</span>.Package</span>.from_file</span>(<span id="ast-86">_file</span>)</span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-88">Exception</span>&nbsp;as&nbsp;<span id="ast-89" class="other_trans">e</span>:<span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-91"><span id="ast-92"><span id="ast-93">"Failed&nbsp;to&nbsp;create&nbsp;package&nbsp;for&nbsp;'{0}',&nbsp;reason:&nbsp;{1}"</span>.format</span>(<span id="ast-94" class="ref_node">pkg&nbsp;&rarr;&nbsp;package&nbsp;</span>,&nbsp;<span id="ast-95" class="other_trans">e</span>)</span></span><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span><span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>total_reqs</span>.update</span>(<span id="ast-101"><span id="ast-102"><span id="ast-103" class="other_trans">pkg</span>.requirements</span>(base_url=<span id="ast-105" class="other_trans">base_url</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;update_problem(<span id="ast-2"><span id="ast-3" class="other_trans">identifier</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Modify&nbsp;a&nbsp;problem&nbsp;in&nbsp;the&nbsp;database&nbsp;and&nbsp;data&nbsp;folder'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9">(<span id="ast-10"><span id="ast-11">current_user</span>.admin</span><span id="ast-12" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-13">1</span>)</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">serve_error</span>(<span id="ast-17">'You&nbsp;must&nbsp;be&nbsp;an&nbsp;admin&nbsp;to&nbsp;update&nbsp;a&nbsp;problem'</span>,&nbsp;response_code=<span id="ast-19">401</span>)</span></span></span><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-22" class="other_trans">pid</span>,&nbsp;<span id="ast-23" class="other_trans">problem</span>)</span>&nbsp;=&nbsp;<span id="ast-24">(<span id="ast-25" class="other_trans">None</span>,&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">database</span>.session</span>.query</span>(<span id="ast-30">Problem</span>)</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32"><span id="ast-33">is_pid</span>(<span id="ast-34" class="other_trans">identifier</span>)</span>:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pid</span>&nbsp;=&nbsp;<span id="ast-37" class="other_trans">identifier</span></span><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>problem</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">problem</span>.filter</span>(<span id="ast-45">(<span id="ast-46"><span id="ast-47">Problem</span>.pid</span><span id="ast-48" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-49" class="other_trans">pid</span>)</span>)</span>.first</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>problem</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">problem</span>.filter</span>(<span id="ast-57">(<span id="ast-58"><span id="ast-59">Problem</span>.shortname</span><span id="ast-60" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-61" class="other_trans">identifier</span>)</span>)</span>.first</span>()</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pid</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">problem</span>.pid</span></span></span><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75">database</span>.session</span>.query</span>(<span id="ast-76" class="other_trans">ProblemData</span>)</span>.filter</span>(<span id="ast-77">(<span id="ast-78"><span id="ast-79">ProblemData</span>.pid</span><span id="ast-80" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-81" class="other_trans">pid</span>)</span>)</span>.first</span>()</span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-83">(<span id="ast-84">'name'</span><span id="ast-85">&nbsp;in&nbsp;</span><span id="ast-86"><span id="ast-87" class="other_trans">request</span>.form</span>)</span>:<span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>problem</span>.name</span>&nbsp;=&nbsp;<span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94">request</span>.form</span>[<span id="ast-95"><span id="ast-96">'name'</span></span>]</span>[<span id="ast-97">:<span id="ast-98">32</span></span>]</span></span><span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>problem</span>.shortname</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109">request</span>.form</span>[<span id="ast-110"><span id="ast-111">'name'</span></span>]</span>[<span id="ast-112">:<span id="ast-113">32</span></span>]</span>.replace</span>(<span id="ast-114">'&nbsp;'</span>,&nbsp;<span id="ast-115">''</span>)</span>.lower</span>()</span></span></span><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-117">(<span id="ast-118">'description'</span><span id="ast-119">&nbsp;in&nbsp;</span><span id="ast-120"><span id="ast-121">request</span>.form</span>)</span>:<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>.description</span>&nbsp;=&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127" class="other_trans">request</span>.form</span>[<span id="ast-128"><span id="ast-129">'description'</span></span>]</span></span></span><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-131">(<span id="ast-132">'input_desc'</span><span id="ast-133">&nbsp;in&nbsp;</span><span id="ast-134"><span id="ast-135">request</span>.form</span>)</span>:<span id="ast-136"><span id="ast-137"><span id="ast-138" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>.input_desc</span>&nbsp;=&nbsp;<span id="ast-139"><span id="ast-140"><span id="ast-141">request</span>.form</span>[<span id="ast-142"><span id="ast-143">'input_desc'</span></span>]</span></span></span><span id="ast-144"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-145">(<span id="ast-146">'output_desc'</span><span id="ast-147">&nbsp;in&nbsp;</span><span id="ast-148"><span id="ast-149" class="other_trans">request</span>.form</span>)</span>:<span id="ast-150"><span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>.output_desc</span>&nbsp;=&nbsp;<span id="ast-153"><span id="ast-154"><span id="ast-155">request</span>.form</span>[<span id="ast-156"><span id="ast-157">'output_desc'</span></span>]</span></span></span><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-159">(<span id="ast-160">'appeared_in'</span><span id="ast-161">&nbsp;in&nbsp;</span><span id="ast-162"><span id="ast-163">request</span>.form</span>)</span>:<span id="ast-164"><span id="ast-165"><span id="ast-166" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>problem&nbsp;&rarr;&nbsp;data&nbsp;</span>.appeared</span>&nbsp;=&nbsp;<span id="ast-167"><span id="ast-168"><span id="ast-169">request</span>.form</span>[<span id="ast-170"><span id="ast-171">'appeared_in'</span></span>]</span></span></span><span id="ast-172"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-173">(<span id="ast-174">'difficulty'</span><span id="ast-175">&nbsp;in&nbsp;</span><span id="ast-176"><span id="ast-177" class="other_trans">request</span>.form</span>)</span>:<span id="ast-178"><span id="ast-179"><span id="ast-180" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data&nbsp;&rarr;&nbsp;problem&nbsp;</span>.difficulty</span>&nbsp;=&nbsp;<span id="ast-181"><span id="ast-182"><span id="ast-183" class="other_trans">request</span>.form</span>[<span id="ast-184"><span id="ast-185">'difficulty'</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;send_protocol_error(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">exc</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Int8</span>.pack</span>(<span id="ast-9" class="other_trans">REPLY_PROTOCOL_ERROR</span>,&nbsp;<span id="ast-10" class="correct_node">transport&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Str</span>.pack</span>(<span id="ast-15"><span id="ast-16" class="other_trans">str</span>(<span id="ast-17" class="other_trans">exc</span>)</span>,&nbsp;<span id="ast-18"><span id="ast-19">self</span>.transport</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_custom_target_provided_libraries(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">target</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>libs</span>&nbsp;=&nbsp;<span id="ast-7">[]</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-9" class="other_trans">t</span>&nbsp;in&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">target</span>.get_generated_sources</span>()</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15">not</span>&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">isinstance</span>(<span id="ast-18" class="other_trans">t</span>,&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">build</span>.CustomTarget</span>)</span>)</span>:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">t</span>.output</span>:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30">self</span>.environment</span>.is_library</span>(<span id="ast-31" class="other_trans">f</span>)</span>:<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>libs</span>.append</span>(<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-40"><span id="ast-41"><span id="ast-42">self</span>.get_target_dir</span>(<span id="ast-43" class="location_node">target&nbsp;&rarr;&nbsp;t,&nbsp;pred:&nbsp;f&nbsp;</span>)</span>,&nbsp;<span id="ast-44" class="other_trans">f</span>)</span>)</span></span></span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46" class="other_trans">libs</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_setup_logging(<span id="ast-2"><span id="ast-3" class="other_trans">connection_debug</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'setup_logging&nbsp;function&nbsp;maps&nbsp;SQL&nbsp;debug&nbsp;level&nbsp;to&nbsp;Python&nbsp;log&nbsp;level.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Connection_debug&nbsp;is&nbsp;a&nbsp;verbosity&nbsp;of&nbsp;SQL&nbsp;debugging&nbsp;information.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;0=None(default&nbsp;value),\\u000a&nbsp;&nbsp;&nbsp;&nbsp;1=Processed&nbsp;only&nbsp;messages&nbsp;with&nbsp;WARNING&nbsp;level&nbsp;or&nbsp;higher\\u000a&nbsp;&nbsp;&nbsp;&nbsp;50=Processed&nbsp;only&nbsp;messages&nbsp;with&nbsp;INFO&nbsp;level&nbsp;or&nbsp;higher\\u000a&nbsp;&nbsp;&nbsp;&nbsp;100=Processed&nbsp;only&nbsp;messages&nbsp;with&nbsp;DEBUG&nbsp;level\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">connection_debug</span><span id="ast-10" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-11">0</span>)</span>:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">logging</span>.getLogger</span>(<span id="ast-17">'sqlalchemy.engine'</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20" class="other_trans">connection_debug</span><span id="ast-21" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-22">100</span>)</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.setLevel</span>(<span id="ast-27"><span id="ast-28" class="other_trans">logging</span>.DEBUG</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-30">(<span id="ast-31" class="other_trans">connection_debug</span><span id="ast-32" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-33">50</span>)</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.setLevel</span>(<span id="ast-38"><span id="ast-39" class="other_trans">logging</span>.INFO</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.setLevel</span>(<span id="ast-44"><span id="ast-45" class="other_trans">logging</span>.WARNING</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_dichFind(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">needle</span>,&nbsp;<span id="ast-5">currHaystack</span>,&nbsp;<span id="ast-6" class="other_trans">offset</span>,&nbsp;<span id="ast-7" class="other_trans">lst</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"dichotomic&nbsp;search,&nbsp;if&nbsp;lst&nbsp;is&nbsp;None,&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;position&nbsp;found.&nbsp;If&nbsp;it's&nbsp;a&nbsp;list,&nbsp;will&nbsp;return&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;positions&nbsp;in&nbsp;lst.&nbsp;returns&nbsp;-1&nbsp;or&nbsp;[]&nbsp;if&nbsp;no&nbsp;match&nbsp;found"</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14" class="other_trans">len</span>(<span id="ast-15" class="other_trans">currHaystack</span>)</span><span id="ast-16" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-17">1</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-21">(<span id="ast-22">offset</span><span id="ast-23" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">len</span>(<span id="ast-27">self</span>)</span>&nbsp;-&nbsp;<span id="ast-29"><span id="ast-30">len</span>(<span id="ast-31" class="other_trans">needle</span>)</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-32">(<span id="ast-33">(<span id="ast-34"><span id="ast-35">currHaystack</span>[<span id="ast-36"><span id="ast-37">0</span></span>]</span>&nbsp;&amp;&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">needle</span>[<span id="ast-41"><span id="ast-42">0</span></span>]</span>)</span><span id="ast-43" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-44">0</span>)</span>&nbsp;and&nbsp;<span id="ast-45">(<span id="ast-46">(<span id="ast-47"><span id="ast-48">self</span>[<span id="ast-49"><span id="ast-50">(<span id="ast-51">(<span id="ast-52">offset</span>&nbsp;+&nbsp;<span id="ast-54"><span id="ast-55">len</span>(<span id="ast-56" class="other_trans">needle</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-58">1</span>)</span></span>]</span>&nbsp;&amp;&nbsp;<span id="ast-60"><span id="ast-61">needle</span>[<span id="ast-62"><span id="ast-63">-1</span></span>]</span>)</span><span id="ast-64" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-65">0</span>)</span>)</span>:<span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>found</span>&nbsp;=&nbsp;<span id="ast-68">True</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-70">i</span>&nbsp;in&nbsp;<span id="ast-71"><span id="ast-72">xrange</span>(<span id="ast-73">1</span>,&nbsp;<span id="ast-74">(<span id="ast-75"><span id="ast-76">len</span>(<span id="ast-77" class="other_trans">needle</span>)</span>&nbsp;-&nbsp;<span id="ast-79">1</span>)</span>)</span>:<span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-81">(<span id="ast-82">(<span id="ast-83"><span id="ast-84">self</span>[<span id="ast-85"><span id="ast-86">(<span id="ast-87">offset</span>&nbsp;+&nbsp;<span id="ast-89">i</span>)</span></span>]</span>&nbsp;&amp;&nbsp;<span id="ast-91"><span id="ast-92" class="other_trans">needle</span>[<span id="ast-93"><span id="ast-94">i</span></span>]</span>)</span><span id="ast-95" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-96">0</span>)</span>:<span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>found</span>&nbsp;=&nbsp;<span id="ast-99">False</span></span><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-102" class="other_trans">found</span>:<span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-104">(<span id="ast-105" class="other_trans">lst</span><span id="ast-106" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-107">None</span>)</span>:<span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lst</span>.append</span>(<span id="ast-112">offset</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-114" class="other_trans">offset</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-116">(<span id="ast-117" class="other_trans">lst</span><span id="ast-118" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-119">None</span>)</span>:<span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-121">-1</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-123">(<span id="ast-124">offset</span><span id="ast-125" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-126">(<span id="ast-127"><span id="ast-128" class="other_trans">len</span>(<span id="ast-129">self</span>)</span>&nbsp;-&nbsp;<span id="ast-131"><span id="ast-132">len</span>(<span id="ast-133" class="other_trans">needle</span>)</span>)</span>)</span>:<span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-135">(<span id="ast-136" class="other_trans">lst</span><span id="ast-137" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-138">None</span>)</span>:<span id="ast-139"><span id="ast-140"><span id="ast-141"><span id="ast-142"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._dichFind</span>(<span id="ast-143" class="other_trans">needle</span>,&nbsp;<span id="ast-144"><span id="ast-145" class="other_trans">currHaystack</span>[<span id="ast-146">:<span id="ast-147">(<span id="ast-148"><span id="ast-149">len</span>(<span id="ast-150">currHaystack</span>)</span>&nbsp;/&nbsp;<span id="ast-152">2</span>)</span></span>]</span>,&nbsp;<span id="ast-153" class="other_trans">offset</span>,&nbsp;<span id="ast-154">lst</span>)</span></span><span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._dichFind</span>(<span id="ast-159">needle</span>,&nbsp;<span id="ast-160"><span id="ast-161" class="other_trans">currHaystack</span>[<span id="ast-162"><span id="ast-163">(<span id="ast-164"><span id="ast-165">len</span>(<span id="ast-166">currHaystack</span>)</span>&nbsp;/&nbsp;<span id="ast-168">2</span>)</span>:</span>]</span>,&nbsp;<span id="ast-169">(<span id="ast-170" class="other_trans">offset</span>&nbsp;+&nbsp;<span id="ast-172">(<span id="ast-173"><span id="ast-174">len</span>(<span id="ast-175">currHaystack</span>)</span>&nbsp;/&nbsp;<span id="ast-177">2</span>)</span>)</span>,&nbsp;<span id="ast-178" class="other_trans">lst</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-179"><span id="ast-180" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v1</span>&nbsp;=&nbsp;<span id="ast-181"><span id="ast-182"><span id="ast-183">self</span>._dichFind</span>(<span id="ast-184" class="other_trans">needle</span>,&nbsp;<span id="ast-185"><span id="ast-186" class="other_trans">currHaystack</span>[<span id="ast-187">:<span id="ast-188">(<span id="ast-189"><span id="ast-190">len</span>(<span id="ast-191">currHaystack</span>)</span>&nbsp;/&nbsp;<span id="ast-193">2</span>)</span></span>]</span>,&nbsp;<span id="ast-194" class="other_trans">offset</span>,&nbsp;<span id="ast-195" class="other_trans">lst</span>)</span></span><span id="ast-196"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-197">(<span id="ast-198">v1</span><span id="ast-199" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-200">-1</span>)</span>:<span id="ast-201"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-202" class="other_trans">v1</span></span></span><span id="ast-203"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-204"><span id="ast-205"><span id="ast-206">self</span>._dichFind</span>(<span id="ast-207">needle</span>,&nbsp;<span id="ast-208"><span id="ast-209" class="other_trans">currHaystack</span>[<span id="ast-210"><span id="ast-211">(<span id="ast-212"><span id="ast-213" class="other_trans">len</span>(<span id="ast-214" class="other_trans">currHaystack</span>)</span>&nbsp;/&nbsp;<span id="ast-216">2</span>)</span>:</span>]</span>,&nbsp;<span id="ast-217">(<span id="ast-218">offset</span>&nbsp;+&nbsp;<span id="ast-220">(<span id="ast-221"><span id="ast-222">len</span>(<span id="ast-223" class="other_trans">currHaystack</span>)</span>&nbsp;/&nbsp;<span id="ast-225">2</span>)</span>)</span>,&nbsp;<span id="ast-226" class="other_trans">lst</span>)</span></span></span></span><span id="ast-227"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-228">-1</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;sign_now(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">tx</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-7" class="other_trans">inputs</span>,&nbsp;<span id="ast-8" class="other_trans">outputs</span>)</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.btc</span>.get_inputs_outputs</span>(<span id="ast-13" class="other_trans">tx</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rq_hash</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.get_tx_hash</span>(<span id="ast-19" class="other_trans">tx</span>)</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rq_data</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.kv</span>.get_by_section_key</span>(<span id="ast-26">'signable'</span>,&nbsp;<span id="ast-27" class="other_trans">rq_hash</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">rq_data</span><span id="ast-31" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-32">None</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-37">'not&nbsp;scheduled&nbsp;to&nbsp;sign&nbsp;this'</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>inputs</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">rq_data</span>[<span id="ast-43"><span id="ast-44">'inputs'</span></span>]</span></span><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sigs_so_far</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">rq_data</span>[<span id="ast-49"><span id="ast-50">'sigs_so_far'</span></span>]</span></span><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>req_sigs</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">rq_data</span>[<span id="ast-55"><span id="ast-56">'req_sigs'</span></span>]</span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>.is_proper_transaction</span>(<span id="ast-61" class="other_trans">tx</span>,&nbsp;<span id="ast-62" class="other_trans">inputs</span>)</span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tx_sigs_count</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68">self</span>.btc</span>.signatures_number</span>(<span id="ast-69" class="other_trans">tx</span>,&nbsp;<span id="ast-70" class="other_trans">inputs</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-73" class="other_trans">sigs_so_far</span><span id="ast-74" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-75" class="other_trans">tx_sigs_count</span>)</span>:<span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-80">'already&nbsp;signed&nbsp;a&nbsp;transaction&nbsp;with&nbsp;more&nbsp;sigs'</span>)</span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;detect_start_response(<span id="ast-2"><span id="ast-3">status</span>,&nbsp;<span id="ast-4" class="other_trans">headers</span>,&nbsp;<span id="ast-5" class="other_trans">exc_info</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">start_response</span>(<span id="ast-11" class="other_trans">status</span>,&nbsp;<span id="ast-12">headers</span>,&nbsp;<span id="ast-13">exc_info</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span></span></span><span id="ast-21"><span class="whitespace"><br />
</span>try:<span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>__traceback_supplement__</span>&nbsp;=&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">errormiddleware</span>.Supplement</span>,&nbsp;<span id="ast-27">self</span>,&nbsp;<span id="ast-28">environ</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>app_iter</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>.application</span>(<span id="ast-34">environ</span>,&nbsp;<span id="ast-35" class="other_trans">detect_start_response</span>)</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">isinstance</span>(<span id="ast-39" class="other_trans">app_iter</span>,&nbsp;<span id="ast-40"><span id="ast-41">fileapp</span>._FileIter</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-43" class="other_trans">app_iter</span></span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return_iter</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48">list</span>(<span id="ast-49">app_iter</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51" class="other_trans">return_iter</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>finally:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53"><span id="ast-54">hasattr</span>(<span id="ast-55">app_iter</span>,&nbsp;<span id="ast-56">'close'</span>)</span>:<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>app_iter</span>.close</span>()</span></span></span></span><span id="ast-61"><span class="whitespace"><br />
</span>except:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exc_info</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66">sys</span>.exc_info</span>()</span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>registry</span>.restorer</span>.save_registry_state</span>(<span id="ast-72">environ</span>)</span></span><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76" class="other_trans">get_debug_count</span>(<span id="ast-77">environ</span>)</span></span><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>view_uri</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82">self</span>.make_view_url</span>(<span id="ast-83">environ</span>,&nbsp;<span id="ast-84">base_path</span>,&nbsp;<span id="ast-85">count</span>)</span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-87">(<span id="ast-88">not</span>&nbsp;<span id="ast-89" class="other_trans">started</span>)</span>:<span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>&nbsp;=&nbsp;<span id="ast-92">[<span id="ast-93">(<span id="ast-94">'content-type'</span>,&nbsp;<span id="ast-95">'text/html'</span>)</span>]</span></span><span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>.append</span>(<span id="ast-100">(<span id="ast-101">'X-Debug-URL'</span>,&nbsp;<span id="ast-102" class="other_trans">view_uri</span>)</span>)</span></span><span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start_response</span>(<span id="ast-106">'500&nbsp;Internal&nbsp;Server&nbsp;Error'</span>,&nbsp;<span id="ast-107">headers</span>,&nbsp;<span id="ast-108" class="other_trans">exc_info</span>)</span></span></span><span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>environ</span>[<span id="ast-114"><span id="ast-115">'wsgi.errors'</span></span>]</span>.write</span>(<span id="ast-116">(<span id="ast-117">'Debug&nbsp;at:&nbsp;%s\\u000a'</span>&nbsp;%&nbsp;<span id="ast-119" class="other_trans">view_uri</span>)</span>)</span></span><span id="ast-120"><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exc_data</span>&nbsp;=&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans">collector</span>.collect_exception</span>(*<span id="ast-125" class="other_trans">exc_info</span>)</span></span><span id="ast-126"><span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exc_data</span>.view_url</span>&nbsp;=&nbsp;<span id="ast-129" class="other_trans">view_uri</span></span><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-131"><span id="ast-132">self</span>.reporters</span>:<span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-134" class="other_trans">reporter</span>&nbsp;in&nbsp;<span id="ast-135" class="ref_node">reporters&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-136"><span id="ast-137"><span id="ast-138"><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reporter</span>.report</span>(<span id="ast-140" class="other_trans">exc_data</span>)</span></span></span></span><span id="ast-141"><span id="ast-142" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_info</span>&nbsp;=&nbsp;<span id="ast-143"><span id="ast-144">DebugInfo</span>(<span id="ast-145">count</span>,&nbsp;<span id="ast-146" class="other_trans">exc_info</span>,&nbsp;<span id="ast-147" class="incorrect_node">exc_data&nbsp;&rarr;&nbsp;headers&nbsp;</span>,&nbsp;<span id="ast-148" class="other_trans">base_path</span>,&nbsp;<span id="ast-149" class="other_trans">environ</span>,&nbsp;<span id="ast-150" class="other_trans">view_uri</span>,&nbsp;<span id="ast-151"><span id="ast-152">self</span>.error_template</span>,&nbsp;<span id="ast-153"><span id="ast-154">self</span>.templating_formatters</span>,&nbsp;<span id="ast-155"><span id="ast-156">self</span>.head_html</span>,&nbsp;<span id="ast-157"><span id="ast-158">self</span>.footer_html</span>,&nbsp;<span id="ast-159"><span id="ast-160">self</span>.libraries</span>)</span></span><span id="ast-161"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-162">(<span id="ast-163" class="other_trans">count</span><span id="ast-164">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-165"><span id="ast-166">self</span>.debug_infos</span>)</span></span><span id="ast-167"><span id="ast-168"><span id="ast-169"><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.debug_infos</span>[<span id="ast-171"><span id="ast-172">count</span></span>]</span>&nbsp;=&nbsp;<span id="ast-173">debug_info</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;index_children(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">n</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>indexed_children</span>&nbsp;=&nbsp;<span id="ast-7">[]</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-9" class="other_trans">child</span>&nbsp;in&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.get_children</span>(<span id="ast-13" class="other_trans">n</span>)</span>:<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>indexed_children</span>.append</span>(<span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.get_node_id</span>(<span id="ast-21" class="other_trans">child</span>)</span>)</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.index_children</span>(<span id="ast-26" class="correct_node">n&nbsp;&rarr;&nbsp;child&nbsp;</span>)</span></span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.tree_structure_ids</span>[<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34">self</span>.get_node_id</span>(<span id="ast-35" class="other_trans">n</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-36" class="other_trans">indexed_children</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;initialize_TEC(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;for&nbsp;initializing&nbsp;the&nbsp;TEC\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;"waiting&nbsp;for&nbsp;cooldown"&nbsp;time&nbsp;might&nbsp;be&nbsp;too&nbsp;short,&nbsp;but&nbsp;setting&nbsp;it&nbsp;higher&nbsp;would&nbsp;be&nbsp;annoying\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;A&nbsp;standard&nbsp;setpoint&nbsp;of&nbsp;-15&nbsp;degree&nbsp;celcius&nbsp;is&nbsp;choosen,&nbsp;should&nbsp;work&nbsp;for&nbsp;most&nbsp;cases\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>setpoint</span>&nbsp;=&nbsp;<span id="ast-8">-17</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-10">'Attention:&nbsp;If&nbsp;USB&nbsp;power&nbsp;is&nbsp;applied&nbsp;prior&nbsp;to&nbsp;the&nbsp;TEC&nbsp;power,&nbsp;setting&nbsp;the&nbsp;TEC&nbsp;temperature&nbsp;will&nbsp;not&nbsp;be&nbsp;effective.'</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-12">'Initializing&nbsp;TEC:'</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>temp</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.set_TEC_temperature</span>(<span id="ast-18" class="other_trans">setpoint</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-20">(<span id="ast-21">'Setpoint&nbsp;=&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-23" class="other_trans">setpoint</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-25">'Waiting&nbsp;for&nbsp;cooldown'</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-27" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">range</span>(<span id="ast-30">10</span>)</span>:<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-35">1</span>)</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>temp</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">self</span>.get_TEC_temperature</span>()</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-42">(<span id="ast-43">'...&nbsp;Temp.:&nbsp;%s&nbsp;'</span>&nbsp;%&nbsp;<span id="ast-45" class="other_trans">temp</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">temp</span><span id="ast-49" class="incorrect_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-50">(<span id="ast-51" class="other_trans">setpoint</span>&nbsp;-&nbsp;<span id="ast-53">2</span>)</span>)</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">(<span id="ast-57" class="other_trans">temp</span><span id="ast-58" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-59" class="other_trans">setpoint</span>)</span>:<span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-61">'Cooldown&nbsp;complete'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-63">'Cooldown&nbsp;not&nbsp;complete,&nbsp;wait&nbsp;some&nbsp;more&nbsp;seconds&nbsp;before&nbsp;using'</span></span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-65">(<span id="ast-66">'TEC&nbsp;Temperature:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-68" class="other_trans">temp</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-70">'TEC&nbsp;initialized'</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_df_data(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Retrive&nbsp;raw&nbsp;data&nbsp;from&nbsp;df&nbsp;(transformations&nbsp;are&nbsp;performed&nbsp;via&nbsp;df_list_transformation)&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-8">{<span id="ast-9"><span id="ast-10" class="other_trans">PartitionStatCollector</span>.DATA_NAME</span>:&nbsp;<span id="ast-13">[]</span>,&nbsp;<span id="ast-11"><span id="ast-12">PartitionStatCollector</span>.XLOG_NAME</span>:&nbsp;<span id="ast-14">[]</span>}</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.exec_command_with_output</span>(<span id="ast-20"><span id="ast-21"><span id="ast-22">'df&nbsp;-PB&nbsp;{0}&nbsp;{1}&nbsp;{1}/pg_xlog/'</span>.format</span>(<span id="ast-23"><span id="ast-24" class="other_trans">PartitionStatCollector</span>.BLOCK_SIZE</span>,&nbsp;<span id="ast-25"><span id="ast-26">self</span>.work_directory</span>)</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-30">(<span id="ast-31"><span id="ast-32" class="other_trans">ret</span>[<span id="ast-33"><span id="ast-34">0</span></span>]</span><span id="ast-35" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-36">0</span>)</span>&nbsp;or&nbsp;<span id="ast-37">(<span id="ast-38"><span id="ast-39" class="other_trans">ret</span>[<span id="ast-40"><span id="ast-41">1</span></span>]</span><span id="ast-42" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-43" class="other_trans">None</span>)</span>)</span>:<span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-48"><span id="ast-49"><span id="ast-50">'Unable&nbsp;to&nbsp;read&nbsp;data&nbsp;and&nbsp;xlog&nbsp;partition&nbsp;information&nbsp;for&nbsp;the&nbsp;database&nbsp;{0}'</span>.format</span>(<span id="ast-51" class="ref_node">dbname&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>output</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">str</span>(<span id="ast-58"><span id="ast-59" class="other_trans">ret</span>[<span id="ast-60"><span id="ast-61">1</span></span>]</span>)</span>.splitlines</span>()</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63">(<span id="ast-64"><span id="ast-65" class="other_trans">len</span>(<span id="ast-66" class="other_trans">output</span>)</span><span id="ast-67" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-68">2</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans">PartitionStatCollector</span>.DATA_NAME</span></span>]</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans">output</span>[<span id="ast-79"><span id="ast-80">1</span></span>]</span>.split</span>()</span></span><span id="ast-81"><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans">PartitionStatCollector</span>.XLOG_NAME</span></span>]</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans">output</span>[<span id="ast-91"><span id="ast-92">2</span></span>]</span>.split</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-97"><span id="ast-98"><span id="ast-99">'df&nbsp;output&nbsp;looks&nbsp;truncated:&nbsp;{0}'</span>.format</span>(<span id="ast-100" class="other_trans">output</span>)</span>)</span></span></span></span><span id="ast-101"><span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.df_data</span>&nbsp;=&nbsp;<span id="ast-104" class="other_trans">result</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;should_start(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Indicates&nbsp;if&nbsp;this&nbsp;step&nbsp;should&nbsp;be&nbsp;started.'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7" class="correct_node">started_at&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-9">False</span></span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>now</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">datetime</span>.datetime</span>.utcnow</span>()</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>delay_delta</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">datetime</span>.timedelta</span>(seconds=<span id="ast-22"><span id="ast-23"><span id="ast-24">self</span>.step</span>.run_delay</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26">(<span id="ast-27" class="other_trans">now</span><span id="ast-28" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-29">(<span id="ast-30"><span id="ast-31"><span id="ast-32">self</span>.run</span>.started_at</span>&nbsp;+&nbsp;<span id="ast-34" class="other_trans">delay_delta</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;do_changelog(<span id="ast-2"><span id="ast-3" class="other_trans">app</span>,&nbsp;<span id="ast-4">created_models</span>,&nbsp;<span id="ast-5">verbosity</span>,&nbsp;**kwargs</span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>app_models</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9">get_models</span>(<span id="ast-10" class="other_trans">app</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">app_models</span><span id="ast-14" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-15">None</span>)</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sql</span>&nbsp;=&nbsp;<span id="ast-19">()</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-21" class="other_trans">clazz</span>&nbsp;in&nbsp;<span id="ast-22">app_models</span>:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>changelog</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26">getattr</span>(<span id="ast-27">clazz</span>,&nbsp;<span id="ast-28">'changelog'</span>,&nbsp;<span id="ast-29">None</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32">not</span>&nbsp;<span id="ast-33">changelog</span>)</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version</span>&nbsp;=&nbsp;<span id="ast-37" class="other_trans">None</span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>currentversion</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">changelog</span>[<span id="ast-43"><span id="ast-44">-1</span></span>]</span>[<span id="ast-45"><span id="ast-46">0</span></span>]</span></span><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>currentcl</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50">ApplicationChangelog</span>(app_label=<span id="ast-52"><span id="ast-53"><span id="ast-54">clazz</span>._meta</span>.app_label</span>,&nbsp;model=<span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">clazz</span>._meta</span>.object_name</span>.lower</span>()</span>,&nbsp;version=<span id="ast-62">currentversion</span>,&nbsp;applied=<span id="ast-64"><span id="ast-65"><span id="ast-66">datetime</span>.today</span>()</span>)</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-68"><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>appcl</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75">ApplicationChangelog</span>.objects</span>.filter</span>(app_label=<span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans">clazz</span>._meta</span>.app_label</span>,&nbsp;model=<span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">clazz</span>._meta</span>.object_name</span>.lower</span>()</span>)</span>.latest</span>()</span></span><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89">appcl</span>.version</span></span><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-91">(<span id="ast-92">currentversion</span><span id="ast-93" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-94" class="other_trans">version</span>)</span>:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-97"><span id="ast-98">ApplicationChangelog</span>.DoesNotExist</span>:<span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-100">(<span id="ast-101">clazz</span><span id="ast-102">&nbsp;in&nbsp;</span><span id="ast-103" class="other_trans">created_models</span>)</span>:<span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>currentcl</span>.save</span>()</span></span><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-109"><span id="ast-110" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version</span>&nbsp;=&nbsp;<span id="ast-111" class="other_trans">None</span></span></span></span></span><span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-113">change</span>&nbsp;in&nbsp;<span id="ast-114" class="other_trans">changelog</span>:<span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-117" class="other_trans">date</span>,&nbsp;<span id="ast-118">changetype</span>,&nbsp;<span id="ast-119" class="other_trans">stmt</span>)</span>&nbsp;=&nbsp;<span id="ast-120" class="other_trans">change</span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122">(<span id="ast-124">(<span id="ast-125">version</span><span id="ast-126" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-127">None</span>)</span>&nbsp;and&nbsp;<span id="ast-128">(<span id="ast-129">version</span><span id="ast-130" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-131">date</span>)</span>)</span>:<span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-134">(<span id="ast-135" class="other_trans">changetype</span><span id="ast-136" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-137">'alter'</span>)</span>:<span id="ast-138"><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sqlstmt</span>&nbsp;=&nbsp;<span id="ast-140">(<span id="ast-141">'ALTER&nbsp;TABLE&nbsp;%s&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-143">(<span id="ast-144"><span id="ast-145"><span id="ast-146">backend</span>.quote_name</span>(<span id="ast-147"><span id="ast-148"><span id="ast-149">clazz</span>._meta</span>.db_table</span>)</span>,&nbsp;<span id="ast-150">stmt</span>)</span>)</span></span><span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sql</span>&nbsp;+=&nbsp;<span id="ast-154">(<span id="ast-155">sqlstmt</span>)</span></span><span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-157">(<span id="ast-158">'%s:&nbsp;SQL&nbsp;Statement:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-160">(<span id="ast-161">date</span>,&nbsp;<span id="ast-162" class="incorrect_node">sqlstmt&nbsp;&rarr;&nbsp;stmt&nbsp;</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-164">(<span id="ast-165" class="other_trans">changetype</span><span id="ast-166" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-167">'update'</span>)</span>:<span id="ast-168"><span id="ast-169" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sqlstmt</span>&nbsp;=&nbsp;<span id="ast-170">(<span id="ast-171">'UPDATE&nbsp;%s&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-173">(<span id="ast-174"><span id="ast-175"><span id="ast-176" class="other_trans">backend</span>.quote_name</span>(<span id="ast-177"><span id="ast-178"><span id="ast-179">clazz</span>._meta</span>.db_table</span>)</span>,&nbsp;<span id="ast-180">stmt</span>)</span>)</span></span><span id="ast-181"><span id="ast-182" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sql</span>&nbsp;+=&nbsp;<span id="ast-184">(<span id="ast-185" class="other_trans">sqlstmt</span>)</span></span><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-187">(<span id="ast-188">'%s:&nbsp;SQL&nbsp;Statement:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-190">(<span id="ast-191" class="other_trans">date</span>,&nbsp;<span id="ast-192">sqlstmt</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-193"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-194">(<span id="ast-195">'Unknown&nbsp;changetype:&nbsp;%s&nbsp;-&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-197">(<span id="ast-198" class="other_trans">changetype</span>,&nbsp;<span id="ast-199"><span id="ast-200">str</span>(<span id="ast-201" class="other_trans">change</span>)</span>)</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_decode_failsafe(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">data</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>decode</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">self</span>._decode</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">iter</span>(<span id="ast-13" class="other_trans">data</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-15" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-16" class="other_trans">i</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">x</span>[<span id="ast-22"><span id="ast-23">1</span></span>]</span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28" class="other_trans">x</span>[<span id="ast-29"><span id="ast-30">0</span></span>]</span>,&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">decode</span>(<span id="ast-34" class="other_trans">v</span>)</span>[<span id="ast-35"><span id="ast-36">0</span></span>]</span>)</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-38" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-39" class="other_trans">i</span>:<span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">x</span>[<span id="ast-44"><span id="ast-45">1</span></span>]</span></span><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-48">(<span id="ast-49"><span id="ast-50" class="other_trans">x</span>[<span id="ast-51"><span id="ast-52">0</span></span>]</span>,&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">decode</span>(<span id="ast-56" class="other_trans">v</span>)</span>[<span id="ast-57"><span id="ast-58">0</span></span>]</span>)</span></span></span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-60" class="other_trans">UnicodeDecodeError</span>:<span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-63">(<span id="ast-64"><span id="ast-65" class="other_trans">x</span>[<span id="ast-66"><span id="ast-67">0</span></span>]</span>,&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans">repr</span>(<span id="ast-71"><span id="ast-72" class="correct_node">data&nbsp;&rarr;&nbsp;x&nbsp;</span>[<span id="ast-73"><span id="ast-74">1</span></span>]</span>)</span>[<span id="ast-75"><span id="ast-76">2</span>:<span id="ast-77">-1</span></span>]</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_debug(<span id="ast-2"><span id="ast-3" class="other_trans">obj</span>,&nbsp;<span id="ast-4">params</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>&nbsp;=&nbsp;<span id="ast-7">[<span id="ast-8">(<span id="ast-9">'&lt;%s'</span>&nbsp;%&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">obj</span>.__class__</span>.__name__</span>)</span>]</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">k</span>,&nbsp;<span id="ast-17" class="other_trans">v</span>)</span>&nbsp;in&nbsp;<span id="ast-18">params</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20"><span id="ast-21">isinstance</span>(<span id="ast-22" class="other_trans">v</span>,&nbsp;<span id="ast-23">(<span id="ast-24">list</span>,&nbsp;<span id="ast-25">tuple</span>)</span>)</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.append</span>(<span id="ast-30">(<span id="ast-31">'len(%s)=%d'</span>&nbsp;%&nbsp;<span id="ast-33">(<span id="ast-34" class="other_trans">k</span>,&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">len</span>(<span id="ast-37">v</span>)</span>)</span>)</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39"><span id="ast-40">len</span>(<span id="ast-41">v</span>)</span>:<span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>k</span>&nbsp;=&nbsp;<span id="ast-44">(<span id="ast-45">'%s[0]'</span>&nbsp;%&nbsp;<span id="ast-47">k</span>)</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">v</span>[<span id="ast-52"><span id="ast-53">0</span></span>]</span></span></span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55" class="other_trans">v</span>:<span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57"><span id="ast-58">isinstance</span>(<span id="ast-59" class="other_trans">v</span>,&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">format</span>.NetworkAddress</span>)</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>text</span>&nbsp;=&nbsp;<span id="ast-64">(<span id="ast-65">'%s:%d'</span>&nbsp;%&nbsp;<span id="ast-67">(<span id="ast-68"><span id="ast-69" class="other_trans">v</span>.address</span>,&nbsp;<span id="ast-70"><span id="ast-71" class="other_trans">v</span>.port</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-73"><span id="ast-74" class="other_trans">isinstance</span>(<span id="ast-75" class="other_trans">v</span>,&nbsp;<span id="ast-76"><span id="ast-77" class="other_trans">format</span>.InventoryVector</span>)</span>:<span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>obj_type</span>&nbsp;=&nbsp;<span id="ast-80">'unknown'</span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-82">(<span id="ast-83"><span id="ast-84">v</span>.object_type</span><span id="ast-85" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-86">2</span>)</span>:<span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>obj_type</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90">[<span id="ast-91">'error'</span>,&nbsp;<span id="ast-92">'tx'</span>,&nbsp;<span id="ast-93">'block'</span>]</span>[<span id="ast-94"><span id="ast-95"><span id="ast-96">v</span>.object_type</span></span>]</span></span></span><span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>text</span>&nbsp;=&nbsp;<span id="ast-99">(<span id="ast-100">'%s:%s'</span>&nbsp;%&nbsp;<span id="ast-102">(<span id="ast-103">obj_type</span>,&nbsp;<span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans">v</span>.hash</span>.encode</span>(<span id="ast-108">'hex'</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-110"><span id="ast-111">isinstance</span>(<span id="ast-112" class="other_trans">v</span>,&nbsp;<span id="ast-113"><span id="ast-114" class="other_trans">format</span>.Txn</span>)</span>:<span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>text</span>&nbsp;=&nbsp;<span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120">v</span>.hash</span>.encode</span>(<span id="ast-121">'hex'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>text</span>&nbsp;=&nbsp;<span id="ast-124"><span id="ast-125">str</span>(<span id="ast-126" class="other_trans">v</span>)</span></span></span><span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.append</span>(<span id="ast-131">(<span id="ast-132">'%s=%s'</span>&nbsp;%&nbsp;<span id="ast-134">(<span id="ast-135" class="other_trans">k</span>,&nbsp;<span id="ast-136">text</span>)</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;randomBatch(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">batch_size</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;corresponding&nbsp;states,&nbsp;actions,&nbsp;rewards,&nbsp;terminal&nbsp;status,&nbsp;and&nbsp;next_states&nbsp;for&nbsp;batch_size&nbsp;randomly&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;chosen&nbsp;state&nbsp;transitions.&nbsp;Note&nbsp;that&nbsp;if&nbsp;terminal[i]&nbsp;==&nbsp;True,&nbsp;then&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;next_states[input][i]&nbsp;==&nbsp;np.zeros_like(states[input][i])&nbsp;for&nbsp;all&nbsp;\'input\'s.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Arguments:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;batch_size&nbsp;-&nbsp;Number&nbsp;of&nbsp;elements&nbsp;in&nbsp;the&nbsp;batch.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;states&nbsp;-&nbsp;An&nbsp;ndarray(size=number_of_inputs,&nbsp;dtype=\'object),&nbsp;where&nbsp;states[input]&nbsp;is&nbsp;a&nbsp;2+D&nbsp;matrix&nbsp;of&nbsp;dimensions\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;batch_size&nbsp;x&nbsp;input.historySize&nbsp;x&nbsp;"shape&nbsp;of&nbsp;a&nbsp;given&nbsp;ponctual&nbsp;observation&nbsp;for&nbsp;this&nbsp;input".&nbsp;States&nbsp;were\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;taken&nbsp;randomly&nbsp;in&nbsp;the&nbsp;data&nbsp;set&nbsp;such&nbsp;that&nbsp;they&nbsp;are&nbsp;complete&nbsp;regarding&nbsp;the&nbsp;histories&nbsp;of&nbsp;each&nbsp;input.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actions&nbsp;-&nbsp;The&nbsp;actions&nbsp;taken&nbsp;in&nbsp;each&nbsp;of&nbsp;those&nbsp;states.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rewards&nbsp;-&nbsp;The&nbsp;rewards&nbsp;obtained&nbsp;for&nbsp;taking&nbsp;these&nbsp;actions&nbsp;in&nbsp;those&nbsp;states.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next_states&nbsp;-&nbsp;Same&nbsp;structure&nbsp;than&nbsp;states,&nbsp;but&nbsp;next_states[i][j]&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;the&nbsp;information&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;concerning&nbsp;the&nbsp;state&nbsp;following&nbsp;the&nbsp;one&nbsp;described&nbsp;by&nbsp;states[i][j]&nbsp;for&nbsp;input&nbsp;i.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminals&nbsp;-&nbsp;Whether&nbsp;these&nbsp;actions&nbsp;lead&nbsp;to&nbsp;terminal&nbsp;states.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Throws:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SliceError&nbsp;-&nbsp;If&nbsp;a&nbsp;batch&nbsp;of&nbsp;this&nbsp;size&nbsp;could&nbsp;not&nbsp;be&nbsp;built&nbsp;based&nbsp;on&nbsp;current&nbsp;data&nbsp;set&nbsp;(not&nbsp;enough&nbsp;data&nbsp;or&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;trajectories&nbsp;are&nbsp;too&nbsp;short).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rndValidIndices</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">np</span>.zeros</span>(<span id="ast-12" class="other_trans">batch_size</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-14" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">range</span>(<span id="ast-17" class="other_trans">batch_size</span>)</span>:<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rndValidIndices</span>[<span id="ast-21"><span id="ast-22" class="other_trans">i</span></span>]</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="ref_node">_randomValidStateIndex&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>actions</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>._actions</span>[<span id="ast-30"><span id="ast-31" class="incorrect_node">rndValidIndices&nbsp;&rarr;&nbsp;batch_size&nbsp;</span></span>]</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rewards</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36">self</span>._rewards</span>[<span id="ast-37"><span id="ast-38" class="other_trans">rndValidIndices</span></span>]</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>terminals</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43">self</span>._terminals</span>[<span id="ast-44"><span id="ast-45" class="other_trans">rndValidIndices</span></span>]</span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>states</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">np</span>.zeros</span>(<span id="ast-51"><span id="ast-52" class="other_trans">len</span>(<span id="ast-53" class="other_trans">history_sizes</span>)</span>,&nbsp;dtype=<span id="ast-55">'object'</span>)</span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>next_states</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">np</span>.zeros_like</span>(<span id="ast-61" class="other_trans">states</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;blog_post_list(<span id="ast-2"><span id="ast-3">request</span>,&nbsp;<span id="ast-4">tag</span>,&nbsp;<span id="ast-6">year</span>,&nbsp;<span id="ast-8" class="other_trans">month</span>,&nbsp;<span id="ast-10" class="other_trans">username</span>,&nbsp;<span id="ast-12">category</span>,&nbsp;<span id="ast-14">template</span>,&nbsp;<span id="ast-16">extra_context</span></span>):<span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Display&nbsp;a&nbsp;list&nbsp;of&nbsp;blog&nbsp;posts&nbsp;that&nbsp;are&nbsp;filtered&nbsp;by&nbsp;tag,&nbsp;year,&nbsp;month,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;author&nbsp;or&nbsp;category.&nbsp;Custom&nbsp;templates&nbsp;are&nbsp;checked&nbsp;for&nbsp;using&nbsp;the&nbsp;name\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``blog/blog_post_list_XXX.html``&nbsp;where&nbsp;``XXX``&nbsp;is&nbsp;either&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;category&nbsp;slug&nbsp;or&nbsp;author's&nbsp;username&nbsp;if&nbsp;given.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>templates</span>&nbsp;=&nbsp;<span id="ast-22">[]</span></span><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>blog_posts</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28">BlogPost</span>.objects</span>.published</span>(for_user=<span id="ast-30"><span id="ast-31" class="other_trans">request</span>.user</span>)</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34" class="other_trans">tag</span><span id="ast-35" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-36">None</span>)</span>:<span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tag</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40">get_object_or_404</span>(<span id="ast-41">Keyword</span>,&nbsp;slug=<span id="ast-43" class="other_trans">tag</span>)</span></span><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>blog_posts</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48">blog_posts</span>.filter</span>(keywords__keyword=<span id="ast-50">tag</span>)</span></span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52">(<span id="ast-53" class="other_trans">year</span><span id="ast-54" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-55" class="other_trans">None</span>)</span>:<span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>blog_posts</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">blog_posts</span>.filter</span>(publish_date__year=<span id="ast-62">year</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65">month</span><span id="ast-66" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-67" class="other_trans">None</span>)</span>:<span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>blog_posts</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72">blog_posts</span>.filter</span>(publish_date__month=<span id="ast-74" class="other_trans">month</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>month</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79">month_name</span>[<span id="ast-80"><span id="ast-81"><span id="ast-82">int</span>(<span id="ast-83">month</span>)</span></span>]</span></span><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-85">IndexError</span>:<span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-87"><span id="ast-88" class="other_trans">Http404</span>()</span></span></span></span></span></span><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-90">(<span id="ast-91" class="other_trans">category</span><span id="ast-92" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-93">None</span>)</span>:<span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>category</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97" class="other_trans">get_object_or_404</span>(<span id="ast-98">BlogCategory</span>,&nbsp;slug=<span id="ast-100">category</span>)</span></span><span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>blog_posts</span>&nbsp;=&nbsp;<span id="ast-103"><span id="ast-104"><span id="ast-105">blog_posts</span>.filter</span>(categories=<span id="ast-107" class="other_trans">category</span>)</span></span><span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>templates</span>.append</span>(<span id="ast-112">(<span id="ast-113">u'blog/blog_post_list_%s.html'</span>&nbsp;%&nbsp;<span id="ast-115"><span id="ast-116">str</span>(<span id="ast-117"><span id="ast-118" class="other_trans">category</span>.slug</span>)</span>)</span>)</span></span></span><span id="ast-119"><span id="ast-120" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>author</span>&nbsp;=&nbsp;<span id="ast-121" class="other_trans">None</span></span><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-123">(<span id="ast-124">username</span><span id="ast-125" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-126" class="other_trans">None</span>)</span>:<span id="ast-127"><span id="ast-128" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>author</span>&nbsp;=&nbsp;<span id="ast-129"><span id="ast-130">get_object_or_404</span>(<span id="ast-131">User</span>,&nbsp;username=<span id="ast-133" class="other_trans">username</span>)</span></span><span id="ast-134"><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>blog_posts</span>&nbsp;=&nbsp;<span id="ast-136"><span id="ast-137"><span id="ast-138" class="other_trans">blog_posts</span>.filter</span>(user=<span id="ast-140">author</span>)</span></span><span id="ast-141"><span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>templates</span>.append</span>(<span id="ast-145">(<span id="ast-146">u'blog/blog_post_list_%s.html'</span>&nbsp;%&nbsp;<span id="ast-148" class="other_trans">username</span>)</span>)</span></span></span><span id="ast-149"><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>prefetch</span>&nbsp;=&nbsp;<span id="ast-151">(<span id="ast-152">'categories'</span>,&nbsp;<span id="ast-153">'keywords__keyword'</span>)</span></span><span id="ast-154"><span id="ast-155" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>blog_posts</span>&nbsp;=&nbsp;<span id="ast-156"><span id="ast-157"><span id="ast-158"><span id="ast-159"><span id="ast-160" class="other_trans">blog_posts</span>.select_related</span>(<span id="ast-161">'user'</span>)</span>.prefetch_related</span>(*<span id="ast-162">prefetch</span>)</span></span><span id="ast-163"><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>blog_posts</span>&nbsp;=&nbsp;<span id="ast-165"><span id="ast-166">paginate</span>(<span id="ast-167">blog_posts</span>,&nbsp;<span id="ast-168"><span id="ast-169"><span id="ast-170"><span id="ast-171">request</span>.GET</span>.get</span>(<span id="ast-172">'page'</span>,&nbsp;<span id="ast-173">1</span>)</span>,&nbsp;<span id="ast-174"><span id="ast-175">settings</span>.BLOG_POST_PER_PAGE</span>,&nbsp;<span id="ast-176"><span id="ast-177">settings</span>.MAX_PAGING_LINKS</span>)</span></span><span id="ast-178"><span id="ast-179"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>&nbsp;=&nbsp;<span id="ast-180">{<span id="ast-181">'blog_posts'</span>:&nbsp;<span id="ast-187" class="other_trans">blog_posts</span>,&nbsp;<span id="ast-182">'year'</span>:&nbsp;<span id="ast-188" class="other_trans">year</span>,&nbsp;<span id="ast-183">'month'</span>:&nbsp;<span id="ast-189">month</span>,&nbsp;<span id="ast-184">'tag'</span>:&nbsp;<span id="ast-190" class="other_trans">tag</span>,&nbsp;<span id="ast-185">'category'</span>:&nbsp;<span id="ast-191">category</span>,&nbsp;<span id="ast-186">'author'</span>:&nbsp;<span id="ast-192">author</span>}</span></span><span id="ast-193"><span id="ast-194"><span id="ast-195"><span id="ast-196"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>.update</span>(<span id="ast-197">(<span id="ast-199">extra_context</span>&nbsp;or&nbsp;<span id="ast-200">{}</span>)</span>)</span></span><span id="ast-201"><span id="ast-202"><span id="ast-203"><span id="ast-204"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>templates</span>.append</span>(<span id="ast-205" class="incorrect_node">template&nbsp;&rarr;&nbsp;templates&nbsp;</span>)</span></span><span id="ast-206"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-207"><span id="ast-208" class="other_trans">TemplateResponse</span>(<span id="ast-209" class="other_trans">request</span>,&nbsp;<span id="ast-210" class="ref_node">template&nbsp;&rarr;&nbsp;templates&nbsp;</span>,&nbsp;<span id="ast-211">context</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;wrapper(<span id="ast-2">*args,&nbsp;**kwargs</span>):<span id="ast-3"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-4">(<span id="ast-5">not</span>&nbsp;<span id="ast-6"><span id="ast-7">g</span>.user</span>)</span>:<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">url_for</span>(<span id="ast-12">'account.signin'</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15">'?'</span><span id="ast-16">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-17">url</span>)</span>:<span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;+=&nbsp;<span id="ast-21">(<span id="ast-22">'?next='</span>&nbsp;+&nbsp;<span id="ast-24"><span id="ast-25">request</span>.url</span>)</span></span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">redirect</span>(<span id="ast-29">url</span>)</span></span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32"><span id="ast-33">self</span>.role</span><span id="ast-34" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-35" class="other_trans">None</span>)</span>:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">method</span>(*<span id="ast-39" class="other_trans">args</span>,&nbsp;**<span id="ast-40" class="other_trans">kwargs</span>)</span></span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">g</span>.user</span>.id</span><span id="ast-46" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-47">1</span>)</span>:<span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">method</span>(*<span id="ast-51">args</span>,&nbsp;**<span id="ast-52" class="other_trans">kwargs</span>)</span></span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54">(<span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">g</span>.user</span>.role</span><span id="ast-58" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-59">'admin'</span>)</span>:<span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">method</span>(*<span id="ast-63" class="other_trans">args</span>,&nbsp;**<span id="ast-64">kwargs</span>)</span></span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66">(<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">g</span>.user</span>.role</span><span id="ast-70" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-71">'new'</span>)</span>:<span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>flash</span>(<span id="ast-75"><span id="ast-76" class="other_trans">_</span>(<span id="ast-77">'Please&nbsp;verify&nbsp;your&nbsp;email'</span>)</span>,&nbsp;<span id="ast-78">'warn'</span>)</span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-80"><span id="ast-81">redirect</span>(<span id="ast-82">'/account/settings'</span>)</span></span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans">g</span>.user</span>.role</span><span id="ast-88" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-89">'spam'</span>)</span>:<span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-91"><span id="ast-92">redirect</span>(<span id="ast-93">'/doc/guideline'</span>)</span></span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95">(<span id="ast-96"><span id="ast-97"><span id="ast-98">g</span>.user</span>.role</span><span id="ast-99" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-100"><span id="ast-101">self</span>.role</span>)</span>:<span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-103"><span id="ast-104" class="other_trans">abort</span>(<span id="ast-105">403</span>)</span></span></span><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-107"><span id="ast-108" class="other_trans">method</span>(*<span id="ast-109" class="other_trans">args</span>,&nbsp;**<span id="ast-110">kwargs</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;fetch(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">low_mark</span>,&nbsp;<span id="ast-5" class="other_trans">high_mark</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8" class="other_trans">None</span><span id="ast-9" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-10"><span id="ast-11">self</span>.root_predicate</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">Exception</span>(<span id="ast-15">'No&nbsp;root&nbsp;query&nbsp;node'</span>)</span></span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.low_mark</span>&nbsp;=&nbsp;<span id="ast-19" class="other_trans">low_mark</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.high_mark</span>&nbsp;=&nbsp;<span id="ast-23" class="other_trans">high_mark</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-27">(<span id="ast-28" class="other_trans">high_mark</span><span id="ast-29" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-30" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-31">(<span id="ast-32" class="incorrect_node">low_mark&nbsp;&rarr;&nbsp;high_mark&nbsp;</span><span id="ast-33" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-34" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-35">(<span id="ast-36" class="other_trans">high_mark</span><span id="ast-37" class="ref_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-38" class="other_trans">low_mark</span>)</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">Exception</span>(<span id="ast-42">"Can't&nbsp;slice&nbsp;query&nbsp;high_mark&nbsp;&gt;&nbsp;low_mark"</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;cover(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span>,&nbsp;<span id="ast-4" class="other_trans">bits</span>,&nbsp;<span id="ast-5" class="other_trans">wildcard_probability</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Create&nbsp;a&nbsp;new&nbsp;bit&nbsp;condition&nbsp;that&nbsp;matches&nbsp;the&nbsp;provided&nbsp;bit&nbsp;string,&nbsp;with&nbsp;the&nbsp;indicated&nbsp;per-index&nbsp;wildcard\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;probability.'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10">not</span>&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">isinstance</span>(<span id="ast-13" class="other_trans">bits</span>,&nbsp;<span id="ast-14" class="other_trans">BitString</span>)</span>)</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bits</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">BitString</span>(<span id="ast-19" class="other_trans">bits</span>)</span></span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mask</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">BitString</span>(<span id="ast-24">[<span id="ast-25">(<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">random</span>.random</span>()</span><span id="ast-29" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-30" class="other_trans">wildcard_probability</span>)</span><span id="ast-31">&nbsp;for&nbsp;<span id="ast-32" class="other_trans">_</span>&nbsp;in&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">range</span>(<span id="ast-35"><span id="ast-36" class="other_trans">len</span>(<span id="ast-37" class="other_trans">bits</span>)</span>)</span></span>]</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">cls</span>(<span id="ast-41" class="other_trans">bits</span>,&nbsp;<span id="ast-42" class="other_trans">mask</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;render_to_string(<span id="ast-2"><span id="ast-3" class="other_trans">template_name</span>,&nbsp;<span id="ast-4" class="other_trans">dictionary</span>,&nbsp;<span id="ast-6" class="other_trans">context_instance</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Loads&nbsp;the&nbsp;given&nbsp;``template_name``&nbsp;and&nbsp;renders&nbsp;it&nbsp;with&nbsp;the&nbsp;given\\u000a&nbsp;&nbsp;&nbsp;&nbsp;dictionary&nbsp;as&nbsp;context.&nbsp;The&nbsp;``template_name``&nbsp;may&nbsp;be&nbsp;a&nbsp;string&nbsp;to&nbsp;load\\u000a&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;single&nbsp;template&nbsp;using&nbsp;``get_template``,&nbsp;or&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;tuple&nbsp;to&nbsp;use\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``select_template``&nbsp;to&nbsp;find&nbsp;one&nbsp;of&nbsp;the&nbsp;templates&nbsp;in&nbsp;the&nbsp;list.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``dictionary``&nbsp;may&nbsp;also&nbsp;be&nbsp;Django&nbsp;``Context``&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;a&nbsp;string.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dictionary</span>&nbsp;=&nbsp;<span id="ast-12">(<span id="ast-14" class="other_trans">dictionary</span>&nbsp;or&nbsp;<span id="ast-15">{}</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17"><span id="ast-18">isinstance</span>(<span id="ast-19" class="other_trans">template_name</span>,&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">list</span>,&nbsp;<span id="ast-22" class="other_trans">tuple</span>)</span>)</span>:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>template</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26" class="other_trans">select_template</span>(<span id="ast-27" class="other_trans">template_name</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>template</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">get_template</span>(<span id="ast-32" class="other_trans">template_name</span>)</span></span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34" class="other_trans">context_instance</span>:<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>context_instance</span>.update</span>(<span id="ast-39" class="other_trans">dictionary</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>context_instance</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">Context</span>(<span id="ast-44" class="other_trans">dictionary</span>)</span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">template</span>.render</span>(<span id="ast-49" class="correct_node">dictionary&nbsp;&rarr;&nbsp;context_instance&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;pid_exists(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">pid</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Check&nbsp;For&nbsp;the&nbsp;existence&nbsp;of&nbsp;a&nbsp;unix&nbsp;pid.'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">pid</span><span id="ast-10" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-11">0</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-13">False</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;lookup_local_name(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">addr</span>,&nbsp;<span id="ast-5" class="other_trans">slot</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-7" class="other_trans">info</span>&nbsp;in&nbsp;<span id="ast-8"><span id="ast-9">self</span>.variable_info</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13" class="other_trans">info</span>.start_addr</span><span id="ast-14" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-15" class="other_trans">addr</span>)</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19"><span id="ast-20" class="other_trans">info</span>.end_addr</span><span id="ast-21" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-22" class="other_trans">addr</span>)</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-25">(<span id="ast-26" class="other_trans">slot</span><span id="ast-27" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-28">0</span>)</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-30" class="other_trans">info</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>slot</span>&nbsp;-=&nbsp;<span id="ast-34">1</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;detect_start_response(<span id="ast-2"><span id="ast-3" class="other_trans">status</span>,&nbsp;<span id="ast-4" class="other_trans">headers</span>,&nbsp;<span id="ast-5" class="other_trans">exc_info</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-9"><span id="ast-10">start_response</span>(<span id="ast-11">status</span>,&nbsp;<span id="ast-12">headers</span>,&nbsp;<span id="ast-13" class="other_trans">exc_info</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span></span></span><span id="ast-21"><span class="whitespace"><br />
</span>try:<span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>__traceback_supplement__</span>&nbsp;=&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26">errormiddleware</span>.Supplement</span>,&nbsp;<span id="ast-27">self</span>,&nbsp;<span id="ast-28" class="other_trans">environ</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>app_iter</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>.application</span>(<span id="ast-34">environ</span>,&nbsp;<span id="ast-35" class="other_trans">detect_start_response</span>)</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">isinstance</span>(<span id="ast-39">app_iter</span>,&nbsp;<span id="ast-40"><span id="ast-41">fileapp</span>._FileIter</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-43">app_iter</span></span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return_iter</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48">list</span>(<span id="ast-49" class="other_trans">app_iter</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51" class="other_trans">return_iter</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>finally:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53"><span id="ast-54">hasattr</span>(<span id="ast-55">app_iter</span>,&nbsp;<span id="ast-56">'close'</span>)</span>:<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>app_iter</span>.close</span>()</span></span></span></span><span id="ast-61"><span class="whitespace"><br />
</span>except:<span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exc_info</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66">sys</span>.exc_info</span>()</span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>registry</span>.restorer</span>.save_registry_state</span>(<span id="ast-72">environ</span>)</span></span><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76">get_debug_count</span>(<span id="ast-77">environ</span>)</span></span><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>view_uri</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82">self</span>.make_view_url</span>(<span id="ast-83">environ</span>,&nbsp;<span id="ast-84" class="other_trans">base_path</span>,&nbsp;<span id="ast-85" class="other_trans">count</span>)</span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-87">(<span id="ast-88">not</span>&nbsp;<span id="ast-89">started</span>)</span>:<span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>&nbsp;=&nbsp;<span id="ast-92">[<span id="ast-93">(<span id="ast-94">'content-type'</span>,&nbsp;<span id="ast-95">'text/html'</span>)</span>]</span></span><span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>.append</span>(<span id="ast-100">(<span id="ast-101">'X-Debug-URL'</span>,&nbsp;<span id="ast-102" class="other_trans">view_uri</span>)</span>)</span></span><span id="ast-103"><span id="ast-104"><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start_response</span>(<span id="ast-106">'500&nbsp;Internal&nbsp;Server&nbsp;Error'</span>,&nbsp;<span id="ast-107">headers</span>,&nbsp;<span id="ast-108" class="other_trans">exc_info</span>)</span></span></span><span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>environ</span>[<span id="ast-114"><span id="ast-115">'wsgi.errors'</span></span>]</span>.write</span>(<span id="ast-116">(<span id="ast-117">'Debug&nbsp;at:&nbsp;%s\\u000a'</span>&nbsp;%&nbsp;<span id="ast-119">view_uri</span>)</span>)</span></span><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exc_data</span>&nbsp;=&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans">collector</span>.collect_exception</span>(*<span id="ast-125" class="other_trans">exc_info</span>)</span></span><span id="ast-126"><span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exc_data</span>.view_url</span>&nbsp;=&nbsp;<span id="ast-129" class="other_trans">view_uri</span></span><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-131"><span id="ast-132">self</span>.reporters</span>:<span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-134" class="other_trans">reporter</span>&nbsp;in&nbsp;<span id="ast-135" class="ref_node">reporters&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-136"><span id="ast-137"><span id="ast-138"><span id="ast-139" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reporter</span>.report</span>(<span id="ast-140">exc_data</span>)</span></span></span></span><span id="ast-141"><span id="ast-142"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_info</span>&nbsp;=&nbsp;<span id="ast-143"><span id="ast-144" class="other_trans">DebugInfo</span>(<span id="ast-145" class="other_trans">count</span>,&nbsp;<span id="ast-146">exc_info</span>,&nbsp;<span id="ast-147" class="incorrect_node">exc_data&nbsp;&rarr;&nbsp;headers&nbsp;</span>,&nbsp;<span id="ast-148">base_path</span>,&nbsp;<span id="ast-149" class="other_trans">environ</span>,&nbsp;<span id="ast-150" class="other_trans">view_uri</span>,&nbsp;<span id="ast-151"><span id="ast-152">self</span>.error_template</span>,&nbsp;<span id="ast-153"><span id="ast-154">self</span>.templating_formatters</span>,&nbsp;<span id="ast-155"><span id="ast-156">self</span>.head_html</span>,&nbsp;<span id="ast-157"><span id="ast-158">self</span>.footer_html</span>,&nbsp;<span id="ast-159"><span id="ast-160">self</span>.libraries</span>)</span></span><span id="ast-161"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-162">(<span id="ast-163" class="other_trans">count</span><span id="ast-164">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-165"><span id="ast-166">self</span>.debug_infos</span>)</span></span><span id="ast-167"><span id="ast-168"><span id="ast-169"><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.debug_infos</span>[<span id="ast-171"><span id="ast-172" class="other_trans">count</span></span>]</span>&nbsp;=&nbsp;<span id="ast-173">debug_info</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;install_passport(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logIt</span>(<span id="ast-8">'Installing&nbsp;npm&nbsp;and&nbsp;Node.Js...'</span>)</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logIt</span>(<span id="ast-13">'Installing&nbsp;Passport...'</span>)</span></span><span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logIt</span>(<span id="ast-18">'Preparing&nbsp;Passport&nbsp;OpenID&nbsp;RP&nbsp;certificate...'</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>passport_rp_client_jwks_json</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans">json</span>.loads</span>(<span id="ast-24"><span id="ast-25"><span id="ast-26">''</span>.join</span>(<span id="ast-27"><span id="ast-28">self</span>.passport_rp_client_jwks</span>)</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-30" class="other_trans">jwks_key</span>&nbsp;in&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">passport_rp_client_jwks_json</span>[<span id="ast-33"><span id="ast-34">'keys'</span></span>]</span>:<span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37"><span id="ast-38" class="other_trans">jwks_key</span>[<span id="ast-39"><span id="ast-40">'alg'</span></span>]</span><span id="ast-41" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-42" class="correct_node">passport_rp_client_cert_alg&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.passport_rp_client_cert_alias</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">jwks_key</span>[<span id="ast-48"><span id="ast-49">'kid'</span></span>]</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">container_id</span>,&nbsp;<span id="ast-5" class="other_trans">attributes</span>,&nbsp;<span id="ast-7" class="other_trans">connection</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Initialize&nbsp;a&nbsp;Container&nbsp;by&nbsp;providing&nbsp;a&nbsp;container&nbsp;name/id.&nbsp;The&nbsp;attributes&nbsp;and&nbsp;connection&nbsp;parameters&nbsp;are&nbsp;generally\\u000a&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;specified&nbsp;unless&nbsp;one&nbsp;wants&nbsp;to&nbsp;manually&nbsp;initialize&nbsp;the&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;container_id:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Container&nbsp;name&nbsp;or&nbsp;id&nbsp;in&nbsp;string&nbsp;form\\u000a&nbsp;&nbsp;&nbsp;&nbsp;attributes:&nbsp;Optional[dict]\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attributes&nbsp;of&nbsp;the&nbsp;container\\u000a&nbsp;&nbsp;&nbsp;&nbsp;connection:&nbsp;Optional[transcriptic.config.Connection]\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Connection&nbsp;context.&nbsp;The&nbsp;default&nbsp;context&nbsp;object&nbsp;will&nbsp;be&nbsp;used&nbsp;unless&nbsp;explicitly&nbsp;provided\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-16" class="other_trans">Container</span>,&nbsp;<span id="ast-17">self</span>)</span>.__init__</span>(<span id="ast-18">'container'</span>,&nbsp;<span id="ast-19" class="other_trans">container_id</span>,&nbsp;<span id="ast-20" class="other_trans">attributes</span>,&nbsp;<span id="ast-21" class="other_trans">connection</span>)</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.id</span>&nbsp;=&nbsp;<span id="ast-25" class="other_trans">container_id</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.name</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31">self</span>.attributes</span>[<span id="ast-32"><span id="ast-33">'label'</span></span>]</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.well_map</span>&nbsp;=&nbsp;<span id="ast-37">{<span id="ast-38"><span id="ast-39" class="other_trans">aliquot</span>[<span id="ast-40"><span id="ast-41">'well_idx'</span></span>]</span>:&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">aliquot</span>[<span id="ast-44"><span id="ast-45">'name'</span></span>]</span><span id="ast-46">&nbsp;for&nbsp;<span id="ast-47" class="other_trans">aliquot</span>&nbsp;in&nbsp;<span id="ast-48"><span id="ast-49" class="location_node">attributes&nbsp;&rarr;&nbsp;self.,&nbsp;pred:&nbsp;container_id&nbsp;</span>[<span id="ast-50"><span id="ast-51">'aliquots'</span></span>]</span></span>}</span></span><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.container_type</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">self</span>._parse_container_type</span>()</span></span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._aliquots</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">pd</span>.DataFrame</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">form_list</span>,&nbsp;<span id="ast-5" class="other_trans">initial</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Start&nbsp;a&nbsp;new&nbsp;wizard&nbsp;with&nbsp;a&nbsp;list&nbsp;of&nbsp;forms.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;form_list&nbsp;should&nbsp;be&nbsp;a&nbsp;list&nbsp;of&nbsp;Form&nbsp;classes&nbsp;(not&nbsp;instances).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.form_list</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">form_list</span>[<span id="ast-14">:</span>]</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.initial</span>&nbsp;=&nbsp;<span id="ast-18">(<span id="ast-20" class="other_trans">initial</span>&nbsp;or&nbsp;<span id="ast-21">{}</span>)</span></span><span id="ast-22"><span id="ast-23" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>extra_context&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-24">{}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;create_new_team_request(<span id="ast-2"><span id="ast-3" class="other_trans">params</span>,&nbsp;<span id="ast-4" class="other_trans">uid</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Fulfills&nbsp;new&nbsp;team&nbsp;requests&nbsp;for&nbsp;users&nbsp;who&nbsp;have&nbsp;already&nbsp;registered.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;team_name:&nbsp;The&nbsp;desired&nbsp;name&nbsp;for&nbsp;the&nbsp;team.&nbsp;Must&nbsp;be&nbsp;unique&nbsp;across&nbsp;users&nbsp;and&nbsp;teams.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;team_password:&nbsp;The&nbsp;team's&nbsp;password.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;True&nbsp;if&nbsp;successful,&nbsp;exception&nbsp;thrown&nbsp;elsewise.&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>validate</span>(<span id="ast-11" class="other_trans">new_team_schema</span>,&nbsp;<span id="ast-12" class="other_trans">params</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">api</span>.user</span>.get_user</span>(uid=<span id="ast-20" class="other_trans">uid</span>)</span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_team</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">api</span>.team</span>.get_team</span>(tid=<span id="ast-28"><span id="ast-29" class="other_trans">user</span>[<span id="ast-30"><span id="ast-31">'tid'</span></span>]</span>)</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34"><span id="ast-35" class="other_trans">current_team</span>[<span id="ast-36"><span id="ast-37">'team_name'</span></span>]</span><span id="ast-38" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-39"><span id="ast-40" class="other_trans">user</span>[<span id="ast-41"><span id="ast-42">'username'</span></span>]</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">InternalException</span>(<span id="ast-46">'You&nbsp;can&nbsp;only&nbsp;create&nbsp;one&nbsp;new&nbsp;team&nbsp;per&nbsp;user&nbsp;account!'</span>)</span></span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>desired_tid</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">create_team</span>(<span id="ast-51">{<span id="ast-52">'team_name'</span>:&nbsp;<span id="ast-56"><span id="ast-57" class="other_trans">params</span>[<span id="ast-58"><span id="ast-59">'team_name'</span></span>]</span>,&nbsp;<span id="ast-53">'password'</span>:&nbsp;<span id="ast-60"><span id="ast-61" class="incorrect_node">params&nbsp;&rarr;&nbsp;user&nbsp;</span>[<span id="ast-62"><span id="ast-63">'team_password'</span></span>]</span>,&nbsp;<span id="ast-54">'affiliation'</span>:&nbsp;<span id="ast-64"><span id="ast-65" class="ref_node">user&nbsp;&rarr;&nbsp;current_team&nbsp;</span>[<span id="ast-66"><span id="ast-67">'affiliation'</span></span>]</span>,&nbsp;<span id="ast-55">'eligible'</span>:&nbsp;<span id="ast-68">True</span>}</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3" class="other_trans">args</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-9"><span id="ast-10" class="other_trans">args</span>.file</span>)</span>:<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>generator</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">Generator</span>(<span id="ast-15"><span id="ast-16" class="other_trans">args</span>.file</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>build_failed</span>&nbsp;=&nbsp;<span id="ast-19">False</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>export_failed</span>&nbsp;=&nbsp;<span id="ast-22">False</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-24" class="other_trans">project</span>&nbsp;in&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">generator</span>.generate</span>(<span id="ast-28"><span id="ast-29" class="other_trans">args</span>.project</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">project</span>.export</span>(<span id="ast-35"><span id="ast-36" class="other_trans">args</span>.tool</span>,&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">args</span>.copy</span>)</span><span id="ast-39" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-40">-1</span>)</span>:<span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>export_failed</span>&nbsp;=&nbsp;<span id="ast-43">True</span></span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">project</span>.build</span>(<span id="ast-49"><span id="ast-50" class="other_trans">args</span>.tool</span>)</span><span id="ast-51" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-52">-1</span>)</span>:<span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>build_failed</span>&nbsp;=&nbsp;<span id="ast-55">True</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;handle_asset(<span id="ast-2"><span id="ast-3" class="other_trans">asset</span>,&nbsp;<span id="ast-4" class="other_trans">textures</span>,&nbsp;<span id="ast-5" class="other_trans">cards</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-7" class="other_trans">obj</span>&nbsp;in&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">asset</span>.objects</span>.values</span>()</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15" class="other_trans">obj</span>.type</span><span id="ast-16" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-17">'AssetBundle'</span>)</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">obj</span>.read</span>()</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-24">(<span id="ast-25" class="other_trans">path</span>,&nbsp;<span id="ast-26" class="other_trans">obj</span>)</span>&nbsp;in&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">d</span>[<span id="ast-29"><span id="ast-30">'m_Container'</span></span>]</span>:<span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">path</span>.lower</span>()</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>asset</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39">obj</span>[<span id="ast-40"><span id="ast-41">'asset'</span></span>]</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-44">not</span>&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">path</span>.startswith</span>(<span id="ast-48">'final/'</span>)</span>)</span>:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-51">(<span id="ast-52">'final/'</span>&nbsp;+&nbsp;<span id="ast-54" class="other_trans">path</span>)</span></span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">(<span id="ast-57">not</span>&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">path</span>.startswith</span>(<span id="ast-61">'final/assets'</span>)</span>)</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>textures</span>[<span id="ast-66"><span id="ast-67">path</span></span>]</span>&nbsp;=&nbsp;<span id="ast-68" class="other_trans">asset</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-70">(<span id="ast-71"><span id="ast-72" class="other_trans">obj</span>.type</span><span id="ast-73" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-74">'GameObject'</span>)</span>:<span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79" class="incorrect_node">obj&nbsp;&rarr;&nbsp;asset&nbsp;</span>.read</span>()</span></span><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cardid</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83">d</span>.name</span></span><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-85">(<span id="ast-86">cardid</span><span id="ast-87">&nbsp;in&nbsp;</span><span id="ast-88">(<span id="ast-89">'CardDefTemplate'</span>,&nbsp;<span id="ast-90">'HiddenCard'</span>)</span>)</span>:<span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cards</span>[<span id="ast-94"><span id="ast-95">cardid</span></span>]</span>&nbsp;=&nbsp;<span id="ast-96">{<span id="ast-97">'path'</span>:&nbsp;<span id="ast-99">''</span>,&nbsp;<span id="ast-98">'tile'</span>:&nbsp;<span id="ast-100">''</span>}</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-103">(<span id="ast-104"><span id="ast-105" class="other_trans">len</span>(<span id="ast-106"><span id="ast-107">d</span>.component</span>)</span><span id="ast-108" class="ref_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-109">2</span>)</span>:<span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-111"><span id="ast-112" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>carddef</span>&nbsp;=&nbsp;<span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans">d</span>.component</span>[<span id="ast-119"><span id="ast-120">1</span></span>]</span>[<span id="ast-121"><span id="ast-122">1</span></span>]</span>.resolve</span>()</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124">(<span id="ast-126">(<span id="ast-127">not</span>&nbsp;<span id="ast-128"><span id="ast-129" class="other_trans">isinstance</span>(<span id="ast-130" class="other_trans">carddef</span>,&nbsp;<span id="ast-131">dict</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-132">(<span id="ast-133">'m_PortraitTexturePath'</span><span id="ast-134">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-135" class="other_trans">carddef</span>)</span>)</span>:<span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-137"><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-139"><span id="ast-140" class="other_trans">carddef</span>[<span id="ast-141"><span id="ast-142">'m_PortraitTexturePath'</span></span>]</span></span><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-144">path</span>:<span id="ast-145"><span id="ast-146" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-147">(<span id="ast-148">'final/'</span>&nbsp;+&nbsp;<span id="ast-150" class="other_trans">path</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;dispatch(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;*args,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.customer</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">valid_manager_for_organization</span>(<span id="ast-9"><span id="ast-10" class="correct_node">request&nbsp;&rarr;&nbsp;self.&nbsp;</span>.user</span>,&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.kwargs</span>.get</span>(<span id="ast-15">'organization_id'</span>)</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">super</span>(<span id="ast-21" class="other_trans">TransactionListView</span>,&nbsp;<span id="ast-22">self</span>)</span>.dispatch</span>(*<span id="ast-23" class="other_trans">args</span>,&nbsp;**<span id="ast-24" class="other_trans">kwargs</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">default_weight</span>,&nbsp;<span id="ast-6">substrate_shape</span>,&nbsp;<span id="ast-10">noise</span>,&nbsp;<span id="ast-12" class="other_trans">max_weight</span>,&nbsp;<span id="ast-14" class="other_trans">funcs</span></span>):<span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.substrate_shape</span>&nbsp;=&nbsp;<span id="ast-19">substrate_shape</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.max_weight</span>&nbsp;=&nbsp;<span id="ast-23" class="other_trans">max_weight</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-26">not</span>&nbsp;<span id="ast-27">(<span id="ast-28">0</span><span id="ast-29" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-31" class="other_trans">noise</span><span id="ast-30" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-32">1</span>)</span>)</span>:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">Exception</span>(<span id="ast-36">'Noise&nbsp;value&nbsp;has&nbsp;to&nbsp;be&nbsp;between&nbsp;0&nbsp;and&nbsp;1.'</span>)</span></span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cm_shape</span>&nbsp;=&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41" class="other_trans">list</span>(<span id="ast-42" class="other_trans">substrate_shape</span>)</span>&nbsp;+&nbsp;<span id="ast-44"><span id="ast-45">list</span>(<span id="ast-46" class="other_trans">substrate_shape</span>)</span>)</span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>coords</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">np</span>.mgrid</span>[<span id="ast-52"><span id="ast-53">[<span id="ast-54"><span id="ast-55">slice</span>(<span id="ast-56">-1</span>,&nbsp;<span id="ast-57">1</span>,&nbsp;<span id="ast-58">(<span id="ast-59" class="other_trans">s</span>&nbsp;*&nbsp;<span id="ast-61">1j</span>)</span>)</span><span id="ast-62">&nbsp;for&nbsp;<span id="ast-63" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-64">cm_shape</span></span>]</span></span>]</span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cm</span>&nbsp;=&nbsp;<span id="ast-67">(<span id="ast-68"><span id="ast-69"><span id="ast-70">np</span>.ones</span>(<span id="ast-71" class="other_trans">cm_shape</span>)</span>&nbsp;*&nbsp;<span id="ast-73" class="other_trans">default_weight</span>)</span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-75">(<span id="ast-76" class="other_trans">where</span>,&nbsp;<span id="ast-77">what</span>)</span>&nbsp;in&nbsp;<span id="ast-78" class="other_trans">funcs</span>:<span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mask</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82" class="other_trans">where</span>(<span id="ast-83" class="other_trans">coords</span>)</span></span><span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vals</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-87" class="other_trans">what</span>(<span id="ast-88">coords</span>)</span></span><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cm</span>[<span id="ast-92"><span id="ast-93">mask</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-95"><span id="ast-96" class="other_trans">vals</span>[<span id="ast-97"><span id="ast-98" class="other_trans">mask</span></span>]</span></span></span><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mask</span>&nbsp;=&nbsp;<span id="ast-101">(<span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105">np</span>.random</span>.random</span>(<span id="ast-106"><span id="ast-107">cm</span>.shape</span>)</span><span id="ast-108" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-109">noise</span>)</span></span><span id="ast-110"><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>random_weights</span>&nbsp;=&nbsp;<span id="ast-112">(<span id="ast-113">(<span id="ast-114">(<span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118">np</span>.random</span>.random</span>(<span id="ast-119"><span id="ast-120">cm</span>.shape</span>)</span>&nbsp;*&nbsp;<span id="ast-122">max_weight</span>)</span>&nbsp;*&nbsp;<span id="ast-124">2</span>)</span>&nbsp;-&nbsp;<span id="ast-126" class="other_trans">max_weight</span>)</span></span><span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cm</span>[<span id="ast-130"><span id="ast-131" class="other_trans">mask</span></span>]</span>&nbsp;=&nbsp;<span id="ast-132"><span id="ast-133" class="other_trans">random_weights</span>[<span id="ast-134"><span id="ast-135">mask</span></span>]</span></span><span id="ast-136"><span id="ast-137"><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.target</span>&nbsp;=&nbsp;<span id="ast-139"><span id="ast-140"><span id="ast-141" class="other_trans">cm</span>.reshape</span>(<span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans">np</span>.product</span>(<span id="ast-145">substrate_shape</span>)</span>,&nbsp;<span id="ast-146"><span id="ast-147"><span id="ast-148">np</span>.product</span>(<span id="ast-149" class="incorrect_node">substrate_shape&nbsp;&rarr;&nbsp;cm&nbsp;</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_min_provisioned_reads(<span id="ast-2"><span id="ast-3" class="other_trans">current_provisioning</span>,&nbsp;<span id="ast-4" class="other_trans">table_name</span>,&nbsp;<span id="ast-5" class="other_trans">table_key</span>,&nbsp;<span id="ast-6" class="other_trans">gsi_name</span>,&nbsp;<span id="ast-7" class="other_trans">gsi_key</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Returns&nbsp;the&nbsp;minimum&nbsp;provisioned&nbsp;reads\\u000a&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;min_provisioned_reads&nbsp;value&nbsp;is&nbsp;less&nbsp;than&nbsp;current_provisioning&nbsp;*&nbsp;2,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;we&nbsp;return&nbsp;current_provisioning&nbsp;*&nbsp;2,&nbsp;as&nbsp;DynamoDB&nbsp;cannot&nbsp;be&nbsp;scaled&nbsp;up\\u000a&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;more&nbsp;than&nbsp;100%.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;current_provisioning:&nbsp;int\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;current_provisioning:&nbsp;The&nbsp;current&nbsp;provisioning\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;table_name:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;table_name:&nbsp;Name&nbsp;of&nbsp;the&nbsp;DynamoDB&nbsp;table\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;table_key:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;table_key:&nbsp;Table&nbsp;configuration&nbsp;option&nbsp;key&nbsp;name\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;gsi_name:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;gsi_name:&nbsp;Name&nbsp;of&nbsp;the&nbsp;GSI\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;gsi_key:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;gsi_key:&nbsp;Name&nbsp;of&nbsp;the&nbsp;key\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:returns:&nbsp;int&nbsp;--&nbsp;Minimum&nbsp;provisioned&nbsp;reads\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>min_provisioned_reads</span>&nbsp;=&nbsp;<span id="ast-12">1</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">get_gsi_option</span>(<span id="ast-16" class="other_trans">table_key</span>,&nbsp;<span id="ast-17" class="other_trans">gsi_key</span>,&nbsp;<span id="ast-18">'min_provisioned_reads'</span>)</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>min_provisioned_reads</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22">int</span>(<span id="ast-23"><span id="ast-24" class="other_trans">get_gsi_option</span>(<span id="ast-25" class="other_trans">table_key</span>,&nbsp;<span id="ast-26" class="other_trans">gsi_key</span>,&nbsp;<span id="ast-27">'min_provisioned_reads'</span>)</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">min_provisioned_reads</span><span id="ast-31" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-32"><span id="ast-33" class="other_trans">int</span>(<span id="ast-34">(<span id="ast-35" class="other_trans">current_provisioning</span>&nbsp;*&nbsp;<span id="ast-37">2</span>)</span>)</span>)</span>:<span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>min_provisioned_reads</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">int</span>(<span id="ast-42">(<span id="ast-43" class="incorrect_node">current_provisioning&nbsp;&rarr;&nbsp;min_provisioned_reads&nbsp;</span>&nbsp;*&nbsp;<span id="ast-45">2</span>)</span>)</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.debug</span>(<span id="ast-50"><span id="ast-51"><span id="ast-52">'{0}&nbsp;-&nbsp;GSI:&nbsp;{1}&nbsp;-&nbsp;Cannot&nbsp;reach&nbsp;min_provisioned_reads&nbsp;as&nbsp;max&nbsp;scale&nbsp;up&nbsp;is&nbsp;100%&nbsp;of&nbsp;current&nbsp;provisioning'</span>.format</span>(<span id="ast-53" class="other_trans">table_name</span>,&nbsp;<span id="ast-54" class="other_trans">gsi_name</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_get_entropy(<span id="ast-2"><span id="ast-3">annotated_beats</span>,&nbsp;<span id="ast-4" class="other_trans">generated_beats</span>,&nbsp;<span id="ast-5">bins</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Helper&nbsp;function&nbsp;for&nbsp;information&nbsp;gain\\u000a&nbsp;&nbsp;&nbsp;&nbsp;(needs&nbsp;to&nbsp;be&nbsp;run&nbsp;twice&nbsp;-&nbsp;once&nbsp;backwards,&nbsp;once&nbsp;forwards)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Input:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotated_beats&nbsp;-&nbsp;np.ndarray&nbsp;of&nbsp;reference&nbsp;beat&nbsp;times,&nbsp;in&nbsp;seconds\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generated_beats&nbsp;-&nbsp;np.ndarray&nbsp;of&nbsp;query&nbsp;beat&nbsp;times,&nbsp;in&nbsp;seconds\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bins&nbsp;-&nbsp;Number&nbsp;of&nbsp;bins&nbsp;in&nbsp;the&nbsp;beat&nbsp;error&nbsp;histogram\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Output:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entropy&nbsp;-&nbsp;Entropy&nbsp;of&nbsp;beat&nbsp;error&nbsp;histogram\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>beat_error</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">np</span>.zeros</span>(<span id="ast-13"><span id="ast-14"><span id="ast-15">generated_beats</span>.shape</span>[<span id="ast-16"><span id="ast-17">0</span></span>]</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-19" class="other_trans">n</span>&nbsp;in&nbsp;<span id="ast-20"><span id="ast-21">xrange</span>(<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">generated_beats</span>.shape</span>[<span id="ast-25"><span id="ast-26">0</span></span>]</span>)</span>:<span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>beat_distances</span>&nbsp;=&nbsp;<span id="ast-29">(<span id="ast-30"><span id="ast-31" class="other_trans">generated_beats</span>[<span id="ast-32"><span id="ast-33" class="other_trans">n</span></span>]</span>&nbsp;-&nbsp;<span id="ast-35" class="other_trans">annotated_beats</span>)</span></span><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>closest_beat</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">np</span>.argmin</span>(<span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans">np</span>.abs</span>(<span id="ast-44" class="other_trans">beat_distances</span>)</span>)</span></span><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>absolute_error</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">beat_distances</span>[<span id="ast-49"><span id="ast-50" class="other_trans">closest_beat</span></span>]</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52">(<span id="ast-53">closest_beat</span><span id="ast-54" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-55">0</span>)</span>:<span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>interval</span>&nbsp;=&nbsp;<span id="ast-58">(<span id="ast-59">0.5</span>&nbsp;*&nbsp;<span id="ast-61">(<span id="ast-62"><span id="ast-63">annotated_beats</span>[<span id="ast-64"><span id="ast-65">1</span></span>]</span>&nbsp;-&nbsp;<span id="ast-67"><span id="ast-68">annotated_beats</span>[<span id="ast-69"><span id="ast-70">0</span></span>]</span>)</span>)</span></span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-73" class="other_trans">closest_beat</span><span id="ast-74" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-75">(<span id="ast-76"><span id="ast-77"><span id="ast-78">annotated_beats</span>.shape</span>[<span id="ast-79"><span id="ast-80">0</span></span>]</span>&nbsp;-&nbsp;<span id="ast-82">1</span>)</span>)</span>:<span id="ast-83"><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>interval</span>&nbsp;=&nbsp;<span id="ast-85">(<span id="ast-86">0.5</span>&nbsp;*&nbsp;<span id="ast-88">(<span id="ast-89"><span id="ast-90" class="other_trans">annotated_beats</span>[<span id="ast-91"><span id="ast-92">-1</span></span>]</span>&nbsp;-&nbsp;<span id="ast-94"><span id="ast-95" class="other_trans">annotated_beats</span>[<span id="ast-96"><span id="ast-97">-2</span></span>]</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-99">(<span id="ast-100">absolute_error</span><span id="ast-101" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-102">0</span>)</span>:<span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106">annotated_beats</span>[<span id="ast-107"><span id="ast-108" class="other_trans">closest_beat</span></span>]</span></span><span id="ast-109"><span id="ast-110" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-111"><span id="ast-112">annotated_beats</span>[<span id="ast-113"><span id="ast-114">(<span id="ast-115" class="other_trans">closest_beat</span>&nbsp;-&nbsp;<span id="ast-117">1</span>)</span></span>]</span></span><span id="ast-118"><span id="ast-119" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>interval</span>&nbsp;=&nbsp;<span id="ast-120">(<span id="ast-121">0.5</span>&nbsp;*&nbsp;<span id="ast-123">(<span id="ast-124">start</span>&nbsp;-&nbsp;<span id="ast-126" class="other_trans">end</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start</span>&nbsp;=&nbsp;<span id="ast-129"><span id="ast-130">annotated_beats</span>[<span id="ast-131"><span id="ast-132">(<span id="ast-133">closest_beat</span>&nbsp;+&nbsp;<span id="ast-135">1</span>)</span></span>]</span></span><span id="ast-136"><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-138"><span id="ast-139">annotated_beats</span>[<span id="ast-140"><span id="ast-141">closest_beat</span></span>]</span></span><span id="ast-142"><span id="ast-143" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>interval</span>&nbsp;=&nbsp;<span id="ast-144">(<span id="ast-145">0.5</span>&nbsp;*&nbsp;<span id="ast-147">(<span id="ast-148" class="other_trans">start</span>&nbsp;-&nbsp;<span id="ast-150" class="other_trans">end</span>)</span>)</span></span></span><span id="ast-151"><span id="ast-152"><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>beat_error</span>[<span id="ast-154"><span id="ast-155">n</span></span>]</span>&nbsp;=&nbsp;<span id="ast-156">(<span id="ast-157">(<span id="ast-158">0.5</span>&nbsp;*&nbsp;<span id="ast-160" class="other_trans">absolute_error</span>)</span>&nbsp;/&nbsp;<span id="ast-162" class="other_trans">interval</span>)</span></span></span><span id="ast-163"><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>beat_error</span>&nbsp;=&nbsp;<span id="ast-165">(<span id="ast-166"><span id="ast-167"><span id="ast-168" class="other_trans">np</span>.round</span>(<span id="ast-169">(<span id="ast-170">10000</span>&nbsp;*&nbsp;<span id="ast-172" class="other_trans">beat_error</span>)</span>)</span>&nbsp;/&nbsp;<span id="ast-174">10000.0</span>)</span></span><span id="ast-175"><span id="ast-176" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>beat_error</span>&nbsp;=&nbsp;<span id="ast-177">(<span id="ast-178"><span id="ast-179"><span id="ast-180">np</span>.mod</span>(<span id="ast-181">(<span id="ast-182" class="other_trans">beat_error</span>&nbsp;+&nbsp;<span id="ast-184">0.5</span>)</span>,&nbsp;<span id="ast-185">-1</span>)</span>&nbsp;+&nbsp;<span id="ast-187">0.5</span>)</span></span><span id="ast-188"><span id="ast-189"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>bin_step</span>&nbsp;=&nbsp;<span id="ast-190">(<span id="ast-191">1.0</span>&nbsp;/&nbsp;<span id="ast-193">(<span id="ast-194" class="other_trans">bins</span>&nbsp;-&nbsp;<span id="ast-196">1.0</span>)</span>)</span></span><span id="ast-197"><span id="ast-198"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>histogram_bins</span>&nbsp;=&nbsp;<span id="ast-199"><span id="ast-200"><span id="ast-201">np</span>.arange</span>(<span id="ast-202">-0.5</span>,&nbsp;<span id="ast-203">(<span id="ast-204">0.5</span>&nbsp;+&nbsp;<span id="ast-206">bin_step</span>)</span>,&nbsp;<span id="ast-207" class="other_trans">bin_step</span>)</span></span><span id="ast-208"><span id="ast-209" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raw_bin_values</span>&nbsp;=&nbsp;<span id="ast-210"><span id="ast-211"><span id="ast-212"><span id="ast-213">np</span>.histogram</span>(<span id="ast-214">beat_error</span>,&nbsp;<span id="ast-215">histogram_bins</span>)</span>[<span id="ast-216"><span id="ast-217">0</span></span>]</span></span><span id="ast-218"><span id="ast-219"><span id="ast-220"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raw_bin_values</span>[<span id="ast-221"><span id="ast-222">0</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-224"><span id="ast-225">raw_bin_values</span>[<span id="ast-226"><span id="ast-227">-1</span></span>]</span></span><span id="ast-228"><span id="ast-229"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raw_bin_values</span>&nbsp;=&nbsp;<span id="ast-230">(<span id="ast-231">raw_bin_values</span>&nbsp;/&nbsp;<span id="ast-233">(<span id="ast-234">1.0</span>&nbsp;*&nbsp;<span id="ast-236"><span id="ast-237"><span id="ast-238">np</span>.sum</span>(<span id="ast-239">raw_bin_values</span>)</span>)</span>)</span></span><span id="ast-240"><span id="ast-241"><span id="ast-242"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raw_bin_values</span>[<span id="ast-243"><span id="ast-244">(<span id="ast-245" class="other_trans">raw_bin_values</span><span id="ast-246" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-247">0</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-248">1</span></span><span id="ast-249"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-250">(<span id="ast-251">-</span><span id="ast-252"><span id="ast-253"><span id="ast-254">np</span>.sum</span>(<span id="ast-255">(<span id="ast-256" class="other_trans">raw_bin_values</span>&nbsp;*&nbsp;<span id="ast-258"><span id="ast-259"><span id="ast-260" class="other_trans">np</span>.log2</span>(<span id="ast-261" class="other_trans">raw_bin_values</span>)</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_underapproximate_attractor(<span id="ast-2"><span id="ast-3" class="other_trans">P1</span>,&nbsp;<span id="ast-4" class="other_trans">P2</span>,&nbsp;<span id="ast-5" class="other_trans">ssys</span>,&nbsp;<span id="ast-6" class="other_trans">N</span>,&nbsp;<span id="ast-7" class="other_trans">trans_set</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Under-approximate&nbsp;N-step&nbsp;attractor&nbsp;of&nbsp;polytope&nbsp;P2,&nbsp;with&nbsp;N&nbsp;&gt;&nbsp;0.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;See&nbsp;docstring&nbsp;of&nbsp;function&nbsp;`_solve_closed_loop_fixed_horizon`\\u000a&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;details.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">N</span><span id="ast-14" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-15">0</span>)</span>,&nbsp;<span id="ast-16" class="other_trans">N</span></span><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>_print_horizon_warning</span>()</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>p1</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">P1</span>.copy</span>()</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>p2</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">P2</span>.copy</span>()</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">trans_set</span><span id="ast-33" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-34" class="other_trans">None</span>)</span>:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pinit</span>&nbsp;=&nbsp;<span id="ast-37" class="other_trans">p1</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pinit</span>&nbsp;=&nbsp;<span id="ast-40">trans_set</span></span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-42" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">xrange</span>(<span id="ast-45" class="other_trans">N</span>,&nbsp;<span id="ast-46">0</span>,&nbsp;<span id="ast-47">-1</span>)</span>:<span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-50" class="other_trans">i</span><span id="ast-51" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-52">1</span>)</span>:<span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pinit</span>&nbsp;=&nbsp;<span id="ast-55" class="other_trans">p1</span></span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59" class="other_trans">solve_open_loop</span>(<span id="ast-60" class="other_trans">pinit</span>,&nbsp;<span id="ast-61" class="other_trans">p2</span>,&nbsp;<span id="ast-62">ssys</span>,&nbsp;<span id="ast-63">1</span>,&nbsp;<span id="ast-64" class="other_trans">trans_set</span>)</span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p2</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">p2</span>.union</span>(<span id="ast-70">r</span>,&nbsp;check_convex=<span id="ast-72">True</span>)</span></span><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p2</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77">pc</span>.reduce</span>(<span id="ast-78" class="other_trans">p2</span>)</span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-80">(<span id="ast-81">not</span>&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans">pc</span>.is_fulldim</span>(<span id="ast-85" class="other_trans">p2</span>)</span>)</span>:<span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89" class="other_trans">pc</span>.Polytope</span>()</span></span></span></span><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-91" class="ref_node">p2&nbsp;&rarr;&nbsp;r&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;discriminator(<span id="ast-2"><span id="ast-3" class="other_trans">config</span>,&nbsp;<span id="ast-4" class="other_trans">x</span>,&nbsp;<span id="ast-5" class="other_trans">z</span>,&nbsp;<span id="ast-6" class="other_trans">g</span>,&nbsp;<span id="ast-7" class="other_trans">gz</span>,&nbsp;<span id="ast-8" class="other_trans">reuse</span></span>):<span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>x_dims</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">config</span>[<span id="ast-14"><span id="ast-15">'x_dims'</span></span>]</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">reuse</span>:<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tf</span>.get_variable_scope</span>()</span>.reuse_variables</span>()</span></span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>batch_size</span>&nbsp;=&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28">config</span>[<span id="ast-29"><span id="ast-30">'batch_size'</span></span>]</span>&nbsp;*&nbsp;<span id="ast-32">2</span>)</span></span><span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>single_batch_size</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36">config</span>[<span id="ast-37"><span id="ast-38">'batch_size'</span></span>]</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>x</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43">tf</span>.concat</span>(<span id="ast-44">0</span>,&nbsp;<span id="ast-45">[<span id="ast-46" class="other_trans">x</span>,&nbsp;<span id="ast-47" class="other_trans">g</span>]</span>)</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>z</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52">tf</span>.concat</span>(<span id="ast-53">0</span>,&nbsp;<span id="ast-54">[<span id="ast-55" class="other_trans">z</span>,&nbsp;<span id="ast-56">gz</span>]</span>)</span></span><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>x</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61">tf</span>.reshape</span>(<span id="ast-62">x</span>,&nbsp;<span id="ast-63">[<span id="ast-64" class="other_trans">batch_size</span>,&nbsp;<span id="ast-65">-1</span>,&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">config</span>[<span id="ast-68"><span id="ast-69">'channels'</span></span>]</span>]</span>)</span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-71"><span id="ast-72">config</span>[<span id="ast-73"><span id="ast-74">'d_add_noise'</span></span>]</span>:<span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>x</span>&nbsp;+=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80">tf</span>.random_normal</span>(<span id="ast-81"><span id="ast-82"><span id="ast-83">x</span>.get_shape</span>()</span>,&nbsp;mean=<span id="ast-85">0</span>,&nbsp;stddev=<span id="ast-87">0.1</span>)</span></span></span><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>channels</span>&nbsp;=&nbsp;<span id="ast-90">(<span id="ast-91"><span id="ast-92" class="other_trans">config</span>[<span id="ast-93"><span id="ast-94">'channels'</span></span>]</span>&nbsp;+&nbsp;<span id="ast-96">1</span>)</span></span><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-99"><span id="ast-100">build_reshape</span>(<span id="ast-101"><span id="ast-102">int</span>(<span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106">x</span>.get_shape</span>()</span>[<span id="ast-107"><span id="ast-108">1</span></span>]</span>)</span>,&nbsp;<span id="ast-109">[<span id="ast-110" class="other_trans">z</span>]</span>,&nbsp;<span id="ast-111"><span id="ast-112">config</span>[<span id="ast-113"><span id="ast-114">'d_project'</span></span>]</span>,&nbsp;<span id="ast-115" class="incorrect_node">batch_size&nbsp;&rarr;&nbsp;g&nbsp;</span>)</span></span><span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-118"><span id="ast-119"><span id="ast-120">tf</span>.reshape</span>(<span id="ast-121">result</span>,&nbsp;<span id="ast-122">[<span id="ast-123">batch_size</span>,&nbsp;<span id="ast-124">-1</span>,&nbsp;<span id="ast-125">1</span>]</span>)</span></span><span id="ast-126"><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-128"><span id="ast-129"><span id="ast-130">tf</span>.concat</span>(<span id="ast-131">2</span>,&nbsp;<span id="ast-132">[<span id="ast-133">result</span>,&nbsp;<span id="ast-134"><span id="ast-135"><span id="ast-136">tf</span>.reshape</span>(<span id="ast-137" class="other_trans">x</span>,&nbsp;<span id="ast-138">[<span id="ast-139" class="other_trans">batch_size</span>,&nbsp;<span id="ast-140">-1</span>,&nbsp;<span id="ast-141">(<span id="ast-142">channels</span>&nbsp;-&nbsp;<span id="ast-144">1</span>)</span>]</span>)</span>]</span>)</span></span><span id="ast-145"><span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-147"><span id="ast-148"><span id="ast-149">tf</span>.reshape</span>(<span id="ast-150" class="other_trans">result</span>,&nbsp;<span id="ast-151">[<span id="ast-152">batch_size</span>,&nbsp;<span id="ast-153"><span id="ast-154" class="other_trans">x_dims</span>[<span id="ast-155"><span id="ast-156">0</span></span>]</span>,&nbsp;<span id="ast-157"><span id="ast-158" class="other_trans">x_dims</span>[<span id="ast-159"><span id="ast-160">1</span></span>]</span>,&nbsp;<span id="ast-161">channels</span>]</span>)</span></span><span id="ast-162"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-163"><span id="ast-164">config</span>[<span id="ast-165"><span id="ast-166">'conv_d_layers'</span></span>]</span>:<span id="ast-167"><span id="ast-168"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-169"><span id="ast-170" class="other_trans">build_conv_tower</span>(<span id="ast-171" class="other_trans">result</span>,&nbsp;<span id="ast-172"><span id="ast-173"><span id="ast-174">config</span>[<span id="ast-175"><span id="ast-176">'conv_d_layers'</span></span>]</span>[<span id="ast-177">:<span id="ast-178">2</span></span>]</span>,&nbsp;<span id="ast-179"><span id="ast-180">config</span>[<span id="ast-181"><span id="ast-182">'d_pre_res_filter'</span></span>]</span>,&nbsp;<span id="ast-183"><span id="ast-184">config</span>[<span id="ast-185"><span id="ast-186">'batch_size'</span></span>]</span>,&nbsp;<span id="ast-187"><span id="ast-188">config</span>[<span id="ast-189"><span id="ast-190">'d_batch_norm'</span></span>]</span>,&nbsp;<span id="ast-191">True</span>,&nbsp;<span id="ast-192">'d_'</span>,&nbsp;<span id="ast-193"><span id="ast-194">config</span>[<span id="ast-195"><span id="ast-196">'d_activation'</span></span>]</span>)</span></span><span id="ast-197"><span id="ast-198" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-199"><span id="ast-200"><span id="ast-201" class="other_trans">config</span>[<span id="ast-202"><span id="ast-203">'d_activation'</span></span>]</span>(<span id="ast-204" class="other_trans">result</span>)</span></span><span id="ast-205"><span id="ast-206"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-207"><span id="ast-208">build_resnet</span>(<span id="ast-209" class="other_trans">result</span>,&nbsp;<span id="ast-210"><span id="ast-211">config</span>[<span id="ast-212"><span id="ast-213">'d_resnet_depth'</span></span>]</span>,&nbsp;<span id="ast-214"><span id="ast-215" class="other_trans">config</span>[<span id="ast-216"><span id="ast-217">'d_resnet_filter'</span></span>]</span>,&nbsp;<span id="ast-218">'d_conv_res_'</span>,&nbsp;<span id="ast-219"><span id="ast-220" class="other_trans">config</span>[<span id="ast-221"><span id="ast-222">'d_activation'</span></span>]</span>,&nbsp;<span id="ast-223"><span id="ast-224">config</span>[<span id="ast-225"><span id="ast-226">'batch_size'</span></span>]</span>,&nbsp;<span id="ast-227"><span id="ast-228">config</span>[<span id="ast-229"><span id="ast-230">'d_batch_norm'</span></span>]</span>,&nbsp;conv=<span id="ast-232">True</span>)</span></span><span id="ast-233"><span id="ast-234" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-235"><span id="ast-236">build_conv_tower</span>(<span id="ast-237">result</span>,&nbsp;<span id="ast-238"><span id="ast-239"><span id="ast-240">config</span>[<span id="ast-241"><span id="ast-242">'conv_d_layers'</span></span>]</span>[<span id="ast-243"><span id="ast-244">2</span>:</span>]</span>,&nbsp;<span id="ast-245"><span id="ast-246" class="other_trans">config</span>[<span id="ast-247"><span id="ast-248">'d_conv_size'</span></span>]</span>,&nbsp;<span id="ast-249"><span id="ast-250" class="other_trans">config</span>[<span id="ast-251"><span id="ast-252">'batch_size'</span></span>]</span>,&nbsp;<span id="ast-253"><span id="ast-254">config</span>[<span id="ast-255"><span id="ast-256">'d_batch_norm'</span></span>]</span>,&nbsp;<span id="ast-257"><span id="ast-258" class="other_trans">config</span>[<span id="ast-259"><span id="ast-260">'d_batch_norm_last_layer'</span></span>]</span>,&nbsp;<span id="ast-261">'d_2_'</span>,&nbsp;<span id="ast-262"><span id="ast-263">config</span>[<span id="ast-264"><span id="ast-265">'d_activation'</span></span>]</span>)</span></span><span id="ast-266"><span id="ast-267"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-268"><span id="ast-269"><span id="ast-270">tf</span>.reshape</span>(<span id="ast-271" class="ref_node">x&nbsp;&rarr;&nbsp;result&nbsp;</span>,&nbsp;<span id="ast-272">[<span id="ast-273">batch_size</span>,&nbsp;<span id="ast-274">-1</span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parseInternalURL(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">url</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7">not</span>&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.url_change_search</span>.match</span>(<span id="ast-12" class="other_trans">url</span>)</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-14" class="other_trans">None</span></span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">urlparse</span>.urlparse</span>(<span id="ast-20" class="other_trans">url</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24" class="other_trans">result</span>.netloc</span><span id="ast-25" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-26"><span id="ast-27"><span id="ast-28">self</span>.config</span>.hostname</span>)</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-30" class="other_trans">None</span></span></span><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>change</span>,&nbsp;<span id="ast-33" class="other_trans">patchset</span>,&nbsp;<span id="ast-34" class="other_trans">filename</span>&nbsp;=&nbsp;<span id="ast-35">None</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-38">[<span id="ast-39" class="other_trans">x</span><span id="ast-40">&nbsp;for&nbsp;<span id="ast-41" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">result</span>.path</span>.split</span>(<span id="ast-46">'/'</span>)</span>&nbsp;if&nbsp;<span id="ast-47">x</span></span>]</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49" class="other_trans">path</span>:<span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>change</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">path</span>[<span id="ast-54"><span id="ast-55">0</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-58">[<span id="ast-59" class="other_trans">x</span><span id="ast-60">&nbsp;for&nbsp;<span id="ast-61" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">result</span>.fragment</span>.split</span>(<span id="ast-66">'/'</span>)</span>&nbsp;if&nbsp;<span id="ast-67">x</span></span>]</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-70"><span id="ast-71" class="other_trans">path</span>[<span id="ast-72"><span id="ast-73">0</span></span>]</span><span id="ast-74" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-75">'c'</span>)</span>:<span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>.pop</span>(<span id="ast-80">0</span>)</span></span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-82">path</span>:<span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85">not</span>&nbsp;<span id="ast-86" class="other_trans">change</span>)</span>:<span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>change</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans">path</span>.pop</span>(<span id="ast-92">0</span>)</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95">(<span id="ast-96">not</span>&nbsp;<span id="ast-97" class="other_trans">patchset</span>)</span>:<span id="ast-98"><span id="ast-99" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>patchset</span>&nbsp;=&nbsp;<span id="ast-100"><span id="ast-101"><span id="ast-102" class="other_trans">path</span>.pop</span>(<span id="ast-103">0</span>)</span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-106">(<span id="ast-107">not</span>&nbsp;<span id="ast-108" class="other_trans">filename</span>)</span>:<span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-111"><span id="ast-112"><span id="ast-113">'/'</span>.join</span>(<span id="ast-114">path</span>)</span></span><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>m</span>&nbsp;=&nbsp;<span id="ast-117"><span id="ast-118"><span id="ast-119" class="ref_node">trailing_filename_re&nbsp;&rarr;&nbsp;self.&nbsp;</span>.match</span>(<span id="ast-120">filename</span>)</span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122">m</span>:<span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-125"><span id="ast-126" class="incorrect_node">filename&nbsp;&rarr;&nbsp;path&nbsp;</span>[<span id="ast-127">:<span id="ast-128">(<span id="ast-129">0</span>&nbsp;-&nbsp;<span id="ast-131"><span id="ast-132">len</span>(<span id="ast-133"><span id="ast-134"><span id="ast-135">m</span>.group</span>(<span id="ast-136">1</span>)</span>)</span>)</span></span>]</span></span></span><span id="ast-137"><span id="ast-138" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-139">None</span></span></span></span></span><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-141">(<span id="ast-142" class="other_trans">change</span>,&nbsp;<span id="ast-143" class="other_trans">patchset</span>,&nbsp;<span id="ast-144" class="other_trans">filename</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;send(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">sender</span>,&nbsp;<span id="ast-5">to</span>,&nbsp;<span id="ast-6">value</span>,&nbsp;<span id="ast-7">data</span>,&nbsp;<span id="ast-9" class="other_trans">funid</span>,&nbsp;<span id="ast-11" class="other_trans">abi</span></span>):<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sendnonce</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.block</span>.get_nonce</span>(<span id="ast-19"><span id="ast-20"><span id="ast-21">u</span>.privtoaddr</span>(<span id="ast-22">sender</span>)</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25">funid</span><span id="ast-26" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-27">None</span>)</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>evmdata</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32">serpent</span>.encode_abi</span>(<span id="ast-33">funid</span>,&nbsp;<span id="ast-34" class="other_trans">abi</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>evmdata</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">serpent</span>.encode_datalist</span>(*<span id="ast-40" class="other_trans">data</span>)</span></span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tx</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">t</span>.Transaction</span>(<span id="ast-46" class="other_trans">sendnonce</span>,&nbsp;<span id="ast-47">1</span>,&nbsp;<span id="ast-48">gas_limit</span>,&nbsp;<span id="ast-49" class="other_trans">to</span>,&nbsp;<span id="ast-50" class="other_trans">value</span>,&nbsp;<span id="ast-51" class="other_trans">evmdata</span>)</span></span><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.last_tx</span>&nbsp;=&nbsp;<span id="ast-55" class="other_trans">tx</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tx</span>.sign</span>(<span id="ast-60" class="other_trans">sender</span>)</span></span><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-63" class="other_trans">s</span>,&nbsp;<span id="ast-64">r</span>)</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans">pb</span>.apply_transaction</span>(<span id="ast-68"><span id="ast-69">self</span>.block</span>,&nbsp;<span id="ast-70" class="other_trans">tx</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-73">not</span>&nbsp;<span id="ast-74" class="other_trans">s</span>)</span>:<span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-76"><span id="ast-77">Exception</span>(<span id="ast-78">'Transaction&nbsp;failed'</span>)</span></span></span><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>o</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82"><span id="ast-83">serpent</span>.decode_datalist</span>(<span id="ast-84" class="other_trans">r</span>)</span></span><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-86"><span id="ast-87" class="other_trans">map</span>(<span id="ast-88">lambda&nbsp;<span id="ast-89"><span id="ast-90" class="other_trans">x</span></span>:&nbsp;<span id="ast-91"><span id="ast-99">(<span id="ast-100" class="other_trans">x</span>&nbsp;-&nbsp;<span id="ast-102">(<span id="ast-103">2</span>&nbsp;**&nbsp;<span id="ast-105">256</span>)</span>)</span>&nbsp;if&nbsp;<span id="ast-92">(<span id="ast-93" class="other_trans">x</span><span id="ast-94" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-95">(<span id="ast-96">2</span>&nbsp;**&nbsp;<span id="ast-98">255</span>)</span>)</span>&nbsp;else&nbsp;<span id="ast-106">x</span></span></span>,&nbsp;<span id="ast-107" class="other_trans">o</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;paginate(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">seq</span>,&nbsp;<span id="ast-5" class="other_trans">max_limit</span>,&nbsp;<span id="ast-7" class="other_trans">on_results</span>,&nbsp;**kwargs</span>):<span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cursor</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">int</span>(<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">request</span>.args</span>.get</span>(<span id="ast-17">'cursor'</span>,&nbsp;<span id="ast-18">1</span>)</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>limit</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22">int</span>(<span id="ast-23">(<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">request</span>.args</span>.get</span>(<span id="ast-29">'limit'</span>,&nbsp;<span id="ast-30">25</span>)</span>&nbsp;or&nbsp;<span id="ast-31">0</span>)</span>)</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33" class="other_trans">max_limit</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-35">(<span id="ast-36" class="other_trans">limit</span><span id="ast-37" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-38" class="other_trans">max_limit</span>)</span></span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40" class="other_trans">cursor</span>:<span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;=&nbsp;<span id="ast-43">(<span id="ast-44">(<span id="ast-45" class="other_trans">cursor</span>&nbsp;-&nbsp;<span id="ast-47">1</span>)</span>&nbsp;*&nbsp;<span id="ast-49" class="other_trans">limit</span>)</span></span><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">list</span>(<span id="ast-54"><span id="ast-55" class="other_trans">seq</span>[<span id="ast-56"><span id="ast-57" class="other_trans">offset</span>:<span id="ast-58">(<span id="ast-59">(<span id="ast-60" class="other_trans">offset</span>&nbsp;+&nbsp;<span id="ast-62" class="correct_node">cursor&nbsp;&rarr;&nbsp;limit&nbsp;</span>)</span>&nbsp;+&nbsp;<span id="ast-64">1</span>)</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;=&nbsp;<span id="ast-67">0</span></span><span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>page</span>&nbsp;=&nbsp;<span id="ast-70">1</span></span><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74" class="other_trans">list</span>(<span id="ast-75" class="other_trans">seq</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_inspect_cpu(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">insp</span>,&nbsp;<span id="ast-5" class="other_trans">inst</span>,&nbsp;<span id="ast-6" class="other_trans">inst_name</span>,&nbsp;<span id="ast-7">instance_cache</span>,&nbsp;<span id="ast-8">metric_cache</span>,&nbsp;<span id="ast-9" class="other_trans">dims_customer</span>,&nbsp;<span id="ast-10">dims_operations</span></span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Inspect&nbsp;cpu&nbsp;metrics&nbsp;for&nbsp;an&nbsp;instance'</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sample_time</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16">float</span>(<span id="ast-17"><span id="ast-18"><span id="ast-19">'{:9f}'</span>.format</span>(<span id="ast-20"><span id="ast-21"><span id="ast-22">time</span>.time</span>()</span>)</span>)</span></span><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cpu_info</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27">insp</span>.inspect_cpus</span>(<span id="ast-28">inst</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31">'cpu.time'</span><span id="ast-32">&nbsp;in&nbsp;</span><span id="ast-33"><span id="ast-34">metric_cache</span>[<span id="ast-35"><span id="ast-36">inst_name</span></span>]</span>)</span>:<span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cpu_diff</span>&nbsp;=&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41" class="other_trans">cpu_info</span>.time</span>&nbsp;-&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46">metric_cache</span>[<span id="ast-47"><span id="ast-48">inst_name</span></span>]</span>[<span id="ast-49"><span id="ast-50">'cpu.time'</span></span>]</span>[<span id="ast-51"><span id="ast-52">'value'</span></span>]</span>)</span></span><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time_diff</span>&nbsp;=&nbsp;<span id="ast-55">(<span id="ast-56">sample_time</span>&nbsp;-&nbsp;<span id="ast-58"><span id="ast-59">float</span>(<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">metric_cache</span>[<span id="ast-64"><span id="ast-65">inst_name</span></span>]</span>[<span id="ast-66"><span id="ast-67">'cpu.time'</span></span>]</span>[<span id="ast-68"><span id="ast-69">'timestamp'</span></span>]</span>)</span>)</span></span><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raw_perc</span>&nbsp;=&nbsp;<span id="ast-72">(<span id="ast-73">(<span id="ast-74">cpu_diff</span>&nbsp;/&nbsp;<span id="ast-76">(<span id="ast-77">time_diff</span>&nbsp;*&nbsp;<span id="ast-79">1000000000</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-81">100</span>)</span></span><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>normalized_perc</span>&nbsp;=&nbsp;<span id="ast-84">(<span id="ast-85" class="other_trans">raw_perc</span>&nbsp;/&nbsp;<span id="ast-87"><span id="ast-88">cpu_info</span>.number</span>)</span></span><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-90">(<span id="ast-91" class="other_trans">raw_perc</span><span id="ast-92" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-93">0</span>)</span>:<span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.warn</span>(<span id="ast-99"><span id="ast-100"><span id="ast-101">'Ignoring&nbsp;negative&nbsp;CPU&nbsp;sample&nbsp;for:&nbsp;{0}&nbsp;new&nbsp;cpu&nbsp;time:&nbsp;{1}&nbsp;old&nbsp;cpu&nbsp;time:&nbsp;{2}'</span>.format</span>(<span id="ast-102" class="other_trans">inst_name</span>,&nbsp;<span id="ast-103"><span id="ast-104" class="other_trans">cpu_info</span>.time</span>,&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108">metric_cache</span>[<span id="ast-109"><span id="ast-110" class="other_trans">inst_name</span></span>]</span>[<span id="ast-111"><span id="ast-112">'cpu.time'</span></span>]</span>[<span id="ast-113"><span id="ast-114">'value'</span></span>]</span>)</span>)</span></span><span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>metric_cache</span>[<span id="ast-119"><span id="ast-120" class="other_trans">inst_name</span></span>]</span>[<span id="ast-121"><span id="ast-122">'cpu.time'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-123">{<span id="ast-124">'timestamp'</span>:&nbsp;<span id="ast-126" class="other_trans">sample_time</span>,&nbsp;<span id="ast-125">'value'</span>:&nbsp;<span id="ast-127"><span id="ast-128" class="other_trans">cpu_info</span>.time</span>}</span></span><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-130"><span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.gauge</span>(<span id="ast-134">'cpu.utilization_perc'</span>,&nbsp;<span id="ast-135"><span id="ast-136" class="other_trans">int</span>(<span id="ast-137"><span id="ast-138" class="other_trans">round</span>(<span id="ast-139" class="other_trans">raw_perc</span>,&nbsp;<span id="ast-140">0</span>)</span>)</span>,&nbsp;dimensions=<span id="ast-142" class="other_trans">dims_customer</span>,&nbsp;delegated_tenant=<span id="ast-144"><span id="ast-145"><span id="ast-146"><span id="ast-147" class="other_trans">instance_cache</span>.get</span>(<span id="ast-148" class="other_trans">inst_name</span>)</span>[<span id="ast-149"><span id="ast-150">'tenant_id'</span></span>]</span>,&nbsp;hostname=<span id="ast-152"><span id="ast-153"><span id="ast-154"><span id="ast-155">instance_cache</span>.get</span>(<span id="ast-156">inst_name</span>)</span>[<span id="ast-157"><span id="ast-158">'hostname'</span></span>]</span>)</span></span><span id="ast-159"><span id="ast-160"><span id="ast-161"><span id="ast-162"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.gauge</span>(<span id="ast-163">'cpu.utilization_norm_perc'</span>,&nbsp;<span id="ast-164"><span id="ast-165">int</span>(<span id="ast-166"><span id="ast-167" class="other_trans">round</span>(<span id="ast-168">normalized_perc</span>,&nbsp;<span id="ast-169">0</span>)</span>)</span>,&nbsp;dimensions=<span id="ast-171">dims_customer</span>,&nbsp;delegated_tenant=<span id="ast-173"><span id="ast-174"><span id="ast-175"><span id="ast-176">instance_cache</span>.get</span>(<span id="ast-177">inst_name</span>)</span>[<span id="ast-178"><span id="ast-179">'tenant_id'</span></span>]</span>,&nbsp;hostname=<span id="ast-181"><span id="ast-182"><span id="ast-183"><span id="ast-184">instance_cache</span>.get</span>(<span id="ast-185" class="other_trans">inst_name</span>)</span>[<span id="ast-186"><span id="ast-187">'hostname'</span></span>]</span>)</span></span><span id="ast-188"><span id="ast-189"><span id="ast-190"><span id="ast-191"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.gauge</span>(<span id="ast-192">'vm.cpu.utilization_perc'</span>,&nbsp;<span id="ast-193"><span id="ast-194">int</span>(<span id="ast-195"><span id="ast-196">round</span>(<span id="ast-197">raw_perc</span>,&nbsp;<span id="ast-198">0</span>)</span>)</span>,&nbsp;dimensions=<span id="ast-200">dims_operations</span>)</span></span><span id="ast-201"><span id="ast-202"><span id="ast-203"><span id="ast-204"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.gauge</span>(<span id="ast-205">'vm.cpu.utilization_norm_perc'</span>,&nbsp;<span id="ast-206"><span id="ast-207">int</span>(<span id="ast-208"><span id="ast-209">round</span>(<span id="ast-210" class="other_trans">normalized_perc</span>,&nbsp;<span id="ast-211">0</span>)</span>)</span>,&nbsp;dimensions=<span id="ast-213">dims_operations</span>)</span></span><span id="ast-214"><span id="ast-215" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cpu_time_name</span>&nbsp;=&nbsp;<span id="ast-216">'cpu.time_ns'</span></span><span id="ast-217"><span id="ast-218"><span id="ast-219"><span id="ast-220"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.gauge</span>(<span id="ast-221">cpu_time_name</span>,&nbsp;<span id="ast-222"><span id="ast-223">cpu_info</span>.time</span>,&nbsp;dimensions=<span id="ast-225" class="ref_node">dims_operations&nbsp;&rarr;&nbsp;dims_customer&nbsp;</span>,&nbsp;delegated_tenant=<span id="ast-227"><span id="ast-228"><span id="ast-229"><span id="ast-230">instance_cache</span>.get</span>(<span id="ast-231">inst_name</span>)</span>[<span id="ast-232"><span id="ast-233">'tenant_id'</span></span>]</span>,&nbsp;hostname=<span id="ast-235"><span id="ast-236"><span id="ast-237"><span id="ast-238" class="other_trans">instance_cache</span>.get</span>(<span id="ast-239">inst_name</span>)</span>[<span id="ast-240"><span id="ast-241">'hostname'</span></span>]</span>)</span></span><span id="ast-242"><span id="ast-243"><span id="ast-244"><span id="ast-245"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.gauge</span>(<span id="ast-246"><span id="ast-247"><span id="ast-248">'vm.{0}'</span>.format</span>(<span id="ast-249">cpu_time_name</span>)</span>,&nbsp;<span id="ast-250"><span id="ast-251" class="other_trans">cpu_info</span>.time</span>,&nbsp;dimensions=<span id="ast-253" class="other_trans">dims_operations</span>)</span></span></span><span id="ast-254"><span id="ast-255"><span id="ast-256"><span id="ast-257" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>metric_cache</span>[<span id="ast-258"><span id="ast-259" class="other_trans">inst_name</span></span>]</span>[<span id="ast-260"><span id="ast-261">'cpu.time'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-262">{<span id="ast-263">'timestamp'</span>:&nbsp;<span id="ast-265" class="other_trans">sample_time</span>,&nbsp;<span id="ast-264">'value'</span>:&nbsp;<span id="ast-266"><span id="ast-267" class="other_trans">cpu_info</span>.time</span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__call__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">X</span>,&nbsp;<span id="ast-5" class="other_trans">y</span>,&nbsp;<span id="ast-6" class="other_trans">net</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8"><span id="ast-9">self</span>.eval_size</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-13"><span id="ast-14" class="other_trans">net</span>.regression</span>&nbsp;or&nbsp;<span id="ast-15">(<span id="ast-16">not</span>&nbsp;<span id="ast-17"><span id="ast-18">self</span>.stratify</span>)</span>)</span>:<span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kf</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22">KFold</span>(<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">y</span>.shape</span>[<span id="ast-26"><span id="ast-27">0</span></span>]</span>,&nbsp;<span id="ast-28"><span id="ast-29">round</span>(<span id="ast-30">(<span id="ast-31">1.0</span>&nbsp;/&nbsp;<span id="ast-33"><span id="ast-34">self</span>.eval_size</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kf</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38">StratifiedKFold</span>(<span id="ast-39" class="other_trans">y</span>,&nbsp;<span id="ast-40"><span id="ast-41">round</span>(<span id="ast-42">(<span id="ast-43">1.0</span>&nbsp;/&nbsp;<span id="ast-45"><span id="ast-46">self</span>.eval_size</span>)</span>)</span>)</span></span></span><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-49" class="other_trans">train_indices</span>,&nbsp;<span id="ast-50" class="other_trans">valid_indices</span>)</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52">next</span>(<span id="ast-53"><span id="ast-54" class="other_trans">iter</span>(<span id="ast-55" class="other_trans">kf</span>)</span>)</span></span><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-58" class="other_trans">X_train</span>,&nbsp;<span id="ast-59">y_train</span>)</span>&nbsp;=&nbsp;<span id="ast-60">(<span id="ast-61"><span id="ast-62" class="other_trans">_sldict</span>(<span id="ast-63" class="other_trans">X</span>,&nbsp;<span id="ast-64" class="other_trans">train_indices</span>)</span>,&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">y</span>[<span id="ast-67"><span id="ast-68" class="other_trans">train_indices</span></span>]</span>)</span></span><span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-71">X_valid</span>,&nbsp;<span id="ast-72" class="other_trans">y_valid</span>)</span>&nbsp;=&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75">_sldict</span>(<span id="ast-76" class="other_trans">X</span>,&nbsp;<span id="ast-77" class="other_trans">valid_indices</span>)</span>,&nbsp;<span id="ast-78"><span id="ast-79" class="other_trans">y</span>[<span id="ast-80"><span id="ast-81" class="incorrect_node">valid_indices&nbsp;&rarr;&nbsp;kf&nbsp;</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-84">X_train</span>,&nbsp;<span id="ast-85">y_train</span>)</span>&nbsp;=&nbsp;<span id="ast-86">(<span id="ast-87" class="other_trans">X</span>,&nbsp;<span id="ast-88" class="other_trans">y</span>)</span></span><span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-91">X_valid</span>,&nbsp;<span id="ast-92" class="other_trans">y_valid</span>)</span>&nbsp;=&nbsp;<span id="ast-93">(<span id="ast-94"><span id="ast-95">_sldict</span>(<span id="ast-96">X</span>,&nbsp;<span id="ast-97"><span id="ast-98" class="other_trans">slice</span>(<span id="ast-99"><span id="ast-100" class="other_trans">len</span>(<span id="ast-101" class="ref_node">X&nbsp;&rarr;&nbsp;y&nbsp;</span>)</span>,&nbsp;<span id="ast-102">None</span>)</span>)</span>,&nbsp;<span id="ast-103"><span id="ast-104" class="other_trans">y</span>[<span id="ast-105"><span id="ast-106"><span id="ast-107">len</span>(<span id="ast-108" class="other_trans">y</span>)</span>:</span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;find_activity(<span id="ast-2"><span id="ast-3" class="other_trans">history</span>,&nbsp;<span id="ast-4">scheduled_id</span>,&nbsp;<span id="ast-6" class="other_trans">activity_id</span>,&nbsp;<span id="ast-8">input</span></span>):<span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Finds&nbsp;an&nbsp;activity&nbsp;in&nbsp;a&nbsp;given&nbsp;workflow&nbsp;execution&nbsp;and&nbsp;returns&nbsp;a&nbsp;callable,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;some&nbsp;args&nbsp;and&nbsp;some&nbsp;kwargs&nbsp;so&nbsp;we&nbsp;can&nbsp;re-execute&nbsp;it.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>found_activity</span>&nbsp;=&nbsp;<span id="ast-14">None</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">_</span>,&nbsp;<span id="ast-18">params</span>)</span>&nbsp;in&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">history</span>._activities</span>.items</span>()</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">params</span>[<span id="ast-27"><span id="ast-28">'scheduled_id'</span></span>]</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30" class="other_trans">scheduled_id</span>)</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>found_activity</span>&nbsp;=&nbsp;<span id="ast-33">params</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37" class="other_trans">params</span>[<span id="ast-38"><span id="ast-39">'id'</span></span>]</span><span id="ast-40" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-41" class="other_trans">activity_id</span>)</span>:<span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>found_activity</span>&nbsp;=&nbsp;<span id="ast-44" class="other_trans">params</span></span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">(<span id="ast-47">not</span>&nbsp;<span id="ast-48" class="other_trans">found_activity</span>)</span>:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">ValueError</span>(<span id="ast-52">"Couldn't&nbsp;find&nbsp;activity."</span>)</span></span></span><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-55" class="other_trans">module_name</span>,&nbsp;<span id="ast-56">method_name</span>)</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="correct_node">params&nbsp;&rarr;&nbsp;found_activity&nbsp;</span>[<span id="ast-61"><span id="ast-62">'name'</span></span>]</span>.rsplit</span>(<span id="ast-63">'.'</span>,&nbsp;<span id="ast-64">1</span>)</span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>module</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68">import_module</span>(<span id="ast-69" class="other_trans">module_name</span>)</span></span><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>func</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73">getattr</span>(<span id="ast-74" class="other_trans">module</span>,&nbsp;<span id="ast-75" class="other_trans">method_name</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77"><span id="ast-78">isinstance</span>(<span id="ast-79" class="other_trans">func</span>,&nbsp;<span id="ast-80">Activity</span>)</span>:<span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>func</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84" class="other_trans">func</span>._callable</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_reduce_cigar(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">cigar</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-7">1</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>last</span>&nbsp;=&nbsp;<span id="ast-10" class="other_trans">None</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>&nbsp;=&nbsp;<span id="ast-13">[]</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-15" class="other_trans">op</span>&nbsp;in&nbsp;<span id="ast-16" class="other_trans">cigar</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-20" class="other_trans">last</span>&nbsp;and&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">op</span><span id="ast-23" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-24" class="other_trans">last</span>)</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;+=&nbsp;<span id="ast-28">1</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-30" class="other_trans">last</span>:<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>.append</span>(<span id="ast-35">(<span id="ast-36" class="other_trans">count</span>,&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">last</span>.upper</span>()</span>)</span>)</span></span><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-42">1</span></span></span><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last</span>&nbsp;=&nbsp;<span id="ast-45" class="other_trans">op</span></span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>.append</span>(<span id="ast-50">(<span id="ast-51" class="other_trans">count</span>,&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54" class="location_node">op&nbsp;&rarr;&nbsp;last,&nbsp;pred:&nbsp;count&nbsp;</span>.upper</span>()</span>)</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-56" class="other_trans">ret</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_cleanval(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">value</span>,&nbsp;<span id="ast-5">attr</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7"><span id="ast-8">callable</span>(<span id="ast-9" class="other_trans">value</span>)</span>:<span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">value</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-15">(<span id="ast-17">(<span id="ast-18" class="other_trans">value</span><span id="ast-19" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-20" class="other_trans">None</span>)</span>&nbsp;or&nbsp;<span id="ast-21">(<span id="ast-22"><span id="ast-23" class="other_trans">unicode</span>(<span id="ast-24" class="other_trans">value</span>)</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26">u'None'</span>)</span>)</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-29">''</span></span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>t</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">type</span>(<span id="ast-34" class="other_trans">value</span>)</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">t</span><span id="ast-38" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-39" class="other_trans">str</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41" class="other_trans">value</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-43">(<span id="ast-44" class="other_trans">t</span><span id="ast-45" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-46" class="other_trans">bool</span>)</span>:<span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-51"><span id="ast-52" class="other_trans">_</span>(<span id="ast-53">'Y'</span>)</span>&nbsp;if&nbsp;<span id="ast-50" class="correct_node">t&nbsp;&rarr;&nbsp;value&nbsp;</span>&nbsp;else&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">_</span>(<span id="ast-56">'N'</span>)</span></span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">smart_unicode</span>(<span id="ast-62" class="other_trans">value</span>)</span>.encode</span>(<span id="ast-63"><span id="ast-64">self</span>.encoding</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-66">(<span id="ast-67" class="other_trans">t</span><span id="ast-68">&nbsp;in&nbsp;</span><span id="ast-69">[<span id="ast-70"><span id="ast-71" class="other_trans">datetime</span>.date</span>,&nbsp;<span id="ast-72"><span id="ast-73" class="other_trans">datetime</span>.datetime</span>]</span>)</span>:<span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans">date</span>(<span id="ast-79" class="other_trans">value</span>,&nbsp;<span id="ast-80">'SHORT_DATE_FORMAT'</span>)</span>.encode</span>(<span id="ast-81"><span id="ast-82">self</span>.encoding</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;slide_seek_bar(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">id_or_name</span>,&nbsp;<span id="ast-5" class="other_trans">endX</span>,&nbsp;<span id="ast-6" class="other_trans">endY</span>,&nbsp;<span id="ast-7" class="other_trans">tap_count</span>,&nbsp;<span id="ast-9" class="other_trans">startX</span>,&nbsp;<span id="ast-11" class="other_trans">startY</span></span>):<span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Slide&nbsp;seek&nbsp;bar&nbsp;'</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>driver</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>._current_application</span>()</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>element</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="ref_node">_find_element_by_tag_name&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-24">'seekBar'</span>,&nbsp;<span id="ast-25" class="other_trans">id_or_name</span>)</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-28">{<span id="ast-29">'startX'</span>:&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">float</span>(<span id="ast-38" class="other_trans">startX</span>)</span>,&nbsp;<span id="ast-30">'startY'</span>:&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">float</span>(<span id="ast-41" class="incorrect_node">startY&nbsp;&rarr;&nbsp;startX&nbsp;</span>)</span>,&nbsp;<span id="ast-31">'endX'</span>:&nbsp;<span id="ast-42"><span id="ast-43">float</span>(<span id="ast-44" class="other_trans">endX</span>)</span>,&nbsp;<span id="ast-32">'endY'</span>:&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">float</span>(<span id="ast-47" class="other_trans">endY</span>)</span>,&nbsp;<span id="ast-33">'tapCount'</span>:&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">int</span>(<span id="ast-50" class="other_trans">tap_count</span>)</span>,&nbsp;<span id="ast-34">'element'</span>:&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">element</span>.id</span>,&nbsp;<span id="ast-35">'duration'</span>:&nbsp;<span id="ast-53">1</span>}</span></span><span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>driver</span>.execute_script</span>(<span id="ast-58">'mobile:&nbsp;flick'</span>,&nbsp;<span id="ast-59" class="other_trans">args</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;start(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">poll</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-8">True</span>:<span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rlist</span>&nbsp;=&nbsp;<span id="ast-11">(<span id="ast-12">[]</span>&nbsp;+&nbsp;<span id="ast-14"><span id="ast-15">self</span>.serverList</span>)</span></span><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>wlist</span>&nbsp;=&nbsp;<span id="ast-18">[]</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>allList</span>&nbsp;=&nbsp;<span id="ast-21">(<span id="ast-22">[]</span>&nbsp;+&nbsp;<span id="ast-24"><span id="ast-25">self</span>.serverList</span>)</span></span><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>currentTime</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30">time</span>.time</span>()</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32">(<span id="ast-33" class="other_trans">_</span>,&nbsp;<span id="ast-34">connect</span>)</span>&nbsp;in&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38">self</span>._socketConnectList</span>.items</span>()</span>:<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>allList</span>.append</span>(<span id="ast-43"><span id="ast-44">connect</span>._sock</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">(<span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">connect</span>.info</span>[<span id="ast-50"><span id="ast-51">'lastAlive'</span></span>]</span><span id="ast-52" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-53">(<span id="ast-54" class="other_trans">currentTime</span>&nbsp;-&nbsp;<span id="ast-56">1800</span>)</span>)</span>:<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>connect</span>.shutdown</span>()</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">connect</span>.pauseSendAndRecv</span>()</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rlist</span>.append</span>(<span id="ast-71"><span id="ast-72" class="other_trans">connect</span>._sock</span>)</span></span><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">connect</span>.getSendPending</span>()</span>:<span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>wlist</span>.append</span>(<span id="ast-81"><span id="ast-82">connect</span>._sock</span>)</span></span></span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-86">s_readable</span>,&nbsp;<span id="ast-87">s_writable</span>,&nbsp;<span id="ast-88" class="other_trans">s_exceptional</span>)</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90">poll</span>(<span id="ast-91">rlist</span>,&nbsp;<span id="ast-92" class="other_trans">wlist</span>,&nbsp;<span id="ast-93" class="ref_node">rlist&nbsp;&rarr;&nbsp;allList&nbsp;</span>,&nbsp;<span id="ast-94"><span id="ast-101">1</span>&nbsp;if&nbsp;<span id="ast-95">(<span id="ast-96"><span id="ast-97">len</span>(<span id="ast-98">wlist</span>)</span><span id="ast-99" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-100">0</span>)</span>&nbsp;else&nbsp;<span id="ast-102">1e-05</span></span>)</span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-104">KeyboardInterrupt</span>:<span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-111">1</span>)</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.log</span>(<span id="ast-116">3</span>)</span></span><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-119">sock</span>&nbsp;in&nbsp;<span id="ast-120">s_readable</span>:<span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122">(<span id="ast-123" class="other_trans">sock</span><span id="ast-124">&nbsp;in&nbsp;</span><span id="ast-125"><span id="ast-126">self</span>.serverList</span>)</span>:<span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.onConnect</span>(<span id="ast-131" class="other_trans">sock</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.onSocketEvent</span>(<span id="ast-136" class="other_trans">sock</span>,&nbsp;<span id="ast-137"><span id="ast-138">sockConnect</span>.socketEventCanRecv</span>)</span></span></span></span><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-140" class="other_trans">sock</span>&nbsp;in&nbsp;<span id="ast-141">s_writable</span>:<span id="ast-142"><span id="ast-143"><span id="ast-144"><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.onSocketEvent</span>(<span id="ast-146" class="other_trans">sock</span>,&nbsp;<span id="ast-147"><span id="ast-148">sockConnect</span>.socketEventCanSend</span>)</span></span></span><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-150" class="other_trans">sock</span>&nbsp;in&nbsp;<span id="ast-151" class="other_trans">s_exceptional</span>:<span id="ast-152"><span id="ast-153"><span id="ast-154"><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.onSocketEvent</span>(<span id="ast-156" class="other_trans">sock</span>,&nbsp;<span id="ast-157"><span id="ast-158">sockConnect</span>.socketEventExcept</span>)</span></span></span><span id="ast-159"><span id="ast-160" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cblist</span>&nbsp;=&nbsp;<span id="ast-161"><span id="ast-162">self</span>.callbackList</span></span><span id="ast-163"><span id="ast-164"><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.callbackList</span>&nbsp;=&nbsp;<span id="ast-166">[]</span></span><span id="ast-167"><span id="ast-168" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>currentTime</span>&nbsp;=&nbsp;<span id="ast-169"><span id="ast-170"><span id="ast-171" class="other_trans">time</span>.time</span>()</span></span><span id="ast-172"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-173" class="other_trans">cbobj</span>&nbsp;in&nbsp;<span id="ast-174" class="other_trans">cblist</span>:<span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-176">(<span id="ast-177"><span id="ast-178" class="other_trans">cbobj</span>[<span id="ast-179"><span id="ast-180">1</span></span>]</span><span id="ast-181" class="incorrect_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-182" class="other_trans">currentTime</span>)</span>:<span id="ast-183"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-184"><span id="ast-185"><span id="ast-186"><span id="ast-187" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cbobj</span>[<span id="ast-188"><span id="ast-189">0</span></span>]</span>(*<span id="ast-190"><span id="ast-191" class="other_trans">cbobj</span>[<span id="ast-192"><span id="ast-193">2</span></span>]</span>,&nbsp;**<span id="ast-194"><span id="ast-195">cbobj</span>[<span id="ast-196"><span id="ast-197">3</span></span>]</span>)</span></span><span id="ast-198"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-199"><span id="ast-200"><span id="ast-201"><span id="ast-202"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.log</span>(<span id="ast-203">3</span>,&nbsp;<span id="ast-204">cbobj</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-205"><span id="ast-206"><span id="ast-207"><span id="ast-208"><span id="ast-209"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.callbackList</span>.append</span>(<span id="ast-210" class="other_trans">cbobj</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">contour</span>,&nbsp;<span id="ast-5" class="other_trans">solver_type</span></span>):<span id="ast-7"><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._c</span>&nbsp;=&nbsp;<span id="ast-10" class="other_trans">contour</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>solver_type</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">solver_type</span>.lower</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">solver_type</span><span id="ast-19">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-20"><span id="ast-21">self</span>.SOLVER_TYPES</span>)</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">ValueError</span>(<span id="ast-25"><span id="ast-26"><span id="ast-27">'solver_type&nbsp;not&nbsp;in&nbsp;{}'</span>.format</span>(<span id="ast-28" class="correct_node">SOLVER_TYPES&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span></span><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._solver_type</span>&nbsp;=&nbsp;<span id="ast-32" class="other_trans">solver_type</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;read_input(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">input_file</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Reads&nbsp;a&nbsp;LAMMPS&nbsp;input&nbsp;file.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;input_file&nbsp;(str):&nbsp;Name&nbsp;of&nbsp;LAMMPS&nbsp;input&nbsp;file&nbsp;to&nbsp;read&nbsp;in.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parsable_keywords</span>&nbsp;=&nbsp;<span id="ast-9">{<span id="ast-10">'units'</span>:&nbsp;<span id="ast-22"><span id="ast-23">self</span>.parse_units</span>,&nbsp;<span id="ast-11">'atom_style'</span>:&nbsp;<span id="ast-24"><span id="ast-25">self</span>.parse_atom_style</span>,&nbsp;<span id="ast-12">'dimension'</span>:&nbsp;<span id="ast-26"><span id="ast-27">self</span>.parse_dimension</span>,&nbsp;<span id="ast-13">'boundary'</span>:&nbsp;<span id="ast-28"><span id="ast-29">self</span>.parse_boundary</span>,&nbsp;<span id="ast-14">'pair_style'</span>:&nbsp;<span id="ast-30"><span id="ast-31">self</span>.parse_pair_style</span>,&nbsp;<span id="ast-15">'kspace_style'</span>:&nbsp;<span id="ast-32"><span id="ast-33">self</span>.parse_kspace_style</span>,&nbsp;<span id="ast-16">'pair_modify'</span>:&nbsp;<span id="ast-34"><span id="ast-35">self</span>.parse_pair_modify</span>,&nbsp;<span id="ast-17">'bond_style'</span>:&nbsp;<span id="ast-36"><span id="ast-37">self</span>.parse_bond_style</span>,&nbsp;<span id="ast-18">'angle_style'</span>:&nbsp;<span id="ast-38"><span id="ast-39">self</span>.parse_angle_style</span>,&nbsp;<span id="ast-19">'dihedral_style'</span>:&nbsp;<span id="ast-40"><span id="ast-41">self</span>.parse_dihedral_style</span>,&nbsp;<span id="ast-20">'improper_style'</span>:&nbsp;<span id="ast-42"><span id="ast-43">self</span>.parse_improper_style</span>,&nbsp;<span id="ast-21">'special_bonds'</span>:&nbsp;<span id="ast-44"><span id="ast-45">self</span>.parse_special_bonds</span>}</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">open</span>(<span id="ast-49" class="other_trans">input_file</span>,&nbsp;<span id="ast-50">'r'</span>)</span>&nbsp;as&nbsp;<span id="ast-51" class="other_trans">input_lines</span>:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-53" class="other_trans">line</span>&nbsp;in&nbsp;<span id="ast-54" class="other_trans">input_lines</span>:<span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">line</span>.strip</span>()</span>:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>keyword</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans">line</span>.split</span>()</span>[<span id="ast-65"><span id="ast-66">0</span></span>]</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-68">(<span id="ast-69" class="other_trans">keyword</span><span id="ast-70">&nbsp;in&nbsp;</span><span id="ast-71" class="other_trans">parsable_keywords</span>)</span>:<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parsable_keywords</span>[<span id="ast-76"><span id="ast-77" class="other_trans">keyword</span></span>]</span>(<span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans">line</span>.split</span>()</span>)</span></span></span></span></span></span><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.RAD</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85" class="other_trans">units</span>.radians</span></span><span id="ast-86"><span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.DEGREE</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90" class="other_trans">units</span>.degrees</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-92">(<span id="ast-93"><span id="ast-94">self</span>.unit_set</span><span id="ast-95" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-96">'real'</span>)</span>:<span id="ast-97"><span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.DIST</span>&nbsp;=&nbsp;<span id="ast-100"><span id="ast-101" class="other_trans">units</span>.angstroms</span></span><span id="ast-102"><span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.VEL</span>&nbsp;=&nbsp;<span id="ast-105">(<span id="ast-106"><span id="ast-107">units</span>.angstroms</span>&nbsp;/&nbsp;<span id="ast-109"><span id="ast-110">units</span>.femtosecond</span>)</span></span><span id="ast-111"><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ENERGY</span>&nbsp;=&nbsp;<span id="ast-114">(<span id="ast-115"><span id="ast-116" class="other_trans">units</span>.kilocalorie</span>&nbsp;/&nbsp;<span id="ast-118"><span id="ast-119" class="other_trans">units</span>.mole</span>)</span></span><span id="ast-120"><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.MASS</span>&nbsp;=&nbsp;<span id="ast-123">(<span id="ast-124"><span id="ast-125">units</span>.grams</span>&nbsp;/&nbsp;<span id="ast-127"><span id="ast-128" class="other_trans">units</span>.mole</span>)</span></span><span id="ast-129"><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.CHARGE</span>&nbsp;=&nbsp;<span id="ast-132"><span id="ast-133" class="other_trans">units</span>.elementary_charge</span></span><span id="ast-134"><span id="ast-135"><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.MOLE</span>&nbsp;=&nbsp;<span id="ast-137"><span id="ast-138" class="other_trans">units</span>.mole</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-140"><span id="ast-141" class="other_trans">Exception</span>(<span id="ast-142"><span id="ast-143"><span id="ast-144">'Unsupported&nbsp;unit&nbsp;set&nbsp;specified&nbsp;in&nbsp;input&nbsp;file:&nbsp;{0}'</span>.format</span>(<span id="ast-145" class="ref_node">unit_set&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;download_model(<span id="ast-2"><span id="ast-3">model_name</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7">(<span id="ast-8">model_name</span><span id="ast-9">&nbsp;in&nbsp;</span><span id="ast-10"><span id="ast-11"><span id="ast-12">model_download_table</span>.keys</span>()</span>)</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">'Failure:&nbsp;unknown&nbsp;model&nbsp;{}'</span>.format</span>(<span id="ast-17" class="other_trans">model_name</span>)</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-22">1</span>)</span></span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>model_url</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26">model_download_table</span>[<span id="ast-27"><span id="ast-28">model_name</span></span>]</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>platzoo_dir</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32">get_platzoo_dir</span>()</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>local_gz_filename</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">model_url</span>.split</span>(<span id="ast-39">'/'</span>)</span>[<span id="ast-40"><span id="ast-41">-1</span></span>]</span></span><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>temp_dir</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46">tempfile</span>.mkdtemp</span>()</span></span><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>default_downloader</span>(<span id="ast-50" class="other_trans">temp_dir</span>,&nbsp;<span id="ast-51">[<span id="ast-52">model_url</span>]</span>,&nbsp;<span id="ast-53">[<span id="ast-54">local_gz_filename</span>]</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">local_gz_filename</span>.endswith</span>(<span id="ast-59">'.gz'</span>)</span>:<span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>local_filename</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">local_gz_filename</span>[<span id="ast-64">:<span id="ast-65">-3</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>local_filename</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70">'{}.2'</span>.format</span>(<span id="ast-71">local_gz_filename</span>)</span></span></span><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>final_local_filepath</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-78" class="other_trans">platzoo_dir</span>,&nbsp;<span id="ast-79" class="other_trans">local_filename</span>)</span></span><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>final_local_linkpath</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85">os</span>.path</span>.join</span>(<span id="ast-86" class="other_trans">platzoo_dir</span>,&nbsp;<span id="ast-87" class="other_trans">model_name</span>)</span></span><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>temp_gz_filepath</span>&nbsp;=&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-94">temp_dir</span>,&nbsp;<span id="ast-95">local_gz_filename</span>)</span></span><span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>temp_filepath</span>&nbsp;=&nbsp;<span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-102">temp_dir</span>,&nbsp;<span id="ast-103" class="other_trans">local_filename</span>)</span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107">'Decompressing&nbsp;{}'</span>.format</span>(<span id="ast-108" class="other_trans">model_name</span>)</span></span><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-110"><span id="ast-111">open</span>(<span id="ast-112" class="other_trans">temp_filepath</span>,&nbsp;<span id="ast-113">'wb'</span>)</span>&nbsp;as&nbsp;<span id="ast-114" class="other_trans">f_out</span>:<span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118">gzip</span>.open</span>(<span id="ast-119" class="other_trans">temp_gz_filepath</span>,&nbsp;<span id="ast-120">'rb'</span>)</span>&nbsp;as&nbsp;<span id="ast-121" class="other_trans">f_in</span>:<span id="ast-122"><span id="ast-123"><span id="ast-124"><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>shutil</span>.copyfileobj</span>(<span id="ast-126">f_in</span>,&nbsp;<span id="ast-127" class="other_trans">f_out</span>)</span></span></span></span><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-129"><span id="ast-130"><span id="ast-131">'Installing&nbsp;{}'</span>.format</span>(<span id="ast-132" class="other_trans">model_name</span>)</span></span><span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.rename</span>(<span id="ast-137">temp_filepath</span>,&nbsp;<span id="ast-138" class="other_trans">final_local_filepath</span>)</span></span><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-144">final_local_linkpath</span>)</span>:<span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.remove</span>(<span id="ast-149" class="incorrect_node">final_local_linkpath&nbsp;&rarr;&nbsp;temp_filepath&nbsp;</span>)</span></span></span><span id="ast-150"><span id="ast-151"><span id="ast-152"><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.symlink</span>(<span id="ast-154" class="ref_node">final_local_filepath&nbsp;&rarr;&nbsp;local_filename&nbsp;</span>,&nbsp;<span id="ast-155" class="other_trans">final_local_linkpath</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="incorrect_node">kwargs&nbsp;&rarr;&nbsp;self.&nbsp;</span>.pop</span>(<span id="ast-9">'message'</span>,&nbsp;<span id="ast-10" class="other_trans">None</span>)</span></span><span id="ast-11"><span id="ast-12" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>msg&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-13">(<span id="ast-15" class="other_trans">msg</span>&nbsp;or&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.message</span>.format</span>(**<span id="ast-20" class="other_trans">kwargs</span>)</span>)</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-26" class="other_trans">Exception</span>,&nbsp;<span id="ast-27">self</span>)</span>.__init__</span>(<span id="ast-28" class="other_trans">msg</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_graph_attributes(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;is&nbsp;an&nbsp;internal&nbsp;function&nbsp;that&nbsp;returns&nbsp;attributes&nbsp;as&nbsp;a&nbsp;dictionary&nbsp;so&nbsp;that&nbsp;I&nbsp;can&nbsp;add\\u000a&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;to&nbsp;the&nbsp;networkx&nbsp;graph&nbsp;output.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>&nbsp;=&nbsp;<span id="ast-8">{}</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-12"><span id="ast-13">'id'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15">self</span>.id</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21">self</span>.output_shape</span><span id="ast-22" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-23" class="other_trans">None</span>)</span>)</span>:<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-27"><span id="ast-28">'output_shape'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">str</span>(<span id="ast-31"><span id="ast-32">self</span>.output_shape</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-36"><span id="ast-37">'output_shape'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-38">'N/A'</span></span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41">not</span>&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44">self</span>.num_neurons</span><span id="ast-45" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-46" class="other_trans">None</span>)</span>)</span>:<span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-50"><span id="ast-51">'num_neurons'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">str</span>(<span id="ast-54"><span id="ast-55">self</span>.num_neurons</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-59"><span id="ast-60">'num_neurons'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-61">'N/A'</span></span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63">(<span id="ast-64"><span id="ast-65" class="other_trans">type</span>(<span id="ast-66" class="correct_node">activation&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span><span id="ast-67" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-68" class="other_trans">tuple</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-72"><span id="ast-73">'activation'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76">self</span>.activation</span>[<span id="ast-77"><span id="ast-78">0</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-82"><span id="ast-83">'activation'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85">self</span>.activation</span></span></span><span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-89"><span id="ast-90">'dropout_rate'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-91"><span id="ast-92" class="other_trans">str</span>(<span id="ast-93"><span id="ast-94">self</span>.dropout_rate</span>)</span></span><span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-98"><span id="ast-99">'batch_norm'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-100"><span id="ast-101" class="other_trans">str</span>(<span id="ast-102"><span id="ast-103">self</span>.batch_norm</span>)</span></span><span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-107"><span id="ast-108">'origin'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-109"><span id="ast-110">self</span>.origin</span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-112" class="other_trans">out</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;initialize(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span>,&nbsp;<span id="ast-4" class="other_trans">locales</span>,&nbsp;<span id="ast-5" class="other_trans">initial_lang</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;locales&nbsp;:&nbsp;dict&nbsp;with&nbsp;lang:&nbsp;locale_n\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;same&nbsp;keys&nbsp;as&nbsp;in&nbsp;nikola\'s&nbsp;TRANSLATIONS\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;locale_n&nbsp;a&nbsp;sanitized&nbsp;locale,&nbsp;meaning\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;locale.setlocale(locale.LC_ALL,&nbsp;locale_n)&nbsp;will&nbsp;succeed\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;locale_n&nbsp;expressed&nbsp;in&nbsp;the&nbsp;string&nbsp;form,&nbsp;like&nbsp;"en.utf8"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-9">(<span id="ast-11">(<span id="ast-12" class="other_trans">initial_lang</span><span id="ast-13" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-14" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">initial_lang</span><span id="ast-17">&nbsp;in&nbsp;</span><span id="ast-18" class="other_trans">locales</span>)</span>)</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cls</span>.reset</span>()</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cls</span>.locales</span>&nbsp;=&nbsp;<span id="ast-26" class="other_trans">locales</span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>encodings</span>&nbsp;=&nbsp;<span id="ast-29">{}</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-31" class="other_trans">lang</span>&nbsp;in&nbsp;<span id="ast-32" class="other_trans">locales</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>locale</span>.setlocale</span>(<span id="ast-37"><span id="ast-38" class="other_trans">locale</span>.LC_ALL</span>,&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">locales</span>[<span id="ast-41"><span id="ast-42" class="other_trans">lang</span></span>]</span>)</span></span><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-45" class="other_trans">loc</span>,&nbsp;<span id="ast-46" class="other_trans">encoding</span>)</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49">locale</span>.getlocale</span>()</span></span><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>encodings</span>[<span id="ast-53"><span id="ast-54" class="other_trans">lang</span></span>]</span>&nbsp;=&nbsp;<span id="ast-55" class="other_trans">encoding</span></span></span><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cls</span>.encodings</span>&nbsp;=&nbsp;<span id="ast-59" class="other_trans">encodings</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cls</span>.__shared_state</span>[<span id="ast-64"><span id="ast-65">'current_lang'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-66" class="correct_node">lang&nbsp;&rarr;&nbsp;initial_lang&nbsp;</span></span><span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cls</span>.initialized</span>&nbsp;=&nbsp;<span id="ast-70">True</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;q(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>&nbsp;=&nbsp;<span id="ast-6">{<span id="ast-7">'query'</span>:&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.serialize</span>()</span>}</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14">self</span>.fields</span><span id="ast-15" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-16" class="other_trans">None</span>)</span>:<span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-20"><span id="ast-21">'fields'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23">self</span>.fields</span></span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-26"><span id="ast-27">self</span>.size</span><span id="ast-28" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-29" class="other_trans">None</span>)</span>:<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-33"><span id="ast-34">'size'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36">self</span>.size</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40">self</span>.start</span><span id="ast-41" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-42" class="other_trans">None</span>)</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-46"><span id="ast-47">'from'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49">self</span>.start</span></span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51"><span id="ast-52">self</span>.highlight</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-56"><span id="ast-57">'highlight'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61">self</span>.highlight</span>.serialize</span>()</span></span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63"><span id="ast-64">self</span>.sort</span>:<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-68"><span id="ast-69">'sort'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71">self</span>.sort</span></span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-73"><span id="ast-74">self</span>.explain</span>:<span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-78"><span id="ast-79">'explain'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81">self</span>.explain</span></span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-83"><span id="ast-84">self</span>.index_boost</span>:<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>[<span id="ast-88"><span id="ast-89">'indices_boost'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-90"><span id="ast-91">self</span>.index_boost</span></span></span><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95">self</span>.facet</span>.facets</span>:<span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>.update</span>(<span id="ast-100"><span id="ast-101"><span id="ast-102">self</span>.facet</span>.q</span>)</span></span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-104" class="other_trans">res</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;update(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">conf</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Update&nbsp;a&nbsp;reused&nbsp;Query&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;When&nbsp;a&nbsp;query&nbsp;object&nbsp;is&nbsp;reused&nbsp;for&nbsp;a&nbsp;new&nbsp;query&nbsp;it&nbsp;will&nbsp;be&nbsp;given\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;new&nbsp;query's&nbsp;config&nbsp;via&nbsp;this&nbsp;method.&nbsp;In&nbsp;most&nbsp;cases&nbsp;all&nbsp;we\\u000a&nbsp;&nbsp;&nbsp;&nbsp;need&nbsp;to&nbsp;do&nbsp;is&nbsp;select&nbsp;the&nbsp;lower&nbsp;of&nbsp;the&nbsp;two&nbsp;repeat&nbsp;values.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>repeat</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">util</span>.Interval</span>(<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">conf</span>.get</span>(<span id="ast-16">'repeat'</span>,&nbsp;<span id="ast-17">'1m'</span>)</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">util</span>.IntervalError</span>&nbsp;as&nbsp;<span id="ast-21" class="other_trans">ex</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">errors</span>.ConfigError</span>(<span id="ast-26" class="other_trans">conf</span>,&nbsp;<span id="ast-27">(<span id="ast-28">'Invalid&nbsp;repeat:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-30" class="other_trans">ex</span>)</span>)</span></span></span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34">self</span>.repeat</span><span id="ast-35" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-36" class="other_trans">repeat</span>)</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.repeat</span>&nbsp;=&nbsp;<span id="ast-40" class="other_trans">repeat</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;handleClipping(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">step</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>is_left_support</span>&nbsp;=&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9" class="other_trans">step</span>.leg</span><span id="ast-10" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-11"><span id="ast-12" class="incorrect_node">StepTarget&nbsp;&rarr;&nbsp;self.&nbsp;</span>.left</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>unclipped_step</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">step</span>.pose</span>.x</span>,&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">step</span>.pose</span>.y</span>,&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">step</span>.pose</span>.theta</span>)</span></span><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">step</span>.pose</span>.x</span>,&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">step</span>.pose</span>.y</span>,&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">step</span>.pose</span>.theta</span>)</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">clip_footstep_tuple</span>(<span id="ast-38" class="other_trans">unclipped_step</span>,&nbsp;<span id="ast-39" class="other_trans">is_left_support</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41" class="other_trans">step</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__exit__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">exc_type</span>,&nbsp;<span id="ast-5" class="other_trans">exc_value</span>,&nbsp;<span id="ast-6" class="other_trans">traceback</span></span>):<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-12" class="other_trans">_AssertNumQueriesLessThanContext</span>,&nbsp;<span id="ast-13">self</span>)</span>.__exit__</span>(<span id="ast-14" class="other_trans">exc_type</span>,&nbsp;<span id="ast-15" class="other_trans">exc_value</span>,&nbsp;<span id="ast-16" class="other_trans">traceback</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19" class="other_trans">exc_type</span><span id="ast-20" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-21" class="other_trans">None</span>)</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>executed</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26" class="other_trans">len</span>(<span id="ast-27">self</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.test_case</span>.assertTrue</span>(<span id="ast-33">(<span id="ast-34" class="other_trans">executed</span><span id="ast-35" class="ref_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-36"><span id="ast-37">self</span>.num</span>)</span>,&nbsp;<span id="ast-38">(<span id="ast-39">'%d&nbsp;queries&nbsp;executed,&nbsp;expected&nbsp;less&nbsp;than&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">executed</span>,&nbsp;<span id="ast-43"><span id="ast-44">self</span>.num</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
</body></html>
