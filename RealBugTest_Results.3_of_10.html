<html><head><style>
.ast { font-family: monospace; font-size: 12pt; }
.correct_node { font-weight: bold; background-color: green; color: white; }
.incorrect_node { font-weight: bold; background-color: red; color: white; }
.ref_node { font-weight: bold; background-color: blue; color: white; }
.location_node { font-weight: bold; background-color: #ff00ff; color: white; }
.other_trans { color: #3333ff; }
.whitespace { background-color: white; color: black; }
.pred_rank_wrapper { font-weight: bold; }
.correct_pred_rank { font-weight: bold; color: green;}
.incorrect_pred_rank { font-weight: bold; color: red; }
.rank_type { font-weight: bold; }
.description { font-size: 16pt; }
</style></head><body><div class="description">
<div><b>This is part 4/10 of the system predictions for the Real-Bug Test set. This system achieves 41% Repair Accuracy and 54% Location Accuracy.</b></div><br /><div><b>Annotations</b>:</div><ul><li><span class="correct_node">foo &rarr; bar</span> - The bug was located at this node, and the system <i>correctly</i> predicted both the location and the repair as its top prediction.</li><li><span class="incorrect_node">foo &rarr; bar</span> - The system <i>incorrectly</i> predicted this repair as its top prediction.</li><li><span class="ref_node">foo &rarr; bar</span> - If the system incorrectly predicted the repair, this was the correct repair it should have made.</li><li><span class="location_node">foo &rarr; bar, pred: zap</span> - The system predicted the correct <i>location</i> of the repair, but the wrong repair label. It should have predicted 'bar', but it predicted 'zap' instead.</li></ul><div>The part before the arrow ('foo') is what the system actually saw at test time. Other candidate repair locations which the system could have chosen are marked in <span class="other_trans">this color</span>. For clarity the actual labels for those locations are not shown.</div></div><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_create_(<span id="ast-2"><span id="ast-3" class="other_trans">kls</span>,&nbsp;<span id="ast-4" class="other_trans">url</span>,&nbsp;<span id="ast-5" class="other_trans">getter</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>local_getter</span>&nbsp;=&nbsp;<span id="ast-11">(<span id="ast-13" class="other_trans">getter</span>&nbsp;or&nbsp;<span id="ast-14" class="other_trans">HttpGetter</span>)</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>p</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">urllib</span>.parse</span>.urlparse</span>(<span id="ast-21" class="other_trans">url</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24"><span id="ast-25" class="other_trans">p</span>.scheme</span><span id="ast-26" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-27">''</span>)</span>:<span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-31">(<span id="ast-32"><span id="ast-33" class="other_trans">p</span>.netloc</span><span id="ast-34" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-35">''</span>)</span>&nbsp;and&nbsp;<span id="ast-36">(<span id="ast-37"><span id="ast-38" class="other_trans">p</span>.path</span><span id="ast-39" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-40">''</span>)</span>)</span>:<span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>local_getter</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">FileGetter</span>(<span id="ast-45"><span id="ast-46" class="other_trans">p</span>.path</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-48"><span id="ast-49">ValueError</span>(<span id="ast-50">(<span id="ast-51">'url&nbsp;should&nbsp;be&nbsp;a&nbsp;http-url&nbsp;or&nbsp;file&nbsp;path&nbsp;--&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-53" class="other_trans">url</span>)</span>)</span></span></span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">inspect</span>.isclass</span>(<span id="ast-58" class="other_trans">local_getter</span>)</span>:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>local_getter</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62" class="ref_node">getter&nbsp;&rarr;&nbsp;local_getter&nbsp;</span>(<span id="ast-63" class="other_trans">url</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">num_epochs</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dataset</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">load_data</span>()</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_layer</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">build_model</span>(input_dim=<span id="ast-14"><span id="ast-15" class="other_trans">dataset</span>[<span id="ast-16"><span id="ast-17">'input_dim'</span></span>]</span>,&nbsp;output_dim=<span id="ast-19"><span id="ast-20" class="other_trans">dataset</span>[<span id="ast-21"><span id="ast-22">'output_dim'</span></span>]</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iter_funcs</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26" class="other_trans">create_iter_functions</span>(<span id="ast-27" class="other_trans">dataset</span>,&nbsp;<span id="ast-28" class="other_trans">output_layer</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-30">'Starting&nbsp;training...'</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32" class="other_trans">epoch</span>&nbsp;in&nbsp;<span id="ast-33"><span id="ast-34">train</span>(<span id="ast-35" class="other_trans">iter_funcs</span>,&nbsp;<span id="ast-36" class="other_trans">dataset</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-38">(<span id="ast-39">'Epoch&nbsp;%d&nbsp;of&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43" class="other_trans">epoch</span>[<span id="ast-44"><span id="ast-45">'number'</span></span>]</span>,&nbsp;<span id="ast-46" class="other_trans">num_epochs</span>)</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-48">(<span id="ast-49">'&nbsp;&nbsp;training&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">epoch</span>[<span id="ast-53"><span id="ast-54">'train_loss'</span></span>]</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-56">(<span id="ast-57">'&nbsp;&nbsp;validation&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">epoch</span>[<span id="ast-61"><span id="ast-62">'valid_loss'</span></span>]</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-64">(<span id="ast-65">'&nbsp;&nbsp;validation&nbsp;accuracy:\\u0009\\u0009%.2f&nbsp;%%'</span>&nbsp;%&nbsp;<span id="ast-67">(<span id="ast-68"><span id="ast-69" class="other_trans">epoch</span>[<span id="ast-70"><span id="ast-71">'valid_accuracy'</span></span>]</span>&nbsp;*&nbsp;<span id="ast-73">100</span>)</span>)</span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-75">(<span id="ast-76"><span id="ast-77" class="other_trans">epoch</span>[<span id="ast-78"><span id="ast-79">'number'</span></span>]</span><span id="ast-80" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-81" class="other_trans">num_epochs</span>)</span>:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;motors(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">bot_angle</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Used&nbsp;to&nbsp;update&nbsp;the&nbsp;motors&nbsp;speed&nbsp;and&nbsp;angular&nbsp;motion.'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>std_angle</span>&nbsp;=&nbsp;<span id="ast-9">7</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">bot_angle</span><span id="ast-13" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-14" class="other_trans">std_angle</span>)</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>translate_angle</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18">self</span>.strafe_error</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.driver</span>.move</span>(<span id="ast-24" class="incorrect_node">translate_speed&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-25" class="other_trans">translate_angle</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rotate_speed</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">max</span>(<span id="ast-30">-100</span>,&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">min</span>(<span id="ast-33">100</span>,&nbsp;<span id="ast-34"><span id="ast-35">self</span>.rotate_error</span>)</span>)</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.driver</span>.rotate</span>(<span id="ast-41" class="other_trans">rotate_speed</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_start_end(<span id="ast-2"><span id="ast-3" class="other_trans">val</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5"><span id="ast-6">isinstance</span>(<span id="ast-7" class="other_trans">val</span>,&nbsp;<span id="ast-8" class="other_trans">slice</span>)</span>:<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">val</span>.start</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15">not</span>&nbsp;<span id="ast-16" class="other_trans">start</span>)</span>:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start</span>&nbsp;=&nbsp;<span id="ast-19">0</span></span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-22">(<span id="ast-24"><span id="ast-25" class="other_trans">val</span>.stop</span>&nbsp;or&nbsp;<span id="ast-26"><span id="ast-27">self</span>.total</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">end</span><span id="ast-31" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-32">0</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37">self</span>.total</span>&nbsp;+&nbsp;<span id="ast-39" class="other_trans">end</span>)</span></span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-43">(<span id="ast-44"><span id="ast-45">self</span>._max_item</span><span id="ast-46" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-47">None</span>)</span>&nbsp;and&nbsp;<span id="ast-48">(<span id="ast-49" class="other_trans">end</span><span id="ast-50" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-51"><span id="ast-52">self</span>._max_item</span>)</span>)</span>:<span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56">self</span>._max_item</span></span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-58">(<span id="ast-59" class="other_trans">start</span>,&nbsp;<span id="ast-60" class="other_trans">end</span>)</span></span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-62">(<span id="ast-63" class="other_trans">val</span>,&nbsp;<span id="ast-64">(<span id="ast-65" class="other_trans">val</span>&nbsp;+&nbsp;<span id="ast-67">1</span>)</span>)</span></span></span><span id="ast-68"><span id="ast-69"><span class="whitespace"><br />
</span>(<span id="ast-70" class="other_trans">start</span>,&nbsp;<span id="ast-71" class="other_trans">end</span>)</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73">get_start_end</span>(<span id="ast-74" class="other_trans">val</span>)</span></span><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
</span>model</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78">self</span>.model</span></span><span id="ast-79"><span class="whitespace"><br />
</span>if&nbsp;<span id="ast-80"><span id="ast-81">self</span>._results</span>:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-83">(<span id="ast-85">(<span id="ast-86" class="other_trans">start</span><span id="ast-87" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-88">0</span>)</span>&nbsp;and&nbsp;<span id="ast-89">(<span id="ast-90" class="other_trans">end</span><span id="ast-91" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-92">(<span id="ast-93"><span id="ast-94">self</span>.start</span>&nbsp;+&nbsp;<span id="ast-96"><span id="ast-97">self</span>.chuck_size</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-98">(<span id="ast-99"><span id="ast-100" class="other_trans">len</span>(<span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104">self</span>._results</span>[<span id="ast-105"><span id="ast-106">'hits'</span></span>]</span>[<span id="ast-107"><span id="ast-108">'hits'</span></span>]</span>)</span><span id="ast-109" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-110">0</span>)</span>&nbsp;and&nbsp;<span id="ast-111">(<span id="ast-113">(<span id="ast-114">'_source'</span><span id="ast-115">&nbsp;in&nbsp;</span><span id="ast-116"><span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120">self</span>._results</span>[<span id="ast-121"><span id="ast-122">'hits'</span></span>]</span>[<span id="ast-123"><span id="ast-124">'hits'</span></span>]</span>[<span id="ast-125"><span id="ast-126">0</span></span>]</span>)</span>&nbsp;or&nbsp;<span id="ast-127">(<span id="ast-128">'_fields'</span><span id="ast-129">&nbsp;in&nbsp;</span><span id="ast-130"><span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134">self</span>._results</span>[<span id="ast-135"><span id="ast-136">'hits'</span></span>]</span>[<span id="ast-137"><span id="ast-138">'hits'</span></span>]</span>[<span id="ast-139"><span id="ast-140">0</span></span>]</span>)</span>)</span>)</span>:<span id="ast-141"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-142">(<span id="ast-143">not</span>&nbsp;<span id="ast-144"><span id="ast-145">isinstance</span>(<span id="ast-146" class="other_trans">val</span>,&nbsp;<span id="ast-147">slice</span>)</span>)</span>:<span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-149"><span id="ast-150" class="other_trans">model</span>(<span id="ast-151"><span id="ast-152">self</span>.connection</span>,&nbsp;<span id="ast-153"><span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157">self</span>._results</span>[<span id="ast-158"><span id="ast-159">'hits'</span></span>]</span>[<span id="ast-160"><span id="ast-161">'hits'</span></span>]</span>[<span id="ast-162"><span id="ast-163">(<span id="ast-164" class="incorrect_node">val&nbsp;&rarr;&nbsp;end&nbsp;</span>&nbsp;-&nbsp;<span id="ast-166"><span id="ast-167">self</span>.start</span>)</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-168"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-169">[<span id="ast-170"><span id="ast-171" class="other_trans">model</span>(<span id="ast-172"><span id="ast-173">self</span>.connection</span>,&nbsp;<span id="ast-174">hit</span>)</span><span id="ast-175">&nbsp;for&nbsp;<span id="ast-176" class="other_trans">hit</span>&nbsp;in&nbsp;<span id="ast-177"><span id="ast-178"><span id="ast-179"><span id="ast-180"><span id="ast-181">self</span>._results</span>[<span id="ast-182"><span id="ast-183">'hits'</span></span>]</span>[<span id="ast-184"><span id="ast-185">'hits'</span></span>]</span>[<span id="ast-186"><span id="ast-187">start</span>:<span id="ast-188" class="other_trans">end</span></span>]</span></span>]</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;respond(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">message</span>,&nbsp;<span id="ast-5" class="other_trans">user</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>issues</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">parse</span>(<span id="ast-11" class="other_trans">message</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15" class="other_trans">len</span>(<span id="ast-16" class="other_trans">issues</span>)</span><span id="ast-17" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-18">0</span>)</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">str</span>(<span id="ast-24"><span id="ast-25"><span id="ast-26">',&nbsp;'</span>.join</span>(<span id="ast-27" class="other_trans">issues</span>)</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.speak</span>(<span id="ast-32" class="other_trans">message</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process_new_task(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">task</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Handle&nbsp;new&nbsp;task.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;1)&nbsp;Setup&nbsp;Grab&nbsp;object&nbsp;for&nbsp;that&nbsp;task\\u000a&nbsp;&nbsp;&nbsp;&nbsp;2)&nbsp;Try&nbsp;to&nbsp;load&nbsp;task&nbsp;from&nbsp;the&nbsp;cache\\u000a&nbsp;&nbsp;&nbsp;&nbsp;3)&nbsp;If&nbsp;no&nbsp;cached&nbsp;data&nbsp;then&nbsp;submit&nbsp;task&nbsp;to&nbsp;network&nbsp;transport\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>grab</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.setup_grab_for_task</span>(<span id="ast-12" class="other_trans">task</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>grab_config_backup</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="incorrect_node">grab&nbsp;&rarr;&nbsp;task&nbsp;</span>.dump_config</span>()</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cache_result</span>&nbsp;=&nbsp;<span id="ast-20" class="other_trans">None</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24">self</span>.is_task_cacheable</span>(<span id="ast-25" class="other_trans">task</span>,&nbsp;<span id="ast-26" class="other_trans">grab</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30">self</span>.save_timer</span>(<span id="ast-31">'cache'</span>)</span>:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>.save_timer</span>(<span id="ast-36">'cache.read'</span>)</span>:<span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cache_result</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41">self</span>.load_task_from_cache</span>(<span id="ast-42" class="ref_node">transport&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-43" class="other_trans">task</span>,&nbsp;<span id="ast-44" class="other_trans">grab</span>,&nbsp;<span id="ast-45" class="other_trans">grab_config_backup</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;work(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>._should_run</span>()</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>._sort_and_filter</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">len</span>(<span id="ast-22"><span id="ast-23">self</span>.evolve_list</span>)</span><span id="ast-24" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-25">0</span>)</span>&nbsp;and&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>.evolve_list</span>[<span id="ast-30"><span id="ast-31">0</span></span>]</span><span id="ast-32" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-33">'all'</span>)</span>)</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">filter</span>(<span id="ast-38">lambda&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">x</span></span>:&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43" class="other_trans">x</span>.name</span><span id="ast-44">&nbsp;in&nbsp;</span><span id="ast-45"><span id="ast-46">self</span>.evolve_list</span>)</span></span>,&nbsp;<span id="ast-47" class="other_trans">filtered_list</span>)</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-51">(<span id="ast-52"><span id="ast-53" class="other_trans">len</span>(<span id="ast-54"><span id="ast-55">self</span>.donot_evolve_list</span>)</span><span id="ast-56" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-57">0</span>)</span>&nbsp;and&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60"><span id="ast-61">self</span>.donot_evolve_list</span>[<span id="ast-62"><span id="ast-63">0</span></span>]</span><span id="ast-64" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-65">'none'</span>)</span>)</span>:<span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">filter</span>(<span id="ast-70">lambda&nbsp;<span id="ast-71"><span id="ast-72" class="other_trans">pokemon</span></span>:&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75" class="other_trans">pokemon</span>.name</span><span id="ast-76">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-77" class="correct_node">donot_evolve_list&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span>,&nbsp;<span id="ast-78" class="other_trans">filtered_list</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_insertion_breakpoints(<span id="ast-2"><span id="ast-3">age_records</span>,&nbsp;<span id="ast-4" class="other_trans">intervals</span>,&nbsp;<span id="ast-5">window</span>,&nbsp;<span id="ast-7">start</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>func_logger</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">logging</span>.getLogger</span>(<span id="ast-14">(<span id="ast-15">'%s-%s'</span>&nbsp;%&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19">get_insertion_breakpoints</span>.__name__</span>,&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22">multiprocessing</span>.current_process</span>()</span>)</span>)</span>)</span></span><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>bedtools_intervals</span>&nbsp;=&nbsp;<span id="ast-25">[<span id="ast-26"><span id="ast-27"><span id="ast-28">pybedtools</span>.Interval</span>(<span id="ast-29">'1'</span>,&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">interval</span>[<span id="ast-32"><span id="ast-33">0</span></span>]</span>,&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">interval</span>[<span id="ast-36"><span id="ast-37">1</span></span>]</span>)</span><span id="ast-38">&nbsp;for&nbsp;<span id="ast-39" class="other_trans">interval</span>&nbsp;in&nbsp;<span id="ast-40"><span id="ast-41">sorted</span>(<span id="ast-42">intervals</span>)</span></span>]</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>func_logger</span>.info</span>(<span id="ast-47">(<span id="ast-48">'bedtools_intervals&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-50"><span id="ast-51">str</span>(<span id="ast-52" class="other_trans">bedtools_intervals</span>)</span>)</span>)</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54">(<span id="ast-55">not</span>&nbsp;<span id="ast-56">bedtools_intervals</span>)</span>:<span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-58">[]</span></span></span><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>potential_breakpoints</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">sorted</span>(<span id="ast-63"><span id="ast-64">list</span>(<span id="ast-65"><span id="ast-66">set</span>(<span id="ast-67">(<span id="ast-68">[<span id="ast-69"><span id="ast-70">interval</span>.start</span><span id="ast-71">&nbsp;for&nbsp;<span id="ast-72" class="other_trans">interval</span>&nbsp;in&nbsp;<span id="ast-73" class="other_trans">bedtools_intervals</span></span>]</span>&nbsp;+&nbsp;<span id="ast-75">[<span id="ast-76"><span id="ast-77">interval</span>.end</span><span id="ast-78">&nbsp;for&nbsp;<span id="ast-79" class="other_trans">interval</span>&nbsp;in&nbsp;<span id="ast-80" class="other_trans">bedtools_intervals</span></span>]</span>)</span>)</span>)</span>)</span></span><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>breakpoints</span>&nbsp;=&nbsp;<span id="ast-83">[]</span></span><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-85">breakpoint</span>&nbsp;in&nbsp;<span id="ast-86"><span id="ast-87">potential_breakpoints</span>[<span id="ast-88"><span id="ast-89">1</span>:<span id="ast-90">-1</span></span>]</span>:<span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>func_logger</span>.info</span>(<span id="ast-95">(<span id="ast-96">'\\u0009Examining&nbsp;potential&nbsp;breakpoint&nbsp;%d&nbsp;for&nbsp;support'</span>&nbsp;%&nbsp;<span id="ast-98" class="other_trans">breakpoint</span>)</span>)</span></span><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>left_support</span>&nbsp;=&nbsp;<span id="ast-101">[<span id="ast-102"><span id="ast-103" class="other_trans">interval</span>[<span id="ast-104"><span id="ast-105">0</span></span>]</span><span id="ast-106">&nbsp;for&nbsp;<span id="ast-107" class="other_trans">interval</span>&nbsp;in&nbsp;<span id="ast-108">intervals</span>&nbsp;if&nbsp;<span id="ast-109">(<span id="ast-110"><span id="ast-111">abs</span>(<span id="ast-112">(<span id="ast-113"><span id="ast-114">interval</span>[<span id="ast-115"><span id="ast-116">0</span></span>]</span>&nbsp;-&nbsp;<span id="ast-118">breakpoint</span>)</span>)</span><span id="ast-119" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-120" class="other_trans">window</span>)</span></span>]</span></span><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>right_support</span>&nbsp;=&nbsp;<span id="ast-123">[<span id="ast-124"><span id="ast-125" class="other_trans">interval</span>[<span id="ast-126"><span id="ast-127">1</span></span>]</span><span id="ast-128">&nbsp;for&nbsp;<span id="ast-129" class="other_trans">interval</span>&nbsp;in&nbsp;<span id="ast-130" class="other_trans">intervals</span>&nbsp;if&nbsp;<span id="ast-131">(<span id="ast-132"><span id="ast-133">abs</span>(<span id="ast-134">(<span id="ast-135"><span id="ast-136">interval</span>[<span id="ast-137"><span id="ast-138">1</span></span>]</span>&nbsp;-&nbsp;<span id="ast-140">breakpoint</span>)</span>)</span><span id="ast-141" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-142">window</span>)</span></span>]</span></span><span id="ast-143"><span id="ast-144" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>counter_examples</span>&nbsp;=&nbsp;<span id="ast-145">[<span id="ast-146" class="other_trans">age_record</span><span id="ast-147">&nbsp;for&nbsp;<span id="ast-148" class="other_trans">age_record</span>&nbsp;in&nbsp;<span id="ast-149">age_records</span>&nbsp;if&nbsp;<span id="ast-150">(<span id="ast-152"><span id="ast-153"><span id="ast-154" class="other_trans">age_record</span>.has_long_ref_flanks</span>()</span>&nbsp;and&nbsp;<span id="ast-155">(<span id="ast-157"><span id="ast-158"><span id="ast-159" class="other_trans">age_record</span>.has_ref_deletion</span>(<span id="ast-160" class="other_trans">window</span>)</span>&nbsp;or&nbsp;<span id="ast-161"><span id="ast-162"><span id="ast-163" class="other_trans">age_record</span>.has_insertion</span>(min_diff=<span id="ast-165">1</span>,&nbsp;max_diff=<span id="ast-167">49</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-168"><span id="ast-169"><span id="ast-170" class="other_trans">age_record</span>.breakpoint_match</span>(<span id="ast-171">breakpoint</span>,&nbsp;<span id="ast-172">window</span>)</span>)</span></span>]</span></span><span id="ast-173"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-174" class="other_trans">counter_examples</span>:<span id="ast-175"><span id="ast-176" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>counter_example_ends</span>&nbsp;=&nbsp;<span id="ast-177">[<span id="ast-178"><span id="ast-179" class="other_trans">age_record</span>.start1_end1s</span><span id="ast-180">&nbsp;for&nbsp;<span id="ast-181" class="other_trans">age_record</span>&nbsp;in&nbsp;<span id="ast-182">counter_examples</span></span>]</span></span><span id="ast-183"><span id="ast-184"><span id="ast-185"><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>func_logger</span>.info</span>(<span id="ast-187">(<span id="ast-188">'\\u0009Skipping&nbsp;breakpoint&nbsp;%d&nbsp;due&nbsp;to&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-190">(<span id="ast-191">breakpoint</span>,&nbsp;<span id="ast-192"><span id="ast-193">str</span>(<span id="ast-194" class="other_trans">counter_example_ends</span>)</span>)</span>)</span>)</span></span><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-196"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-197">left_support</span>:<span id="ast-198"><span id="ast-199"><span id="ast-200"><span id="ast-201" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>func_logger</span>.info</span>(<span id="ast-202">(<span id="ast-203">'\\u0009Left&nbsp;support&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-205"><span id="ast-206">str</span>(<span id="ast-207" class="incorrect_node">left_support&nbsp;&rarr;&nbsp;breakpoint&nbsp;</span>)</span>)</span>)</span></span></span><span id="ast-208"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-209">right_support</span>:<span id="ast-210"><span id="ast-211"><span id="ast-212"><span id="ast-213" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>func_logger</span>.info</span>(<span id="ast-214">(<span id="ast-215">'\\u0009Right&nbsp;support&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-217"><span id="ast-218">str</span>(<span id="ast-219" class="ref_node">left_support&nbsp;&rarr;&nbsp;right_support&nbsp;</span>)</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;handle(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;*args,&nbsp;**options</span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>media_path</span>&nbsp;=&nbsp;<span id="ast-6">''</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8"><span id="ast-9">len</span>(<span id="ast-10">args</span>)</span>:<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>media_path</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14">args</span>[<span id="ast-15"><span id="ast-16">0</span></span>]</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-19" class="other_trans">media_path</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-22">DIRECTORY</span></span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25">not</span>&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">os</span>.path</span>.isdir</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33">os</span>.path</span>.join</span>(<span id="ast-34"><span id="ast-35" class="other_trans">settings</span>.MEDIA_ROOT</span>,&nbsp;<span id="ast-36" class="other_trans">path</span>)</span>)</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-38"><span id="ast-39">CommandError</span>(<span id="ast-40">(<span id="ast-41">'&lt;media_path&gt;&nbsp;must&nbsp;be&nbsp;a&nbsp;directory&nbsp;in&nbsp;MEDIA_ROOT&nbsp;(If&nbsp;you&nbsp;don\'t&nbsp;add&nbsp;a&nbsp;media_path&nbsp;the&nbsp;default&nbsp;path&nbsp;is&nbsp;DIRECTORY).\\u000a"%s"&nbsp;is&nbsp;no&nbsp;directory.'</span>&nbsp;%&nbsp;<span id="ast-43" class="other_trans">path</span>)</span>)</span></span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-45">1</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stdout</span>.write</span>(<span id="ast-51">'\\u000aSelect&nbsp;a&nbsp;version&nbsp;you&nbsp;want&nbsp;to&nbsp;generate:\\u000a'</span>)</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-53" class="other_trans">version</span>&nbsp;in&nbsp;<span id="ast-54" class="other_trans">VERSIONS</span>:<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stdout</span>.write</span>(<span id="ast-60">(<span id="ast-61">'&nbsp;*&nbsp;%s\\u000a'</span>&nbsp;%&nbsp;<span id="ast-63" class="other_trans">version</span>)</span>)</span></span></span><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version_name</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">input</span>(<span id="ast-68">'(leave&nbsp;blank&nbsp;to&nbsp;generate&nbsp;all&nbsp;versions):&nbsp;'</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70">(<span id="ast-71" class="other_trans">version_name</span><span id="ast-72" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-73">''</span>)</span>:<span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selected_version</span>&nbsp;=&nbsp;<span id="ast-76">None</span></span><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-79"><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tmp</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82" class="other_trans">VERSIONS</span>[<span id="ast-83"><span id="ast-84" class="other_trans">version_name</span></span>]</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selected_version</span>&nbsp;=&nbsp;<span id="ast-87" class="other_trans">version_name</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stderr</span>.write</span>(<span id="ast-95">(<span id="ast-96">'Error:&nbsp;Version&nbsp;"%s"&nbsp;doesn\'t&nbsp;exist.\\u000a'</span>&nbsp;%&nbsp;<span id="ast-98">version_name</span>)</span>)</span></span><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version_name</span>&nbsp;=&nbsp;<span id="ast-101">None</span></span><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span></span></span><span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filelisting</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106">FileListing</span>(<span id="ast-107">path</span>,&nbsp;filter_func=<span id="ast-109"><span id="ast-110">self</span>.filter_images</span>)</span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-112" class="other_trans">fileobject</span>&nbsp;in&nbsp;<span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans">filelisting</span>.files_walk_filtered</span>()</span>:<span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-117">(<span id="ast-118"><span id="ast-119" class="other_trans">fileobject</span>.filetype</span><span id="ast-120" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-121">'Image'</span>)</span>:<span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-123" class="other_trans">selected_version</span>:<span id="ast-124"><span id="ast-125"><span id="ast-126"><span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stdout</span>.write</span>(<span id="ast-129">(<span id="ast-130">'generating&nbsp;version&nbsp;"%s"&nbsp;for:&nbsp;%s\\u000a'</span>&nbsp;%&nbsp;<span id="ast-132">(<span id="ast-133" class="incorrect_node">selected_version&nbsp;&rarr;&nbsp;version_name&nbsp;</span>,&nbsp;<span id="ast-134"><span id="ast-135" class="other_trans">fileobject</span>.path</span>)</span>)</span>)</span></span><span id="ast-136"><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>versionobject</span>&nbsp;=&nbsp;<span id="ast-138"><span id="ast-139"><span id="ast-140" class="other_trans">fileobject</span>.version_generate</span>(<span id="ast-141" class="other_trans">selected_version</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-142"><span id="ast-143"><span id="ast-144"><span id="ast-145"><span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stdout</span>.write</span>(<span id="ast-147">(<span id="ast-148">'generating&nbsp;all&nbsp;versions&nbsp;for:&nbsp;%s\\u000a'</span>&nbsp;%&nbsp;<span id="ast-150"><span id="ast-151" class="other_trans">fileobject</span>.path</span>)</span>)</span></span><span id="ast-152"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-153" class="other_trans">version</span>&nbsp;in&nbsp;<span id="ast-154">VERSIONS</span>:<span id="ast-155"><span id="ast-156" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>versionobject</span>&nbsp;=&nbsp;<span id="ast-157"><span id="ast-158"><span id="ast-159" class="other_trans">fileobject</span>.version_generate</span>(<span id="ast-160" class="ref_node">selected_version&nbsp;&rarr;&nbsp;version&nbsp;</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__ge__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">other</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>.__time</span><span id="ast-10" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-11"><span id="ast-12" class="other_trans">other</span>.__time</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-14" class="other_trans">AttributeError</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-16" class="other_trans">NotImplemented</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;index(<span id="ast-2"></span>):<span id="ast-3"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-4">(<span id="ast-5"><span id="ast-6" class="other_trans">request</span>.method</span><span id="ast-7" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-8">'GET'</span>)</span>:<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-10">'OK'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14" class="other_trans">request</span>.method</span><span id="ast-15" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-16">'POST'</span>)</span>:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hook_blocks</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">requests</span>.get</span>(<span id="ast-25">'https://api.github.com/meta'</span>)</span>.json</span>()</span>[<span id="ast-26"><span id="ast-27">'hooks'</span></span>]</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29" class="other_trans">block</span>&nbsp;in&nbsp;<span id="ast-30" class="other_trans">hook_blocks</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ip</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35">ipaddress</span>.ip_address</span>(<span id="ast-36">(<span id="ast-37">u'%s'</span>&nbsp;%&nbsp;<span id="ast-39"><span id="ast-40">request</span>.remote_addr</span>)</span>)</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44"><span id="ast-45">ipaddress</span>.ip_address</span>(<span id="ast-46" class="other_trans">ip</span>)</span><span id="ast-47">&nbsp;in&nbsp;</span><span id="ast-48"><span id="ast-49"><span id="ast-50">ipaddress</span>.ip_network</span>(<span id="ast-51" class="other_trans">block</span>)</span>)</span>:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>abort</span>(<span id="ast-56">403</span>)</span></span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans">request</span>.headers</span>.get</span>(<span id="ast-63">'X-GitHub-Event'</span>)</span><span id="ast-64" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-65">'ping'</span>)</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">json</span>.dumps</span>(<span id="ast-70">{<span id="ast-71">'msg'</span>:&nbsp;<span id="ast-72">'Hi!'</span>}</span>)</span></span></span><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-74">(<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78">request</span>.headers</span>.get</span>(<span id="ast-79">'X-GitHub-Event'</span>)</span><span id="ast-80" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-81">'push'</span>)</span>:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85">json</span>.dumps</span>(<span id="ast-86">{<span id="ast-87">'msg'</span>:&nbsp;<span id="ast-88">'wrong&nbsp;event&nbsp;type'</span>}</span>)</span></span></span><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>repos</span>&nbsp;=&nbsp;<span id="ast-91"><span id="ast-92"><span id="ast-93">json</span>.loads</span>(<span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98">io</span>.open</span>(<span id="ast-99">REPOS_JSON_PATH</span>,&nbsp;<span id="ast-100">'r'</span>)</span>.read</span>()</span>)</span></span><span id="ast-101"><span id="ast-102" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>payload</span>&nbsp;=&nbsp;<span id="ast-103"><span id="ast-104"><span id="ast-105">json</span>.loads</span>(<span id="ast-106"><span id="ast-107" class="other_trans">request</span>.data</span>)</span></span><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>repo_meta</span>&nbsp;=&nbsp;<span id="ast-110">{<span id="ast-111">'name'</span>:&nbsp;<span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans">payload</span>[<span id="ast-116"><span id="ast-117">'repository'</span></span>]</span>[<span id="ast-118"><span id="ast-119">'name'</span></span>]</span>,&nbsp;<span id="ast-112">'owner'</span>:&nbsp;<span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123" class="other_trans">payload</span>[<span id="ast-124"><span id="ast-125">'repository'</span></span>]</span>[<span id="ast-126"><span id="ast-127">'owner'</span></span>]</span>[<span id="ast-128"><span id="ast-129">'name'</span></span>]</span>}</span></span><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>match</span>&nbsp;=&nbsp;<span id="ast-132"><span id="ast-133"><span id="ast-134" class="other_trans">re</span>.match</span>(<span id="ast-135">'refs/heads/(?P&lt;branch&gt;.*)'</span>,&nbsp;<span id="ast-136"><span id="ast-137" class="other_trans">payload</span>[<span id="ast-138"><span id="ast-139">'ref'</span></span>]</span>)</span></span><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-141">match</span>:<span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>repo_meta</span>[<span id="ast-145"><span id="ast-146">'branch'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-147"><span id="ast-148"><span id="ast-149"><span id="ast-150" class="other_trans">match</span>.groupdict</span>()</span>[<span id="ast-151"><span id="ast-152">'branch'</span></span>]</span></span><span id="ast-153"><span id="ast-154" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>repo</span>&nbsp;=&nbsp;<span id="ast-155"><span id="ast-156"><span id="ast-157">repos</span>.get</span>(<span id="ast-158"><span id="ast-159"><span id="ast-160">'{owner}/{name}/branch:{branch}'</span>.format</span>(**<span id="ast-161">repo_meta</span>)</span>,&nbsp;<span id="ast-162">None</span>)</span></span><span id="ast-163"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-164">(<span id="ast-165">not</span>&nbsp;<span id="ast-166">repo</span>)</span>:<span id="ast-167"><span id="ast-168" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>repo</span>&nbsp;=&nbsp;<span id="ast-169"><span id="ast-170"><span id="ast-171" class="other_trans">repos</span>.get</span>(<span id="ast-172"><span id="ast-173"><span id="ast-174">'{owner}/{name}'</span>.format</span>(**<span id="ast-175">repo_meta</span>)</span>,&nbsp;<span id="ast-176" class="other_trans">None</span>)</span></span></span></span><span id="ast-177"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-178">(<span id="ast-180" class="other_trans">repo</span>&nbsp;and&nbsp;<span id="ast-181"><span id="ast-182"><span id="ast-183" class="other_trans">repo</span>.get</span>(<span id="ast-184">'path'</span>,&nbsp;<span id="ast-185">None</span>)</span>)</span>:<span id="ast-186"><span id="ast-187" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-188"><span id="ast-189"><span id="ast-190" class="ref_node">repos&nbsp;&rarr;&nbsp;repo&nbsp;</span>.get</span>(<span id="ast-191">'key'</span>,&nbsp;<span id="ast-192">None</span>)</span></span><span id="ast-193"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-194">key</span>:<span id="ast-195"><span id="ast-196" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>signature</span>&nbsp;=&nbsp;<span id="ast-197"><span id="ast-198"><span id="ast-199"><span id="ast-200"><span id="ast-201"><span id="ast-202"><span id="ast-203" class="other_trans">request</span>.headers</span>.get</span>(<span id="ast-204">'X-Hub-Signature'</span>)</span>.split</span>(<span id="ast-205">'='</span>)</span>[<span id="ast-206"><span id="ast-207">1</span></span>]</span></span><span id="ast-208"><span id="ast-209" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mac</span>&nbsp;=&nbsp;<span id="ast-210"><span id="ast-211" class="other_trans">hmac</span>(<span id="ast-212" class="other_trans">key</span>,&nbsp;msg=<span id="ast-214"><span id="ast-215">request</span>.data</span>,&nbsp;digestmod=<span id="ast-217">sha1</span>)</span></span><span id="ast-218"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-219">(<span id="ast-220"><span id="ast-221"><span id="ast-222" class="other_trans">mac</span>.hexdigest</span>()</span><span id="ast-223" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-224">signature</span>)</span>:<span id="ast-225"><span id="ast-226"><span id="ast-227"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>abort</span>(<span id="ast-228">403</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">state</span>,&nbsp;<span id="ast-5" class="other_trans">region_type</span>,&nbsp;<span id="ast-6" class="other_trans">action</span>,&nbsp;**kwargs</span>):<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-12">SimActionData</span>,&nbsp;<span id="ast-13">self</span>)</span>.__init__</span>(<span id="ast-14" class="other_trans">state</span>)</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.type</span>&nbsp;=&nbsp;<span id="ast-18" class="other_trans">region_type</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.action</span>&nbsp;=&nbsp;<span id="ast-22" class="other_trans">action</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.objects</span>&nbsp;=&nbsp;<span id="ast-26">{}</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">k</span>,&nbsp;<span id="ast-30" class="other_trans">v</span>)</span>&nbsp;in&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="incorrect_node">kwargs&nbsp;&rarr;&nbsp;self.&nbsp;</span>.iteritems</span>()</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36" class="other_trans">v</span><span id="ast-37" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-38" class="other_trans">None</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-41"><span id="ast-42">isinstance</span>(<span id="ast-43" class="other_trans">k</span>,&nbsp;<span id="ast-44" class="other_trans">SimAST</span>)</span>:<span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reg_deps</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">k</span>._info</span>.get</span>(<span id="ast-51">'reg_deps'</span>,&nbsp;<span id="ast-52" class="other_trans">None</span>)</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tmp_deps</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">k</span>._info</span>.get</span>(<span id="ast-59">'tmp_deps'</span>,&nbsp;<span id="ast-60" class="other_trans">None</span>)</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.objects</span>[<span id="ast-65"><span id="ast-66" class="other_trans">k</span></span>]</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68">SimActionObject</span>(<span id="ast-69"><span id="ast-70" class="other_trans">v</span>._a</span>,&nbsp;reg_deps=<span id="ast-72">reg_deps</span>,&nbsp;tmp_deps=<span id="ast-74" class="other_trans">tmp_deps</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-76"><span id="ast-77">isinstance</span>(<span id="ast-78" class="other_trans">k</span>,&nbsp;<span id="ast-79" class="other_trans">SimActionObject</span>)</span>:<span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.objects</span>[<span id="ast-84"><span id="ast-85" class="other_trans">k</span></span>]</span>&nbsp;=&nbsp;<span id="ast-86" class="other_trans">v</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.objects</span>[<span id="ast-91"><span id="ast-92" class="other_trans">k</span></span>]</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94" class="other_trans">SimActionObject</span>(<span id="ast-95" class="ref_node">k&nbsp;&rarr;&nbsp;v&nbsp;</span>,&nbsp;reg_deps=<span id="ast-97">None</span>,&nbsp;tmp_deps=<span id="ast-99" class="other_trans">None</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;read(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">size</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Read&nbsp;size&nbsp;bytes&nbsp;from&nbsp;the&nbsp;serial&nbsp;port.&nbsp;If&nbsp;a&nbsp;timeout&nbsp;is&nbsp;set&nbsp;it&nbsp;may\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;less&nbsp;characters&nbsp;as&nbsp;requested.&nbsp;With&nbsp;no&nbsp;timeout&nbsp;it&nbsp;will&nbsp;block\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;until&nbsp;the&nbsp;requested&nbsp;number&nbsp;of&nbsp;bytes&nbsp;is&nbsp;read.'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10">not</span>&nbsp;<span id="ast-11"><span id="ast-12">self</span>.hComPort</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-14">portNotOpenError</span></span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17">size</span><span id="ast-18" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-19">0</span>)</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>win32</span>.ResetEvent</span>(<span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>._overlappedRead</span>.hEvent</span>)</span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>flags</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31">win32</span>.DWORD</span>()</span></span><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>comstat</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">win32</span>.COMSTAT</span>()</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39">not</span>&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42">win32</span>.ClearCommError</span>(<span id="ast-43"><span id="ast-44">self</span>.hComPort</span>,&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">ctypes</span>.byref</span>(<span id="ast-48" class="other_trans">flags</span>)</span>,&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">ctypes</span>.byref</span>(<span id="ast-52" class="other_trans">comstat</span>)</span>)</span>)</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-54"><span id="ast-55">SerialException</span>(<span id="ast-56">'call&nbsp;to&nbsp;ClearCommError&nbsp;failed'</span>)</span></span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60">self</span>.timeout</span><span id="ast-61" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-62">0</span>)</span>:<span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>n</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">min</span>(<span id="ast-67"><span id="ast-68" class="other_trans">comstat</span>.cbInQue</span>,&nbsp;<span id="ast-69" class="other_trans">size</span>)</span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-71">(<span id="ast-72" class="other_trans">n</span><span id="ast-73" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-74">0</span>)</span>:<span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>buf</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79">ctypes</span>.create_string_buffer</span>(<span id="ast-80">n</span>)</span></span><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rc</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85">win32</span>.DWORD</span>()</span></span><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>err</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90">win32</span>.ReadFile</span>(<span id="ast-91"><span id="ast-92">self</span>.hComPort</span>,&nbsp;<span id="ast-93" class="other_trans">buf</span>,&nbsp;<span id="ast-94" class="ref_node">size&nbsp;&rarr;&nbsp;n&nbsp;</span>,&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans">ctypes</span>.byref</span>(<span id="ast-98" class="other_trans">rc</span>)</span>,&nbsp;<span id="ast-99"><span id="ast-100"><span id="ast-101">ctypes</span>.byref</span>(<span id="ast-102"><span id="ast-103">self</span>._overlappedRead</span>)</span>)</span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-105">(<span id="ast-107">(<span id="ast-108">not</span>&nbsp;<span id="ast-109" class="other_trans">err</span>)</span>&nbsp;and&nbsp;<span id="ast-110">(<span id="ast-111"><span id="ast-112"><span id="ast-113">win32</span>.GetLastError</span>()</span><span id="ast-114" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-115"><span id="ast-116">win32</span>.ERROR_IO_PENDING</span>)</span>)</span>:<span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-118"><span id="ast-119">SerialException</span>(<span id="ast-120">(<span id="ast-121">'ReadFile&nbsp;failed&nbsp;(%s)'</span>&nbsp;%&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125">ctypes</span>.WinError</span>()</span>)</span>)</span></span></span><span id="ast-126"><span id="ast-127" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>err</span>&nbsp;=&nbsp;<span id="ast-128"><span id="ast-129"><span id="ast-130" class="other_trans">win32</span>.WaitForSingleObject</span>(<span id="ast-131"><span id="ast-132"><span id="ast-133">self</span>._overlappedRead</span>.hEvent</span>,&nbsp;<span id="ast-134"><span id="ast-135">win32</span>.INFINITE</span>)</span></span><span id="ast-136"><span id="ast-137" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>read</span>&nbsp;=&nbsp;<span id="ast-138"><span id="ast-139"><span id="ast-140" class="other_trans">buf</span>.raw</span>[<span id="ast-141">:<span id="ast-142"><span id="ast-143">rc</span>.value</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-144"><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>read</span>&nbsp;=&nbsp;<span id="ast-146"><span id="ast-147" class="other_trans">bytes</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>buf</span>&nbsp;=&nbsp;<span id="ast-150"><span id="ast-151"><span id="ast-152">ctypes</span>.create_string_buffer</span>(<span id="ast-153" class="incorrect_node">size&nbsp;&rarr;&nbsp;buf&nbsp;</span>)</span></span><span id="ast-154"><span id="ast-155" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rc</span>&nbsp;=&nbsp;<span id="ast-156"><span id="ast-157"><span id="ast-158">win32</span>.DWORD</span>()</span></span><span id="ast-159"><span id="ast-160"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>err</span>&nbsp;=&nbsp;<span id="ast-161"><span id="ast-162"><span id="ast-163">win32</span>.ReadFile</span>(<span id="ast-164"><span id="ast-165">self</span>.hComPort</span>,&nbsp;<span id="ast-166">buf</span>,&nbsp;<span id="ast-167" class="other_trans">size</span>,&nbsp;<span id="ast-168"><span id="ast-169"><span id="ast-170" class="other_trans">ctypes</span>.byref</span>(<span id="ast-171" class="other_trans">rc</span>)</span>,&nbsp;<span id="ast-172"><span id="ast-173"><span id="ast-174">ctypes</span>.byref</span>(<span id="ast-175"><span id="ast-176">self</span>._overlappedRead</span>)</span>)</span></span><span id="ast-177"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-178">(<span id="ast-180">(<span id="ast-181">not</span>&nbsp;<span id="ast-182">err</span>)</span>&nbsp;and&nbsp;<span id="ast-183">(<span id="ast-184"><span id="ast-185"><span id="ast-186">win32</span>.GetLastError</span>()</span><span id="ast-187" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-188"><span id="ast-189">win32</span>.ERROR_IO_PENDING</span>)</span>)</span>:<span id="ast-190"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-191"><span id="ast-192">SerialException</span>(<span id="ast-193">(<span id="ast-194">'ReadFile&nbsp;failed&nbsp;(%s)'</span>&nbsp;%&nbsp;<span id="ast-196"><span id="ast-197"><span id="ast-198">ctypes</span>.WinError</span>()</span>)</span>)</span></span></span><span id="ast-199"><span id="ast-200" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>err</span>&nbsp;=&nbsp;<span id="ast-201"><span id="ast-202"><span id="ast-203">win32</span>.GetOverlappedResult</span>(<span id="ast-204"><span id="ast-205">self</span>.hComPort</span>,&nbsp;<span id="ast-206"><span id="ast-207"><span id="ast-208">ctypes</span>.byref</span>(<span id="ast-209"><span id="ast-210">self</span>._overlappedRead</span>)</span>,&nbsp;<span id="ast-211"><span id="ast-212"><span id="ast-213" class="other_trans">ctypes</span>.byref</span>(<span id="ast-214" class="other_trans">rc</span>)</span>,&nbsp;<span id="ast-215">True</span>)</span></span><span id="ast-216"><span id="ast-217" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>read</span>&nbsp;=&nbsp;<span id="ast-218"><span id="ast-219"><span id="ast-220">buf</span>.raw</span>[<span id="ast-221">:<span id="ast-222"><span id="ast-223" class="other_trans">rc</span>.value</span></span>]</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-224"><span id="ast-225" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>read</span>&nbsp;=&nbsp;<span id="ast-226"><span id="ast-227">bytes</span>()</span></span></span><span id="ast-228"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-229"><span id="ast-230" class="other_trans">bytes</span>(<span id="ast-231" class="other_trans">read</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get(<span id="ast-2"><span id="ast-3" class="other_trans">package_name</span>,&nbsp;<span id="ast-4" class="other_trans">pypi_server</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Constructs&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;PyPI&nbsp;server&nbsp;and&nbsp;returns&nbsp;a\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:class:`Package&nbsp;&lt;Package&gt;`.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;package_name:&nbsp;case&nbsp;sensitive&nbsp;name&nbsp;of&nbsp;the&nbsp;package&nbsp;on&nbsp;the&nbsp;PyPI&nbsp;server.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;pypi_server:&nbsp;(option)&nbsp;URL&nbsp;to&nbsp;the&nbsp;PyPI&nbsp;server.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Usage:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;import&nbsp;yarg\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&gt;&nbsp;package&nbsp;=&nbsp;yarg.get('yarg')\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;Package&nbsp;yarg&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10">not</span>&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">pypi_server</span>.endswith</span>(<span id="ast-14">'/'</span>)</span>)</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pypi_server</span>&nbsp;=&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">pypi_server</span>&nbsp;+&nbsp;<span id="ast-20">'/'</span>)</span></span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">requests</span>.get</span>(<span id="ast-26"><span id="ast-27"><span id="ast-28">'{0}{1}/json'</span>.format</span>(<span id="ast-29" class="other_trans">pypi_server</span>,&nbsp;<span id="ast-30" class="other_trans">package_name</span>)</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">response</span>.status_code</span><span id="ast-35" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-36">300</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">HTTPError</span>(status_code=<span id="ast-41"><span id="ast-42" class="other_trans">response</span>.status_code</span>,&nbsp;reason=<span id="ast-44"><span id="ast-45" class="other_trans">response</span>.reason</span>)</span></span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">json2package</span>(<span id="ast-49"><span id="ast-50" class="other_trans">response</span>.content</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;rubygems_update(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Determine&nbsp;whether&nbsp;the&nbsp;`rubygems-update`&nbsp;gem&nbsp;is&nbsp;needed.&nbsp;&nbsp;It&nbsp;is&nbsp;needed\\u000a&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;Lucid&nbsp;and&nbsp;older&nbsp;systems.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>codename</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">lsb_release_codename</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-10">(<span id="ast-12">(<span id="ast-13" class="other_trans">codename</span><span id="ast-14" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-15" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-16">(<span id="ast-17"><span id="ast-18" class="other_trans">codename</span>[<span id="ast-19"><span id="ast-20">0</span></span>]</span><span id="ast-21" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-22">'m'</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__iter__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.to_visit</span>.append</span>(<span id="ast-9"><span id="ast-10">self</span>.entry_point</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-12"><span id="ast-13">self</span>.to_visit</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.to_visit</span>.pop</span>()</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22">not</span>&nbsp;<span id="ast-23">(<span id="ast-24"><span id="ast-25" class="other_trans">get_url_host</span>(<span id="ast-26" class="other_trans">url</span>)</span><span id="ast-27">&nbsp;in&nbsp;</span><span id="ast-28"><span id="ast-29">self</span>.whitelist</span>)</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">any</span>(<span id="ast-34">(<span id="ast-35"><span id="ast-36" class="other_trans">search</span>(<span id="ast-37" class="other_trans">x</span>,&nbsp;<span id="ast-38" class="other_trans">url</span>)</span><span id="ast-39">&nbsp;for&nbsp;<span id="ast-40" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-41"><span id="ast-42">self</span>.blacklist</span></span>)</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-46" class="other_trans">url_without_hashbang</span>,&nbsp;<span id="ast-47" class="other_trans">_</span>,&nbsp;<span id="ast-48" class="other_trans">_</span>)</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">url</span>.partition</span>(<span id="ast-52">'#'</span>)</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54">(<span id="ast-55" class="other_trans">url_without_hashbang</span><span id="ast-56">&nbsp;in&nbsp;</span><span id="ast-57"><span id="ast-58">self</span>.visited_pages</span>)</span>:<span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.visited_pages</span>.add</span>(<span id="ast-65" class="correct_node">url&nbsp;&rarr;&nbsp;url_without_hashbang&nbsp;</span>)</span></span><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>page</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72">self</span>.client</span>.download_page</span>(<span id="ast-73" class="other_trans">url</span>,&nbsp;blacklist=<span id="ast-75"><span id="ast-76">self</span>.blacklist</span>)</span></span><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-78" class="other_trans">NotAPage</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;print_nodes(<span id="ast-2"><span id="ast-3" class="other_trans">nodes</span>,&nbsp;<span id="ast-4" class="other_trans">detailed</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Prints&nbsp;all&nbsp;the&nbsp;given&nbsp;nodes'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>found</span>&nbsp;=&nbsp;<span id="ast-10">0</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-12" class="other_trans">node</span>&nbsp;in&nbsp;<span id="ast-13" class="other_trans">nodes</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>found</span>&nbsp;+=&nbsp;<span id="ast-17">1</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print_node</span>(<span id="ast-21" class="other_trans">node</span>,&nbsp;detailed=<span id="ast-23" class="other_trans">detailed</span>)</span></span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27">'\\u000aFound&nbsp;{0}&nbsp;node{1}'</span>.format</span>(<span id="ast-28" class="other_trans">found</span>,&nbsp;<span id="ast-29"><span id="ast-34">'s'</span>&nbsp;if&nbsp;<span id="ast-30">(<span id="ast-31" class="other_trans">found</span><span id="ast-32" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;!=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-33">1</span>)</span>&nbsp;else&nbsp;<span id="ast-35">''</span></span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;assertRPCError(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">code</span>,&nbsp;<span id="ast-5" class="other_trans">callable</span>,&nbsp;*args,&nbsp;**kw</span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>callable</span>(*<span id="ast-10" class="other_trans">args</span>,&nbsp;**<span id="ast-11" class="other_trans">kw</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">supervisor</span>.xmlrpc</span>.RPCError</span>&nbsp;as&nbsp;<span id="ast-16" class="other_trans">inst</span>:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-21"><span id="ast-22" class="other_trans">inst</span>.code</span>,&nbsp;<span id="ast-23" class="other_trans">code</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;chunks(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@return&nbsp;A&nbsp;generator&nbsp;that&nbsp;yields&nbsp;the&nbsp;chunks&nbsp;of&nbsp;the&nbsp;log&nbsp;file\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;starting&nbsp;with&nbsp;the&nbsp;first&nbsp;chunk,&nbsp;which&nbsp;is&nbsp;always&nbsp;found&nbsp;directly\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;after&nbsp;the&nbsp;FileHeader,&nbsp;and&nbsp;continuing&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ofs</span>&nbsp;=&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10">self</span>._offset</span>&nbsp;+&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.header_chunk_size</span>()</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-16">(<span id="ast-17">(<span id="ast-18" class="other_trans">ofs</span>&nbsp;+&nbsp;<span id="ast-20">65536</span>)</span><span id="ast-21" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-22"><span id="ast-23" class="other_trans">len</span>(<span id="ast-24"><span id="ast-25">self</span>._buf</span>)</span>)</span>:<span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-28"><span id="ast-29" class="incorrect_node">ChunkHeader&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-30"><span id="ast-31">self</span>._buf</span>,&nbsp;<span id="ast-32" class="other_trans">ofs</span>)</span></span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ofs</span>&nbsp;+=&nbsp;<span id="ast-36">65536</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parseContentType(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">ctype</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parse&nbsp;the&nbsp;Content-Type&nbsp;header,&nbsp;returning&nbsp;the&nbsp;media-type&nbsp;and&nbsp;any\\u000a&nbsp;&nbsp;&nbsp;&nbsp;parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">ctype</span><span id="ast-10" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>:<span id="ast-12"><span id="ast-13" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mediatype&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-14">'application/octet-stream'</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ctypeParameters</span>&nbsp;=&nbsp;<span id="ast-18">{<span id="ast-19">'charset'</span>:&nbsp;<span id="ast-20">'ISO-8859-1'</span>}</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_IsUnparsedFlagAccessAllowed(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Determine&nbsp;whether&nbsp;to&nbsp;allow&nbsp;unparsed&nbsp;flag&nbsp;access&nbsp;or&nbsp;not.'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">_UNPARSED_FLAG_ACCESS_ENV_NAME</span><span id="ast-10">&nbsp;in&nbsp;</span><span id="ast-11"><span id="ast-12" class="other_trans">os</span>.environ</span>)</span>:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>allow_unparsed_flag_access</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">os</span>.getenv</span>(<span id="ast-19" class="other_trans">_UNPARSED_FLAG_ACCESS_ENV_NAME</span>)</span><span id="ast-20" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-21">'1'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.__dict__</span>[<span id="ast-26"><span id="ast-27">'__reset_called'</span></span>]</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>allow_unparsed_flag_access</span>&nbsp;=&nbsp;<span id="ast-30">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">_helpers</span>.IsRunningTest</span>()</span>:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>flag_percentile</span>&nbsp;=&nbsp;<span id="ast-37">(<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">struct</span>.unpack</span>(<span id="ast-42">'&lt;I'</span>,&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">hashlib</span>.md5</span>(<span id="ast-49" class="other_trans">name</span>)</span>.digest</span>()</span>[<span id="ast-50">:<span id="ast-51">4</span></span>]</span>)</span>[<span id="ast-52"><span id="ast-53">0</span></span>]</span>&nbsp;%&nbsp;<span id="ast-55">100</span>)</span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>allow_unparsed_flag_access</span>&nbsp;=&nbsp;<span id="ast-58">(<span id="ast-59" class="other_trans">_UNPARSED_ACCESS_DISABLED_PERCENT</span><span id="ast-60" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-61" class="other_trans">flag_percentile</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>allow_unparsed_flag_access</span>&nbsp;=&nbsp;<span id="ast-64">True</span></span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-66" class="other_trans">allow_unparsed_flag_access</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__lt__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">other</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7">not</span>&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">isinstance</span>(<span id="ast-10" class="other_trans">other</span>,&nbsp;<span id="ast-11" class="other_trans">Queue</span>)</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">TypeError</span>(<span id="ast-15">'Cannot&nbsp;compare&nbsp;queues&nbsp;to&nbsp;other&nbsp;objects.'</span>)</span></span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19">self</span>.name</span><span id="ast-20" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-21"><span id="ast-22" class="other_trans">other</span>.name</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;add_task(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">task</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Add&nbsp;new&nbsp;task&nbsp;to&nbsp;task&nbsp;queue.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Stop&nbsp;the&nbsp;task&nbsp;which&nbsp;was&nbsp;executed&nbsp;too&nbsp;many&nbsp;times.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10" class="other_trans">task</span>.task_try_count</span><span id="ast-11" class="correct_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-12"><span id="ast-13">self</span>.task_try_limit</span>)</span>:<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-18">(<span id="ast-19">'Task&nbsp;tries&nbsp;ended:&nbsp;%s&nbsp;/&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-21">(<span id="ast-22"><span id="ast-23" class="other_trans">task</span>.name</span>,&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">task</span>.url</span>)</span>)</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-27">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-29">(<span id="ast-30"><span id="ast-31" class="other_trans">task</span>.network_try_count</span><span id="ast-32" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-33"><span id="ast-34">self</span>.network_try_limit</span>)</span>:<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-39">(<span id="ast-40">'Network&nbsp;tries&nbsp;ended:&nbsp;%s&nbsp;/&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44" class="other_trans">task</span>.name</span>,&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">task</span>.url</span>)</span>)</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-48">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.taskq</span>.put</span>(<span id="ast-54">(<span id="ast-55"><span id="ast-56" class="other_trans">task</span>.priority</span>,&nbsp;<span id="ast-57" class="other_trans">task</span>)</span>)</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-59">True</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;generate_forward_diffusion_sample(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">X_noiseless</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Corrupt&nbsp;a&nbsp;training&nbsp;image&nbsp;with&nbsp;t&nbsp;steps&nbsp;worth&nbsp;of&nbsp;Gaussian&nbsp;noise,&nbsp;and\\u000a&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;the&nbsp;corrupted&nbsp;image,&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;mean&nbsp;and&nbsp;covariance&nbsp;of&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;posterior&nbsp;q(x^{t-1}|x^t,&nbsp;x^0).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>X_noiseless</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">X_noiseless</span>.reshape</span>(<span id="ast-12">(<span id="ast-13">-1</span>,&nbsp;<span id="ast-14"><span id="ast-15">self</span>.n_colors</span>,&nbsp;<span id="ast-16"><span id="ast-17">self</span>.spatial_width</span>,&nbsp;<span id="ast-18"><span id="ast-19">self</span>.spatial_width</span>)</span>)</span></span><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>n_images</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">X_noiseless</span>.shape</span>[<span id="ast-27"><span id="ast-28">0</span></span>]</span>.astype</span>(<span id="ast-29">'int16'</span>)</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rng</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34">Random</span>()</span>.theano_rng</span></span><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>t</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39">T</span>.floor</span>(<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">rng</span>.uniform</span>(size=<span id="ast-44">(<span id="ast-45">1</span>,&nbsp;<span id="ast-46">1</span>)</span>,&nbsp;low=<span id="ast-48">1</span>,&nbsp;high=<span id="ast-50"><span id="ast-51">self</span>.trajectory_length</span>,&nbsp;dtype=<span id="ast-53"><span id="ast-54"><span id="ast-55">theano</span>.config</span>.floatX</span>)</span>)</span></span><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>t_weights</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>.get_t_weights</span>(<span id="ast-61">t</span>)</span></span><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>N</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">rng</span>.normal</span>(size=<span id="ast-68">(<span id="ast-69" class="other_trans">n_images</span>,&nbsp;<span id="ast-70"><span id="ast-71">self</span>.n_colors</span>,&nbsp;<span id="ast-72"><span id="ast-73">self</span>.spatial_width</span>,&nbsp;<span id="ast-74"><span id="ast-75">self</span>.spatial_width</span>)</span>,&nbsp;dtype=<span id="ast-77"><span id="ast-78"><span id="ast-79">theano</span>.config</span>.floatX</span>)</span></span><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>beta_forward</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84">self</span>.get_beta_forward</span>(<span id="ast-85">t</span>)</span></span><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>alpha_forward</span>&nbsp;=&nbsp;<span id="ast-88">(<span id="ast-89">1.0</span>&nbsp;-&nbsp;<span id="ast-91" class="other_trans">beta_forward</span>)</span></span><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>alpha_arr</span>&nbsp;=&nbsp;<span id="ast-94">(<span id="ast-95">1.0</span>&nbsp;-&nbsp;<span id="ast-97"><span id="ast-98">self</span>.beta_arr</span>)</span></span><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>alpha_cum_forward_arr</span>&nbsp;=&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans">T</span>.extra_ops</span>.cumprod</span>(<span id="ast-107" class="other_trans">alpha_arr</span>)</span>.reshape</span>(<span id="ast-108">(<span id="ast-109"><span id="ast-110">self</span>.trajectory_length</span>,&nbsp;<span id="ast-111">1</span>)</span>)</span></span><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>alpha_cum_forward</span>&nbsp;=&nbsp;<span id="ast-114"><span id="ast-115"><span id="ast-116">T</span>.dot</span>(<span id="ast-117"><span id="ast-118">t_weights</span>.T</span>,&nbsp;<span id="ast-119">alpha_cum_forward_arr</span>)</span></span><span id="ast-120"><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>beta_cumulative</span>&nbsp;=&nbsp;<span id="ast-122">(<span id="ast-123">1.0</span>&nbsp;-&nbsp;<span id="ast-125">alpha_cum_forward</span>)</span></span><span id="ast-126"><span id="ast-127" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>beta_cumulative_prior_step</span>&nbsp;=&nbsp;<span id="ast-128">(<span id="ast-129">1.0</span>&nbsp;-&nbsp;<span id="ast-131">(<span id="ast-132" class="other_trans">alpha_cum_forward</span>&nbsp;/&nbsp;<span id="ast-134" class="other_trans">alpha_forward</span>)</span>)</span></span><span id="ast-135"><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>X_uniformnoise</span>&nbsp;=&nbsp;<span id="ast-137">(<span id="ast-138" class="other_trans">X_noiseless</span>&nbsp;+&nbsp;<span id="ast-140">(<span id="ast-141">(<span id="ast-142"><span id="ast-143"><span id="ast-144">rng</span>.uniform</span>(size=<span id="ast-146">(<span id="ast-147">n_images</span>,&nbsp;<span id="ast-148"><span id="ast-149">self</span>.n_colors</span>,&nbsp;<span id="ast-150"><span id="ast-151">self</span>.spatial_width</span>,&nbsp;<span id="ast-152"><span id="ast-153">self</span>.spatial_width</span>)</span>,&nbsp;dtype=<span id="ast-155"><span id="ast-156"><span id="ast-157">theano</span>.config</span>.floatX</span>)</span>&nbsp;-&nbsp;<span id="ast-159"><span id="ast-160"><span id="ast-161">T</span>.constant</span>(<span id="ast-162">0.5</span>,&nbsp;dtype=<span id="ast-164"><span id="ast-165"><span id="ast-166">theano</span>.config</span>.floatX</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-168"><span id="ast-169"><span id="ast-170">T</span>.constant</span>(<span id="ast-171"><span id="ast-172">self</span>.uniform_noise</span>,&nbsp;dtype=<span id="ast-174"><span id="ast-175"><span id="ast-176">theano</span>.config</span>.floatX</span>)</span>)</span>)</span></span><span id="ast-177"><span id="ast-178" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>X_noisy</span>&nbsp;=&nbsp;<span id="ast-179">(<span id="ast-180">(<span id="ast-181">X_uniformnoise</span>&nbsp;*&nbsp;<span id="ast-183"><span id="ast-184"><span id="ast-185" class="other_trans">T</span>.sqrt</span>(<span id="ast-186">alpha_cum_forward</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-188">(<span id="ast-189">N</span>&nbsp;*&nbsp;<span id="ast-191"><span id="ast-192"><span id="ast-193" class="other_trans">T</span>.sqrt</span>(<span id="ast-194">(<span id="ast-195">1.0</span>&nbsp;-&nbsp;<span id="ast-197" class="other_trans">alpha_cum_forward</span>)</span>)</span>)</span>)</span></span><span id="ast-198"><span id="ast-199" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mu1_scl</span>&nbsp;=&nbsp;<span id="ast-200"><span id="ast-201"><span id="ast-202" class="other_trans">T</span>.sqrt</span>(<span id="ast-203">(<span id="ast-204">alpha_cum_forward</span>&nbsp;/&nbsp;<span id="ast-206">alpha_forward</span>)</span>)</span></span><span id="ast-207"><span id="ast-208" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mu2_scl</span>&nbsp;=&nbsp;<span id="ast-209">(<span id="ast-210">1.0</span>&nbsp;/&nbsp;<span id="ast-212"><span id="ast-213"><span id="ast-214">T</span>.sqrt</span>(<span id="ast-215" class="other_trans">alpha_forward</span>)</span>)</span></span><span id="ast-216"><span id="ast-217" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cov1&nbsp;&rarr;&nbsp;cov2&nbsp;</span>&nbsp;=&nbsp;<span id="ast-218">(<span id="ast-219">1.0</span>&nbsp;-&nbsp;<span id="ast-221">(<span id="ast-222">alpha_cum_forward</span>&nbsp;/&nbsp;<span id="ast-224" class="other_trans">alpha_forward</span>)</span>)</span></span><span id="ast-225"><span id="ast-226" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cov2</span>&nbsp;=&nbsp;<span id="ast-227">(<span id="ast-228">beta_forward</span>&nbsp;/&nbsp;<span id="ast-230">alpha_forward</span>)</span></span><span id="ast-231"><span id="ast-232"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lam</span>&nbsp;=&nbsp;<span id="ast-233">(<span id="ast-234">(<span id="ast-235">1.0</span>&nbsp;/&nbsp;<span id="ast-237" class="other_trans">cov1</span>)</span>&nbsp;+&nbsp;<span id="ast-239">(<span id="ast-240">1.0</span>&nbsp;/&nbsp;<span id="ast-242">cov2</span>)</span>)</span></span><span id="ast-243"><span id="ast-244" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mu</span>&nbsp;=&nbsp;<span id="ast-245">(<span id="ast-246">(<span id="ast-247">(<span id="ast-248">(<span id="ast-249" class="ref_node">X_noiseless&nbsp;&rarr;&nbsp;X_uniformnoise&nbsp;</span>&nbsp;*&nbsp;<span id="ast-251" class="other_trans">mu1_scl</span>)</span>&nbsp;/&nbsp;<span id="ast-253" class="other_trans">cov1</span>)</span>&nbsp;+&nbsp;<span id="ast-255">(<span id="ast-256">(<span id="ast-257" class="other_trans">X_noisy</span>&nbsp;*&nbsp;<span id="ast-259">mu2_scl</span>)</span>&nbsp;/&nbsp;<span id="ast-261" class="other_trans">cov2</span>)</span>)</span>&nbsp;/&nbsp;<span id="ast-263">lam</span>)</span></span><span id="ast-264"><span id="ast-265"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sigma</span>&nbsp;=&nbsp;<span id="ast-266"><span id="ast-267"><span id="ast-268">T</span>.sqrt</span>(<span id="ast-269">(<span id="ast-270">1.0</span>&nbsp;/&nbsp;<span id="ast-272">lam</span>)</span>)</span></span><span id="ast-273"><span id="ast-274"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sigma</span>&nbsp;=&nbsp;<span id="ast-275"><span id="ast-276"><span id="ast-277" class="other_trans">sigma</span>.reshape</span>(<span id="ast-278">(<span id="ast-279">1</span>,&nbsp;<span id="ast-280">1</span>,&nbsp;<span id="ast-281">1</span>,&nbsp;<span id="ast-282">1</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;enumerate(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span>,&nbsp;<span id="ast-4" class="other_trans">with_history</span>,&nbsp;<span id="ast-6" class="other_trans">above_zero</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9" class="other_trans">with_history</span>:<span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">cls</span>.query</span>.options</span>(<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">orm</span>.joinedload</span>(<span id="ast-19"><span id="ast-20" class="other_trans">cls</span>.score_history</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">cls</span>.query</span></span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26" class="other_trans">above_zero</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">base</span>.filter</span>(<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">cls</span>.score</span><span id="ast-35" class="correct_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-36">0</span>)</span>)</span></span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sorting</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">base</span>.order_by</span>(<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">cls</span>.score</span>.desc</span>()</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">enumerate</span>(<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">sorting</span>.all</span>()</span>,&nbsp;<span id="ast-52">1</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;button2action(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">event</span>,&nbsp;<span id="ast-6" class="other_trans">debug</span>,&nbsp;<span id="ast-8" class="other_trans">subtract</span>,&nbsp;<span id="ast-10" class="other_trans">powerlaw</span>,&nbsp;<span id="ast-12" class="other_trans">fit_original</span>,&nbsp;<span id="ast-14" class="other_trans">baseline_fit_color</span>,&nbsp;**kwargs</span>):<span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Do&nbsp;the&nbsp;baseline&nbsp;fitting&nbsp;and&nbsp;save&nbsp;and&nbsp;plot&nbsp;the&nbsp;results.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19" class="other_trans">debug</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-21">'Button&nbsp;2/3&nbsp;Baseline.&nbsp;&nbsp;Subtract='</span>,&nbsp;<span id="ast-22" class="other_trans">subtract</span></span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24"><span id="ast-25">self</span>.subtracted</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.unsubtract</span>()</span></span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32">'nwidths'</span><span id="ast-33">&nbsp;in&nbsp;</span><span id="ast-34" class="other_trans">kwargs</span>)</span>:<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>.pop</span>(<span id="ast-39">'nwidths'</span>)</span></span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">powerlaw</span><span id="ast-43" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-44" class="other_trans">None</span>)</span>:<span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>powerlaw</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48">self</span>.powerlaw</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;query_url_mapping(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">filepath</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Searches&nbsp;the&nbsp;environment-wide&nbsp;url&nbsp;mapping&nbsp;(based&nbsp;on&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;urls&nbsp;assigned&nbsp;to&nbsp;each&nbsp;directory&nbsp;in&nbsp;the&nbsp;load&nbsp;path).&nbsp;Returns\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;correct&nbsp;url&nbsp;for&nbsp;``filepath``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Subclasses&nbsp;should&nbsp;be&nbsp;sure&nbsp;that&nbsp;they&nbsp;really&nbsp;want&nbsp;to&nbsp;call&nbsp;this\\u000a&nbsp;&nbsp;&nbsp;&nbsp;method,&nbsp;instead&nbsp;of&nbsp;simply&nbsp;falling&nbsp;back&nbsp;to&nbsp;``super()``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mapping</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">list</span>(<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.env</span>.url_mapping</span>.items</span>()</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mapping</span>.append</span>(<span id="ast-21">(<span id="ast-22"><span id="ast-23"><span id="ast-24">self</span>.env</span>.directory</span>,&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27">self</span>.env</span>.url</span>)</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-29" class="other_trans">EnvironmentError</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mapping</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34">list</span>(<span id="ast-35"><span id="ast-36">map</span>(<span id="ast-37">lambda&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">p_u</span></span>:&nbsp;<span id="ast-40">(<span id="ast-41"><span id="ast-42"><span id="ast-43">path</span>.normpath</span>(<span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans">path</span>.abspath</span>(<span id="ast-47"><span id="ast-48" class="other_trans">p_u</span>[<span id="ast-49"><span id="ast-50">0</span></span>]</span>)</span>)</span>,&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">p_u</span>[<span id="ast-53"><span id="ast-54">1</span></span>]</span>)</span></span>,&nbsp;<span id="ast-55" class="other_trans">mapping</span>)</span>)</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mapping</span>.sort</span>(key=<span id="ast-61">lambda&nbsp;<span id="ast-62"><span id="ast-63">i</span></span>:&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">len</span>(<span id="ast-66"><span id="ast-67" class="other_trans">i</span>[<span id="ast-68"><span id="ast-69">0</span></span>]</span>)</span></span>,&nbsp;reverse=<span id="ast-71">True</span>)</span></span><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>needle</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76">path</span>.normpath</span>(<span id="ast-77" class="other_trans">filepath</span>)</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-79">(<span id="ast-80" class="other_trans">candidate</span>,&nbsp;<span id="ast-81">url</span>)</span>&nbsp;in&nbsp;<span id="ast-82" class="other_trans">mapping</span>:<span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans">needle</span>.startswith</span>(<span id="ast-87" class="other_trans">candidate</span>)</span>:<span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rel_path</span>&nbsp;=&nbsp;<span id="ast-90"><span id="ast-91" class="correct_node">filepath&nbsp;&rarr;&nbsp;needle&nbsp;</span>[<span id="ast-92"><span id="ast-93">(<span id="ast-94"><span id="ast-95">len</span>(<span id="ast-96" class="other_trans">candidate</span>)</span>&nbsp;+&nbsp;<span id="ast-98">1</span>)</span>:</span>]</span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-100"><span id="ast-101">url_prefix_join</span>(<span id="ast-102" class="other_trans">url</span>,&nbsp;<span id="ast-103" class="other_trans">rel_path</span>)</span></span></span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-105"><span id="ast-106" class="other_trans">ValueError</span>(<span id="ast-107">(<span id="ast-108">'Cannot&nbsp;determine&nbsp;url&nbsp;for&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-110" class="other_trans">filepath</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;begin_site(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Initialize&nbsp;plugin.&nbsp;Retrieve&nbsp;dates&nbsp;from&nbsp;git\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-7" class="other_trans">node</span>&nbsp;in&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.site</span>.content</span>.walk</span>()</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-14" class="other_trans">resource</span>&nbsp;in&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">node</span>.resources</span>:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>created</span>&nbsp;=&nbsp;<span id="ast-19">None</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>modified</span>&nbsp;=&nbsp;<span id="ast-22" class="other_trans">None</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>created</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28">resource</span>.meta</span>.created</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>modified</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">resource</span>.meta</span>.modified</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-35">AttributeError</span>:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-40">(<span id="ast-41" class="other_trans">created</span><span id="ast-42" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-43">'git'</span>)</span>&nbsp;and&nbsp;<span id="ast-44">(<span id="ast-45">modified</span><span id="ast-46" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-47">'git'</span>)</span>)</span>:<span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>commits</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">subprocess</span>.check_output</span>(<span id="ast-57">[<span id="ast-58">'git'</span>,&nbsp;<span id="ast-59">'log'</span>,&nbsp;<span id="ast-60">'--pretty=%ai'</span>,&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">resource</span>.path</span>]</span>)</span>.split</span>(<span id="ast-63">'\\u000a'</span>)</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">subprocess</span>.CalledProcessError</span>:<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.warning</span>(<span id="ast-72">(<span id="ast-73">'Unable&nbsp;to&nbsp;get&nbsp;git&nbsp;history&nbsp;for&nbsp;[%s]'</span>&nbsp;%&nbsp;<span id="ast-75" class="other_trans">resource</span>)</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>commits</span>&nbsp;=&nbsp;<span id="ast-79"><span id="ast-80" class="other_trans">commits</span>[<span id="ast-81">:<span id="ast-82">-1</span></span>]</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85">not</span>&nbsp;<span id="ast-86" class="other_trans">commits</span>)</span>:<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.warning</span>(<span id="ast-92">(<span id="ast-93">'No&nbsp;git&nbsp;history&nbsp;for&nbsp;[%s]'</span>&nbsp;%&nbsp;<span id="ast-95">resource</span>)</span>)</span></span><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-98">(<span id="ast-99" class="other_trans">created</span><span id="ast-100" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-101">'git'</span>)</span>:<span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>created</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105" class="incorrect_node">parse&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans">commits</span>[<span id="ast-110"><span id="ast-111">-1</span></span>]</span>.strip</span>()</span>)</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resource</span>.meta</span>.created</span>&nbsp;=&nbsp;<span id="ast-116" class="other_trans">created</span></span></span><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-118">(<span id="ast-119" class="other_trans">modified</span><span id="ast-120" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-121">'git'</span>)</span>:<span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>modified</span>&nbsp;=&nbsp;<span id="ast-124"><span id="ast-125">parse</span>(<span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129" class="other_trans">commits</span>[<span id="ast-130"><span id="ast-131">0</span></span>]</span>.strip</span>()</span>)</span></span><span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resource</span>.meta</span>.modified</span>&nbsp;=&nbsp;<span id="ast-136" class="ref_node">created&nbsp;&rarr;&nbsp;modified&nbsp;</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;refute_delete_button(<span id="ast-2"><span id="ast-3" class="other_trans">response</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elem</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">response</span>.lxml</span>.cssselect</span>(<span id="ast-10">'.submit-row&nbsp;.deletelink-box'</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14" class="other_trans">len</span>(<span id="ast-15" class="other_trans">elem</span>)</span><span id="ast-16" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-17">0</span>)</span>,&nbsp;<span id="ast-18">'Found&nbsp;delete&nbsp;button,&nbsp;should&nbsp;not&nbsp;exist'</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">common</span>,&nbsp;<span id="ast-5" class="other_trans">models</span>,&nbsp;<span id="ast-6" class="other_trans">cb</span></span>):<span id="ast-7"><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.common</span>&nbsp;=&nbsp;<span id="ast-10" class="other_trans">common</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>title</span>&nbsp;=&nbsp;<span id="ast-13">'Choose&nbsp;an&nbsp;existing&nbsp;Juju&nbsp;Model&nbsp;to&nbsp;deploy&nbsp;the&nbsp;solution&nbsp;to'</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>_models</span>&nbsp;=&nbsp;<span id="ast-16">[]</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-18" class="other_trans">name</span>&nbsp;in&nbsp;<span id="ast-19" class="other_trans">models</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">name</span><span id="ast-23">&nbsp;in&nbsp;</span><span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>.common</span>[<span id="ast-27"><span id="ast-28">'juju-models'</span></span>]</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_model</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34">self</span>.common</span>[<span id="ast-35"><span id="ast-36">'juju-models'</span></span>]</span>[<span id="ast-37"><span id="ast-38" class="other_trans">name</span></span>]</span></span><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_models</span>.append</span>(<span id="ast-43">(<span id="ast-44"><span id="ast-45" class="other_trans">_model</span>.name</span>,&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">_model</span>.description</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_models</span>.append</span>(<span id="ast-52">(<span id="ast-53" class="other_trans">name</span>,&nbsp;<span id="ast-54">''</span>)</span>)</span></span></span></span><span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>()</span>.__init__</span>(<span id="ast-60" class="other_trans">title</span>,&nbsp;<span id="ast-61" class="correct_node">models&nbsp;&rarr;&nbsp;_models&nbsp;</span>,&nbsp;<span id="ast-62" class="other_trans">cb</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;handle(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;*args,&nbsp;**options</span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>yesterday</span>&nbsp;=&nbsp;<span id="ast-6">(<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">timezone</span>.now</span>()</span>&nbsp;-&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">timezone</span>.timedelta</span>(<span id="ast-14">1</span>)</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16" class="other_trans">package</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">Package</span>.objects</span>.filter</span>()</span>.iterator</span>()</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>package</span>.repo</span>.fetch_metadata</span>(<span id="ast-28" class="other_trans">package</span>,&nbsp;fetch_pypi=<span id="ast-30">False</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">package</span>.last_fetched</span><span id="ast-35" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-36" class="other_trans">yesterday</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>package</span>.repo</span>.fetch_commits</span>(<span id="ast-43" class="other_trans">package</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getPathToStorage(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;the&nbsp;path&nbsp;to&nbsp;a&nbsp;place&nbsp;for&nbsp;writing&nbsp;supporting&nbsp;files'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8" class="incorrect_node">platform&nbsp;&rarr;&nbsp;self.&nbsp;</span><span id="ast-9" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-10">'win32'</span>)</span>:<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">join</span>(<span id="ast-15"><span id="ast-16" class="ref_node">getPathToSelf&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span>,&nbsp;<span id="ast-17">'trainingdata'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">unicode</span>(<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">QDesktopServices</span>.storageLocation</span>(<span id="ast-25"><span id="ast-26" class="other_trans">QDesktopServices</span>.DataLocation</span>)</span>)</span></span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-29">not</span>&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">isdir</span>(<span id="ast-32" class="other_trans">path</span>)</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>makedirs</span>(<span id="ast-36" class="other_trans">path</span>)</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-38" class="other_trans">path</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_bake_spikes(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>waveforms</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">np</span>.swapaxes</span>(<span id="ast-9"><span id="ast-10">self</span>._waveforms</span>,&nbsp;<span id="ast-11">1</span>,&nbsp;<span id="ast-12">2</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>masks</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">np</span>.repeat</span>(<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>._masks</span>.ravel</span>()</span>,&nbsp;<span id="ast-22"><span id="ast-23">self</span>.n_samples</span>)</span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">np</span>.c_</span>[<span id="ast-31"><span id="ast-32">(<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">waveforms</span>.ravel</span>()</span>,&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="incorrect_node">masks&nbsp;&rarr;&nbsp;waveforms&nbsp;</span>.ravel</span>()</span>)</span></span>]</span>.astype</span>(<span id="ast-39"><span id="ast-40" class="other_trans">np</span>.float32</span>)</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.program</span>[<span id="ast-45"><span id="ast-46">'a_data'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-47" class="other_trans">data</span></span><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._channels_per_spike</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">np</span>.tile</span>(<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">np</span>.arange</span>(<span id="ast-59"><span id="ast-60">self</span>.n_channels</span>)</span>.astype</span>(<span id="ast-61"><span id="ast-62" class="other_trans">np</span>.float32</span>)</span>,&nbsp;<span id="ast-63"><span id="ast-64">self</span>.n_spikes</span>)</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._n_channels_per_spike</span>&nbsp;=&nbsp;<span id="ast-68">(<span id="ast-69"><span id="ast-70">self</span>.n_channels</span>&nbsp;*&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74">np</span>.ones</span>(<span id="ast-75"><span id="ast-76">self</span>.n_spikes</span>,&nbsp;dtype=<span id="ast-78"><span id="ast-79" class="other_trans">np</span>.int32</span>)</span>)</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._n_waveforms</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">np</span>.sum</span>(<span id="ast-86"><span id="ast-87">self</span>._n_channels_per_spike</span>)</span></span><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>a_time</span>&nbsp;=&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans">np</span>.tile</span>(<span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans">np</span>.linspace</span>(<span id="ast-98">-1.0</span>,&nbsp;<span id="ast-99">1.0</span>,&nbsp;<span id="ast-100"><span id="ast-101">self</span>.n_samples</span>)</span>,&nbsp;<span id="ast-102"><span id="ast-103">self</span>._n_waveforms</span>)</span>.astype</span>(<span id="ast-104"><span id="ast-105">np</span>.float32</span>)</span></span><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.program</span>[<span id="ast-110"><span id="ast-111">'a_time'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-112" class="other_trans">a_time</span></span><span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.program</span>[<span id="ast-117"><span id="ast-118">'n_clusters'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-119"><span id="ast-120">self</span>.n_clusters</span></span><span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.program</span>[<span id="ast-125"><span id="ast-126">'n_channels'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-127"><span id="ast-128">self</span>.n_channels</span></span><span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>debug</span>(<span id="ast-132">'bake&nbsp;spikes'</span>,&nbsp;<span id="ast-133"><span id="ast-134" class="ref_node">data&nbsp;&rarr;&nbsp;waveforms&nbsp;</span>.shape</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;submit(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>results</span>&nbsp;=&nbsp;<span id="ast-6">[]</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>requests</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10">self</span>.requests</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>results</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>._submit</span>()</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>._graph_db</span>.neo4j_version</span><span id="ast-22" class="correct_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-23">(<span id="ast-24">1</span>,&nbsp;<span id="ast-25">8</span>,&nbsp;<span id="ast-26">'M07'</span>)</span>)</span>:<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._check_for_conflicts</span>(<span id="ast-31" class="other_trans">results</span>,&nbsp;<span id="ast-32" class="other_trans">requests</span>)</span></span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">rest</span>.ResourceConflict</span>&nbsp;as&nbsp;<span id="ast-36" class="other_trans">r</span>:<span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">requests</span>[<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">r</span>.id</span></span>]</span>.body</span>[<span id="ast-46"><span id="ast-47">'key'</span></span>]</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">requests</span>[<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">r</span>.id</span></span>]</span>.body</span>[<span id="ast-57"><span id="ast-58">'value'</span></span>]</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">UniqueProperty</span>(<span id="ast-62" class="other_trans">key</span>,&nbsp;<span id="ast-63" class="other_trans">value</span>,&nbsp;<span id="ast-64"><span id="ast-65">self</span>.index_name</span>,&nbsp;<span id="ast-66"><span id="ast-67">self</span>.node</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;displayImg(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">previousPicture</span>,&nbsp;<span id="ast-5">stage</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dataBuffer</span>&nbsp;=&nbsp;<span id="ast-8">[]</span></span><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>idx</span>&nbsp;=&nbsp;<span id="ast-11">0</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pre</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.PATTERNS</span>[<span id="ast-17"><span id="ast-18">(<span id="ast-19" class="other_trans">stage</span>&nbsp;-&nbsp;<span id="ast-21">1</span>)</span></span>]</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>post</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>.PATTERNS</span>[<span id="ast-27"><span id="ast-28">(<span id="ast-29">(<span id="ast-30" class="incorrect_node">stage&nbsp;&rarr;&nbsp;idx&nbsp;</span>&nbsp;+&nbsp;<span id="ast-32">1</span>)</span>&nbsp;%&nbsp;<span id="ast-34"><span id="ast-35">len</span>(<span id="ast-36"><span id="ast-37">self</span>.PATTERNS</span>)</span>)</span></span>]</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-39" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-40"><span id="ast-41">range</span>(<span id="ast-42"><span id="ast-43"><span id="ast-44">self</span>.COG_Params</span>.vertical</span>)</span>:<span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>k</span>&nbsp;=&nbsp;<span id="ast-47">(<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>.COG_Params</span>.horizontal</span>&nbsp;-&nbsp;<span id="ast-52">1</span>)</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-54">j</span>&nbsp;in&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">range</span>(<span id="ast-57"><span id="ast-58"><span id="ast-59">self</span>.COG_Params</span>.horizontal</span>)</span>:<span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tempByte</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">previousPicture</span>[<span id="ast-64"><span id="ast-65">idx</span></span>]</span></span><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>idx</span>&nbsp;+=&nbsp;<span id="ast-69">1</span></span><span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.odd</span>[<span id="ast-74"><span id="ast-75" class="other_trans">j</span></span>]</span>&nbsp;=&nbsp;<span id="ast-76">0</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.even</span>[<span id="ast-81"><span id="ast-82" class="other_trans">k</span></span>]</span>&nbsp;=&nbsp;<span id="ast-83">0</span></span><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-85" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-86"><span id="ast-87" class="other_trans">range</span>(<span id="ast-88"><span id="ast-89">len</span>(<span id="ast-90">pre</span>)</span>)</span>:<span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.odd</span>[<span id="ast-95"><span id="ast-96" class="other_trans">j</span></span>]</span>&nbsp;|=&nbsp;<span id="ast-98"><span id="ast-110"><span id="ast-111" class="other_trans">pre</span>[<span id="ast-112"><span id="ast-113" class="other_trans">s</span></span>]</span>&nbsp;if&nbsp;<span id="ast-99">(<span id="ast-100" class="other_trans">tempByte</span>&nbsp;&amp;&nbsp;<span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105">self</span>.TESTS</span>[<span id="ast-106"><span id="ast-107">0</span></span>]</span>[<span id="ast-108"><span id="ast-109" class="other_trans">s</span></span>]</span>)</span>&nbsp;else&nbsp;<span id="ast-114"><span id="ast-115" class="other_trans">post</span>[<span id="ast-116"><span id="ast-117" class="other_trans">s</span></span>]</span></span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.even</span>[<span id="ast-122"><span id="ast-123" class="other_trans">k</span></span>]</span>&nbsp;|=&nbsp;<span id="ast-125"><span id="ast-137"><span id="ast-138">pre</span>[<span id="ast-139"><span id="ast-140">s</span></span>]</span>&nbsp;if&nbsp;<span id="ast-126">(<span id="ast-127" class="other_trans">tempByte</span>&nbsp;&amp;&nbsp;<span id="ast-129"><span id="ast-130"><span id="ast-131"><span id="ast-132">self</span>.TESTS</span>[<span id="ast-133"><span id="ast-134">1</span></span>]</span>[<span id="ast-135"><span id="ast-136">s</span></span>]</span>)</span>&nbsp;else&nbsp;<span id="ast-141"><span id="ast-142">post</span>[<span id="ast-143"><span id="ast-144" class="other_trans">s</span></span>]</span></span></span></span><span id="ast-145"><span id="ast-146" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>k</span>&nbsp;-=&nbsp;<span id="ast-148">1</span></span></span><span id="ast-149"><span id="ast-150"><span id="ast-151"><span id="ast-152"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scan</span>[<span id="ast-153"><span id="ast-154">(<span id="ast-155" class="other_trans">i</span>&nbsp;&gt;&gt;&nbsp;<span id="ast-157">2</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-158"><span id="ast-159"><span id="ast-160">self</span>.scanTable</span>[<span id="ast-161"><span id="ast-162">(<span id="ast-163">i</span>&nbsp;%&nbsp;<span id="ast-165">4</span>)</span></span>]</span></span><span id="ast-166"><span id="ast-167" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-168">(<span id="ast-169">(<span id="ast-170"><span id="ast-171">self</span>.even</span>&nbsp;+&nbsp;<span id="ast-173"><span id="ast-174">self</span>.scan</span>)</span>&nbsp;+&nbsp;<span id="ast-176"><span id="ast-177">self</span>.odd</span>)</span></span><span id="ast-178"><span id="ast-179"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;+=&nbsp;<span id="ast-181">(<span id="ast-182">[<span id="ast-183"><span id="ast-184">self</span>.NOTHING</span>]</span>&nbsp;*&nbsp;<span id="ast-186">(<span id="ast-187"><span id="ast-188"><span id="ast-189">self</span>.COG_Params</span>.dataLineSize</span>&nbsp;-&nbsp;<span id="ast-191"><span id="ast-192">len</span>(<span id="ast-193" class="other_trans">data</span>)</span>)</span>)</span></span><span id="ast-194"><span id="ast-195"><span id="ast-196"><span id="ast-197"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dataBuffer</span>.append</span>(<span id="ast-198"><span id="ast-199">str</span>(<span id="ast-200"><span id="ast-201" class="other_trans">bytearray</span>(<span id="ast-202" class="other_trans">data</span>)</span>)</span>)</span></span><span id="ast-203"><span id="ast-204"><span id="ast-205" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>scan&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-206"><span id="ast-207">(<span id="ast-208" class="other_trans">i</span>&nbsp;&gt;&gt;&nbsp;<span id="ast-210">2</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-211"><span id="ast-212">self</span>.NOTHING</span></span></span><span id="ast-213"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-214" class="other_trans">dataBuffer</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;setup(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Setup&nbsp;the&nbsp;TargetManager&nbsp;object&nbsp;with&nbsp;the&nbsp;input&nbsp;params.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Define&nbsp;the&nbsp;location&nbsp;(chrom,&nbsp;start,&nbsp;end),&nbsp;file&nbsp;paths,&nbsp;directory&nbsp;paths,&nbsp;and&nbsp;name.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;None\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;None\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>intervals</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.params</span>.get_target_intervals</span>(<span id="ast-12"><span id="ast-13">self</span>.name</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-15" class="other_trans">values</span>&nbsp;in&nbsp;<span id="ast-16" class="other_trans">intervals</span>:<span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-19" class="other_trans">chrom</span>,&nbsp;<span id="ast-20" class="other_trans">start</span>,&nbsp;<span id="ast-21" class="other_trans">end</span>)</span>&nbsp;=&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24" class="other_trans">values</span>[<span id="ast-25"><span id="ast-26">0</span></span>]</span>,&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">int</span>(<span id="ast-29"><span id="ast-30" class="other_trans">values</span>[<span id="ast-31"><span id="ast-32">1</span></span>]</span>)</span>,&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">int</span>(<span id="ast-35"><span id="ast-36" class="other_trans">values</span>[<span id="ast-37"><span id="ast-38">2</span></span>]</span>)</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41" class="ref_node">chrom&nbsp;&rarr;&nbsp;self.&nbsp;</span><span id="ast-42" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-43">None</span>)</span>:<span id="ast-44"><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.chrom</span>&nbsp;=&nbsp;<span id="ast-47" class="other_trans">chrom</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-50"><span id="ast-51">self</span>.start</span><span id="ast-52" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-53" class="other_trans">None</span>)</span>:<span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.start</span>&nbsp;=&nbsp;<span id="ast-57" class="other_trans">start</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-59">(<span id="ast-60" class="other_trans">start</span><span id="ast-61" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-62"><span id="ast-63">self</span>.start</span>)</span>:<span id="ast-64"><span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.start</span>&nbsp;=&nbsp;<span id="ast-67" class="other_trans">start</span></span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-70"><span id="ast-71">self</span>.end</span><span id="ast-72" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-73" class="other_trans">None</span>)</span>:<span id="ast-74"><span id="ast-75"><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.end</span>&nbsp;=&nbsp;<span id="ast-77" class="other_trans">end</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-79">(<span id="ast-80" class="other_trans">end</span><span id="ast-81" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-82"><span id="ast-83">self</span>.end</span>)</span>:<span id="ast-84"><span id="ast-85"><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.end</span>&nbsp;=&nbsp;<span id="ast-87" class="other_trans">end</span></span></span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-89">'Region&nbsp;coords'</span>,&nbsp;<span id="ast-90"><span id="ast-91">self</span>.chrom</span>,&nbsp;<span id="ast-92"><span id="ast-93">self</span>.start</span>,&nbsp;<span id="ast-94"><span id="ast-95">self</span>.end</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;modify(<span id="ast-2"><span id="ast-3">name</span>,&nbsp;<span id="ast-4" class="other_trans">comment</span>,&nbsp;<span id="ast-6" class="other_trans">home</span>,&nbsp;<span id="ast-8">move_current_home</span>,&nbsp;<span id="ast-10" class="other_trans">group</span>,&nbsp;<span id="ast-12">extra_groups</span>,&nbsp;<span id="ast-14">login_name</span>,&nbsp;<span id="ast-16" class="other_trans">password</span>,&nbsp;<span id="ast-18" class="other_trans">shell</span>,&nbsp;<span id="ast-20">uid</span></span>):<span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Modify&nbsp;an&nbsp;existing&nbsp;user.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Example::\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;fabtools\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;fabtools.user.exists('alice'):\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fabtools.user.modify('alice',&nbsp;shell='/bin/sh')\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-26">[]</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28" class="other_trans">comment</span>:<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-33">(<span id="ast-34">'-c&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">quote</span>(<span id="ast-38" class="other_trans">comment</span>)</span>)</span>)</span></span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">home</span>:<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-45">(<span id="ast-46">'-d&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-48"><span id="ast-49">quote</span>(<span id="ast-50">home</span>)</span>)</span>)</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52" class="other_trans">move_current_home</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-57">'-m'</span>)</span></span></span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59" class="other_trans">group</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-64">(<span id="ast-65">'-g&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">quote</span>(<span id="ast-69" class="other_trans">group</span>)</span>)</span>)</span></span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-71" class="other_trans">extra_groups</span>:<span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>groups</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76">','</span>.join</span>(<span id="ast-77">(<span id="ast-78"><span id="ast-79">quote</span>(<span id="ast-80">group</span>)</span><span id="ast-81">&nbsp;for&nbsp;<span id="ast-82">group</span>&nbsp;in&nbsp;<span id="ast-83" class="correct_node">groups&nbsp;&rarr;&nbsp;extra_groups&nbsp;</span></span>)</span>)</span></span><span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-88">(<span id="ast-89">'-G&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-91">groups</span>)</span>)</span></span></span><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-93">login_name</span>:<span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-98">(<span id="ast-99">'-l&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">quote</span>(<span id="ast-103" class="other_trans">login_name</span>)</span>)</span>)</span></span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-105" class="other_trans">password</span>:<span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>crypted_password</span>&nbsp;=&nbsp;<span id="ast-108"><span id="ast-109">_crypt_password</span>(<span id="ast-110" class="other_trans">password</span>)</span></span><span id="ast-111"><span id="ast-112"><span id="ast-113"><span id="ast-114" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-115">(<span id="ast-116">'-p&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-118"><span id="ast-119">quote</span>(<span id="ast-120" class="other_trans">crypted_password</span>)</span>)</span>)</span></span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122">shell</span>:<span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-127">(<span id="ast-128">'-s&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-130"><span id="ast-131">quote</span>(<span id="ast-132" class="other_trans">shell</span>)</span>)</span>)</span></span></span><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-134">uid</span>:<span id="ast-135"><span id="ast-136"><span id="ast-137"><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-139">(<span id="ast-140">'-u&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-142"><span id="ast-143">quote</span>(<span id="ast-144" class="other_trans">uid</span>)</span>)</span>)</span></span></span><span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-149" class="other_trans">name</span>)</span></span><span id="ast-150"><span id="ast-151"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-152"><span id="ast-153"><span id="ast-154">'&nbsp;'</span>.join</span>(<span id="ast-155">args</span>)</span></span><span id="ast-156"><span id="ast-157"><span id="ast-158" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sudo</span>(<span id="ast-159">(<span id="ast-160">'usermod&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-162" class="other_trans">args</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span>,&nbsp;<span id="ast-5" class="other_trans">count</span>,&nbsp;<span id="ast-7" class="other_trans">resolution</span></span>):<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>librato&nbsp;&rarr;&nbsp;self.&nbsp;</span>.get</span>(<span id="ast-13" class="other_trans">name</span>,&nbsp;<span id="ast-14" class="other_trans">count</span>,&nbsp;<span id="ast-15" class="other_trans">resolution</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;wrapper(<span id="ast-2">*args,&nbsp;**kwargs</span>):<span id="ast-3"><span id="ast-4" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ts</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans">time</span>.time</span>()</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-9">1</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">func</span>(*<span id="ast-14" class="other_trans">args</span>,&nbsp;**<span id="ast-15" class="other_trans">kwargs</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-17" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-18" class="other_trans">_</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bad</span>&nbsp;=&nbsp;<span id="ast-21">(<span id="ast-22">(<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-27" class="other_trans">ts</span>)</span><span id="ast-28" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-29" class="other_trans">timeout</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-33" class="other_trans">bad</span>&nbsp;and&nbsp;<span id="ast-34">(<span id="ast-35" class="other_trans">default</span><span id="ast-36" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-37" class="other_trans">None</span>)</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-39">0</span>,&nbsp;<span id="ast-40">(<span id="ast-41">'timeout&nbsp;exceeded&nbsp;@&nbsp;%s()'</span>&nbsp;%&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">func</span>.__name__</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-46" class="other_trans">bad</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-48" class="other_trans">default</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-53" class="other_trans">pause</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;upload(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">pdf</span>,&nbsp;<span id="ast-5">title</span>,&nbsp;<span id="ast-7" class="other_trans">source</span>,&nbsp;<span id="ast-9" class="other_trans">description</span>,&nbsp;<span id="ast-11" class="other_trans">related_article</span>,&nbsp;<span id="ast-13" class="other_trans">published_url</span>,&nbsp;<span id="ast-15">access</span>,&nbsp;<span id="ast-17">project</span>,&nbsp;<span id="ast-19" class="other_trans">data</span>,&nbsp;<span id="ast-21" class="other_trans">secure</span></span>):<span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Upload&nbsp;a&nbsp;PDF&nbsp;or&nbsp;other&nbsp;image&nbsp;file&nbsp;to&nbsp;DocumentCloud.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;can&nbsp;submit&nbsp;either&nbsp;a&nbsp;pdf&nbsp;opened&nbsp;as&nbsp;a&nbsp;file&nbsp;object&nbsp;or&nbsp;a&nbsp;path&nbsp;to&nbsp;a&nbsp;pdf&nbsp;file.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Example&nbsp;usage:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;From&nbsp;a&nbsp;file&nbsp;path\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&nbsp;documentcloud.documents.upload("/home/ben/sample.pdf",&nbsp;"sample&nbsp;title")\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;From&nbsp;a&nbsp;file&nbsp;object\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&nbsp;pdf&nbsp;=&nbsp;open(path,&nbsp;\'rb\')\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;&nbsp;documentcloud.documents.upload(pdf,&nbsp;"sample&nbsp;title")\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;the&nbsp;document&nbsp;that\'s&nbsp;created&nbsp;as&nbsp;a&nbsp;Document&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Based&nbsp;on&nbsp;code&nbsp;developed&nbsp;by&nbsp;Mitchell&nbsp;Kotler&nbsp;and&nbsp;refined&nbsp;by&nbsp;Christopher&nbsp;Groskopf.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26"><span id="ast-27">hasattr</span>(<span id="ast-28" class="other_trans">pdf</span>,&nbsp;<span id="ast-29">'read'</span>)</span>:<span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>&nbsp;=&nbsp;<span id="ast-32">{<span id="ast-33">'file'</span>:&nbsp;<span id="ast-34" class="other_trans">pdf</span>}</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>&nbsp;=&nbsp;<span id="ast-37">{<span id="ast-38">'file'</span>:&nbsp;<span id="ast-39"><span id="ast-40">open</span>(<span id="ast-41">pdf</span>,&nbsp;<span id="ast-42">'rb'</span>)</span>}</span></span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-44">title</span>:<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-48"><span id="ast-49">'title'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-50" class="other_trans">title</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">hasattr</span>(<span id="ast-54" class="ref_node">data&nbsp;&rarr;&nbsp;pdf&nbsp;</span>,&nbsp;<span id="ast-55">'read'</span>)</span>:<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-59"><span id="ast-60">'title'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68">pdf</span>.name</span>.split</span>(<span id="ast-69"><span id="ast-70">os</span>.sep</span>)</span>[<span id="ast-71"><span id="ast-72">-1</span></span>]</span>.split</span>(<span id="ast-73">'.'</span>)</span>[<span id="ast-74"><span id="ast-75">0</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-76"><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-79"><span id="ast-80">'title'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87">pdf</span>.split</span>(<span id="ast-88"><span id="ast-89">os</span>.sep</span>)</span>[<span id="ast-90"><span id="ast-91">-1</span></span>]</span>.split</span>(<span id="ast-92">'.'</span>)</span>[<span id="ast-93"><span id="ast-94">0</span></span>]</span></span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96" class="other_trans">source</span>:<span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-100"><span id="ast-101">'source'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-102" class="other_trans">source</span></span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-104">description</span>:<span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-108"><span id="ast-109">'description'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-110" class="other_trans">description</span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112" class="other_trans">related_article</span>:<span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-116"><span id="ast-117">'related_article'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-118">related_article</span></span></span><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-120" class="other_trans">published_url</span>:<span id="ast-121"><span id="ast-122"><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-124"><span id="ast-125">'published_url'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-126" class="other_trans">published_url</span></span></span><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-128" class="incorrect_node">access&nbsp;&rarr;&nbsp;project&nbsp;</span>:<span id="ast-129"><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-132"><span id="ast-133">'access'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-134" class="other_trans">access</span></span></span><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-136">project</span>:<span id="ast-137"><span id="ast-138"><span id="ast-139" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-140"><span id="ast-141">'project'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-142">project</span></span></span><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-144" class="other_trans">data</span>:<span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-146">(<span id="ast-147" class="other_trans">key</span>,&nbsp;<span id="ast-148">value</span>)</span>&nbsp;in&nbsp;<span id="ast-149"><span id="ast-150"><span id="ast-151" class="other_trans">data</span>.items</span>()</span>:<span id="ast-152"><span id="ast-153"><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-155"><span id="ast-156">(<span id="ast-157">'data[%s]'</span>&nbsp;%&nbsp;<span id="ast-159">key</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-160">value</span></span></span></span><span id="ast-161"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-162" class="other_trans">secure</span>:<span id="ast-163"><span id="ast-164"><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>[<span id="ast-166"><span id="ast-167">'secure'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-168">'true'</span></span></span><span id="ast-169"><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>&nbsp;=&nbsp;<span id="ast-171"><span id="ast-172"><span id="ast-173">self</span>._make_request</span>(<span id="ast-174">(<span id="ast-175"><span id="ast-176">self</span>.BASE_URI</span>&nbsp;+&nbsp;<span id="ast-178">'upload.json'</span>)</span>,&nbsp;<span id="ast-179" class="other_trans">params</span>,&nbsp;<span id="ast-180">MultipartPostHandler</span>)</span></span><span id="ast-181"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-182"><span id="ast-183"><span id="ast-184">self</span>.get</span>(<span id="ast-185"><span id="ast-186"><span id="ast-187"><span id="ast-188">json</span>.loads</span>(<span id="ast-189" class="other_trans">response</span>)</span>[<span id="ast-190"><span id="ast-191">'id'</span></span>]</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_default_role(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Gets&nbsp;the&nbsp;@everyone&nbsp;role&nbsp;that&nbsp;all&nbsp;members&nbsp;have&nbsp;by&nbsp;default.'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-7" class="other_trans">role</span>&nbsp;in&nbsp;<span id="ast-8" class="correct_node">roles&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12" class="other_trans">role</span>.name</span><span id="ast-13" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-14">'@everyone'</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-16" class="other_trans">role</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;command(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">bot</span>,&nbsp;<span id="ast-5" class="other_trans">comm</span>,&nbsp;<span id="ast-6" class="other_trans">groups</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>search</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">groups</span>[<span id="ast-11"><span id="ast-12">0</span></span>]</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>commands</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">Help</span>.helpful_commands</span>(<span id="ast-18" class="other_trans">bot</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>command</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23">[<span id="ast-24" class="other_trans">c</span><span id="ast-25">&nbsp;for&nbsp;<span id="ast-26" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-27" class="other_trans">commands</span>&nbsp;if&nbsp;<span id="ast-28">(<span id="ast-29"><span id="ast-30" class="other_trans">c</span>.name</span><span id="ast-31" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-32" class="other_trans">search</span>)</span></span>]</span>[<span id="ast-33"><span id="ast-34">0</span></span>]</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-36" class="other_trans">IndexError</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>comm&nbsp;&rarr;&nbsp;bot&nbsp;</span>.reply</span>(<span id="ast-41" class="incorrect_node">comm&nbsp;&rarr;&nbsp;bot&nbsp;</span>,&nbsp;<span id="ast-42">'Unknown&nbsp;command'</span>)</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;data_length(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;the&nbsp;length&nbsp;of&nbsp;this&nbsp;value&nbsp;data.&nbsp;This&nbsp;is&nbsp;the&nbsp;actual&nbsp;length&nbsp;of&nbsp;the&nbsp;data&nbsp;that&nbsp;should&nbsp;be&nbsp;parsed&nbsp;for&nbsp;the&nbsp;value.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.unpack_dword</span>(<span id="ast-11">4</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">size</span><span id="ast-15" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-16">2147483648L</span>)</span>:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;-=&nbsp;<span id="ast-20">2147483648L</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-22" class="other_trans">size</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;rewrite_ast(<span id="ast-2"><span id="ast-3" class="other_trans">node</span>,&nbsp;<span id="ast-4" class="other_trans">name</span>,&nbsp;<span id="ast-5" class="other_trans">expr</span>,&nbsp;<span id="ast-6" class="other_trans">assumed_result</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Based&nbsp;on&nbsp;the&nbsp;assumed&nbsp;value&nbsp;of&nbsp;an&nbsp;expression,&nbsp;re-writes\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;AST&nbsp;tree&nbsp;to&nbsp;constants&nbsp;where&nbsp;possible.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12" class="other_trans">name</span>[<span id="ast-13"><span id="ast-14">0</span></span>]</span><span id="ast-15" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-16">'CompareOperator'</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">compare</span>.compare_rewrite</span>(<span id="ast-21" class="other_trans">node</span>,&nbsp;<span id="ast-22" class="other_trans">name</span>,&nbsp;<span id="ast-23" class="other_trans">expr</span>,&nbsp;<span id="ast-24" class="other_trans">assumed_result</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-26">(<span id="ast-28">(<span id="ast-29"><span id="ast-30" class="other_trans">name</span>[<span id="ast-31"><span id="ast-32">0</span></span>]</span><span id="ast-33" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-34">'ContainsOperator'</span>)</span>&nbsp;and&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37" class="other_trans">name</span>[<span id="ast-38"><span id="ast-39">1</span></span>]</span><span id="ast-40" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-41">'LiteralSet'</span>)</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">contains</span>.contains_rewrite</span>(<span id="ast-46" class="correct_node">name&nbsp;&rarr;&nbsp;node&nbsp;</span>,&nbsp;<span id="ast-47" class="other_trans">name</span>,&nbsp;<span id="ast-48" class="other_trans">expr</span>,&nbsp;<span id="ast-49" class="other_trans">assumed_result</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;from_docker_envvars(<span id="ast-2"><span id="ast-3" class="other_trans">config</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">'PG_PORT'</span><span id="ast-7">&nbsp;in&nbsp;</span><span id="ast-8"><span id="ast-9">os</span>.environ</span>)</span>:<span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pg_url</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">urlparse</span>(<span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">os</span>.environ</span>[<span id="ast-17"><span id="ast-18">'PG_PORT'</span></span>]</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21">not</span>&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24" class="other_trans">pg_url</span>.scheme</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26">'tcp'</span>)</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">ValueError</span>(<span id="ast-30">'Only&nbsp;tcp&nbsp;scheme&nbsp;supported&nbsp;for&nbsp;postgres'</span>)</span></span></span><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-33" class="other_trans">host</span>,&nbsp;<span id="ast-34" class="other_trans">port</span>)</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">pg_url</span>.netloc</span>.split</span>(<span id="ast-39">':'</span>)</span></span><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>uri</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44">'postgres://{user}:{password}@{host}:{port}/{database}'</span>.format</span>(user=<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">os</span>.environ</span>.get</span>(<span id="ast-50">'PG_ENV_POSTGRES_USER'</span>,&nbsp;<span id="ast-51">'postgres'</span>)</span>,&nbsp;password=<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">os</span>.environ</span>.get</span>(<span id="ast-57">'PG_ENV_POSTGRES_PASSWORD'</span>,&nbsp;<span id="ast-58">''</span>)</span>,&nbsp;host=<span id="ast-60" class="other_trans">host</span>,&nbsp;port=<span id="ast-62" class="other_trans">port</span>,&nbsp;database=<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans">os</span>.environ</span>.get</span>(<span id="ast-68">'PG_ENV_POSTGRES_DB'</span>)</span>)</span></span><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>config</span>[<span id="ast-72"><span id="ast-73">'SQLALCHEMY_DATABASE_URI'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-74" class="other_trans">uri</span></span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-76">(<span id="ast-77">'REDIS_PORT'</span><span id="ast-78">&nbsp;in&nbsp;</span><span id="ast-79"><span id="ast-80" class="other_trans">os</span>.environ</span>)</span>:<span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>redis_url</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84">urlparse</span>(<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans">os</span>.environ</span>[<span id="ast-88"><span id="ast-89">'REDIS_PORT'</span></span>]</span>)</span></span><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-91">(<span id="ast-92">not</span>&nbsp;<span id="ast-93">(<span id="ast-94"><span id="ast-95" class="other_trans">redis_url</span>.scheme</span><span id="ast-96" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-97">'tcp'</span>)</span>)</span>:<span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-99"><span id="ast-100" class="other_trans">ValueError</span>(<span id="ast-101">'Only&nbsp;tcp&nbsp;scheme&nbsp;supported&nbsp;for&nbsp;redis'</span>)</span></span></span><span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-104" class="other_trans">host</span>,&nbsp;<span id="ast-105" class="other_trans">port</span>)</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109" class="correct_node">pg_url&nbsp;&rarr;&nbsp;redis_url&nbsp;</span>.netloc</span>.split</span>(<span id="ast-110">':'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;lines(<span id="ast-2"><span id="ast-3">start</span>,&nbsp;<span id="ast-5" class="other_trans">end</span>,&nbsp;<span id="ast-7" class="other_trans">reverse</span>,&nbsp;<span id="ast-9" class="other_trans">selection</span></span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Iterate&nbsp;lines&nbsp;in&nbsp;range.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start:&nbsp;Starting&nbsp;address,&nbsp;start&nbsp;of&nbsp;IDB&nbsp;if&nbsp;`None`.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end:&nbsp;End&nbsp;address,&nbsp;end&nbsp;of&nbsp;IDB&nbsp;if&nbsp;`None`.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reverse:&nbsp;Set&nbsp;to&nbsp;true&nbsp;to&nbsp;iterate&nbsp;in&nbsp;reverse&nbsp;order.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selection:&nbsp;If&nbsp;set&nbsp;to&nbsp;True,&nbsp;replaces&nbsp;start&nbsp;and&nbsp;end&nbsp;with&nbsp;current&nbsp;selection.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iterator&nbsp;of&nbsp;`Line`&nbsp;objects.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14" class="other_trans">selection</span>:<span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-17" class="other_trans">start</span>,&nbsp;<span id="ast-18" class="other_trans">end</span>)</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">get_selection</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-23" class="other_trans">start</span>,&nbsp;<span id="ast-24" class="other_trans">end</span>)</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26">fix_addresses</span>(<span id="ast-27" class="other_trans">start</span>,&nbsp;<span id="ast-28" class="other_trans">end</span>)</span></span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31">not</span>&nbsp;<span id="ast-32" class="other_trans">reverse</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">idaapi</span>.get_item_head</span>(<span id="ast-38" class="other_trans">start</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">item</span><span id="ast-42" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-43" class="other_trans">end</span>)</span>:<span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">Line</span>(<span id="ast-48" class="other_trans">item</span>)</span></span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;+=&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">idaapi</span>.get_item_size</span>(<span id="ast-55" class="other_trans">item</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60">idaapi</span>.get_item_head</span>(<span id="ast-61">(<span id="ast-62" class="other_trans">end</span>&nbsp;-&nbsp;<span id="ast-64">1</span>)</span>)</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-66">(<span id="ast-67" class="other_trans">item</span><span id="ast-68" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-69" class="other_trans">start</span>)</span>:<span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-72"><span id="ast-73" class="other_trans">Line</span>(<span id="ast-74">item</span>)</span></span></span><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79">idaapi</span>.get_item_head</span>(<span id="ast-80">(<span id="ast-81">item</span>&nbsp;-&nbsp;<span id="ast-83">1</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_check_same_fov(<span id="ast-2">*args,&nbsp;**kwargs</span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Assert&nbsp;the&nbsp;equivalence&nbsp;of&nbsp;all&nbsp;provided&nbsp;images.&nbsp;Parameter&nbsp;names&nbsp;are\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used&nbsp;to&nbsp;generate&nbsp;user&nbsp;friendly&nbsp;error&nbsp;message.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raise_error</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">kwargs</span>.pop</span>(<span id="ast-10">'raise_error'</span>,&nbsp;<span id="ast-11">False</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">i</span>,&nbsp;<span id="ast-15" class="other_trans">arg</span>)</span>&nbsp;in&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">enumerate</span>(<span id="ast-18" class="other_trans">args</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>[<span id="ast-22"><span id="ast-23">(<span id="ast-24">'arg_#%i'</span>&nbsp;%&nbsp;<span id="ast-26" class="other_trans">i</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-27" class="other_trans">arg</span></span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>errors</span>&nbsp;=&nbsp;<span id="ast-30">[]</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32">(<span id="ast-33">(<span id="ast-34" class="other_trans">a_name</span>,&nbsp;<span id="ast-35" class="other_trans">a_img</span>)</span>,&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">b_name</span>,&nbsp;<span id="ast-38" class="other_trans">b_img</span>)</span>)</span>&nbsp;in&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">itertools</span>.combinations</span>(<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">kwargs</span>.items</span>()</span>,&nbsp;<span id="ast-45">2</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48">not</span>&nbsp;<span id="ast-49">(<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">a_img</span>.shape</span>[<span id="ast-53">:<span id="ast-54">3</span></span>]</span><span id="ast-55" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">b_img</span>.shape</span>[<span id="ast-59">:<span id="ast-60">3</span></span>]</span>)</span>)</span>:<span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>errors</span>.append</span>(<span id="ast-65">(<span id="ast-66" class="other_trans">a_name</span>,&nbsp;<span id="ast-67" class="other_trans">b_name</span>,&nbsp;<span id="ast-68">'shape'</span>)</span>)</span></span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70">(<span id="ast-71">not</span>&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74">np</span>.allclose</span>(<span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">a_img</span>.get_affine</span>()</span>,&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80">b_img</span>.get_affine</span>()</span>)</span>)</span>:<span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>errors</span>.append</span>(<span id="ast-85">(<span id="ast-86" class="other_trans">a_name</span>,&nbsp;<span id="ast-87" class="other_trans">b_name</span>,&nbsp;<span id="ast-88">'affine'</span>)</span>)</span></span></span></span><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-90">(<span id="ast-92">(<span id="ast-93"><span id="ast-94" class="other_trans">len</span>(<span id="ast-95" class="other_trans">errors</span>)</span><span id="ast-96" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-97">0</span>)</span>&nbsp;and&nbsp;<span id="ast-98" class="other_trans">raise_error</span>)</span>:<span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-100"><span id="ast-101">ValueError</span>(<span id="ast-102">(<span id="ast-103">'Following&nbsp;field&nbsp;of&nbsp;view&nbsp;errors&nbsp;were&nbsp;detected:\\u000a'</span>&nbsp;+&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107">'\\u000a'</span>.join</span>(<span id="ast-108">[<span id="ast-109">(<span id="ast-110">'-&nbsp;%s&nbsp;and&nbsp;%s&nbsp;do&nbsp;not&nbsp;have&nbsp;the&nbsp;same&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-112" class="other_trans">e</span>)</span><span id="ast-113">&nbsp;for&nbsp;<span id="ast-114" class="other_trans">e</span>&nbsp;in&nbsp;<span id="ast-115">errors</span></span>]</span>)</span>)</span>)</span></span></span><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-117">(<span id="ast-118"><span id="ast-119" class="other_trans">len</span>(<span id="ast-120" class="other_trans">errors</span>)</span><span id="ast-121" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-122">0</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process(<span id="ast-2"><span id="ast-3" class="other_trans">args</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>conduit</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">phlsys_makeconduit</span>.make_conduit</span>(<span id="ast-9"><span id="ast-10" class="other_trans">args</span>.uri</span>,&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">args</span>.user</span>,&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">args</span>.cert</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16"><span id="ast-17">args</span>.diff_id</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff_id</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">args</span>.diff_id</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>&nbsp;=&nbsp;<span id="ast-24">{<span id="ast-25">'diff'</span>:&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">args</span>.raw_diff_file</span>.read</span>()</span>}</span></span><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff_id</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">conduit</span>.call</span>(<span id="ast-36">'differential.createrawdiff'</span>,&nbsp;<span id="ast-37">d</span>)</span>[<span id="ast-38"><span id="ast-39">'id'</span></span>]</span></span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>&nbsp;=&nbsp;<span id="ast-42">{}</span></span><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>MessageFields</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46">phlcon_differential</span>.MessageFields</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48"><span id="ast-49">args</span>.reviewers</span>:<span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>[<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">MessageFields</span>.reviewer_phids</span></span>]</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57">args</span>.reviewers</span></span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">args</span>.ccs</span>:<span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>[<span id="ast-64"><span id="ast-65"><span id="ast-66">MessageFields</span>.cc_phids</span></span>]</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68">args</span>.ccs</span></span></span><span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>users</span>&nbsp;=&nbsp;<span id="ast-71">[<span id="ast-72" class="other_trans">u</span><span id="ast-73">&nbsp;for&nbsp;<span id="ast-74">users</span>&nbsp;in&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">fields</span>.itervalues</span>()</span></span><span id="ast-78">&nbsp;for&nbsp;<span id="ast-79">u</span>&nbsp;in&nbsp;<span id="ast-80" class="other_trans">users</span></span>]</span></span><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>users</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84">list</span>(<span id="ast-85"><span id="ast-86">set</span>(<span id="ast-87" class="other_trans">users</span>)</span>)</span></span><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>userToPhid</span>&nbsp;=&nbsp;<span id="ast-90">{}</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-92" class="other_trans">users</span>:<span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>userToPhid</span>&nbsp;=&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97">phlcon_user</span>.make_username_phid_dict</span>(<span id="ast-98">conduit</span>,&nbsp;<span id="ast-99">users</span>)</span></span></span><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-101" class="other_trans">key</span>&nbsp;in&nbsp;<span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans">fields</span>.iterkeys</span>()</span>:<span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>[<span id="ast-108"><span id="ast-109" class="other_trans">key</span></span>]</span>&nbsp;=&nbsp;<span id="ast-110">[<span id="ast-111"><span id="ast-112">userToPhid</span>[<span id="ast-113"><span id="ast-114" class="other_trans">u</span></span>]</span><span id="ast-115">&nbsp;for&nbsp;<span id="ast-116" class="other_trans">u</span>&nbsp;in&nbsp;<span id="ast-117"><span id="ast-118">fields</span>[<span id="ast-119"><span id="ast-120">key</span></span>]</span></span>]</span></span></span><span id="ast-121"><span id="ast-122"><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>[<span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans">MessageFields</span>.title</span></span>]</span>&nbsp;=&nbsp;<span id="ast-127"><span id="ast-128" class="other_trans">args</span>.title</span></span><span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>[<span id="ast-132"><span id="ast-133"><span id="ast-134" class="other_trans">MessageFields</span>.test_plan</span></span>]</span>&nbsp;=&nbsp;<span id="ast-135"><span id="ast-136">args</span>.test_plan</span></span><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-138"><span id="ast-139" class="other_trans">args</span>.summary</span>:<span id="ast-140"><span id="ast-141"><span id="ast-142" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>d&nbsp;&rarr;&nbsp;fields&nbsp;</span>[<span id="ast-143"><span id="ast-144"><span id="ast-145" class="other_trans">MessageFields</span>.summary</span></span>]</span>&nbsp;=&nbsp;<span id="ast-146"><span id="ast-147">args</span>.summary</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;download(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">fe_file</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>download</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">multiprocessing</span>.Process</span>(target=<span id="ast-11" class="correct_node">download_fe_file&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;args=<span id="ast-13">(<span id="ast-14" class="other_trans">fe_file</span>)</span>)</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>download</span>.start</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;project(<span id="ast-2"><span id="ast-3">X</span>,&nbsp;<span id="ast-4">Z</span>,&nbsp;<span id="ast-5" class="other_trans">use_jit</span>,&nbsp;<span id="ast-7">debug</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Project&nbsp;tensor&nbsp;Z&nbsp;on&nbsp;the&nbsp;tangent&nbsp;space&nbsp;of&nbsp;tensor&nbsp;X.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;X&nbsp;is&nbsp;a&nbsp;tensor&nbsp;in&nbsp;the&nbsp;TT&nbsp;format.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Z&nbsp;can&nbsp;be&nbsp;a&nbsp;tensor&nbsp;in&nbsp;the&nbsp;TT&nbsp;format&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;tensors&nbsp;(in&nbsp;this&nbsp;case\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;function&nbsp;computes&nbsp;projection&nbsp;of&nbsp;the&nbsp;sum&nbsp;off&nbsp;all&nbsp;tensors&nbsp;in&nbsp;the&nbsp;list:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;project(X,&nbsp;Z)&nbsp;=&nbsp;P_X(\\\\sum_i&nbsp;Z_i)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;function&nbsp;implements&nbsp;an&nbsp;algorithm&nbsp;from&nbsp;the&nbsp;paper&nbsp;[1],&nbsp;theorem&nbsp;3.1.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;jit&nbsp;version&nbsp;of&nbsp;the&nbsp;code&nbsp;is&nbsp;much&nbsp;faster&nbsp;when&nbsp;projecting&nbsp;a&nbsp;lot&nbsp;of&nbsp;tensors\\u000a&nbsp;&nbsp;&nbsp;&nbsp;simultaneously&nbsp;(in&nbsp;other&nbsp;words&nbsp;Z&nbsp;is&nbsp;a&nbsp;list&nbsp;with&nbsp;many&nbsp;tensors).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;a&nbsp;tensor&nbsp;in&nbsp;the&nbsp;TT&nbsp;format&nbsp;with&nbsp;the&nbsp;TT-ranks&nbsp;equal&nbsp;2&nbsp;*&nbsp;rank(Z).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>zArr</span>&nbsp;=&nbsp;<span id="ast-13" class="other_trans">None</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15"><span id="ast-16">isinstance</span>(<span id="ast-17" class="other_trans">Z</span>,&nbsp;<span id="ast-18"><span id="ast-19">tt</span>.tensor</span>)</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zArr</span>&nbsp;=&nbsp;<span id="ast-22">[<span id="ast-23" class="other_trans">Z</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zArr</span>&nbsp;=&nbsp;<span id="ast-26">Z</span></span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>X</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31">X</span>.round</span>(eps=<span id="ast-33">0</span>)</span></span><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-36" class="other_trans">numDims</span>,&nbsp;<span id="ast-37">modeSize</span>)</span>&nbsp;=&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40">X</span>.d</span>,&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">X</span>.n</span>)</span></span><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>coresX</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48">tt</span>.tensor</span>.to_list</span>(<span id="ast-49" class="other_trans">X</span>)</span></span><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>coresZ</span>&nbsp;=&nbsp;<span id="ast-52">(<span id="ast-53">[<span id="ast-54">None</span>]</span>&nbsp;*&nbsp;<span id="ast-56"><span id="ast-57">len</span>(<span id="ast-58" class="other_trans">zArr</span>)</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-60" class="other_trans">idx</span>&nbsp;in&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">xrange</span>(<span id="ast-63"><span id="ast-64" class="other_trans">len</span>(<span id="ast-65">zArr</span>)</span>)</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">(<span id="ast-70" class="other_trans">modeSize</span><span id="ast-71" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-72"><span id="ast-73"><span id="ast-74">zArr</span>[<span id="ast-75"><span id="ast-76">idx</span></span>]</span>.n</span>)</span>.all</span>()</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>coresZ</span>[<span id="ast-80"><span id="ast-81" class="other_trans">idx</span></span>]</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85">tt</span>.tensor</span>.to_list</span>(<span id="ast-86"><span id="ast-87" class="other_trans">zArr</span>[<span id="ast-88"><span id="ast-89" class="other_trans">idx</span></span>]</span>)</span></span></span><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-91">(<span id="ast-93">(<span id="ast-94">not</span>&nbsp;<span id="ast-95" class="other_trans">use_jit</span>)</span>&nbsp;and&nbsp;<span id="ast-96">(<span id="ast-97"><span id="ast-98">len</span>(<span id="ast-99" class="ref_node">Z&nbsp;&rarr;&nbsp;zArr&nbsp;</span>)</span><span id="ast-100" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-101">10</span>)</span>)</span>:<span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-103">'Consider&nbsp;using&nbsp;use_jit=True&nbsp;option&nbsp;to&nbsp;speed&nbsp;up&nbsp;the&nbsp;projection&nbsp;process.'</span></span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-105">use_jit</span>:<span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-107" class="other_trans">dim</span>&nbsp;in&nbsp;<span id="ast-108"><span id="ast-109">xrange</span>(<span id="ast-110">numDims</span>)</span>:<span id="ast-111"><span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-113" class="other_trans">r1</span>,&nbsp;<span id="ast-114" class="other_trans">n</span>,&nbsp;<span id="ast-115">r2</span>)</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118"><span id="ast-119">coresZ</span>[<span id="ast-120"><span id="ast-121">0</span></span>]</span>[<span id="ast-122"><span id="ast-123" class="incorrect_node">dim&nbsp;&rarr;&nbsp;idx&nbsp;</span></span>]</span>.shape</span></span><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-125" class="other_trans">idx</span>&nbsp;in&nbsp;<span id="ast-126"><span id="ast-127">xrange</span>(<span id="ast-128"><span id="ast-129">len</span>(<span id="ast-130" class="other_trans">zArr</span>)</span>)</span>:<span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-132">(<span id="ast-133">(<span id="ast-134">r1</span>,&nbsp;<span id="ast-135">n</span>,&nbsp;<span id="ast-136" class="other_trans">r2</span>)</span><span id="ast-137" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-138"><span id="ast-139"><span id="ast-140"><span id="ast-141">coresZ</span>[<span id="ast-142"><span id="ast-143" class="other_trans">idx</span></span>]</span>[<span id="ast-144"><span id="ast-145" class="other_trans">dim</span></span>]</span>.shape</span>)</span>:<span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-147">'Warning:&nbsp;cannot&nbsp;use&nbsp;the&nbsp;jit&nbsp;version&nbsp;when&nbsp;not&nbsp;all&nbsp;the&nbsp;ranks&nbsp;in&nbsp;the&nbsp;Z&nbsp;array&nbsp;are&nbsp;equal&nbsp;each&nbsp;other.&nbsp;Switching&nbsp;to&nbsp;the&nbsp;non-jit&nbsp;version.'</span></span><span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>use_jit</span>&nbsp;=&nbsp;<span id="ast-150">False</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;show(<span id="ast-2"><span id="ast-3" class="other_trans">request</span>,&nbsp;<span id="ast-4" class="other_trans">slug</span>,&nbsp;<span id="ast-5" class="other_trans">template_name</span>,&nbsp;<span id="ast-7" class="other_trans">context</span>,&nbsp;<span id="ast-9">status</span></span>):<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>obj</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19">FoiRequest</span>.objects</span>.select_related</span>(<span id="ast-20">'public_body'</span>,&nbsp;<span id="ast-21">'user'</span>,&nbsp;<span id="ast-22">'user__profile'</span>,&nbsp;<span id="ast-23">'law'</span>,&nbsp;<span id="ast-24">'law__combined'</span>)</span>.get</span>(slug=<span id="ast-26" class="other_trans">slug</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-28"><span id="ast-29">FoiRequest</span>.DoesNotExist</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-31" class="other_trans">Http404</span></span></span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34">not</span>&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">obj</span>.is_visible</span>(<span id="ast-38"><span id="ast-39" class="other_trans">request</span>.user</span>)</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41"><span id="ast-42">render_403</span>(<span id="ast-43" class="other_trans">request</span>)</span></span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>all_attachments</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51">FoiAttachment</span>.objects</span>.filter</span>(belongs_to__request=<span id="ast-53">obj</span>)</span>.all</span>()</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-55" class="other_trans">message</span>&nbsp;in&nbsp;<span id="ast-56"><span id="ast-57">obj</span>.messages</span>:<span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.request</span>&nbsp;=&nbsp;<span id="ast-61" class="other_trans">obj</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.all_attachments</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66">filter</span>(<span id="ast-67">lambda&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">x</span></span>:&nbsp;<span id="ast-70">(<span id="ast-71"><span id="ast-72" class="other_trans">x</span>.belongs_to_id</span><span id="ast-73" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-74"><span id="ast-75">message</span>.id</span>)</span></span>,&nbsp;<span id="ast-76" class="other_trans">all_attachments</span>)</span></span></span><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>events</span>&nbsp;=&nbsp;<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans">FoiEvent</span>.objects</span>.filter</span>(request=<span id="ast-88" class="other_trans">obj</span>)</span>.select_related</span>(<span id="ast-89">'user'</span>,&nbsp;<span id="ast-90">'user__profile'</span>,&nbsp;<span id="ast-91">'request'</span>,&nbsp;<span id="ast-92">'public_body'</span>)</span>.order_by</span>(<span id="ast-93">'timestamp'</span>)</span></span><span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>event_count</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97" class="other_trans">len</span>(<span id="ast-98" class="other_trans">events</span>)</span></span><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>last_index</span>&nbsp;=&nbsp;<span id="ast-101">event_count</span></span><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-103" class="other_trans">message</span>&nbsp;in&nbsp;<span id="ast-104"><span id="ast-105">reversed</span>(<span id="ast-106"><span id="ast-107" class="other_trans">obj</span>.messages</span>)</span>:<span id="ast-108"><span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.events</span>&nbsp;=&nbsp;<span id="ast-111">[<span id="ast-112" class="other_trans">ev</span><span id="ast-113">&nbsp;for&nbsp;<span id="ast-114" class="other_trans">ev</span>&nbsp;in&nbsp;<span id="ast-115"><span id="ast-116" class="other_trans">events</span>[<span id="ast-117">:<span id="ast-118" class="other_trans">last_index</span></span>]</span>&nbsp;if&nbsp;<span id="ast-119">(<span id="ast-120"><span id="ast-121" class="other_trans">ev</span>.timestamp</span><span id="ast-122" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-123"><span id="ast-124">message</span>.timestamp</span>)</span></span>]</span></span><span id="ast-125"><span id="ast-126" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last_index</span>&nbsp;=&nbsp;<span id="ast-127">(<span id="ast-128" class="correct_node">event_count&nbsp;&rarr;&nbsp;last_index&nbsp;</span>&nbsp;-&nbsp;<span id="ast-130"><span id="ast-131">len</span>(<span id="ast-132"><span id="ast-133" class="other_trans">message</span>.events</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;align_preceding_comment(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">node</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>prefix</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">node</span>.prefix</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>comment_indent</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15">re</span>.sub</span>(<span id="ast-16">'^([\\\\s\\\\t]*\\\\n)?'</span>,&nbsp;<span id="ast-17">''</span>,&nbsp;<span id="ast-18" class="other_trans">prefix</span>)</span>.find</span>(<span id="ast-19">'#'</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22">comment_indent</span><span id="ast-23" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-24">-1</span>)</span>:<span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_comment_indent</span>&nbsp;=&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">SPACES</span>&nbsp;*&nbsp;<span id="ast-30"><span id="ast-31">self</span>.indent_level</span>)</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-35">(<span id="ast-36"><span id="ast-37" class="other_trans">node</span>.type</span><span id="ast-38" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39"><span id="ast-40" class="other_trans">token</span>.INDENT</span>)</span>&nbsp;and&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">comment_indent</span><span id="ast-43" class="ref_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">node</span>.next_sibling</span>.leaves</span>()</span>.next</span>()</span>.column</span>)</span>)</span>:<span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_comment_indent</span>&nbsp;=&nbsp;<span id="ast-53">(<span id="ast-54" class="other_trans">SPACES</span>&nbsp;*&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58">self</span>.indent_level</span>&nbsp;-&nbsp;<span id="ast-60">1</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-62">(<span id="ast-63"><span id="ast-64">node</span>.type</span><span id="ast-65" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-66"><span id="ast-67">token</span>.DEDENT</span>)</span>:<span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>level</span>&nbsp;=&nbsp;<span id="ast-71">(<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75">self</span>.indents</span>.index</span>(<span id="ast-76" class="other_trans">comment_indent</span>)</span>&nbsp;+&nbsp;<span id="ast-78">1</span>)</span></span><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_comment_indent</span>&nbsp;=&nbsp;<span id="ast-81">(<span id="ast-82" class="other_trans">level</span>&nbsp;*&nbsp;<span id="ast-84">SPACES</span>)</span></span><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-86">ValueError</span>:<span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_comment_indent</span>&nbsp;=&nbsp;<span id="ast-89">(<span id="ast-90" class="other_trans">comment_indent</span>&nbsp;*&nbsp;<span id="ast-92">u'&nbsp;'</span>)</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-94">(<span id="ast-95" class="other_trans">comment_indent</span><span id="ast-96" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-97"><span id="ast-98"><span id="ast-99">self</span>.indents</span>[<span id="ast-100"><span id="ast-101">0</span></span>]</span>)</span>:<span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_comment_indent</span>&nbsp;=&nbsp;<span id="ast-104">(<span id="ast-105" class="other_trans">comment_indent</span>&nbsp;*&nbsp;<span id="ast-107">u'&nbsp;'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-110"><span id="ast-111" class="other_trans">max</span>(<span id="ast-112">(<span id="ast-113" class="other_trans">i</span><span id="ast-114">&nbsp;for&nbsp;<span id="ast-115" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-116"><span id="ast-117">self</span>.indents</span>&nbsp;if&nbsp;<span id="ast-118">(<span id="ast-119" class="other_trans">i</span><span id="ast-120" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-121" class="other_trans">comment_indent</span>)</span></span>)</span>)</span></span><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>level</span>&nbsp;=&nbsp;<span id="ast-124">(<span id="ast-125"><span id="ast-126"><span id="ast-127"><span id="ast-128">self</span>.indents</span>.index</span>(<span id="ast-129">i</span>)</span>&nbsp;+&nbsp;<span id="ast-131">1</span>)</span></span><span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_comment_indent</span>&nbsp;=&nbsp;<span id="ast-134">(<span id="ast-135">(<span id="ast-136" class="other_trans">level</span>&nbsp;*&nbsp;<span id="ast-138" class="other_trans">SPACES</span>)</span>&nbsp;+&nbsp;<span id="ast-140">(<span id="ast-141">(<span id="ast-142" class="incorrect_node">comment_indent&nbsp;&rarr;&nbsp;level&nbsp;</span>&nbsp;-&nbsp;<span id="ast-144" class="other_trans">i</span>)</span>&nbsp;*&nbsp;<span id="ast-146">u'&nbsp;'</span>)</span>)</span></span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;cached_polyline(<span id="ast-2"><span id="ast-3" class="other_trans">origin</span>,&nbsp;<span id="ast-4" class="other_trans">destination</span>,&nbsp;<span id="ast-5" class="other_trans">speed</span>,&nbsp;<span id="ast-6" class="other_trans">google_map_api_key</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Google&nbsp;API&nbsp;has&nbsp;limits,&nbsp;so&nbsp;we&nbsp;can't&nbsp;generate&nbsp;new&nbsp;Polyline&nbsp;at&nbsp;every&nbsp;tick...\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-13"><span id="ast-14" class="other_trans">PolylineObjectHandler</span>._cache</span>&nbsp;and&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">PolylineObjectHandler</span>._cache</span>.get_last_pos</span>()</span><span id="ast-20" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-21">(<span id="ast-22" class="other_trans">None</span>,&nbsp;<span id="ast-23">None</span>)</span>)</span>)</span>:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>abs_offset</span>&nbsp;=&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">haversine</span>.haversine</span>(<span id="ast-30"><span id="ast-31" class="other_trans">tuple</span>(<span id="ast-32" class="other_trans">origin</span>)</span>,&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">PolylineObjectHandler</span>._cache</span>.get_last_pos</span>()</span>)</span>&nbsp;*&nbsp;<span id="ast-38">1000</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>abs_offset</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">float</span>(<span id="ast-43">'inf'</span>)</span></span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>is_old_cache</span>&nbsp;=&nbsp;<span id="ast-46">lambda&nbsp;<span id="ast-47"></span>:&nbsp;<span id="ast-48">(<span id="ast-49" class="other_trans">abs_offset</span><span id="ast-50" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-51">8</span>)</span></span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_dest_set</span>&nbsp;=&nbsp;<span id="ast-54">lambda&nbsp;<span id="ast-55"></span>:&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58" class="other_trans">tuple</span>(<span id="ast-59" class="other_trans">destination</span>)</span><span id="ast-60" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">PolylineObjectHandler</span>._cache</span>.destination</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;attach(<span id="ast-2"><span id="ast-3" class="other_trans">wrapped</span>,&nbsp;<span id="ast-4">callback</span>,&nbsp;<span id="ast-5">category</span>,&nbsp;<span id="ast-7" class="other_trans">depth</span>,&nbsp;<span id="ast-9" class="other_trans">name</span></span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Attach&nbsp;a&nbsp;callback&nbsp;to&nbsp;the&nbsp;wrapped&nbsp;object.&nbsp;&nbsp;It&nbsp;will&nbsp;be&nbsp;found\\u000a&nbsp;&nbsp;&nbsp;&nbsp;later&nbsp;during&nbsp;a&nbsp;scan.&nbsp;&nbsp;This&nbsp;function&nbsp;returns&nbsp;an&nbsp;instance&nbsp;of&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:class:`venusian.AttachInfo`&nbsp;class.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``category``&nbsp;should&nbsp;be&nbsp;``None``&nbsp;or&nbsp;a&nbsp;string&nbsp;representing&nbsp;a&nbsp;decorator\\u000a&nbsp;&nbsp;&nbsp;&nbsp;category&nbsp;name.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``name``&nbsp;should&nbsp;be&nbsp;``None``&nbsp;or&nbsp;a&nbsp;string&nbsp;representing&nbsp;a&nbsp;subcategory&nbsp;within\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;category.&nbsp;&nbsp;This&nbsp;will&nbsp;be&nbsp;used&nbsp;by&nbsp;the&nbsp;``lift``&nbsp;class&nbsp;decorator&nbsp;to\\u000a&nbsp;&nbsp;&nbsp;&nbsp;determine&nbsp;if&nbsp;decorations&nbsp;of&nbsp;a&nbsp;method&nbsp;should&nbsp;be&nbsp;inherited&nbsp;or&nbsp;overridden.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>frame</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">sys</span>._getframe</span>(<span id="ast-18">(<span id="ast-19">depth</span>&nbsp;+&nbsp;<span id="ast-21">1</span>)</span>)</span></span><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-24" class="other_trans">scope</span>,&nbsp;<span id="ast-25">module</span>,&nbsp;<span id="ast-26" class="other_trans">f_locals</span>,&nbsp;<span id="ast-27">f_globals</span>,&nbsp;<span id="ast-28">codeinfo</span>)</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30">getFrameInfo</span>(<span id="ast-31">frame</span>)</span></span><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>module_name</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35">getattr</span>(<span id="ast-36">module</span>,&nbsp;<span id="ast-37">'__name__'</span>,&nbsp;<span id="ast-38">None</span>)</span></span><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>wrapped_name</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42">getattr</span>(<span id="ast-43">wrapped</span>,&nbsp;<span id="ast-44">'__name__'</span>,&nbsp;<span id="ast-45" class="other_trans">None</span>)</span></span><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>class_name</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49">codeinfo</span>[<span id="ast-50"><span id="ast-51">2</span></span>]</span></span><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>liftid</span>&nbsp;=&nbsp;<span id="ast-54">(<span id="ast-55">'%s&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-57">(<span id="ast-58" class="other_trans">wrapped_name</span>,&nbsp;<span id="ast-59">name</span>)</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61">(<span id="ast-62">scope</span><span id="ast-63" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-64">'class'</span>)</span>:<span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>categories</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">f_locals</span>.get</span>(<span id="ast-70">ATTACH_ATTR</span>,&nbsp;<span id="ast-71" class="other_trans">None</span>)</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-73">(<span id="ast-75">(<span id="ast-76">categories</span><span id="ast-77" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-78">None</span>)</span>&nbsp;or&nbsp;<span id="ast-79">(<span id="ast-80">not</span>&nbsp;<span id="ast-81"><span id="ast-82"><span id="ast-83" class="incorrect_node">categories&nbsp;&rarr;&nbsp;f_locals&nbsp;</span>.attached_to</span>(<span id="ast-84">module_name</span>,&nbsp;<span id="ast-85">class_name</span>,&nbsp;<span id="ast-86" class="other_trans">None</span>)</span>)</span>)</span>:<span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>categories</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90" class="other_trans">Categories</span>(<span id="ast-91">(<span id="ast-92" class="other_trans">module_name</span>,&nbsp;<span id="ast-93" class="other_trans">class_name</span>)</span>)</span></span><span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f_locals</span>[<span id="ast-97"><span id="ast-98">ATTACH_ATTR</span></span>]</span>&nbsp;=&nbsp;<span id="ast-99">categories</span></span></span><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>callbacks</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans">categories</span>.setdefault</span>(<span id="ast-105" class="other_trans">category</span>,&nbsp;<span id="ast-106">[]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-107"><span id="ast-108" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>categories</span>&nbsp;=&nbsp;<span id="ast-109"><span id="ast-110">getattr</span>(<span id="ast-111" class="other_trans">wrapped</span>,&nbsp;<span id="ast-112">ATTACH_ATTR</span>,&nbsp;<span id="ast-113" class="other_trans">None</span>)</span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-115">(<span id="ast-117">(<span id="ast-118" class="other_trans">categories</span><span id="ast-119" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-120">None</span>)</span>&nbsp;or&nbsp;<span id="ast-121">(<span id="ast-122">not</span>&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125" class="other_trans">categories</span>.attached_to</span>(<span id="ast-126" class="other_trans">module_name</span>,&nbsp;<span id="ast-127" class="ref_node">class_name&nbsp;&rarr;&nbsp;wrapped_name&nbsp;</span>,&nbsp;<span id="ast-128" class="other_trans">wrapped</span>)</span>)</span>)</span>:<span id="ast-129"><span id="ast-130" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>categories</span>&nbsp;=&nbsp;<span id="ast-131"><span id="ast-132" class="other_trans">Categories</span>(<span id="ast-133" class="other_trans">wrapped</span>)</span></span><span id="ast-134"><span id="ast-135"><span id="ast-136" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-137" class="other_trans">wrapped</span>,&nbsp;<span id="ast-138">ATTACH_ATTR</span>,&nbsp;<span id="ast-139">categories</span>)</span></span></span><span id="ast-140"><span id="ast-141" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>callbacks</span>&nbsp;=&nbsp;<span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans">categories</span>.setdefault</span>(<span id="ast-145">category</span>,&nbsp;<span id="ast-146">[]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_consensus_matrix(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>norm_scores</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">normalize</span>(<span id="ast-8"><span id="ast-9" class="other_trans">exp</span>(<span id="ast-10"><span id="ast-11" class="other_trans">rescale_logvalues</span>(<span id="ast-12"><span id="ast-13">self</span>.scores</span>)</span>)</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">sum</span>(<span id="ast-17">(<span id="ast-18">(<span id="ast-19" class="other_trans">n</span>&nbsp;*&nbsp;<span id="ast-21" class="other_trans">s</span>)</span><span id="ast-22">&nbsp;for&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">n</span>,&nbsp;<span id="ast-25" class="other_trans">s</span>)</span>&nbsp;in&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">zip</span>(<span id="ast-28"><span id="ast-29">self</span>.adjacency_matrices</span>,&nbsp;<span id="ast-30" class="correct_node">scores&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;make_request(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">verb</span>,&nbsp;<span id="ast-5" class="other_trans">path</span>,&nbsp;<span id="ast-6" class="other_trans">params</span>,&nbsp;<span id="ast-7" class="other_trans">body</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.path2url</span>(<span id="ast-13" class="other_trans">path</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">body</span><span id="ast-17" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-18" class="other_trans">None</span>)</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>body</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.encode</span>(<span id="ast-24" class="other_trans">body</span>)</span></span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30">self</span>.session</span>.request</span>(<span id="ast-31" class="other_trans">verb</span>,&nbsp;<span id="ast-32" class="other_trans">path</span>,&nbsp;params=<span id="ast-34" class="other_trans">params</span>,&nbsp;data=<span id="ast-36" class="other_trans">body</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-40">(<span id="ast-41"><span id="ast-42" class="other_trans">r</span>.status_code</span><span id="ast-43" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-44">200</span>)</span>&nbsp;or&nbsp;<span id="ast-45">(<span id="ast-46"><span id="ast-47" class="other_trans">r</span>.status_code</span><span id="ast-48" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-49">300</span>)</span>)</span>:<span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">BeanBagException</span>(<span id="ast-53">(<span id="ast-54">'Bad&nbsp;response&nbsp;code:&nbsp;%d&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58" class="other_trans">r</span>.status_code</span>,&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">r</span>.reason</span>)</span>)</span>,&nbsp;<span id="ast-61" class="other_trans">r</span>,&nbsp;<span id="ast-62">(<span id="ast-63" class="other_trans">verb</span>,&nbsp;<span id="ast-64" class="other_trans">path</span>,&nbsp;<span id="ast-65" class="other_trans">params</span>,&nbsp;<span id="ast-66" class="other_trans">body</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;GROUPS(<span id="ast-2"><span id="ast-3" class="other_trans">name</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Used&nbsp;for&nbsp;accessing&nbsp;groups&nbsp;of&nbsp;Statuses&nbsp;by&nbsp;a&nbsp;string&nbsp;name.'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">{<span id="ast-10">'active'</span>:&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">filter</span>(<span id="ast-17">lambda&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">s</span></span>:&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">s</span><span id="ast-22" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-23">7</span>)</span></span>,&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">Status</span>.ALL</span>)</span>,&nbsp;<span id="ast-11">'running'</span>:&nbsp;<span id="ast-26">[<span id="ast-27"><span id="ast-28" class="other_trans">Status</span>.RUNNING</span>]</span>,&nbsp;<span id="ast-12">'succeeded'</span>:&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">filter</span>(<span id="ast-31">lambda&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">s</span></span>:&nbsp;<span id="ast-34">(<span id="ast-36">(<span id="ast-37" class="other_trans">s</span><span id="ast-38" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-39">7</span>)</span>&nbsp;and&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">s</span><span id="ast-42" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-43">13</span>)</span>)</span></span>,&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">Status</span>.ALL</span>)</span>,&nbsp;<span id="ast-13">'failed'</span>:&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">filter</span>(<span id="ast-48">lambda&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">s</span></span>:&nbsp;<span id="ast-51">(<span id="ast-52" class="other_trans">s</span><span id="ast-53" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<=&nbsp;</span><span id="ast-54">13</span>)</span></span>,&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">Status</span>.ALL</span>)</span>,&nbsp;<span id="ast-14">'final'</span>:&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">filter</span>(<span id="ast-59">lambda&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">s</span></span>:&nbsp;<span id="ast-62">(<span id="ast-63" class="other_trans">s</span><span id="ast-64" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-65">7</span>)</span></span>,&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">Status</span>.ALL</span>)</span>}</span>.get</span>(<span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans">name</span>.lower</span>()</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;addFeatures(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">features</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Add&nbsp;all&nbsp;fetures&nbsp;specified&nbsp;in&nbsp;the&nbsp;config&nbsp;file&nbsp;or&nbsp;the&nbsp;features\\u000a&nbsp;&nbsp;&nbsp;&nbsp;parameter&nbsp;(as&nbsp;a&nbsp;comma&nbsp;separated&nbsp;list)&nbsp;to&nbsp;this&nbsp;cluster.&nbsp;'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10" class="other_trans">features</span><span id="ast-11" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-12" class="other_trans">None</span>)</span>:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>features</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.config</span>.get</span>(<span id="ast-19">'Features'</span>,&nbsp;<span id="ast-20">'featureList'</span>)</span></span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-26">(<span id="ast-27">'Adding&nbsp;features&nbsp;to&nbsp;ACS:&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-29" class="other_trans">features</span>)</span>)</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>featureList</span>&nbsp;=&nbsp;<span id="ast-32">[<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">x</span>.strip</span>()</span><span id="ast-36">&nbsp;for&nbsp;<span id="ast-37" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans">features</span>.split</span>(<span id="ast-41">','</span>)</span></span>]</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-43" class="other_trans">feature</span>&nbsp;in&nbsp;<span id="ast-44" class="other_trans">featureList</span>:<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.debug</span>(<span id="ast-50">(<span id="ast-51">'Adding&nbsp;feature:&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-53" class="other_trans">feature</span>)</span>)</span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hosts</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58">self</span>.getAgentHostNames</span>()</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-61" class="other_trans">feature</span><span id="ast-62" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-63">'afs'</span>)</span>:<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.createStorage</span>()</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.configureSSH</span>()</span></span><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hosts</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76">self</span>.getAgentHostNames</span>()</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.addAzureFileService</span>(<span id="ast-81" class="other_trans">hosts</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-83">(<span id="ast-84"><span id="ast-85" class="other_trans">feature</span>[<span id="ast-86">:<span id="ast-87">5</span></span>]</span><span id="ast-88" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-89">'pull&nbsp;'</span>)</span>:<span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-91">"'addFeature&nbsp;pull'&nbsp;is&nbsp;deprecated.&nbsp;Please&nbsp;use&nbsp;'docker&nbsp;pull'&nbsp;instead"</span></span><span id="ast-92"><span id="ast-93"><span id="ast-94" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>agentDockerCommand&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-95" class="incorrect_node">feature&nbsp;&rarr;&nbsp;hosts&nbsp;</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.error</span>(<span id="ast-101">(<span id="ast-102">'Unknown&nbsp;feature:&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-104" class="other_trans">feature</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;to_internal_value(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">data</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>.kwargs</span>[<span id="ast-9"><span id="ast-10">'many'</span></span>]</span>:<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>serializer</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.serializer</span>.child</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">isinstance</span>(<span id="ast-21" class="other_trans">data</span>,&nbsp;<span id="ast-22" class="other_trans">list</span>)</span>)</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">ParseError</span>(<span id="ast-26">(<span id="ast-27">"'%s'&nbsp;value&nbsp;must&nbsp;be&nbsp;a&nbsp;list"</span>&nbsp;%&nbsp;<span id="ast-29"><span id="ast-30">self</span>.field_name</span>)</span>)</span></span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-32">[<span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>.to_internal_value_single</span>(<span id="ast-36" class="other_trans">instance</span>,&nbsp;<span id="ast-37" class="other_trans">serializer</span>)</span><span id="ast-38">&nbsp;for&nbsp;<span id="ast-39" class="other_trans">instance</span>&nbsp;in&nbsp;<span id="ast-40" class="other_trans">data</span></span>]</span></span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44">self</span>.to_internal_value_single</span>(<span id="ast-45" class="correct_node">instance&nbsp;&rarr;&nbsp;data&nbsp;</span>,&nbsp;<span id="ast-46"><span id="ast-47">self</span>.serializer</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse_user_command(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">code</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lines</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">code</span>.split</span>(<span id="ast-10">'\\u000a'</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>first_line</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">lines</span>[<span id="ast-15"><span id="ast-16">0</span></span>]</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>other_lines</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">'\\u000a'</span>.join</span>(<span id="ast-22"><span id="ast-23" class="other_trans">lines</span>[<span id="ast-24"><span id="ast-25">1</span>:</span>]</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">first_line</span>.startswith</span>(<span id="ast-30">'%%'</span>)</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first_line</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">first_line</span>[<span id="ast-35"><span id="ast-36">1</span>:</span>]</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39">not</span>&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">first_line</span>.startswith</span>(<span id="ast-43">'%'</span>)</span>)</span>:<span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first_line</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48">'%{}&nbsp;{}'</span>.format</span>(<span id="ast-49"><span id="ast-50" class="other_trans">UserCommandParser</span>.run_command</span>,&nbsp;<span id="ast-51" class="correct_node">code&nbsp;&rarr;&nbsp;first_line&nbsp;</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;move_to_point(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">point</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.view</span>.sel</span>()</span>.clear</span>()</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.view</span>.sel</span>()</span>.add</span>(<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">sublime</span>.Region</span>(<span id="ast-22" class="other_trans">point</span>)</span>)</span></span><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-25" class="other_trans">pointrow</span>,&nbsp;<span id="ast-26" class="other_trans">_</span>)</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30">self</span>.view</span>.rowcol</span>(<span id="ast-31" class="other_trans">point</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pointstart</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">self</span>.view</span>.text_point</span>(<span id="ast-38"><span id="ast-39" class="other_trans">max</span>(<span id="ast-40">(<span id="ast-41" class="other_trans">pointrow</span>&nbsp;-&nbsp;<span id="ast-43">3</span>)</span>,&nbsp;<span id="ast-44">0</span>)</span>,&nbsp;<span id="ast-45">0</span>)</span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pointend</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>.view</span>.text_point</span>(<span id="ast-52">(<span id="ast-53" class="other_trans">pointrow</span>&nbsp;+&nbsp;<span id="ast-55">3</span>)</span>,&nbsp;<span id="ast-56">0</span>)</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pointregion</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">sublime</span>.Region</span>(<span id="ast-62" class="incorrect_node">pointstart&nbsp;&rarr;&nbsp;pointrow&nbsp;</span>,&nbsp;<span id="ast-63" class="other_trans">pointend</span>)</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-65">(<span id="ast-66" class="ref_node">pointstart&nbsp;&rarr;&nbsp;pointrow&nbsp;</span><span id="ast-67" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-68">10</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.view</span>.set_viewport_position</span>(<span id="ast-74">(<span id="ast-75">0.0</span>,&nbsp;<span id="ast-76">0.0</span>)</span>,&nbsp;<span id="ast-77">False</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-79">(<span id="ast-80">not</span>&nbsp;<span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86">self</span>.view</span>.visible_region</span>()</span>.contains</span>(<span id="ast-87" class="other_trans">pointregion</span>)</span>)</span>:<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.view</span>.show</span>(<span id="ast-93" class="other_trans">pointregion</span>,&nbsp;<span id="ast-94">False</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">argmap</span>,&nbsp;<span id="ast-5" class="other_trans">req</span>,&nbsp;<span id="ast-7" class="other_trans">locations</span>,&nbsp;<span id="ast-9" class="other_trans">validate</span>,&nbsp;<span id="ast-11" class="other_trans">force_all</span></span>):<span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Main&nbsp;request&nbsp;parsing&nbsp;method.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;argmap:&nbsp;Either&nbsp;a&nbsp;`marshmallow.Schema`,&nbsp;a&nbsp;`dict`\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;argname&nbsp;-&gt;&nbsp;`marshmallow.fields.Field`&nbsp;pairs,&nbsp;or&nbsp;a&nbsp;callable\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;accepts&nbsp;a&nbsp;request&nbsp;and&nbsp;returns&nbsp;a&nbsp;`marshmallow.Schema`.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;req:&nbsp;The&nbsp;request&nbsp;object&nbsp;to&nbsp;parse.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;tuple&nbsp;locations:&nbsp;Where&nbsp;on&nbsp;the&nbsp;request&nbsp;to&nbsp;search&nbsp;for&nbsp;values.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;include&nbsp;one&nbsp;or&nbsp;more&nbsp;of&nbsp;``('json',&nbsp;'querystring',&nbsp;'form',\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'headers',&nbsp;'cookies',&nbsp;'files')``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;callable&nbsp;validate:&nbsp;Validation&nbsp;function&nbsp;or&nbsp;list&nbsp;of&nbsp;validation&nbsp;functions\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;receives&nbsp;the&nbsp;dictionary&nbsp;of&nbsp;parsed&nbsp;arguments.&nbsp;Validator&nbsp;either&nbsp;returns&nbsp;a\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;boolean&nbsp;or&nbsp;raises&nbsp;a&nbsp;:exc:`ValidationError`.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:return:&nbsp;A&nbsp;dictionary&nbsp;of&nbsp;parsed&nbsp;arguments\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>req</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-22" class="other_trans">req</span>&nbsp;if&nbsp;<span id="ast-18">(<span id="ast-19" class="other_trans">req</span><span id="ast-20" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-21" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.get_default_request</span>()</span></span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">req</span><span id="ast-29" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-30" class="other_trans">None</span>)</span>,&nbsp;<span id="ast-31">'Must&nbsp;pass&nbsp;req&nbsp;object'</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>&nbsp;=&nbsp;<span id="ast-34">None</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>validators</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38">_ensure_list_of_callables</span>(<span id="ast-39" class="other_trans">validate</span>)</span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>schema</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44">self</span>._get_schema</span>(<span id="ast-45" class="other_trans">argmap</span>,&nbsp;<span id="ast-46" class="other_trans">req</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parsed</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53">self</span>._parse_request</span>(schema=<span id="ast-55" class="incorrect_node">schema&nbsp;&rarr;&nbsp;argmap&nbsp;</span>,&nbsp;req=<span id="ast-57">req</span>,&nbsp;locations=<span id="ast-59" class="other_trans">locations</span>)</span></span><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64">self</span>.load</span>(<span id="ast-65" class="other_trans">parsed</span>,&nbsp;<span id="ast-66">schema</span>)</span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._validate_arguments</span>(<span id="ast-71"><span id="ast-72" class="other_trans">result</span>.data</span>,&nbsp;<span id="ast-73">validators</span>)</span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77">ma</span>.exceptions</span>.ValidationError</span>&nbsp;as&nbsp;<span id="ast-78" class="other_trans">error</span>:<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._on_validation_error</span>(<span id="ast-83" class="other_trans">error</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>finally:<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.clear_cache</span>()</span></span></span><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-93" class="other_trans">force_all</span>:<span id="ast-94"><span id="ast-95"><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fill_in_missing_args</span>(<span id="ast-97" class="other_trans">ret</span>,&nbsp;<span id="ast-98" class="ref_node">argmap&nbsp;&rarr;&nbsp;schema&nbsp;</span>)</span></span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-100" class="other_trans">ret</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;work(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">response_dict</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response_dict</span>&nbsp;=&nbsp;<span id="ast-8">(<span id="ast-10" class="other_trans">response_dict</span>&nbsp;or&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.create_encounter_api_call</span>()</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16">not</span>&nbsp;<span id="ast-17" class="other_trans">response_dict</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">WorkerResult</span>.ERROR</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>responses</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">response_dict</span>[<span id="ast-26"><span id="ast-27">'responses'</span></span>]</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">responses</span>[<span id="ast-32"><span id="ast-33"><span id="ast-34">self</span>.response_key</span></span>]</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37"><span id="ast-38" class="other_trans">response</span>[<span id="ast-39"><span id="ast-40"><span id="ast-41">self</span>.response_status_key</span></span>]</span><span id="ast-42" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-43" class="other_trans">ENCOUNTER_STATUS_SUCCESS</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46"><span id="ast-47" class="other_trans">response</span>[<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>.response_status_key</span></span>]</span><span id="ast-51" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-52">ENCOUNTER_STATUS_NOT_IN_RANGE</span>)</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-57">'pokemon_not_in_range'</span>,&nbsp;formatted=<span id="ast-59">'Pokemon&nbsp;went&nbsp;out&nbsp;of&nbsp;range!'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-61">(<span id="ast-62"><span id="ast-63" class="other_trans">response</span>[<span id="ast-64"><span id="ast-65"><span id="ast-66">self</span>.response_status_key</span></span>]</span><span id="ast-67" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-68" class="other_trans">ENCOUNTER_STATUS_POKEMON_INVENTORY_FULL</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-73">'pokemon_inventory_full'</span>,&nbsp;formatted=<span id="ast-75">'Your&nbsp;Pokemon&nbsp;inventory&nbsp;is&nbsp;full!&nbsp;Could&nbsp;not&nbsp;catch!'</span>)</span></span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-77"><span id="ast-78" class="other_trans">WorkerResult</span>.ERROR</span></span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-80">KeyError</span>:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">WorkerResult</span>.ERROR</span></span></span></span><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pokemon_data</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans">response</span>[<span id="ast-94"><span id="ast-95">'wild_pokemon'</span></span>]</span>[<span id="ast-96"><span id="ast-97">'pokemon_data'</span></span>]</span>&nbsp;if&nbsp;<span id="ast-87">(<span id="ast-88">'wild_pokemon'</span><span id="ast-89">&nbsp;in&nbsp;</span><span id="ast-90" class="other_trans">response</span>)</span>&nbsp;else&nbsp;<span id="ast-98"><span id="ast-99" class="other_trans">response</span>[<span id="ast-100"><span id="ast-101">'pokemon_data'</span></span>]</span></span></span><span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pokemon</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105">Pokemon</span>(<span id="ast-106" class="other_trans">pokemon_data</span>)</span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-108">(<span id="ast-109">not</span>&nbsp;<span id="ast-110"><span id="ast-111"><span id="ast-112">self</span>._should_catch_pokemon</span>(<span id="ast-113" class="other_trans">pokemon</span>)</span>)</span>:<span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-115"><span id="ast-116">WorkerResult</span>.SUCCESS</span></span></span><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>is_vip</span>&nbsp;=&nbsp;<span id="ast-119"><span id="ast-120"><span id="ast-121">self</span>._is_vip_pokemon</span>(<span id="ast-122" class="other_trans">pokemon</span>)</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124">(<span id="ast-125"><span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130" class="other_trans">inventory</span>.items</span>()</span>.get</span>(<span id="ast-131">ITEM_POKEBALL</span>)</span>.count</span><span id="ast-132" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-133">1</span>)</span>:<span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-135">(<span id="ast-136"><span id="ast-137"><span id="ast-138"><span id="ast-139"><span id="ast-140"><span id="ast-141">inventory</span>.items</span>()</span>.get</span>(<span id="ast-142">ITEM_GREATBALL</span>)</span>.count</span><span id="ast-143" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-144">1</span>)</span>:<span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-146">(<span id="ast-147"><span id="ast-148"><span id="ast-149"><span id="ast-150"><span id="ast-151"><span id="ast-152">inventory</span>.items</span>()</span>.get</span>(<span id="ast-153" class="other_trans">ITEM_ULTRABALL</span>)</span>.count</span><span id="ast-154" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-155">1</span>)</span>:<span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-157"><span id="ast-158">WorkerResult</span>.SUCCESS</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-160">(<span id="ast-162">(<span id="ast-163">not</span>&nbsp;<span id="ast-164" class="other_trans">is_vip</span>)</span>&nbsp;and&nbsp;<span id="ast-165">(<span id="ast-166"><span id="ast-167"><span id="ast-168"><span id="ast-169"><span id="ast-170"><span id="ast-171" class="other_trans">inventory</span>.items</span>()</span>.get</span>(<span id="ast-172">ITEM_ULTRABALL</span>)</span>.count</span><span id="ast-173" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-174"><span id="ast-175">self</span>.min_ultraball_to_keep</span>)</span>)</span>:<span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-177"><span id="ast-178">WorkerResult</span>.SUCCESS</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;DelFavBoard(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">index</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7" class="other_trans">index</span><span id="ast-8" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-9"><span id="ast-10">self</span>._count</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12"><span id="ast-13">self</span>._count</span></span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">index</span><span id="ast-17" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-18">0</span>)</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-20"><span id="ast-21">self</span>._count</span></span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fboard</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>._favboards</span>[<span id="ast-27"><span id="ast-28" class="other_trans">index</span></span>]</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32">fboard</span>.IsDir</span>()</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-35">0</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-37">(<span id="ast-38" class="other_trans">j</span><span id="ast-39" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-40"><span id="ast-41">self</span>._count</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>._favboards</span>[<span id="ast-48"><span id="ast-49">j</span></span>]</span>._father</span><span id="ast-50" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-51" class="other_trans">index</span>)</span>:<span id="ast-52"><span id="ast-53"><span id="ast-54" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>DelFavBoard&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-55" class="other_trans">j</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57">(<span id="ast-58" class="other_trans">j</span><span id="ast-59" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-60" class="other_trans">index</span>)</span>:<span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>index</span>&nbsp;=&nbsp;<span id="ast-63">(<span id="ast-64" class="other_trans">index</span>&nbsp;-&nbsp;<span id="ast-66">1</span>)</span></span></span><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-69">(<span id="ast-70" class="other_trans">j</span>&nbsp;-&nbsp;<span id="ast-72">1</span>)</span></span></span><span id="ast-73"><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-75">(<span id="ast-76" class="other_trans">j</span>&nbsp;+&nbsp;<span id="ast-78">1</span>)</span></span></span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._count</span>&nbsp;=&nbsp;<span id="ast-82">(<span id="ast-83"><span id="ast-84">self</span>._count</span>&nbsp;-&nbsp;<span id="ast-86">1</span>)</span></span><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-89" class="other_trans">index</span></span><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-91">(<span id="ast-92">j</span><span id="ast-93" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-94"><span id="ast-95">self</span>._count</span>)</span>:<span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._favboards</span>[<span id="ast-100"><span id="ast-101">j</span></span>]</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103"><span id="ast-104">self</span>._favboards</span>[<span id="ast-105"><span id="ast-106">(<span id="ast-107" class="other_trans">j</span>&nbsp;+&nbsp;<span id="ast-109">1</span>)</span></span>]</span></span><span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-112">(<span id="ast-113">j</span>&nbsp;+&nbsp;<span id="ast-115">1</span>)</span></span></span><span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-118">0</span></span><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-120">(<span id="ast-121" class="other_trans">j</span><span id="ast-122" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-123"><span id="ast-124">self</span>._count</span>)</span>:<span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-126">(<span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130">self</span>._favboards</span>[<span id="ast-131"><span id="ast-132" class="other_trans">j</span></span>]</span>._father</span><span id="ast-133" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-134" class="other_trans">index</span>)</span>:<span id="ast-135"><span id="ast-136"><span id="ast-137"><span id="ast-138"><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._favboards</span>[<span id="ast-140"><span id="ast-141" class="other_trans">j</span></span>]</span>._father</span>&nbsp;=&nbsp;<span id="ast-142">(<span id="ast-143"><span id="ast-144"><span id="ast-145"><span id="ast-146">self</span>._favboards</span>[<span id="ast-147"><span id="ast-148" class="other_trans">j</span></span>]</span>._father</span>&nbsp;-&nbsp;<span id="ast-150">1</span>)</span></span></span><span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-153">(<span id="ast-154" class="other_trans">j</span>&nbsp;+&nbsp;<span id="ast-156">1</span>)</span></span></span><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-158">(<span id="ast-159"><span id="ast-160">self</span>._current</span><span id="ast-161" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-162" class="other_trans">index</span>)</span>:<span id="ast-163"><span id="ast-164"><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._current</span>&nbsp;=&nbsp;<span id="ast-166">(<span id="ast-167"><span id="ast-168">self</span>._current</span>&nbsp;-&nbsp;<span id="ast-170">1</span>)</span></span></span><span id="ast-171"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-172">(<span id="ast-173"><span id="ast-174">self</span>._count</span><span id="ast-175" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-176">0</span>)</span>:<span id="ast-177"><span id="ast-178"><span id="ast-179"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._count</span>&nbsp;=&nbsp;<span id="ast-180">1</span></span><span id="ast-181"><span id="ast-182"><span id="ast-183"><span id="ast-184"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._favboards</span>[<span id="ast-185"><span id="ast-186">0</span></span>]</span>&nbsp;=&nbsp;<span id="ast-187"><span id="ast-188" class="other_trans">FavBoard</span>(<span id="ast-189">0</span>)</span></span></span><span id="ast-190"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-191">0</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;generate_random_bytes(<span id="ast-2"><span id="ast-3" class="other_trans">count</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">win32prng</span>.generate_random_bytes</span>(<span id="ast-9" class="other_trans">count</span>)</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13" class="other_trans">len</span>(<span id="ast-14" class="other_trans">s</span>)</span><span id="ast-15" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-16" class="other_trans">count</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-18" class="other_trans">s</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;refresh(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">new_time</span>,&nbsp;<span id="ast-6" class="other_trans">forced</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-11">(<span id="ast-12">(<span id="ast-13" class="other_trans">new_time</span>&nbsp;-&nbsp;<span id="ast-15"><span id="ast-16">self</span>._last_update</span>)</span><span id="ast-17" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-18"><span id="ast-19">self</span>.interval</span>)</span>&nbsp;or&nbsp;<span id="ast-20" class="other_trans">forced</span>)</span>:<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print_multi_line</span>(<span id="ast-24"><span id="ast-25">self</span>.warped_obj</span>)</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._last_update</span>&nbsp;=&nbsp;<span id="ast-29" class="other_trans">new_time</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;open(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>core</span>.svn_config_ensure</span>(<span id="ast-8" class="other_trans">None</span>)</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ctx</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">client</span>.svn_client_ctx_t</span>()</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ctx</span>.auth_baton</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">core</span>.svn_auth_open</span>(<span id="ast-22">[<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">client</span>.svn_client_get_simple_provider</span>()</span>,&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">client</span>.svn_client_get_username_provider</span>()</span>,&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">client</span>.svn_client_get_ssl_server_trust_file_provider</span>()</span>,&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">client</span>.svn_client_get_ssl_client_cert_file_provider</span>()</span>,&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">client</span>.svn_client_get_ssl_client_cert_pw_file_provider</span>()</span>]</span>)</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ctx</span>.config</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">core</span>.svn_config_get_config</span>(<span id="ast-45" class="other_trans">None</span>)</span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ra_callbacks</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">ra</span>.svn_ra_callbacks_t</span>()</span></span><span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ra_callbacks</span>.auth_baton</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55" class="correct_node">ctx&nbsp;&rarr;&nbsp;self.&nbsp;</span>.auth_baton</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ra_session</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">ra</span>.svn_ra_open</span>(<span id="ast-62"><span id="ast-63">self</span>.rootpath</span>,&nbsp;<span id="ast-64" class="other_trans">ra_callbacks</span>,&nbsp;<span id="ast-65" class="other_trans">None</span>,&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68">self</span>.ctx</span>.config</span>)</span></span><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.youngest</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans">ra</span>.svn_ra_get_latest_revnum</span>(<span id="ast-75"><span id="ast-76">self</span>.ra_session</span>)</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._dirent_cache</span>&nbsp;=&nbsp;<span id="ast-80">{}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;choose_next(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">scaffold</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>position</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">scaffold</span>._flow_position_instance</span>._position</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>idx</span>&nbsp;=&nbsp;<span id="ast-12">-1</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-14">(<span id="ast-15" class="other_trans">idx</span>,&nbsp;<span id="ast-16" class="other_trans">ffc</span>)</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">enumerate</span>(<span id="ast-19"><span id="ast-20" class="other_trans">position</span>.flow_component_classes</span>)</span>:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24" class="other_trans">scaffold</span>.__class__</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26" class="other_trans">ffc</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">idx</span><span id="ast-31" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-32">-1</span>)</span>:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-34">ValueError</span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37">(<span id="ast-38" class="other_trans">idx</span>&nbsp;+&nbsp;<span id="ast-40">1</span>)</span><span id="ast-41" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-42"><span id="ast-43" class="other_trans">len</span>(<span id="ast-44"><span id="ast-45" class="other_trans">position</span>.flow_component_classes</span>)</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-47" class="other_trans">ValueError</span></span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>active_child</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">position</span>.flow_component_classes</span>[<span id="ast-53"><span id="ast-54">(<span id="ast-55" class="other_trans">idx</span>&nbsp;+&nbsp;<span id="ast-57">1</span>)</span></span>]</span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>action_set</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">scaffold</span>.action_set</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>child_idx</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">action_set</span>.index</span>(<span id="ast-67" class="other_trans">active_child</span>)</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-70">(<span id="ast-71" class="other_trans">child_idx</span>&nbsp;+&nbsp;<span id="ast-73">1</span>)</span><span id="ast-74" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-75"><span id="ast-76" class="other_trans">len</span>(<span id="ast-77" class="other_trans">action_set</span>)</span>)</span>:<span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-79">COMPLETE</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;readAllPoints(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.readHeader</span>()</span></span><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>points</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">np</span>.recarray</span>(shape=<span id="ast-14"><span id="ast-15">self</span>.numpoints</span>,&nbsp;formats=<span id="ast-17"><span id="ast-18">self</span>._pointFormat</span>,&nbsp;names=<span id="ast-20"><span id="ast-21">self</span>._pointNames</span>,&nbsp;byteorder=<span id="ast-23">'&gt;'</span>)</span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lines</span>&nbsp;=&nbsp;<span id="ast-26">[]</span></span><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-29">0</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>secType</span>&nbsp;=&nbsp;<span id="ast-32">None</span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.readHeader</span>()</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-39">(<span id="ast-40" class="other_trans">secType</span><span id="ast-41" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-42">'End'</span>)</span>:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>secType</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>.sectionType</span>()</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-50" class="other_trans">secType</span><span id="ast-51" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-52">'Points'</span>)</span>:<span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>currentPoints</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">self</span>.readPoints</span>()</span></span><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>points</span>[<span id="ast-61"><span id="ast-62">i</span>:<span id="ast-63">(<span id="ast-64" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">len</span>(<span id="ast-68" class="other_trans">currentPoints</span>)</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-69" class="other_trans">currentPoints</span></span><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-73"><span id="ast-74">len</span>(<span id="ast-75" class="other_trans">currentPoints</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-77">(<span id="ast-78" class="other_trans">secType</span><span id="ast-79" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-80">'Lines'</span>)</span>:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-82">True</span>:<span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lineInfo</span>&nbsp;=&nbsp;<span id="ast-85"><span id="ast-86"><span id="ast-87">self</span>.lineInfo</span>()</span></span><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>currentPoints</span>&nbsp;=&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92">self</span>.readPoints</span>()</span></span><span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>points</span>[<span id="ast-96"><span id="ast-97">i</span>:<span id="ast-98">(<span id="ast-99" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">len</span>(<span id="ast-103" class="other_trans">currentPoints</span>)</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-104">currentPoints</span></span><span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lines</span>.append</span>(<span id="ast-109"><span id="ast-110" class="ref_node">_line&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-111" class="other_trans">lineInfo</span>,&nbsp;<span id="ast-112"><span id="ast-113" class="other_trans">points</span>[<span id="ast-114"><span id="ast-115" class="other_trans">i</span>:<span id="ast-116">(<span id="ast-117" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-119"><span id="ast-120">len</span>(<span id="ast-121" class="other_trans">currentPoints</span>)</span>)</span></span>]</span>)</span>)</span></span><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-125"><span id="ast-126" class="other_trans">len</span>(<span id="ast-127" class="other_trans">currentPoints</span>)</span></span></span></span></span><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-129" class="other_trans">EOFError</span>:<span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span><span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lines</span>&nbsp;=&nbsp;<span id="ast-134" class="other_trans">lines</span></span><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-136">points</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_update_self_made_marks(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.debug</span>(<span id="ast-8">'Update&nbsp;self-made&nbsp;marks'</span>)</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>patch_id_to_user_id</span>&nbsp;=&nbsp;<span id="ast-11">{}</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-13" class="other_trans">record</span>&nbsp;in&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.runtime_storage_inst</span>.get_all_records</span>()</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">record</span>[<span id="ast-22"><span id="ast-23">'record_type'</span></span>]</span><span id="ast-24" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-25">'patch'</span>)</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>patch_id_to_user_id</span>[<span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">record</span>[<span id="ast-32"><span id="ast-33">'primary_key'</span></span>]</span></span>]</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">record</span>[<span id="ast-36"><span id="ast-37">'user_id'</span></span>]</span></span></span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-39" class="other_trans">record</span>&nbsp;in&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43">self</span>.runtime_storage_inst</span>.get_all_records</span>()</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46"><span id="ast-47" class="other_trans">record</span>[<span id="ast-48"><span id="ast-49">'record_type'</span></span>]</span><span id="ast-50" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-51">'mark'</span>)</span>:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>patch_id</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">utils</span>.get_patch_id</span>(<span id="ast-58"><span id="ast-59" class="other_trans">record</span>[<span id="ast-60"><span id="ast-61">'review_id'</span></span>]</span>,&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">record</span>[<span id="ast-64"><span id="ast-65">'patch'</span></span>]</span>)</span></span><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-67">(<span id="ast-68"><span id="ast-69" class="other_trans">record</span>[<span id="ast-70"><span id="ast-71">'user_id'</span></span>]</span><span id="ast-72" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans">patch_id_to_user_id</span>.get</span>(<span id="ast-76" class="other_trans">patch_id</span>)</span>)</span>:<span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-78">(<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans">record</span>[<span id="ast-82"><span id="ast-83">'type'</span></span>]</span>[<span id="ast-84">:<span id="ast-85">5</span></span>]</span><span id="ast-86" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-87">'Self-'</span>)</span>:<span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>record</span>[<span id="ast-91"><span id="ast-92">'type'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-93">(<span id="ast-94">'Self-%s'</span>&nbsp;%&nbsp;<span id="ast-96"><span id="ast-97" class="other_trans">record</span>[<span id="ast-98"><span id="ast-99">'type'</span></span>]</span>)</span></span><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-102" class="other_trans">record</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;lint(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7">(<span id="ast-9"><span id="ast-10">self</span>.language</span>&nbsp;and&nbsp;<span id="ast-11"><span id="ast-12">self</span>.cmd</span>&nbsp;and&nbsp;<span id="ast-13"><span id="ast-14">self</span>.regex</span>)</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-16" class="other_trans">NotImplementedError</span></span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.run</span>(<span id="ast-22"><span id="ast-23">self</span>.cmd</span>,&nbsp;<span id="ast-24"><span id="ast-25">self</span>.code</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28">not</span>&nbsp;<span id="ast-29" class="other_trans">output</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>persist</span>.debug</span>(<span id="ast-35">'Output:'</span>,&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">repr</span>(<span id="ast-38" class="other_trans">output</span>)</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">match</span>,&nbsp;<span id="ast-42" class="other_trans">row</span>,&nbsp;<span id="ast-43" class="other_trans">col</span>,&nbsp;<span id="ast-44" class="other_trans">message</span>,&nbsp;<span id="ast-45">near</span>)</span>&nbsp;in&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48">self</span>.find_errors</span>(<span id="ast-49" class="other_trans">output</span>)</span>:<span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-53" class="other_trans">match</span>&nbsp;and&nbsp;<span id="ast-54">(<span id="ast-55" class="other_trans">row</span><span id="ast-56" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-57">None</span>)</span>)</span>:<span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59">(<span id="ast-60" class="other_trans">col</span><span id="ast-61" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-62" class="other_trans">None</span>)</span>:<span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65"><span id="ast-66">self</span>.tab_size</span><span id="ast-67" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-68">1</span>)</span>:<span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-71" class="other_trans">start</span>,&nbsp;<span id="ast-72" class="other_trans">end</span>)</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76">self</span>.highlight</span>.full_line</span>(<span id="ast-77" class="other_trans">row</span>)</span></span><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>code_line</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81" class="correct_node">code&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-82"><span id="ast-83" class="other_trans">start</span>:<span id="ast-84" class="other_trans">end</span></span>]</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;=&nbsp;<span id="ast-87">0</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-89" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-90"><span id="ast-91" class="other_trans">range</span>(<span id="ast-92"><span id="ast-93">len</span>(<span id="ast-94" class="other_trans">code_line</span>)</span>)</span>:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96">(<span id="ast-97"><span id="ast-98" class="other_trans">code_line</span>[<span id="ast-99"><span id="ast-100" class="other_trans">i</span></span>]</span><span id="ast-101" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-102">'\\u0009'</span>)</span>:<span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;+=&nbsp;<span id="ast-106">(<span id="ast-107"><span id="ast-108">self</span>.tab_size</span>&nbsp;-&nbsp;<span id="ast-110">1</span>)</span></span></span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;evaluate(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">test_section</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9">(<span id="ast-10" class="other_trans">test_section</span><span id="ast-11" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-12">[]</span>)</span>)</span>:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>test_data_pool</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">DataPool</span>(<span id="ast-17" class="other_trans">test_section</span>,&nbsp;<span id="ast-18" class="correct_node">data_path&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>test_data_pool</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22">self</span>.test_data_pool</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_process_results(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7">(<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.__parsed</span>[<span id="ast-12"><span id="ast-13">'details'</span></span>]</span>&nbsp;and&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.__parsed</span>[<span id="ast-17"><span id="ast-18">'attributes'</span></span>]</span>&nbsp;and&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.__parsed</span>[<span id="ast-22"><span id="ast-23">'events'</span></span>]</span>)</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-25"><span id="ast-26" class="other_trans">ValueError</span>(<span id="ast-27">'The&nbsp;replay&nbsp;details&nbsp;must&nbsp;be&nbsp;parsed&nbsp;before&nbsp;parsing&nbsp;attributes'</span>)</span></span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32">dict</span>(<span id="ast-33">(<span id="ast-34">[<span id="ast-35" class="other_trans">team</span>,&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">len</span>(<span id="ast-38" class="other_trans">players</span>)</span>]</span><span id="ast-39">&nbsp;for&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">team</span>,&nbsp;<span id="ast-42" class="other_trans">players</span>)</span>&nbsp;in&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46">self</span>.teams</span>.iteritems</span>()</span></span>)</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-48" class="other_trans">event</span>&nbsp;in&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>.events_by_type</span>[<span id="ast-52"><span id="ast-53">'leave'</span></span>]</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57">event</span>.player</span><span id="ast-58" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-59"><span id="ast-60">len</span>(<span id="ast-61"><span id="ast-62">self</span>.players</span>)</span>)</span>:<span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>team</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68">self</span>.player</span>[<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">event</span>.player</span></span>]</span>.team</span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>[<span id="ast-76"><span id="ast-77" class="other_trans">team</span></span>]</span>&nbsp;-=&nbsp;<span id="ast-79">1</span></span></span></span><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>remaining</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">set</span>()</span></span><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-85">(<span id="ast-86" class="other_trans">team</span>,&nbsp;<span id="ast-87" class="other_trans">count</span>)</span>&nbsp;in&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91">self</span>.results</span>.iteritems</span>()</span>:<span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-93">(<span id="ast-94" class="other_trans">count</span><span id="ast-95" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-96">0</span>)</span>:<span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>[<span id="ast-101"><span id="ast-102" class="other_trans">team</span></span>]</span>&nbsp;=&nbsp;<span id="ast-103">'Lost'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>remaining</span>.add</span>(<span id="ast-108">team</span>)</span></span></span></span><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-110">(<span id="ast-111"><span id="ast-112" class="other_trans">len</span>(<span id="ast-113" class="other_trans">remaining</span>)</span><span id="ast-114" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-115">1</span>)</span>:<span id="ast-116"><span id="ast-117"><span id="ast-118"><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>[<span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123" class="other_trans">remaining</span>.pop</span>()</span></span>]</span>&nbsp;=&nbsp;<span id="ast-124">'Won'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-126"><span id="ast-127">self</span>.recorder</span>:<span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-129" class="other_trans">team</span>&nbsp;in&nbsp;<span id="ast-130"><span id="ast-131">set</span>(<span id="ast-132" class="other_trans">remaining</span>)</span>:<span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-134">(<span id="ast-136">(<span id="ast-137" class="other_trans">team</span><span id="ast-138" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-139"><span id="ast-140"><span id="ast-141">self</span>.recorder</span>.team</span>)</span>&nbsp;and&nbsp;<span id="ast-142">(<span id="ast-143"><span id="ast-144"><span id="ast-145">self</span>.results</span>[<span id="ast-146"><span id="ast-147" class="other_trans">team</span></span>]</span><span id="ast-148" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-149">1</span>)</span>)</span>:<span id="ast-150"><span id="ast-151"><span id="ast-152"><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>[<span id="ast-154"><span id="ast-155" class="other_trans">team</span></span>]</span>&nbsp;=&nbsp;<span id="ast-156">'Lost'</span></span><span id="ast-157"><span id="ast-158"><span id="ast-159"><span id="ast-160" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>remaining</span>.remove</span>(<span id="ast-161" class="other_trans">team</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-162"><span id="ast-163"><span id="ast-164"><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>[<span id="ast-166"><span id="ast-167">team</span></span>]</span>&nbsp;=&nbsp;<span id="ast-168">'Unknown'</span></span></span></span><span id="ast-169"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-170">(<span id="ast-171"><span id="ast-172">len</span>(<span id="ast-173" class="other_trans">remaining</span>)</span><span id="ast-174" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-175">1</span>)</span>:<span id="ast-176"><span id="ast-177"><span id="ast-178"><span id="ast-179"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>[<span id="ast-180"><span id="ast-181"><span id="ast-182"><span id="ast-183" class="other_trans">remaining</span>.pop</span>()</span></span>]</span>&nbsp;=&nbsp;<span id="ast-184">'Won'</span></span></span></span><span id="ast-185"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-186" class="other_trans">player</span>&nbsp;in&nbsp;<span id="ast-187"><span id="ast-188">self</span>.players</span>:<span id="ast-189"><span id="ast-190"><span id="ast-191"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>player</span>.result</span>&nbsp;=&nbsp;<span id="ast-192"><span id="ast-193"><span id="ast-194">self</span>.results</span>[<span id="ast-195"><span id="ast-196"><span id="ast-197" class="other_trans">player</span>.team</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;digest(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">tokens</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tabular</span>.caption</span>.digest</span>(<span id="ast-10">self</span>,&nbsp;<span id="ast-11" class="other_trans">tokens</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>node</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15">self</span>.parentNode</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">isinstance</span>(<span id="ast-21" class="other_trans">node</span>,&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">tabular</span>.ArrayRow</span>)</span>)</span>:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>node</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">node</span>.parentNode</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">node</span><span id="ast-31" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-32">None</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>node</span>.isCaptionRow</span>&nbsp;=&nbsp;<span id="ast-36">True</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-38">(<span id="ast-39">not</span>&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">isinstance</span>(<span id="ast-42" class="other_trans">node</span>,&nbsp;<span id="ast-43" class="other_trans">longtable</span>)</span>)</span>:<span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>node</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">node</span>.parentNode</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-51">(<span id="ast-52" class="other_trans">node</span><span id="ast-53" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-54" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57" class="other_trans">getattr</span>(<span id="ast-58" class="other_trans">node</span>,&nbsp;<span id="ast-59">'caption'</span>,&nbsp;<span id="ast-60" class="other_trans">None</span>)</span><span id="ast-61" class="ref_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-62" class="other_trans">None</span>)</span>)</span>:<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>node</span>.caption</span>&nbsp;=&nbsp;<span id="ast-66">self</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;in_cache(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-6" class="other_trans">first</span>,&nbsp;<span id="ast-7" class="other_trans">last</span>)</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.paginator</span>.cached_page_indices</span>()</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">first</span><span id="ast-15" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-17"><span id="ast-18">self</span>.number</span><span id="ast-16" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-19" class="other_trans">last</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run_scope(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">scope</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6" class="other_trans">scope</span>:<span id="ast-7"><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scope</span>&nbsp;=&nbsp;<span id="ast-10" class="other_trans">scope</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.write</span>(<span id="ast-16">(<span id="ast-17">'%s&nbsp;['</span>&nbsp;%&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">len</span>(<span id="ast-21" class="other_trans">scope</span>)</span>)</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">i</span>,&nbsp;<span id="ast-25" class="other_trans">fname</span>)</span>&nbsp;in&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">enumerate</span>(<span id="ast-28" class="other_trans">scope</span>)</span>:<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.debug</span>(<span id="ast-34">(<span id="ast-35">'working&nbsp;on&nbsp;file&nbsp;:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-37" class="other_trans">fname</span>)</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40">(<span id="ast-41" class="other_trans">i</span>&nbsp;%&nbsp;<span id="ast-43"><span id="ast-44">self</span>.progress</span>)</span><span id="ast-45" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-46">0</span>)</span>:<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.write</span>(<span id="ast-52">(<span id="ast-53">'%s..&nbsp;'</span>&nbsp;%&nbsp;<span id="ast-55" class="other_trans">i</span>)</span>)</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.flush</span>()</span></span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-63"><span id="ast-64" class="other_trans">open</span>(<span id="ast-65" class="other_trans">fname</span>,&nbsp;<span id="ast-66">'rU'</span>)</span>&nbsp;as&nbsp;<span id="ast-67" class="other_trans">fdata</span>:<span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._execute_ast_visitor</span>(<span id="ast-73" class="other_trans">fname</span>,&nbsp;<span id="ast-74" class="other_trans">fdata</span>,&nbsp;<span id="ast-75"><span id="ast-76">self</span>.b_ma</span>,&nbsp;<span id="ast-77"><span id="ast-78">self</span>.b_rs</span>,&nbsp;<span id="ast-79"><span id="ast-80">self</span>.b_ts</span>)</span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-82" class="other_trans">KeyboardInterrupt</span>&nbsp;as&nbsp;<span id="ast-83" class="other_trans">e</span>:<span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-88">2</span>)</span></span></span></span></span><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-90">IOError</span>&nbsp;as&nbsp;<span id="ast-91" class="other_trans">e</span>:<span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.error</span>(<span id="ast-97">(<span id="ast-98">'%s'</span>&nbsp;%&nbsp;<span id="ast-100"><span id="ast-101" class="other_trans">e</span>.strerror</span>)</span>)</span></span><span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>b_rs&nbsp;&rarr;&nbsp;self.&nbsp;</span>.skip</span>(<span id="ast-106" class="other_trans">fname</span>,&nbsp;<span id="ast-107"><span id="ast-108" class="other_trans">e</span>.strerror</span>)</span></span></span></span></span><span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.write</span>(<span id="ast-114">']\\u000a'</span>)</span></span><span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118"><span id="ast-119" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.flush</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.info</span>(<span id="ast-125">'no&nbsp;filename/s&nbsp;provided,&nbsp;working&nbsp;from&nbsp;stdin'</span>)</span></span><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._execute_ast_visitor</span>(<span id="ast-131">'STDIN'</span>,&nbsp;<span id="ast-132"><span id="ast-133" class="other_trans">sys</span>.stdin</span>,&nbsp;<span id="ast-134"><span id="ast-135">self</span>.b_ma</span>,&nbsp;<span id="ast-136"><span id="ast-137">self</span>.b_rs</span>)</span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-139">KeyboardInterrupt</span>:<span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143"><span id="ast-144"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.debug</span>(<span id="ast-145">'exiting'</span>)</span></span><span id="ast-146"><span id="ast-147"><span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-150">1</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_splitKeys(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">fmt</span>,&nbsp;<span id="ast-5" class="other_trans">keylen</span>,&nbsp;<span id="ast-6" class="other_trans">data</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Split&nbsp;the&nbsp;given&nbsp;data&nbsp;into&nbsp;the&nbsp;headers&nbsp;as&nbsp;specified&nbsp;in&nbsp;the&nbsp;given\\u000a&nbsp;&nbsp;&nbsp;&nbsp;format,&nbsp;the&nbsp;key,&nbsp;and&nbsp;the&nbsp;data.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;(hdrTuple,&nbsp;key,&nbsp;data)'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>hdrSize</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">struct</span>.calcsize</span>(<span id="ast-14">fmt</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-16">(<span id="ast-17">hdrSize</span><span id="ast-18" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-19"><span id="ast-20">len</span>(<span id="ast-21">data</span>)</span>)</span>,&nbsp;<span id="ast-22">(<span id="ast-23">(<span id="ast-24">(<span id="ast-25">'Data&nbsp;too&nbsp;short&nbsp;for&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-27" class="other_trans">fmt</span>)</span>&nbsp;+&nbsp;<span id="ast-29">':&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-31">`<span id="ast-32" class="other_trans">data</span>`</span>)</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>hdr</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37">struct</span>.unpack</span>(<span id="ast-38" class="other_trans">fmt</span>,&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">data</span>[<span id="ast-41">:<span id="ast-42" class="other_trans">hdrSize</span></span>]</span>)</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-44">(<span id="ast-45"><span id="ast-46">len</span>(<span id="ast-47" class="other_trans">data</span>)</span><span id="ast-48" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-49">(<span id="ast-50" class="other_trans">hdrSize</span>&nbsp;+&nbsp;<span id="ast-52" class="other_trans">keylen</span>)</span>)</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">data</span>[<span id="ast-57"><span id="ast-58" class="other_trans">hdrSize</span>:<span id="ast-59">(<span id="ast-60" class="other_trans">keylen</span>&nbsp;+&nbsp;<span id="ast-62" class="other_trans">hdrSize</span>)</span></span>]</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-64">(<span id="ast-65"><span id="ast-66" class="other_trans">len</span>(<span id="ast-67">key</span>)</span><span id="ast-68" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-69" class="other_trans">keylen</span>)</span>,&nbsp;<span id="ast-70">(<span id="ast-71">'len(%s)&nbsp;==&nbsp;%d,&nbsp;expected&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-73">(<span id="ast-74" class="other_trans">key</span>,&nbsp;<span id="ast-75"><span id="ast-76">len</span>(<span id="ast-77">key</span>)</span>,&nbsp;<span id="ast-78" class="other_trans">keylen</span>)</span>)</span></span><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82" class="other_trans">data</span>[<span id="ast-83"><span id="ast-84">(<span id="ast-85" class="other_trans">keylen</span>&nbsp;+&nbsp;<span id="ast-87">hdrSize</span>)</span>:</span>]</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-89">(<span id="ast-90" class="other_trans">hdr</span>,&nbsp;<span id="ast-91" class="other_trans">key</span>,&nbsp;<span id="ast-92">val</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;shouldRebuildDB(<span id="ast-2"><span id="ast-3" class="other_trans">pkgdbpath</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Checks&nbsp;to&nbsp;see&nbsp;if&nbsp;our&nbsp;internal&nbsp;package&nbsp;DB&nbsp;should&nbsp;be&nbsp;rebuilt.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;anything&nbsp;in&nbsp;/Library/Receipts,&nbsp;/Library/Receipts/boms,&nbsp;or\\u000a&nbsp;&nbsp;&nbsp;&nbsp;/Library/Receipts/db/a.receiptdb&nbsp;has&nbsp;a&nbsp;newer&nbsp;modtime&nbsp;than&nbsp;our\\u000a&nbsp;&nbsp;&nbsp;&nbsp;database,&nbsp;we&nbsp;should&nbsp;rebuild.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>receiptsdir</span>&nbsp;=&nbsp;<span id="ast-8">'/Library/Receipts'</span></span><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>bomsdir</span>&nbsp;=&nbsp;<span id="ast-11">'/Library/Receipts/boms'</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sl_receiptsdir</span>&nbsp;=&nbsp;<span id="ast-14">'/private/var/db/receipts'</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>installhistory</span>&nbsp;=&nbsp;<span id="ast-17">'/Library/Receipts/InstallHistory.plist'</span></span><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>applepkgdb</span>&nbsp;=&nbsp;<span id="ast-20">'/Library/Receipts/db/a.receiptdb'</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23">not</span>&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27">os</span>.path</span>.exists</span>(<span id="ast-28" class="other_trans">pkgdbpath</span>)</span>)</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-30">True</span></span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>packagedb_modtime</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36">os</span>.stat</span>(<span id="ast-37" class="other_trans">pkgdbpath</span>)</span>.st_mtime</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42">os</span>.path</span>.exists</span>(<span id="ast-43">receiptsdir</span>)</span>:<span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>receiptsdir_modtime</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49">os</span>.stat</span>(<span id="ast-50" class="other_trans">receiptsdir</span>)</span>.st_mtime</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52">(<span id="ast-53">packagedb_modtime</span><span id="ast-54" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-55" class="other_trans">receiptsdir_modtime</span>)</span>:<span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-57">True</span></span></span><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>receiptlist</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62">os</span>.listdir</span>(<span id="ast-63" class="other_trans">receiptsdir</span>)</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-65">item</span>&nbsp;in&nbsp;<span id="ast-66">receiptlist</span>:<span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans">item</span>.endswith</span>(<span id="ast-71">'.pkg'</span>)</span>:<span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pkgpath</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-78" class="other_trans">receiptsdir</span>,&nbsp;<span id="ast-79">item</span>)</span></span><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pkg_modtime</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">os</span>.stat</span>(<span id="ast-86">pkgpath</span>)</span>.st_mtime</span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-88">(<span id="ast-89" class="other_trans">packagedb_modtime</span><span id="ast-90" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-91">pkg_modtime</span>)</span>:<span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-93">True</span></span></span></span></span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98">os</span>.path</span>.exists</span>(<span id="ast-99" class="other_trans">bomsdir</span>)</span>:<span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bomsdir_modtime</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans">os</span>.stat</span>(<span id="ast-106">bomsdir</span>)</span>.st_mtime</span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-108">(<span id="ast-109" class="other_trans">packagedb_modtime</span><span id="ast-110" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-111">bomsdir_modtime</span>)</span>:<span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-113">True</span></span></span><span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bomlist</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans">os</span>.listdir</span>(<span id="ast-119">bomsdir</span>)</span></span><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-121" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-122">bomlist</span>:<span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans">item</span>.endswith</span>(<span id="ast-127">'.bom'</span>)</span>:<span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bompath</span>&nbsp;=&nbsp;<span id="ast-130"><span id="ast-131"><span id="ast-132"><span id="ast-133">os</span>.path</span>.join</span>(<span id="ast-134" class="other_trans">bomsdir</span>,&nbsp;<span id="ast-135" class="other_trans">item</span>)</span></span><span id="ast-136"><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bom_modtime</span>&nbsp;=&nbsp;<span id="ast-138"><span id="ast-139"><span id="ast-140"><span id="ast-141">os</span>.stat</span>(<span id="ast-142">bompath</span>)</span>.st_mtime</span></span><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-144">(<span id="ast-145" class="other_trans">packagedb_modtime</span><span id="ast-146" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-147">bom_modtime</span>)</span>:<span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-149">True</span></span></span></span></span></span><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-151"><span id="ast-152"><span id="ast-153"><span id="ast-154">os</span>.path</span>.exists</span>(<span id="ast-155" class="other_trans">sl_receiptsdir</span>)</span>:<span id="ast-156"><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>receiptsdir_modtime</span>&nbsp;=&nbsp;<span id="ast-158"><span id="ast-159"><span id="ast-160"><span id="ast-161" class="other_trans">os</span>.stat</span>(<span id="ast-162">sl_receiptsdir</span>)</span>.st_mtime</span></span><span id="ast-163"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-164">(<span id="ast-165">packagedb_modtime</span><span id="ast-166" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-167" class="other_trans">receiptsdir_modtime</span>)</span>:<span id="ast-168"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-169">True</span></span></span><span id="ast-170"><span id="ast-171" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>receiptlist</span>&nbsp;=&nbsp;<span id="ast-172"><span id="ast-173"><span id="ast-174">os</span>.listdir</span>(<span id="ast-175">sl_receiptsdir</span>)</span></span><span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-177" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-178">receiptlist</span>:<span id="ast-179"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-180">(<span id="ast-182"><span id="ast-183"><span id="ast-184" class="other_trans">item</span>.endswith</span>(<span id="ast-185">'.bom'</span>)</span>&nbsp;or&nbsp;<span id="ast-186"><span id="ast-187"><span id="ast-188">item</span>.endswith</span>(<span id="ast-189">'.plist'</span>)</span>)</span>:<span id="ast-190"><span id="ast-191"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pkgpath</span>&nbsp;=&nbsp;<span id="ast-192"><span id="ast-193"><span id="ast-194"><span id="ast-195">os</span>.path</span>.join</span>(<span id="ast-196" class="ref_node">receiptsdir&nbsp;&rarr;&nbsp;sl_receiptsdir&nbsp;</span>,&nbsp;<span id="ast-197">item</span>)</span></span><span id="ast-198"><span id="ast-199"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pkg_modtime</span>&nbsp;=&nbsp;<span id="ast-200"><span id="ast-201"><span id="ast-202"><span id="ast-203">os</span>.stat</span>(<span id="ast-204">pkgpath</span>)</span>.st_mtime</span></span><span id="ast-205"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-206">(<span id="ast-207" class="other_trans">packagedb_modtime</span><span id="ast-208" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-209">pkg_modtime</span>)</span>:<span id="ast-210"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-211">True</span></span></span></span></span></span><span id="ast-212"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-213"><span id="ast-214"><span id="ast-215"><span id="ast-216">os</span>.path</span>.exists</span>(<span id="ast-217">installhistory</span>)</span>:<span id="ast-218"><span id="ast-219" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>installhistory_modtime</span>&nbsp;=&nbsp;<span id="ast-220"><span id="ast-221"><span id="ast-222"><span id="ast-223">os</span>.stat</span>(<span id="ast-224">installhistory</span>)</span>.st_mtime</span></span><span id="ast-225"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-226">(<span id="ast-227">packagedb_modtime</span><span id="ast-228" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-229">installhistory_modtime</span>)</span>:<span id="ast-230"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-231">True</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">options</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>time_start</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">time</span>.time</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">options</span>.psk_file</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-13"><span id="ast-14">options</span>.bridge</span>,&nbsp;<span id="ast-15">'PSK&nbsp;is&nbsp;only&nbsp;supported&nbsp;with&nbsp;bridging&nbsp;due&nbsp;to&nbsp;python&nbsp;limitations,&nbsp;sorry&nbsp;about&nbsp;that'</span></span><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>auth_pairs</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21">options</span>.psk_file</span>.readlines</span>()</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-23">(<span id="ast-24">(<span id="ast-25"><span id="ast-26">options</span>.thread_ratio</span>&nbsp;*&nbsp;<span id="ast-28"><span id="ast-29">options</span>.processes</span>)</span><span id="ast-30" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-31"><span id="ast-32">len</span>(<span id="ast-33" class="other_trans">auth_pairs</span>)</span>)</span>,&nbsp;<span id="ast-34">"can't&nbsp;handle&nbsp;more&nbsp;threads*procs&nbsp;than&nbsp;keys!"</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>options</span>.processes</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39">min</span>(<span id="ast-40"><span id="ast-41" class="other_trans">options</span>.processes</span>,&nbsp;<span id="ast-42"><span id="ast-43">len</span>(<span id="ast-44" class="other_trans">auth_pairs</span>)</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-46">(<span id="ast-47">'Using&nbsp;first&nbsp;%d&nbsp;keys&nbsp;from:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-49">(<span id="ast-50"><span id="ast-51">options</span>.processes</span>,&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">options</span>.psk_file</span>.name</span>)</span>)</span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pool</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59">multiprocessing</span>.Pool</span>(processes=<span id="ast-61"><span id="ast-62">options</span>.processes</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65"><span id="ast-66" class="other_trans">options</span>.thread_ratio</span><span id="ast-67" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-68">1</span>)</span>:<span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>auth_pairs</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72">auth_pairs</span>[<span id="ast-73">:<span id="ast-74"><span id="ast-75">options</span>.processes</span></span>]</span></span><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result_set</span>&nbsp;=&nbsp;<span id="ast-78">[<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans">pool</span>.apply_async</span>(<span id="ast-82" class="other_trans">_worker</span>,&nbsp;<span id="ast-83">(<span id="ast-84" class="other_trans">options</span>,&nbsp;<span id="ast-85">x</span>,&nbsp;<span id="ast-86"><span id="ast-87"><span id="ast-88">auth</span>.strip</span>()</span>)</span>)</span><span id="ast-89">&nbsp;for&nbsp;<span id="ast-90">(<span id="ast-91" class="other_trans">x</span>,&nbsp;<span id="ast-92">auth</span>)</span>&nbsp;in&nbsp;<span id="ast-93"><span id="ast-94">enumerate</span>(<span id="ast-95" class="other_trans">auth_pairs</span>)</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result_set</span>&nbsp;=&nbsp;<span id="ast-98">[]</span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-100">x</span>&nbsp;in&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">range</span>(<span id="ast-103"><span id="ast-104" class="other_trans">options</span>.processes</span>)</span>:<span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ll</span>&nbsp;=&nbsp;<span id="ast-107"><span id="ast-108" class="other_trans">options</span>.thread_ratio</span></span><span id="ast-109"><span id="ast-110" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>keyset</span>&nbsp;=&nbsp;<span id="ast-111"><span id="ast-112">auth_pairs</span>[<span id="ast-113"><span id="ast-114">(<span id="ast-115" class="other_trans">x</span>&nbsp;*&nbsp;<span id="ast-117" class="other_trans">ll</span>)</span>:<span id="ast-118">(<span id="ast-119">(<span id="ast-120">x</span>&nbsp;*&nbsp;<span id="ast-122" class="other_trans">ll</span>)</span>&nbsp;+&nbsp;<span id="ast-124"><span id="ast-125" class="other_trans">options</span>.thread_ratio</span>)</span></span>]</span></span><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-127">(<span id="ast-128">'process&nbsp;number:&nbsp;%d&nbsp;using&nbsp;keyset:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-130">(<span id="ast-131">x</span>,&nbsp;<span id="ast-132" class="other_trans">keyset</span>)</span>)</span></span><span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result_set</span>.append</span>(<span id="ast-137"><span id="ast-138"><span id="ast-139" class="other_trans">pool</span>.apply_async</span>(<span id="ast-140">_worker_threaded</span>,&nbsp;<span id="ast-141">(<span id="ast-142" class="other_trans">options</span>,&nbsp;<span id="ast-143">x</span>,&nbsp;<span id="ast-144" class="other_trans">keyset</span>)</span>)</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-145"><span id="ast-146" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pool</span>&nbsp;=&nbsp;<span id="ast-147"><span id="ast-148"><span id="ast-149">multiprocessing</span>.Pool</span>(processes=<span id="ast-151"><span id="ast-152" class="other_trans">options</span>.processes</span>)</span></span><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-154">(<span id="ast-155"><span id="ast-156" class="other_trans">options</span>.thread_ratio</span><span id="ast-157" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-158">1</span>)</span>:<span id="ast-159"><span id="ast-160"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result_set</span>&nbsp;=&nbsp;<span id="ast-161">[<span id="ast-162"><span id="ast-163"><span id="ast-164" class="other_trans">pool</span>.apply_async</span>(<span id="ast-165" class="other_trans">_worker</span>,&nbsp;<span id="ast-166">(<span id="ast-167">options</span>,&nbsp;<span id="ast-168">x</span>)</span>)</span><span id="ast-169">&nbsp;for&nbsp;<span id="ast-170">x</span>&nbsp;in&nbsp;<span id="ast-171"><span id="ast-172">range</span>(<span id="ast-173"><span id="ast-174">options</span>.processes</span>)</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-175"><span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result_set</span>&nbsp;=&nbsp;<span id="ast-177">[<span id="ast-178"><span id="ast-179"><span id="ast-180" class="other_trans">pool</span>.apply_async</span>(<span id="ast-181">_worker_threaded</span>,&nbsp;<span id="ast-182">(<span id="ast-183" class="other_trans">options</span>,&nbsp;<span id="ast-184" class="other_trans">x</span>)</span>)</span><span id="ast-185">&nbsp;for&nbsp;<span id="ast-186">x</span>&nbsp;in&nbsp;<span id="ast-187"><span id="ast-188">range</span>(<span id="ast-189"><span id="ast-190" class="other_trans">options</span>.processes</span>)</span></span>]</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;star_fn(<span id="ast-2"><span id="ast-3" class="other_trans">srs</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>a</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">srs</span>.pop</span>()</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>b</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">srs</span>.pop</span>()</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-17">(<span id="ast-18"><span id="ast-19">type</span>(<span id="ast-20" class="other_trans">a</span>)</span><span id="ast-21" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-22">ListType</span>)</span>&nbsp;and&nbsp;<span id="ast-23">(<span id="ast-24"><span id="ast-25">type</span>(<span id="ast-26" class="ref_node">a&nbsp;&rarr;&nbsp;b&nbsp;</span>)</span><span id="ast-27" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-28" class="other_trans">ListType</span>)</span>)</span>:<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>srs</span>.push</span>(<span id="ast-33"><span id="ast-34">map</span>(<span id="ast-35">lambda&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">x</span></span>:&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">x</span>&nbsp;*&nbsp;<span id="ast-41" class="other_trans">b</span>)</span></span>,&nbsp;<span id="ast-42">a</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-44">(<span id="ast-46">(<span id="ast-47"><span id="ast-48">type</span>(<span id="ast-49" class="other_trans">b</span>)</span><span id="ast-50" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-51" class="other_trans">ListType</span>)</span>&nbsp;and&nbsp;<span id="ast-52">(<span id="ast-53"><span id="ast-54" class="other_trans">type</span>(<span id="ast-55">a</span>)</span><span id="ast-56" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-57">ListType</span>)</span>)</span>:<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>srs</span>.push</span>(<span id="ast-62"><span id="ast-63">map</span>(<span id="ast-64">lambda&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">x</span></span>:&nbsp;<span id="ast-67">(<span id="ast-68">x</span>&nbsp;*&nbsp;<span id="ast-70">a</span>)</span></span>,&nbsp;<span id="ast-71" class="other_trans">b</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75" class="other_trans">type</span>(<span id="ast-76">a</span>)</span><span id="ast-77" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-79"><span id="ast-80" class="other_trans">type</span>(<span id="ast-81">b</span>)</span><span id="ast-78" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-82">ListType</span>)</span>:<span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85"><span id="ast-86" class="other_trans">len</span>(<span id="ast-87" class="other_trans">b</span>)</span><span id="ast-88" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-89"><span id="ast-90" class="other_trans">len</span>(<span id="ast-91">a</span>)</span>)</span>:<span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-94" class="other_trans">a</span>,&nbsp;<span id="ast-95">b</span>)</span>&nbsp;=&nbsp;<span id="ast-96">(<span id="ast-97" class="other_trans">b</span>,&nbsp;<span id="ast-98" class="other_trans">a</span>)</span></span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-100">(<span id="ast-101"><span id="ast-102">len</span>(<span id="ast-103" class="other_trans">b</span>)</span><span id="ast-104" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-105"><span id="ast-106" class="other_trans">len</span>(<span id="ast-107" class="other_trans">a</span>)</span>)</span>:<span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>b</span>.append</span>(<span id="ast-112">0</span>)</span></span></span><span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>srs</span>.push</span>(<span id="ast-117"><span id="ast-118" class="other_trans">sum</span>(<span id="ast-119">[<span id="ast-120"><span id="ast-121" class="other_trans">prod</span>(<span id="ast-122" class="other_trans">x</span>)</span><span id="ast-123">&nbsp;for&nbsp;<span id="ast-124" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-125"><span id="ast-126" class="other_trans">zip</span>(<span id="ast-127">a</span>,&nbsp;<span id="ast-128" class="other_trans">b</span>)</span></span>]</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-129"><span id="ast-130"><span id="ast-131"><span id="ast-132" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>srs</span>.push</span>(<span id="ast-133">(<span id="ast-134">a</span>&nbsp;*&nbsp;<span id="ast-136">b</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">num_epochs</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dataset</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">load_data</span>()</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_layer</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">build_model</span>(input_width=<span id="ast-14"><span id="ast-15" class="other_trans">dataset</span>[<span id="ast-16"><span id="ast-17">'input_width'</span></span>]</span>,&nbsp;input_height=<span id="ast-19"><span id="ast-20" class="other_trans">dataset</span>[<span id="ast-21"><span id="ast-22">'input_width'</span></span>]</span>,&nbsp;output_dim=<span id="ast-24"><span id="ast-25" class="other_trans">dataset</span>[<span id="ast-26"><span id="ast-27">'output_dim'</span></span>]</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iter_funcs</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">create_iter_functions</span>(<span id="ast-32" class="other_trans">dataset</span>,&nbsp;<span id="ast-33" class="other_trans">output_layer</span>,&nbsp;X_tensor_type=<span id="ast-35"><span id="ast-36" class="other_trans">T</span>.tensor4</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-38">'Starting&nbsp;training...'</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-40" class="other_trans">epoch</span>&nbsp;in&nbsp;<span id="ast-41"><span id="ast-42">train</span>(<span id="ast-43" class="other_trans">iter_funcs</span>,&nbsp;<span id="ast-44" class="other_trans">dataset</span>)</span>:<span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-46">(<span id="ast-47">'Epoch&nbsp;%d&nbsp;of&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-49">(<span id="ast-50"><span id="ast-51" class="other_trans">epoch</span>[<span id="ast-52"><span id="ast-53">'number'</span></span>]</span>,&nbsp;<span id="ast-54" class="other_trans">num_epochs</span>)</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-56">(<span id="ast-57">'&nbsp;&nbsp;training&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">epoch</span>[<span id="ast-61"><span id="ast-62">'train_loss'</span></span>]</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-64">(<span id="ast-65">'&nbsp;&nbsp;validation&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">epoch</span>[<span id="ast-69"><span id="ast-70">'valid_loss'</span></span>]</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-72">(<span id="ast-73">'&nbsp;&nbsp;validation&nbsp;accuracy:\\u0009\\u0009%.2f&nbsp;%%'</span>&nbsp;%&nbsp;<span id="ast-75">(<span id="ast-76"><span id="ast-77" class="other_trans">epoch</span>[<span id="ast-78"><span id="ast-79">'valid_accuracy'</span></span>]</span>&nbsp;*&nbsp;<span id="ast-81">100</span>)</span>)</span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-83">(<span id="ast-84"><span id="ast-85" class="other_trans">epoch</span>[<span id="ast-86"><span id="ast-87">'number'</span></span>]</span><span id="ast-88" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-89" class="other_trans">num_epochs</span>)</span>:<span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_update_task_on_answer(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">task</span>,&nbsp;<span id="ast-5" class="other_trans">answer</span>,&nbsp;<span id="ast-6" class="other_trans">user</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Sets&nbsp;flag&nbsp;'closed'&nbsp;to&nbsp;True&nbsp;if&nbsp;task's&nbsp;goal&nbsp;has&nbsp;been&nbsp;reached\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;task:&nbsp;an&nbsp;instance&nbsp;of&nbsp;self.task_model&nbsp;model\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;task:&nbsp;AbstractTask\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;answer:&nbsp;Task&nbsp;solving&nbsp;result\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;answer:&nbsp;AbstractAnswer\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;user:&nbsp;an&nbsp;instance&nbsp;of&nbsp;User&nbsp;model&nbsp;who&nbsp;provided&nbsp;an&nbsp;answer\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;user:&nbsp;models.User\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>.users_count</span>&nbsp;+=&nbsp;<span id="ast-13">1</span></span><span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>.users_processed</span>.append</span>(<span id="ast-19" class="other_trans">user</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>._is_ready_for_autoclose</span>(<span id="ast-24" class="other_trans">task</span>,&nbsp;<span id="ast-25" class="other_trans">answer</span>)</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>.closed</span>&nbsp;=&nbsp;<span id="ast-29">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>.closed</span>&nbsp;=&nbsp;<span id="ast-33">(<span id="ast-34"><span id="ast-35" class="other_trans">task</span>.users_count</span><span id="ast-36" class="location_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-37"><span id="ast-38">self</span>.redundancy</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;download_all(<span id="ast-2"><span id="ast-3" class="other_trans">username</span>,&nbsp;<span id="ast-4" class="other_trans">password</span>,&nbsp;<span id="ast-5" class="other_trans">download_dir</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>connection</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">snapchat</span>.Snapchat</span>(<span id="ast-11" class="other_trans">username</span>,&nbsp;<span id="ast-12" class="other_trans">password</span>)</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>connection</span>.connect</span>()</span></span><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>downloadable</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20">filter</span>(<span id="ast-21">lambda&nbsp;<span id="ast-22"><span id="ast-23">snap</span></span>:&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">snap</span>.viewable</span></span>,&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">connection</span>.snaps</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29" class="other_trans">snap</span>&nbsp;in&nbsp;<span id="ast-30" class="other_trans">downloadable</span>:<span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="correct_node">connection&nbsp;&rarr;&nbsp;snap&nbsp;</span>.download</span>()</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-38"><span id="ast-39">open</span>(<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">path</span>.join</span>(<span id="ast-43" class="other_trans">download_dir</span>,&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">snap</span>.id</span>)</span>,&nbsp;<span id="ast-46">'w'</span>)</span>&nbsp;as&nbsp;<span id="ast-47" class="other_trans">f</span>:<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-52" class="other_trans">data</span>)</span></span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-54">(<span id="ast-55">'Downloaded&nbsp;snap&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">snap</span>.id</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-60" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-61" class="other_trans">e</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-63">(<span id="ast-64">'Failed&nbsp;to&nbsp;download&nbsp;%s:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-66">(<span id="ast-67"><span id="ast-68" class="other_trans">snap</span>.id</span>,&nbsp;<span id="ast-69" class="other_trans">e</span>)</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;echo(<span id="ast-2"><span id="ast-3" class="other_trans">data</span>,&nbsp;<span id="ast-4" class="other_trans">encoding</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-9">(<span id="ast-10" class="other_trans">data</span><span id="ast-11" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-12" class="other_trans">None</span>)</span>&nbsp;or&nbsp;<span id="ast-13">(<span id="ast-14">0</span><span id="ast-15" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-16"><span id="ast-17">len</span>(<span id="ast-18" class="other_trans">data</span>)</span>)</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>.warn</span>(<span id="ast-23">(<span id="ast-24">'terminal&nbsp;capability&nbsp;not&nbsp;translated:&nbsp;%s%r'</span>&nbsp;%&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-32" class="other_trans">encoding</span>&nbsp;if&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">encoding</span><span id="ast-30" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-31" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-33">''</span></span>,&nbsp;<span id="ast-34" class="other_trans">data</span>)</span>)</span>,&nbsp;<span id="ast-35" class="other_trans">Warning</span>,&nbsp;<span id="ast-36">2</span>)</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40">type</span>(<span id="ast-41" class="other_trans">data</span>)</span><span id="ast-42" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-43">bytes</span>)</span>:<span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>.warn</span>(<span id="ast-48">(<span id="ast-49">'non-unicode:&nbsp;%s%r'</span>&nbsp;%&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-57" class="other_trans">encoding</span>&nbsp;if&nbsp;<span id="ast-53">(<span id="ast-54" class="other_trans">encoding</span><span id="ast-55" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-56" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-58">''</span></span>,&nbsp;<span id="ast-59" class="other_trans">data</span>)</span>)</span>,&nbsp;<span id="ast-60" class="other_trans">UnicodeWarning</span>,&nbsp;<span id="ast-61">2</span>)</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">getsession</span>()</span>.write</span>(<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">data</span>.decode</span>(<span id="ast-70"><span id="ast-75" class="other_trans">encoding</span>&nbsp;if&nbsp;<span id="ast-71">(<span id="ast-72" class="other_trans">encoding</span><span id="ast-73" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-74" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-76">'iso8859-1'</span></span>)</span>)</span></span></span><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-78">(<span id="ast-79" class="other_trans">encoding</span><span id="ast-80" class="ref_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-81" class="other_trans">None</span>)</span>,&nbsp;<span id="ast-82">'just&nbsp;send&nbsp;unicode'</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87">getsession</span>()</span>.write</span>(<span id="ast-88" class="other_trans">data</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;open(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Open&nbsp;connection&nbsp;to&nbsp;VXI-11&nbsp;instrument'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>.client</span><span id="ast-10" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>:<span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.client</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">CoreClient</span>(<span id="ast-17" class="correct_node">host&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-20" class="other_trans">error</span>,&nbsp;<span id="ast-21" class="other_trans">link</span>,&nbsp;<span id="ast-22" class="other_trans">abort_port</span>,&nbsp;<span id="ast-23" class="other_trans">max_recv_size</span>)</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27">self</span>.client</span>.create_link</span>(<span id="ast-28"><span id="ast-29">self</span>.client_id</span>,&nbsp;<span id="ast-30">0</span>,&nbsp;<span id="ast-31"><span id="ast-32">self</span>.lock_timeout</span>,&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36">self</span>.name</span>.encode</span>(<span id="ast-37">'utf-8'</span>)</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39" class="other_trans">error</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">Vxi11Error</span>(<span id="ast-43">(<span id="ast-44">'error&nbsp;creating&nbsp;link:&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-46" class="other_trans">error</span>)</span>)</span></span></span><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.link</span>&nbsp;=&nbsp;<span id="ast-50" class="other_trans">link</span></span><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.max_recv_size</span>&nbsp;=&nbsp;<span id="ast-54" class="other_trans">max_recv_size</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">form</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.transport</span>&nbsp;=&nbsp;<span id="ast-8">'udp'</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ptime</span>&nbsp;=&nbsp;<span id="ast-12">20</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.provisioning</span>&nbsp;=&nbsp;<span id="ast-16">False</span></span><span id="ast-17"><span id="ast-18" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>answermode&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-19">'manual'</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-21" class="other_trans">var</span>&nbsp;in&nbsp;<span id="ast-22" class="other_trans">form</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-26">self</span>,&nbsp;<span id="ast-27" class="other_trans">var</span>,&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">form</span>[<span id="ast-30"><span id="ast-31" class="other_trans">var</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;align(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">alignParams</span>,&nbsp;<span id="ast-5" class="other_trans">scope</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.alignParams</span>&nbsp;=&nbsp;<span id="ast-11" class="other_trans">alignParams</span></span><span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-14" class="other_trans">alignProgram</span>,&nbsp;<span id="ast-15" class="other_trans">alignExt</span>,&nbsp;<span id="ast-16" class="other_trans">alignBinary</span>,&nbsp;<span id="ast-17" class="other_trans">binaryParams</span>,&nbsp;<span id="ast-18" class="other_trans">alignRef</span>)</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20">self</span>.alignParams</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scope</span>&nbsp;=&nbsp;<span id="ast-24" class="other_trans">scope</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.resultFn</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>.contig</span>.get_path</span>()</span>,&nbsp;<span id="ast-36">(<span id="ast-37">'%s_res.%s.%s'</span>&nbsp;%&nbsp;<span id="ast-39">(<span id="ast-40" class="other_trans">alignProgram</span>,&nbsp;<span id="ast-41" class="other_trans">scope</span>,&nbsp;<span id="ast-42" class="other_trans">alignExt</span>)</span>)</span>)</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>utils</span>.log</span>(<span id="ast-47"><span id="ast-48">self</span>.loggingName</span>,&nbsp;<span id="ast-49">'info'</span>,&nbsp;<span id="ast-50">(<span id="ast-51">'Running&nbsp;realignment&nbsp;with&nbsp;%s,&nbsp;storing&nbsp;results&nbsp;in&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-53">(<span id="ast-54" class="other_trans">alignProgram</span>,&nbsp;<span id="ast-55" class="correct_node">resultFn&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;apply_shape(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span>,&nbsp;<span id="ast-4" class="other_trans">model_or_dict</span>,&nbsp;<span id="ast-5">field_converter</span>,&nbsp;<span id="ast-6">model_converter</span>,&nbsp;<span id="ast-7" class="other_trans">gottago</span>,&nbsp;<span id="ast-8">allow_none</span></span>):<span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>model_dict</span>&nbsp;=&nbsp;<span id="ast-14">{}</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16" class="other_trans">truple</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18">_reduce_loop</span>(<span id="ast-19">cls</span>,&nbsp;<span id="ast-20" class="other_trans">model_or_dict</span>,&nbsp;<span id="ast-21" class="other_trans">field_converter</span>)</span>:<span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-24" class="other_trans">field_name</span>,&nbsp;<span id="ast-25" class="other_trans">field_instance</span>,&nbsp;<span id="ast-26" class="other_trans">field_value</span>)</span>&nbsp;=&nbsp;<span id="ast-27">truple</span></span><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>serialized_name</span>&nbsp;=&nbsp;<span id="ast-30">field_name</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">field_instance</span>.minimized_field_name</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>serialized_name</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37">field_instance</span>.minimized_field_name</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">field_instance</span>.print_name</span>:<span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>serialized_name</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">field_instance</span>.print_name</span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">gottago</span>(<span id="ast-48" class="other_trans">field_name</span>,&nbsp;<span id="ast-49" class="other_trans">field_value</span>)</span>:<span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">isinstance</span>(<span id="ast-54">field_value</span>,&nbsp;<span id="ast-55">Model</span>)</span>:<span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>model_dict</span>[<span id="ast-59"><span id="ast-60" class="other_trans">serialized_name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">model_converter</span>(<span id="ast-63" class="other_trans">field_value</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-65">(<span id="ast-67"><span id="ast-68">isinstance</span>(<span id="ast-69" class="ref_node">field_name&nbsp;&rarr;&nbsp;field_value&nbsp;</span>,&nbsp;<span id="ast-70" class="other_trans">list</span>)</span>&nbsp;and&nbsp;<span id="ast-71">(<span id="ast-72"><span id="ast-73">len</span>(<span id="ast-74" class="other_trans">field_value</span>)</span><span id="ast-75" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-76">0</span>)</span>)</span>:<span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-78"><span id="ast-79">isinstance</span>(<span id="ast-80"><span id="ast-81">field_value</span>[<span id="ast-82"><span id="ast-83">0</span></span>]</span>,&nbsp;<span id="ast-84">Model</span>)</span>:<span id="ast-85"><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>model_dict</span>[<span id="ast-88"><span id="ast-89" class="other_trans">serialized_name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-90">[<span id="ast-91"><span id="ast-92" class="other_trans">model_converter</span>(<span id="ast-93" class="other_trans">vi</span>)</span><span id="ast-94">&nbsp;for&nbsp;<span id="ast-95">vi</span>&nbsp;in&nbsp;<span id="ast-96" class="other_trans">field_value</span></span>]</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-98">(<span id="ast-100">(<span id="ast-101" class="other_trans">field_value</span><span id="ast-102" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-103">None</span>)</span>&nbsp;and&nbsp;<span id="ast-104" class="other_trans">allow_none</span>)</span>:<span id="ast-105"><span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>model_dict</span>[<span id="ast-108"><span id="ast-109">serialized_name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-110">None</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-111"><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>model_dict</span>[<span id="ast-114"><span id="ast-115">serialized_name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117">field_converter</span>(<span id="ast-118">field_instance</span>,&nbsp;<span id="ast-119" class="other_trans">field_value</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process_ep(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">ep</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">ep</span>.id</span>,&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">ep</span>.name</span></span><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>loc</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">ep</span>.location</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>show</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">loc</span>.show</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>client</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">show</span>.client</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23" class="other_trans">cut</span>&nbsp;in&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29">Cut_List</span>.objects</span>.filter</span>(episode=<span id="ast-31" class="other_trans">ep</span>)</span>.order_by</span>(<span id="ast-32">'sequence'</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>basename</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">cut</span>.raw_file</span>.basename</span>()</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>thumb</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44">os</span>.path</span>.join</span>(<span id="ast-45"><span id="ast-46">self</span>.episode_dir</span>,&nbsp;<span id="ast-47">(<span id="ast-48">'%s.png'</span>&nbsp;%&nbsp;<span id="ast-50" class="other_trans">basename</span>)</span>)</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55">os</span>.path</span>.exists</span>(<span id="ast-56" class="other_trans">thumb</span>)</span>:<span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>oggpathname</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-64"><span id="ast-65">self</span>.show_dir</span>,&nbsp;<span id="ast-66">'ogg'</span>,&nbsp;<span id="ast-67">(<span id="ast-68">'%s.ogg'</span>&nbsp;%&nbsp;<span id="ast-70"><span id="ast-71" class="other_trans">ep</span>.slug</span>)</span>)</span></span><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>description</span>&nbsp;=&nbsp;<span id="ast-74">(<span id="ast-75">'%s&lt;/br&gt;\\u000a&lt;/br&gt;\\u000a%s'</span>&nbsp;%&nbsp;<span id="ast-77">(<span id="ast-78"><span id="ast-79" class="other_trans">ep</span>.description</span>,&nbsp;<span id="ast-80"><span id="ast-81" class="other_trans">client</span>.description</span>)</span>)</span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-83" class="other_trans">description</span></span><span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>blip_cli</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans">blip_uploader</span>.Blip_CLI</span>()</span></span><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>meta</span>&nbsp;=&nbsp;<span id="ast-91">{<span id="ast-92">'title'</span>:&nbsp;<span id="ast-94"><span id="ast-95" class="other_trans">ep</span>.name</span>,&nbsp;<span id="ast-93">'description'</span>:&nbsp;<span id="ast-96">description</span>}</span></span><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;need&nbsp;to&nbsp;make&nbsp;a&nbsp;place&nbsp;for&nbsp;this&nbsp;stuff&nbsp;in&nbsp;the&nbsp;database.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"topics":&nbsp;"%s,&nbsp;python,&nbsp;"%(client.name),\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"license":&nbsp;"13",\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"categories_id":&nbsp;"10",\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-100"><span id="ast-101"><span id="ast-102">self</span>.options</span>.topics</span>:<span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>meta</span>[<span id="ast-106"><span id="ast-107">'topics'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110">self</span>.options</span>.topics</span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112"><span id="ast-113"><span id="ast-114">self</span>.options</span>.license</span>:<span id="ast-115"><span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>meta</span>[<span id="ast-118"><span id="ast-119">'license'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-120"><span id="ast-121"><span id="ast-122">self</span>.options</span>.license</span></span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124"><span id="ast-125" class="correct_node">options&nbsp;&rarr;&nbsp;self.&nbsp;</span>.category</span>:<span id="ast-126"><span id="ast-127"><span id="ast-128" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>meta</span>[<span id="ast-129"><span id="ast-130">'categorie_id'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-131"><span id="ast-132"><span id="ast-133">self</span>.options</span>.category</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;filter_evidence(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">_</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Pseudocode.&nbsp;Stage&nbsp;2.2&nbsp;of&nbsp;pipeline.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;sorted_evidence&nbsp;is&nbsp;[(score,&nbsp;segment,&nbsp;(a,&nbsp;b,&nbsp;relation)),&nbsp;...]\\u000a&nbsp;&nbsp;&nbsp;&nbsp;answers&nbsp;is&nbsp;{(segment,&nbsp;(a,&nbsp;b,&nbsp;relation)):&nbsp;is_evidence,&nbsp;...}\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>evidence</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">Knowledge</span>(<span id="ast-11"><span id="ast-12">self</span>.answers</span>)</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>evidence</span>.update</span>(<span id="ast-17">(<span id="ast-18">(<span id="ast-19" class="other_trans">e</span>,&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">score</span><span id="ast-22" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-23">0.5</span>)</span>)</span><span id="ast-24">&nbsp;for&nbsp;<span id="ast-25">(<span id="ast-26" class="other_trans">e</span>,&nbsp;<span id="ast-27" class="other_trans">score</span>)</span>&nbsp;in&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31">self</span>.questions</span>.items</span>()</span>&nbsp;if&nbsp;<span id="ast-32">(<span id="ast-34">(<span id="ast-35"><span id="ast-36" class="other_trans">certainty</span>(<span id="ast-37" class="other_trans">score</span>)</span><span id="ast-38" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-39"><span id="ast-40">self</span>.evidence_threshold</span>)</span>&nbsp;and&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">e</span><span id="ast-43">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-44"><span id="ast-45">self</span>.answers</span>)</span>)</span></span>)</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-47" class="other_trans">evidence</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;start(<span id="ast-2"><span id="ast-3">binary_dir</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>jobs</span>&nbsp;=&nbsp;<span id="ast-6">[]</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>binaries</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">os</span>.listdir</span>(<span id="ast-12" class="other_trans">binary_dir</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-14" class="other_trans">binary</span>&nbsp;in&nbsp;<span id="ast-15">binaries</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">binary</span>.startswith</span>(<span id="ast-20">'.'</span>)</span>:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pathed_binary</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27">os</span>.path</span>.join</span>(<span id="ast-28" class="other_trans">binary_dir</span>,&nbsp;<span id="ast-29" class="other_trans">binary</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34">os</span>.path</span>.isdir</span>(<span id="ast-35" class="other_trans">pathed_binary</span>)</span>:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39">not</span>&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42">os</span>.access</span>(<span id="ast-43">pathed_binary</span>,&nbsp;<span id="ast-44"><span id="ast-45">os</span>.X_OK</span>)</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>identifier</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">binary</span>[<span id="ast-51">:<span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">binary</span>.rindex</span>(<span id="ast-55">'_'</span>)</span></span>]</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57">(<span id="ast-58">(<span id="ast-59" class="other_trans">identifier</span>&nbsp;+&nbsp;<span id="ast-61">'_02'</span>)</span><span id="ast-62">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-63" class="other_trans">binaries</span>)</span>:<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jobs</span>.append</span>(<span id="ast-68">binary</span>)</span></span></span></span><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.info</span>(<span id="ast-73">'%d&nbsp;binaries&nbsp;found'</span>,&nbsp;<span id="ast-74"><span id="ast-75">len</span>(<span id="ast-76" class="other_trans">jobs</span>)</span>)</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.debug</span>(<span id="ast-81">'binaries:&nbsp;%r'</span>,&nbsp;<span id="ast-82" class="other_trans">jobs</span>)</span></span><span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.info</span>(<span id="ast-87">'%d&nbsp;binaries&nbsp;found'</span>,&nbsp;<span id="ast-88"><span id="ast-89">len</span>(<span id="ast-90" class="other_trans">jobs</span>)</span>)</span></span><span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filter_t</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94">set</span>()</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pwned</span>&nbsp;=&nbsp;<span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101">open</span>(<span id="ast-102">'pwned'</span>)</span>.read</span>()</span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-104" class="other_trans">pwn</span>&nbsp;in&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108" class="other_trans">pwned</span>.split</span>(<span id="ast-109">'\\u000a'</span>)</span>[<span id="ast-110">:<span id="ast-111">-1</span></span>]</span>:<span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filter_t</span>.add</span>(<span id="ast-116" class="other_trans">pwn</span>)</span></span></span><span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.info</span>(<span id="ast-121">'already&nbsp;pwned&nbsp;%d'</span>,&nbsp;<span id="ast-122"><span id="ast-123">len</span>(<span id="ast-124" class="other_trans">filter_t</span>)</span>)</span></span><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-126">IOError</span>:<span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>jobs</span>&nbsp;=&nbsp;<span id="ast-130"><span id="ast-131" class="other_trans">filter</span>(<span id="ast-132">lambda&nbsp;<span id="ast-133"><span id="ast-134" class="other_trans">j</span></span>:&nbsp;<span id="ast-135">(<span id="ast-136" class="other_trans">j</span><span id="ast-137">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-138" class="correct_node">pwned&nbsp;&rarr;&nbsp;filter_t&nbsp;</span>)</span></span>,&nbsp;<span id="ast-139" class="other_trans">jobs</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">rrd_file</span>,&nbsp;<span id="ast-5" class="other_trans">name</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.rrd_file</span>&nbsp;=&nbsp;<span id="ast-9" class="other_trans">rrd_file</span></span><span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.name</span>&nbsp;=&nbsp;<span id="ast-13" class="other_trans">name</span></span><span id="ast-14"><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fs_path</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">rrd_file</span>.fs_path</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.metric_path</span>&nbsp;=&nbsp;<span id="ast-22">(<span id="ast-23">(<span id="ast-24"><span id="ast-25" class="other_trans">rrd_file</span>.metric_path</span>&nbsp;+&nbsp;<span id="ast-27">'.'</span>)</span>&nbsp;+&nbsp;<span id="ast-29" class="other_trans">name</span>)</span></span><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.real_metric</span>&nbsp;=&nbsp;<span id="ast-33" class="correct_node">metric_path&nbsp;&rarr;&nbsp;self.&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;poll(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7"><span id="ast-8">self</span>._started</span>)</span>:<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">APIUsageException</span>(<span id="ast-12">'You&nbsp;must&nbsp;first&nbsp;start&nbsp;the&nbsp;pollable&nbsp;object'</span>)</span></span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15">'CLOUDINITD_TESTENV'</span><span id="ast-16">&nbsp;in&nbsp;</span><span id="ast-17"><span id="ast-18" class="other_trans">os</span>.environ</span>)</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-20">True</span></span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>now</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">datetime</span>.datetime</span>.now</span>()</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28"><span id="ast-29">self</span>._last_run</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32">(<span id="ast-33" class="other_trans">now</span>&nbsp;-&nbsp;<span id="ast-35"><span id="ast-36">self</span>._last_run</span>)</span><span id="ast-37" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-38"><span id="ast-39">self</span>._time_delay</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41">False</span></span></span></span><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._last_run</span>&nbsp;=&nbsp;<span id="ast-45" class="other_trans">now</span></span></span></span></span><br /><br /><hr />
</body></html>
