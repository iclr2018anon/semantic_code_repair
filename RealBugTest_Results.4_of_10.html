<html><head><style>
.ast { font-family: monospace; font-size: 12pt; }
.correct_node { font-weight: bold; background-color: green; color: white; }
.incorrect_node { font-weight: bold; background-color: red; color: white; }
.ref_node { font-weight: bold; background-color: blue; color: white; }
.location_node { font-weight: bold; background-color: #ff00ff; color: white; }
.other_trans { color: #3333ff; }
.whitespace { background-color: white; color: black; }
.pred_rank_wrapper { font-weight: bold; }
.correct_pred_rank { font-weight: bold; color: green;}
.incorrect_pred_rank { font-weight: bold; color: red; }
.rank_type { font-weight: bold; }
.description { font-size: 16pt; }
</style></head><body><div class="description">
<div><b>This is part 5/10 of the system predictions for the Real-Bug Test set. This system achieves 41% Repair Accuracy and 54% Location Accuracy.</b></div><br /><div><b>Annotations</b>:</div><ul><li><span class="correct_node">foo &rarr; bar</span> - The bug was located at this node, and the system <i>correctly</i> predicted both the location and the repair as its top prediction.</li><li><span class="incorrect_node">foo &rarr; bar</span> - The system <i>incorrectly</i> predicted this repair as its top prediction.</li><li><span class="ref_node">foo &rarr; bar</span> - If the system incorrectly predicted the repair, this was the correct repair it should have made.</li><li><span class="location_node">foo &rarr; bar, pred: zap</span> - The system predicted the correct <i>location</i> of the repair, but the wrong repair label. It should have predicted 'bar', but it predicted 'zap' instead.</li></ul><div>The part before the arrow ('foo') is what the system actually saw at test time. Other candidate repair locations which the system could have chosen are marked in <span class="other_trans">this color</span>. For clarity the actual labels for those locations are not shown.</div></div><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;update_job(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">user</span>,&nbsp;<span id="ast-5" class="other_trans">job</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>job_id</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">job</span>[<span id="ast-10"><span id="ast-11">'_id'</span></span>]</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_job</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.load</span>(<span id="ast-17" class="other_trans">job_id</span>,&nbsp;user=<span id="ast-19" class="other_trans">user</span>,&nbsp;level=<span id="ast-21"><span id="ast-22" class="other_trans">AccessType</span>.WRITE</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_status</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26" class="other_trans">job</span>[<span id="ast-27"><span id="ast-28">'status'</span></span>]</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32" class="other_trans">current_job</span>[<span id="ast-33"><span id="ast-34">'status'</span></span>]</span><span id="ast-35" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-36" class="other_trans">new_status</span>)</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>send_status_notification&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-40">'job'</span>,&nbsp;<span id="ast-41" class="ref_node">current_job&nbsp;&rarr;&nbsp;job&nbsp;</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;convert(<span id="ast-2"><span id="ast-3" class="other_trans">buildingsFile</span>,&nbsp;<span id="ast-4" class="other_trans">osmOut</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">open</span>(<span id="ast-8" class="other_trans">buildingsFile</span>)</span>&nbsp;as&nbsp;<span id="ast-9" class="other_trans">f</span>:<span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>buildings</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">json</span>.load</span>(<span id="ast-15" class="other_trans">f</span>)</span></span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>buildingShapes</span>&nbsp;=&nbsp;<span id="ast-18">[]</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>buildingIdx</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans">index</span>.Index</span>()</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-25" class="other_trans">building</span>&nbsp;in&nbsp;<span id="ast-26" class="other_trans">buildings</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>shape</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">asShape</span>(<span id="ast-31"><span id="ast-32" class="other_trans">building</span>[<span id="ast-33"><span id="ast-34">'geometry'</span></span>]</span>)</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>buildingShapes</span>.append</span>(<span id="ast-39" class="other_trans">shape</span>)</span></span><span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>buildingIdx</span>.add</span>(<span id="ast-44">(<span id="ast-45"><span id="ast-46" class="other_trans">len</span>(<span id="ast-47" class="location_node">buildings&nbsp;&rarr;&nbsp;buildingShapes,&nbsp;pred:&nbsp;shape&nbsp;</span>)</span>&nbsp;-&nbsp;<span id="ast-49">1</span>)</span>,&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">shape</span>.bounds</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__iter__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.moving_mean_squared</span>&nbsp;=&nbsp;<span id="ast-7">1</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.step_m1</span>&nbsp;=&nbsp;<span id="ast-11">0</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.step_rate</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16">self</span>._steprate</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18"><span id="ast-19">self</span>.step_adapt</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.step_rate</span>&nbsp;*=&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">ones_like</span>(<span id="ast-26"><span id="ast-27">self</span>.wrt</span>)</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">i</span>,&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">args</span>,&nbsp;<span id="ast-33" class="other_trans">kwargs</span>)</span>)</span>&nbsp;in&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">enumerate</span>(<span id="ast-36"><span id="ast-37">self</span>.args</span>)</span>:<span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>step1</span>&nbsp;=&nbsp;<span id="ast-40">(<span id="ast-41"><span id="ast-42">self</span>.step_m1</span>&nbsp;*&nbsp;<span id="ast-44"><span id="ast-45">self</span>.momentum</span>)</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.wrt</span>&nbsp;-=&nbsp;<span id="ast-50" class="other_trans">step1</span></span><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>gradient</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">self</span>.fprime</span>(<span id="ast-56"><span id="ast-57">self</span>.wrt</span>,&nbsp;*<span id="ast-58" class="other_trans">args</span>,&nbsp;**<span id="ast-59" class="other_trans">kwargs</span>)</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.moving_mean_squared</span>&nbsp;=&nbsp;<span id="ast-63">(<span id="ast-64">(<span id="ast-65"><span id="ast-66">self</span>.decay</span>&nbsp;*&nbsp;<span id="ast-68"><span id="ast-69">self</span>.moving_mean_squared</span>)</span>&nbsp;+&nbsp;<span id="ast-71">(<span id="ast-72">(<span id="ast-73">1</span>&nbsp;-&nbsp;<span id="ast-75"><span id="ast-76">self</span>.decay</span>)</span>&nbsp;*&nbsp;<span id="ast-78">(<span id="ast-79" class="other_trans">gradient</span>&nbsp;**&nbsp;<span id="ast-81">2</span>)</span>)</span>)</span></span><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>step2</span>&nbsp;=&nbsp;<span id="ast-84">(<span id="ast-85"><span id="ast-86">self</span>.step_rate</span>&nbsp;*&nbsp;<span id="ast-88" class="other_trans">gradient</span>)</span></span><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>step2</span>&nbsp;/=&nbsp;<span id="ast-92"><span id="ast-93" class="other_trans">sqrt</span>(<span id="ast-94">(<span id="ast-95"><span id="ast-96">self</span>.moving_mean_squared</span>&nbsp;+&nbsp;<span id="ast-98">1e-08</span>)</span>)</span></span><span id="ast-99"><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.wrt</span>&nbsp;-=&nbsp;<span id="ast-103" class="other_trans">step2</span></span><span id="ast-104"><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>step</span>&nbsp;=&nbsp;<span id="ast-106">(<span id="ast-107" class="other_trans">step1</span>&nbsp;+&nbsp;<span id="ast-109" class="other_trans">step2</span>)</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-111"><span id="ast-112">self</span>.step_adapt</span>:<span id="ast-113"><span id="ast-114" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>step_non_negative</span>&nbsp;=&nbsp;<span id="ast-115">(<span id="ast-116" class="other_trans">step</span><span id="ast-117" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-118">0</span>)</span></span><span id="ast-119"><span id="ast-120" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>step_m1_non_negative</span>&nbsp;=&nbsp;<span id="ast-121">(<span id="ast-122" class="ref_node">step_m1&nbsp;&rarr;&nbsp;self.&nbsp;</span><span id="ast-123" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-124">0</span>)</span></span><span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>agree</span>&nbsp;=&nbsp;<span id="ast-127">(<span id="ast-128">(<span id="ast-129" class="other_trans">step_non_negative</span><span id="ast-130" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-131" class="other_trans">step_m1_non_negative</span>)</span>&nbsp;*&nbsp;<span id="ast-133">1.0</span>)</span></span><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>adapt</span>&nbsp;=&nbsp;<span id="ast-136">(<span id="ast-137">(<span id="ast-138">1</span>&nbsp;+&nbsp;<span id="ast-140">(<span id="ast-141">(<span id="ast-142" class="other_trans">agree</span>&nbsp;*&nbsp;<span id="ast-144"><span id="ast-145">self</span>.step_adapt</span>)</span>&nbsp;*&nbsp;<span id="ast-147">2</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-149"><span id="ast-150">self</span>.step_adapt</span>)</span></span><span id="ast-151"><span id="ast-152"><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.step_rate</span>&nbsp;*=&nbsp;<span id="ast-155" class="other_trans">adapt</span></span><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.step_rate</span>&nbsp;=&nbsp;<span id="ast-159"><span id="ast-160" class="other_trans">clip</span>(<span id="ast-161"><span id="ast-162">self</span>.step_rate</span>,&nbsp;<span id="ast-163"><span id="ast-164">self</span>.step_rate_min</span>,&nbsp;<span id="ast-165"><span id="ast-166">self</span>.step_rate_max</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;time_tensorflow_run(<span id="ast-2"><span id="ast-3">session</span>,&nbsp;<span id="ast-4">target</span>,&nbsp;<span id="ast-5" class="other_trans">info_string</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>num_steps_burn_in</span>&nbsp;=&nbsp;<span id="ast-8">10</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>total_duration</span>&nbsp;=&nbsp;<span id="ast-11">0.0</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>total_duration_squared</span>&nbsp;=&nbsp;<span id="ast-14">0.0</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17">not</span>&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">isinstance</span>(<span id="ast-20" class="other_trans">target</span>,&nbsp;<span id="ast-21" class="other_trans">list</span>)</span>)</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>target</span>&nbsp;=&nbsp;<span id="ast-24">[<span id="ast-25" class="other_trans">target</span>]</span></span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>target_op</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30">tf</span>.group</span>(*<span id="ast-31" class="other_trans">target</span>)</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-33" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-34"><span id="ast-35">range</span>(<span id="ast-36">(<span id="ast-37"><span id="ast-38" class="other_trans">FLAGS</span>.num_batches</span>&nbsp;+&nbsp;<span id="ast-40" class="other_trans">num_steps_burn_in</span>)</span>)</span>:<span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start_time</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45">time</span>.time</span>()</span></span><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">session</span>.run</span>(<span id="ast-51">target_op</span>)</span></span><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>duration</span>&nbsp;=&nbsp;<span id="ast-54">(<span id="ast-55"><span id="ast-56"><span id="ast-57">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-59" class="other_trans">start_time</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61">(<span id="ast-62">i</span><span id="ast-63" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-64">num_steps_burn_in</span>)</span>:<span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66">(<span id="ast-67">not</span>&nbsp;<span id="ast-68">(<span id="ast-69">i</span>&nbsp;%&nbsp;<span id="ast-71">10</span>)</span>)</span>:<span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-73">(<span id="ast-74">'%s:&nbsp;step&nbsp;%d,&nbsp;duration&nbsp;=&nbsp;%.3f'</span>&nbsp;%&nbsp;<span id="ast-76">(<span id="ast-77"><span id="ast-78"><span id="ast-79">datetime</span>.now</span>()</span>,&nbsp;<span id="ast-80">(<span id="ast-81" class="other_trans">i</span>&nbsp;-&nbsp;<span id="ast-83" class="other_trans">num_steps_burn_in</span>)</span>,&nbsp;<span id="ast-84" class="other_trans">duration</span>)</span>)</span></span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>total_duration</span>&nbsp;+=&nbsp;<span id="ast-88" class="other_trans">duration</span></span><span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>total_duration_squared</span>&nbsp;+=&nbsp;<span id="ast-92">(<span id="ast-93" class="other_trans">duration</span>&nbsp;*&nbsp;<span id="ast-95" class="other_trans">duration</span>)</span></span></span></span><span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mn</span>&nbsp;=&nbsp;<span id="ast-98">(<span id="ast-99">total_duration</span>&nbsp;/&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">FLAGS</span>.num_batches</span>)</span></span><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>vr</span>&nbsp;=&nbsp;<span id="ast-105">(<span id="ast-106">(<span id="ast-107" class="other_trans">total_duration_squared</span>&nbsp;/&nbsp;<span id="ast-109"><span id="ast-110">FLAGS</span>.num_batches</span>)</span>&nbsp;-&nbsp;<span id="ast-112">(<span id="ast-113" class="other_trans">mn</span>&nbsp;*&nbsp;<span id="ast-115" class="other_trans">mn</span>)</span>)</span></span><span id="ast-116"><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sd</span>&nbsp;=&nbsp;<span id="ast-118"><span id="ast-119"><span id="ast-120">math</span>.sqrt</span>(<span id="ast-121" class="other_trans">vr</span>)</span></span><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-123">(<span id="ast-124">'%s:&nbsp;%s&nbsp;across&nbsp;%d&nbsp;steps,&nbsp;%.3f&nbsp;+/-&nbsp;%.3f&nbsp;sec&nbsp;/&nbsp;batch'</span>&nbsp;%&nbsp;<span id="ast-126">(<span id="ast-127"><span id="ast-128"><span id="ast-129">datetime</span>.now</span>()</span>,&nbsp;<span id="ast-130" class="other_trans">info_string</span>,&nbsp;<span id="ast-131"><span id="ast-132">FLAGS</span>.num_batches</span>,&nbsp;<span id="ast-133" class="other_trans">mn</span>,&nbsp;<span id="ast-134" class="other_trans">sd</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_format_key(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">key</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7">not</span>&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">isinstance</span>(<span id="ast-10" class="other_trans">key</span>,&nbsp;<span id="ast-11" class="other_trans">str</span>)</span>)</span>:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">key</span>.decode</span>(<span id="ast-17">'ascii'</span>)</span></span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>formated_key</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22">(<span id="ast-23">(<span id="ast-24"><span id="ast-25">self</span>.namespace</span>&nbsp;+&nbsp;<span id="ast-27">'_'</span>)</span>&nbsp;+&nbsp;<span id="ast-29" class="other_trans">key</span>)</span>.replace</span>(<span id="ast-30">'&nbsp;'</span>,&nbsp;<span id="ast-31">'\\u00c2\\u00b7'</span>)</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34"><span id="ast-35" class="other_trans">len</span>(<span id="ast-36" class="other_trans">formated_key</span>)</span><span id="ast-37" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-38" class="other_trans">MAX_KEY_LENGTH</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41"><span id="ast-42" class="other_trans">sys</span>.version_info</span><span id="ast-43" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-44">(<span id="ast-45">3</span>,&nbsp;<span id="ast-46">0</span>)</span>)</span>:<span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>formated_key</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">formated_key</span>.encode</span>(<span id="ast-52">'utf-8'</span>)</span></span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>formated_key</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">sha1</span>(<span id="ast-59" class="other_trans">formated_key</span>)</span>.hexdigest</span>()</span></span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-61" class="other_trans">formated_key</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_dissect(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">buf</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>hlen</span>&nbsp;=&nbsp;<span id="ast-7">14</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10"><span id="ast-11" class="other_trans">buf</span>[<span id="ast-12"><span id="ast-13">12</span>:<span id="ast-14">14</span></span>]</span><span id="ast-15" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-16">'\\u0081\\u0000'</span>)</span>:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.vlan</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">buf</span>[<span id="ast-22"><span id="ast-23">12</span>:<span id="ast-24">16</span></span>]</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hlen</span>&nbsp;=&nbsp;<span id="ast-27">18</span></span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>type_len</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">unpack</span>(<span id="ast-33">'&gt;H'</span>,&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">buf</span>[<span id="ast-36"><span id="ast-37">12</span>:<span id="ast-38">14</span></span>]</span>)</span>[<span id="ast-39"><span id="ast-40">0</span></span>]</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43" class="other_trans">type_len</span><span id="ast-44" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-45">1536</span>)</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.len</span>&nbsp;=&nbsp;<span id="ast-49" class="other_trans">type_len</span></span><span id="ast-50"><span id="ast-51" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>type&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-52" class="other_trans">None</span></span><span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._parse_handler</span>(<span id="ast-57" class="other_trans">ETH_TYPE_LLC</span>,&nbsp;<span id="ast-58"><span id="ast-59" class="other_trans">buf</span>[<span id="ast-60"><span id="ast-61">12</span>:<span id="ast-62">14</span></span>]</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_table(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;a&nbsp;table&nbsp;object&nbsp;to&nbsp;use.&nbsp;The&nbsp;table&nbsp;has&nbsp;automatic&nbsp;support&nbsp;for\\u000a&nbsp;&nbsp;&nbsp;&nbsp;sorting&nbsp;and&nbsp;pagination.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>table_class</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.get_table_class</span>()</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>table</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">table_class</span>(<span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.get_table_data</span>()</span>)</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>RequestConfig</span>(<span id="ast-23" class="correct_node">request&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>.configure</span>(<span id="ast-24" class="other_trans">table</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26" class="other_trans">table</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;extract(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">rev_id</span>,&nbsp;<span id="ast-5" class="other_trans">features</span>,&nbsp;<span id="ast-6" class="other_trans">insert</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cache</span>&nbsp;=&nbsp;<span id="ast-10">{<span id="ast-11">'rev_id'</span>:&nbsp;<span id="ast-13" class="other_trans">rev_id</span>,&nbsp;<span id="ast-12">'session'</span>:&nbsp;<span id="ast-14"><span id="ast-15">self</span>.session</span>}</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19">self</span>.language</span><span id="ast-20" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-21" class="other_trans">None</span>)</span>:<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cache</span>.update</span>(<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>.language</span>.cache</span>()</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;add_kwarg(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-6">(<span id="ast-8">(<span id="ast-9"><span id="ast-10">self</span>.kwarg</span><span id="ast-11" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-12" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">isinstance</span>(<span id="ast-15" class="other_trans">name</span>,&nbsp;<span id="ast-16" class="other_trans">str</span>)</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22">self</span>.parent</span>.add_name</span>(<span id="ast-23" class="other_trans">name</span>)</span></span><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>.add_assignment</span>(<span id="ast-28">self</span>,&nbsp;typectx=<span id="ast-30" class="other_trans">dict</span>)</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.kwarg</span>&nbsp;=&nbsp;<span id="ast-34" class="ref_node">name&nbsp;&rarr;&nbsp;e&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;remove(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">ename</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Remove&nbsp;locked&nbsp;element&nbsp;from&nbsp;the&nbsp;queue.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Arguments:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ename&nbsp;-&nbsp;name&nbsp;of&nbsp;an&nbsp;element\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Raise:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QueueError&nbsp;-&nbsp;invalid&nbsp;element&nbsp;name;&nbsp;element&nbsp;not&nbsp;locked;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unexpected&nbsp;file&nbsp;in&nbsp;the&nbsp;element&nbsp;directory\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSError&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;can't&nbsp;rename/remove&nbsp;a&nbsp;file/directory\\u000a&nbsp;&nbsp;&nbsp;&nbsp;note:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;doesn't&nbsp;return&nbsp;anything&nbsp;explicitly&nbsp;(i.e.&nbsp;returns&nbsp;NoneType)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;fails\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-7"><span id="ast-8"><span id="ast-9" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>_check_element&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-10" class="other_trans">ename</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13">not</span>&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>._is_locked</span>(<span id="ast-17" class="other_trans">ename</span>)</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">QueueError</span>(<span id="ast-21">(<span id="ast-22">'cannot&nbsp;remove&nbsp;%s:&nbsp;not&nbsp;locked'</span>&nbsp;%&nbsp;<span id="ast-24" class="other_trans">ename</span>)</span>)</span></span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-27">(<span id="ast-28">'%s/%s'</span>&nbsp;%&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32">self</span>.path</span>,&nbsp;<span id="ast-33" class="other_trans">ename</span>)</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-35">True</span>:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>temp</span>&nbsp;=&nbsp;<span id="ast-38">(<span id="ast-39">'%s/%s/%s'</span>&nbsp;%&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43">self</span>.path</span>,&nbsp;<span id="ast-44">OBSOLETE_DIRECTORY</span>,&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">_name</span>()</span>)</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.rename</span>(<span id="ast-52">path</span>,&nbsp;<span id="ast-53" class="other_trans">temp</span>)</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-56" class="other_trans">StandardError</span>&nbsp;as&nbsp;<span id="ast-57">e</span>:<span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59">(<span id="ast-61">(<span id="ast-62"><span id="ast-63">e</span>.errno</span><span id="ast-64" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-65"><span id="ast-66">errno</span>.ENOTEMPTY</span>)</span>&nbsp;or&nbsp;<span id="ast-67">(<span id="ast-68"><span id="ast-69">e</span>.errno</span><span id="ast-70" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-71"><span id="ast-72">errno</span>.EEXIST</span>)</span>)</span>:<span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-74"><span id="ast-75">OSError</span>(<span id="ast-76">(<span id="ast-77">'cannot&nbsp;rename(%s,&nbsp;%s):&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-79">(<span id="ast-80">ename</span>,&nbsp;<span id="ast-81" class="other_trans">temp</span>,&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">str</span>(<span id="ast-84" class="other_trans">e</span>)</span>)</span>)</span>)</span></span></span></span></span></span><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-86" class="other_trans">name</span>&nbsp;in&nbsp;<span id="ast-87"><span id="ast-88">_directory_contents</span>(<span id="ast-89">temp</span>)</span>:<span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-91">(<span id="ast-92" class="other_trans">name</span><span id="ast-93" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-94">LOCKED_DIRECTORY</span>)</span>:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-97">(<span id="ast-98">not</span>&nbsp;<span id="ast-99"><span id="ast-100"><span id="ast-101">_FileRegexp</span>.match</span>(<span id="ast-102">name</span>)</span>)</span>:<span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-104"><span id="ast-105">QueueError</span>(<span id="ast-106">(<span id="ast-107">'unexpected&nbsp;file&nbsp;in&nbsp;%s:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-109">(<span id="ast-110" class="other_trans">temp</span>,&nbsp;<span id="ast-111" class="other_trans">name</span>)</span>)</span>)</span></span></span><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-114">(<span id="ast-115">'%s/%s'</span>&nbsp;%&nbsp;<span id="ast-117">(<span id="ast-118" class="other_trans">temp</span>,&nbsp;<span id="ast-119" class="other_trans">name</span>)</span>)</span></span><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.unlink</span>(<span id="ast-125" class="other_trans">path</span>)</span></span><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-127" class="other_trans">StandardError</span>&nbsp;as&nbsp;<span id="ast-128" class="other_trans">e</span>:<span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-130"><span id="ast-131">OSError</span>(<span id="ast-132">(<span id="ast-133">'cannot&nbsp;unlink(%s):&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-135">(<span id="ast-136" class="other_trans">path</span>,&nbsp;<span id="ast-137"><span id="ast-138">str</span>(<span id="ast-139" class="other_trans">e</span>)</span>)</span>)</span>)</span></span></span></span></span><span id="ast-140"><span id="ast-141" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-142">(<span id="ast-143">'%s/%s'</span>&nbsp;%&nbsp;<span id="ast-145">(<span id="ast-146" class="other_trans">temp</span>,&nbsp;<span id="ast-147">LOCKED_DIRECTORY</span>)</span>)</span></span><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-149">True</span>:<span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-151"><span id="ast-152"><span id="ast-153"><span id="ast-154" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.rmdir</span>(<span id="ast-155">path</span>)</span></span><span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-157">StandardError</span>&nbsp;as&nbsp;<span id="ast-158" class="other_trans">e</span>:<span id="ast-159"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-160"><span id="ast-161">OSError</span>(<span id="ast-162">(<span id="ast-163">'cannot&nbsp;rmdir(%s):&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-165">(<span id="ast-166">path</span>,&nbsp;<span id="ast-167"><span id="ast-168">str</span>(<span id="ast-169">e</span>)</span>)</span>)</span>)</span></span></span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-171"><span id="ast-172"><span id="ast-173"><span id="ast-174" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.rmdir</span>(<span id="ast-175" class="other_trans">temp</span>)</span></span><span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span><span id="ast-177"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-178">Exception</span>&nbsp;as&nbsp;<span id="ast-179">e</span>:<span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-181">(<span id="ast-183">(<span id="ast-184"><span id="ast-185">e</span>.errno</span><span id="ast-186" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-187"><span id="ast-188">errno</span>.ENOTEMPTY</span>)</span>&nbsp;or&nbsp;<span id="ast-189">(<span id="ast-190"><span id="ast-191" class="other_trans">e</span>.errno</span><span id="ast-192" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-193"><span id="ast-194">errno</span>.EEXIST</span>)</span>)</span>:<span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-196"><span id="ast-197">OSError</span>(<span id="ast-198">(<span id="ast-199">'cannot&nbsp;rmdir(%s):&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-201">(<span id="ast-202" class="ref_node">path&nbsp;&rarr;&nbsp;temp&nbsp;</span>,&nbsp;<span id="ast-203"><span id="ast-204">str</span>(<span id="ast-205">e</span>)</span>)</span>)</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;text(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">x</span>,&nbsp;<span id="ast-5" class="other_trans">y</span>,&nbsp;<span id="ast-6">body</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Writes&nbsp;a&nbsp;text&nbsp;``body``&nbsp;into&nbsp;(``x``,&nbsp;``y``).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;x:&nbsp;the&nbsp;left&nbsp;offset&nbsp;where&nbsp;to&nbsp;start&nbsp;writing&nbsp;a&nbsp;text\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;x:&nbsp;:class:`numbers.Integral`\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;y:&nbsp;the&nbsp;top&nbsp;offset&nbsp;where&nbsp;to&nbsp;start&nbsp;writing&nbsp;a&nbsp;text\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;y:&nbsp;:class:`numbers.Integral`\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;body:&nbsp;the&nbsp;body&nbsp;string&nbsp;to&nbsp;write\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;body:&nbsp;:class:`basestring`\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-12">(<span id="ast-13">not</span>&nbsp;<span id="ast-14"><span id="ast-15">isinstance</span>(<span id="ast-16" class="other_trans">x</span>,&nbsp;<span id="ast-17"><span id="ast-18">numbers</span>.Integral</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-19">(<span id="ast-20" class="other_trans">x</span><span id="ast-21" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-22">0</span>)</span>)</span>:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>exc</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-30">ValueError</span>&nbsp;if&nbsp;<span id="ast-26">(<span id="ast-27" class="other_trans">x</span><span id="ast-28" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-29">0</span>)</span>&nbsp;else&nbsp;<span id="ast-31" class="other_trans">TypeError</span></span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">exc</span>(<span id="ast-35">(<span id="ast-36">'x&nbsp;must&nbsp;be&nbsp;a&nbsp;natural&nbsp;number,&nbsp;not&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">repr</span>(<span id="ast-40" class="other_trans">x</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-42">(<span id="ast-44">(<span id="ast-45">not</span>&nbsp;<span id="ast-46"><span id="ast-47">isinstance</span>(<span id="ast-48" class="other_trans">y</span>,&nbsp;<span id="ast-49"><span id="ast-50">numbers</span>.Integral</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-51">(<span id="ast-52">y</span><span id="ast-53" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-54">0</span>)</span>)</span>:<span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>exc</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-62" class="other_trans">ValueError</span>&nbsp;if&nbsp;<span id="ast-58">(<span id="ast-59" class="other_trans">y</span><span id="ast-60" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-61">0</span>)</span>&nbsp;else&nbsp;<span id="ast-63">TypeError</span></span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">exc</span>(<span id="ast-67">(<span id="ast-68">'y&nbsp;must&nbsp;be&nbsp;a&nbsp;natural&nbsp;number,&nbsp;not&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-70"><span id="ast-71">repr</span>(<span id="ast-72" class="ref_node">x&nbsp;&rarr;&nbsp;y&nbsp;</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-74">(<span id="ast-75">not</span>&nbsp;<span id="ast-76"><span id="ast-77">isinstance</span>(<span id="ast-78" class="other_trans">body</span>,&nbsp;<span id="ast-79">basestring</span>)</span>)</span>:<span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-81"><span id="ast-82" class="other_trans">TypeError</span>(<span id="ast-83">(<span id="ast-84">'body&nbsp;must&nbsp;be&nbsp;a&nbsp;string,&nbsp;not&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-86"><span id="ast-87">repr</span>(<span id="ast-88" class="other_trans">body</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-90">(<span id="ast-91">not</span>&nbsp;<span id="ast-92" class="other_trans">body</span>)</span>:<span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-94"><span id="ast-95">ValueError</span>(<span id="ast-96">'body&nbsp;string&nbsp;cannot&nbsp;be&nbsp;empty'</span>)</span></span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-98">(<span id="ast-100"><span id="ast-101">self</span>.text_encoding</span>&nbsp;and&nbsp;<span id="ast-102"><span id="ast-103">isinstance</span>(<span id="ast-104" class="incorrect_node">body&nbsp;&rarr;&nbsp;y&nbsp;</span>,&nbsp;<span id="ast-105" class="other_trans">unicode</span>)</span>)</span>:<span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>body</span>&nbsp;=&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110" class="other_trans">body</span>.encode</span>(<span id="ast-111"><span id="ast-112">self</span>.text_encoding</span>)</span></span></span><span id="ast-113"><span id="ast-114" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>body_p</span>&nbsp;=&nbsp;<span id="ast-115"><span id="ast-116"><span id="ast-117">ctypes</span>.create_string_buffer</span>(<span id="ast-118" class="other_trans">body</span>)</span></span><span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>library</span>.DrawAnnotation</span>(<span id="ast-123"><span id="ast-124">self</span>.resource</span>,&nbsp;<span id="ast-125" class="other_trans">x</span>,&nbsp;<span id="ast-126" class="other_trans">y</span>,&nbsp;<span id="ast-127"><span id="ast-128"><span id="ast-129">ctypes</span>.cast</span>(<span id="ast-130" class="other_trans">body_p</span>,&nbsp;<span id="ast-131"><span id="ast-132"><span id="ast-133" class="other_trans">ctypes</span>.POINTER</span>(<span id="ast-134"><span id="ast-135">ctypes</span>.c_ubyte</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__unicode__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6"><span id="ast-7"><span id="ast-8" class="correct_node">user_services&nbsp;&rarr;&nbsp;self.&nbsp;</span>.count</span>()</span><span id="ast-9" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-10">0</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12">(<span id="ast-13">u'Auth&nbsp;for&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.user_services</span>.all</span>()</span>[<span id="ast-21"><span id="ast-22">0</span></span>]</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-24">u'Auth&nbsp;settings'</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_convert_feed(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">feed</span>,&nbsp;<span id="ast-5" class="other_trans">since</span>,&nbsp;<span id="ast-6" class="other_trans">screen_name</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Take&nbsp;the&nbsp;json&nbsp;and&nbsp;convert&nbsp;to&nbsp;ServiceItems'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>items</span>&nbsp;=&nbsp;<span id="ast-11">[]</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-13" class="other_trans">status</span>&nbsp;in&nbsp;<span id="ast-14" class="other_trans">feed</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">status</span>.created_at</span>.date</span>()</span><span id="ast-21" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-22" class="other_trans">since</span>)</span>:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26" class="other_trans">ServiceItem</span>()</span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>twitter_text</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">TwitterText</span>(<span id="ast-31"><span id="ast-32" class="other_trans">status</span>.text</span>)</span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>twitter_text</span>.autolink</span>.auto_link_usernames_or_lists</span>()</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>twitter_text</span>.autolink</span>.auto_link_hashtags</span>()</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>.body</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">unicode</span>(<span id="ast-48"><span id="ast-49" class="incorrect_node">twitter_text&nbsp;&rarr;&nbsp;status&nbsp;</span>.text</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">vim</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-10" class="other_trans">Source</span>,&nbsp;<span id="ast-11">self</span>)</span>.__init__</span>(<span id="ast-12" class="other_trans">vim</span>)</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.name</span>&nbsp;=&nbsp;<span id="ast-16">'ternjs'</span></span><span id="ast-17"><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.mark</span>&nbsp;=&nbsp;<span id="ast-20">'[ternjs]'</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.input_pattern</span>&nbsp;=&nbsp;<span id="ast-24">'\\\\.\\\\w*'</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.rank</span>&nbsp;=&nbsp;<span id="ast-28">700</span></span><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.filetypes</span>&nbsp;=&nbsp;<span id="ast-32">[<span id="ast-33">'javascript'</span>,&nbsp;<span id="ast-34">'jsx'</span>,&nbsp;<span id="ast-35">'javascript.jsx'</span>]</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._project_directory</span>&nbsp;=&nbsp;<span id="ast-39" class="other_trans">None</span></span><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.port</span>&nbsp;=&nbsp;<span id="ast-43" class="other_trans">None</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.localhost</span>&nbsp;=&nbsp;<span id="ast-47">(<span id="ast-49">(<span id="ast-51" class="incorrect_node">windows&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;and&nbsp;<span id="ast-52">'127.0.0.1'</span>)</span>&nbsp;or&nbsp;<span id="ast-53">'localhost'</span>)</span></span><span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.proc</span>&nbsp;=&nbsp;<span id="ast-57" class="other_trans">None</span></span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.last_failed</span>&nbsp;=&nbsp;<span id="ast-61">0</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cached</span>&nbsp;=&nbsp;<span id="ast-65">{<span id="ast-66">'row'</span>:&nbsp;<span id="ast-68">-1</span>,&nbsp;<span id="ast-67">'end'</span>:&nbsp;<span id="ast-69">-1</span>}</span></span><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._tern_command</span>&nbsp;=&nbsp;<span id="ast-73">'tern'</span></span><span id="ast-74"><span id="ast-75"><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._tern_arguments</span>&nbsp;=&nbsp;<span id="ast-77">''</span></span><span id="ast-78"><span id="ast-79"><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._tern_buffer_sent_at</span>&nbsp;=&nbsp;<span id="ast-81">{<span id="ast-82">'undo_tree'</span>:&nbsp;<span id="ast-84" class="other_trans">None</span>,&nbsp;<span id="ast-83">'ch'</span>:&nbsp;<span id="ast-85" class="other_trans">None</span>}</span></span><span id="ast-86"><span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._tern_timeout</span>&nbsp;=&nbsp;<span id="ast-89">1</span></span><span id="ast-90"><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._tern_show_signature</span>&nbsp;=&nbsp;<span id="ast-93">True</span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans">vim</span>.eval</span>(<span id="ast-98">'exists("g:tern_request_timeout")'</span>)</span>:<span id="ast-99"><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._tern_timeout</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103" class="other_trans">float</span>(<span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans">vim</span>.eval</span>(<span id="ast-107">'g:tern_request_timeout'</span>)</span>)</span></span></span><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans">vim</span>.eval</span>(<span id="ast-112">'exists("g:tern_show_signature_in_pum")'</span>)</span>:<span id="ast-113"><span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._tern_show_signature</span>&nbsp;=&nbsp;<span id="ast-116">(<span id="ast-117"><span id="ast-118"><span id="ast-119" class="other_trans">vim</span>.eval</span>(<span id="ast-120">'g:tern_show_signature_in_pum'</span>)</span><span id="ast-121" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-122">'0'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;package_finder(<span id="ast-2"><span id="ast-3" class="other_trans">argv</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;a&nbsp;PackageFinder&nbsp;respecting&nbsp;command-line&nbsp;options.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:arg&nbsp;argv:&nbsp;Everything&nbsp;after&nbsp;the&nbsp;subcommand\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>command</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9">InstallCommand</span>()</span></span><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-12" class="other_trans">options</span>,&nbsp;<span id="ast-13" class="other_trans">_</span>)</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">loads</span>(<span id="ast-18"><span id="ast-19" class="other_trans">dumps</span>(<span id="ast-20"><span id="ast-21" class="other_trans">command</span>.parser</span>)</span>)</span>.parse_args</span>(<span id="ast-22" class="other_trans">argv</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>possible_options</span>&nbsp;=&nbsp;<span id="ast-25">[<span id="ast-26">'find_links'</span>,&nbsp;<span id="ast-27">'use_wheel'</span>,&nbsp;<span id="ast-28">'allow_external'</span>,&nbsp;<span id="ast-29">'allow_unverified'</span>,&nbsp;<span id="ast-30">'allow_all_external'</span>,&nbsp;<span id="ast-31">(<span id="ast-32">'allow_all_prereleases'</span>,&nbsp;<span id="ast-33">'pre'</span>)</span>,&nbsp;<span id="ast-34">'process_dependency_links'</span>]</span></span><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>&nbsp;=&nbsp;<span id="ast-37">{}</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-39" class="other_trans">option</span>&nbsp;in&nbsp;<span id="ast-40" class="other_trans">possible_options</span>:<span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-43" class="other_trans">kw</span>,&nbsp;<span id="ast-44" class="other_trans">attr</span>)</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-50" class="other_trans">option</span>&nbsp;if&nbsp;<span id="ast-46"><span id="ast-47">isinstance</span>(<span id="ast-48" class="other_trans">option</span>,&nbsp;<span id="ast-49" class="other_trans">tuple</span>)</span>&nbsp;else&nbsp;<span id="ast-51">(<span id="ast-52" class="other_trans">option</span>,&nbsp;<span id="ast-53" class="other_trans">option</span>)</span></span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57">getattr</span>(<span id="ast-58" class="other_trans">options</span>,&nbsp;<span id="ast-59" class="other_trans">attr</span>,&nbsp;<span id="ast-60">MARKER</span>)</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-62">(<span id="ast-63">value</span><span id="ast-64" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-65" class="other_trans">MARKER</span>)</span>:<span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>[<span id="ast-69"><span id="ast-70">kw</span></span>]</span>&nbsp;=&nbsp;<span id="ast-71" class="other_trans">value</span></span></span></span><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index_urls</span>&nbsp;=&nbsp;<span id="ast-74">(<span id="ast-75">[<span id="ast-76"><span id="ast-77" class="other_trans">options</span>.index_url</span>]</span>&nbsp;+&nbsp;<span id="ast-79"><span id="ast-80" class="other_trans">options</span>.extra_index_urls</span>)</span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-82"><span id="ast-83">options</span>.no_index</span>:<span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>index_urls</span>&nbsp;=&nbsp;<span id="ast-86">[]</span></span></span><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index_urls</span>&nbsp;+=&nbsp;<span id="ast-90"><span id="ast-91" class="other_trans">getattr</span>(<span id="ast-92" class="other_trans">options</span>,&nbsp;<span id="ast-93">'mirrors'</span>,&nbsp;<span id="ast-94">[]</span>)</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96"><span id="ast-97">hasattr</span>(<span id="ast-98" class="other_trans">command</span>,&nbsp;<span id="ast-99">'_build_session'</span>)</span>:<span id="ast-100"><span id="ast-101"><span id="ast-102" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw&nbsp;&rarr;&nbsp;kwargs&nbsp;</span>[<span id="ast-103"><span id="ast-104">'session'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans">command</span>._build_session</span>(<span id="ast-108">options</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_create_container(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">name</span>,&nbsp;<span id="ast-5">image</span>,&nbsp;<span id="ast-6" class="other_trans">command</span>,&nbsp;<span id="ast-7">unit</span>,&nbsp;**kwargs</span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">locals</span>()</span>.copy</span>()</span></span><span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.update</span>(<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22">re</span>.match</span>(<span id="ast-23">MATCH</span>,&nbsp;<span id="ast-24" class="other_trans">name</span>)</span>.groupdict</span>()</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mem</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">kwargs</span>.get</span>(<span id="ast-32">'memory'</span>,&nbsp;<span id="ast-33">{}</span>)</span>.get</span>(<span id="ast-34"><span id="ast-35">l</span>[<span id="ast-36"><span id="ast-37">'c_type'</span></span>]</span>,&nbsp;<span id="ast-38">None</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40" class="other_trans">mem</span>:<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.update</span>(<span id="ast-45">{<span id="ast-46">'memory'</span>:&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49">'-m&nbsp;{}&nbsp;{}'</span>.format</span>(<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">mem</span>.lower</span>()</span>,&nbsp;<span id="ast-53"><span id="ast-54">settings</span>.DISABLE_SWAP</span>)</span>}</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.update</span>(<span id="ast-59">{<span id="ast-60">'memory'</span>:&nbsp;<span id="ast-61">''</span>}</span>)</span></span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cpu</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68">kwargs</span>.get</span>(<span id="ast-69">'cpu'</span>,&nbsp;<span id="ast-70">{}</span>)</span>.get</span>(<span id="ast-71"><span id="ast-72" class="other_trans">l</span>[<span id="ast-73"><span id="ast-74">'c_type'</span></span>]</span>,&nbsp;<span id="ast-75">None</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77" class="other_trans">cpu</span>:<span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.update</span>(<span id="ast-82">{<span id="ast-83">'cpu'</span>:&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86">'-c&nbsp;{}'</span>.format</span>(<span id="ast-87" class="other_trans">cpu</span>)</span>}</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.update</span>(<span id="ast-92">{<span id="ast-93">'cpu'</span>:&nbsp;<span id="ast-94">''</span>}</span>)</span></span></span><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.update</span>(<span id="ast-99">{<span id="ast-100">'hostname'</span>:&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103">self</span>._get_hostname</span>(<span id="ast-104" class="other_trans">name</span>)</span>}</span>)</span></span><span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>entrypoint</span>&nbsp;=&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109">kwargs</span>.get</span>(<span id="ast-110">'entrypoint'</span>)</span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112" class="other_trans">entrypoint</span>:<span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>.update</span>(<span id="ast-117">{<span id="ast-118">'entrypoint'</span>:&nbsp;<span id="ast-119"><span id="ast-120"><span id="ast-121">'{}'</span>.format</span>(<span id="ast-122" class="other_trans">entrypoint</span>)</span>}</span>)</span></span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124"><span id="ast-125">isinstance</span>(<span id="ast-126"><span id="ast-127"><span id="ast-128" class="other_trans">l</span>.get</span>(<span id="ast-129">'command'</span>)</span>,&nbsp;<span id="ast-130" class="other_trans">basestring</span>)</span>:<span id="ast-131"><span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>[<span id="ast-134"><span id="ast-135">'command'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-136"><span id="ast-137"><span id="ast-138"><span id="ast-139">l</span>[<span id="ast-140"><span id="ast-141">'command'</span></span>]</span>.encode</span>(<span id="ast-142">'utf-8'</span>)</span></span></span><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-144">f</span>&nbsp;in&nbsp;<span id="ast-145" class="other_trans">unit</span>:<span id="ast-146"><span id="ast-147"><span id="ast-148" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>[<span id="ast-149"><span id="ast-150">'value'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-151"><span id="ast-152"><span id="ast-153"><span id="ast-154">f</span>[<span id="ast-155"><span id="ast-156">'value'</span></span>]</span>.format</span>(**<span id="ast-157">l</span>)</span></span></span><span id="ast-158"><span id="ast-159"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tags</span>&nbsp;=&nbsp;<span id="ast-160"><span id="ast-161"><span id="ast-162">kwargs</span>.get</span>(<span id="ast-163">'tags'</span>,&nbsp;<span id="ast-164">{}</span>)</span></span><span id="ast-165"><span id="ast-166" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>unit_tags</span>&nbsp;=&nbsp;<span id="ast-167"><span id="ast-168"><span id="ast-169" class="other_trans">tags</span>.viewitems</span>()</span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-171">(<span id="ast-172"><span id="ast-173">settings</span>.ENABLE_PLACEMENT_OPTIONS</span><span id="ast-174">&nbsp;in&nbsp;</span><span id="ast-175">[<span id="ast-176">'true'</span>,&nbsp;<span id="ast-177">'True'</span>,&nbsp;<span id="ast-178">'TRUE'</span>,&nbsp;<span id="ast-179">'1'</span>]</span>)</span>:<span id="ast-180"><span id="ast-181"><span id="ast-182" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>unit_tags&nbsp;&rarr;&nbsp;tags&nbsp;</span>[<span id="ast-183"><span id="ast-184">'dataPlane'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-185">'true'</span></span></span><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-187" class="other_trans">unit_tags</span>:<span id="ast-188"><span id="ast-189"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tagset</span>&nbsp;=&nbsp;<span id="ast-190"><span id="ast-191"><span id="ast-192">'&nbsp;'</span>.join</span>(<span id="ast-193">[<span id="ast-194"><span id="ast-195"><span id="ast-196">'"{}={}"'</span>.format</span>(<span id="ast-197">k</span>,&nbsp;<span id="ast-198" class="other_trans">v</span>)</span><span id="ast-199">&nbsp;for&nbsp;<span id="ast-200">(<span id="ast-201" class="other_trans">k</span>,&nbsp;<span id="ast-202">v</span>)</span>&nbsp;in&nbsp;<span id="ast-203">unit_tags</span></span>]</span>)</span></span><span id="ast-204"><span id="ast-205"><span id="ast-206"><span id="ast-207" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>unit&nbsp;&rarr;&nbsp;unit_tags&nbsp;</span>.append</span>(<span id="ast-208">{<span id="ast-209">'section'</span>:&nbsp;<span id="ast-212">'X-Fleet'</span>,&nbsp;<span id="ast-210">'name'</span>:&nbsp;<span id="ast-213">'MachineMetadata'</span>,&nbsp;<span id="ast-211">'value'</span>:&nbsp;<span id="ast-214" class="other_trans">tagset</span>}</span>)</span></span></span><span id="ast-215"><span id="ast-216"><span id="ast-217"><span id="ast-218"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._put_unit</span>(<span id="ast-219" class="other_trans">name</span>,&nbsp;<span id="ast-220">{<span id="ast-221">'desiredState'</span>:&nbsp;<span id="ast-223">'loaded'</span>,&nbsp;<span id="ast-222">'options'</span>:&nbsp;<span id="ast-224" class="other_trans">unit</span>}</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;print_uforge_exception(<span id="ast-2"><span id="ast-3" class="other_trans">e</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-7">(<span id="ast-8"><span id="ast-9" class="other_trans">len</span>(<span id="ast-10"><span id="ast-11" class="other_trans">e</span>.args</span>)</span><span id="ast-12" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-13">1</span>)</span>&nbsp;and&nbsp;<span id="ast-14">(<span id="ast-15"><span id="ast-16" class="other_trans">type</span>(<span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">e</span>.args</span>[<span id="ast-20"><span id="ast-21">0</span></span>]</span>)</span><span id="ast-22" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-23" class="other_trans">uForgeError</span>)</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-25">(<span id="ast-26">(<span id="ast-27">(<span id="ast-28">(<span id="ast-29">(<span id="ast-30">(<span id="ast-31">(<span id="ast-32">(<span id="ast-33">"UForge&nbsp;Error&nbsp;'"</span>&nbsp;+&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">str</span>(<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans">e</span>.args</span>[<span id="ast-41"><span id="ast-42">0</span></span>]</span>.statusCode</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-44">"'&nbsp;with&nbsp;method:&nbsp;"</span>)</span>&nbsp;+&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">e</span>.args</span>[<span id="ast-50"><span id="ast-51">0</span></span>]</span>.requestMethod</span>)</span>&nbsp;+&nbsp;<span id="ast-53">'&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">e</span>.args</span>[<span id="ast-59"><span id="ast-60">0</span></span>]</span>.requestUri</span>)</span>&nbsp;+&nbsp;<span id="ast-62">'\\u000a'</span>)</span>&nbsp;+&nbsp;<span id="ast-64">'Message:\\u000a\\u0009'</span>)</span>&nbsp;+&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">e</span>.args</span>[<span id="ast-70"><span id="ast-71">0</span></span>]</span>.errorMsg</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>traceback</span>.print_exc</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__call__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">request</span>,&nbsp;<span id="ast-5" class="other_trans">next_call</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-8"><span id="ast-9" class="incorrect_node">next_call&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-10" class="other_trans">request</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-12" class="ref_node">exceptions&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;as&nbsp;<span id="ast-13" class="other_trans">ex</span>:<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.exception</span>(<span id="ast-19" class="other_trans">ex</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;unregisterTransport(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">tDomain</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>t</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">AbstractTransportDispatcher</span>.getTransport</span>(<span id="ast-10">self</span>,&nbsp;<span id="ast-11" class="other_trans">tDomain</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">t</span><span id="ast-15" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-16" class="other_trans">None</span>)</span>:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>AbstractTransportDispatcher</span>.unregisterTransport</span>(<span id="ast-21">self</span>,&nbsp;<span id="ast-22" class="incorrect_node">tDomain&nbsp;&rarr;&nbsp;t&nbsp;</span>)</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>t</span>.closeTransport</span>()</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.__transportCount</span>&nbsp;=&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32">self</span>.__transportCount</span>&nbsp;-&nbsp;<span id="ast-34">1</span>)</span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-38">(<span id="ast-39"><span id="ast-40">self</span>.__transportCount</span><span id="ast-41" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-42">0</span>)</span>&nbsp;and&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45">self</span>.loopingcall</span>.running</span>)</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.loopingcall</span>.stop</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_time_parser_absolute_5m(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_time</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7">':'</span>.join</span>(<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">str</span>(<span id="ast-13"><span id="ast-14"><span id="ast-15">(<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">datetime</span>.now</span>()</span>&nbsp;+&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">timedelta</span>(minutes=<span id="ast-23">5</span>)</span>)</span>.time</span>()</span>)</span>.split</span>(<span id="ast-24">':'</span>)</span>[<span id="ast-25">:<span id="ast-26">2</span></span>]</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-28" class="other_trans">new_time</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">ding</span>.TimeParser</span>(<span id="ast-34">[<span id="ast-35" class="other_trans">new_time</span>]</span>,&nbsp;relative=<span id="ast-37">False</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-39">(<span id="ast-40">(<span id="ast-41">60</span>&nbsp;*&nbsp;<span id="ast-43">4</span>)</span><span id="ast-44" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">parser</span>.get_seconds</span>()</span><span id="ast-45" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-49">(<span id="ast-50">60</span>&nbsp;*&nbsp;<span id="ast-52">6</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;eveluate(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">fv_path</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tester</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">pos_evaluate</span>.PosEvaluator</span>(<span id="ast-11" class="ref_node">test_data&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">fv_file</span><span id="ast-15" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-16" class="other_trans">None</span>)</span>:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>feat_vec</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">weight_vector</span>.WeightVector</span>()</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>feat_vec</span>.load_posfv</span>(<span id="ast-26" class="other_trans">fv_path</span>)</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.w_vector</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">feat_vec</span>.data_dict</span></span></span><span id="ast-32"><span id="ast-33" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>acc&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">tester</span>.get_accuracy</span>(<span id="ast-37"><span id="ast-38">self</span>.w_vector</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;delete_column_at_cursor(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Removes&nbsp;the&nbsp;column&nbsp;with&nbsp;the&nbsp;current&nbsp;cursor.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cursor</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.textCursor</span>()</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>table</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">cursor</span>.currentTable</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17" class="other_trans">table</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cell</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">table</span>.cellAt</span>(<span id="ast-23" class="other_trans">cursor</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-27">(<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">cell</span>.row</span>()</span><span id="ast-31" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-32"><span id="ast-33" class="other_trans">PoioGraidTextEdit</span>.FIRST_DATA_COLUMN</span>)</span>&nbsp;and&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">cell</span>.column</span>()</span><span id="ast-38" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-39"><span id="ast-40" class="other_trans">PoioGraidTextEdit</span>.FIRST_DATA_COLUMN</span>)</span>)</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-42" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">range</span>(<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">cell</span>.columnSpan</span>()</span>)</span>:<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>table</span>.removeColumns</span>(<span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">cell</span>.column</span>()</span>,&nbsp;<span id="ast-55">1</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">config</span>,&nbsp;<span id="ast-5" class="other_trans">param_list</span>,&nbsp;<span id="ast-6">ixLine</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-8" class="other_trans">param_tuple</span>&nbsp;in&nbsp;<span id="ast-9" class="other_trans">param_list</span>:<span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>param</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">param_tuple</span>[<span id="ast-14"><span id="ast-15">0</span></span>]</span></span><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>param_arg</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19">param_tuple</span>[<span id="ast-20"><span id="ast-21">1</span></span>]</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24">param</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26">'inport'</span>)</span>:<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.AddAttr</span>(<span id="ast-31" class="other_trans">config</span>,&nbsp;<span id="ast-32">'inport'</span>,&nbsp;<span id="ast-33">param_arg</span>,&nbsp;<span id="ast-34">'I_\\\\w+$'</span>,&nbsp;<span id="ast-35">ixLine</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-37">(<span id="ast-38" class="other_trans">param</span><span id="ast-39" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-40">'iosignal'</span>)</span>:<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.AddAttr</span>(<span id="ast-45" class="other_trans">config</span>,&nbsp;<span id="ast-46">'iosignal'</span>,&nbsp;<span id="ast-47" class="other_trans">param_arg</span>,&nbsp;<span id="ast-48">'io_\\\\w+$'</span>,&nbsp;<span id="ast-49" class="other_trans">ixLine</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-51">(<span id="ast-52" class="other_trans">param</span><span id="ast-53" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-54">'outport'</span>)</span>:<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.AddAttr</span>(<span id="ast-59">config</span>,&nbsp;<span id="ast-60">'outport'</span>,&nbsp;<span id="ast-61" class="other_trans">param_arg</span>,&nbsp;<span id="ast-62">'O_\\\\w+$'</span>,&nbsp;<span id="ast-63">ixLine</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-65">(<span id="ast-66">param</span><span id="ast-67" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-68">'width'</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.AddAttr</span>(<span id="ast-73" class="other_trans">config</span>,&nbsp;<span id="ast-74">'width'</span>,&nbsp;<span id="ast-75" class="correct_node">param&nbsp;&rarr;&nbsp;param_arg&nbsp;</span>,&nbsp;<span id="ast-76">'[1-9][0-9]*$'</span>,&nbsp;<span id="ast-77" class="other_trans">ixLine</span>)</span></span><span id="ast-78"><span id="ast-79"><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.width</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82" class="other_trans">int</span>(<span id="ast-83"><span id="ast-84">self</span>.width</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-86"><span id="ast-87">SSBCCException</span>(<span id="ast-88">(<span id="ast-89">'Unrecognized&nbsp;parameter&nbsp;at&nbsp;line&nbsp;%d:&nbsp;&nbsp;"%s"'</span>&nbsp;%&nbsp;<span id="ast-91">(<span id="ast-92" class="other_trans">ixLine</span>,&nbsp;<span id="ast-93" class="other_trans">param</span>)</span>)</span>)</span></span></span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95">(<span id="ast-96">not</span>&nbsp;<span id="ast-97"><span id="ast-98" class="other_trans">hasattr</span>(<span id="ast-99">self</span>,&nbsp;<span id="ast-100">'inport'</span>)</span>)</span>:<span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-102"><span id="ast-103" class="other_trans">SSBCCException</span>(<span id="ast-104">(<span id="ast-105">'Missing&nbsp;"inport=I_name"&nbsp;at&nbsp;line&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-107" class="other_trans">ixLine</span>)</span>)</span></span></span><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-109">(<span id="ast-110">not</span>&nbsp;<span id="ast-111"><span id="ast-112" class="other_trans">hasattr</span>(<span id="ast-113">self</span>,&nbsp;<span id="ast-114">'iosignal'</span>)</span>)</span>:<span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-116"><span id="ast-117">SSBCCException</span>(<span id="ast-118">(<span id="ast-119">'Missing&nbsp;"iosignal=io_name"&nbsp;at&nbsp;line&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-121" class="other_trans">ixLine</span>)</span>)</span></span></span><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-123">(<span id="ast-124">not</span>&nbsp;<span id="ast-125"><span id="ast-126" class="other_trans">hasattr</span>(<span id="ast-127">self</span>,&nbsp;<span id="ast-128">'outport'</span>)</span>)</span>:<span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-130"><span id="ast-131">SSBCCException</span>(<span id="ast-132">(<span id="ast-133">'Missing&nbsp;"outport=O_name"&nbsp;at&nbsp;line&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-135" class="other_trans">ixLine</span>)</span>)</span></span></span><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-137">(<span id="ast-138">not</span>&nbsp;<span id="ast-139"><span id="ast-140">hasattr</span>(<span id="ast-141">self</span>,&nbsp;<span id="ast-142">'width'</span>)</span>)</span>:<span id="ast-143"><span id="ast-144"><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.width</span>&nbsp;=&nbsp;<span id="ast-146">1</span></span></span><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>maxWidth</span>&nbsp;=&nbsp;<span id="ast-149"><span id="ast-150"><span id="ast-151" class="other_trans">config</span>.Get</span>(<span id="ast-152">'data_width'</span>)</span></span><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-154">(<span id="ast-156">(<span id="ast-157"><span id="ast-158">self</span>.width</span><span id="ast-159" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-160">1</span>)</span>&nbsp;or&nbsp;<span id="ast-161">(<span id="ast-162">maxWidth</span><span id="ast-163" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-164"><span id="ast-165">self</span>.width</span>)</span>)</span>:<span id="ast-166"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-167"><span id="ast-168" class="other_trans">SSBCCException</span>(<span id="ast-169">(<span id="ast-170">'width&nbsp;must&nbsp;be&nbsp;between&nbsp;1&nbsp;and&nbsp;%d&nbsp;inclusive&nbsp;at&nbsp;line&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-172">(<span id="ast-173">maxWidth</span>,&nbsp;<span id="ast-174" class="other_trans">ixLine</span>)</span>)</span>)</span></span></span><span id="ast-175"><span id="ast-176"><span id="ast-177"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sname</span>&nbsp;=&nbsp;<span id="ast-178">(<span id="ast-179">'s__'</span>&nbsp;+&nbsp;<span id="ast-181"><span id="ast-182">self</span>.iosignal</span>)</span></span><span id="ast-183"><span id="ast-184" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sname_init</span>&nbsp;=&nbsp;<span id="ast-185">(<span id="ast-186">"%d'b%s"</span>&nbsp;%&nbsp;<span id="ast-188">(<span id="ast-189"><span id="ast-190">self</span>.width</span>,&nbsp;<span id="ast-191">(<span id="ast-192">'1'</span>&nbsp;*&nbsp;<span id="ast-194"><span id="ast-195">self</span>.width</span>)</span>)</span>)</span></span><span id="ast-196"><span id="ast-197"><span id="ast-198"><span id="ast-199" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>config</span>.AddIO</span>(<span id="ast-200"><span id="ast-201">self</span>.iosignal</span>,&nbsp;<span id="ast-202"><span id="ast-203">self</span>.width</span>,&nbsp;<span id="ast-204">'inout'</span>)</span></span><span id="ast-205"><span id="ast-206"><span id="ast-207"><span id="ast-208" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>config</span>.AddSignalWithInit</span>(<span id="ast-209"><span id="ast-210">self</span>.sname</span>,&nbsp;<span id="ast-211"><span id="ast-212">self</span>.width</span>,&nbsp;<span id="ast-213" class="other_trans">None</span>)</span></span><span id="ast-214"><span id="ast-215"><span id="ast-216"><span id="ast-217" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>config</span>.AddInport</span>(<span id="ast-218">(<span id="ast-219"><span id="ast-220">self</span>.inport</span>,&nbsp;<span id="ast-221">(<span id="ast-222"><span id="ast-223">self</span>.iosignal</span>,&nbsp;<span id="ast-224"><span id="ast-225">self</span>.width</span>,&nbsp;<span id="ast-226">'data'</span>)</span>)</span>)</span></span><span id="ast-227"><span id="ast-228"><span id="ast-229"><span id="ast-230" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>config</span>.AddOutport</span>(<span id="ast-231">(<span id="ast-232"><span id="ast-233">self</span>.outport</span>,&nbsp;<span id="ast-234">(<span id="ast-235"><span id="ast-236">self</span>.sname</span>,&nbsp;<span id="ast-237"><span id="ast-238">self</span>.width</span>,&nbsp;<span id="ast-239">'data'</span>,&nbsp;<span id="ast-240">sname_init</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__new__(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span>,&nbsp;<span id="ast-4" class="other_trans">input_array</span>,&nbsp;<span id="ast-5" class="other_trans">info</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-11">(<span id="ast-12"><span id="ast-13" class="other_trans">len</span>(<span id="ast-14" class="other_trans">input_array</span>)</span><span id="ast-15" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-16">6</span>)</span>&nbsp;and&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">np</span>.isscalar</span>(<span id="ast-20"><span id="ast-21" class="other_trans">input_array</span>[<span id="ast-22"><span id="ast-23">0</span></span>]</span>)</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-26">(<span id="ast-28">(<span id="ast-29"><span id="ast-30" class="other_trans">len</span>(<span id="ast-31" class="other_trans">input_array</span>)</span><span id="ast-32" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-33">1</span>)</span>&nbsp;and&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36" class="other_trans">len</span>(<span id="ast-37"><span id="ast-38" class="other_trans">input_array</span>[<span id="ast-39"><span id="ast-40">0</span></span>]</span>)</span><span id="ast-41" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-42">3</span>)</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">ValueError</span>(<span id="ast-47">'Bounding&nbsp;box&nbsp;must&nbsp;have&nbsp;6&nbsp;components&nbsp;or&nbsp;be&nbsp;a&nbsp;list&nbsp;of&nbsp;points'</span>)</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-49" class="other_trans">TypeError</span>:<span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">ValueError</span>(<span id="ast-53">'Bounding&nbsp;box&nbsp;must&nbsp;have&nbsp;6&nbsp;components&nbsp;or&nbsp;be&nbsp;a&nbsp;list&nbsp;of&nbsp;points'</span>)</span></span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-55" class="other_trans">ValueError</span>:<span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">ValueError</span>(<span id="ast-59">'Bounding&nbsp;box&nbsp;must&nbsp;have&nbsp;6&nbsp;components&nbsp;or&nbsp;be&nbsp;a&nbsp;list&nbsp;of&nbsp;points'</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;load_app(<span id="ast-2"><span id="ast-3" class="other_trans">app_path</span>,&nbsp;<span id="ast-4" class="other_trans">wsgi_app_full_name</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6" class="other_trans">app_path</span>:<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>absolute_path</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">os</span>.path</span>.abspath</span>(<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16">os</span>.path</span>.expanduser</span>(<span id="ast-17" class="other_trans">app_path</span>)</span>)</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-22">(<span id="ast-23">'Adding&nbsp;%s&nbsp;to&nbsp;sys.path'</span>&nbsp;%&nbsp;<span id="ast-25" class="other_trans">absolute_path</span>)</span>)</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.path</span>.append</span>(<span id="ast-31" class="other_trans">absolute_path</span>)</span></span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33" class="other_trans">wsgi_app_full_name</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.info</span>(<span id="ast-38">(<span id="ast-39">'Loading&nbsp;WSGI&nbsp;application&nbsp;object:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-41" class="other_trans">wsgi_app_full_name</span>)</span>)</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-43"><span id="ast-44">import_object</span>(<span id="ast-45" class="other_trans">wsgi_app_full_name</span>)</span></span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>app_loaders</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">IAppLoader</span>.implementors</span>()</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-52" class="other_trans">loader</span>&nbsp;in&nbsp;<span id="ast-53" class="other_trans">app_loaders</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">loader</span>.can_load</span>(<span id="ast-58" class="location_node">absolute_path&nbsp;&rarr;&nbsp;app_path,&nbsp;pred:&nbsp;wsgi_app_full_name&nbsp;</span>)</span>:<span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.info</span>(<span id="ast-63">(<span id="ast-64">'Using&nbsp;AppLoader:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans">loader</span>.__class__</span>.__name__</span>)</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">loader</span>.load_app</span>(<span id="ast-73" class="other_trans">absolute_path</span>,&nbsp;<span id="ast-74" class="other_trans">wsgi_app_full_name</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_check_h5_dict(<span id="ast-2"><span id="ast-3">h5_group</span>,&nbsp;<span id="ast-4" class="other_trans">variables</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Checks&nbsp;that&nbsp;a&nbsp;dictionary&nbsp;matches&nbsp;a&nbsp;HDF5&nbsp;group&nbsp;and&nbsp;raises&nbsp;an\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``IncompatibleStateError``&nbsp;if&nbsp;not.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;dictionary&nbsp;can&nbsp;store&nbsp;strings,&nbsp;which&nbsp;are&nbsp;represented&nbsp;as&nbsp;HDF5\\u000a&nbsp;&nbsp;&nbsp;&nbsp;attributes,&nbsp;and&nbsp;lists&nbsp;of&nbsp;strings,&nbsp;which&nbsp;are&nbsp;represented&nbsp;as&nbsp;attributes&nbsp;of\\u000a&nbsp;&nbsp;&nbsp;&nbsp;HDF5&nbsp;subgroups.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;h5_group:&nbsp;h5py.Group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;h5_group:&nbsp;The&nbsp;HD5&nbsp;group&nbsp;that&nbsp;will&nbsp;store&nbsp;a&nbsp;dictionary&nbsp;of&nbsp;strings\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;its&nbsp;attributes\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;variables:&nbsp;dict\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;variables:&nbsp;a&nbsp;dictionary&nbsp;that&nbsp;may&nbsp;contain&nbsp;strings&nbsp;and&nbsp;lists&nbsp;of&nbsp;strings\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">variable</span>,&nbsp;<span id="ast-10" class="other_trans">values</span>)</span>&nbsp;in&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">variables</span>.items</span>()</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">isinstance</span>(<span id="ast-17" class="other_trans">values</span>,&nbsp;<span id="ast-18" class="other_trans">list</span>)</span>:<span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>h5_values</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">h5_group</span>[<span id="ast-23"><span id="ast-24" class="other_trans">variable</span></span>]</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-26">(<span id="ast-27">value_id</span>,&nbsp;<span id="ast-28" class="other_trans">value</span>)</span>&nbsp;in&nbsp;<span id="ast-29"><span id="ast-30">enumerate</span>(<span id="ast-31" class="other_trans">values</span>)</span>:<span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>h5_value</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">h5_values</span>.attrs</span>[<span id="ast-37"><span id="ast-38"><span id="ast-39">str</span>(<span id="ast-40" class="other_trans">value_id</span>)</span></span>]</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43" class="other_trans">value</span><span id="ast-44" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-45" class="other_trans">h5_value</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-47"><span id="ast-48">IncompatibleStateError</span>(<span id="ast-49"><span id="ast-50"><span id="ast-51">'Neural&nbsp;network&nbsp;state&nbsp;has&nbsp;{0}={2},&nbsp;while&nbsp;this&nbsp;architecture&nbsp;has&nbsp;{0}={1}.'</span>.format</span>(<span id="ast-52" class="other_trans">variable</span>,&nbsp;<span id="ast-53" class="other_trans">value</span>,&nbsp;<span id="ast-54" class="other_trans">h5_value</span>)</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>h5_value</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans">h5_group</span>.attrs</span>[<span id="ast-60"><span id="ast-61" class="other_trans">variable</span></span>]</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63">(<span id="ast-64" class="incorrect_node">values&nbsp;&rarr;&nbsp;h5_value&nbsp;</span><span id="ast-65" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-66" class="other_trans">h5_value</span>)</span>:<span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">IncompatibleStateError</span>(<span id="ast-70"><span id="ast-71"><span id="ast-72">'Neural&nbsp;network&nbsp;state&nbsp;has&nbsp;{0}={2},&nbsp;while&nbsp;this&nbsp;architecture&nbsp;has&nbsp;{0}={1}.'</span>.format</span>(<span id="ast-73" class="other_trans">variable</span>,&nbsp;<span id="ast-74" class="ref_node">value&nbsp;&rarr;&nbsp;values&nbsp;</span>,&nbsp;<span id="ast-75">h5_value</span>)</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;RenameObject(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">old_file</span>,&nbsp;<span id="ast-5" class="other_trans">new_file</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Renames&nbsp;a&nbsp;FakeFile&nbsp;object&nbsp;at&nbsp;old_file&nbsp;to&nbsp;new_file,&nbsp;preserving&nbsp;all&nbsp;properties.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Also&nbsp;replaces&nbsp;existing&nbsp;new_file&nbsp;object,&nbsp;if&nbsp;one&nbsp;existed&nbsp;(Unix&nbsp;only).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old_file:&nbsp;&nbsp;path&nbsp;to&nbsp;filesystem&nbsp;object&nbsp;to&nbsp;rename\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_file:&nbsp;&nbsp;path&nbsp;to&nbsp;where&nbsp;the&nbsp;filesystem&nbsp;object&nbsp;will&nbsp;live&nbsp;after&nbsp;this&nbsp;call\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Raises:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OSError:&nbsp;&nbsp;-&nbsp;if&nbsp;old_file&nbsp;does&nbsp;not&nbsp;exist\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;new_file&nbsp;is&nbsp;an&nbsp;existing&nbsp;directory\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;new_file&nbsp;is&nbsp;an&nbsp;existing&nbsp;file&nbsp;(Windows)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;new_file&nbsp;is&nbsp;an&nbsp;existing&nbsp;file&nbsp;and&nbsp;could&nbsp;not&nbsp;be&nbsp;removed&nbsp;(Unix)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;dirname(new_file)&nbsp;does&nbsp;not&nbsp;exist\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;if&nbsp;the&nbsp;file&nbsp;would&nbsp;be&nbsp;moved&nbsp;to&nbsp;another&nbsp;filesystem&nbsp;(e.g.&nbsp;mount&nbsp;point)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>old_file</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.NormalizePath</span>(<span id="ast-13" class="other_trans">old_file</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_file</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.NormalizePath</span>(<span id="ast-19" class="other_trans">new_file</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22">not</span>&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.Exists</span>(<span id="ast-26" class="other_trans">old_file</span>)</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">OSError</span>(<span id="ast-30"><span id="ast-31" class="other_trans">errno</span>.ENOENT</span>,&nbsp;<span id="ast-32">'Fake&nbsp;filesystem&nbsp;object:&nbsp;can&nbsp;not&nbsp;rename&nbsp;nonexistent&nbsp;file'</span>,&nbsp;<span id="ast-33" class="other_trans">old_file</span>)</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37">self</span>.Exists</span>(<span id="ast-38" class="incorrect_node">new_file&nbsp;&rarr;&nbsp;old_file&nbsp;</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">old_file</span><span id="ast-42" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-43" class="other_trans">new_file</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_obj</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49">self</span>.GetObject</span>(<span id="ast-50" class="other_trans">new_file</span>)</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">stat</span>.S_ISDIR</span>(<span id="ast-55"><span id="ast-56" class="other_trans">new_obj</span>.st_mode</span>)</span>:<span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-58"><span id="ast-59" class="other_trans">OSError</span>(<span id="ast-60"><span id="ast-61" class="other_trans">errno</span>.EEXIST</span>,&nbsp;<span id="ast-62">'Fake&nbsp;filesystem&nbsp;object:&nbsp;can&nbsp;not&nbsp;rename&nbsp;to&nbsp;existing&nbsp;directory'</span>,&nbsp;<span id="ast-63" class="other_trans">new_file</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-65">_is_windows</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-67"><span id="ast-68">OSError</span>(<span id="ast-69"><span id="ast-70" class="other_trans">errno</span>.EEXIST</span>,&nbsp;<span id="ast-71">'Fake&nbsp;filesystem&nbsp;object:&nbsp;can&nbsp;not&nbsp;rename&nbsp;to&nbsp;existing&nbsp;file'</span>,&nbsp;<span id="ast-72" class="other_trans">new_file</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.RemoveObject</span>(<span id="ast-78" class="ref_node">new_obj&nbsp;&rarr;&nbsp;new_file&nbsp;</span>)</span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-80">IOError</span>&nbsp;as&nbsp;<span id="ast-81" class="other_trans">e</span>:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-83"><span id="ast-84" class="other_trans">OSError</span>(<span id="ast-85"><span id="ast-86" class="other_trans">e</span>.errno</span>,&nbsp;<span id="ast-87"><span id="ast-88" class="other_trans">e</span>.strerror</span>,&nbsp;<span id="ast-89"><span id="ast-90" class="other_trans">e</span>.filename</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;predicate_pushdown(<span id="ast-2"><span id="ast-3" class="other_trans">tree</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5"><span id="ast-6" class="other_trans">isinstance</span>(<span id="ast-7" class="other_trans">tree</span>,&nbsp;<span id="ast-8">TableNode</span>)</span>:<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-11"><span id="ast-12">isinstance</span>(<span id="ast-13">tree</span>,&nbsp;<span id="ast-14" class="other_trans">OrderByNode</span>)</span>:<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>predicate_pushdown</span>(<span id="ast-18"><span id="ast-19" class="other_trans">tree</span>.child</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-21"><span id="ast-22">isinstance</span>(<span id="ast-23" class="other_trans">tree</span>,&nbsp;<span id="ast-24">GroupByNode</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28" class="other_trans">tree</span>.where_condition</span><span id="ast-29" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-30">None</span>)</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_where</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34">__groupby_where_filter__</span>(<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">tree</span>.where_condition</span>.where_condition_exp</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40" class="other_trans">new_where</span><span id="ast-41" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-42" class="other_trans">None</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-44">(<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">tree</span>.child</span>.where_condition</span><span id="ast-48" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-49" class="other_trans">None</span>)</span>:<span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>old_exp</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">tree</span>.child</span>.where_condition</span>.where_condition_exp</span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>para_list</span>&nbsp;=&nbsp;<span id="ast-58">[]</span></span><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>para_list</span>.append</span>(<span id="ast-63" class="other_trans">old_exp</span>)</span></span><span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>para_list</span>.append</span>(<span id="ast-68" class="other_trans">new_where</span>)</span></span><span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_exp</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72" class="other_trans">YFuncExp</span>(<span id="ast-73">'AND'</span>,&nbsp;<span id="ast-74" class="other_trans">para_list</span>)</span></span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tree</span>.child</span>.where_condition</span>.where_condition_exp</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">copy</span>.deepcopy</span>(<span id="ast-83">new_exp</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tree</span>.child</span>.where_condition</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89" class="other_trans">FirstStepWhereCondition</span>(<span id="ast-90">None</span>)</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tree</span>.child</span>.where_condition</span>.where_condition_exp</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98" class="other_trans">copy</span>.deepcopy</span>(<span id="ast-99" class="location_node">new_exp&nbsp;&rarr;&nbsp;new_where,&nbsp;pred:&nbsp;tree&nbsp;</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;update(<span id="ast-2"><span id="ast-3" class="other_trans">ret</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print_info</span>(<span id="ast-7">'marking&nbsp;bangumi&nbsp;status&nbsp;...'</span>)</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>now</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">int</span>(<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">time</span>.time</span>()</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">Followed</span>.get_all_followed</span>(status=<span id="ast-21" class="other_trans">STATUS_UPDATED</span>)</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-25"><span id="ast-26" class="other_trans">i</span>[<span id="ast-27"><span id="ast-28">'updated_time'</span></span>]</span>&nbsp;and&nbsp;<span id="ast-29">(<span id="ast-30"><span id="ast-31" class="other_trans">int</span>(<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">i</span>[<span id="ast-35"><span id="ast-36">'updated_time'</span></span>]</span>&nbsp;+&nbsp;<span id="ast-38">86400</span>)</span>)</span><span id="ast-39" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-40" class="other_trans">now</span>)</span>)</span>:<span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>.status</span>&nbsp;=&nbsp;<span id="ast-44" class="other_trans">STATUS_FOLLOWED</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>.save</span>()</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;lookup_statuses(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">num</span>,&nbsp;<span id="ast-5" class="other_trans">min_status</span>,&nbsp;<span id="ast-6" class="other_trans">codename</span>,&nbsp;<span id="ast-7" class="other_trans">hardware</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Scrape&nbsp;requested&nbsp;number&nbsp;of&nbsp;statuses/info&nbsp;from&nbsp;Launchpad'</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">min_status</span><span id="ast-13" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-14">'unknown'</span>)</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>min_index</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.status_opts</span>.index</span>(<span id="ast-21" class="other_trans">min_status</span>)</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.status_opts</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27">self</span>.status_opts</span>[<span id="ast-28"><span id="ast-29" class="other_trans">min_index</span>:</span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;work(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>._should_run</span>()</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>._sort_and_filter</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">len</span>(<span id="ast-22"><span id="ast-23">self</span>.evolve_list</span>)</span><span id="ast-24" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-25">0</span>)</span>&nbsp;and&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>.evolve_list</span>[<span id="ast-30"><span id="ast-31">0</span></span>]</span><span id="ast-32" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-33">'all'</span>)</span>)</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">filter</span>(<span id="ast-38">lambda&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">x</span></span>:&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43" class="other_trans">x</span>.name</span><span id="ast-44">&nbsp;in&nbsp;</span><span id="ast-45"><span id="ast-46">self</span>.evolve_list</span>)</span></span>,&nbsp;<span id="ast-47" class="other_trans">filtered_list</span>)</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-51">(<span id="ast-52"><span id="ast-53" class="other_trans">len</span>(<span id="ast-54"><span id="ast-55">self</span>.donot_evolve_list</span>)</span><span id="ast-56" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-57">0</span>)</span>&nbsp;and&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60"><span id="ast-61">self</span>.donot_evolve_list</span>[<span id="ast-62"><span id="ast-63">0</span></span>]</span><span id="ast-64" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-65">'none'</span>)</span>)</span>:<span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">filter</span>(<span id="ast-70">lambda&nbsp;<span id="ast-71"><span id="ast-72" class="other_trans">pokemon</span></span>:&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75" class="other_trans">pokemon</span>.name</span><span id="ast-76">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-77" class="correct_node">donot_evolve_list&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span>,&nbsp;<span id="ast-78" class="other_trans">filtered_list</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;reap_processes(<span id="ast-2"><span id="ast-3" class="other_trans">signo</span>,&nbsp;<span id="ast-4" class="other_trans">frame</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>global&nbsp;PROCS</span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>PROCS</span>&nbsp;=&nbsp;<span id="ast-8">[<span id="ast-9" class="other_trans">proc</span><span id="ast-10">&nbsp;for&nbsp;<span id="ast-11" class="other_trans">proc</span>&nbsp;in&nbsp;<span id="ast-12" class="other_trans">PROCS</span>&nbsp;if&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">proc</span>.poll</span>()</span><span id="ast-17" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-18" class="other_trans">None</span>)</span></span>]</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21">not</span>&nbsp;<span id="ast-22" class="other_trans">PROCS</span>)</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>signal</span>.signal</span>(<span id="ast-27"><span id="ast-28" class="other_trans">signal</span>.SIGCHLD</span>,&nbsp;<span id="ast-29" class="other_trans">orig_disposition</span>)</span></span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">callable</span>(<span id="ast-33" class="other_trans">orig_disposition</span>)</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>orig_disposition</span>(<span id="ast-37" class="other_trans">signo</span>,&nbsp;<span id="ast-38" class="other_trans">frame</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_get_occurrence_list(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">start</span>,&nbsp;<span id="ast-5" class="other_trans">end</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;occurrences&nbsp;for&nbsp;this&nbsp;event&nbsp;from&nbsp;start&nbsp;to&nbsp;end.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>difference</span>&nbsp;=&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12">self</span>.end</span>&nbsp;-&nbsp;<span id="ast-14"><span id="ast-15">self</span>.start</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19">self</span>.rule</span><span id="ast-20" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-21" class="other_trans">None</span>)</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>occurrences</span>&nbsp;=&nbsp;<span id="ast-24">[]</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-28"><span id="ast-29">self</span>.end_recurring_period</span>&nbsp;and&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32">self</span>.end_recurring_period</span><span id="ast-33" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-34" class="other_trans">end</span>)</span>)</span>:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38">self</span>.end_recurring_period</span></span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rule</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43">self</span>.get_rrule_object</span>()</span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>o_starts</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">rule</span>.between</span>(<span id="ast-49">(<span id="ast-50" class="other_trans">start</span>&nbsp;-&nbsp;<span id="ast-52" class="other_trans">difference</span>)</span>,&nbsp;<span id="ast-53" class="other_trans">end</span>,&nbsp;inc=<span id="ast-55">True</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-57" class="other_trans">o_start</span>&nbsp;in&nbsp;<span id="ast-58" class="other_trans">o_starts</span>:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>o_end</span>&nbsp;=&nbsp;<span id="ast-61">(<span id="ast-62" class="other_trans">o_start</span>&nbsp;+&nbsp;<span id="ast-64" class="other_trans">difference</span>)</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>occurrences</span>.append</span>(<span id="ast-69"><span id="ast-70"><span id="ast-71">self</span>._create_occurrence</span>(<span id="ast-72" class="other_trans">o_start</span>,&nbsp;<span id="ast-73" class="other_trans">o_end</span>)</span>)</span></span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-75" class="other_trans">occurrences</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-77">(<span id="ast-79">(<span id="ast-80"><span id="ast-81">self</span>.start</span><span id="ast-82" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-83" class="other_trans">end</span>)</span>&nbsp;and&nbsp;<span id="ast-84">(<span id="ast-85"><span id="ast-86">self</span>.end</span><span id="ast-87" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-88">start</span>)</span>)</span>:<span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-90">[<span id="ast-91"><span id="ast-92"><span id="ast-93">self</span>._create_occurrence</span>(<span id="ast-94"><span id="ast-95">self</span>.start</span>)</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-97">[]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">request</span>,&nbsp;<span id="ast-5" class="other_trans">module</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Library&nbsp;constructor.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;request:&nbsp;Pytest&nbsp;request&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;module:&nbsp;Module&nbsp;of&nbsp;the&nbsp;current&nbsp;test&nbsp;case.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.given</span>&nbsp;=&nbsp;<span id="ast-11">{}</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.steps</span>&nbsp;=&nbsp;<span id="ast-15">{}</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fm</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">request</span>.session</span>._fixturemanager</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-22">(<span id="ast-23" class="other_trans">fixture_name</span>,&nbsp;<span id="ast-24" class="other_trans">fixture_defs</span>)</span>&nbsp;in&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">fm</span>._arg2fixturedefs</span>.iteritems</span>()</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>faclist</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">list</span>(<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">fm</span>._matchfactories</span>(<span id="ast-36" class="other_trans">fixture_defs</span>,&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">request</span>._parentid</span>)</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41">not</span>&nbsp;<span id="ast-42" class="other_trans">faclist</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>func</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48" class="correct_node">fixture_defs&nbsp;&rarr;&nbsp;faclist&nbsp;</span>[<span id="ast-49"><span id="ast-50">-1</span></span>]</span>.func</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52">(<span id="ast-53"><span id="ast-54" class="other_trans">getattr</span>(<span id="ast-55" class="other_trans">func</span>,&nbsp;<span id="ast-56">'__step_type__'</span>,&nbsp;<span id="ast-57" class="other_trans">None</span>)</span><span id="ast-58" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-59" class="other_trans">GIVEN</span>)</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.given</span>[<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">func</span>.__step_name__</span></span>]</span>&nbsp;=&nbsp;<span id="ast-67" class="other_trans">fixture_name</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;work(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>._should_run</span>()</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>._sort_and_filter</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">len</span>(<span id="ast-22"><span id="ast-23">self</span>.evolve_list</span>)</span><span id="ast-24" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-25">0</span>)</span>&nbsp;and&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>.evolve_list</span>[<span id="ast-30"><span id="ast-31">0</span></span>]</span><span id="ast-32" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-33">'all'</span>)</span>)</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">filter</span>(<span id="ast-38">lambda&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">x</span></span>:&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43" class="other_trans">x</span>.name</span><span id="ast-44">&nbsp;in&nbsp;</span><span id="ast-45"><span id="ast-46">self</span>.evolve_list</span>)</span></span>,&nbsp;<span id="ast-47" class="other_trans">filtered_list</span>)</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-51">(<span id="ast-52"><span id="ast-53" class="other_trans">len</span>(<span id="ast-54"><span id="ast-55">self</span>.donot_evolve_list</span>)</span><span id="ast-56" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-57">0</span>)</span>&nbsp;and&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60"><span id="ast-61">self</span>.donot_evolve_list</span>[<span id="ast-62"><span id="ast-63">0</span></span>]</span><span id="ast-64" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-65">'none'</span>)</span>)</span>:<span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">filter</span>(<span id="ast-70">lambda&nbsp;<span id="ast-71"><span id="ast-72" class="other_trans">pokemon</span></span>:&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75" class="other_trans">pokemon</span>.name</span><span id="ast-76">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-77" class="correct_node">donot_evolve_list&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span>,&nbsp;<span id="ast-78" class="other_trans">filtered_list</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;clean_requires(<span id="ast-2"><span id="ast-3" class="other_trans">reqs</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Removes&nbsp;requirements&nbsp;that&nbsp;aren't&nbsp;needed&nbsp;in&nbsp;newer&nbsp;python&nbsp;versions."</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">sys</span>.version_info</span>[<span id="ast-11">:<span id="ast-12">2</span></span>]</span><span id="ast-13" class="correct_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-14">(<span id="ast-15">2</span>,&nbsp;<span id="ast-16">7</span>)</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-18" class="other_trans">reqs</span></span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-20">[<span id="ast-21" class="other_trans">req</span><span id="ast-22">&nbsp;for&nbsp;<span id="ast-23" class="other_trans">req</span>&nbsp;in&nbsp;<span id="ast-24" class="other_trans">reqs</span>&nbsp;if&nbsp;<span id="ast-25">(<span id="ast-26">not</span>&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">req</span>.startswith</span>(<span id="ast-30">'importlib'</span>)</span>)</span></span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;register_listener(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">event_name</span>,&nbsp;<span id="ast-5" class="other_trans">listener</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Same&nbsp;as&nbsp;:func:`ircutils.client.SimpleClient.register_listener`&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;execpt&nbsp;that&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;handler&nbsp;in&nbsp;the&nbsp;bot&nbsp;already,&nbsp;it&nbsp;auto-binds&nbsp;it\\u000a&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;listener.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.events</span>.register_listener</span>(<span id="ast-13" class="other_trans">event_name</span>,&nbsp;<span id="ast-14" class="other_trans">listener</span>)</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>handler_name</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">'on_{0}'</span>.format</span>(<span id="ast-20" class="other_trans">event_name</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">hasattr</span>(<span id="ast-24">self</span>,&nbsp;<span id="ast-25" class="other_trans">handler_name</span>)</span>:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>handler</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">getattr</span>(<span id="ast-31">self</span>,&nbsp;<span id="ast-32" class="other_trans">handler_name</span>)</span>.__func__</span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.events</span>[<span id="ast-39"><span id="ast-40" class="correct_node">handler_name&nbsp;&rarr;&nbsp;event_name&nbsp;</span></span>]</span>.add_handler</span>(<span id="ast-41" class="other_trans">handler</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;expand_placeholders(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">to_expand</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:rtype&nbsp;:&nbsp;dict\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">isinstance</span>(<span id="ast-10" class="other_trans">to_expand</span>,&nbsp;<span id="ast-11">str</span>)</span>:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>formatter</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">string</span>.Formatter</span>()</span></span><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-19" class="other_trans">result</span>,&nbsp;<span id="ast-20" class="other_trans">to_expand</span>)</span>&nbsp;=&nbsp;<span id="ast-21">(<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">formatter</span>.vformat</span>(<span id="ast-25">to_expand</span>,&nbsp;<span id="ast-26">()</span>,&nbsp;<span id="ast-27"><span id="ast-28">self</span>._context</span>)</span>,&nbsp;<span id="ast-29" class="other_trans">to_expand</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">result</span><span id="ast-33" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-34" class="other_trans">to_expand</span>)</span>:<span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-37" class="other_trans">result</span>,&nbsp;<span id="ast-38" class="other_trans">to_expand</span>)</span>&nbsp;=&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">formatter</span>.vformat</span>(<span id="ast-43" class="ref_node">to_expand&nbsp;&rarr;&nbsp;result&nbsp;</span>,&nbsp;<span id="ast-44">()</span>,&nbsp;<span id="ast-45"><span id="ast-46">self</span>._context</span>)</span>,&nbsp;<span id="ast-47" class="other_trans">result</span>)</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-49" class="other_trans">result</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-51"><span id="ast-52">isinstance</span>(<span id="ast-53" class="other_trans">to_expand</span>,&nbsp;<span id="ast-54" class="other_trans">list</span>)</span>:<span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-56">[<span id="ast-57"><span id="ast-58"><span id="ast-59">self</span>.expand_placeholders</span>(<span id="ast-60" class="other_trans">value</span>)</span><span id="ast-61">&nbsp;for&nbsp;<span id="ast-62" class="other_trans">value</span>&nbsp;in&nbsp;<span id="ast-63" class="other_trans">to_expand</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-65"><span id="ast-66">isinstance</span>(<span id="ast-67" class="other_trans">to_expand</span>,&nbsp;<span id="ast-68" class="other_trans">dict</span>)</span>:<span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-70"><span id="ast-71" class="other_trans">dict</span>(<span id="ast-72">[<span id="ast-73">(<span id="ast-74" class="other_trans">key</span>,&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77">self</span>.expand_placeholders</span>(<span id="ast-78" class="other_trans">value</span>)</span>)</span><span id="ast-79">&nbsp;for&nbsp;<span id="ast-80">(<span id="ast-81" class="other_trans">key</span>,&nbsp;<span id="ast-82" class="other_trans">value</span>)</span>&nbsp;in&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">to_expand</span>.iteritems</span>()</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-87" class="other_trans">to_expand</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;make_dict(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">addressgroup</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Convert&nbsp;a&nbsp;address&nbsp;model&nbsp;object&nbsp;to&nbsp;a&nbsp;dictionary.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>&nbsp;=&nbsp;<span id="ast-9">{<span id="ast-10">'id'</span>:&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">addressgroup</span>[<span id="ast-16"><span id="ast-17">'id'</span></span>]</span>,&nbsp;<span id="ast-11">'name'</span>:&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">addressgroup</span>[<span id="ast-20"><span id="ast-21">'name'</span></span>]</span>,&nbsp;<span id="ast-12">'tenant_id'</span>:&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">addressgroup</span>[<span id="ast-24"><span id="ast-25">'tenant_id'</span></span>]</span>,&nbsp;<span id="ast-13">'entries'</span>:&nbsp;<span id="ast-26">[<span id="ast-27"><span id="ast-28" class="correct_node">make_entry_dict&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-29" class="other_trans">e</span>)</span><span id="ast-30">&nbsp;for&nbsp;<span id="ast-31" class="other_trans">e</span>&nbsp;in&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">addressgroup</span>[<span id="ast-34"><span id="ast-35">'entries'</span></span>]</span></span>]</span>}</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-37" class="other_trans">res</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;fit(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">X</span>,&nbsp;<span id="ast-5" class="other_trans">y</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-8"><span id="ast-9">self</span>.w_</span>,&nbsp;<span id="ast-10"><span id="ast-11">self</span>.theta_</span>)</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">threshold_fit</span>(<span id="ast-14" class="other_trans">X</span>,&nbsp;<span id="ast-15" class="other_trans">y</span>,&nbsp;<span id="ast-16"><span id="ast-17">self</span>.alpha</span>,&nbsp;<span id="ast-18" class="correct_node">n_class&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;mode=<span id="ast-20"><span id="ast-21">self</span>.mode</span>,&nbsp;verbose=<span id="ast-23"><span id="ast-24">self</span>.verbose</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26">self</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;query(<span id="ast-2"><span id="ast-3" class="other_trans">conf</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">path</span>.exists</span>(<span id="ast-10"><span id="ast-11">conf</span>.sqlite__path</span>)</span>)</span>:<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-16">(<span id="ast-17"><span id="ast-18">str</span>(<span id="ast-19"><span id="ast-20">conf</span>.sqlite__path</span>)</span>&nbsp;+&nbsp;<span id="ast-22">'&nbsp;file&nbsp;does&nbsp;not&nbsp;exist,&nbsp;please&nbsp;sync&nbsp;with&nbsp;pycardsyncer&nbsp;first.'</span>)</span>)</span></span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>search_string</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">conf</span>.cmd__search_string</span>.decode</span>(<span id="ast-29">'utf-8'</span>)</span></span><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>my_dbtool</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34">backend</span>.SQLiteDb</span>(<span id="ast-35"><span id="ast-36">conf</span>.sqlite__path</span>,&nbsp;<span id="ast-37">'utf-8'</span>,&nbsp;<span id="ast-38">'stricts'</span>,&nbsp;<span id="ast-39">False</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41"><span id="ast-42">conf</span>.cmd__importing</span>:<span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cards</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">model</span>.cards_from_file</span>(<span id="ast-48"><span id="ast-49" class="other_trans">conf</span>.cmd__importing</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-51">card</span>&nbsp;in&nbsp;<span id="ast-52">cards</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>my_dbtool</span>.update</span>(<span id="ast-57" class="other_trans">card</span>,&nbsp;status=<span id="ast-59"><span id="ast-60" class="other_trans">backend</span>.NEW</span>)</span></span></span><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>()</span></span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66"><span id="ast-67">conf</span>.cmd__backup</span>:<span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-69"><span id="ast-70">open</span>(<span id="ast-71"><span id="ast-72" class="other_trans">conf</span>.cmd__backup</span>,&nbsp;<span id="ast-73">'w'</span>)</span>&nbsp;as&nbsp;<span id="ast-74" class="other_trans">vcf_file</span>:<span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-76">(<span id="ast-77" class="other_trans">search_string</span><span id="ast-78" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-79">''</span>)</span>:<span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hreflist</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans">my_dbtool</span>.get_all_vref_from_db</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-85"><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hreflist</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89">my_dbtool</span>.search</span>(<span id="ast-90">search_string</span>)</span></span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-92" class="other_trans">href</span>&nbsp;in&nbsp;<span id="ast-93" class="other_trans">hreflist</span>:<span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vcard</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98" class="other_trans">my_dbtool</span>.get_vcard_from_db</span>(<span id="ast-99">href</span>)</span></span><span id="ast-100"><span id="ast-101"><span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vcf_file</span>.write</span>(<span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107">vcard</span>.vcf</span>.encode</span>(<span id="ast-108">'utf-8'</span>)</span>)</span></span></span></span><span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>()</span></span></span><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-114"><span id="ast-115" class="other_trans">conf</span>.cmd__delete</span>:<span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hrefs</span>&nbsp;=&nbsp;<span id="ast-118"><span id="ast-119"><span id="ast-120" class="other_trans">my_dbtool</span>.search</span>(<span id="ast-121" class="other_trans">search_string</span>)</span></span><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-123">(<span id="ast-124"><span id="ast-125">len</span>(<span id="ast-126" class="other_trans">hrefs</span>)</span><span id="ast-127" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-128">0</span>)</span>:<span id="ast-129"><span id="ast-130"><span id="ast-131"><span id="ast-132" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-133">'Found&nbsp;no&nbsp;matching&nbsp;cards.'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-135">(<span id="ast-136"><span id="ast-137" class="other_trans">len</span>(<span id="ast-138">hrefs</span>)</span><span id="ast-139" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-140">1</span>)</span>:<span id="ast-141"><span id="ast-142" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>href</span>&nbsp;=&nbsp;<span id="ast-143"><span id="ast-144" class="other_trans">hrefs</span>[<span id="ast-145"><span id="ast-146">0</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-147"><span id="ast-148" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pane</span>&nbsp;=&nbsp;<span id="ast-149"><span id="ast-150"><span id="ast-151">ui</span>.VCardChooserPane</span>(<span id="ast-152">my_dbtool</span>,&nbsp;<span id="ast-153" class="ref_node">href&nbsp;&rarr;&nbsp;hrefs&nbsp;</span>)</span></span><span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ui</span>.start_pane</span>(<span id="ast-158" class="other_trans">pane</span>)</span></span><span id="ast-159"><span id="ast-160" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>card</span>&nbsp;=&nbsp;<span id="ast-161"><span id="ast-162"><span id="ast-163" class="other_trans">pane</span>._walker</span>.selected_vcard</span></span><span id="ast-164"><span id="ast-165" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>href</span>&nbsp;=&nbsp;<span id="ast-166"><span id="ast-167" class="incorrect_node">card&nbsp;&rarr;&nbsp;pane&nbsp;</span>.href</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;pause(<span id="ast-2"><span id="ast-3" class="other_trans">message</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Prints&nbsp;the&nbsp;message&nbsp;if&nbsp;it's&nbsp;not&nbsp;None&nbsp;and&nbsp;waits&nbsp;for&nbsp;a&nbsp;keypress."</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">message</span><span id="ast-10" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-13" class="other_trans">message</span></span></span><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>getch</span>()</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;</span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_init(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Initialises&nbsp;and&nbsp;runs&nbsp;sample&nbsp;echo&nbsp;playbook&nbsp;for&nbsp;testing\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">os</span>.path</span>.realpath</span>(<span id="ast-15" class="other_trans">__file__</span>)</span>.split</span>(<span id="ast-16">'/'</span>)</span>[<span id="ast-17"><span id="ast-18">0</span>:<span id="ast-19">-1</span></span>]</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24">'/'</span>.join</span>(<span id="ast-25" class="other_trans">path</span>)</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>playbook_path</span>&nbsp;=&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">path</span>&nbsp;+&nbsp;<span id="ast-31">'/playbooks/test_playbook.yml'</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>options</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="ref_node">Options&nbsp;&rarr;&nbsp;self.&nbsp;</span>(listtags=<span id="ast-37">False</span>,&nbsp;listtasks=<span id="ast-39">False</span>,&nbsp;listhosts=<span id="ast-41">False</span>,&nbsp;syntax=<span id="ast-43">False</span>,&nbsp;connection=<span id="ast-45">'ssh'</span>,&nbsp;module_path=<span id="ast-47" class="other_trans">None</span>,&nbsp;forks=<span id="ast-49">100</span>,&nbsp;remote_user=<span id="ast-51">'root'</span>,&nbsp;private_key_file=<span id="ast-53">None</span>,&nbsp;ssh_common_args=<span id="ast-55">None</span>,&nbsp;ssh_extra_args=<span id="ast-57" class="other_trans">None</span>,&nbsp;sftp_extra_args=<span id="ast-59" class="other_trans">None</span>,&nbsp;scp_extra_args=<span id="ast-61" class="other_trans">None</span>,&nbsp;become=<span id="ast-63">True</span>,&nbsp;become_method=<span id="ast-65">None</span>,&nbsp;become_user=<span id="ast-67">'root'</span>,&nbsp;verbosity=<span id="ast-69">3</span>,&nbsp;check=<span id="ast-71">False</span>)</span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.variable_manager</span>.extra_vars</span>&nbsp;=&nbsp;<span id="ast-76">{<span id="ast-77">'hosts'</span>:&nbsp;<span id="ast-78">'mywebserver'</span>}</span></span><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>passwords</span>&nbsp;=&nbsp;<span id="ast-81">{}</span></span><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pbex</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85" class="incorrect_node">PlaybookExecutor&nbsp;&rarr;&nbsp;self.&nbsp;</span>(playbooks=<span id="ast-87">[<span id="ast-88" class="other_trans">playbook_path</span>]</span>,&nbsp;inventory=<span id="ast-90"><span id="ast-91">self</span>.inventory</span>,&nbsp;variable_manager=<span id="ast-93"><span id="ast-94">self</span>.variable_manager</span>,&nbsp;loader=<span id="ast-96"><span id="ast-97">self</span>.loader</span>,&nbsp;options=<span id="ast-99" class="other_trans">options</span>,&nbsp;passwords=<span id="ast-101" class="other_trans">passwords</span>)</span></span><span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>results</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans">pbex</span>.run</span>()</span></span><span id="ast-107"><span id="ast-108"><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert_equal</span>(<span id="ast-110" class="other_trans">results</span>,&nbsp;<span id="ast-111">0</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;print_dict(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">ast</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.p</span>(<span id="ast-9">'{'</span>)</span></span><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ind</span>(<span id="ast-14">1</span>,&nbsp;<span id="ast-15" class="other_trans">ast</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">i</span>,&nbsp;<span id="ast-19" class="other_trans">key</span>)</span>&nbsp;in&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">enumerate</span>(<span id="ast-22" class="other_trans">ast</span>)</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.print_ast</span>(<span id="ast-27" class="other_trans">key</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-31">':&nbsp;'</span>)</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.print_ast</span>(<span id="ast-36"><span id="ast-37" class="other_trans">ast</span>[<span id="ast-38"><span id="ast-39" class="other_trans">key</span></span>]</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42">(<span id="ast-43" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-45">1</span>)</span><span id="ast-46" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-47"><span id="ast-48" class="other_trans">len</span>(<span id="ast-49" class="other_trans">ast</span>)</span>)</span>:<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.p</span>(<span id="ast-54">','</span>)</span></span><span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ind</span>()</span></span></span></span><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ind</span>(<span id="ast-63">-1</span>,&nbsp;<span id="ast-64" class="other_trans">ast</span>)</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.p</span>(<span id="ast-69">'}'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_write_configdrive_to_partition(<span id="ast-2"><span id="ast-3" class="other_trans">configdrive</span>,&nbsp;<span id="ast-4" class="other_trans">device</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">_configdrive_location</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">_configdrive_is_url</span>(<span id="ast-12" class="other_trans">configdrive</span>)</span>:<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_download_configdrive_to_file</span>(<span id="ast-16" class="other_trans">configdrive</span>,&nbsp;<span id="ast-17">filename</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_write_configdrive_to_file</span>(<span id="ast-21" class="other_trans">configdrive</span>,&nbsp;<span id="ast-22">filename</span>)</span></span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filesize</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28">os</span>.stat</span>(<span id="ast-29" class="other_trans">filename</span>)</span>.st_size</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">filesize</span><span id="ast-33" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-34">(<span id="ast-35">(<span id="ast-36">64</span>&nbsp;*&nbsp;<span id="ast-38">1024</span>)</span>&nbsp;*&nbsp;<span id="ast-40">1024</span>)</span>)</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44">errors</span>.ConfigDriveTooLargeError</span>(<span id="ast-45" class="other_trans">filename</span>,&nbsp;<span id="ast-46">filesize</span>)</span></span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>starttime</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">time</span>.time</span>()</span></span><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>script</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55">_path_to_script</span>(<span id="ast-56">'shell/copy_configdrive_to_disk.sh'</span>)</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>command</span>&nbsp;=&nbsp;<span id="ast-59">[<span id="ast-60">'/bin/bash'</span>,&nbsp;<span id="ast-61" class="other_trans">script</span>,&nbsp;<span id="ast-62" class="other_trans">filename</span>,&nbsp;<span id="ast-63">device</span>]</span></span><span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.info</span>(<span id="ast-68"><span id="ast-69"><span id="ast-70">'copying&nbsp;configdrive&nbsp;to&nbsp;disk&nbsp;with&nbsp;command&nbsp;{0}'</span>.format</span>(<span id="ast-71"><span id="ast-72"><span id="ast-73">'&nbsp;'</span>.join</span>(<span id="ast-74">command</span>)</span>)</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-78">stdout</span>,&nbsp;<span id="ast-79">stderr</span>)</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">utils</span>.execute</span>(check_exit_code=<span id="ast-84">[<span id="ast-85">0</span>]</span>,&nbsp;*<span id="ast-86">command</span>)</span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-88"><span id="ast-89" class="other_trans">processutils</span>.ProcessExecutionError</span>&nbsp;as&nbsp;<span id="ast-90" class="other_trans">e</span>:<span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans">errors</span>.ConfigDriveWriteError</span>(<span id="ast-95" class="other_trans">device</span>,&nbsp;<span id="ast-96"><span id="ast-97" class="other_trans">e</span>.exit_code</span>,&nbsp;<span id="ast-98"><span id="ast-99" class="other_trans">e</span>.stdout</span>,&nbsp;<span id="ast-100"><span id="ast-101" class="other_trans">e</span>.stderr</span>)</span></span></span></span><span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>totaltime</span>&nbsp;=&nbsp;<span id="ast-104">(<span id="ast-105"><span id="ast-106"><span id="ast-107">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-109" class="other_trans">starttime</span>)</span></span><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.info</span>(<span id="ast-114"><span id="ast-115"><span id="ast-116">'configdrive&nbsp;copied&nbsp;from&nbsp;{0}&nbsp;to&nbsp;{1}&nbsp;in&nbsp;{2}&nbsp;seconds'</span>.format</span>(<span id="ast-117" class="ref_node">configdrive&nbsp;&rarr;&nbsp;filename&nbsp;</span>,&nbsp;<span id="ast-118" class="other_trans">device</span>,&nbsp;<span id="ast-119" class="other_trans">totaltime</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_form(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>.request</span>.method</span><span id="ast-9" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-10">'POST'</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.form_class</span>(<span id="ast-15"><span id="ast-16" class="correct_node">request&nbsp;&rarr;&nbsp;self.&nbsp;</span>.POST</span>)</span></span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.form_class</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;clean(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;SessionKind&nbsp;can&nbsp;either&nbsp;have&nbsp;neither&nbsp;start&nbsp;nor&nbsp;end&nbsp;date&nbsp;or&nbsp;both.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-11" class="other_trans">SessionKind</span>,&nbsp;<span id="ast-12">self</span>)</span>.clean</span>()</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15"><span id="ast-16">self</span>.closed</span><span id="ast-17" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-18" class="other_trans">None</span>)</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-22">(<span id="ast-23"><span id="ast-24">self</span>.start_date</span><span id="ast-25" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-26" class="other_trans">None</span>)</span>&nbsp;or&nbsp;<span id="ast-27">(<span id="ast-28"><span id="ast-29">self</span>.end_date</span><span id="ast-30" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-31" class="other_trans">None</span>)</span>)</span>:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">forms</span>.ValidationError</span>(<span id="ast-36"><span id="ast-37" class="other_trans">_</span>(<span id="ast-38">"You&nbsp;have&nbsp;to&nbsp;specify&nbsp;a&nbsp;start&nbsp;and&nbsp;end&nbsp;date&nbsp;if&nbsp;you&nbsp;leave&nbsp;the&nbsp;'closed'&nbsp;status&nbsp;undetermined"</span>)</span>)</span></span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41"><span id="ast-42">self</span>.start_date</span><span id="ast-43" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-44"><span id="ast-45">self</span>.end_date</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">forms</span>.ValidationError</span>(<span id="ast-50"><span id="ast-51" class="other_trans">_</span>(<span id="ast-52">'The&nbsp;end&nbsp;date&nbsp;has&nbsp;to&nbsp;be&nbsp;after&nbsp;the&nbsp;start&nbsp;date'</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;decint(<span id="ast-2"><span id="ast-3">n</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5"><span id="ast-6" class="other_trans">isinstance</span>(<span id="ast-7">n</span>,&nbsp;<span id="ast-8" class="other_trans">str</span>)</span>:<span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>n</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">utils</span>.to_string</span>(<span id="ast-14">n</span>)</span></span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-18"><span id="ast-19">is_numeric</span>(<span id="ast-20" class="other_trans">n</span>)</span>&nbsp;and&nbsp;<span id="ast-21">(<span id="ast-22">n</span><span id="ast-23" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-24">(<span id="ast-25">2</span>&nbsp;**&nbsp;<span id="ast-27">256</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-28">(<span id="ast-29">n</span><span id="ast-30" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-31">(<span id="ast-32">-</span><span id="ast-33">(<span id="ast-34">2</span>&nbsp;**&nbsp;<span id="ast-36">255</span>)</span>)</span>)</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-38" class="other_trans">n</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">is_numeric</span>(<span id="ast-42">n</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">EncodingError</span>(<span id="ast-46">(<span id="ast-47">'Number&nbsp;out&nbsp;of&nbsp;range:&nbsp;%r'</span>&nbsp;%&nbsp;<span id="ast-49" class="other_trans">n</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-51">(<span id="ast-53"><span id="ast-54" class="other_trans">is_string</span>(<span id="ast-55" class="other_trans">n</span>)</span>&nbsp;and&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58">len</span>(<span id="ast-59" class="other_trans">n</span>)</span><span id="ast-60" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-61">40</span>)</span>)</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-63"><span id="ast-64">big_endian_to_int</span>(<span id="ast-65"><span id="ast-66">decode_hex</span>(<span id="ast-67" class="other_trans">n</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-69">(<span id="ast-71"><span id="ast-72">is_string</span>(<span id="ast-73">n</span>)</span>&nbsp;and&nbsp;<span id="ast-74">(<span id="ast-75"><span id="ast-76" class="other_trans">len</span>(<span id="ast-77">n</span>)</span><span id="ast-78" class="incorrect_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-79">32</span>)</span>)</span>:<span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-81"><span id="ast-82">big_endian_to_int</span>(<span id="ast-83" class="other_trans">n</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-85">(<span id="ast-87"><span id="ast-88">is_string</span>(<span id="ast-89" class="other_trans">n</span>)</span>&nbsp;and&nbsp;<span id="ast-90">(<span id="ast-91"><span id="ast-92" class="other_trans">len</span>(<span id="ast-93">n</span>)</span><span id="ast-94" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-95">32</span>)</span>)</span>:<span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-97"><span id="ast-98">EncodingError</span>(<span id="ast-99">(<span id="ast-100">'String&nbsp;too&nbsp;long:&nbsp;%r'</span>&nbsp;%&nbsp;<span id="ast-102">n</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-104">(<span id="ast-105">n</span><span id="ast-106" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-107">True</span>)</span>:<span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-109">1</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-111">(<span id="ast-113">(<span id="ast-114">n</span><span id="ast-115" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-116">False</span>)</span>&nbsp;or&nbsp;<span id="ast-117">(<span id="ast-118" class="other_trans">n</span><span id="ast-119" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-120" class="other_trans">None</span>)</span>)</span>:<span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-122">0</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-124"><span id="ast-125" class="other_trans">EncodingError</span>(<span id="ast-126">(<span id="ast-127">'Cannot&nbsp;encode&nbsp;integer:&nbsp;%r'</span>&nbsp;%&nbsp;<span id="ast-129" class="other_trans">n</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;image_to_string(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">filename</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tools</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">pyocr</span>.get_available_tools</span>()</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13">len</span>(<span id="ast-14" class="other_trans">tools</span>)</span><span id="ast-15" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-16">0</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">PyOCRIntegrationNoOCRFound</span>(<span id="ast-20">"No&nbsp;OCR&nbsp;tool&nbsp;has&nbsp;been&nbsp;found&nbsp;on&nbsp;this&nbsp;system.&nbsp;Make&nbsp;sure&nbsp;it's&nbsp;onPATH&nbsp;variable&nbsp;of&nbsp;your&nbsp;system"</span>)</span></span></span><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-23" class="other_trans">filename_split</span>,&nbsp;<span id="ast-24" class="other_trans">fileextension_split</span>)</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28">os</span>.path</span>.splitext</span>(<span id="ast-29" class="other_trans">filename</span>)</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>grayscale_filename</span>&nbsp;=&nbsp;<span id="ast-32">(<span id="ast-33">(<span id="ast-34" class="other_trans">filename_split</span>&nbsp;+&nbsp;<span id="ast-36">'_gray'</span>)</span>&nbsp;+&nbsp;<span id="ast-38" class="other_trans">fileextension_split</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">WandImage</span>(filename=<span id="ast-43" class="other_trans">filename</span>)</span>&nbsp;as&nbsp;<span id="ast-44" class="other_trans">img</span>:<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>img</span>.type</span>&nbsp;=&nbsp;<span id="ast-48">'grayscale'</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>img</span>.save</span>(filename=<span id="ast-54" class="other_trans">grayscale_filename</span>)</span></span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>adaptive_thresh_filename</span>&nbsp;=&nbsp;<span id="ast-57">(<span id="ast-58">(<span id="ast-59" class="other_trans">filename_split</span>&nbsp;+&nbsp;<span id="ast-61">'_adt'</span>)</span>&nbsp;+&nbsp;<span id="ast-63" class="other_trans">fileextension_split</span>)</span></span><span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>OpenCVIntegration</span>.adaptive_threshold</span>(<span id="ast-68" class="correct_node">fileextension_split&nbsp;&rarr;&nbsp;filename&nbsp;</span>,&nbsp;<span id="ast-69" class="other_trans">adaptive_thresh_filename</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_errors_values(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.importer</span>.is_valid</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12" class="other_trans">django</span>.get_version</span><span id="ast-13" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-14">'1.4'</span>)</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>error</span>&nbsp;=&nbsp;<span id="ast-17">[<span id="ast-18">(<span id="ast-19">0</span>,&nbsp;<span id="ast-20">'ValidationError'</span>,&nbsp;<span id="ast-21">u"[u'This&nbsp;value&nbsp;must&nbsp;be&nbsp;a&nbsp;float.']"</span>)</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>error</span>&nbsp;=&nbsp;<span id="ast-24">[<span id="ast-25">(<span id="ast-26">0</span>,&nbsp;<span id="ast-27">'ValidationError'</span>,&nbsp;<span id="ast-28">u'[u"\'23,98\'&nbsp;value&nbsp;must&nbsp;be&nbsp;a&nbsp;float."]'</span>)</span>]</span></span></span><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEquals</span>(<span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>.importer</span>.errors</span>,&nbsp;<span id="ast-36" class="other_trans">error</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;history(<span id="ast-2"><span id="ast-3" class="other_trans">request</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>template_values</span>&nbsp;=&nbsp;<span id="ast-6">{}</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10" class="other_trans">request</span>.method</span><span id="ast-11" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-12">'GET'</span>)</span>:<span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>services</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">UserService</span>.objects</span>.filter</span>(user=<span id="ast-20"><span id="ast-21">request</span>.user</span>)</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>template_values</span>[<span id="ast-25"><span id="ast-26">'services'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-27" class="other_trans">services</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>days</span>&nbsp;=&nbsp;<span id="ast-30">[]</span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>day_names</span>&nbsp;=&nbsp;<span id="ast-33">{}</span></span><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>days_to_i</span>&nbsp;=&nbsp;<span id="ast-36">{}</span></span><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>day_one</span>&nbsp;=&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41"><span id="ast-42">date</span>.today</span>()</span>&nbsp;-&nbsp;<span id="ast-44"><span id="ast-45">timedelta</span>(days=<span id="ast-47">7</span>)</span>)</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>today</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">date</span>.today</span>()</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-54" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-55"><span id="ast-56">range</span>(<span id="ast-57">0</span>,&nbsp;<span id="ast-58">7</span>)</span>:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last</span>&nbsp;=&nbsp;<span id="ast-61">(<span id="ast-62" class="other_trans">today</span>&nbsp;-&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">timedelta</span>(days=<span id="ast-67" class="other_trans">i</span>)</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>days</span>.append</span>(<span id="ast-72">[]</span>)</span></span><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>day_names</span>[<span id="ast-76"><span id="ast-77" class="other_trans">i</span></span>]</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80">last</span>.strftime</span>(<span id="ast-81">'%A'</span>)</span></span><span id="ast-82"><span id="ast-83"><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>days_to_i</span>[<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans">day_names</span>[<span id="ast-88"><span id="ast-89" class="other_trans">i</span></span>]</span></span>]</span>&nbsp;=&nbsp;<span id="ast-90" class="incorrect_node">i&nbsp;&rarr;&nbsp;last&nbsp;</span></span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-92">service</span>&nbsp;in&nbsp;<span id="ast-93" class="other_trans">services</span>:<span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>items</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans">service</span>.app</span>.module</span>.get_items</span>(<span id="ast-101"><span id="ast-102">request</span>.user</span>,&nbsp;<span id="ast-103">day_one</span>,&nbsp;<span id="ast-104">service</span>)</span></span><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-106" class="other_trans">items</span>:<span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-108" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-109" class="other_trans">items</span>:<span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-111">(<span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans">item</span>.created</span>.date</span>()</span><span id="ast-116" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-117">day_one</span>)</span>:<span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>days</span>[<span id="ast-123"><span id="ast-124"><span id="ast-125" class="other_trans">days_to_i</span>[<span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130" class="other_trans">item</span>.created</span>.strftime</span>(<span id="ast-131">'%A'</span>)</span></span>]</span></span>]</span>.append</span>(<span id="ast-132" class="other_trans">item</span>)</span></span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getSlice(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">start</span>,&nbsp;<span id="ast-5" class="other_trans">end</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10">(<span id="ast-11"><span id="ast-12">self</span>._lb</span>&nbsp;+&nbsp;<span id="ast-14" class="other_trans">start</span>)</span><span id="ast-15" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-16"><span id="ast-17">self</span>._ub</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">IndexError</span>()</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23" class="other_trans">end</span><span id="ast-24" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-25"><span id="ast-26" class="other_trans">sys</span>.maxsize</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30">self</span>._data</span>[<span id="ast-31"><span id="ast-32">(<span id="ast-33"><span id="ast-34">self</span>._lb</span>&nbsp;+&nbsp;<span id="ast-36" class="other_trans">start</span>)</span>:<span id="ast-37"><span id="ast-38">self</span>._ub</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-40">(<span id="ast-41">(<span id="ast-42"><span id="ast-43">self</span>._lb</span>&nbsp;+&nbsp;<span id="ast-45" class="other_trans">end</span>)</span><span id="ast-46" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-47"><span id="ast-48">self</span>._ub</span>)</span>:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">IndexError</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">self</span>._data</span>[<span id="ast-56"><span id="ast-57">(<span id="ast-58"><span id="ast-59">self</span>._lb</span>&nbsp;+&nbsp;<span id="ast-61" class="other_trans">start</span>)</span>:<span id="ast-62">(<span id="ast-63"><span id="ast-64">self</span>._lb</span>&nbsp;+&nbsp;<span id="ast-66" class="other_trans">end</span>)</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;auth(<span id="ast-2"><span id="ast-3">request</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'We&nbsp;dont&nbsp;need&nbsp;a&nbsp;full&nbsp;oauth&nbsp;setup&nbsp;just&nbsp;a&nbsp;username.'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>service</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9">get_model_instance</span>(<span id="ast-10"><span id="ast-11" class="other_trans">request</span>.user</span>,&nbsp;<span id="ast-12" class="other_trans">MODULE_NAME</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-16" class="other_trans">service</span>&nbsp;and&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19" class="other_trans">request</span>.method</span><span id="ast-20" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-21">'POST'</span>)</span>)</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>username</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">request</span>.POST</span>[<span id="ast-27"><span id="ast-28">'username'</span></span>]</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-31">(<span id="ast-32">'http://api.flickr.com/services/rest/?method=flickr.people.findByUsername&amp;api_key=%s&amp;username=%s&amp;format=json&amp;nojsoncallback=1'</span>&nbsp;%&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38">service</span>.app</span>.oauth</span>.consumer_key</span>,&nbsp;<span id="ast-39" class="other_trans">username</span>)</span>)</span></span><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>http_requester</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">httplib2</span>.Http</span>()</span></span><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-47" class="other_trans">resp</span>,&nbsp;<span id="ast-48" class="other_trans">content</span>)</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">http_requester</span>.request</span>(<span id="ast-52" class="other_trans">url</span>,&nbsp;<span id="ast-53">'GET'</span>)</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57" class="other_trans">resp</span>[<span id="ast-58"><span id="ast-59">'status'</span></span>]</span><span id="ast-60" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-61">'200'</span>)</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>json</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">simplejson</span>.loads</span>(<span id="ast-67" class="other_trans">content</span>)</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-70"><span id="ast-71" class="other_trans">json</span>[<span id="ast-72"><span id="ast-73">'stat'</span></span>]</span><span id="ast-74" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-75">'ok'</span>)</span>:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>userid</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans">json</span>[<span id="ast-81"><span id="ast-82">'user'</span></span>]</span>[<span id="ast-83"><span id="ast-84">'id'</span></span>]</span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>AccessToken</span>.objects</span>.filter</span>(service=<span id="ast-93" class="other_trans">service</span>)</span>.delete</span>()</span></span><span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>AccessToken</span>.objects</span>.create</span>(service=<span id="ast-100">service</span>,&nbsp;username=<span id="ast-102" class="other_trans">username</span>,&nbsp;userid=<span id="ast-104" class="other_trans">userid</span>,&nbsp;created=<span id="ast-106"><span id="ast-107"><span id="ast-108" class="other_trans">datetime</span>.now</span>()</span>,&nbsp;api_token=<span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113">service</span>.app</span>.oauth</span>.consumer_key</span>)</span></span><span id="ast-114"><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>service</span>.setup</span>&nbsp;=&nbsp;<span id="ast-117">True</span></span><span id="ast-118"><span id="ast-119"><span id="ast-120" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>service</span>.public</span>&nbsp;=&nbsp;<span id="ast-121">True</span></span><span id="ast-122"><span id="ast-123"><span id="ast-124"><span id="ast-125" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>service</span>.save</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>messages</span>.error</span>(<span id="ast-130" class="other_trans">request</span>,&nbsp;<span id="ast-131">'Unable&nbsp;to&nbsp;validate&nbsp;your&nbsp;username&nbsp;with&nbsp;Flickr,&nbsp;please&nbsp;check&nbsp;your&nbsp;username&nbsp;and&nbsp;retry.'</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_build_mask_and_length(<span id="ast-2"><span id="ast-3" class="other_trans">masked</span>,&nbsp;<span id="ast-4" class="other_trans">length</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>original_length</span>&nbsp;=&nbsp;<span id="ast-7" class="other_trans">length</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>extra_length</span>&nbsp;=&nbsp;<span id="ast-10">''</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">original_length</span><span id="ast-14" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-15">(<span id="ast-16">2</span>&nbsp;**&nbsp;<span id="ast-18">16</span>)</span>)</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>length</span>&nbsp;=&nbsp;<span id="ast-21">127</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">original_length</span><span id="ast-25" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-26">125</span>)</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>length</span>&nbsp;=&nbsp;<span id="ast-29">126</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">num_epochs</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dataset</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">load_data</span>(<span id="ast-9">'mnist.pkl.gz'</span>)</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_layer</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">build_model</span>(input_width=<span id="ast-15"><span id="ast-16" class="other_trans">dataset</span>[<span id="ast-17"><span id="ast-18">'input_width'</span></span>]</span>,&nbsp;input_height=<span id="ast-20"><span id="ast-21" class="other_trans">dataset</span>[<span id="ast-22"><span id="ast-23">'input_width'</span></span>]</span>,&nbsp;output_dim=<span id="ast-25"><span id="ast-26" class="other_trans">dataset</span>[<span id="ast-27"><span id="ast-28">'output_dim'</span></span>]</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iter_funcs</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32">create_iter_functions</span>(<span id="ast-33" class="other_trans">dataset</span>,&nbsp;<span id="ast-34" class="other_trans">output_layer</span>,&nbsp;X_tensor_type=<span id="ast-36"><span id="ast-37">T</span>.tensor4</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-39">'Starting&nbsp;training...'</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-41" class="other_trans">epoch</span>&nbsp;in&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">train</span>(<span id="ast-44" class="other_trans">iter_funcs</span>,&nbsp;<span id="ast-45" class="other_trans">dataset</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-47">(<span id="ast-48">'Epoch&nbsp;%d&nbsp;of&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-50">(<span id="ast-51"><span id="ast-52" class="other_trans">epoch</span>[<span id="ast-53"><span id="ast-54">'number'</span></span>]</span>,&nbsp;<span id="ast-55" class="other_trans">num_epochs</span>)</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-57">(<span id="ast-58">'&nbsp;&nbsp;training&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">epoch</span>[<span id="ast-62"><span id="ast-63">'train_loss'</span></span>]</span>)</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-65">(<span id="ast-66">'&nbsp;&nbsp;validation&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">epoch</span>[<span id="ast-70"><span id="ast-71">'valid_loss'</span></span>]</span>)</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-73">(<span id="ast-74">'&nbsp;&nbsp;validation&nbsp;accuracy:\\u0009\\u0009%.2f&nbsp;%%'</span>&nbsp;%&nbsp;<span id="ast-76">(<span id="ast-77"><span id="ast-78" class="other_trans">epoch</span>[<span id="ast-79"><span id="ast-80">'valid_accuracy'</span></span>]</span>&nbsp;*&nbsp;<span id="ast-82">100</span>)</span>)</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85"><span id="ast-86" class="other_trans">epoch</span>[<span id="ast-87"><span id="ast-88">'number'</span></span>]</span><span id="ast-89" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-90" class="other_trans">num_epochs</span>)</span>:<span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;fact(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Get&nbsp;a&nbsp;single&nbsp;fact&nbsp;from&nbsp;this&nbsp;node.'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>facts</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="ref_node">facts&nbsp;&rarr;&nbsp;self.&nbsp;</span>(name=<span id="ast-12" class="other_trans">name</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-14"><span id="ast-15" class="incorrect_node">next&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-16">(<span id="ast-17" class="other_trans">fact</span><span id="ast-18">&nbsp;for&nbsp;<span id="ast-19" class="other_trans">fact</span>&nbsp;in&nbsp;<span id="ast-20" class="other_trans">facts</span></span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;button2action(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">event</span>,&nbsp;<span id="ast-6" class="other_trans">debug</span>,&nbsp;<span id="ast-8" class="other_trans">subtract</span>,&nbsp;<span id="ast-10" class="other_trans">fit_original</span>,&nbsp;<span id="ast-12" class="other_trans">baseline_fit_color</span>,&nbsp;**kwargs</span>):<span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Do&nbsp;the&nbsp;baseline&nbsp;fitting&nbsp;and&nbsp;save&nbsp;and&nbsp;plot&nbsp;the&nbsp;results.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17" class="other_trans">debug</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-19">'Button&nbsp;2/3&nbsp;Baseline.&nbsp;&nbsp;Subtract='</span>,&nbsp;<span id="ast-20" class="other_trans">subtract</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22"><span id="ast-23">self</span>.subtracted</span>:<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.unsubtract</span>()</span></span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.clear_highlights</span>()</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>xarr_fit_units</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">self</span>.Spectrum</span>.xarr</span>.units</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39" class="other_trans">debug</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-41">'Fitting&nbsp;baseline'</span></span></span><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-44"><span id="ast-45">self</span>.basespec</span>,&nbsp;<span id="ast-46"><span id="ast-47">self</span>.baselinepars</span>)</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>._baseline</span>(<span id="ast-51"><span id="ast-52">self</span>.spectofit</span>,&nbsp;xarr=<span id="ast-54"><span id="ast-55"><span id="ast-56">self</span>.Spectrum</span>.xarr</span>,&nbsp;err=<span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>.Spectrum</span>.error</span>,&nbsp;order=<span id="ast-62"><span id="ast-63">self</span>.order</span>,&nbsp;mask=<span id="ast-65">(<span id="ast-66">True</span>&nbsp;-&nbsp;<span id="ast-68"><span id="ast-69">self</span>.includemask</span>)</span>,&nbsp;powerlaw=<span id="ast-71"><span id="ast-72">self</span>.powerlaw</span>,&nbsp;xarr_fit_units=<span id="ast-74" class="other_trans">xarr_fit_units</span>,&nbsp;**<span id="ast-75" class="other_trans">kwargs</span>)</span></span><span id="ast-76"><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.basespec</span>&nbsp;=&nbsp;<span id="ast-79"><span id="ast-80"><span id="ast-81">self</span>.get_model</span>(xarr=<span id="ast-83"><span id="ast-84"><span id="ast-85">self</span>.Spectrum</span>.xarr</span>,&nbsp;powerlaw=<span id="ast-87" class="correct_node">powerlaw&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;fit_units=<span id="ast-89" class="other_trans">xarr_fit_units</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;delete(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">resource</span>,&nbsp;<span id="ast-5" class="other_trans">user_id</span>,&nbsp;<span id="ast-6" class="other_trans">record_id</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>resource_name</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="incorrect_node">classname&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-11" class="other_trans">resource</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>._client</span>.pipeline</span>()</span>&nbsp;as&nbsp;<span id="ast-17" class="other_trans">multi</span>:<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>multi</span>.get</span>(<span id="ast-22"><span id="ast-23"><span id="ast-24">'{0}.{1}.{2}'</span>.format</span>(<span id="ast-25" class="other_trans">resource_name</span>,&nbsp;<span id="ast-26" class="other_trans">user_id</span>,&nbsp;<span id="ast-27" class="other_trans">record_id</span>)</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>multi</span>.delete</span>(<span id="ast-32"><span id="ast-33"><span id="ast-34">'{0}.{1}.{2}'</span>.format</span>(<span id="ast-35" class="other_trans">resource_name</span>,&nbsp;<span id="ast-36" class="other_trans">user_id</span>,&nbsp;<span id="ast-37" class="other_trans">record_id</span>)</span>)</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>multi</span>.srem</span>(<span id="ast-42"><span id="ast-43"><span id="ast-44">'{0}.{1}'</span>.format</span>(<span id="ast-45" class="other_trans">resource_name</span>,&nbsp;<span id="ast-46">user_id</span>)</span>,&nbsp;<span id="ast-47" class="other_trans">record_id</span>)</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>responses</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52">multi</span>.execute</span>()</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>encoded_item</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">responses</span>[<span id="ast-57"><span id="ast-58">0</span></span>]</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-61" class="other_trans">encoded_item</span><span id="ast-62" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-63" class="other_trans">None</span>)</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans">exceptions</span>.RecordNotFoundError</span>(<span id="ast-68" class="other_trans">record_id</span>)</span></span></span><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._bump_timestamp</span>(<span id="ast-73" class="ref_node">resource_name&nbsp;&rarr;&nbsp;resource&nbsp;</span>,&nbsp;<span id="ast-74" class="other_trans">user_id</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-76"><span id="ast-77"><span id="ast-78">self</span>._decode</span>(<span id="ast-79" class="other_trans">encoded_item</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_samples(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">gts</span>,&nbsp;<span id="ast-5" class="other_trans">lbls</span>,&nbsp;<span id="ast-6" class="other_trans">splitter</span>,&nbsp;<span id="ast-11">model</span></span>):<span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Hack...'</span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>model</span>&nbsp;=&nbsp;<span id="ast-17">(<span id="ast-19" class="other_trans">model</span>&nbsp;or&nbsp;<span id="ast-20"><span id="ast-21">self</span>.model</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">model</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26">'auto_rec'</span>)</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ref</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">splitter</span>.split</span>(<span id="ast-33"><span id="ast-34" class="other_trans">gts</span>[<span id="ast-35"><span id="ast-36">0</span></span>]</span>)</span>[<span id="ast-37"><span id="ast-38">0</span></span>]</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-40">[<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44">l</span>.split</span>(<span id="ast-45">'('</span>,&nbsp;<span id="ast-46">1</span>)</span>[<span id="ast-47"><span id="ast-48">0</span></span>]</span><span id="ast-49">&nbsp;for&nbsp;<span id="ast-50">(<span id="ast-51">gt</span>,&nbsp;<span id="ast-52">l</span>)</span>&nbsp;in&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">it</span>.izip</span>(<span id="ast-56" class="other_trans">gts</span>,&nbsp;<span id="ast-57">lbls</span>)</span>&nbsp;if&nbsp;<span id="ast-58">(<span id="ast-59">not</span>&nbsp;<span id="ast-60">(<span id="ast-61" class="other_trans">ref</span><span id="ast-62">&nbsp;in&nbsp;</span><span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">splitter</span>.split</span>(<span id="ast-66">gt</span>)</span>)</span>)</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-68">(<span id="ast-69">model</span><span id="ast-70" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-71">'auto_dom'</span>)</span>:<span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-73">[<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77">l</span>.split</span>(<span id="ast-78">'('</span>,&nbsp;<span id="ast-79">1</span>)</span>[<span id="ast-80"><span id="ast-81">0</span></span>]</span><span id="ast-82">&nbsp;for&nbsp;<span id="ast-83" class="other_trans">l</span>&nbsp;in&nbsp;<span id="ast-84">lbls</span>&nbsp;if&nbsp;<span id="ast-85">(<span id="ast-86">';affected'</span><span id="ast-87">&nbsp;in&nbsp;</span><span id="ast-88" class="ref_node">lbls&nbsp;&rarr;&nbsp;l&nbsp;</span>)</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-90">(<span id="ast-91">model</span><span id="ast-92" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-93">'de_novo'</span>)</span>:<span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parents</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97" class="other_trans">set</span>(<span id="ast-98">(<span id="ast-99"><span id="ast-100"><span id="ast-101">splitter</span>.split</span>(<span id="ast-102"><span id="ast-103" class="other_trans">gts</span>[<span id="ast-104"><span id="ast-105">0</span></span>]</span>)</span>&nbsp;+&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans">splitter</span>.split</span>(<span id="ast-110"><span id="ast-111">gts</span>[<span id="ast-112"><span id="ast-113">1</span></span>]</span>)</span>)</span>)</span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-115">[<span id="ast-116"><span id="ast-117"><span id="ast-118"><span id="ast-119">l</span>.split</span>(<span id="ast-120">'('</span>,&nbsp;<span id="ast-121">1</span>)</span>[<span id="ast-122"><span id="ast-123">0</span></span>]</span><span id="ast-124">&nbsp;for&nbsp;<span id="ast-125">(<span id="ast-126">gt</span>,&nbsp;<span id="ast-127" class="other_trans">l</span>)</span>&nbsp;in&nbsp;<span id="ast-128"><span id="ast-129"><span id="ast-130">it</span>.izip</span>(<span id="ast-131"><span id="ast-132" class="other_trans">gts</span>[<span id="ast-133"><span id="ast-134">2</span>:</span>]</span>,&nbsp;<span id="ast-135"><span id="ast-136" class="other_trans">lbls</span>[<span id="ast-137"><span id="ast-138">2</span>:</span>]</span>)</span>&nbsp;if&nbsp;<span id="ast-139">(<span id="ast-140"><span id="ast-141" class="other_trans">set</span>(<span id="ast-142"><span id="ast-143"><span id="ast-144">splitter</span>.split</span>(<span id="ast-145">gt</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-147" class="other_trans">parents</span>)</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-149">(<span id="ast-150">model</span><span id="ast-151" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-152">'mendel_violations'</span>)</span>:<span id="ast-153"><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-155">mom</span>,&nbsp;<span id="ast-156">dad</span>)</span>&nbsp;=&nbsp;<span id="ast-157">(<span id="ast-158"><span id="ast-159">set</span>(<span id="ast-160"><span id="ast-161"><span id="ast-162">splitter</span>.split</span>(<span id="ast-163"><span id="ast-164">gts</span>[<span id="ast-165"><span id="ast-166">0</span></span>]</span>)</span>)</span>,&nbsp;<span id="ast-167"><span id="ast-168">set</span>(<span id="ast-169"><span id="ast-170"><span id="ast-171">splitter</span>.split</span>(<span id="ast-172"><span id="ast-173" class="other_trans">gts</span>[<span id="ast-174"><span id="ast-175">1</span></span>]</span>)</span>)</span>)</span></span><span id="ast-176"><span id="ast-177" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>samps</span>&nbsp;=&nbsp;<span id="ast-178"><span id="ast-179"><span id="ast-180">self</span>.get_samples</span>(<span id="ast-181" class="other_trans">gts</span>,&nbsp;<span id="ast-182" class="other_trans">lbls</span>,&nbsp;model=<span id="ast-184">'de_novo'</span>)</span></span><span id="ast-185"><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>samps</span>&nbsp;+=&nbsp;<span id="ast-188">[<span id="ast-189"><span id="ast-190"><span id="ast-191"><span id="ast-192" class="other_trans">l</span>.split</span>(<span id="ast-193">'('</span>,&nbsp;<span id="ast-194">1</span>)</span>[<span id="ast-195"><span id="ast-196">0</span></span>]</span><span id="ast-197">&nbsp;for&nbsp;<span id="ast-198">(<span id="ast-199" class="other_trans">gt</span>,&nbsp;<span id="ast-200" class="other_trans">l</span>)</span>&nbsp;in&nbsp;<span id="ast-201"><span id="ast-202"><span id="ast-203">it</span>.izip</span>(<span id="ast-204"><span id="ast-205" class="other_trans">gts</span>[<span id="ast-206"><span id="ast-207">2</span>:</span>]</span>,&nbsp;<span id="ast-208"><span id="ast-209">lbls</span>[<span id="ast-210"><span id="ast-211">2</span>:</span>]</span>)</span>&nbsp;if&nbsp;<span id="ast-212">(<span id="ast-213">not</span>&nbsp;<span id="ast-214">(<span id="ast-216">(<span id="ast-217"><span id="ast-218">set</span>(<span id="ast-219"><span id="ast-220"><span id="ast-221" class="incorrect_node">splitter&nbsp;&rarr;&nbsp;l&nbsp;</span>.split</span>(<span id="ast-222" class="other_trans">gt</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-224" class="other_trans">mom</span>)</span>&nbsp;and&nbsp;<span id="ast-225">(<span id="ast-226"><span id="ast-227">set</span>(<span id="ast-228"><span id="ast-229"><span id="ast-230" class="other_trans">splitter</span>.split</span>(<span id="ast-231" class="other_trans">gt</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-233">dad</span>)</span>)</span>)</span></span>]</span></span><span id="ast-234"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-235" class="other_trans">samps</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;decode(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">output</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mu</span>&nbsp;=&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>.channels</span>&nbsp;-&nbsp;<span id="ast-11">1</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>y</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">tf</span>.cast</span>(<span id="ast-17" class="other_trans">output</span>,&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">tf</span>.float32</span>)</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>y</span>&nbsp;=&nbsp;<span id="ast-22">(<span id="ast-23">(<span id="ast-24">2</span>&nbsp;*&nbsp;<span id="ast-26">(<span id="ast-27" class="correct_node">output&nbsp;&rarr;&nbsp;y&nbsp;</span>&nbsp;/&nbsp;<span id="ast-29" class="other_trans">mu</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-31">1</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>x</span>&nbsp;=&nbsp;<span id="ast-34">(<span id="ast-35">(<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">tf</span>.sign</span>(<span id="ast-39" class="other_trans">y</span>)</span>&nbsp;*&nbsp;<span id="ast-41">(<span id="ast-42">1</span>&nbsp;/&nbsp;<span id="ast-44" class="other_trans">mu</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-46">(<span id="ast-47">(<span id="ast-48">(<span id="ast-49">1</span>&nbsp;+&nbsp;<span id="ast-51" class="other_trans">mu</span>)</span>&nbsp;**&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">abs</span>(<span id="ast-55" class="other_trans">y</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-57">1</span>)</span>)</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-59" class="other_trans">x</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;setUp(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>shortest_txt</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">os</span>.path</span>.dirname</span>(<span id="ast-14" class="other_trans">__file__</span>)</span>,&nbsp;<span id="ast-15">'test_shortest.txt'</span>)</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>shortest_fst</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">os</span>.path</span>.dirname</span>(<span id="ast-26" class="other_trans">__file__</span>)</span>,&nbsp;<span id="ast-27">'test_shortest.fst'</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31">not</span>&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-36" class="other_trans">shortest_fst</span>)</span>)</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>call</span>(<span id="ast-40">[<span id="ast-41">'fstcompile'</span>,&nbsp;<span id="ast-42" class="other_trans">shortest_txt</span>,&nbsp;<span id="ast-43" class="correct_node">shortest_txt&nbsp;&rarr;&nbsp;shortest_fst&nbsp;</span>]</span>)</span></span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-45" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-46" class="other_trans">e</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-48">'Failed&nbsp;to&nbsp;generate&nbsp;testing&nbsp;fst'</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-50" class="other_trans">e</span></span></span></span><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.s</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">fst</span>.read_std</span>(<span id="ast-57" class="other_trans">shortest_fst</span>)</span></span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.s_result</span>&nbsp;=&nbsp;<span id="ast-61">[<span id="ast-62">(<span id="ast-63">110.400000013</span>,&nbsp;<span id="ast-64">[<span id="ast-65">1</span>,&nbsp;<span id="ast-66">3</span>,&nbsp;<span id="ast-67">4</span>]</span>)</span>,&nbsp;<span id="ast-68">(<span id="ast-69">110.600000009</span>,&nbsp;<span id="ast-70">[<span id="ast-71">2</span>,&nbsp;<span id="ast-72">3</span>,&nbsp;<span id="ast-73">4</span>]</span>)</span>,&nbsp;<span id="ast-74">(<span id="ast-75">1000.2</span>,&nbsp;<span id="ast-76">[<span id="ast-77">2</span>]</span>)</span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;continuousLoop(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method&nbsp;which&nbsp;never&nbsp;terminates&nbsp;(until&nbsp;the&nbsp;process&nbsp;is&nbsp;killed).&nbsp;It&nbsp;runs&nbsp;every&nbsp;x&nbsp;second&nbsp;through&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checks\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i3</span>&nbsp;=&nbsp;<span id="ast-8">0</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i4</span>&nbsp;=&nbsp;<span id="ast-11">0</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-13">True</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>startTime</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">time</span>.time</span>()</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._ctlr</span>.ctlr_login</span>()</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.updateStationList</span>()</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>._config</span>.getEnableMacAuth</span>()</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.doMacAuth</span>()</span></span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42">self</span>._config</span>.getEnablePoorSignalReconnect</span>()</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.doPoorSignalReconnect</span>()</span></span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48">(<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53">self</span>._config</span>.getEnableSsidOnOffSchedule</span>()</span>&nbsp;and&nbsp;<span id="ast-54">(<span id="ast-55" class="other_trans">i3</span><span id="ast-56" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-57">11</span>)</span>)</span>:<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.doSsidOnOffSchedule</span>()</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i3</span>&nbsp;=&nbsp;<span id="ast-64">0</span></span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i3</span>&nbsp;=&nbsp;<span id="ast-67">(<span id="ast-68">i3</span>&nbsp;+&nbsp;<span id="ast-70">1</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77">self</span>._config</span>.getEnablePeriodicReboot</span>()</span>&nbsp;and&nbsp;<span id="ast-78">(<span id="ast-79" class="incorrect_node">i4&nbsp;&rarr;&nbsp;i3&nbsp;</span><span id="ast-80" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-81">11</span>)</span>)</span>:<span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.doPeriodicReboot</span>()</span></span><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i4</span>&nbsp;=&nbsp;<span id="ast-88">0</span></span></span><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i4</span>&nbsp;=&nbsp;<span id="ast-91">(<span id="ast-92" class="other_trans">i4</span>&nbsp;+&nbsp;<span id="ast-94">1</span>)</span></span><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sleepTime</span>&nbsp;=&nbsp;<span id="ast-97">(<span id="ast-98">(<span id="ast-99"><span id="ast-100">self</span>.interval</span>&nbsp;+&nbsp;<span id="ast-102">1</span>)</span>&nbsp;-&nbsp;<span id="ast-104">(<span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-109" class="other_trans">startTime</span>)</span>)</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-111">(<span id="ast-112">sleepTime</span><span id="ast-113" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-114">0</span>)</span>:<span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-119">(<span id="ast-120">'System&nbsp;is&nbsp;too&nbsp;slow&nbsp;for&nbsp;%d&nbsp;sec&nbsp;interval&nbsp;by&nbsp;%d&nbsp;seconds'</span>&nbsp;%&nbsp;<span id="ast-122">(<span id="ast-123" class="ref_node">interval&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-124"><span id="ast-125" class="other_trans">abs</span>(<span id="ast-126"><span id="ast-127">int</span>(<span id="ast-128" class="other_trans">sleepTime</span>)</span>)</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-129"><span id="ast-130"><span id="ast-131"><span id="ast-132" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-133" class="other_trans">sleepTime</span>)</span></span></span><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-135">Exception</span>&nbsp;as&nbsp;<span id="ast-136" class="other_trans">e</span>:<span id="ast-137"><span id="ast-138"><span id="ast-139" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sendMail</span>(<span id="ast-140">(<span id="ast-141" class="other_trans">errorMessageText</span>&nbsp;%&nbsp;<span id="ast-143">{<span id="ast-144">'error'</span>:&nbsp;<span id="ast-145"><span id="ast-146" class="other_trans">logError</span>(<span id="ast-147" class="other_trans">e</span>)</span>}</span>)</span>,&nbsp;<span id="ast-148"><span id="ast-149">self</span>._config</span>)</span></span><span id="ast-150"><span id="ast-151" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sleepTime</span>&nbsp;=&nbsp;<span id="ast-152">(<span id="ast-153">(<span id="ast-154">(<span id="ast-155"><span id="ast-156">self</span>.interval</span>&nbsp;*&nbsp;<span id="ast-158">10</span>)</span>&nbsp;+&nbsp;<span id="ast-160">1</span>)</span>&nbsp;-&nbsp;<span id="ast-162">(<span id="ast-163"><span id="ast-164"><span id="ast-165" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-167" class="other_trans">startTime</span>)</span>)</span></span><span id="ast-168"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-169">(<span id="ast-170" class="other_trans">sleepTime</span><span id="ast-171" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-172">0</span>)</span>:<span id="ast-173"><span id="ast-174"><span id="ast-175"><span id="ast-176" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-177">(<span id="ast-178">'System&nbsp;is&nbsp;too&nbsp;slow&nbsp;for&nbsp;%d&nbsp;sec&nbsp;interval&nbsp;by&nbsp;%d&nbsp;seconds'</span>&nbsp;%&nbsp;<span id="ast-180">(<span id="ast-181">(<span id="ast-182">10</span>&nbsp;*&nbsp;<span id="ast-184">interval</span>)</span>,&nbsp;<span id="ast-185"><span id="ast-186">abs</span>(<span id="ast-187"><span id="ast-188" class="other_trans">int</span>(<span id="ast-189" class="other_trans">sleepTime</span>)</span>)</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-190"><span id="ast-191"><span id="ast-192"><span id="ast-193"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-194" class="other_trans">sleepTime</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;connect_floatingip(<span id="ast-2"><span id="ast-3" class="other_trans">nova_client</span>,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>server_id</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">ctx</span>.runtime_properties</span>[<span id="ast-9"><span id="ast-10">OPENSTACK_ID_PROPERTY</span></span>]</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>floating_ip_id</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">ctx</span>.related</span>.runtime_properties</span>[<span id="ast-17"><span id="ast-18" class="other_trans">OPENSTACK_ID_PROPERTY</span></span>]</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>floating_ip_address</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">ctx</span>.related</span>.runtime_properties</span>[<span id="ast-25"><span id="ast-26" class="other_trans">IP_ADDRESS_PROPERTY</span></span>]</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28"><span id="ast-29">is_external_relationship</span>(<span id="ast-30">ctx</span>)</span>:<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ctx</span>.logger</span>.info</span>(<span id="ast-36">'Validating&nbsp;external&nbsp;floatingip&nbsp;and&nbsp;server&nbsp;are&nbsp;associated'</span>)</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nc</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">_neutron_client</span>()</span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>port_id</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">nc</span>.show_floatingip</span>(<span id="ast-48" class="other_trans">floating_ip_id</span>)</span>[<span id="ast-49"><span id="ast-50">'floatingip'</span></span>]</span>[<span id="ast-51"><span id="ast-52">'port_id'</span></span>]</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54">(<span id="ast-56" class="other_trans">port_id</span>&nbsp;and&nbsp;<span id="ast-57">(<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans">nc</span>.show_port</span>(<span id="ast-63" class="other_trans">port_id</span>)</span>[<span id="ast-64"><span id="ast-65">'port'</span></span>]</span>[<span id="ast-66"><span id="ast-67">'device_id'</span></span>]</span><span id="ast-68" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-69" class="other_trans">server_id</span>)</span>)</span>:<span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-72"><span id="ast-73" class="other_trans">NonRecoverableError</span>(<span id="ast-74"><span id="ast-75"><span id="ast-76">'Expected&nbsp;external&nbsp;resources&nbsp;server&nbsp;{0}&nbsp;and&nbsp;floating-ip&nbsp;{1}&nbsp;to&nbsp;be&nbsp;connected'</span>.format</span>(<span id="ast-77" class="other_trans">server_id</span>,&nbsp;<span id="ast-78" class="other_trans">floating_ip_id</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;generate_tag(<span id="ast-2"><span id="ast-3" class="other_trans">tag</span>,&nbsp;<span id="ast-4" class="other_trans">content</span>,&nbsp;<span id="ast-5">attributes</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Generate&nbsp;a&nbsp;complete&nbsp;html&nbsp;tag&nbsp;using&nbsp;the&nbsp;ElementTree&nbsp;module.&nbsp;&nbsp;tag&nbsp;and\\u000a&nbsp;&nbsp;&nbsp;&nbsp;content&nbsp;are&nbsp;strings,&nbsp;the&nbsp;attributes&nbsp;argument&nbsp;is&nbsp;a&nbsp;dictionary.&nbsp;&nbsp;As\\u000a&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;convenience,&nbsp;if&nbsp;the&nbsp;content&nbsp;is&nbsp;'&nbsp;/',&nbsp;a&nbsp;self-closing&nbsp;tag&nbsp;is&nbsp;generated."</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">six</span>.text_type</span>(<span id="ast-14" class="other_trans">content</span>)</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>element</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">ElementTree</span>.Element</span>(<span id="ast-20" class="other_trans">tag</span>,&nbsp;attrib=<span id="ast-22" class="other_trans">attributes</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>enc</span>&nbsp;=&nbsp;<span id="ast-25">'unicode'</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">six</span>.PY2</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>enc</span>&nbsp;=&nbsp;<span id="ast-31">'UTF-8'</span></span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>element_tag</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">ElementTree</span>.tostringlist</span>(<span id="ast-38" class="other_trans">element</span>,&nbsp;encoding=<span id="ast-40" class="other_trans">enc</span>,&nbsp;method=<span id="ast-42">'html'</span>)</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>element_tag</span>.insert</span>(<span id="ast-47">(<span id="ast-48"><span id="ast-49" class="other_trans">len</span>(<span id="ast-50" class="other_trans">element_tag</span>)</span>&nbsp;-&nbsp;<span id="ast-52">1</span>)</span>,&nbsp;<span id="ast-53" class="other_trans">content</span>)</span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>element_text</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58">''</span>.join</span>(<span id="ast-59" class="other_trans">element_tag</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-61" class="other_trans">AttributeError</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>element_tag</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66">ElementTree</span>.tostring</span>(<span id="ast-67">element</span>,&nbsp;encoding=<span id="ast-69">enc</span>)</span></span><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>element_text</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans">re</span>.sub</span>(<span id="ast-75">"&lt;\\\\?xml&nbsp;version='1.0'&nbsp;encoding='UTF-8'\\\\?&gt;\\\\n"</span>,&nbsp;<span id="ast-76">''</span>,&nbsp;<span id="ast-77" class="other_trans">element_tag</span>)</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-79">(<span id="ast-80">content</span><span id="ast-81" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans">six</span>.text_type</span>(<span id="ast-85">'&nbsp;/'</span>)</span>)</span>:<span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>element_text</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90" class="ref_node">element_tag&nbsp;&rarr;&nbsp;element_text&nbsp;</span>.rstrip</span>(<span id="ast-91">'&nbsp;/&gt;'</span>)</span></span><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>element_text</span>&nbsp;=&nbsp;<span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98">six</span>.text_type</span>(<span id="ast-99">'{0}&gt;{1}&lt;/{2}&gt;'</span>)</span>.format</span>(<span id="ast-100"><span id="ast-101"><span id="ast-102">six</span>.text_type</span>(<span id="ast-103" class="other_trans">element_text</span>)</span>,&nbsp;<span id="ast-104" class="other_trans">content</span>,&nbsp;<span id="ast-105">tag</span>)</span></span></span></span></span><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-107" class="other_trans">element_text</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;start(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pvc_data</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">get_pvc_info</span>(<span id="ast-8"><span id="ast-9">self</span>.pvc_name</span>)</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">pvc_data</span><span id="ast-13" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-14" class="other_trans">None</span>)</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pvc_manifest</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.get_pvc_manifest</span>()</span></span><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.httpclient</span>.fetch</span>(<span id="ast-26"><span id="ast-27"><span id="ast-28">self</span>.request</span>(url=<span id="ast-30"><span id="ast-31" class="other_trans">k8s_url</span>(<span id="ast-32"><span id="ast-33">self</span>.namespace</span>,&nbsp;<span id="ast-34">'persistentvolumeclaims'</span>)</span>,&nbsp;body=<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">json</span>.dumps</span>(<span id="ast-39" class="other_trans">pvc_manifest</span>)</span>,&nbsp;method=<span id="ast-41">'POST'</span>,&nbsp;headers=<span id="ast-43">{<span id="ast-44">'Content-Type'</span>:&nbsp;<span id="ast-45">'application/json'</span>}</span>)</span>)</span></span></span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pod_manifest</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>.get_pod_manifest</span>()</span></span><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56">self</span>.httpclient</span>.fetch</span>(<span id="ast-57"><span id="ast-58"><span id="ast-59">self</span>.request</span>(url=<span id="ast-61"><span id="ast-62" class="other_trans">k8s_url</span>(<span id="ast-63"><span id="ast-64">self</span>.namespace</span>,&nbsp;<span id="ast-65">'pods'</span>)</span>,&nbsp;body=<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">json</span>.dumps</span>(<span id="ast-70" class="other_trans">pod_manifest</span>)</span>,&nbsp;method=<span id="ast-72">'POST'</span>,&nbsp;headers=<span id="ast-74">{<span id="ast-75">'Content-Type'</span>:&nbsp;<span id="ast-76">'application/json'</span>}</span>)</span>)</span></span></span><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-78">True</span>:<span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-81">yield&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84">self</span>.get_pod_info</span>(<span id="ast-85"><span id="ast-86">self</span>.pod_name</span>)</span></span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-88">(<span id="ast-90">(<span id="ast-91" class="other_trans">data</span><span id="ast-92" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-93" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-94"><span id="ast-95"><span id="ast-96">self</span>.is_pod_running</span>(<span id="ast-97" class="other_trans">data</span>)</span>)</span>:<span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103" class="other_trans">gen</span>.sleep</span>(<span id="ast-104">1</span>)</span></span></span></span><span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.user</span>.server</span>.ip</span>&nbsp;=&nbsp;<span id="ast-110"><span id="ast-111"><span id="ast-112" class="other_trans">data</span>[<span id="ast-113"><span id="ast-114">'status'</span></span>]</span>[<span id="ast-115"><span id="ast-116">'podIP'</span></span>]</span></span><span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.user</span>.server</span>.port</span>&nbsp;=&nbsp;<span id="ast-122">8888</span></span><span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126"><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.db</span>.commit</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pep8</span>.process_options</span>()</span></span><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>&nbsp;=&nbsp;<span id="ast-9">0</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">sys</span>.argv</span>[<span id="ast-15"><span id="ast-16">1</span>:</span>]</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18" class="other_trans">args</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-20" class="other_trans">arg</span>&nbsp;in&nbsp;<span id="ast-21" class="other_trans">args</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">os</span>.path</span>.isdir</span>(<span id="ast-27" class="other_trans">arg</span>)</span>:<span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">dirpath</span>,&nbsp;<span id="ast-31">dirnames</span>,&nbsp;<span id="ast-32" class="other_trans">filenames</span>)</span>&nbsp;in&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35">os</span>.walk</span>(<span id="ast-36" class="other_trans">arg</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-38" class="other_trans">filename</span>&nbsp;in&nbsp;<span id="ast-39" class="other_trans">filenames</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42">not</span>&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">filename</span>.endswith</span>(<span id="ast-46">'.py'</span>)</span>)</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fullpath</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53">os</span>.path</span>.join</span>(<span id="ast-54" class="other_trans">dirpath</span>,&nbsp;<span id="ast-55" class="other_trans">filename</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">skip_file</span>(<span id="ast-59" class="other_trans">fullpath</span>)</span>:<span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>&nbsp;+=&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">checkPath</span>(<span id="ast-66" class="other_trans">fullpath</span>)</span></span><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>&nbsp;+=&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">pep8</span>.input_file</span>(<span id="ast-73" class="other_trans">fullpath</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-75"><span id="ast-76">skip_file</span>(<span id="ast-77" class="location_node">filename&nbsp;&rarr;&nbsp;arg,&nbsp;pred:&nbsp;fullpath&nbsp;</span>)</span>:<span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-79"><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>&nbsp;+=&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">checkPath</span>(<span id="ast-84" class="other_trans">arg</span>)</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>&nbsp;+=&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90">pep8</span>.input_file</span>(<span id="ast-91" class="other_trans">arg</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;migrate_secgroup(<span id="ast-2"><span id="ast-3" class="other_trans">context</span>,&nbsp;<span id="ast-4" class="other_trans">secgroup_id</span>,&nbsp;<span id="ast-5" class="other_trans">tenant_id</span>,&nbsp;<span id="ast-6" class="other_trans">user_id</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>secgroup_binding</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">'secgroup-{}'</span>.format</span>(<span id="ast-12">secgroup_id</span>)</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>secgroup_retrieve</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">'{}-retrieve'</span>.format</span>(<span id="ast-18" class="other_trans">secgroup_binding</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>secgroup_ensure</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">'{}-ensure'</span>.format</span>(<span id="ast-24" class="other_trans">secgroup_binding</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tenant_binding</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">'tenant-{}'</span>.format</span>(<span id="ast-30" class="other_trans">tenant_id</span>)</span></span><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tenant_ensure</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35">'{}-ensure'</span>.format</span>(<span id="ast-36" class="other_trans">tenant_binding</span>)</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user_binding</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41">'user-{}'</span>.format</span>(<span id="ast-42" class="other_trans">user_id</span>)</span></span><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user_ensure</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">'{}-ensure'</span>.format</span>(<span id="ast-48" class="other_trans">user_binding</span>)</span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">linear_flow</span>.Flow</span>(<span id="ast-54"><span id="ast-55"><span id="ast-56">'migrate-secgroup-{}'</span>.format</span>(<span id="ast-57">secgroup_id</span>)</span>)</span></span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>.add</span>(<span id="ast-62"><span id="ast-63">RetrieveSecGroup</span>(<span id="ast-64"><span id="ast-65">context</span>.src_cloud</span>,&nbsp;name=<span id="ast-67" class="ref_node">secgroup_retrieve&nbsp;&rarr;&nbsp;secgroup_binding&nbsp;</span>,&nbsp;provides=<span id="ast-69" class="other_trans">secgroup_binding</span>,&nbsp;rebind=<span id="ast-71">[<span id="ast-72" class="other_trans">secgroup_retrieve</span>,&nbsp;<span id="ast-73" class="other_trans">tenant_binding</span>,&nbsp;<span id="ast-74">user_binding</span>]</span>)</span>)</span></span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>.add</span>(<span id="ast-79"><span id="ast-80" class="other_trans">EnsureSecGroup</span>(<span id="ast-81"><span id="ast-82" class="other_trans">context</span>.dst_cloud</span>,&nbsp;name=<span id="ast-84">secgroup_ensure</span>,&nbsp;provides=<span id="ast-86" class="other_trans">secgroup_ensure</span>,&nbsp;rebind=<span id="ast-88">[<span id="ast-89" class="other_trans">secgroup_binding</span>,&nbsp;<span id="ast-90" class="other_trans">tenant_ensure</span>,&nbsp;<span id="ast-91" class="other_trans">user_ensure</span>]</span>)</span>)</span></span><span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>.store</span>[<span id="ast-96"><span id="ast-97">secgroup_retrieve</span></span>]</span>&nbsp;=&nbsp;<span id="ast-98" class="incorrect_node">secgroup_id&nbsp;&rarr;&nbsp;flow&nbsp;</span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-100" class="other_trans">flow</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;val_addr(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">buf</span>,&nbsp;<span id="ast-5" class="other_trans">af</span>,&nbsp;*args</span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8" class="other_trans">af</span><span id="ast-9" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-10"><span id="ast-11" class="other_trans">AFI_T</span>[<span id="ast-12"><span id="ast-13">'IPv4'</span></span>]</span>)</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>m</span>&nbsp;=&nbsp;<span id="ast-16">4</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_af</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">socket</span>.AF_INET</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-22">(<span id="ast-23" class="other_trans">af</span><span id="ast-24" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-25"><span id="ast-26" class="other_trans">AFI_T</span>[<span id="ast-27"><span id="ast-28">'IPv6'</span></span>]</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>m</span>&nbsp;=&nbsp;<span id="ast-31">16</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_af</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">socket</span>.AF_INET6</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>n</span>&nbsp;=&nbsp;<span id="ast-38">-1</span></span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>n</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-48" class="other_trans">m</span>&nbsp;if&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44" class="other_trans">len</span>(<span id="ast-45">args</span>)</span><span id="ast-46" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-47">0</span>)</span>&nbsp;else&nbsp;<span id="ast-49">(<span id="ast-50">(<span id="ast-51"><span id="ast-52" class="other_trans">args</span>[<span id="ast-53"><span id="ast-54">0</span></span>]</span>&nbsp;+&nbsp;<span id="ast-56">7</span>)</span>&nbsp;//&nbsp;<span id="ast-58">8</span>)</span></span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-62">(<span id="ast-63" class="other_trans">n</span><span id="ast-64" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-65">0</span>)</span>&nbsp;or&nbsp;<span id="ast-66">(<span id="ast-67">(<span id="ast-68"><span id="ast-69" class="other_trans">len</span>(<span id="ast-70" class="other_trans">buf</span>)</span>&nbsp;-&nbsp;<span id="ast-72"><span id="ast-73">self</span>.p</span>)</span><span id="ast-74" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-75" class="other_trans">n</span>)</span>)</span>:<span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-77" class="other_trans">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-9" class="other_trans">Context</span>,&nbsp;<span id="ast-10">self</span>)</span>.__init__</span>()</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.include_dirs</span>&nbsp;=&nbsp;<span id="ast-14">[]</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ok</span>&nbsp;=&nbsp;<span id="ast-17">True</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sdks</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">sh</span>.xcodebuild</span>(<span id="ast-25">'-showsdks'</span>)</span>.splitlines</span>()</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iphoneos</span>&nbsp;=&nbsp;<span id="ast-28">[<span id="ast-29" class="other_trans">x</span><span id="ast-30">&nbsp;for&nbsp;<span id="ast-31" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-32" class="other_trans">sdks</span>&nbsp;if&nbsp;<span id="ast-33">(<span id="ast-34">'iphoneos'</span><span id="ast-35">&nbsp;in&nbsp;</span><span id="ast-36" class="other_trans">x</span>)</span></span>]</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39">not</span>&nbsp;<span id="ast-40" class="other_trans">iphoneos</span>)</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-42">'No&nbsp;iphone&nbsp;SDK&nbsp;installed'</span></span><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ok</span>&nbsp;=&nbsp;<span id="ast-45">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>iphoneos</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">iphoneos</span>[<span id="ast-55"><span id="ast-56">0</span></span>]</span>.split</span>()</span>[<span id="ast-57"><span id="ast-58">-1</span></span>]</span>.replace</span>(<span id="ast-59">'iphoneos'</span>,&nbsp;<span id="ast-60">''</span>)</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sdkver</span>&nbsp;=&nbsp;<span id="ast-64" class="other_trans">iphoneos</span></span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iphonesim</span>&nbsp;=&nbsp;<span id="ast-67">[<span id="ast-68" class="other_trans">x</span><span id="ast-69">&nbsp;for&nbsp;<span id="ast-70" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-71" class="other_trans">sdks</span>&nbsp;if&nbsp;<span id="ast-72">(<span id="ast-73">'iphonesimulator'</span><span id="ast-74">&nbsp;in&nbsp;</span><span id="ast-75" class="other_trans">x</span>)</span></span>]</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77">(<span id="ast-78">not</span>&nbsp;<span id="ast-79" class="correct_node">iphoneos&nbsp;&rarr;&nbsp;iphonesim&nbsp;</span>)</span>:<span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ok</span>&nbsp;=&nbsp;<span id="ast-82">False</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-84">'Error:&nbsp;No&nbsp;iphonesimulator&nbsp;SDK&nbsp;installed'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>iphonesim</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans">iphonesim</span>[<span id="ast-94"><span id="ast-95">0</span></span>]</span>.split</span>()</span>[<span id="ast-96"><span id="ast-97">-1</span></span>]</span>.replace</span>(<span id="ast-98">'iphonesimulator'</span>,&nbsp;<span id="ast-99">''</span>)</span></span><span id="ast-100"><span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sdksimver</span>&nbsp;=&nbsp;<span id="ast-103" class="other_trans">iphonesim</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;synchronise_update_required_reverse(<span id="ast-2"></span>):<span id="ast-3"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-4">'\\u000aSynchronising&nbsp;back&nbsp;updates...'</span></span><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-6">(<span id="ast-7" class="other_trans">appid</span>,&nbsp;<span id="ast-8" class="other_trans">app</span>)</span>&nbsp;in&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">update_required_library</span>.iteritems</span>()</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15" class="other_trans">app</span>.state_flags</span><span id="ast-16" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-17">4</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">appid</span><span id="ast-22">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-23" class="other_trans">apps</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27">'\\u000a&nbsp;&nbsp;App&nbsp;ID&nbsp;{}&nbsp;({})&nbsp;not&nbsp;found&nbsp;in&nbsp;any&nbsp;main&nbsp;library,&nbsp;not&nbsp;synchronising!'</span>.format</span>(<span id="ast-28" class="other_trans">appid</span>,&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">app</span>.name</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34"><span id="ast-35" class="other_trans">len</span>(<span id="ast-36"><span id="ast-37" class="other_trans">apps</span>[<span id="ast-38"><span id="ast-39" class="other_trans">appid</span></span>]</span>)</span><span id="ast-40" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-41">1</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45">'\\u000a&nbsp;&nbsp;App&nbsp;ID&nbsp;{}&nbsp;({})&nbsp;in&nbsp;multiple&nbsp;main&nbsp;libraries,&nbsp;not&nbsp;synchronising!'</span>.format</span>(<span id="ast-46" class="other_trans">appid</span>,&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">app</span>.name</span>)</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>installed</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">apps</span>[<span id="ast-55"><span id="ast-56" class="other_trans">appid</span></span>]</span>[<span id="ast-57"><span id="ast-58">0</span></span>]</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-61"><span id="ast-62" class="other_trans">installed</span>.status</span><span id="ast-63" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-64"><span id="ast-65" class="other_trans">app</span>.status</span>)</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-68">(<span id="ast-69"><span id="ast-70" class="other_trans">installed</span>.last_updated</span><span id="ast-71" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-72"><span id="ast-73" class="other_trans">app</span>.last_updated</span>)</span>:<span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77">'\\u000a&nbsp;&nbsp;Local&nbsp;install&nbsp;of&nbsp;app&nbsp;{}&nbsp;({})&nbsp;is&nbsp;more&nbsp;recent,&nbsp;not&nbsp;synchronising!'</span>.format</span>(<span id="ast-78" class="other_trans">appid</span>,&nbsp;<span id="ast-79"><span id="ast-80" class="other_trans">app</span>.name</span>)</span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;typetest(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6" class="other_trans">ImmutableList</span>()</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>v</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">ImmutableVector</span>()</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">ImmutableDict</span>()</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">l</span><span id="ast-18" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-19" class="other_trans">None</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">v</span><span id="ast-23" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-24">3</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-26">(<span id="ast-27" class="other_trans">d</span><span id="ast-28" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-29">'a'</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">l</span><span id="ast-33" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-34" class="other_trans">v</span>)</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">d</span><span id="ast-38" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-39" class="other_trans">v</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">d</span><span id="ast-43" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-44" class="incorrect_node">l&nbsp;&rarr;&nbsp;v&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_cache_support(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span>,&nbsp;<span id="ast-5" class="other_trans">timeout</span>,&nbsp;<span id="ast-6" class="other_trans">caller</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Helper&nbsp;callback.'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.environment</span>.fragment_cache_prefix</span>&nbsp;+&nbsp;<span id="ast-16" class="other_trans">name</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rv</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.environment</span>.fragment_cache</span>.get</span>(<span id="ast-24" class="other_trans">key</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-27" class="other_trans">rv</span><span id="ast-28" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-29" class="other_trans">None</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-31" class="other_trans">rv</span></span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rv</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">caller</span>()</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.environment</span>.fragment_cache</span>.add</span>(<span id="ast-42" class="other_trans">key</span>,&nbsp;<span id="ast-43" class="other_trans">rv</span>,&nbsp;<span id="ast-44" class="other_trans">timeout</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46" class="other_trans">rv</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;handleClipping(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">step</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>is_left_support</span>&nbsp;=&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9" class="other_trans">step</span>.leg</span><span id="ast-10" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-11"><span id="ast-12" class="incorrect_node">StepTarget&nbsp;&rarr;&nbsp;self.&nbsp;</span>.left</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>unclipped_step</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">step</span>.pose</span>.x</span>,&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">step</span>.pose</span>.y</span>,&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">step</span>.pose</span>.theta</span>)</span></span><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">step</span>.pose</span>.x</span>,&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">step</span>.pose</span>.y</span>,&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">step</span>.pose</span>.theta</span>)</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">clip_footstep_tuple</span>(<span id="ast-38" class="other_trans">unclipped_step</span>,&nbsp;<span id="ast-39" class="other_trans">is_left_support</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41" class="other_trans">step</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_upload_missing_files(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">container_name</span>,&nbsp;<span id="ast-5" class="other_trans">swift_client</span>,&nbsp;<span id="ast-6" class="other_trans">files_dict</span>,&nbsp;<span id="ast-7" class="other_trans">tht_root</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Find&nbsp;the&nbsp;files&nbsp;referenced&nbsp;in&nbsp;custom&nbsp;environments&nbsp;and&nbsp;upload&nbsp;them\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Heat&nbsp;environments&nbsp;can&nbsp;be&nbsp;passed&nbsp;to&nbsp;be&nbsp;included&nbsp;in&nbsp;the&nbsp;deployment,&nbsp;these\\u000a&nbsp;&nbsp;&nbsp;&nbsp;files&nbsp;can&nbsp;include&nbsp;references&nbsp;to&nbsp;other&nbsp;files&nbsp;anywhere&nbsp;on&nbsp;the&nbsp;local\\u000a&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;system.&nbsp;These&nbsp;need&nbsp;to&nbsp;be&nbsp;discovered&nbsp;and&nbsp;uploaded&nbsp;to&nbsp;Swift.&nbsp;When\\u000a&nbsp;&nbsp;&nbsp;&nbsp;they&nbsp;have&nbsp;been&nbsp;uploaded&nbsp;to&nbsp;Swift&nbsp;the&nbsp;path&nbsp;to&nbsp;them&nbsp;will&nbsp;be&nbsp;different,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;new&nbsp;paths&nbsp;are&nbsp;store&nbsp;din&nbsp;the&nbsp;file_relocation&nbsp;dict,&nbsp;which&nbsp;is&nbsp;returned\\u000a&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;used&nbsp;by&nbsp;_process_and_upload_environment&nbsp;which&nbsp;will&nbsp;merge&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;environment&nbsp;and&nbsp;update&nbsp;paths&nbsp;to&nbsp;the&nbsp;relative&nbsp;Swift&nbsp;path.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>file_relocation</span>&nbsp;=&nbsp;<span id="ast-12">{}</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>file_prefix</span>&nbsp;=&nbsp;<span id="ast-15">'file://'</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">fullpath</span>,&nbsp;<span id="ast-19" class="other_trans">contents</span>)</span>&nbsp;in&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">files_dict</span>.items</span>()</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25">not</span>&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">fullpath</span>.startswith</span>(<span id="ast-29" class="other_trans">file_prefix</span>)</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">fullpath</span>[<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">len</span>(<span id="ast-38" class="other_trans">file_prefix</span>)</span>:</span>]</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">path</span>.startswith</span>(<span id="ast-43" class="other_trans">tht_root</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50">os</span>.path</span>.basename</span>(<span id="ast-51" class="other_trans">path</span>)</span></span><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>checksum</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">hashlib</span>.md5</span>()</span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>checksum</span>.update</span>(<span id="ast-61" class="ref_node">filename&nbsp;&rarr;&nbsp;path&nbsp;</span>)</span></span><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>digest</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66">checksum</span>.hexdigest</span>()</span></span><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>swift_path</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71">'user-files/{}-{}'</span>.format</span>(<span id="ast-72" class="other_trans">digest</span>,&nbsp;<span id="ast-73">filename</span>)</span></span><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>swift_client</span>.put_object</span>(<span id="ast-78" class="other_trans">container_name</span>,&nbsp;<span id="ast-79" class="incorrect_node">swift_path&nbsp;&rarr;&nbsp;digest&nbsp;</span>,&nbsp;<span id="ast-80">contents</span>)</span></span><span id="ast-81"><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>file_relocation</span>[<span id="ast-84"><span id="ast-85">fullpath</span></span>]</span>&nbsp;=&nbsp;<span id="ast-86" class="other_trans">swift_path</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">connection</span>,&nbsp;<span id="ast-4">info</span>,&nbsp;<span id="ast-5">args</span>,&nbsp;<span id="ast-6" class="other_trans">world</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Decides&nbsp;heads&nbsp;or&nbsp;tails&nbsp;based&nbsp;on&nbsp;the&nbsp;coinchance&nbsp;variable.&nbsp;&nbsp;&nbsp;Adds&nbsp;or&nbsp;removes&nbsp;appropriate&nbsp;amount&nbsp;of&nbsp;money'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>money</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">shelve</span>.open</span>(<span id="ast-14">(<span id="ast-15">'money-%s.db'</span>&nbsp;%&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">world</span>.hostnicks</span>[<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">connection</span>.host</span></span>]</span>)</span>,&nbsp;writeback=<span id="ast-24">True</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">money</span>.has_key</span>(<span id="ast-29"><span id="ast-30" class="other_trans">info</span>[<span id="ast-31"><span id="ast-32">'sender'</span></span>]</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bet</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">int</span>(<span id="ast-37"><span id="ast-38" class="other_trans">args</span>[<span id="ast-39"><span id="ast-40">1</span></span>]</span>)</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-44">(<span id="ast-45">bet</span><span id="ast-46" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-47"><span id="ast-48"><span id="ast-49">money</span>[<span id="ast-50"><span id="ast-51"><span id="ast-52">info</span>[<span id="ast-53"><span id="ast-54">'sender'</span></span>]</span></span>]</span>[<span id="ast-55"><span id="ast-56">'money'</span></span>]</span>)</span>&nbsp;and&nbsp;<span id="ast-57">(<span id="ast-58" class="other_trans">bet</span><span id="ast-59" class="ref_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-60">1</span>)</span>)</span>:<span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>answer</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65">random</span>.choice</span>(<span id="ast-66"><span id="ast-67"><span id="ast-68">money</span>[<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">info</span>[<span id="ast-72"><span id="ast-73">'sender'</span></span>]</span></span>]</span>[<span id="ast-74"><span id="ast-75">'coinchance'</span></span>]</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77" class="other_trans">answer</span>:<span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>money</span>[<span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans">info</span>[<span id="ast-85"><span id="ast-86">'sender'</span></span>]</span></span>]</span>[<span id="ast-87"><span id="ast-88">'money'</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-90" class="incorrect_node">bet&nbsp;&rarr;&nbsp;answer&nbsp;</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>money</span>.sync</span>()</span></span><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>connection</span>.ircsend</span>(<span id="ast-99"><span id="ast-100" class="other_trans">info</span>[<span id="ast-101"><span id="ast-102">'channel'</span></span>]</span>,&nbsp;<span id="ast-103">(<span id="ast-104">'Congrats&nbsp;%s!&nbsp;&nbsp;You&nbsp;just&nbsp;won&nbsp;%s&nbsp;dollars!'</span>&nbsp;%&nbsp;<span id="ast-106">(<span id="ast-107"><span id="ast-108">info</span>[<span id="ast-109"><span id="ast-110">'sender'</span></span>]</span>,&nbsp;<span id="ast-111"><span id="ast-112">args</span>[<span id="ast-113"><span id="ast-114">1</span></span>]</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>money</span>[<span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans">info</span>[<span id="ast-122"><span id="ast-123">'sender'</span></span>]</span></span>]</span>[<span id="ast-124"><span id="ast-125">'money'</span></span>]</span>&nbsp;-=&nbsp;<span id="ast-127" class="other_trans">bet</span></span><span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>money</span>.sync</span>()</span></span><span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>connection</span>.ircsend</span>(<span id="ast-136"><span id="ast-137" class="other_trans">info</span>[<span id="ast-138"><span id="ast-139">'channel'</span></span>]</span>,&nbsp;<span id="ast-140">(<span id="ast-141">'Sorry&nbsp;%s!&nbsp;&nbsp;You&nbsp;just&nbsp;lost&nbsp;%s&nbsp;dollars!'</span>&nbsp;%&nbsp;<span id="ast-143">(<span id="ast-144"><span id="ast-145" class="other_trans">info</span>[<span id="ast-146"><span id="ast-147">'sender'</span></span>]</span>,&nbsp;<span id="ast-148"><span id="ast-149">args</span>[<span id="ast-150"><span id="ast-151">1</span></span>]</span>)</span>)</span>)</span></span></span><span id="ast-152"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-153">(<span id="ast-154"><span id="ast-155"><span id="ast-156">money</span>[<span id="ast-157"><span id="ast-158"><span id="ast-159">info</span>[<span id="ast-160"><span id="ast-161">'sender'</span></span>]</span></span>]</span>[<span id="ast-162"><span id="ast-163">'money'</span></span>]</span><span id="ast-164" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-165"><span id="ast-166"><span id="ast-167">money</span>[<span id="ast-168"><span id="ast-169"><span id="ast-170">info</span>[<span id="ast-171"><span id="ast-172">'sender'</span></span>]</span></span>]</span>[<span id="ast-173"><span id="ast-174">'maxmoney'</span></span>]</span>)</span>:<span id="ast-175"><span id="ast-176"><span id="ast-177"><span id="ast-178"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>money</span>[<span id="ast-179"><span id="ast-180"><span id="ast-181" class="other_trans">info</span>[<span id="ast-182"><span id="ast-183">'sender'</span></span>]</span></span>]</span>[<span id="ast-184"><span id="ast-185">'maxmoney'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-186"><span id="ast-187"><span id="ast-188">money</span>[<span id="ast-189"><span id="ast-190"><span id="ast-191" class="other_trans">info</span>[<span id="ast-192"><span id="ast-193">'sender'</span></span>]</span></span>]</span>[<span id="ast-194"><span id="ast-195">'money'</span></span>]</span></span><span id="ast-196"><span id="ast-197"><span id="ast-198"><span id="ast-199" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>money</span>.sync</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-200"><span id="ast-201"><span id="ast-202"><span id="ast-203" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>connection</span>.ircsend</span>(<span id="ast-204"><span id="ast-205" class="other_trans">info</span>[<span id="ast-206"><span id="ast-207">'channel'</span></span>]</span>,&nbsp;<span id="ast-208">(<span id="ast-209">"%s:&nbsp;You&nbsp;don't&nbsp;have&nbsp;enough&nbsp;money&nbsp;to&nbsp;do&nbsp;that!"</span>&nbsp;%&nbsp;<span id="ast-211"><span id="ast-212" class="other_trans">info</span>[<span id="ast-213"><span id="ast-214">'sender'</span></span>]</span>)</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-215"><span id="ast-216"><span id="ast-217"><span id="ast-218" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>connection</span>.ircsend</span>(<span id="ast-219"><span id="ast-220" class="other_trans">info</span>[<span id="ast-221"><span id="ast-222">'channel'</span></span>]</span>,&nbsp;<span id="ast-223">(<span id="ast-224">"%s:&nbsp;You&nbsp;have&nbsp;not&nbsp;set&nbsp;up&nbsp;a&nbsp;money&nbsp;account.&nbsp;&nbsp;If&nbsp;you&nbsp;aren't&nbsp;already,&nbsp;please&nbsp;register&nbsp;with&nbsp;me.&nbsp;&nbsp;Then,&nbsp;say&nbsp;moneyreset.&nbsp;&nbsp;After&nbsp;that&nbsp;you&nbsp;should&nbsp;be&nbsp;able&nbsp;to&nbsp;use&nbsp;this&nbsp;command."</span>&nbsp;%&nbsp;<span id="ast-226"><span id="ast-227" class="other_trans">info</span>[<span id="ast-228"><span id="ast-229">'sender'</span></span>]</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;document_query(<span id="ast-2"><span id="ast-3">args</span>,&nbsp;<span id="ast-4" class="other_trans">fields</span>,&nbsp;<span id="ast-6">collections</span>,&nbsp;<span id="ast-8" class="other_trans">lists</span>,&nbsp;<span id="ast-10">facets</span></span>):<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14">not</span>&nbsp;<span id="ast-15"><span id="ast-16">isinstance</span>(<span id="ast-17" class="other_trans">args</span>,&nbsp;<span id="ast-18">MultiDict</span>)</span>)</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22">MultiDict</span>(<span id="ast-23">args</span>)</span></span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>qstr</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">args</span>.get</span>(<span id="ast-31">'q'</span>,&nbsp;<span id="ast-32">''</span>)</span>.strip</span>()</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34"><span id="ast-35">len</span>(<span id="ast-36">qstr</span>)</span>:<span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>q</span>&nbsp;=&nbsp;<span id="ast-39">{<span id="ast-40">'query_string'</span>:&nbsp;<span id="ast-41">{<span id="ast-42">'query'</span>:&nbsp;<span id="ast-43" class="other_trans">qstr</span>}</span>}</span></span><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bq</span>&nbsp;=&nbsp;<span id="ast-46">[<span id="ast-47">{<span id="ast-48">'term'</span>:&nbsp;<span id="ast-49">{<span id="ast-50">'title'</span>:&nbsp;<span id="ast-51">{<span id="ast-52">'value'</span>:&nbsp;<span id="ast-54" class="other_trans">qstr</span>,&nbsp;<span id="ast-53">'boost'</span>:&nbsp;<span id="ast-55">10.0</span>}</span>}</span>}</span>,&nbsp;<span id="ast-56">{<span id="ast-57">'term'</span>:&nbsp;<span id="ast-58">{<span id="ast-59">'name'</span>:&nbsp;<span id="ast-60">{<span id="ast-61">'value'</span>:&nbsp;<span id="ast-63" class="other_trans">qstr</span>,&nbsp;<span id="ast-62">'boost'</span>:&nbsp;<span id="ast-64">7.0</span>}</span>}</span>}</span>,&nbsp;<span id="ast-65">{<span id="ast-66">'term'</span>:&nbsp;<span id="ast-67">{<span id="ast-68">'text'</span>:&nbsp;<span id="ast-69">{<span id="ast-70">'value'</span>:&nbsp;<span id="ast-72">qstr</span>,&nbsp;<span id="ast-71">'boost'</span>:&nbsp;<span id="ast-73">3.0</span>}</span>}</span>}</span>]</span></span><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_q</span>&nbsp;=&nbsp;<span id="ast-76">{<span id="ast-77">'bool'</span>:&nbsp;<span id="ast-78">{<span id="ast-79">'must'</span>:&nbsp;<span id="ast-81" class="other_trans">q</span>,&nbsp;<span id="ast-80">'should'</span>:&nbsp;<span id="ast-82">bq</span>}</span>}</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_q</span>&nbsp;=&nbsp;<span id="ast-85">{<span id="ast-86">'match_all'</span>:&nbsp;<span id="ast-87">{}</span>}</span></span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-89" class="other_trans">entity</span>&nbsp;in&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92" class="other_trans">args</span>.getlist</span>(<span id="ast-93">'entity'</span>)</span>:<span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cf</span>&nbsp;=&nbsp;<span id="ast-96">{<span id="ast-97">'term'</span>:&nbsp;<span id="ast-98">{<span id="ast-99">'entities.id'</span>:&nbsp;<span id="ast-100">entity</span>}</span>}</span></span><span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_q</span>&nbsp;=&nbsp;<span id="ast-103"><span id="ast-104">add_filter</span>(<span id="ast-105" class="other_trans">filtered_q</span>,&nbsp;<span id="ast-106" class="other_trans">cf</span>)</span></span></span><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>q</span>&nbsp;=&nbsp;<span id="ast-109"><span id="ast-110" class="other_trans">deepcopy</span>(<span id="ast-111" class="other_trans">filtered_q</span>)</span></span><span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-113">(<span id="ast-114">collections</span><span id="ast-115" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-116">None</span>)</span>:<span id="ast-117"><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>colls</span>&nbsp;=&nbsp;<span id="ast-119">(<span id="ast-121"><span id="ast-122"><span id="ast-123">args</span>.getlist</span>(<span id="ast-124">'collection'</span>)</span>&nbsp;or&nbsp;<span id="ast-125" class="other_trans">collections</span>)</span></span><span id="ast-126"><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>colls</span>&nbsp;=&nbsp;<span id="ast-128">[<span id="ast-129" class="other_trans">c</span><span id="ast-130">&nbsp;for&nbsp;<span id="ast-131" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-132">colls</span>&nbsp;if&nbsp;<span id="ast-133">(<span id="ast-134" class="other_trans">c</span><span id="ast-135">&nbsp;in&nbsp;</span><span id="ast-136">collections</span>)</span></span>]</span></span><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-138">(<span id="ast-139">not</span>&nbsp;<span id="ast-140"><span id="ast-141">len</span>(<span id="ast-142" class="other_trans">colls</span>)</span>)</span>:<span id="ast-143"><span id="ast-144"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>colls</span>&nbsp;=&nbsp;<span id="ast-145">[<span id="ast-146">'none'</span>]</span></span></span><span id="ast-147"><span id="ast-148" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cf&nbsp;&rarr;&nbsp;colls&nbsp;</span>&nbsp;=&nbsp;<span id="ast-149">{<span id="ast-150">'terms'</span>:&nbsp;<span id="ast-151">{<span id="ast-152">'collection'</span>:&nbsp;<span id="ast-153">colls</span>}</span>}</span></span><span id="ast-154"><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>q</span>&nbsp;=&nbsp;<span id="ast-156"><span id="ast-157" class="other_trans">add_filter</span>(<span id="ast-158">q</span>,&nbsp;<span id="ast-159" class="other_trans">cf</span>)</span></span><span id="ast-160"><span id="ast-161"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>all_coll_f</span>&nbsp;=&nbsp;<span id="ast-162">{<span id="ast-163">'terms'</span>:&nbsp;<span id="ast-164">{<span id="ast-165">'collection'</span>:&nbsp;<span id="ast-166" class="other_trans">collections</span>}</span>}</span></span><span id="ast-167"><span id="ast-168" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_q</span>&nbsp;=&nbsp;<span id="ast-169"><span id="ast-170">add_filter</span>(<span id="ast-171" class="ref_node">q&nbsp;&rarr;&nbsp;filtered_q&nbsp;</span>,&nbsp;<span id="ast-172" class="other_trans">all_coll_f</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getRoomIdJson(<span id="ast-2"><span id="ast-3" class="other_trans">headers</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-6">'http://gxapp.iydsj.com/api/v3/get/aboutrunning/list/0/901/3'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Session</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">requests</span>.Session</span>()</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Request</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">Session</span>.get</span>(<span id="ast-17" class="other_trans">url</span>,&nbsp;headers=<span id="ast-19" class="other_trans">headers</span>)</span></span><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>reqDate</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">Request</span>.content</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-25">reqDate</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">json</span>.loads</span>(<span id="ast-31"><span id="ast-32">Request</span>.content</span>)</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36">open</span>(<span id="ast-37">'route.data'</span>,&nbsp;<span id="ast-38">'w'</span>)</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cnt</span>&nbsp;=&nbsp;<span id="ast-41">0</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-43" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-44"><span id="ast-45">s</span>[<span id="ast-46"><span id="ast-47">'data'</span></span>]</span>:<span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>OriginalJson</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">getOriginalJson</span>(<span id="ast-52"><span id="ast-53">item</span>[<span id="ast-54"><span id="ast-55">'roomId'</span></span>]</span>,&nbsp;<span id="ast-56" class="incorrect_node">headers&nbsp;&rarr;&nbsp;reqDate&nbsp;</span>)</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>NewJson</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">OriginalJson</span>.replace</span>(<span id="ast-62">'\\\\"'</span>,&nbsp;<span id="ast-63">'"'</span>)</span></span><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>NewJson2</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68">NewJson</span>.replace</span>(<span id="ast-69">'\\\\\\\\'</span>,&nbsp;<span id="ast-70">'\\\\'</span>)</span></span><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>willSelectedPoint</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74">set</span>()</span></span><span id="ast-75"><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run_data_str</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79">re</span>.findall</span>(<span id="ast-80">'{\\\\"allLocJson\\\\":\\\\"\\\\[\\\\{\\\\\\\\"av.+\\\\"useZip\\\\":false}'</span>,&nbsp;<span id="ast-81"><span id="ast-82">str</span>(<span id="ast-83">NewJson2</span>)</span>)</span></span><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-85">(<span id="ast-86"><span id="ast-87" class="other_trans">len</span>(<span id="ast-88" class="other_trans">run_data_str</span>)</span><span id="ast-89" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-90">0</span>)</span>:<span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cnt</span>&nbsp;=&nbsp;<span id="ast-93">(<span id="ast-94" class="other_trans">cnt</span>&nbsp;+&nbsp;<span id="ast-96">1</span>)</span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-98">(<span id="ast-99">(<span id="ast-100">'Updating&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-102"><span id="ast-103">str</span>(<span id="ast-104" class="other_trans">cnt</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-106">'&nbsp;running&nbsp;groups&nbsp;data.&nbsp;'</span>)</span></span><span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>output</span>.write</span>(<span id="ast-111">(<span id="ast-112"><span id="ast-113">run_data_str</span>[<span id="ast-114"><span id="ast-115">0</span></span>]</span>&nbsp;+&nbsp;<span id="ast-117">'\\u000a'</span>)</span>)</span></span><span id="ast-118"><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run_points_str</span>&nbsp;=&nbsp;<span id="ast-120"><span id="ast-121"><span id="ast-122">re</span>.findall</span>(<span id="ast-123">'\\\\\\\\\\\\"lat\\\\\\\\\\\\"\\\\:\\\\\\\\\\\\"\\\\d+.\\\\d+\\\\\\\\\\\\",\\\\\\\\\\\\"lng\\\\\\\\"\\\\:\\\\\\\\\\\\"\\\\d+.\\\\d+\\\\\\\\\\\\"'</span>,&nbsp;<span id="ast-124"><span id="ast-125" class="other_trans">run_data_str</span>[<span id="ast-126"><span id="ast-127">0</span></span>]</span>)</span></span><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-129">run_point_str</span>&nbsp;in&nbsp;<span id="ast-130">run_points_str</span>:<span id="ast-131"><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>point_json_str</span>&nbsp;=&nbsp;<span id="ast-133">(<span id="ast-134">(<span id="ast-135">'{'</span>&nbsp;+&nbsp;<span id="ast-137">run_point_str</span>)</span>&nbsp;+&nbsp;<span id="ast-139">'}'</span>)</span></span><span id="ast-140"><span id="ast-141" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>point_json_str</span>&nbsp;=&nbsp;<span id="ast-142"><span id="ast-143"><span id="ast-144">point_json_str</span>.replace</span>(<span id="ast-145">'\\\\"'</span>,&nbsp;<span id="ast-146">'"'</span>)</span></span><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>point_json</span>&nbsp;=&nbsp;<span id="ast-149"><span id="ast-150"><span id="ast-151">json</span>.loads</span>(<span id="ast-152">point_json_str</span>)</span></span><span id="ast-153"><span id="ast-154" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>thisPoint</span>&nbsp;=&nbsp;<span id="ast-155"><span id="ast-156">Point</span>(<span id="ast-157"><span id="ast-158">float</span>(<span id="ast-159"><span id="ast-160" class="other_trans">point_json</span>[<span id="ast-161"><span id="ast-162">'lat'</span></span>]</span>)</span>,&nbsp;<span id="ast-163"><span id="ast-164" class="other_trans">float</span>(<span id="ast-165"><span id="ast-166">point_json</span>[<span id="ast-167"><span id="ast-168">'lng'</span></span>]</span>)</span>)</span></span><span id="ast-169"><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-171">isPass</span>,&nbsp;<span id="ast-172">addPoint</span>)</span>&nbsp;=&nbsp;<span id="ast-173"><span id="ast-174" class="other_trans">isSelectedPoint</span>(<span id="ast-175"><span id="ast-176" class="other_trans">float</span>(<span id="ast-177"><span id="ast-178">point_json</span>[<span id="ast-179"><span id="ast-180">'lat'</span></span>]</span>)</span>,&nbsp;<span id="ast-181"><span id="ast-182" class="other_trans">float</span>(<span id="ast-183"><span id="ast-184">point_json</span>[<span id="ast-185"><span id="ast-186">'lng'</span></span>]</span>)</span>)</span></span><span id="ast-187"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-188">(<span id="ast-189">isPass</span><span id="ast-190" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-191">1</span>)</span>:<span id="ast-192"><span id="ast-193"><span id="ast-194"><span id="ast-195" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>willSelectedPoint</span>.add</span>(<span id="ast-196" class="other_trans">addPoint</span>)</span></span></span></span><span id="ast-197"><span id="ast-198"><span id="ast-199"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>createFivePointsStr</span>(<span id="ast-200" class="other_trans">willSelectedPoint</span>)</span></span><span id="ast-201"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-202">(<span id="ast-203" class="other_trans">cnt</span><span id="ast-204" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-205">50</span>)</span>:<span id="ast-206"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span><span id="ast-207"><span id="ast-208"><span id="ast-209"><span id="ast-210"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output</span>.close</span>()</span></span><span id="ast-211"><span id="ast-212"><span id="ast-213"><span id="ast-214"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>outdata</span>.close</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;apply_corrections(<span id="ast-2"><span id="ast-3" class="other_trans">uri</span>,&nbsp;<span id="ast-4" class="other_trans">runtime_storage_inst</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.info</span>(<span id="ast-9">'Applying&nbsp;corrections&nbsp;from&nbsp;uri&nbsp;%s'</span>,&nbsp;<span id="ast-10" class="other_trans">uri</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>corrections_fd</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">urllib</span>.urlopen</span>(<span id="ast-16" class="other_trans">uri</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raw</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">corrections_fd</span>.read</span>()</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>corrections_fd</span>.close</span>()</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>corrections</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">json</span>.loads</span>(<span id="ast-32" class="other_trans">raw</span>)</span>[<span id="ast-33"><span id="ast-34">'corrections'</span></span>]</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>valid_corrections</span>&nbsp;=&nbsp;<span id="ast-37">[]</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-39" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-40" class="other_trans">corrections</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43">'primary_key'</span><span id="ast-44">&nbsp;in&nbsp;</span><span id="ast-45" class="other_trans">c</span>)</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>valid_corrections</span>.append</span>(<span id="ast-50" class="other_trans">c</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.warn</span>(<span id="ast-55">'Correction&nbsp;misses&nbsp;primary&nbsp;key:&nbsp;%s'</span>,&nbsp;<span id="ast-56" class="other_trans">c</span>)</span></span></span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>runtime_storage_inst</span>.apply_corrections</span>(<span id="ast-61" class="correct_node">corrections&nbsp;&rarr;&nbsp;valid_corrections&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;validate_value(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Draft4Validator</span>(<span id="ast-10"><span id="ast-11" class="other_trans">jsonschema_int</span>()</span>)</span>.validate</span>(<span id="ast-12">{<span id="ast-13" class="other_trans">key</span>:&nbsp;<span id="ast-14" class="other_trans">value</span>}</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-16" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-17" class="other_trans">error</span>:<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_error&nbsp;&rarr;&nbsp;self.&nbsp;</span>.append</span>(<span id="ast-22"><span id="ast-23" class="other_trans">str</span>(<span id="ast-24" class="other_trans">error</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;notify_target_stopped(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">lldb_event</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>event</span>&nbsp;=&nbsp;<span id="ast-7">{<span id="ast-8">'allThreadsStopped'</span>:&nbsp;<span id="ast-9">True</span>}</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>thread_id</span>&nbsp;=&nbsp;<span id="ast-12" class="other_trans">None</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>stopped_thread</span>&nbsp;=&nbsp;<span id="ast-15">None</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>stop_reason</span>&nbsp;=&nbsp;<span id="ast-18">'unknown'</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-20">thread</span>&nbsp;in&nbsp;<span id="ast-21"><span id="ast-22">self</span>.process</span>:<span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stop_reason</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">thread</span>.GetStopReason</span>()</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">stop_reason</span><span id="ast-31" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-32"><span id="ast-33">lldb</span>.eStopReasonBreakpoint</span>)</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stopped_thread</span>&nbsp;=&nbsp;<span id="ast-36">thread</span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>event</span>[<span id="ast-40"><span id="ast-41">'threadId'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44" class="incorrect_node">thread&nbsp;&rarr;&nbsp;stopped_thread&nbsp;</span>.GetThreadID</span>()</span></span><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bp_id</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49">thread</span>.GetStopReasonDataAtIndex</span>(<span id="ast-50">0</span>)</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-52" class="other_trans">bp</span>&nbsp;in&nbsp;<span id="ast-53"><span id="ast-54">self</span>.exc_breakpoints</span>:<span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans">bp</span>.GetID</span>()</span><span id="ast-60" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-61" class="other_trans">bp_id</span>)</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stop_reason</span>&nbsp;=&nbsp;<span id="ast-64">'exception'</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stop_reason</span>&nbsp;=&nbsp;<span id="ast-68">'breakpoint'</span></span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-71">(<span id="ast-72">stop_reason</span><span id="ast-73" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-74"><span id="ast-75">lldb</span>.eStopReasonException</span>)</span>:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stopped_thread</span>&nbsp;=&nbsp;<span id="ast-78">thread</span></span><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stop_reason</span>&nbsp;=&nbsp;<span id="ast-81">'exception'</span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-84">(<span id="ast-85" class="other_trans">stop_reason</span><span id="ast-86">&nbsp;in&nbsp;</span><span id="ast-87">[<span id="ast-88"><span id="ast-89" class="other_trans">lldb</span>.eStopReasonTrace</span>,&nbsp;<span id="ast-90"><span id="ast-91">lldb</span>.eStopReasonPlanComplete</span>]</span>)</span>:<span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stopped_thread</span>&nbsp;=&nbsp;<span id="ast-94" class="other_trans">thread</span></span><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stop_reason</span>&nbsp;=&nbsp;<span id="ast-97">'step'</span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-100">(<span id="ast-101">stop_reason</span><span id="ast-102" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-103"><span id="ast-104">lldb</span>.eStopReasonSignal</span>)</span>:<span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stopped_thread</span>&nbsp;=&nbsp;<span id="ast-107">thread</span></span><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stop_reason</span>&nbsp;=&nbsp;<span id="ast-110">'signal'</span></span><span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>event</span>[<span id="ast-114"><span id="ast-115">'text'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118">thread</span>.GetStopReasonDataAtIndex</span>(<span id="ast-119">0</span>)</span></span><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-121"><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>event</span>[<span id="ast-124"><span id="ast-125">'reason'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-126">stop_reason</span></span><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-128">(<span id="ast-129" class="ref_node">thread&nbsp;&rarr;&nbsp;stopped_thread&nbsp;</span><span id="ast-130" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-131">None</span>)</span>:<span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.process</span>.SetSelectedThread</span>(<span id="ast-137" class="other_trans">stopped_thread</span>)</span></span><span id="ast-138"><span id="ast-139"><span id="ast-140" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>event</span>[<span id="ast-141"><span id="ast-142">'threadId'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-143"><span id="ast-144"><span id="ast-145" class="other_trans">stopped_thread</span>.GetThreadID</span>()</span></span></span><span id="ast-146"><span id="ast-147"><span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.send_event</span>(<span id="ast-150">'stopped'</span>,&nbsp;<span id="ast-151">event</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;const_different(<span id="ast-2"><span id="ast-3" class="other_trans">variables</span>,&nbsp;<span id="ast-4" class="other_trans">values</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-6">(<span id="ast-7"><span id="ast-8" class="other_trans">values</span>[<span id="ast-9"><span id="ast-10">0</span></span>]</span><span id="ast-11" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-12"><span id="ast-13" class="other_trans">values</span>[<span id="ast-14"><span id="ast-15">1</span></span>]</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;seek(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">pos</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-6">(<span id="ast-7" class="other_trans">pos</span><span id="ast-8" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>._bufferedBytes</span>()</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;=&nbsp;<span id="ast-14" class="other_trans">pos</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-17">0</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">len</span>(<span id="ast-22"><span id="ast-23"><span id="ast-24">self</span>.buffer</span>[<span id="ast-25"><span id="ast-26" class="other_trans">i</span></span>]</span>)</span><span id="ast-27" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-28" class="other_trans">offset</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;-=&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">len</span>(<span id="ast-34"><span id="ast-35"><span id="ast-36">self</span>.buffer</span>[<span id="ast-37"><span id="ast-38" class="other_trans">i</span></span>]</span>)</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-42">1</span></span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.position</span>&nbsp;=&nbsp;<span id="ast-46">[<span id="ast-47" class="incorrect_node">i&nbsp;&rarr;&nbsp;pos&nbsp;</span>,&nbsp;<span id="ast-48" class="other_trans">offset</span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_use_berry(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">berry_id</span>,&nbsp;<span id="ast-5" class="other_trans">berry_count</span>,&nbsp;<span id="ast-6" class="other_trans">encounter_id</span>,&nbsp;<span id="ast-7">catch_rate_by_ball</span>,&nbsp;<span id="ast-8" class="other_trans">current_ball</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_catch_rate_by_ball</span>&nbsp;=&nbsp;<span id="ast-11">[]</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-16">'pokemon_catch_rate'</span>,&nbsp;level=<span id="ast-18">'debug'</span>,&nbsp;formatted=<span id="ast-20">'Catch&nbsp;rate&nbsp;of&nbsp;{catch_rate}&nbsp;with&nbsp;{ball_name}&nbsp;is&nbsp;low.&nbsp;Throwing&nbsp;{berry_name}&nbsp;(have&nbsp;{berry_count})'</span>,&nbsp;data=<span id="ast-22">{<span id="ast-23">'catch_rate'</span>:&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>._pct</span>(<span id="ast-30"><span id="ast-31" class="other_trans">catch_rate_by_ball</span>[<span id="ast-32"><span id="ast-33" class="other_trans">current_ball</span></span>]</span>)</span>,&nbsp;<span id="ast-24">'ball_name'</span>:&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36">self</span>.item_list</span>[<span id="ast-37"><span id="ast-38"><span id="ast-39">str</span>(<span id="ast-40" class="other_trans">current_ball</span>)</span></span>]</span>,&nbsp;<span id="ast-25">'berry_name'</span>:&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43">self</span>.item_list</span>[<span id="ast-44"><span id="ast-45"><span id="ast-46">str</span>(<span id="ast-47" class="other_trans">berry_id</span>)</span></span>]</span>,&nbsp;<span id="ast-26">'berry_count'</span>:&nbsp;<span id="ast-48">berry_count</span>}</span>)</span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response_dict</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54">self</span>.api</span>.use_item_capture</span>(item_id=<span id="ast-56" class="other_trans">berry_id</span>,&nbsp;encounter_id=<span id="ast-58">encounter_id</span>,&nbsp;spawn_point_id=<span id="ast-60"><span id="ast-61">self</span>.spawn_point_guid</span>)</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>responses</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">response_dict</span>[<span id="ast-66"><span id="ast-67">'responses'</span></span>]</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-71" class="other_trans">response_dict</span>&nbsp;and&nbsp;<span id="ast-72">(<span id="ast-73"><span id="ast-74" class="other_trans">response_dict</span>[<span id="ast-75"><span id="ast-76">'status_code'</span></span>]</span><span id="ast-77" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-78">1</span>)</span>)</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-80">(<span id="ast-81">'item_capture_mult'</span><span id="ast-82">&nbsp;in&nbsp;</span><span id="ast-83"><span id="ast-84" class="other_trans">responses</span>[<span id="ast-85"><span id="ast-86">'USE_ITEM_CAPTURE'</span></span>]</span>)</span>:<span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-88" class="other_trans">rate</span>&nbsp;in&nbsp;<span id="ast-89" class="incorrect_node">catch_rate_by_ball&nbsp;&rarr;&nbsp;new_catch_rate_by_ball&nbsp;</span>:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_catch_rate_by_ball</span>.append</span>(<span id="ast-94">(<span id="ast-95" class="other_trans">rate</span>&nbsp;*&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans">responses</span>[<span id="ast-100"><span id="ast-101">'USE_ITEM_CAPTURE'</span></span>]</span>[<span id="ast-102"><span id="ast-103">'item_capture_mult'</span></span>]</span>)</span>)</span></span></span><span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-108">'threw_berry'</span>,&nbsp;formatted=<span id="ast-110">'Threw&nbsp;a&nbsp;{berry_name}!&nbsp;Catch&nbsp;rate&nbsp;with&nbsp;{ball_name}&nbsp;is&nbsp;now:&nbsp;{new_catch_rate}'</span>,&nbsp;data=<span id="ast-112">{<span id="ast-113">'berry_name'</span>:&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118">self</span>.item_list</span>[<span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans">str</span>(<span id="ast-122" class="other_trans">berry_id</span>)</span></span>]</span>,&nbsp;<span id="ast-114">'ball_name'</span>:&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125">self</span>.item_list</span>[<span id="ast-126"><span id="ast-127"><span id="ast-128">str</span>(<span id="ast-129" class="other_trans">current_ball</span>)</span></span>]</span>,&nbsp;<span id="ast-115">'new_catch_rate'</span>:&nbsp;<span id="ast-130"><span id="ast-131"><span id="ast-132">self</span>._pct</span>(<span id="ast-133"><span id="ast-134" class="ref_node">catch_rate_by_ball&nbsp;&rarr;&nbsp;new_catch_rate_by_ball&nbsp;</span>[<span id="ast-135"><span id="ast-136" class="other_trans">current_ball</span></span>]</span>)</span>}</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;is_expired(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;`True`&nbsp;if&nbsp;expired,&nbsp;i.e.&nbsp;it&nbsp;is&nbsp;no&nbsp;longer&nbsp;valid.'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>.purpose</span><span id="ast-10" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-11"><span id="ast-12" class="other_trans">VerificationTokenPurpose</span>.password_reset</span>)</span>:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>now</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">datetime</span>.now</span>()</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>expires_after</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">timedelta</span>(hours=<span id="ast-23">24</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-25">(<span id="ast-26" class="other_trans">now</span><span id="ast-27" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-28">(<span id="ast-29"><span id="ast-30">self</span>.created_at</span>&nbsp;+&nbsp;<span id="ast-32" class="other_trans">expires_after</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-34">False</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;setNextBlock(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">block</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7" class="other_trans">block</span><span id="ast-8" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-9">(<span id="ast-10">2</span>&nbsp;**&nbsp;<span id="ast-12">16</span>)</span>)</span>:<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-17">'Block&nbsp;number&nbsp;rollover&nbsp;to&nbsp;0&nbsp;again'</span>)</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>&nbsp;=&nbsp;<span id="ast-20">0</span></span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.__eblock</span>&nbsp;=&nbsp;<span id="ast-24" class="other_trans">block</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cam</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">cv2</span>.VideoCapture</span>(<span id="ast-10">-1</span>)</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cam</span>.set</span>(<span id="ast-16">3</span>,&nbsp;<span id="ast-17">1280</span>)</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cam</span>.set</span>(<span id="ast-23">4</span>,&nbsp;<span id="ast-24">720</span>)</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scanner</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">zbar</span>.ImageScanner</span>()</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scanner</span>.parse_config</span>(<span id="ast-36">'enable'</span>)</span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.bot_config</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">lib</span>.get_config</span>()</span></span><span id="ast-43"><span id="ast-44" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cam_model&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46" class="ref_node">bot_config&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-47"><span id="ast-48">'camera_model'</span></span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;add(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">docs</span>,&nbsp;<span id="ast-5" class="other_trans">commit</span>,&nbsp;<span id="ast-7" class="other_trans">boost</span>,&nbsp;<span id="ast-9">commitWithin</span>,&nbsp;<span id="ast-11" class="other_trans">waitFlush</span>,&nbsp;<span id="ast-13" class="other_trans">waitSearcher</span></span>):<span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Adds&nbsp;or&nbsp;updates&nbsp;documents.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Requires&nbsp;``docs``,&nbsp;which&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;dictionaries.&nbsp;Each&nbsp;key&nbsp;is&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;field&nbsp;name&nbsp;and&nbsp;each&nbsp;value&nbsp;is&nbsp;the&nbsp;value&nbsp;to&nbsp;index.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Optionally&nbsp;accepts&nbsp;``commit``.&nbsp;Default&nbsp;is&nbsp;``True``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Optionally&nbsp;accepts&nbsp;``boost``.&nbsp;Default&nbsp;is&nbsp;``None``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Optionally&nbsp;accepts&nbsp;``commitWithin``.&nbsp;Default&nbsp;is&nbsp;``None``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Optionally&nbsp;accepts&nbsp;``waitFlush``.&nbsp;Default&nbsp;is&nbsp;``None``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Optionally&nbsp;accepts&nbsp;``waitSearcher``.&nbsp;Default&nbsp;is&nbsp;``None``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Usage::\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;solr.add([\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"id":&nbsp;"doc_1",\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"title":&nbsp;"A&nbsp;test&nbsp;document",\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"id":&nbsp;"doc_2",\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"title":&nbsp;"The&nbsp;Banana:&nbsp;Tasty&nbsp;or&nbsp;Dangerous?",\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;])\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-17"><span id="ast-18" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>start_time&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">time</span>.time</span>()</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.debug</span>(<span id="ast-27">'Starting&nbsp;to&nbsp;build&nbsp;add&nbsp;request...'</span>)</span></span><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">ET</span>.Element</span>(<span id="ast-33">'add'</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35" class="other_trans">commitWithin</span>:<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.set</span>(<span id="ast-40">'commitWithin'</span>,&nbsp;<span id="ast-41" class="other_trans">commitWithin</span>)</span></span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-43" class="other_trans">doc</span>&nbsp;in&nbsp;<span id="ast-44" class="other_trans">docs</span>:<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.append</span>(<span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>._build_doc</span>(<span id="ast-52" class="other_trans">doc</span>,&nbsp;boost=<span id="ast-54" class="other_trans">boost</span>)</span>)</span></span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>m</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59">ET</span>.tostring</span>(<span id="ast-60" class="other_trans">message</span>,&nbsp;encoding=<span id="ast-62">'utf-8'</span>)</span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>m</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66">force_unicode</span>(<span id="ast-67" class="other_trans">m</span>)</span></span><span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>end_time</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">time</span>.time</span>()</span></span><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.debug</span>(<span id="ast-78">'Built&nbsp;add&nbsp;request&nbsp;of&nbsp;%s&nbsp;docs&nbsp;in&nbsp;%0.2f&nbsp;seconds.'</span>,&nbsp;<span id="ast-79"><span id="ast-80">len</span>(<span id="ast-81" class="ref_node">docs&nbsp;&rarr;&nbsp;message&nbsp;</span>)</span>,&nbsp;<span id="ast-82">(<span id="ast-83">end_time</span>&nbsp;-&nbsp;<span id="ast-85" class="other_trans">start_time</span>)</span>)</span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89">self</span>._update</span>(<span id="ast-90" class="other_trans">m</span>,&nbsp;commit=<span id="ast-92" class="other_trans">commit</span>,&nbsp;waitFlush=<span id="ast-94" class="other_trans">waitFlush</span>,&nbsp;waitSearcher=<span id="ast-96" class="other_trans">waitSearcher</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;prompt_ignore(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">ig</span>,&nbsp;<span id="ast-5">path</span>,&nbsp;<span id="ast-6" class="other_trans">cb</span></span>):<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ignore</span>.create_flooignore</span>(<span id="ast-11"><span id="ast-12" class="other_trans">ig</span>.path</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirs</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">ig</span>.get_children</span>()</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirs</span>.append</span>(<span id="ast-22">ig</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirs</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26">sorted</span>(<span id="ast-27" class="other_trans">dirs</span>,&nbsp;key=<span id="ast-29"><span id="ast-30">attrgetter</span>(<span id="ast-31">'size'</span>)</span>)</span></span><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>,&nbsp;<span id="ast-34" class="other_trans">starting_size</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36">reduce</span>(<span id="ast-37">lambda&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">x</span>,&nbsp;<span id="ast-40">c</span></span>:&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">x</span>&nbsp;+&nbsp;<span id="ast-44"><span id="ast-45">c</span>.size</span>)</span></span>,&nbsp;<span id="ast-46">dirs</span>,&nbsp;<span id="ast-47">0</span>)</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>too_big</span>&nbsp;=&nbsp;<span id="ast-50">[]</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-52">(<span id="ast-54">(<span id="ast-55">size</span><span id="ast-56" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-57">MAX_WORKSPACE_SIZE</span>)</span>&nbsp;and&nbsp;<span id="ast-58" class="other_trans">dirs</span>)</span>:<span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cd</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="ref_node">too_big&nbsp;&rarr;&nbsp;dirs&nbsp;</span>.pop</span>()</span></span><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;-=&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">cd</span>.size</span></span><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>too_big</span>.append</span>(<span id="ast-73" class="other_trans">cd</span>)</span></span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-75">(<span id="ast-76">size</span><span id="ast-77" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-78" class="other_trans">MAX_WORKSPACE_SIZE</span>)</span>:<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>editor</span>.error_message</span>(<span id="ast-83">(<span id="ast-84">'Maximum&nbsp;workspace&nbsp;size&nbsp;is&nbsp;%.2fMB.\\u000a\\u000a%s&nbsp;is&nbsp;too&nbsp;big&nbsp;(%.2fMB)&nbsp;to&nbsp;upload.&nbsp;Consider&nbsp;adding&nbsp;stuff&nbsp;to&nbsp;the&nbsp;.flooignore&nbsp;file.'</span>&nbsp;%&nbsp;<span id="ast-86">(<span id="ast-87">(<span id="ast-88">MAX_WORKSPACE_SIZE</span>&nbsp;/&nbsp;<span id="ast-90">1000000.0</span>)</span>,&nbsp;<span id="ast-91">path</span>,&nbsp;<span id="ast-92">(<span id="ast-93"><span id="ast-94" class="other_trans">ig</span>.size</span>&nbsp;/&nbsp;<span id="ast-96">1000000.0</span>)</span>)</span>)</span>)</span></span><span id="ast-97"><span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cb</span>(<span id="ast-100">[<span id="ast-101"><span id="ast-102" class="other_trans">set</span>()</span>,&nbsp;<span id="ast-103">0</span>]</span>)</span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-106" class="other_trans">too_big</span>:<span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>txt</span>&nbsp;=&nbsp;<span id="ast-109">(<span id="ast-110">TOO_BIG_TEXT</span>&nbsp;%&nbsp;<span id="ast-112">(<span id="ast-113">(<span id="ast-114" class="other_trans">MAX_WORKSPACE_SIZE</span>&nbsp;/&nbsp;<span id="ast-116">1000000.0</span>)</span>,&nbsp;<span id="ast-117">path</span>,&nbsp;<span id="ast-118">(<span id="ast-119" class="other_trans">starting_size</span>&nbsp;/&nbsp;<span id="ast-121">1000000.0</span>)</span>,&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124">'\\u000a'</span>.join</span>(<span id="ast-125">[<span id="ast-126"><span id="ast-127" class="other_trans">x</span>.path</span><span id="ast-128">&nbsp;for&nbsp;<span id="ast-129" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-130">too_big</span></span>]</span>)</span>)</span>)</span></span><span id="ast-131"><span id="ast-132" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>upload</span>&nbsp;=&nbsp;<span id="ast-133">yield&nbsp;<span id="ast-134">(<span id="ast-135"><span id="ast-136">self</span>.ok_cancel_dialog</span>,&nbsp;<span id="ast-137" class="other_trans">txt</span>)</span></span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-139">(<span id="ast-140">not</span>&nbsp;<span id="ast-141" class="other_trans">upload</span>)</span>:<span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cb</span>(<span id="ast-145">[<span id="ast-146"><span id="ast-147">set</span>()</span>,&nbsp;<span id="ast-148">0</span>]</span>)</span></span><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span><span id="ast-150"><span id="ast-151" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>files</span>&nbsp;=&nbsp;<span id="ast-152"><span id="ast-153" class="other_trans">set</span>()</span></span><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-155" class="other_trans">ig</span>&nbsp;in&nbsp;<span id="ast-156">dirs</span>:<span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>files</span>&nbsp;=&nbsp;<span id="ast-159"><span id="ast-160"><span id="ast-161">files</span>.union</span>(<span id="ast-162"><span id="ast-163">set</span>(<span id="ast-164">[<span id="ast-165"><span id="ast-166"><span id="ast-167">utils</span>.to_rel_path</span>(<span id="ast-168">x</span>)</span><span id="ast-169">&nbsp;for&nbsp;<span id="ast-170" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-171"><span id="ast-172">ig</span>.files</span></span>]</span>)</span>)</span></span></span><span id="ast-173"><span id="ast-174"><span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cb</span>(<span id="ast-176">[<span id="ast-177">files</span>,&nbsp;<span id="ast-178" class="other_trans">size</span>]</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">arm_config</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.default_angles</span>&nbsp;=&nbsp;<span id="ast-8">(<span id="ast-9">[<span id="ast-10">90</span>]</span>&nbsp;*&nbsp;<span id="ast-12">5</span>)</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">lib</span>.get_logger</span>()</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.bot_config</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">lib</span>.get_config</span>()</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.servo_cape</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">ServoCape</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>.bot_config</span>[<span id="ast-34"><span id="ast-35">'dagu_arm'</span></span>]</span>[<span id="ast-36"><span id="ast-37">'servo_cape'</span></span>]</span>)</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.joints</span>&nbsp;=&nbsp;<span id="ast-41">(<span id="ast-42">[<span id="ast-43">0</span>]</span>&nbsp;*&nbsp;<span id="ast-45">5</span>)</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cam</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">cv2</span>.VideoCapture</span>(<span id="ast-52">0</span>)</span></span><span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cam</span>.set</span>(<span id="ast-58">3</span>,&nbsp;<span id="ast-59">1280</span>)</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cam</span>.set</span>(<span id="ast-65">4</span>,&nbsp;<span id="ast-66">720</span>)</span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scanner</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">zbar</span>.ImageScanner</span>()</span></span><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>scanner&nbsp;&rarr;&nbsp;self.&nbsp;</span>.parse_config</span>(<span id="ast-77">'enable'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;history(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">oid</span>,&nbsp;<span id="ast-5" class="other_trans">version</span>,&nbsp;<span id="ast-6" class="other_trans">length</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10" class="other_trans">length</span><span id="ast-11" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-12" class="other_trans">None</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.rpc</span>.call</span>(<span id="ast-18">'history'</span>,&nbsp;<span id="ast-19" class="other_trans">oid</span>,&nbsp;<span id="ast-20" class="other_trans">version</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.rpc</span>.call</span>(<span id="ast-26">'history'</span>,&nbsp;<span id="ast-27" class="other_trans">oid</span>,&nbsp;<span id="ast-28" class="other_trans">version</span>,&nbsp;<span id="ast-29" class="other_trans">length</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;clear_key_before(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">key</span>,&nbsp;<span id="ast-5" class="other_trans">namespace</span>,&nbsp;<span id="ast-7" class="other_trans">timestamp</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Clear&nbsp;all&nbsp;data&nbsp;before&nbsp;`timestamp`&nbsp;for&nbsp;a&nbsp;given&nbsp;key.&nbsp;Note&nbsp;that&nbsp;the&nbsp;timestamp\\u000a&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;rounded&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary'</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>block_size</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.config</span>.block_size</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">namespace</span><span id="ast-19" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-20" class="other_trans">None</span>)</span>:<span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>namespace</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.config</span>.namespace</span></span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">timestamp</span><span id="ast-29" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-30">None</span>)</span>:<span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-33" class="other_trans">offset</span>,&nbsp;<span id="ast-34" class="other_trans">remainder</span>)</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">divmod</span>(<span id="ast-37" class="other_trans">timestamp</span>,&nbsp;<span id="ast-38" class="other_trans">block_size</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40" class="other_trans">remainder</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">ValueError</span>(<span id="ast-44">'timestamp&nbsp;must&nbsp;be&nbsp;on&nbsp;a&nbsp;block&nbsp;boundary'</span>)</span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">(<span id="ast-47" class="other_trans">offset</span><span id="ast-48" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-49">0</span>)</span>:<span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-51"><span id="ast-52">ValueError</span>(<span id="ast-53">'cannot&nbsp;delete&nbsp;before&nbsp;offset&nbsp;zero'</span>)</span></span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;-=&nbsp;<span id="ast-57">1</span></span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.driver</span>.clear_key_before</span>(<span id="ast-63" class="other_trans">key</span>,&nbsp;<span id="ast-64" class="other_trans">namespace</span>,&nbsp;<span id="ast-65" class="other_trans">offset</span>,&nbsp;<span id="ast-66" class="other_trans">timestamp</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.driver</span>.clear_key_before</span>(<span id="ast-72" class="other_trans">key</span>,&nbsp;<span id="ast-73" class="other_trans">namespace</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;write_dmx(<span id="ast-2"><span id="ast-3" class="other_trans">baudrate</span>,&nbsp;<span id="ast-5" class="other_trans">buf</span></span>):<span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Simple&nbsp;test&nbsp;routine&nbsp;for&nbsp;DMX-over-serial,&nbsp;with&nbsp;varying&nbsp;baudrates.&nbsp;The&nbsp;buf&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;DMX&nbsp;address&nbsp;space&nbsp;(0&nbsp;-&nbsp;512).&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;TODO:&nbsp;The&nbsp;baudrate&nbsp;on&nbsp;the&nbsp;Pi&nbsp;currently&nbsp;ceilings&nbsp;at&nbsp;115200&nbsp;baud.&nbsp;Change&nbsp;back&nbsp;to&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;250000&nbsp;baud&nbsp;when&nbsp;fixed&nbsp;on&nbsp;the&nbsp;Pi-side.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">isinstance</span>(<span id="ast-17">buf</span>,&nbsp;<span id="ast-18" class="other_trans">bytearray</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>num_addresses</span>&nbsp;=&nbsp;<span id="ast-21">512</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-23">(<span id="ast-24"><span id="ast-25" class="other_trans">len</span>(<span id="ast-26" class="other_trans">buf</span>)</span><span id="ast-27" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-28" class="other_trans">num_addresses</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>device_name</span>&nbsp;=&nbsp;<span id="ast-31">'/dev/ttyAMA0'</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36">serial</span>.Serial</span>(<span id="ast-37" class="other_trans">device_name</span>)</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.baudrate</span>&nbsp;=&nbsp;<span id="ast-41" class="other_trans">baudrate</span></span><span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.bytesize</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">serial</span>.EIGHTBITS</span></span><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.parity</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">serial</span>.PARITY_NONE</span></span><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.stopbits</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56">serial</span>.STOPBITS_TWO</span></span><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.timeout</span>&nbsp;=&nbsp;<span id="ast-60">3.0</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.baudrate</span>&nbsp;=&nbsp;<span id="ast-64">(<span id="ast-65">baudrate</span>&nbsp;/&nbsp;<span id="ast-67">2</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.write</span>(<span id="ast-72"><span id="ast-73">chr</span>(<span id="ast-74">0</span>)</span>)</span></span><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.baudrate</span>&nbsp;=&nbsp;<span id="ast-78" class="other_trans">baudrate</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.write</span>(<span id="ast-83"><span id="ast-84" class="other_trans">chr</span>(<span id="ast-85">0</span>)</span>)</span></span><span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.write</span>(<span id="ast-90" class="other_trans">buf</span>)</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>port</span>.close</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7">argparse</span>.ArgumentParser</span>()</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-12">'trace_fpath'</span>,&nbsp;help=<span id="ast-14">'The&nbsp;trace&nbsp;to&nbsp;learn&nbsp;topics&nbsp;from'</span>,&nbsp;type=<span id="ast-16">str</span>)</span></span><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-21">'num_topics'</span>,&nbsp;help=<span id="ast-23">'The&nbsp;number&nbsp;of&nbsp;topics&nbsp;to&nbsp;learn'</span>,&nbsp;type=<span id="ast-25">int</span>)</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-30">'model_fpath'</span>,&nbsp;help=<span id="ast-32">'The&nbsp;name&nbsp;of&nbsp;the&nbsp;model&nbsp;file&nbsp;(a&nbsp;h5&nbsp;file)'</span>,&nbsp;type=<span id="ast-34" class="other_trans">str</span>)</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-39">'--num_iter'</span>,&nbsp;help=<span id="ast-41">'The&nbsp;number&nbsp;of&nbsp;iterations'</span>,&nbsp;type=<span id="ast-43">int</span>,&nbsp;default=<span id="ast-45">1000</span>)</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-50">'--burn_in'</span>,&nbsp;help=<span id="ast-52">'The&nbsp;burn&nbsp;in&nbsp;(ignored&nbsp;if&nbsp;using&nbsp;mpi)'</span>,&nbsp;type=<span id="ast-54">int</span>,&nbsp;default=<span id="ast-56">300</span>)</span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-61">'--dynamic'</span>,&nbsp;help=<span id="ast-63">'If&nbsp;we&nbsp;should&nbsp;employ&nbsp;the&nbsp;dynamic&nbsp;strategy'</span>,&nbsp;type=<span id="ast-65">bool</span>,&nbsp;default=<span id="ast-67">False</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-72">'--num_batches'</span>,&nbsp;help=<span id="ast-74">'Number&nbsp;of&nbsp;batches&nbsp;in&nbsp;dynamic&nbsp;case'</span>,&nbsp;type=<span id="ast-76">int</span>,&nbsp;default=<span id="ast-78">10</span>)</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-83">'--alpha_zh'</span>,&nbsp;help=<span id="ast-85">'Value&nbsp;of&nbsp;alpha_zh&nbsp;(alpha)&nbsp;hyper.&nbsp;Defaults&nbsp;to&nbsp;50&nbsp;/&nbsp;nz'</span>,&nbsp;type=<span id="ast-87">float</span>,&nbsp;default=<span id="ast-89" class="other_trans">None</span>)</span></span><span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-94">'--beta_zs'</span>,&nbsp;help=<span id="ast-96">'Value&nbsp;of&nbsp;beta_zs&nbsp;(beta)&nbsp;hyper'</span>,&nbsp;type=<span id="ast-98">float</span>,&nbsp;default=<span id="ast-100">0.001</span>)</span></span><span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-105">'--kernel'</span>,&nbsp;choices=<span id="ast-107"><span id="ast-108">kernels</span>.names</span>,&nbsp;help=<span id="ast-110">'The&nbsp;kernel&nbsp;to&nbsp;use'</span>,&nbsp;type=<span id="ast-112" class="other_trans">str</span>,&nbsp;default=<span id="ast-114">'noop'</span>)</span></span><span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-119">'--residency_priors'</span>,&nbsp;nargs=<span id="ast-121">'+'</span>,&nbsp;help=<span id="ast-123">'Priors&nbsp;for&nbsp;the&nbsp;residency&nbsp;time&nbsp;dist'</span>,&nbsp;type=<span id="ast-125" class="other_trans">float</span>,&nbsp;default=<span id="ast-127">None</span>)</span></span><span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-132">'--leaveout'</span>,&nbsp;help=<span id="ast-134">'The&nbsp;number&nbsp;of&nbsp;transitions&nbsp;to&nbsp;leave&nbsp;for&nbsp;test'</span>,&nbsp;type=<span id="ast-136">float</span>,&nbsp;default=<span id="ast-138">0</span>)</span></span><span id="ast-139"><span id="ast-140" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-141"><span id="ast-142"><span id="ast-143">parser</span>.parse_args</span>()</span></span><span id="ast-144"><span id="ast-145" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>comm</span>&nbsp;=&nbsp;<span id="ast-146"><span id="ast-147">MPI</span>.COMM_WORLD</span></span><span id="ast-148"><span id="ast-149" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rank</span>&nbsp;=&nbsp;<span id="ast-150"><span id="ast-151" class="other_trans">comm</span>.rank</span></span><span id="ast-152"><span id="ast-153" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;=&nbsp;<span id="ast-154"><span id="ast-155">comm</span>.size</span></span><span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-157"><span id="ast-158" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>comm</span>&nbsp;=&nbsp;<span id="ast-159"><span id="ast-160" class="other_trans">MPI</span>.COMM_WORLD</span></span><span id="ast-161"><span id="ast-162" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rank</span>&nbsp;=&nbsp;<span id="ast-163"><span id="ast-164">comm</span>.rank</span></span><span id="ast-165"><span id="ast-166"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;=&nbsp;<span id="ast-167"><span id="ast-168" class="other_trans">comm</span>.size</span></span><span id="ast-169"><span id="ast-170" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>single_thread</span>&nbsp;=&nbsp;<span id="ast-171">(<span id="ast-172" class="other_trans">size</span><span id="ast-173" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-174">1</span>)</span></span><span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-176"><span id="ast-177" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>single_thread</span>&nbsp;=&nbsp;<span id="ast-178">True</span></span></span></span><span id="ast-179"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-180">(<span id="ast-182">(<span id="ast-183">not</span>&nbsp;<span id="ast-184" class="other_trans">single_thread</span>)</span>&nbsp;and&nbsp;<span id="ast-185">(<span id="ast-186">rank</span><span id="ast-187" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-188"><span id="ast-189">plearn</span>.MASTER</span>)</span>)</span>:<span id="ast-190"><span id="ast-191"><span id="ast-192"><span id="ast-193" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plearn</span>.work</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-194"><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>started</span>&nbsp;=&nbsp;<span id="ast-196"><span id="ast-197"><span id="ast-198">time</span>.mktime</span>(<span id="ast-199"><span id="ast-200"><span id="ast-201" class="other_trans">time</span>.localtime</span>()</span>)</span></span><span id="ast-202"><span id="ast-203" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>num_lines</span>&nbsp;=&nbsp;<span id="ast-204">0</span></span><span id="ast-205"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-206"><span id="ast-207">open</span>(<span id="ast-208"><span id="ast-209">args</span>.trace_fpath</span>)</span>&nbsp;as&nbsp;<span id="ast-210" class="other_trans">trace_file</span>:<span id="ast-211"><span id="ast-212"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>num_lines</span>&nbsp;=&nbsp;<span id="ast-213"><span id="ast-214">sum</span>(<span id="ast-215">(<span id="ast-216">1</span><span id="ast-217">&nbsp;for&nbsp;<span id="ast-218" class="other_trans">_</span>&nbsp;in&nbsp;<span id="ast-219" class="other_trans">trace_file</span></span>)</span>)</span></span></span><span id="ast-220"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-221">(<span id="ast-222"><span id="ast-223">args</span>.leaveout</span><span id="ast-224" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-225">0</span>)</span>:<span id="ast-226"><span id="ast-227" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>leave_out</span>&nbsp;=&nbsp;<span id="ast-228"><span id="ast-229">min</span>(<span id="ast-230">1</span>,&nbsp;<span id="ast-231"><span id="ast-232">args</span>.leaveout</span>)</span></span><span id="ast-233"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-234">(<span id="ast-235" class="other_trans">leave_out</span><span id="ast-236" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-237">1</span>)</span>:<span id="ast-238"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-239">'Leave&nbsp;out&nbsp;is&nbsp;1&nbsp;(100%),&nbsp;nothing&nbsp;todo'</span></span><span id="ast-240"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-241"><span id="ast-242"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>from_</span>&nbsp;=&nbsp;<span id="ast-243">0</span></span><span id="ast-244"><span id="ast-245" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>to</span>&nbsp;=&nbsp;<span id="ast-246"><span id="ast-247" class="other_trans">int</span>(<span id="ast-248">(<span id="ast-249" class="other_trans">num_lines</span>&nbsp;-&nbsp;<span id="ast-251">(<span id="ast-252" class="incorrect_node">num_lines&nbsp;&rarr;&nbsp;leave_out&nbsp;</span>&nbsp;*&nbsp;<span id="ast-254" class="other_trans">leave_out</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-255"><span id="ast-256" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>from_</span>&nbsp;=&nbsp;<span id="ast-257">0</span></span><span id="ast-258"><span id="ast-259" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>to</span>&nbsp;=&nbsp;<span id="ast-260"><span id="ast-261" class="other_trans">np</span>.inf</span></span></span></span></span></span></span><br /><br /><hr />
</body></html>
