<html><head><style>
.ast { font-family: monospace; font-size: 12pt; }
.correct_node { font-weight: bold; background-color: green; color: white; }
.incorrect_node { font-weight: bold; background-color: red; color: white; }
.ref_node { font-weight: bold; background-color: blue; color: white; }
.location_node { font-weight: bold; background-color: #ff00ff; color: white; }
.other_trans { color: #3333ff; }
.whitespace { background-color: white; color: black; }
.pred_rank_wrapper { font-weight: bold; }
.correct_pred_rank { font-weight: bold; color: green;}
.incorrect_pred_rank { font-weight: bold; color: red; }
.rank_type { font-weight: bold; }
.description { font-size: 16pt; }
</style></head><body><div class="description">
<div><b>This is part 9/10 of the system predictions for the Real-Bug Test set. This system achieves 41% Repair Accuracy and 54% Location Accuracy.</b></div><br /><div><b>Annotations</b>:</div><ul><li><span class="correct_node">foo &rarr; bar</span> - The bug was located at this node, and the system <i>correctly</i> predicted both the location and the repair as its top prediction.</li><li><span class="incorrect_node">foo &rarr; bar</span> - The system <i>incorrectly</i> predicted this repair as its top prediction.</li><li><span class="ref_node">foo &rarr; bar</span> - If the system incorrectly predicted the repair, this was the correct repair it should have made.</li><li><span class="location_node">foo &rarr; bar, pred: zap</span> - The system predicted the correct <i>location</i> of the repair, but the wrong repair label. It should have predicted 'bar', but it predicted 'zap' instead.</li></ul><div>The part before the arrow ('foo') is what the system actually saw at test time. Other candidate repair locations which the system could have chosen are marked in <span class="other_trans">this color</span>. For clarity the actual labels for those locations are not shown.</div></div><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;completions_for(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">module_name</span>,&nbsp;<span id="ast-5" class="other_trans">filename</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;completions&nbsp;for&nbsp;module\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.database</span>.modules_lock</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15" class="other_trans">module_name</span><span id="ast-16">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.database</span>.modules</span>)</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-21">[]</span></span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-23"><span id="ast-24" class="ref_node">completions_for_module&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">symbols</span>.get_visible_module</span>(<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31">self</span>.database</span>.modules</span>[<span id="ast-32"><span id="ast-33" class="other_trans">module_name</span></span>]</span>,&nbsp;<span id="ast-34" class="other_trans">filename</span>)</span>,&nbsp;<span id="ast-35" class="incorrect_node">filename&nbsp;&rarr;&nbsp;module_name&nbsp;</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_parse_event_buffer(<span id="ast-2"><span id="ast-3" class="other_trans">event_buffer</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parses&nbsp;an&nbsp;event&nbsp;buffer&nbsp;of&nbsp;``inotify_event``&nbsp;structs&nbsp;returned&nbsp;by\\u000a&nbsp;&nbsp;&nbsp;&nbsp;inotify::\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;inotify_event&nbsp;{\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__s32&nbsp;wd;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;watch&nbsp;descriptor&nbsp;*/\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__u32&nbsp;mask;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;watch&nbsp;mask&nbsp;*/\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__u32&nbsp;cookie;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;cookie&nbsp;to&nbsp;synchronize&nbsp;two&nbsp;events&nbsp;*/\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__u32&nbsp;len;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;length&nbsp;(including&nbsp;nulls)&nbsp;of&nbsp;name&nbsp;*/\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;&nbsp;name[0];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;stub&nbsp;for&nbsp;possible&nbsp;name&nbsp;*/\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;``cookie``&nbsp;member&nbsp;of&nbsp;this&nbsp;struct&nbsp;is&nbsp;used&nbsp;to&nbsp;pair&nbsp;two&nbsp;related\\u000a&nbsp;&nbsp;&nbsp;&nbsp;events,&nbsp;for&nbsp;example,&nbsp;it&nbsp;pairs&nbsp;an&nbsp;IN_MOVED_FROM&nbsp;event&nbsp;with&nbsp;an\\u000a&nbsp;&nbsp;&nbsp;&nbsp;IN_MOVED_TO&nbsp;event.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-8">0</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-10">(<span id="ast-11">(<span id="ast-12" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-14">16</span>)</span><span id="ast-15" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-16"><span id="ast-17" class="other_trans">len</span>(<span id="ast-18" class="other_trans">event_buffer</span>)</span>)</span>:<span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-21" class="other_trans">wd</span>,&nbsp;<span id="ast-22" class="other_trans">mask</span>,&nbsp;<span id="ast-23" class="other_trans">cookie</span>,&nbsp;<span id="ast-24" class="other_trans">length</span>)</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">struct</span>.unpack_from</span>(<span id="ast-28">'iIII'</span>,&nbsp;<span id="ast-29" class="other_trans">event_buffer</span>,&nbsp;<span id="ast-30" class="other_trans">i</span>)</span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">event_buffer</span>[<span id="ast-37"><span id="ast-38">(<span id="ast-39" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-41">16</span>)</span>:<span id="ast-42">(<span id="ast-43">(<span id="ast-44" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-46">16</span>)</span>&nbsp;+&nbsp;<span id="ast-48" class="other_trans">length</span>)</span></span>]</span>.rstrip</span>(<span id="ast-49">'\\u0000'</span>)</span></span><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-53">(<span id="ast-54">16</span>&nbsp;+&nbsp;<span id="ast-56" class="other_trans">length</span>)</span></span><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-59">(<span id="ast-60" class="other_trans">wd</span>,&nbsp;<span id="ast-61" class="other_trans">mask</span>,&nbsp;<span id="ast-62" class="other_trans">cookie</span>,&nbsp;<span id="ast-63" class="other_trans">name</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;check_backup_count_and_state(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">site</span>,&nbsp;<span id="ast-5" class="other_trans">basebackup_path</span>,&nbsp;<span id="ast-6" class="other_trans">xlog_path</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>allowed_basebackup_count</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.config</span>[<span id="ast-14"><span id="ast-15">'backup_sites'</span></span>]</span>[<span id="ast-16"><span id="ast-17" class="other_trans">site</span></span>]</span>[<span id="ast-18"><span id="ast-19">'basebackup_count'</span></span>]</span></span><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-22" class="other_trans">m_time</span>,&nbsp;<span id="ast-23">remote</span>)</span>&nbsp;=&nbsp;<span id="ast-24">(<span id="ast-25">0</span>,&nbsp;<span id="ast-26">False</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-30">(<span id="ast-31">'object_storage'</span><span id="ast-32">&nbsp;in&nbsp;</span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36">self</span>.config</span>[<span id="ast-37"><span id="ast-38">'backup_sites'</span></span>]</span>[<span id="ast-39"><span id="ast-40" class="other_trans">site</span></span>]</span>)</span>&nbsp;and&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45">self</span>.config</span>[<span id="ast-46"><span id="ast-47">'backup_sites'</span></span>]</span>[<span id="ast-48"><span id="ast-49" class="other_trans">site</span></span>]</span>[<span id="ast-50"><span id="ast-51">'object_storage'</span></span>]</span>)</span>:<span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>basebackups</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">self</span>.get_remote_basebackups_info</span>(<span id="ast-57" class="other_trans">site</span>)</span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>remote</span>&nbsp;=&nbsp;<span id="ast-60">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>basebackups</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65">self</span>.get_local_basebackups_info</span>(<span id="ast-66" class="other_trans">basebackup_path</span>)</span></span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.debug</span>(<span id="ast-72">'Found&nbsp;%r&nbsp;basebackups'</span>,&nbsp;<span id="ast-73" class="other_trans">basebackups</span>)</span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-75" class="other_trans">basebackups</span>:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>m_time</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans">basebackups</span>[<span id="ast-81"><span id="ast-82">-1</span></span>]</span>[<span id="ast-83"><span id="ast-84">'last_modified'</span></span>]</span></span></span><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-86">(<span id="ast-87"><span id="ast-88" class="other_trans">len</span>(<span id="ast-89" class="other_trans">basebackups</span>)</span><span id="ast-90" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-91" class="other_trans">allowed_basebackup_count</span>)</span>:<span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.warning</span>(<span id="ast-97">'Too&nbsp;many&nbsp;basebackups:&nbsp;%d&gt;%d,&nbsp;%r,&nbsp;starting&nbsp;to&nbsp;get&nbsp;rid&nbsp;of&nbsp;%r'</span>,&nbsp;<span id="ast-98"><span id="ast-99" class="other_trans">len</span>(<span id="ast-100">basebackups</span>)</span>,&nbsp;<span id="ast-101" class="other_trans">allowed_basebackup_count</span>,&nbsp;<span id="ast-102" class="other_trans">basebackups</span>,&nbsp;<span id="ast-103"><span id="ast-104">basebackups</span>[<span id="ast-105"><span id="ast-106">0</span></span>]</span>)</span></span><span id="ast-107"><span id="ast-108" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last_wal_segment_still_needed</span>&nbsp;=&nbsp;<span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112" class="other_trans">basebackups</span>[<span id="ast-113"><span id="ast-114">0</span></span>]</span>[<span id="ast-115"><span id="ast-116">'metadata'</span></span>]</span>[<span id="ast-117"><span id="ast-118">'start-wal-segment'</span></span>]</span></span><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-120">(<span id="ast-121">not</span>&nbsp;<span id="ast-122">remote</span>)</span>:<span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.delete_local_wal_before</span>(<span id="ast-127" class="other_trans">last_wal_segment_still_needed</span>,&nbsp;<span id="ast-128" class="other_trans">xlog_path</span>)</span></span><span id="ast-129"><span id="ast-130" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>basebackup_to_be_deleted</span>&nbsp;=&nbsp;<span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134">os</span>.path</span>.join</span>(<span id="ast-135" class="other_trans">basebackup_path</span>,&nbsp;<span id="ast-136"><span id="ast-137" class="other_trans">basebackups</span>[<span id="ast-138"><span id="ast-139">0</span></span>]</span>)</span></span><span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>shutil</span>.rmtree</span>(<span id="ast-144">basebackup_to_be_deleted</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.delete_remote_wal_before</span>(<span id="ast-149" class="other_trans">last_wal_segment_still_needed</span>,&nbsp;<span id="ast-150" class="incorrect_node">site&nbsp;&rarr;&nbsp;xlog_path&nbsp;</span>)</span></span><span id="ast-151"><span id="ast-152"><span id="ast-153"><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.delete_remote_basebackup</span>(<span id="ast-155" class="other_trans">site</span>,&nbsp;<span id="ast-156"><span id="ast-157" class="other_trans">basebackups</span>[<span id="ast-158"><span id="ast-159">0</span></span>]</span>)</span></span></span></span><span id="ast-160"><span id="ast-161"><span id="ast-162"><span id="ast-163"><span id="ast-164"><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.state</span>[<span id="ast-166"><span id="ast-167">'backup_sites'</span></span>]</span>[<span id="ast-168"><span id="ast-169" class="other_trans">site</span></span>]</span>[<span id="ast-170"><span id="ast-171">'basebackups'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-172">basebackups</span></span><span id="ast-173"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-174">(<span id="ast-175"><span id="ast-176"><span id="ast-177" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-179" class="other_trans">m_time</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;working(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">candidate</span>,&nbsp;<span id="ast-5" class="other_trans">status</span>,&nbsp;<span id="ast-6" class="other_trans">worker_id</span>,&nbsp;<span id="ast-8" class="other_trans">can_be_killed</span></span>):<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-14">(<span id="ast-15">(<span id="ast-16">(<span id="ast-17">(<span id="ast-18">(<span id="ast-19">'Worker&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">str</span>(<span id="ast-23" class="other_trans">worker_id</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-25">'&nbsp;informed&nbsp;me&nbsp;about&nbsp;work&nbsp;in&nbsp;status&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">str</span>(<span id="ast-29" class="other_trans">status</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-31">'on&nbsp;candidate&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">str</span>(<span id="ast-35" class="incorrect_node">candidate&nbsp;&rarr;&nbsp;worker_id&nbsp;</span>)</span>)</span>)</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.perform_candidate_state_check</span>(<span id="ast-40" class="other_trans">candidate</span>)</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43" class="other_trans">status</span><span id="ast-44" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-45">'finished'</span>)</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.deal_with_finished</span>(<span id="ast-50" class="other_trans">candidate</span>)</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52">(<span id="ast-53"><span id="ast-54" class="other_trans">len</span>(<span id="ast-55"><span id="ast-56">self</span>.finished_candidates</span>)</span><span id="ast-57" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-58"><span id="ast-59">self</span>.initial_random_runs</span>)</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._refit_gp</span>()</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;launch(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">args</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>flags</span>&nbsp;=&nbsp;<span id="ast-7">0</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>target_args</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">args</span>.get</span>(<span id="ast-13">'args'</span>,&nbsp;<span id="ast-14" class="other_trans">None</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">target_args</span><span id="ast-18" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-19" class="other_trans">None</span>)</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>target_args</span>&nbsp;=&nbsp;<span id="ast-22">[<span id="ast-23"><span id="ast-24" class="other_trans">str</span>(<span id="ast-25" class="other_trans">arg</span>)</span><span id="ast-26">&nbsp;for&nbsp;<span id="ast-27" class="other_trans">arg</span>&nbsp;in&nbsp;<span id="ast-28" class="correct_node">args&nbsp;&rarr;&nbsp;target_args&nbsp;</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;validate_proxy_ticket(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">request</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Given&nbsp;a&nbsp;``request``,&nbsp;validate&nbsp;a&nbsp;proxy&nbsp;ticket&nbsp;string.&nbsp;On&nbsp;success,&nbsp;a\\u000a&nbsp;&nbsp;&nbsp;&nbsp;4-tuple&nbsp;is&nbsp;returned&nbsp;containing&nbsp;the&nbsp;``ProxyTicket``,&nbsp;a&nbsp;list&nbsp;of&nbsp;all\\u000a&nbsp;&nbsp;&nbsp;&nbsp;services&nbsp;that&nbsp;proxied&nbsp;authentication&nbsp;and&nbsp;an&nbsp;optional\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``ProxyGrantingTicket``,&nbsp;with&nbsp;no&nbsp;error.&nbsp;On&nbsp;error,&nbsp;a&nbsp;triplet&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;returned&nbsp;containing&nbsp;no&nbsp;``ProxyTicket``&nbsp;or&nbsp;``ProxyGrantingTicket``,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;with&nbsp;an&nbsp;``Error``&nbsp;describing&nbsp;what&nbsp;went&nbsp;wrong.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>service</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">request</span>.GET</span>.get</span>(<span id="ast-13">'service'</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ticket</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">request</span>.GET</span>.get</span>(<span id="ast-20">'ticket'</span>)</span></span><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pgturl</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">request</span>.GET</span>.get</span>(<span id="ast-27">'pgtUrl'</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.debug</span>(<span id="ast-32">(<span id="ast-33">'Proxy&nbsp;validation&nbsp;request&nbsp;received&nbsp;for&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-35" class="other_trans">ticket</span>)</span>)</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pt</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">ProxyTicket</span>.objects</span>.validate_ticket</span>(<span id="ast-43" class="other_trans">ticket</span>,&nbsp;service=<span id="ast-45" class="other_trans">service</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-47">(<span id="ast-48">InvalidRequestError</span>,&nbsp;<span id="ast-49" class="other_trans">InvalidTicketError</span>,&nbsp;<span id="ast-50" class="other_trans">InvalidServiceError</span>,&nbsp;<span id="ast-51">InternalError</span>)</span>&nbsp;as&nbsp;<span id="ast-52" class="other_trans">e</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.warn</span>(<span id="ast-57">(<span id="ast-58">'%s&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-60">(<span id="ast-61"><span id="ast-62" class="incorrect_node">e&nbsp;&rarr;&nbsp;request&nbsp;</span>.code</span>,&nbsp;<span id="ast-63" class="other_trans">e</span>)</span>)</span>)</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-65">(<span id="ast-66">None</span>,&nbsp;<span id="ast-67">None</span>,&nbsp;<span id="ast-68" class="other_trans">None</span>,&nbsp;<span id="ast-69" class="other_trans">e</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_binary_control_fragment(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">stb_i</span>,&nbsp;<span id="ast-5" class="other_trans">ack_o</span>,&nbsp;<span id="ast-6" class="other_trans">stb_o</span>,&nbsp;<span id="ast-7" class="other_trans">ack_i</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>valid</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11">Signal</span>(<span id="ast-12"><span id="ast-13" class="other_trans">BV</span>(<span id="ast-14"><span id="ast-15">self</span>.latency</span>)</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19">self</span>.latency</span><span id="ast-20" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-21">1</span>)</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sync</span>&nbsp;=&nbsp;<span id="ast-24">[<span id="ast-25"><span id="ast-26">If</span>(<span id="ast-27"><span id="ast-28">self</span>.pipe_ce</span>,&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">valid</span>.eq</span>(<span id="ast-32"><span id="ast-33">Cat</span>(<span id="ast-34" class="other_trans">stb_i</span>,&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">valid</span>[<span id="ast-37">:<span id="ast-38">(<span id="ast-39"><span id="ast-40">self</span>.latency</span>&nbsp;-&nbsp;<span id="ast-42">1</span>)</span></span>]</span>)</span>)</span>)</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sync</span>&nbsp;=&nbsp;<span id="ast-45">[<span id="ast-46"><span id="ast-47" class="other_trans">If</span>(<span id="ast-48"><span id="ast-49">self</span>.pipe_ce</span>,&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">valid</span>.eq</span>(<span id="ast-53" class="other_trans">stb_i</span>)</span>)</span>]</span></span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>last_valid</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57" class="other_trans">valid</span>[<span id="ast-58"><span id="ast-59">(<span id="ast-60"><span id="ast-61">self</span>.latency</span>&nbsp;-&nbsp;<span id="ast-63">1</span>)</span></span>]</span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>comb</span>&nbsp;=&nbsp;<span id="ast-66">[<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70">self</span>.pipe_ce</span>.eq</span>(<span id="ast-71">(<span id="ast-72" class="other_trans">ack_i</span>&nbsp;|&nbsp;<span id="ast-74">(<span id="ast-75">~</span><span id="ast-76" class="other_trans">last_valid</span>)</span>)</span>)</span>,&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans">ack_o</span>.eq</span>(<span id="ast-80"><span id="ast-81">self</span>.pipe_ce</span>)</span>,&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans">stb_o</span>.eq</span>(<span id="ast-85" class="other_trans">last_valid</span>)</span>,&nbsp;<span id="ast-86"><span id="ast-87"><span id="ast-88" class="ref_node">busy&nbsp;&rarr;&nbsp;self.&nbsp;</span>.eq</span>(<span id="ast-89"><span id="ast-90">optree</span>(<span id="ast-91">'|'</span>,&nbsp;<span id="ast-92">[<span id="ast-93"><span id="ast-94" class="other_trans">valid</span>[<span id="ast-95"><span id="ast-96" class="other_trans">i</span></span>]</span><span id="ast-97">&nbsp;for&nbsp;<span id="ast-98" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-99"><span id="ast-100" class="other_trans">range</span>(<span id="ast-101"><span id="ast-102">self</span>.latency</span>)</span></span>]</span>)</span>)</span>]</span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-104"><span id="ast-105">Fragment</span>(<span id="ast-106" class="other_trans">comb</span>,&nbsp;<span id="ast-107" class="other_trans">sync</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_format(<span id="ast-2"><span id="ast-3" class="other_trans">factors</span>,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Format&nbsp;the&nbsp;product&nbsp;of&nbsp;(base,&nbsp;exponent)&nbsp;pairs&nbsp;as&nbsp;a&nbsp;string\\u000a&nbsp;&nbsp;&nbsp;&nbsp;**Parameters:**\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;*factors*:&nbsp;List&nbsp;of&nbsp;(base,&nbsp;exponent)&nbsp;pairs\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Each&nbsp;base&nbsp;is&nbsp;a&nbsp;string&nbsp;that&nbsp;represents&nbsp;the&nbsp;base&nbsp;of&nbsp;a&nbsp;factor.&nbsp;&nbsp;Each\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exponent&nbsp;is&nbsp;a&nbsp;number&nbsp;(:class:`numbers.Number`&nbsp;instance).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;*mul*:&nbsp;String&nbsp;used&nbsp;to&nbsp;represent&nbsp;multiplication\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;*div*:&nbsp;String&nbsp;used&nbsp;to&nbsp;represent&nbsp;division\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;*div*&nbsp;is&nbsp;*None*,&nbsp;then&nbsp;negative&nbsp;powers&nbsp;are&nbsp;used&nbsp;instead&nbsp;of&nbsp;division.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;*group*:&nbsp;Format&nbsp;used&nbsp;to&nbsp;group&nbsp;an&nbsp;expression\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;string&nbsp;must&nbsp;contain&nbsp;'{0}'&nbsp;as&nbsp;a&nbsp;placeholder&nbsp;for&nbsp;the&nbsp;grouped\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expression.&nbsp;&nbsp;If&nbsp;*group*&nbsp;is&nbsp;*None*,&nbsp;the&nbsp;multiple&nbsp;division&nbsp;operators&nbsp;will\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;be&nbsp;used&nbsp;if&nbsp;necessary.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;*base_fmt*:&nbsp;Function&nbsp;that&nbsp;takes&nbsp;a&nbsp;base&nbsp;(string)&nbsp;and&nbsp;formats&nbsp;it&nbsp;as&nbsp;a&nbsp;string\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;*exp_fmt*:&nbsp;Function&nbsp;that&nbsp;takes&nbsp;an&nbsp;exponent&nbsp;(number)&nbsp;and&nbsp;formats&nbsp;it&nbsp;as&nbsp;a\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9" class="other_trans">factors</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-11">''</span></span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mul</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">kwargs</span>[<span id="ast-16"><span id="ast-17">'mul'</span></span>]</span></span><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>div</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21">kwargs</span>[<span id="ast-22"><span id="ast-23">'div'</span></span>]</span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>group</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27">kwargs</span>[<span id="ast-28"><span id="ast-29">'group'</span></span>]</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>base_fmt</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">kwargs</span>[<span id="ast-34"><span id="ast-35">'base_fmt'</span></span>]</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37" class="other_trans">div</span>:<span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>exp_fmt</span>&nbsp;=&nbsp;<span id="ast-40">lambda&nbsp;<span id="ast-41"><span id="ast-42">x</span></span>:&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45">kwargs</span>[<span id="ast-46"><span id="ast-47">'exp_fmt'</span></span>]</span>(<span id="ast-48"><span id="ast-49">abs</span>(<span id="ast-50" class="other_trans">x</span>)</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>exp_fmt</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54">kwargs</span>[<span id="ast-55"><span id="ast-56">'exp_fmt'</span></span>]</span></span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>num_terms</span>&nbsp;=&nbsp;<span id="ast-59">[]</span></span><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>den_terms</span>&nbsp;=&nbsp;<span id="ast-62">[]</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-64">(<span id="ast-65" class="other_trans">b</span>,&nbsp;<span id="ast-66" class="other_trans">e</span>)</span>&nbsp;in&nbsp;<span id="ast-67"><span id="ast-68">sorted</span>(<span id="ast-69" class="other_trans">factors</span>)</span>:<span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73" class="other_trans">base_fmt</span>(<span id="ast-74" class="other_trans">b</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-76">(<span id="ast-77" class="other_trans">e</span><span id="ast-78" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-79">1</span>)</span>:<span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>num_terms</span>.append</span>(<span id="ast-84" class="other_trans">base</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-86">(<span id="ast-87" class="other_trans">e</span><span id="ast-88" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-89">0</span>)</span>:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>num_terms</span>.append</span>(<span id="ast-94">(<span id="ast-95" class="other_trans">base</span>&nbsp;+&nbsp;<span id="ast-97"><span id="ast-98" class="other_trans">exp_fmt</span>(<span id="ast-99">e</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-101">(<span id="ast-103">(<span id="ast-104" class="other_trans">e</span><span id="ast-105" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-106">-1</span>)</span>&nbsp;and&nbsp;<span id="ast-107">div</span>)</span>:<span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>den_terms</span>.append</span>(<span id="ast-112">base</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>den_terms</span>.append</span>(<span id="ast-117">(<span id="ast-118" class="other_trans">base</span>&nbsp;+&nbsp;<span id="ast-120"><span id="ast-121" class="other_trans">exp_fmt</span>(<span id="ast-122" class="other_trans">e</span>)</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;visit_callfunc(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">node</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6"><span id="ast-7">self</span>._is_form_class</span>:<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ass_name</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">next</span>(<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">node</span>.parent</span>.get_children</span>()</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">isinstance</span>(<span id="ast-19" class="other_trans">ass_name</span>,&nbsp;<span id="ast-20" class="other_trans">AssName</span>)</span>:<span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>field_name</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">ass_name</span>.name</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">safe_infer</span>(<span id="ast-29" class="other_trans">node</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-33">(<span id="ast-34" class="other_trans">val</span><span id="ast-35" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-36" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-37">(<span id="ast-38" class="other_trans">val</span><span id="ast-39" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-40" class="other_trans">YES</span>)</span>)</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">val</span>.is_subtype_of</span>(<span id="ast-45">'django.forms.fields.Field'</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">field_name</span><span id="ast-49">&nbsp;in&nbsp;</span><span id="ast-50"><span id="ast-51">self</span>._form_field_names</span>)</span>:<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.add_message</span>(<span id="ast-56">'form-field-redefinition'</span>,&nbsp;node=<span id="ast-58" class="ref_node">node&nbsp;&rarr;&nbsp;ass_name&nbsp;</span>,&nbsp;args=<span id="ast-60">(<span id="ast-61"><span id="ast-62">self</span>._form_name</span>,&nbsp;<span id="ast-63" class="other_trans">field_name</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._form_field_names</span>.add</span>(<span id="ast-69" class="other_trans">field_name</span>)</span></span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;start_cluster(<span id="ast-2"><span id="ast-3" class="other_trans">num_workers</span>,&nbsp;<span id="ast-4" class="other_trans">use_cluster_workers</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Start&nbsp;a&nbsp;cluster&nbsp;with&nbsp;``num_workers``&nbsp;workers.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;use_cluster_workers&nbsp;is&nbsp;True,&nbsp;then&nbsp;use&nbsp;the&nbsp;remote&nbsp;workers\\u000a&nbsp;&nbsp;&nbsp;&nbsp;defined&nbsp;in&nbsp;`spartan.config`.&nbsp;&nbsp;Otherwise,&nbsp;workers&nbsp;are&nbsp;all\\u000a&nbsp;&nbsp;&nbsp;&nbsp;spawned&nbsp;on&nbsp;the&nbsp;localhost.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;num_workers:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;use_cluster_workers:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9">not</span>&nbsp;<span id="ast-10">use_cluster_workers</span>)</span>:<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_start_remote_worker</span>(<span id="ast-14">'localhost'</span>,&nbsp;<span id="ast-15">0</span>,&nbsp;<span id="ast-16" class="other_trans">num_workers</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>available_workers</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20">sum</span>(<span id="ast-21">[<span id="ast-22" class="other_trans">cnt</span><span id="ast-23">&nbsp;for&nbsp;<span id="ast-24">(<span id="ast-25" class="other_trans">_</span>,&nbsp;<span id="ast-26" class="other_trans">cnt</span>)</span>&nbsp;in&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">FLAGS</span>.hosts</span></span>]</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-30">(<span id="ast-31" class="other_trans">available_workers</span><span id="ast-32" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-33" class="other_trans">num_workers</span>)</span>,&nbsp;<span id="ast-34">'Insufficient&nbsp;slots&nbsp;to&nbsp;run&nbsp;all&nbsp;workers.'</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-37">0</span></span><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>num_hosts</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">len</span>(<span id="ast-42"><span id="ast-43">FLAGS</span>.hosts</span>)</span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-45">(<span id="ast-46" class="other_trans">worker</span>,&nbsp;<span id="ast-47" class="other_trans">total_tasks</span>)</span>&nbsp;in&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">FLAGS</span>.hosts</span>:<span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-53">FLAGS</span>.assign_mode</span><span id="ast-54" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-55"><span id="ast-56">AssignMode</span>.BY_CORE</span>)</span>:<span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sz</span>&nbsp;=&nbsp;<span id="ast-59" class="other_trans">total_tasks</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sz</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64">util</span>.divup</span>(<span id="ast-65" class="other_trans">num_workers</span>,&nbsp;<span id="ast-66" class="other_trans">num_hosts</span>)</span></span></span><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sz</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70">min</span>(<span id="ast-71" class="other_trans">sz</span>,&nbsp;<span id="ast-72">(<span id="ast-73" class="other_trans">num_workers</span>&nbsp;-&nbsp;<span id="ast-75" class="other_trans">count</span>)</span>)</span></span><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_start_remote_worker</span>(<span id="ast-79">worker</span>,&nbsp;<span id="ast-80" class="other_trans">count</span>,&nbsp;<span id="ast-81">(<span id="ast-82">count</span>&nbsp;+&nbsp;<span id="ast-84" class="other_trans">sz</span>)</span>)</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;+=&nbsp;<span id="ast-88" class="other_trans">sz</span></span><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-90">(<span id="ast-91" class="other_trans">count</span><span id="ast-92" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-93">num_workers</span>)</span>:<span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_search(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.test_search</span>&nbsp;=&nbsp;<span id="ast-7">'Calpers&nbsp;special&nbsp;review'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.obj_list</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.public_client</span>.documents</span>.search</span>(<span id="ast-16"><span id="ast-17">self</span>.test_search</span>)</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.obj</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.obj_list</span>[<span id="ast-24"><span id="ast-25">0</span></span>]</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-30"><span id="ast-31" class="other_trans">isinstance</span>(<span id="ast-32"><span id="ast-33">self</span>.obj_list</span>,&nbsp;<span id="ast-34" class="other_trans">list</span>)</span>)</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-39"><span id="ast-40" class="other_trans">isinstance</span>(<span id="ast-41"><span id="ast-42">self</span>.obj</span>,&nbsp;<span id="ast-43" class="other_trans">Document</span>)</span>)</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.obj</span>.__str__</span>()</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.obj</span>.__unicode__</span>()</span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>attr_list</span>&nbsp;=&nbsp;<span id="ast-56">[<span id="ast-57">'access'</span>,&nbsp;<span id="ast-58">'annotations'</span>,&nbsp;<span id="ast-59">'canonical_url'</span>,&nbsp;<span id="ast-60">'contributor'</span>,&nbsp;<span id="ast-61">'contributor_organization'</span>,&nbsp;<span id="ast-62">'created_at'</span>,&nbsp;<span id="ast-63">'description'</span>,&nbsp;<span id="ast-64">'id'</span>,&nbsp;<span id="ast-65">'pages'</span>,&nbsp;<span id="ast-66">'resources'</span>,&nbsp;<span id="ast-67">'sections'</span>,&nbsp;<span id="ast-68">'source'</span>,&nbsp;<span id="ast-69">'title'</span>,&nbsp;<span id="ast-70">'updated_at'</span>,&nbsp;<span id="ast-71">'data'</span>,&nbsp;<span id="ast-72">'file_hash'</span>]</span></span><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-74" class="other_trans">attr</span>&nbsp;in&nbsp;<span id="ast-75" class="other_trans">attr_list</span>:<span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-80"><span id="ast-81" class="other_trans">hasattr</span>(<span id="ast-82"><span id="ast-83">self</span>.obj</span>,&nbsp;<span id="ast-84" class="other_trans">attr</span>)</span>)</span></span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-89">(<span id="ast-90"><span id="ast-91" class="other_trans">len</span>(<span id="ast-92"><span id="ast-93" class="correct_node">obj&nbsp;&rarr;&nbsp;self.&nbsp;</span>.full_text</span>)</span><span id="ast-94" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-95">0</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;edges_unique(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;unique&nbsp;edges&nbsp;of&nbsp;the&nbsp;mesh.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;edges_unique:&nbsp;(n,2)&nbsp;int,&nbsp;set&nbsp;of&nbsp;vertex&nbsp;indices&nbsp;for&nbsp;unique&nbsp;edges\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cached</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>._cache</span>[<span id="ast-11"><span id="ast-12">'edges_unique'</span></span>]</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15" class="other_trans">cached</span><span id="ast-16" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-17" class="other_trans">None</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-19" class="other_trans">cached</span></span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>unique</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">grouping</span>.unique_rows</span>(<span id="ast-26"><span id="ast-27">self</span>.edges_sorted</span>)</span>[<span id="ast-28"><span id="ast-29">0</span></span>]</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>edges_unique</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33" class="correct_node">edges_sorted&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-34"><span id="ast-35" class="other_trans">unique</span></span>]</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._cache</span>[<span id="ast-40"><span id="ast-41">'edges_unique'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-42" class="other_trans">edges_unique</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-44" class="other_trans">edges_unique</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;import_tags(<span id="ast-2"><span id="ast-3" class="other_trans">source</span>,&nbsp;<span id="ast-4" class="other_trans">target</span>,&nbsp;<span id="ast-5">project_id</span>,&nbsp;<span id="ast-6">collected_tags</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tags_to_import_now</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10">set</span>(<span id="ast-11">[]</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tags_to_import_then</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15">set</span>(<span id="ast-16">[]</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-18">tag</span>&nbsp;in&nbsp;<span id="ast-19" class="other_trans">collected_tags</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">is_prefix_of_any_other_tag</span>(<span id="ast-23" class="other_trans">tag</span>,&nbsp;<span id="ast-24" class="other_trans">collected_tags</span>)</span>:<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tags_to_import_then</span>.add</span>(<span id="ast-29" class="other_trans">tag</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tags_to_import_now</span>.add</span>(<span id="ast-34" class="other_trans">tag</span>)</span></span></span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>last_page</span>&nbsp;=&nbsp;<span id="ast-37">False</span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_page</span>&nbsp;=&nbsp;<span id="ast-40">1</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-42">(<span id="ast-43">not</span>&nbsp;<span id="ast-44">last_page</span>)</span>:<span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stories</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">source</span>.get_stories_for_project</span>(<span id="ast-50">project_id</span>,&nbsp;<span id="ast-51" class="other_trans">current_page</span>)</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-53" class="other_trans">story</span>&nbsp;in&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">stories</span>[<span id="ast-56"><span id="ast-57">u'items'</span></span>]</span>:<span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59">(<span id="ast-60">u'tags'</span><span id="ast-61">&nbsp;in&nbsp;</span><span id="ast-62">story</span>)</span>:<span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-64" class="other_trans">tag</span>&nbsp;in&nbsp;<span id="ast-65">[<span id="ast-66"><span id="ast-67" class="other_trans">t</span>[<span id="ast-68"><span id="ast-69">u'name'</span></span>]</span><span id="ast-70">&nbsp;for&nbsp;<span id="ast-71" class="other_trans">t</span>&nbsp;in&nbsp;<span id="ast-72"><span id="ast-73">story</span>[<span id="ast-74"><span id="ast-75">u'tags'</span></span>]</span>&nbsp;if&nbsp;<span id="ast-76">(<span id="ast-77"><span id="ast-78" class="other_trans">t</span>[<span id="ast-79"><span id="ast-80">u'name'</span></span>]</span><span id="ast-81">&nbsp;in&nbsp;</span><span id="ast-82">tags_to_import_now</span>)</span></span>]</span>:<span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>target</span>.executeCommand</span>(<span id="ast-87">(<span id="ast-88">'%s-%s'</span>&nbsp;%&nbsp;<span id="ast-90">(<span id="ast-91">project_id</span>,&nbsp;<span id="ast-92"><span id="ast-93" class="other_trans">story</span>[<span id="ast-94"><span id="ast-95">u'id'</span></span>]</span>)</span>)</span>,&nbsp;<span id="ast-96">(<span id="ast-97">'tag&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-99" class="other_trans">tag</span>)</span>)</span></span></span></span></span><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>current_page</span>&nbsp;+=&nbsp;<span id="ast-103">1</span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-105">(<span id="ast-106" class="other_trans">current_page</span><span id="ast-107" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-108"><span id="ast-109">stories</span>[<span id="ast-110"><span id="ast-111">u'totalPages'</span></span>]</span>)</span>:<span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last_page</span>&nbsp;=&nbsp;<span id="ast-114">True</span></span></span></span><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-116"><span id="ast-117">len</span>(<span id="ast-118" class="other_trans">tags_to_import_then</span>)</span>:<span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import_tags</span>(<span id="ast-122" class="other_trans">source</span>,&nbsp;<span id="ast-123" class="other_trans">target</span>,&nbsp;<span id="ast-124" class="other_trans">project_id</span>,&nbsp;<span id="ast-125">tags_to_import_then</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;checkpoint(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">result</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9"><span id="ast-10">self</span>.read_only</span>)</span>:<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>handle</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.trials</span>.handle</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>handle</span>.refresh</span>(<span id="ast-20"><span id="ast-21">self</span>.current_job</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">result</span><span id="ast-25" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-26" class="other_trans">None</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28"><span id="ast-29">hasattr</span>(<span id="ast-30">result</span>,&nbsp;<span id="ast-31">'keys'</span>)</span>:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">handle</span>.update</span>(<span id="ast-36"><span id="ast-37">self</span>.current_job</span>,&nbsp;<span id="ast-38"><span id="ast-39">dict</span>(result=<span id="ast-41" class="other_trans">result</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-43"><span id="ast-44">isinstance</span>(<span id="ast-45">result</span>,&nbsp;<span id="ast-46" class="other_trans">list</span>)</span></span><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>orig_result</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">result</span>[<span id="ast-51"><span id="ast-52">0</span></span>]</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">hasattr</span>(<span id="ast-56">orig_result</span>,&nbsp;<span id="ast-57">'keys'</span>)</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">all</span>(<span id="ast-61">[<span id="ast-62">(<span id="ast-64"><span id="ast-65">isinstance</span>(<span id="ast-66">x</span>,&nbsp;<span id="ast-67" class="other_trans">tuple</span>)</span>&nbsp;and&nbsp;<span id="ast-68">(<span id="ast-69"><span id="ast-70">len</span>(<span id="ast-71" class="other_trans">x</span>)</span><span id="ast-72" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-73">2</span>)</span>)</span><span id="ast-74">&nbsp;for&nbsp;<span id="ast-75" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-76"><span id="ast-77" class="other_trans">result</span>[<span id="ast-78"><span id="ast-79">1</span>:</span>]</span></span>]</span>)</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-81">[<span id="ast-82">(<span id="ast-84"><span id="ast-85">hasattr</span>(<span id="ast-86"><span id="ast-87">x</span>[<span id="ast-88"><span id="ast-89">0</span></span>]</span>,&nbsp;<span id="ast-90">'keys'</span>)</span>&nbsp;and&nbsp;<span id="ast-91"><span id="ast-92">hasattr</span>(<span id="ast-93"><span id="ast-94">x</span>[<span id="ast-95"><span id="ast-96">1</span></span>]</span>,&nbsp;<span id="ast-97">'keys'</span>)</span>)</span><span id="ast-98">&nbsp;for&nbsp;<span id="ast-99">x</span>&nbsp;in&nbsp;<span id="ast-100"><span id="ast-101">result</span>[<span id="ast-102"><span id="ast-103">1</span>:</span>]</span></span>]</span></span><span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return_val</span>&nbsp;=&nbsp;<span id="ast-106">[]</span></span><span id="ast-107"><span id="ast-108" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>orig_result_return</span>&nbsp;=&nbsp;<span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans">handle</span>.update</span>(<span id="ast-112"><span id="ast-113">self</span>.current_job</span>,&nbsp;<span id="ast-114"><span id="ast-115">dict</span>(result=<span id="ast-117" class="ref_node">result&nbsp;&rarr;&nbsp;orig_result&nbsp;</span>)</span>)</span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return_val</span>.append</span>(<span id="ast-122">orig_result_return</span>)</span></span><span id="ast-123"><span id="ast-124" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>num_new</span>&nbsp;=&nbsp;<span id="ast-125">(<span id="ast-126"><span id="ast-127">len</span>(<span id="ast-128" class="other_trans">result</span>)</span>&nbsp;-&nbsp;<span id="ast-130">1</span>)</span></span><span id="ast-131"><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_ids</span>&nbsp;=&nbsp;<span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136">self</span>.trials</span>.new_trial_ids</span>(<span id="ast-137" class="other_trans">num_new</span>)</span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-139">(<span id="ast-140">new_tid</span>,&nbsp;<span id="ast-141" class="other_trans">r</span>)</span>&nbsp;in&nbsp;<span id="ast-142"><span id="ast-143">zip</span>(<span id="ast-144" class="other_trans">new_ids</span>,&nbsp;<span id="ast-145"><span id="ast-146" class="other_trans">result</span>[<span id="ast-147"><span id="ast-148">1</span>:</span>]</span>)</span>:<span id="ast-149"><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-151">spec</span>,&nbsp;<span id="ast-152">res</span>)</span>&nbsp;=&nbsp;<span id="ast-153">r</span></span><span id="ast-154"><span id="ast-155" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_rec</span>&nbsp;=&nbsp;<span id="ast-156"><span id="ast-157"><span id="ast-158" class="other_trans">copy</span>.deepcopy</span>(<span id="ast-159"><span id="ast-160">self</span>.current_job</span>)</span></span><span id="ast-161"><span id="ast-162"><span id="ast-163"><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_rec</span>.pop</span>(<span id="ast-165">'_id'</span>)</span></span><span id="ast-166"><span id="ast-167" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>old_tid</span>&nbsp;=&nbsp;<span id="ast-168"><span id="ast-169"><span id="ast-170"><span id="ast-171" class="other_trans">new_rec</span>[<span id="ast-172"><span id="ast-173">'misc'</span></span>]</span>.pop</span>(<span id="ast-174">'tid'</span>)</span></span><span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-176">(<span id="ast-177">old_tid</span><span id="ast-178" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-179"><span id="ast-180"><span id="ast-181">new_rec</span>.pop</span>(<span id="ast-182">'tid'</span>)</span>)</span></span><span id="ast-183"><span id="ast-184"><span id="ast-185"><span id="ast-186" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_rec</span>[<span id="ast-187"><span id="ast-188">'misc'</span></span>]</span>[<span id="ast-189"><span id="ast-190">'from_tid'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-191">old_tid</span></span><span id="ast-192"><span id="ast-193"><span id="ast-194"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_rec</span>[<span id="ast-195"><span id="ast-196">'tid'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-197">new_tid</span></span><span id="ast-198"><span id="ast-199"><span id="ast-200"><span id="ast-201"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_rec</span>[<span id="ast-202"><span id="ast-203">'misc'</span></span>]</span>[<span id="ast-204"><span id="ast-205">'tid'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-206" class="other_trans">new_tid</span></span><span id="ast-207"><span id="ast-208"><span id="ast-209" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_rec</span>[<span id="ast-210"><span id="ast-211">config_name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-212">spec</span></span><span id="ast-213"><span id="ast-214"><span id="ast-215"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_rec</span>[<span id="ast-216"><span id="ast-217">'result'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-218">res</span></span><span id="ast-219"><span id="ast-220" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_id</span>&nbsp;=&nbsp;<span id="ast-221"><span id="ast-222"><span id="ast-223">handle</span>.insert_trial_docs</span>(<span id="ast-224">[<span id="ast-225">new_rec</span>]</span>)</span></span><span id="ast-226"><span id="ast-227"><span id="ast-228"><span id="ast-229"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return_val</span>.append</span>(<span id="ast-230" class="other_trans">new_id</span>)</span></span></span><span id="ast-231"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-232">return_val</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;dirlogs(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">path_parts</span>,&nbsp;<span id="ast-5">rev</span>,&nbsp;<span id="ast-6">entries</span>,&nbsp;<span id="ast-7">options</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fsroot</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>._getroot</span>(<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>._getrev</span>(<span id="ast-16" class="other_trans">rev</span>)</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rev</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>._getrev</span>(<span id="ast-22" class="other_trans">rev</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25">not</span>&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">vclib</span>.check_path_access</span>(<span id="ast-29">self</span>,&nbsp;<span id="ast-30">path_parts</span>,&nbsp;<span id="ast-31"><span id="ast-32">vclib</span>.DIR</span>,&nbsp;<span id="ast-33" class="other_trans">rev</span>)</span>)</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37">vclib</span>.ItemNotFound</span>(<span id="ast-38" class="other_trans">path_parts</span>)</span></span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-40">entry</span>&nbsp;in&nbsp;<span id="ast-41" class="other_trans">entries</span>:<span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry_path_parts</span>&nbsp;=&nbsp;<span id="ast-44">(<span id="ast-45">path_parts</span>&nbsp;+&nbsp;<span id="ast-47">[<span id="ast-48"><span id="ast-49">entry</span>.name</span>]</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52">not</span>&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">vclib</span>.check_path_access</span>(<span id="ast-56">self</span>,&nbsp;<span id="ast-57" class="other_trans">entry_path_parts</span>,&nbsp;<span id="ast-58"><span id="ast-59">entry</span>.kind</span>,&nbsp;<span id="ast-60">rev</span>)</span>)</span>:<span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66">self</span>._getpath</span>(<span id="ast-67" class="other_trans">entry_path_parts</span>)</span></span><span id="ast-68"><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry_rev</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71" class="incorrect_node">_get_last_history_rev&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-72" class="other_trans">fsroot</span>,&nbsp;<span id="ast-73">path</span>)</span></span><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-76" class="other_trans">date</span>,&nbsp;<span id="ast-77">author</span>,&nbsp;<span id="ast-78" class="other_trans">msg</span>,&nbsp;<span id="ast-79">changes</span>)</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82">self</span>.revinfo</span>(<span id="ast-83">entry_rev</span>)</span></span><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry</span>.rev</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88">str</span>(<span id="ast-89" class="ref_node">rev&nbsp;&rarr;&nbsp;entry_rev&nbsp;</span>)</span></span><span id="ast-90"><span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry</span>.date</span>&nbsp;=&nbsp;<span id="ast-93">date</span></span><span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry</span>.author</span>&nbsp;=&nbsp;<span id="ast-97" class="other_trans">author</span></span><span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry</span>.log</span>&nbsp;=&nbsp;<span id="ast-101">msg</span></span><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-103">(<span id="ast-104"><span id="ast-105" class="other_trans">entry</span>.kind</span><span id="ast-106" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-107"><span id="ast-108">vclib</span>.FILE</span>)</span>:<span id="ast-109"><span id="ast-110"><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry</span>.size</span>&nbsp;=&nbsp;<span id="ast-112"><span id="ast-113"><span id="ast-114" class="other_trans">fs</span>.file_length</span>(<span id="ast-115" class="other_trans">fsroot</span>,&nbsp;<span id="ast-116" class="other_trans">path</span>)</span></span></span><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lock</span>&nbsp;=&nbsp;<span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans">fs</span>.get_lock</span>(<span id="ast-122"><span id="ast-123">self</span>.fs_ptr</span>,&nbsp;<span id="ast-124">path</span>)</span></span><span id="ast-125"><span id="ast-126"><span id="ast-127" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>entry</span>.lockinfo</span>&nbsp;=&nbsp;<span id="ast-128">(<span id="ast-130">(<span id="ast-132">lock</span>&nbsp;and&nbsp;<span id="ast-133"><span id="ast-134" class="other_trans">lock</span>.owner</span>)</span>&nbsp;or&nbsp;<span id="ast-135" class="other_trans">None</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;upload_hockeyapp(<span id="ast-2"><span id="ast-3">token</span>,&nbsp;<span id="ast-4" class="other_trans">appid</span>,&nbsp;<span id="ast-5" class="other_trans">notification</span>,&nbsp;<span id="ast-7">status</span>,&nbsp;<span id="ast-9" class="other_trans">mandatory</span>,&nbsp;<span id="ast-11" class="other_trans">tags</span></span>):<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-14">requests</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ipa_path</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-21"><span id="ast-22"><span id="ast-23">os</span>.environ</span>[<span id="ast-24"><span id="ast-25">'XCS_OUTPUT_DIR'</span></span>]</span>,&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28">os</span>.environ</span>[<span id="ast-29"><span id="ast-30">'XCS_PRODUCT'</span></span>]</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33">not</span>&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">os</span>.path</span>.exists</span>(<span id="ast-38" class="other_trans">ipa_path</span>)</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-40"><span id="ast-41">Exception</span>(<span id="ast-42">(<span id="ast-43">"Can't&nbsp;find&nbsp;%s."</span>&nbsp;%&nbsp;<span id="ast-45" class="other_trans">ipa_path</span>)</span>)</span></span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dsym_path</span>&nbsp;=&nbsp;<span id="ast-48">'/tmp/cavejohnson.dSYM.zip'</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>subprocess</span>.check_output</span>(<span id="ast-53">(<span id="ast-54">'cd&nbsp;%s&nbsp;&amp;&amp;&nbsp;zip&nbsp;-r&nbsp;%s&nbsp;dSYMs'</span>&nbsp;%&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58"><span id="ast-59">os</span>.environ</span>[<span id="ast-60"><span id="ast-61">'XCS_ARCHIVE'</span></span>]</span>,&nbsp;<span id="ast-62" class="other_trans">dsym_path</span>)</span>)</span>,&nbsp;shell=<span id="ast-64">True</span>)</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66">(<span id="ast-67">not</span>&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71">os</span>.path</span>.exists</span>(<span id="ast-72" class="other_trans">dsym_path</span>)</span>)</span>:<span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-74"><span id="ast-75" class="other_trans">Exception</span>(<span id="ast-76">(<span id="ast-77">'Error&nbsp;processing&nbsp;dsym&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-79">dsym_path</span>)</span>)</span></span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-81"><span id="ast-82">open</span>(<span id="ast-83" class="other_trans">dsym_path</span>,&nbsp;<span id="ast-84">'rb'</span>)</span>&nbsp;as&nbsp;<span id="ast-85">dsym</span>:<span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-87"><span id="ast-88" class="other_trans">open</span>(<span id="ast-89" class="other_trans">ipa_path</span>,&nbsp;<span id="ast-90">'rb'</span>)</span>&nbsp;as&nbsp;<span id="ast-91" class="other_trans">ipa</span>:<span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>files</span>&nbsp;=&nbsp;<span id="ast-94">{<span id="ast-95">'ipa'</span>:&nbsp;<span id="ast-97" class="other_trans">ipa</span>,&nbsp;<span id="ast-96">'dsym'</span>:&nbsp;<span id="ast-98" class="other_trans">dsym</span>}</span></span><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-101">{<span id="ast-102">'notes'</span>:&nbsp;<span id="ast-106"><span id="ast-107" class="other_trans">get_commit_log</span>()</span>,&nbsp;<span id="ast-103">'notes_type'</span>:&nbsp;<span id="ast-108">'1'</span>,&nbsp;<span id="ast-104">'commit_sha'</span>:&nbsp;<span id="ast-109"><span id="ast-110">get_sha</span>()</span>,&nbsp;<span id="ast-105">'build_server_url'</span>:&nbsp;<span id="ast-111"><span id="ast-112">get_integration_url</span>()</span>}</span></span><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-114" class="other_trans">notification</span>:<span id="ast-115"><span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>[<span id="ast-118"><span id="ast-119">'notify'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-120"><span id="ast-121">notification</span>.value</span></span></span><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-123" class="other_trans">status</span>:<span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>[<span id="ast-127"><span id="ast-128">'status'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-129"><span id="ast-130" class="other_trans">status</span>.value</span></span></span><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-132" class="other_trans">mandatory</span>:<span id="ast-133"><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>[<span id="ast-136"><span id="ast-137">'mandatory'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-138"><span id="ast-139" class="correct_node">status&nbsp;&rarr;&nbsp;mandatory&nbsp;</span>.value</span></span></span><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-141">tags</span>:<span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>[<span id="ast-145"><span id="ast-146">'tags'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-147" class="other_trans">tags</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_filters(<span id="ast-2"><span id="ast-3" class="other_trans">available_filters</span>,&nbsp;<span id="ast-4" class="other_trans">filter_filenames</span>,&nbsp;<span id="ast-5" class="other_trans">log_name</span>,&nbsp;<span id="ast-6" class="other_trans">log_key</span>,&nbsp;<span id="ast-7" class="other_trans">log_filename</span>,&nbsp;<span id="ast-8" class="other_trans">log_token</span></span>):<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_filters</span>(<span id="ast-12">'Log&nbsp;name=%s&nbsp;id=%s&nbsp;filename=%s&nbsp;token=%s'</span>,&nbsp;<span id="ast-13" class="other_trans">log_name</span>,&nbsp;<span id="ast-14" class="other_trans">log_key</span>,&nbsp;<span id="ast-15" class="other_trans">log_filename</span>,&nbsp;<span id="ast-16" class="other_trans">log_token</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19">not</span>&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">filter_filenames</span>(<span id="ast-22" class="other_trans">log_filename</span>)</span>)</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_filters</span>(<span id="ast-26">'&nbsp;Log&nbsp;blocked&nbsp;by&nbsp;filter_filenames,&nbsp;not&nbsp;following'</span>)</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.info</span>(<span id="ast-31">'Not&nbsp;following&nbsp;%s,&nbsp;blocked&nbsp;by&nbsp;filter_filenames'</span>,&nbsp;<span id="ast-32" class="other_trans">log_name</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-34" class="other_trans">None</span></span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_filters</span>(<span id="ast-38">'&nbsp;Looking&nbsp;for&nbsp;filters&nbsp;by&nbsp;log&nbsp;name,&nbsp;log&nbsp;id,&nbsp;and&nbsp;token'</span>)</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>event_filter</span>&nbsp;=&nbsp;<span id="ast-41">None</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-45">(<span id="ast-46">not</span>&nbsp;<span id="ast-47" class="other_trans">event_filter</span>)</span>&nbsp;and&nbsp;<span id="ast-48" class="location_node">log_key&nbsp;&rarr;&nbsp;log_name,&nbsp;pred:&nbsp;log_token&nbsp;</span>)</span>:<span id="ast-49"><span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_filters</span>(<span id="ast-52">'&nbsp;Looking&nbsp;for&nbsp;filters&nbsp;by&nbsp;log&nbsp;name'</span>)</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>event_filter</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">available_filters</span>.get</span>(<span id="ast-58" class="other_trans">log_name</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-61">not</span>&nbsp;<span id="ast-62" class="other_trans">event_filter</span>)</span>:<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_filters</span>(<span id="ast-66">'&nbsp;No&nbsp;filter&nbsp;found&nbsp;by&nbsp;log&nbsp;name'</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">metric_type</span>,&nbsp;<span id="ast-5" class="other_trans">infile</span>,&nbsp;<span id="ast-6" class="other_trans">hostname</span>,&nbsp;<span id="ast-7" class="other_trans">outdir</span>,&nbsp;<span id="ast-8" class="other_trans">label</span>,&nbsp;<span id="ast-9" class="other_trans">ts_start</span>,&nbsp;<span id="ast-10" class="other_trans">ts_end</span>,&nbsp;**other_options</span>):<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Metric</span>.__init__</span>(<span id="ast-15">self</span>,&nbsp;<span id="ast-16" class="other_trans">metric_type</span>,&nbsp;<span id="ast-17" class="other_trans">infile</span>,&nbsp;<span id="ast-18" class="other_trans">hostname</span>,&nbsp;<span id="ast-19" class="other_trans">outdir</span>,&nbsp;<span id="ast-20" class="other_trans">label</span>,&nbsp;<span id="ast-21" class="other_trans">ts_start</span>,&nbsp;<span id="ast-22" class="other_trans">ts_end</span>)</span></span><span id="ast-23"><span id="ast-24" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>important_sub_metrics&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-25">(<span id="ast-26">'GC'</span>,&nbsp;<span id="ast-27">'used'</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">key</span>,&nbsp;<span id="ast-31" class="other_trans">val</span>)</span>&nbsp;in&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="incorrect_node">other_options&nbsp;&rarr;&nbsp;self.&nbsp;</span>.iteritems</span>()</span>:<span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">key</span><span id="ast-38" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39">'gc-options'</span>)</span>:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.gc_options</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">val</span>.split</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-49">self</span>,&nbsp;<span id="ast-50" class="other_trans">key</span>,&nbsp;<span id="ast-51" class="other_trans">val</span>)</span></span></span></span><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.metric_description</span>&nbsp;=&nbsp;<span id="ast-55">{<span id="ast-56">'appstop'</span>:&nbsp;<span id="ast-81">'approximate&nbsp;application&nbsp;stop&nbsp;times'</span>,&nbsp;<span id="ast-57">'gen0'</span>:&nbsp;<span id="ast-82">'&nbsp;young&nbsp;gen&nbsp;collection&nbsp;time,&nbsp;excluding&nbsp;gc_prologue&nbsp;&amp;&nbsp;gc_epilogue'</span>,&nbsp;<span id="ast-58">'gen0t'</span>:&nbsp;<span id="ast-83">'&nbsp;young&nbsp;gen&nbsp;collection&nbsp;time,&nbsp;including&nbsp;gc_prologue&nbsp;&amp;&nbsp;gc_epilogue'</span>,&nbsp;<span id="ast-59">'gen0usr'</span>:&nbsp;<span id="ast-84">'&nbsp;young&nbsp;gen&nbsp;collection&nbsp;time&nbsp;in&nbsp;cpu&nbsp;user&nbsp;secs'</span>,&nbsp;<span id="ast-60">'gen0sys'</span>:&nbsp;<span id="ast-85">'&nbsp;young&nbsp;gen&nbsp;collection&nbsp;time&nbsp;in&nbsp;cpu&nbsp;sys&nbsp;secs'</span>,&nbsp;<span id="ast-61">'gen1i'</span>:&nbsp;<span id="ast-86">'&nbsp;train&nbsp;generation&nbsp;incremental&nbsp;collection'</span>,&nbsp;<span id="ast-62">'gen1t'</span>:&nbsp;<span id="ast-87">'&nbsp;old&nbsp;generation&nbsp;collection/full&nbsp;GC'</span>,&nbsp;<span id="ast-63">'cmsIM'</span>:&nbsp;<span id="ast-88">'&nbsp;CMS&nbsp;initial&nbsp;mark&nbsp;pause'</span>,&nbsp;<span id="ast-64">'cmsRM'</span>:&nbsp;<span id="ast-89">'&nbsp;CMS&nbsp;remark&nbsp;pause'</span>,&nbsp;<span id="ast-65">'cmsRS'</span>:&nbsp;<span id="ast-90">'&nbsp;CMS&nbsp;resize&nbsp;pause'</span>,&nbsp;<span id="ast-66">'GC'</span>:&nbsp;<span id="ast-91">'&nbsp;all&nbsp;stop-the-world&nbsp;GC&nbsp;pauses'</span>,&nbsp;<span id="ast-67">'cmsCM'</span>:&nbsp;<span id="ast-92">'&nbsp;CMS&nbsp;concurrent&nbsp;mark&nbsp;phase'</span>,&nbsp;<span id="ast-68">'cmsCP'</span>:&nbsp;<span id="ast-93">'&nbsp;CMS&nbsp;concurrent&nbsp;preclean&nbsp;phase'</span>,&nbsp;<span id="ast-69">'cmsCS'</span>:&nbsp;<span id="ast-94">'&nbsp;CMS&nbsp;concurrent&nbsp;sweep&nbsp;phase'</span>,&nbsp;<span id="ast-70">'cmsCR'</span>:&nbsp;<span id="ast-95">'&nbsp;CMS&nbsp;concurrent&nbsp;reset&nbsp;phase'</span>,&nbsp;<span id="ast-71">'alloc'</span>:&nbsp;<span id="ast-96">'&nbsp;object&nbsp;allocation&nbsp;in&nbsp;MB&nbsp;(approximate***)'</span>,&nbsp;<span id="ast-72">'promo'</span>:&nbsp;<span id="ast-97">'&nbsp;object&nbsp;promotion&nbsp;in&nbsp;MB&nbsp;(approximate***)'</span>,&nbsp;<span id="ast-73">'used0'</span>:&nbsp;<span id="ast-98">'&nbsp;young&nbsp;gen&nbsp;used&nbsp;memory&nbsp;size&nbsp;(before&nbsp;gc)'</span>,&nbsp;<span id="ast-74">'used1'</span>:&nbsp;<span id="ast-99">'&nbsp;old&nbsp;gen&nbsp;used&nbsp;memory&nbsp;size&nbsp;(before&nbsp;gc)'</span>,&nbsp;<span id="ast-75">'used'</span>:&nbsp;<span id="ast-100">'&nbsp;heap&nbsp;space&nbsp;used&nbsp;memory&nbsp;size&nbsp;(before&nbsp;gc)&nbsp;(excludes&nbsp;perm&nbsp;gen)'</span>,&nbsp;<span id="ast-76">'commit0'</span>:&nbsp;<span id="ast-101">'&nbsp;young&nbsp;gen&nbsp;committed&nbsp;memory&nbsp;size&nbsp;(after&nbsp;gc)'</span>,&nbsp;<span id="ast-77">'commit1'</span>:&nbsp;<span id="ast-102">'&nbsp;old&nbsp;gen&nbsp;committed&nbsp;memory&nbsp;size&nbsp;(after&nbsp;gc)'</span>,&nbsp;<span id="ast-78">'commit'</span>:&nbsp;<span id="ast-103">'&nbsp;heap&nbsp;committed&nbsp;memory&nbsp;size&nbsp;(after&nbsp;gc)&nbsp;(excludes&nbsp;perm&nbsp;gen)'</span>,&nbsp;<span id="ast-79">'apptime'</span>:&nbsp;<span id="ast-104">'&nbsp;amount&nbsp;of&nbsp;time&nbsp;application&nbsp;threads&nbsp;were&nbsp;running'</span>,&nbsp;<span id="ast-80">'safept'</span>:&nbsp;<span id="ast-105">'&nbsp;amount&nbsp;of&nbsp;time&nbsp;the&nbsp;VM&nbsp;spent&nbsp;at&nbsp;safepoints&nbsp;(app&nbsp;threads&nbsp;stopped)'</span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;register(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">task</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Register&nbsp;a&nbsp;top&nbsp;level&nbsp;Runnable&nbsp;to&nbsp;be&nbsp;run&nbsp;directly&nbsp;by&nbsp;the&nbsp;scheduler'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-8"><span id="ast-9">self</span>._startup</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">task</span><span id="ast-13">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-14"><span id="ast-15">self</span>._group_index</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">isinstance</span>(<span id="ast-19" class="other_trans">task</span>,&nbsp;<span id="ast-20" class="other_trans">Runnable</span>)</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.trace</span>(<span id="ast-25">'Registering&nbsp;task&nbsp;%s'</span>,&nbsp;<span id="ast-26" class="other_trans">task</span>)</span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>task_deps</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">task</span>.getAllDependencies</span>()</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>groups</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">set</span>(<span id="ast-36">(<span id="ast-37" class="other_trans">g</span><span id="ast-38">&nbsp;for&nbsp;<span id="ast-39" class="other_trans">g</span>&nbsp;in&nbsp;<span id="ast-40">(<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44">self</span>._group_index</span>.get</span>(<span id="ast-45" class="other_trans">d</span>,&nbsp;<span id="ast-46" class="other_trans">None</span>)</span><span id="ast-47">&nbsp;for&nbsp;<span id="ast-48" class="other_trans">d</span>&nbsp;in&nbsp;<span id="ast-49" class="other_trans">task_deps</span></span>)</span>&nbsp;if&nbsp;<span id="ast-50">(<span id="ast-52" class="other_trans">g</span>&nbsp;and&nbsp;<span id="ast-53">(<span id="ast-54"><span id="ast-55" class="other_trans">g</span>.repeat</span><span id="ast-56" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-57"><span id="ast-58" class="other_trans">task</span>.repeat</span>)</span>)</span></span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_process_item(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">item</span>,&nbsp;<span id="ast-5" class="other_trans">spider</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.item_key</span>(<span id="ast-11" class="other_trans">item</span>,&nbsp;<span id="ast-12" class="other_trans">spider</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.encoder</span>.encode</span>(<span id="ast-19" class="other_trans">item</span>)</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.server</span>.basic_publish</span>(exchange=<span id="ast-26" class="correct_node">exchange_name&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;routing_key=<span id="ast-28" class="other_trans">key</span>,&nbsp;body=<span id="ast-30" class="other_trans">data</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-32" class="other_trans">item</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;addition_actually_works(<span id="ast-2"><span id="ast-3" class="other_trans">x</span>,&nbsp;<span id="ast-8" class="other_trans">y</span></span>):<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>the_sum</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">x</span>&nbsp;+&nbsp;<span id="ast-18" class="other_trans">y</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-20">(<span id="ast-22">(<span id="ast-23" class="other_trans">the_sum</span><span id="ast-24" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-25" class="other_trans">x</span>)</span>&nbsp;and&nbsp;<span id="ast-26">(<span id="ast-27" class="other_trans">the_sum</span><span id="ast-28" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<=&nbsp;</span><span id="ast-29" class="other_trans">y</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;expire(<span id="ast-2"><span id="ast-3" class="other_trans">backups</span>,&nbsp;<span id="ast-4" class="other_trans">deltas</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Given&nbsp;a&nbsp;dict&nbsp;of&nbsp;backup&nbsp;name&nbsp;=&gt;&nbsp;backup&nbsp;timestamp&nbsp;pairs&nbsp;in\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``backups``,&nbsp;and&nbsp;a&nbsp;list&nbsp;of&nbsp;``timedelta``&nbsp;objects&nbsp;in&nbsp;``deltas``&nbsp;defining\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;generations,&nbsp;will&nbsp;decide&nbsp;which&nbsp;of&nbsp;the&nbsp;backups&nbsp;can&nbsp;be&nbsp;deleted&nbsp;using\\u000a&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;grandfather-father-son&nbsp;backup&nbsp;strategy.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;approach&nbsp;chosen&nbsp;tries&nbsp;to&nbsp;achieve&nbsp;the&nbsp;following:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Do&nbsp;not&nbsp;require&nbsp;backup&nbsp;names&nbsp;to&nbsp;include&nbsp;information&nbsp;on&nbsp;which&nbsp;generation\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;backup&nbsp;belongs&nbsp;to,&nbsp;like&nbsp;for&nbsp;example&nbsp;``tarsnap-generations``&nbsp;does.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;is,&nbsp;you&nbsp;can&nbsp;create&nbsp;your&nbsp;backups&nbsp;anyway&nbsp;you&nbsp;wish,&nbsp;and&nbsp;simply&nbsp;use\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;utility&nbsp;to&nbsp;delete&nbsp;old&nbsp;backups.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Do&nbsp;not&nbsp;use&nbsp;any&nbsp;fixed&nbsp;generations&nbsp;(weekly,&nbsp;monthly&nbsp;etc),&nbsp;but&nbsp;freeform\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timespans.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Similarily,&nbsp;do&nbsp;not&nbsp;make&nbsp;any&nbsp;assumptions&nbsp;about&nbsp;when&nbsp;or&nbsp;if&nbsp;backup&nbsp;jobs\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;have&nbsp;actually&nbsp;run&nbsp;or&nbsp;will&nbsp;run,&nbsp;but&nbsp;try&nbsp;to&nbsp;match&nbsp;the&nbsp;given&nbsp;deltas&nbsp;as\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;closely&nbsp;as&nbsp;possible.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;What&nbsp;the&nbsp;code&nbsp;actually&nbsp;does&nbsp;is,&nbsp;for&nbsp;each&nbsp;generation,&nbsp;start&nbsp;at&nbsp;a&nbsp;fixed\\u000a&nbsp;&nbsp;&nbsp;&nbsp;point&nbsp;in&nbsp;time&nbsp;determined&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;backup&nbsp;(which&nbsp;is&nbsp;always\\u000a&nbsp;&nbsp;&nbsp;&nbsp;kept)&nbsp;plus&nbsp;the&nbsp;parent&nbsp;generation's&nbsp;delta&nbsp;and&nbsp;then&nbsp;repeatedly&nbsp;stepping\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;generation's&nbsp;delta&nbsp;forwards&nbsp;in&nbsp;time,&nbsp;chosing&nbsp;a&nbsp;backup&nbsp;that&nbsp;fits\\u000a&nbsp;&nbsp;&nbsp;&nbsp;best&nbsp;which&nbsp;will&nbsp;then&nbsp;be&nbsp;kept.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returned&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;backup&nbsp;names.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10" class="other_trans">len</span>(<span id="ast-11" class="other_trans">deltas</span>)</span><span id="ast-12" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-13">2</span>)</span>,&nbsp;<span id="ast-14">'At&nbsp;least&nbsp;two&nbsp;deltas&nbsp;are&nbsp;required'</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17">not</span>&nbsp;<span id="ast-18" class="other_trans">backups</span>)</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-20">[]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;start(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5" class="correct_node">storage_class&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pvc_manifest</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.get_pvc_manifest</span>()</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.httpclient</span>.fetch</span>(<span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.request</span>(url=<span id="ast-22"><span id="ast-23" class="other_trans">k8s_url</span>(<span id="ast-24"><span id="ast-25">self</span>.namespace</span>,&nbsp;<span id="ast-26">'persistentvolumeclaims'</span>)</span>,&nbsp;body=<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">json</span>.dumps</span>(<span id="ast-31" class="other_trans">pvc_manifest</span>)</span>,&nbsp;method=<span id="ast-33">'POST'</span>,&nbsp;headers=<span id="ast-35">{<span id="ast-36">'Content-Type'</span>:&nbsp;<span id="ast-37">'application/json'</span>}</span>)</span>)</span></span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-44">(<span id="ast-45">(<span id="ast-46">'Pvc&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-48"><span id="ast-49">self</span>.pvc_name</span>)</span>&nbsp;+&nbsp;<span id="ast-51">'&nbsp;already&nbsp;exists,&nbsp;so&nbsp;did&nbsp;not&nbsp;create&nbsp;new&nbsp;pod.'</span>)</span>)</span></span></span></span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pod_manifest</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">self</span>.get_pod_manifest</span>()</span></span><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62">self</span>.httpclient</span>.fetch</span>(<span id="ast-63"><span id="ast-64"><span id="ast-65">self</span>.request</span>(url=<span id="ast-67"><span id="ast-68" class="other_trans">k8s_url</span>(<span id="ast-69"><span id="ast-70">self</span>.namespace</span>,&nbsp;<span id="ast-71">'pods'</span>)</span>,&nbsp;body=<span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans">json</span>.dumps</span>(<span id="ast-76" class="other_trans">pod_manifest</span>)</span>,&nbsp;method=<span id="ast-78">'POST'</span>,&nbsp;headers=<span id="ast-80">{<span id="ast-81">'Content-Type'</span>:&nbsp;<span id="ast-82">'application/json'</span>}</span>)</span>)</span></span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-84">True</span>:<span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-87">yield&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90">self</span>.get_pod_info</span>(<span id="ast-91"><span id="ast-92">self</span>.pod_name</span>)</span></span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-94">(<span id="ast-96">(<span id="ast-97" class="other_trans">data</span><span id="ast-98" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-99" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-100"><span id="ast-101"><span id="ast-102">self</span>.is_pod_running</span>(<span id="ast-103" class="other_trans">data</span>)</span>)</span>:<span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans">gen</span>.sleep</span>(<span id="ast-110">1</span>)</span></span></span></span><span id="ast-111"><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.user</span>.server</span>.ip</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans">data</span>[<span id="ast-119"><span id="ast-120">'status'</span></span>]</span>[<span id="ast-121"><span id="ast-122">'podIP'</span></span>]</span></span><span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126"><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.user</span>.server</span>.port</span>&nbsp;=&nbsp;<span id="ast-128">8888</span></span><span id="ast-129"><span id="ast-130"><span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.db</span>.commit</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;wcswidth(<span id="ast-2"><span id="ast-3" class="other_trans">pwcs</span>,&nbsp;<span id="ast-4" class="other_trans">n</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;the&nbsp;width&nbsp;in&nbsp;character&nbsp;cells&nbsp;of&nbsp;the&nbsp;first&nbsp;``n``&nbsp;unicode&nbsp;string&nbsp;pwcs,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;-1&nbsp;if&nbsp;a&nbsp;&nbsp;non-printable&nbsp;character&nbsp;is&nbsp;encountered.&nbsp;When&nbsp;``n``&nbsp;is&nbsp;None\\u000a&nbsp;&nbsp;&nbsp;&nbsp;(default),&nbsp;return&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;entire&nbsp;string.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-15"><span id="ast-16">len</span>(<span id="ast-17" class="other_trans">pwcs</span>)</span>&nbsp;if&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">n</span><span id="ast-13" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-14">None</span>)</span>&nbsp;else&nbsp;<span id="ast-18" class="other_trans">n</span></span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>idx</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">slice</span>(<span id="ast-23">0</span>,&nbsp;<span id="ast-24" class="other_trans">end</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>width</span>&nbsp;=&nbsp;<span id="ast-27">0</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29" class="other_trans">char</span>&nbsp;in&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">pwcs</span>[<span id="ast-32"><span id="ast-33" class="other_trans">idx</span></span>]</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>wcw</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">wcwidth</span>(<span id="ast-38" class="other_trans">char</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">wcw</span><span id="ast-42" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-43">0</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-45">-1</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>width</span>&nbsp;+=&nbsp;<span id="ast-49" class="other_trans">wcw</span></span></span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51" class="other_trans">width</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;task_subdivide(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">orig_args</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Splits&nbsp;a&nbsp;single&nbsp;set&nbsp;of&nbsp;input&nbsp;files&nbsp;into&nbsp;multiple&nbsp;output&nbsp;file&nbsp;names,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;files&nbsp;may&nbsp;not&nbsp;be&nbsp;known&nbsp;beforehand.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>decorator_name</span>&nbsp;=&nbsp;<span id="ast-9">'@subdivide'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>error_type</span>&nbsp;=&nbsp;<span id="ast-12" class="other_trans">error_task_subdivide</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.set_action_type</span>(<span id="ast-17"><span id="ast-18" class="other_trans">_task</span>.action_task_subdivide</span>)</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>do_task_subdivide&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-22" class="other_trans">orig_args</span>,&nbsp;<span id="ast-23" class="other_trans">decorator_name</span>,&nbsp;<span id="ast-24" class="other_trans">error_type</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;set_page_permissions(<span id="ast-2"><span id="ast-3" class="other_trans">context</span>,&nbsp;<span id="ast-4" class="other_trans">token</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Assigns&nbsp;a&nbsp;permissions&nbsp;dict&nbsp;to&nbsp;the&nbsp;given&nbsp;page&nbsp;instance,&nbsp;combining\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Django's&nbsp;permission&nbsp;for&nbsp;the&nbsp;page's&nbsp;model&nbsp;and&nbsp;a&nbsp;permission&nbsp;check\\u000a&nbsp;&nbsp;&nbsp;&nbsp;against&nbsp;the&nbsp;instance&nbsp;itself&nbsp;calling&nbsp;the&nbsp;page's&nbsp;``can_add``,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``can_change``&nbsp;and&nbsp;``can_delete``&nbsp;custom&nbsp;methods.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Used&nbsp;within&nbsp;the&nbsp;change&nbsp;list&nbsp;for&nbsp;pages,&nbsp;to&nbsp;implement&nbsp;permission\\u000a&nbsp;&nbsp;&nbsp;&nbsp;checks&nbsp;for&nbsp;the&nbsp;navigation&nbsp;tree.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>page</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">context</span>[<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">token</span>.split_contents</span>()</span>[<span id="ast-16"><span id="ast-17">1</span></span>]</span></span>]</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>model</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">page</span>.get_content_model</span>()</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>opts</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">model</span>._meta</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-29" class="other_trans">AttributeError</span>:<span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>error</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">_</span>(<span id="ast-34">'An&nbsp;error&nbsp;occured&nbsp;with&nbsp;the&nbsp;following&nbsp;class.&nbsp;Does&nbsp;it&nbsp;subclass&nbsp;Page&nbsp;directly?'</span>)</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">ImproperlyConfigured</span>(<span id="ast-38">(<span id="ast-39" class="other_trans">error</span>&nbsp;+&nbsp;<span id="ast-41">(<span id="ast-42">"&nbsp;'%s'"</span>&nbsp;%&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans">model</span>.__class__</span>.__name__</span>)</span>)</span>)</span></span></span></span><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>perm_name</span>&nbsp;=&nbsp;<span id="ast-49">(<span id="ast-50">(<span id="ast-51"><span id="ast-52" class="other_trans">opts</span>.app_label</span>&nbsp;+&nbsp;<span id="ast-54">'.%s_'</span>)</span>&nbsp;+&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans">opts</span>.object_name</span>.lower</span>()</span>)</span></span><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>request</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">context</span>[<span id="ast-64"><span id="ast-65">'request'</span></span>]</span></span><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-69" class="other_trans">page</span>,&nbsp;<span id="ast-70">'perms'</span>,&nbsp;<span id="ast-71">{}</span>)</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-73" class="other_trans">perm_type</span>&nbsp;in&nbsp;<span id="ast-74">(<span id="ast-75">'add'</span>,&nbsp;<span id="ast-76">'change'</span>,&nbsp;<span id="ast-77">'delete'</span>)</span>:<span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>perm</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83" class="other_trans">request</span>.user</span>.has_perm</span>(<span id="ast-84">(<span id="ast-85" class="other_trans">perm_name</span>&nbsp;%&nbsp;<span id="ast-87" class="other_trans">perm_type</span>)</span>)</span></span><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>perm</span>&nbsp;=&nbsp;<span id="ast-90">(<span id="ast-92" class="other_trans">perm</span>&nbsp;and&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans">getattr</span>(<span id="ast-96" class="ref_node">page&nbsp;&rarr;&nbsp;model&nbsp;</span>,&nbsp;<span id="ast-97">(<span id="ast-98">'can_%s'</span>&nbsp;%&nbsp;<span id="ast-100">perm_type</span>)</span>)</span>(<span id="ast-101" class="other_trans">request</span>)</span>)</span></span><span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>page&nbsp;&rarr;&nbsp;opts&nbsp;</span>.perms</span>[<span id="ast-106"><span id="ast-107" class="other_trans">perm_type</span></span>]</span>&nbsp;=&nbsp;<span id="ast-108" class="other_trans">perm</span></span></span><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-110">''</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;endpoint_loader(<span id="ast-2"><span id="ast-3" class="other_trans">request</span>,&nbsp;<span id="ast-4" class="other_trans">application</span>,&nbsp;<span id="ast-5" class="other_trans">model</span>,&nbsp;**kwargs</span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Load&nbsp;an&nbsp;AJAX&nbsp;endpoint.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;will&nbsp;load&nbsp;either&nbsp;an&nbsp;ad-hoc&nbsp;endpoint&nbsp;or&nbsp;it&nbsp;will&nbsp;load&nbsp;up&nbsp;a&nbsp;model&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;endpoint&nbsp;depending&nbsp;on&nbsp;what&nbsp;it&nbsp;finds.&nbsp;It&nbsp;first&nbsp;attempts&nbsp;to&nbsp;load&nbsp;``model``\\u000a&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;if&nbsp;it&nbsp;were&nbsp;an&nbsp;ad-hoc&nbsp;endpoint.&nbsp;Alternatively,&nbsp;it&nbsp;will&nbsp;attempt&nbsp;to&nbsp;see&nbsp;if\\u000a&nbsp;&nbsp;&nbsp;&nbsp;there&nbsp;is&nbsp;a&nbsp;``ModelEndpoint``&nbsp;for&nbsp;the&nbsp;given&nbsp;``model``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10"><span id="ast-11" class="other_trans">request</span>.method</span><span id="ast-12" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-13">'POST'</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">AJAXError</span>(<span id="ast-17">400</span>,&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">_</span>(<span id="ast-20">'Invalid&nbsp;HTTP&nbsp;method&nbsp;used.'</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_callback(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">msg</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">json</span>.loads</span>(<span id="ast-11"><span id="ast-12" class="other_trans">msg</span>.body</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-14" class="other_trans">ValueError</span>:<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.error</span>(<span id="ast-19">'invalid&nbsp;message&nbsp;received'</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>method</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">msg</span>.get</span>(<span id="ast-26">'method'</span>,&nbsp;<span id="ast-27">None</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">msg</span>.get</span>(<span id="ast-33">'params'</span>,&nbsp;<span id="ast-34">{}</span>)</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">method</span><span id="ast-38" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-39" class="other_trans">None</span>)</span>:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.error</span>(<span id="ast-44">'Message&nbsp;without&nbsp;method&nbsp;field'</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">obj</span>,&nbsp;<span id="ast-49" class="other_trans">allowed_methods</span>)</span>&nbsp;in&nbsp;<span id="ast-50"><span id="ast-51">self</span>.listeners</span>:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-54" class="other_trans">method</span><span id="ast-55">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-56" class="other_trans">allowed_methods</span>)</span>:<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.error</span>(<span id="ast-61">'Method&nbsp;not&nbsp;allowed:&nbsp;%s'</span>,&nbsp;<span id="ast-62" class="other_trans">method</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>m</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">getattr</span>(<span id="ast-68" class="other_trans">obj</span>,&nbsp;<span id="ast-69" class="other_trans">method</span>,&nbsp;<span id="ast-70" class="other_trans">None</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-73" class="other_trans">m</span><span id="ast-74" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-75" class="other_trans">None</span>)</span>:<span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.error</span>(<span id="ast-80">'Method&nbsp;%s&nbsp;not&nbsp;defined'</span>,&nbsp;<span id="ast-81" class="other_trans">method</span>)</span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>m</span>(**<span id="ast-87" class="incorrect_node">params&nbsp;&rarr;&nbsp;allowed_methods&nbsp;</span>)</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.exception</span>(<span id="ast-93">'Exception&nbsp;in&nbsp;handling&nbsp;%s&nbsp;on&nbsp;topic&nbsp;%s&nbsp;with&nbsp;params&nbsp;%s'</span>,&nbsp;<span id="ast-94" class="other_trans">method</span>,&nbsp;<span id="ast-95" class="ref_node">topic&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-96" class="other_trans">params</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">edit</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>menu_items</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>.FILE_DIFFS</span>[<span id="ast-10">:</span>]</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>saved</span>&nbsp;=&nbsp;<span id="ast-13" class="correct_node">SAVED&nbsp;&rarr;&nbsp;self.&nbsp;</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>non_empty_regions</span>&nbsp;=&nbsp;<span id="ast-16">[<span id="ast-17" class="other_trans">region</span><span id="ast-18">&nbsp;for&nbsp;<span id="ast-19" class="other_trans">region</span>&nbsp;in&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.view</span>.sel</span>()</span>&nbsp;if&nbsp;<span id="ast-24">(<span id="ast-25">not</span>&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">region</span>.empty</span>()</span>)</span></span>]</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32" class="other_trans">len</span>(<span id="ast-33" class="other_trans">non_empty_regions</span>)</span><span id="ast-34" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-35">2</span>)</span>:<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>menu_items</span>.insert</span>(<span id="ast-40">1</span>,&nbsp;<span id="ast-41" class="other_trans">SELECTIONS</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">len</span>(<span id="ast-45" class="other_trans">non_empty_regions</span>)</span>:<span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>menu_items</span>&nbsp;=&nbsp;<span id="ast-48">[<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">f</span>.replace</span>(<span id="ast-52">u'Diff&nbsp;file'</span>,&nbsp;<span id="ast-53">u'Diff&nbsp;selection'</span>)</span><span id="ast-54">&nbsp;for&nbsp;<span id="ast-55" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-56" class="other_trans">menu_items</span></span>]</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>saved</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">saved</span>.replace</span>(<span id="ast-62">u'Diff&nbsp;file'</span>,&nbsp;<span id="ast-63">u'Diff&nbsp;selection'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;replace_header(<span id="ast-2"><span id="ast-3" class="other_trans">name</span>,&nbsp;<span id="ast-4" class="other_trans">value</span>,&nbsp;<span id="ast-5" class="other_trans">headers</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>idx</span>&nbsp;=&nbsp;<span id="ast-8">-1</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-10">(<span id="ast-11" class="other_trans">i</span>,&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">k</span>,&nbsp;<span id="ast-14" class="other_trans">v</span>)</span>)</span>&nbsp;in&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">enumerate</span>(<span id="ast-17" class="other_trans">headers</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">k</span>.upper</span>()</span><span id="ast-23" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">name</span>.upper</span>()</span>)</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>idx</span>&nbsp;=&nbsp;<span id="ast-29" class="other_trans">i</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33" class="other_trans">idx</span><span id="ast-34" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-35">0</span>)</span>:<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>[<span id="ast-39"><span id="ast-40" class="incorrect_node">i&nbsp;&rarr;&nbsp;idx&nbsp;</span></span>]</span>&nbsp;=&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">name</span>.title</span>()</span>,&nbsp;<span id="ast-45" class="other_trans">value</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>.append</span>(<span id="ast-50">(<span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">name</span>.title</span>()</span>,&nbsp;<span id="ast-54" class="other_trans">value</span>)</span>)</span></span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-56" class="other_trans">headers</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_validate_sufficient_memory(<span id="ast-2"><span id="ast-3" class="other_trans">min_memory_required_in_mb</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_memory</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">_get_host_total_memory</span>()</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ctx</span>.logger</span>.info</span>(<span id="ast-13">'Validating&nbsp;memory&nbsp;requirement...'</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17" class="other_trans">int</span>(<span id="ast-18" class="other_trans">min_memory_required_in_mb</span>)</span><span id="ast-19" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-20"><span id="ast-21" class="other_trans">int</span>(<span id="ast-22" class="other_trans">current_memory</span>)</span>)</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">_error</span>(<span id="ast-26"><span id="ast-27"><span id="ast-28">'The&nbsp;provided&nbsp;host&nbsp;does&nbsp;not&nbsp;have&nbsp;enough&nbsp;memory&nbsp;to&nbsp;run&nbsp;Cloudify&nbsp;Manager&nbsp;(Current:&nbsp;{0}MB,&nbsp;Required:&nbsp;{1}MB).'</span>.format</span>(<span id="ast-29" class="other_trans">current_memory</span>,&nbsp;<span id="ast-30" class="other_trans">min_memory_required_in_mb</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;setPowerCurve(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">powerCurveDictionary</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.powerCurveDictionary</span>&nbsp;=&nbsp;<span id="ast-9" class="other_trans">powerCurveDictionary</span></span><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-12" class="other_trans">speeds</span>,&nbsp;<span id="ast-13" class="other_trans">powers</span>)</span>&nbsp;=&nbsp;<span id="ast-14">(<span id="ast-15">[]</span>,&nbsp;<span id="ast-16">[]</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-18" class="other_trans">speed</span>&nbsp;in&nbsp;<span id="ast-19"><span id="ast-20">self</span>.powerCurveDictionary</span>:<span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>speeds</span>.append</span>(<span id="ast-25" class="other_trans">speed</span>)</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>powers</span>.append</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32">self</span>.powerCurveDictionary</span>[<span id="ast-33"><span id="ast-34" class="other_trans">speed</span></span>]</span>)</span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37"><span id="ast-38" class="other_trans">len</span>(<span id="ast-39" class="other_trans">speeds</span>)</span><span id="ast-40" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-41">0</span>)</span>:<span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.powerCurveLevels</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">pd</span>.Series</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.powerCurveLevels</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">pd</span>.DataFrame</span>(<span id="ast-54" class="other_trans">powers</span>,&nbsp;index=<span id="ast-56" class="other_trans">speeds</span>,&nbsp;columns=<span id="ast-58">[<span id="ast-59">'Specified&nbsp;Power'</span>]</span>)</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.powerCurveLevels</span>[<span id="ast-64"><span id="ast-65">'Specified&nbsp;Turbulence'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67">self</span>.powerCurveTurbulence</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;should_be_throttled(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">identifier</span>,&nbsp;**kwargs</span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>.convert_identifier_to_key</span>(<span id="ast-10" class="other_trans">identifier</span>)</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cache</span>.add</span>(<span id="ast-15" class="other_trans">key</span>,&nbsp;<span id="ast-16">[]</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>minimum_time</span>&nbsp;=&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">int</span>(<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">time</span>.time</span>()</span>)</span>&nbsp;-&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">int</span>(<span id="ast-28"><span id="ast-29">self</span>.timeframe</span>)</span>)</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>times_accessed</span>&nbsp;=&nbsp;<span id="ast-32">[<span id="ast-33" class="other_trans">access</span><span id="ast-34">&nbsp;for&nbsp;<span id="ast-35" class="other_trans">access</span>&nbsp;in&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">cache</span>.get</span>(<span id="ast-39" class="other_trans">key</span>)</span>&nbsp;if&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">access</span><span id="ast-42" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-43" class="other_trans">minimum_time</span>)</span></span>]</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cache</span>.set</span>(<span id="ast-48" class="other_trans">key</span>,&nbsp;<span id="ast-49" class="other_trans">times_accessed</span>,&nbsp;<span id="ast-50"><span id="ast-51">self</span>.expiration</span>)</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-54"><span id="ast-55" class="other_trans">len</span>(<span id="ast-56" class="other_trans">times_accessed</span>)</span><span id="ast-57" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-58"><span id="ast-59" class="other_trans">int</span>(<span id="ast-60"><span id="ast-61">self</span>.throttle_at</span>)</span>)</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-63">True</span></span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-65">False</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_cache(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">func</span>,&nbsp;<span id="ast-5" class="other_trans">memory_level</span>,&nbsp;**kwargs</span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Return&nbsp;a&nbsp;joblib.Memory&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;memory_level&nbsp;determines&nbsp;the&nbsp;level&nbsp;above&nbsp;which&nbsp;the&nbsp;wrapped\\u000a&nbsp;&nbsp;&nbsp;&nbsp;function&nbsp;output&nbsp;is&nbsp;cached.&nbsp;By&nbsp;specifying&nbsp;a&nbsp;numeric&nbsp;value&nbsp;for\\u000a&nbsp;&nbsp;&nbsp;&nbsp;this&nbsp;level,&nbsp;the&nbsp;user&nbsp;can&nbsp;to&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;cache&nbsp;memory\\u000a&nbsp;&nbsp;&nbsp;&nbsp;used.&nbsp;This&nbsp;function&nbsp;will&nbsp;cache&nbsp;the&nbsp;function&nbsp;call&nbsp;or&nbsp;not\\u000a&nbsp;&nbsp;&nbsp;&nbsp;depending&nbsp;on&nbsp;the&nbsp;cache&nbsp;level.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;func:&nbsp;function\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;function&nbsp;which&nbsp;output&nbsp;is&nbsp;to&nbsp;be&nbsp;cached.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;memory_level:&nbsp;int\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;memory_level&nbsp;from&nbsp;which&nbsp;caching&nbsp;must&nbsp;be&nbsp;enabled&nbsp;for&nbsp;the&nbsp;wrapped\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;mem:&nbsp;joblib.Memory\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;that&nbsp;wraps&nbsp;the&nbsp;function&nbsp;func.&nbsp;This&nbsp;object&nbsp;may&nbsp;be\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;no-op,&nbsp;if&nbsp;the&nbsp;requested&nbsp;level&nbsp;is&nbsp;lower&nbsp;than&nbsp;the&nbsp;value&nbsp;given\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;_cache()).&nbsp;For&nbsp;consistency,&nbsp;a&nbsp;joblib.Memory&nbsp;object&nbsp;is&nbsp;always\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;returned.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11">not</span>&nbsp;<span id="ast-12"><span id="ast-13">hasattr</span>(<span id="ast-14">self</span>,&nbsp;<span id="ast-15">'memory_level'</span>)</span>)</span>:<span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.memory_level</span>&nbsp;=&nbsp;<span id="ast-19">0</span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22">not</span>&nbsp;<span id="ast-23"><span id="ast-24">hasattr</span>(<span id="ast-25">self</span>,&nbsp;<span id="ast-26">'memory'</span>)</span>)</span>:<span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.memory</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">Memory</span>(cachedir=<span id="ast-33">None</span>)</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37">self</span>.memory_level</span><span id="ast-38" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39">0</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-43"><span id="ast-44">isinstance</span>(<span id="ast-45"><span id="ast-46">self</span>.memory</span>,&nbsp;<span id="ast-47" class="other_trans">basestring</span>)</span>&nbsp;or&nbsp;<span id="ast-48">(<span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>.memory</span>.cachedir</span><span id="ast-52" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-53" class="other_trans">None</span>)</span>)</span>:<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>.warn</span>(<span id="ast-58">'memory_level&nbsp;is&nbsp;currently&nbsp;set&nbsp;to&nbsp;0&nbsp;but&nbsp;a&nbsp;Memory&nbsp;object&nbsp;has&nbsp;been&nbsp;provided.&nbsp;Setting&nbsp;memory_level&nbsp;to&nbsp;1.'</span>)</span></span><span id="ast-59"><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.memory_level</span>&nbsp;=&nbsp;<span id="ast-62">1</span></span></span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65"><span id="ast-66">self</span>.memory_level</span><span id="ast-67" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-68" class="other_trans">memory_level</span>)</span>:<span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mem</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72" class="other_trans">Memory</span>(cachedir=<span id="ast-74" class="other_trans">None</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans">mem</span>.cache</span>(<span id="ast-79" class="other_trans">func</span>,&nbsp;**<span id="ast-80" class="other_trans">kwargs</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>memory</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84">self</span>.memory</span></span><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-86"><span id="ast-87" class="other_trans">isinstance</span>(<span id="ast-88" class="other_trans">memory</span>,&nbsp;<span id="ast-89" class="other_trans">basestring</span>)</span>:<span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>memory</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93" class="other_trans">Memory</span>(cachedir=<span id="ast-95" class="other_trans">memory</span>)</span></span></span><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-97">(<span id="ast-98">not</span>&nbsp;<span id="ast-99"><span id="ast-100" class="other_trans">isinstance</span>(<span id="ast-101" class="other_trans">memory</span>,&nbsp;<span id="ast-102" class="other_trans">Memory</span>)</span>)</span>:<span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-104"><span id="ast-105" class="other_trans">TypeError</span>(<span id="ast-106">"'memory'&nbsp;argument&nbsp;must&nbsp;be&nbsp;a&nbsp;string&nbsp;or&nbsp;a&nbsp;joblib.Memory&nbsp;object."</span>)</span></span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-108">(<span id="ast-109"><span id="ast-110" class="other_trans">memory</span>.cachedir</span><span id="ast-111" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-112" class="other_trans">None</span>)</span>:<span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>.warn</span>(<span id="ast-117">(<span id="ast-118">'Caching&nbsp;has&nbsp;been&nbsp;enabled&nbsp;(memory_level&nbsp;=&nbsp;%d)&nbsp;but&nbsp;no&nbsp;Memory&nbsp;object&nbsp;or&nbsp;path&nbsp;has&nbsp;been&nbsp;provided&nbsp;(parameter&nbsp;memory).&nbsp;Caching&nbsp;deactivated&nbsp;for&nbsp;function&nbsp;%s.'</span>&nbsp;%&nbsp;<span id="ast-120">(<span id="ast-121"><span id="ast-122">self</span>.memory_level</span>,&nbsp;<span id="ast-123"><span id="ast-124" class="other_trans">func</span>.func_name</span>)</span>)</span>)</span></span></span><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-126"><span id="ast-127"><span id="ast-128" class="other_trans">memory</span>.cache</span>(<span id="ast-129" class="other_trans">func</span>,&nbsp;**<span id="ast-130" class="other_trans">kwargs</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_spore(<span id="ast-2"><span id="ast-3" class="other_trans">request</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tasks</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">getattr</span>(<span id="ast-10"><span id="ast-11" class="other_trans">request</span>.registry</span>,&nbsp;<span id="ast-12">'admin_couchdb_server'</span>,&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">request</span>.registry</span>.couchdb_server</span>)</span>.tasks</span>()</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output</span>&nbsp;=&nbsp;<span id="ast-18">{<span id="ast-19"><span id="ast-20" class="other_trans">task</span>[<span id="ast-21"><span id="ast-22">'replication_id'</span></span>]</span>:&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">task</span>[<span id="ast-25"><span id="ast-26">'progress'</span></span>]</span><span id="ast-27">&nbsp;for&nbsp;<span id="ast-28" class="other_trans">task</span>&nbsp;in&nbsp;<span id="ast-29" class="other_trans">tasks</span>&nbsp;if&nbsp;<span id="ast-30">(<span id="ast-32">(<span id="ast-33">'type'</span><span id="ast-34">&nbsp;in&nbsp;</span><span id="ast-35" class="other_trans">task</span>)</span>&nbsp;and&nbsp;<span id="ast-36">(<span id="ast-37"><span id="ast-38" class="other_trans">task</span>[<span id="ast-39"><span id="ast-40">'type'</span></span>]</span><span id="ast-41" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-42">'replication'</span>)</span>)</span></span>}</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-44">(<span id="ast-45">not</span>&nbsp;<span id="ast-46">(<span id="ast-48" class="other_trans">output</span>&nbsp;and&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">all</span>(<span id="ast-51">[<span id="ast-52"><span id="ast-59">True</span>&nbsp;if&nbsp;<span id="ast-53">(<span id="ast-54" class="other_trans">progress</span><span id="ast-55" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">request</span>.registry</span>.health_threshold</span>)</span>&nbsp;else&nbsp;<span id="ast-60">False</span></span><span id="ast-61">&nbsp;for&nbsp;<span id="ast-62" class="other_trans">progress</span>&nbsp;in&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">output</span>.values</span>()</span></span>]</span>)</span>)</span>)</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">Response</span>(json_body=<span id="ast-70" class="other_trans">output</span>,&nbsp;status=<span id="ast-72">503</span>)</span></span></span><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-74" class="other_trans">output</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;emit_event(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">event</span>,&nbsp;<span id="ast-5" class="other_trans">sender</span>,&nbsp;<span id="ast-7" class="other_trans">level</span>,&nbsp;<span id="ast-9" class="other_trans">formatted</span>,&nbsp;<span id="ast-11" class="other_trans">data</span></span>):<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15">not</span>&nbsp;<span id="ast-16" class="other_trans">sender</span>)</span>:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sender</span>&nbsp;=&nbsp;<span id="ast-19">self</span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23">(<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-28"><span id="ast-29">self</span>.last_log_time</span>)</span><span id="ast-30" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34">self</span>.config</span>.get</span>(<span id="ast-35">'log_interval'</span>,&nbsp;<span id="ast-36">0</span>)</span>)</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.last_log_time</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">time</span>.time</span>()</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.bot</span>.event_manager</span>.emit</span>(<span id="ast-49" class="other_trans">event</span>,&nbsp;sender=<span id="ast-51" class="other_trans">sender</span>,&nbsp;level=<span id="ast-53" class="other_trans">level</span>,&nbsp;formatted=<span id="ast-55" class="other_trans">formatted</span>,&nbsp;data=<span id="ast-57" class="other_trans">data</span>)</span></span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-59" class="other_trans">AttributeError</span>:<span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61">(<span id="ast-62">(<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-67"><span id="ast-68">self</span>.last_log_time</span>)</span><span id="ast-69" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-70">0</span>)</span>:<span id="ast-71"><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.last_log_time</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76">time</span>.time</span>()</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.bot</span>.event_manager</span>.emit</span>(<span id="ast-83" class="other_trans">event</span>,&nbsp;sender=<span id="ast-85" class="other_trans">sender</span>,&nbsp;level=<span id="ast-87" class="other_trans">level</span>,&nbsp;formatted=<span id="ast-89" class="other_trans">formatted</span>,&nbsp;data=<span id="ast-91" class="other_trans">data</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_cron_format_validation(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Cron&nbsp;Format:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;*&nbsp;*&nbsp;*&nbsp;*\\u000a&nbsp;&nbsp;&nbsp;&nbsp;min&nbsp;(0&nbsp;-&nbsp;59)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;hour&nbsp;(0&nbsp;-&nbsp;23)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;of&nbsp;month&nbsp;(1&nbsp;-&nbsp;31)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;month&nbsp;(1&nbsp;-&nbsp;12)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;day&nbsp;of&nbsp;week&nbsp;(0&nbsp;-&nbsp;6)&nbsp;(0&nbsp;to&nbsp;6&nbsp;are&nbsp;Sunday&nbsp;to&nbsp;Saturday,&nbsp;or&nbsp;use&nbsp;names;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;7&nbsp;is&nbsp;Sunday,&nbsp;the&nbsp;same&nbsp;as&nbsp;0)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Examples:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;30&nbsp;0&nbsp;1&nbsp;1,6,12&nbsp;*&nbsp;#&nbsp;00:30&nbsp;Hrs&nbsp;&nbsp;on&nbsp;1st&nbsp;of&nbsp;Jan,&nbsp;June&nbsp;&amp;&nbsp;Dec.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;20&nbsp;*&nbsp;10&nbsp;1-5&nbsp;#&nbsp;8.00&nbsp;PM&nbsp;every&nbsp;weekday&nbsp;(Mon-Fri)&nbsp;only&nbsp;in&nbsp;Oct.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;0&nbsp;1,10,5&nbsp;*&nbsp;*&nbsp;#&nbsp;midnight&nbsp;on&nbsp;1st,&nbsp;10th&nbsp;&amp;&nbsp;15th&nbsp;of&nbsp;month\\u000a&nbsp;&nbsp;&nbsp;&nbsp;5,10&nbsp;0&nbsp;10&nbsp;*&nbsp;1&nbsp;#&nbsp;At&nbsp;12.05,12.10&nbsp;every&nbsp;Monday&nbsp;&amp;&nbsp;on&nbsp;10th&nbsp;of&nbsp;every&nbsp;month\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>crons</span>&nbsp;=&nbsp;<span id="ast-8">[<span id="ast-9">'*&nbsp;*&nbsp;*&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-10">'0&nbsp;0&nbsp;12&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-11">'0&nbsp;15&nbsp;10&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-12">'0&nbsp;0,12&nbsp;1&nbsp;*/2&nbsp;*'</span>,&nbsp;<span id="ast-13">'0&nbsp;2&nbsp;1-10&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-14">'0&nbsp;4&nbsp;15-21&nbsp;*&nbsp;1'</span>,&nbsp;<span id="ast-15">'0&nbsp;4&nbsp;8-14&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-16">'30&nbsp;08&nbsp;10&nbsp;06&nbsp;*'</span>,&nbsp;<span id="ast-17">'00&nbsp;11,16&nbsp;*&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-18">'00&nbsp;09-18&nbsp;*&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-19">'00&nbsp;09-18&nbsp;*&nbsp;*&nbsp;1-5'</span>,&nbsp;<span id="ast-20">'0&nbsp;2&nbsp;*&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-21">'0&nbsp;5,17&nbsp;*&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-22">'0&nbsp;17&nbsp;*&nbsp;*&nbsp;sun'</span>,&nbsp;<span id="ast-23">'*/10&nbsp;*&nbsp;*&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-24">'*&nbsp;*&nbsp;*&nbsp;jan,may,aug&nbsp;*'</span>,&nbsp;<span id="ast-25">'0&nbsp;17&nbsp;*&nbsp;*&nbsp;sun,fri'</span>,&nbsp;<span id="ast-26">'0&nbsp;2&nbsp;*&nbsp;*&nbsp;sun'</span>,&nbsp;<span id="ast-27">'0&nbsp;*/4&nbsp;*&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-28">'0&nbsp;4,17&nbsp;*&nbsp;*&nbsp;sun,mon'</span>,&nbsp;<span id="ast-29">'00&nbsp;10&nbsp;*&nbsp;*&nbsp;*'</span>,&nbsp;<span id="ast-30">'30&nbsp;0&nbsp;*&nbsp;*&nbsp;*'</span>]</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-33" class="other_trans">cron</span>&nbsp;in&nbsp;<span id="ast-34" class="other_trans">crons</span>:<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cron_validator</span>(<span id="ast-39" class="other_trans">cron</span>)</span></span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-41" class="other_trans">ValidationError</span>:<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fail</span>(<span id="ast-46">(<span id="ast-47">'CronValidator&nbsp;raised&nbsp;ValidationError&nbsp;for&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-49" class="correct_node">cron&nbsp;&rarr;&nbsp;crons&nbsp;</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;next_biweekly_meeting(<span id="ast-2"><span id="ast-3" class="other_trans">current_date_time</span>,&nbsp;<span id="ast-4" class="other_trans">day</span>,&nbsp;<span id="ast-5">meet_on_even</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Calculate&nbsp;the&nbsp;next&nbsp;biweekly&nbsp;meeting.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;current_date_time:&nbsp;the&nbsp;current&nbsp;datetime&nbsp;object\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;day:&nbsp;scheduled&nbsp;day&nbsp;of&nbsp;the&nbsp;meeting\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;meet_on_even:&nbsp;True&nbsp;if&nbsp;meeting&nbsp;on&nbsp;even&nbsp;weeks&nbsp;and&nbsp;False&nbsp;if&nbsp;meeting\\u000a&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;odd&nbsp;weeks\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:returns:&nbsp;datetime&nbsp;object&nbsp;of&nbsp;next&nbsp;meeting\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>weekday</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12">WEEKDAYS</span>[<span id="ast-13"><span id="ast-14" class="other_trans">day</span></span>]</span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>first_day_of_mo</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">current_date_time</span>.replace</span>(day=<span id="ast-21">1</span>)</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>day_of_week</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">first_day_of_mo</span>.strftime</span>(<span id="ast-27">'%w'</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>adjustment</span>&nbsp;=&nbsp;<span id="ast-30">(<span id="ast-31">(<span id="ast-32">8</span>&nbsp;-&nbsp;<span id="ast-34"><span id="ast-35">int</span>(<span id="ast-36" class="other_trans">day_of_week</span>)</span>)</span>&nbsp;%&nbsp;<span id="ast-38">(<span id="ast-39">7</span>&nbsp;-&nbsp;<span id="ast-41">weekday</span>)</span>)</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43" class="other_trans">meet_on_even</span>:<span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>adjustment</span>&nbsp;+=&nbsp;<span id="ast-47">7</span></span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>next_meeting</span>&nbsp;=&nbsp;<span id="ast-50">(<span id="ast-51" class="other_trans">first_day_of_mo</span>&nbsp;+&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">datetime</span>.timedelta</span>(<span id="ast-56" class="other_trans">adjustment</span>)</span>)</span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-58">(<span id="ast-59">current_date_time</span><span id="ast-60" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-61" class="other_trans">next_meeting</span>)</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>next_meeting</span>&nbsp;=&nbsp;<span id="ast-64">(<span id="ast-65" class="other_trans">next_meeting</span>&nbsp;+&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">datetime</span>.timedelta</span>(<span id="ast-70">14</span>)</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-73" class="other_trans">current_date_time</span><span id="ast-74" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-75" class="other_trans">next_meeting</span>)</span>:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>current_date_time</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans">current_date_time</span>.replace</span>(month=<span id="ast-82">(<span id="ast-83"><span id="ast-84" class="other_trans">current_date_time</span>.month</span>&nbsp;+&nbsp;<span id="ast-86">1</span>)</span>,&nbsp;day=<span id="ast-88">1</span>)</span></span><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first_wday_next_mo</span>&nbsp;=&nbsp;<span id="ast-91"><span id="ast-92">next_weekday</span>(<span id="ast-93" class="other_trans">current_date_time</span>,&nbsp;<span id="ast-94" class="ref_node">weekday&nbsp;&rarr;&nbsp;day&nbsp;</span>)</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96" class="other_trans">meet_on_even</span>:<span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>next_meeting</span>&nbsp;=&nbsp;<span id="ast-99">(<span id="ast-100">first_wday_next_mo</span>&nbsp;+&nbsp;<span id="ast-102"><span id="ast-103"><span id="ast-104">datetime</span>.timedelta</span>(<span id="ast-105">7</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>next_meeting</span>&nbsp;=&nbsp;<span id="ast-108" class="other_trans">first_wday_next_mo</span></span></span></span></span><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-110" class="other_trans">next_meeting</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;add(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">key</span>,&nbsp;<span id="ast-5" class="other_trans">metric</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Use&nbsp;this&nbsp;method&nbsp;to&nbsp;manually&nbsp;add&nbsp;custom&nbsp;metric&nbsp;instances&nbsp;to&nbsp;the&nbsp;registry\\u000a&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;are&nbsp;not&nbsp;created&nbsp;with&nbsp;their&nbsp;constructor's&nbsp;default&nbsp;arguments,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;e.g.&nbsp;Histograms&nbsp;with&nbsp;a&nbsp;different&nbsp;size.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;key:&nbsp;name&nbsp;of&nbsp;the&nbsp;metric\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;key:&nbsp;C{str}\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;metric:&nbsp;instance&nbsp;of&nbsp;Histogram,&nbsp;Meter,&nbsp;Gauge,&nbsp;Timer&nbsp;or&nbsp;Counter\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>class_map</span>&nbsp;=&nbsp;<span id="ast-10">(<span id="ast-11">(<span id="ast-12" class="other_trans">Histogram</span>,&nbsp;<span id="ast-13"><span id="ast-14">self</span>._histograms</span>)</span>,&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">Meter</span>,&nbsp;<span id="ast-17"><span id="ast-18">self</span>._meters</span>)</span>,&nbsp;<span id="ast-19">(<span id="ast-20" class="other_trans">Gauge</span>,&nbsp;<span id="ast-21"><span id="ast-22">self</span>._gauges</span>)</span>,&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">Timer</span>,&nbsp;<span id="ast-25"><span id="ast-26">self</span>._timers</span>)</span>,&nbsp;<span id="ast-27">(<span id="ast-28" class="incorrect_node">Counter&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-29"><span id="ast-30">self</span>._counters</span>)</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32">(<span id="ast-33" class="other_trans">cls</span>,&nbsp;<span id="ast-34" class="other_trans">registry</span>)</span>&nbsp;in&nbsp;<span id="ast-35" class="other_trans">class_map</span>:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">isinstance</span>(<span id="ast-39" class="other_trans">metric</span>,&nbsp;<span id="ast-40" class="other_trans">cls</span>)</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43" class="other_trans">key</span><span id="ast-44">&nbsp;in&nbsp;</span><span id="ast-45" class="other_trans">registry</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">LookupError</span>(<span id="ast-49">(<span id="ast-50">'Metric&nbsp;%r&nbsp;already&nbsp;registered'</span>&nbsp;%&nbsp;<span id="ast-52" class="other_trans">key</span>)</span>)</span></span></span><span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>registry</span>[<span id="ast-56"><span id="ast-57" class="other_trans">key</span></span>]</span>&nbsp;=&nbsp;<span id="ast-58" class="ref_node">registry&nbsp;&rarr;&nbsp;metric&nbsp;</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">TypeError</span>(<span id="ast-63">(<span id="ast-64">'Invalid&nbsp;class.&nbsp;Could&nbsp;not&nbsp;register&nbsp;metric&nbsp;%r'</span>&nbsp;%&nbsp;<span id="ast-66" class="other_trans">key</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_ranking(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">nn</span>,&nbsp;<span id="ast-5" class="other_trans">H</span>,&nbsp;<span id="ast-7" class="other_trans">T</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;ranking&nbsp;of&nbsp;hidden&nbsp;neurons;&nbsp;random&nbsp;or&nbsp;OP.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14">self</span>.ranking</span><span id="ast-15" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-16">'OP'</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19"><span id="ast-20">self</span>.kmax_op</span><span id="ast-21" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-22">None</span>)</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.kmax_op</span>&nbsp;=&nbsp;<span id="ast-26" class="other_trans">nn</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nn</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30">self</span>.kmax_op</span></span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34"><span id="ast-35" class="incorrect_node">T&nbsp;&rarr;&nbsp;nn&nbsp;</span>.shape</span>[<span id="ast-36"><span id="ast-37">1</span></span>]</span><span id="ast-38" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-39">10</span>)</span>:<span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rank</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">mrsr</span>(<span id="ast-44" class="other_trans">H</span>,&nbsp;<span id="ast-45" class="other_trans">T</span>,&nbsp;<span id="ast-46"><span id="ast-47">self</span>.kmax_op</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rank</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51">mrsr2</span>(<span id="ast-52" class="other_trans">H</span>,&nbsp;<span id="ast-53" class="other_trans">T</span>,&nbsp;<span id="ast-54"><span id="ast-55">self</span>.kmax_op</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-58" class="other_trans">rank</span>,&nbsp;<span id="ast-59" class="other_trans">nn</span>)</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">super</span>(<span id="ast-64" class="other_trans">ELM</span>,&nbsp;<span id="ast-65">self</span>)</span>._ranking</span>(<span id="ast-66" class="other_trans">nn</span>)</span></span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-68">(<span id="ast-69" class="other_trans">rank</span>,&nbsp;<span id="ast-70" class="other_trans">nn</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_change_slot_states(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">task_slots</span>,&nbsp;<span id="ast-5" class="other_trans">new_state</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>all_slots</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9">self</span>._slots</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-11" class="other_trans">slot</span>&nbsp;in&nbsp;<span id="ast-12" class="other_trans">task_slots</span>:<span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>[<span id="ast-15" class="other_trans">slot_node</span>,&nbsp;<span id="ast-16" class="other_trans">slot_core</span>]</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">slot</span>.split</span>(<span id="ast-20">':'</span>)</span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>slot_entry</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25">(<span id="ast-26" class="other_trans">slot</span><span id="ast-27">&nbsp;for&nbsp;<span id="ast-28" class="other_trans">slot</span>&nbsp;in&nbsp;<span id="ast-29" class="other_trans">all_slots</span>&nbsp;if&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32" class="other_trans">slot</span>[<span id="ast-33"><span id="ast-34">'node'</span></span>]</span><span id="ast-35" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-36" class="other_trans">slot_node</span>)</span></span>)</span>.next</span>()</span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>slot_entry</span>[<span id="ast-41"><span id="ast-42">'cores'</span></span>]</span>[<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">int</span>(<span id="ast-46" class="other_trans">slot_core</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-47" class="other_trans">new_state</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-50"><span id="ast-51" class="other_trans">len</span>(<span id="ast-52"><span id="ast-53" class="other_trans">str</span>(<span id="ast-54"><span id="ast-55">self</span>._slot_history</span>)</span>)</span><span id="ast-56" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-57">(<span id="ast-58">(<span id="ast-59">4</span>&nbsp;*&nbsp;<span id="ast-61">1024</span>)</span>&nbsp;*&nbsp;<span id="ast-63">1024</span>)</span>)</span>:<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._slot_history</span>.append</span>(<span id="ast-69"><span id="ast-70"><span id="ast-71">self</span>._slot_status</span>(short=<span id="ast-73">True</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._slot_history</span>[<span id="ast-78"><span id="ast-79">-1</span></span>]</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82">self</span>._slot_status</span>(short=<span id="ast-84">True</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;form_valid(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">form</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>form</span>.save</span>()</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>get_adapter</span>()</span>.add_message</span>(<span id="ast-14"><span id="ast-15">self</span>.request</span>,&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">messages</span>.SUCCESS</span>,&nbsp;<span id="ast-18">'account/messages/password_changed.txt'</span>)</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>signals</span>.password_reset</span>.send</span>(sender=<span id="ast-25"><span id="ast-26"><span id="ast-27">self</span>.reset_user</span>.__class__</span>,&nbsp;request=<span id="ast-29"><span id="ast-30">self</span>.request</span>,&nbsp;user=<span id="ast-32"><span id="ast-33">self</span>.reset_user</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">app_settings</span>.LOGIN_ON_PASSWORD_RESET</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">perform_login</span>(<span id="ast-40" class="correct_node">request&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-41"><span id="ast-42">self</span>.reset_user</span>,&nbsp;email_verification=<span id="ast-44"><span id="ast-45" class="other_trans">app_settings</span>.EMAIL_VERIFICATION</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;next_candidate(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">worker_id</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9" class="other_trans">len</span>(<span id="ast-10"><span id="ast-11">self</span>.pending_candidates</span>)</span><span id="ast-12" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-13">0</span>)</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_candidate</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.pending_candidates</span>.pop</span>(<span id="ast-20">0</span>)</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-25">(<span id="ast-26">'Core&nbsp;providing&nbsp;pending&nbsp;candidate&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">str</span>(<span id="ast-30" class="other_trans">new_candidate</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">len</span>(<span id="ast-35"><span id="ast-36">self</span>.finished_candidates</span>)</span><span id="ast-37" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-38"><span id="ast-39">self</span>.initial_random_runs</span>)</span>:<span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_candidate</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45">self</span>.random_searcher</span>.next_candidate</span>()</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-50">(<span id="ast-51">'Core&nbsp;providing&nbsp;new&nbsp;randomly&nbsp;generated&nbsp;candidate&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">str</span>(<span id="ast-55" class="other_trans">new_candidate</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>acquisition_params</span>&nbsp;=&nbsp;<span id="ast-58">{<span id="ast-59">'param_defs'</span>:&nbsp;<span id="ast-63"><span id="ast-64">self</span>.param_defs</span>,&nbsp;<span id="ast-60">'gp'</span>:&nbsp;<span id="ast-65"><span id="ast-66">self</span>.gp</span>,&nbsp;<span id="ast-61">'cur_max'</span>:&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">self</span>.best_candidate</span>.result</span>,&nbsp;<span id="ast-62">'minimization'</span>:&nbsp;<span id="ast-70"><span id="ast-71">self</span>.minimization</span>}</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_file_view_info(<span id="ast-2"><span id="ast-3" class="other_trans">request</span>,&nbsp;<span id="ast-4" class="other_trans">where</span>,&nbsp;<span id="ast-5" class="other_trans">rev</span>,&nbsp;<span id="ast-7" class="other_trans">mime_type</span>,&nbsp;<span id="ast-9" class="other_trans">pathrev</span></span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;common&nbsp;hrefs&nbsp;and&nbsp;a&nbsp;viewability&nbsp;flag&nbsp;used&nbsp;for&nbsp;various&nbsp;views\\u000a&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;FILENAME&nbsp;at&nbsp;revision&nbsp;REV&nbsp;whose&nbsp;MIME&nbsp;type&nbsp;is&nbsp;MIME_TYPE.'</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rev</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-17">(<span id="ast-19">rev</span>&nbsp;and&nbsp;<span id="ast-20"><span id="ast-21">str</span>(<span id="ast-22" class="other_trans">rev</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-23">None</span>)</span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mime_type</span>&nbsp;=&nbsp;<span id="ast-26">(<span id="ast-28">mime_type</span>&nbsp;or&nbsp;<span id="ast-29"><span id="ast-30">request</span>.mime_type</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33" class="other_trans">pathrev</span><span id="ast-34" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-35">-1</span>)</span>:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pathrev</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">request</span>.pathrev</span></span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>download_text_href</span>,&nbsp;<span id="ast-42">annotate_href</span>,&nbsp;<span id="ast-43" class="other_trans">revision_href</span>&nbsp;=&nbsp;<span id="ast-44">None</span></span><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>view_href</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">request</span>.get_url</span>(view_func=<span id="ast-51" class="other_trans">view_markup</span>,&nbsp;where=<span id="ast-53" class="other_trans">where</span>,&nbsp;pathtype=<span id="ast-55"><span id="ast-56" class="other_trans">vclib</span>.FILE</span>,&nbsp;params=<span id="ast-58">{<span id="ast-59">'revision'</span>:&nbsp;<span id="ast-61" class="other_trans">rev</span>,&nbsp;<span id="ast-60">'pathrev'</span>:&nbsp;<span id="ast-62" class="other_trans">pathrev</span>}</span>,&nbsp;escape=<span id="ast-64">1</span>)</span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>download_href</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">request</span>.get_url</span>(view_func=<span id="ast-71">view_checkout</span>,&nbsp;where=<span id="ast-73" class="other_trans">where</span>,&nbsp;pathtype=<span id="ast-75"><span id="ast-76" class="other_trans">vclib</span>.FILE</span>,&nbsp;params=<span id="ast-78">{<span id="ast-79">'revision'</span>:&nbsp;<span id="ast-81" class="other_trans">rev</span>,&nbsp;<span id="ast-80">'pathrev'</span>:&nbsp;<span id="ast-82">pathrev</span>}</span>,&nbsp;escape=<span id="ast-84">1</span>)</span></span><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-86">(<span id="ast-87">not</span>&nbsp;<span id="ast-88"><span id="ast-89">is_plain_text</span>(<span id="ast-90" class="other_trans">mime_type</span>)</span>)</span>:<span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>download_text_href</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans">request</span>.get_url</span>(view_func=<span id="ast-97" class="other_trans">view_checkout</span>,&nbsp;where=<span id="ast-99" class="other_trans">where</span>,&nbsp;pathtype=<span id="ast-101"><span id="ast-102">vclib</span>.FILE</span>,&nbsp;params=<span id="ast-104">{<span id="ast-105">'content-type'</span>:&nbsp;<span id="ast-108">'text/plain'</span>,&nbsp;<span id="ast-106">'revision'</span>:&nbsp;<span id="ast-109">rev</span>,&nbsp;<span id="ast-107">'pathrev'</span>:&nbsp;<span id="ast-110" class="correct_node">rev&nbsp;&rarr;&nbsp;pathrev&nbsp;</span>}</span>,&nbsp;escape=<span id="ast-112">1</span>)</span></span></span><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-114"><span id="ast-115"><span id="ast-116"><span id="ast-117">request</span>.cfg</span>.options</span>.allow_annotate</span>:<span id="ast-118"><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>annotate_href</span>&nbsp;=&nbsp;<span id="ast-120"><span id="ast-121"><span id="ast-122" class="other_trans">request</span>.get_url</span>(view_func=<span id="ast-124">view_annotate</span>,&nbsp;where=<span id="ast-126" class="other_trans">where</span>,&nbsp;pathtype=<span id="ast-128"><span id="ast-129" class="other_trans">vclib</span>.FILE</span>,&nbsp;params=<span id="ast-131">{<span id="ast-132">'annotate'</span>:&nbsp;<span id="ast-134">rev</span>,&nbsp;<span id="ast-133">'pathrev'</span>:&nbsp;<span id="ast-135" class="other_trans">pathrev</span>}</span>,&nbsp;escape=<span id="ast-137">1</span>)</span></span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-139">(<span id="ast-140"><span id="ast-141" class="other_trans">request</span>.roottype</span><span id="ast-142" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-143">'svn'</span>)</span>:<span id="ast-144"><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>revision_href</span>&nbsp;=&nbsp;<span id="ast-146"><span id="ast-147"><span id="ast-148" class="other_trans">request</span>.get_url</span>(view_func=<span id="ast-150">view_revision</span>,&nbsp;params=<span id="ast-152">{<span id="ast-153">'revision'</span>:&nbsp;<span id="ast-154">rev</span>}</span>,&nbsp;escape=<span id="ast-156">1</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;star_fn(<span id="ast-2"><span id="ast-3" class="other_trans">srs</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>a</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">srs</span>.pop</span>()</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>b</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">srs</span>.pop</span>()</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-17">(<span id="ast-18"><span id="ast-19">type</span>(<span id="ast-20" class="other_trans">a</span>)</span><span id="ast-21" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-22">ListType</span>)</span>&nbsp;and&nbsp;<span id="ast-23">(<span id="ast-24"><span id="ast-25">type</span>(<span id="ast-26" class="ref_node">a&nbsp;&rarr;&nbsp;b&nbsp;</span>)</span><span id="ast-27" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-28">ListType</span>)</span>)</span>:<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>srs</span>.push</span>(<span id="ast-33"><span id="ast-34">map</span>(<span id="ast-35">lambda&nbsp;<span id="ast-36"><span id="ast-37">x</span></span>:&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">x</span>&nbsp;*&nbsp;<span id="ast-41" class="other_trans">b</span>)</span></span>,&nbsp;<span id="ast-42" class="other_trans">a</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-44">(<span id="ast-46">(<span id="ast-47"><span id="ast-48">type</span>(<span id="ast-49">b</span>)</span><span id="ast-50" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-51">ListType</span>)</span>&nbsp;and&nbsp;<span id="ast-52">(<span id="ast-53"><span id="ast-54">type</span>(<span id="ast-55" class="other_trans">a</span>)</span><span id="ast-56" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-57" class="other_trans">ListType</span>)</span>)</span>:<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>srs</span>.push</span>(<span id="ast-62"><span id="ast-63">map</span>(<span id="ast-64">lambda&nbsp;<span id="ast-65"><span id="ast-66">x</span></span>:&nbsp;<span id="ast-67">(<span id="ast-68">x</span>&nbsp;*&nbsp;<span id="ast-70">a</span>)</span></span>,&nbsp;<span id="ast-71" class="other_trans">b</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75" class="other_trans">type</span>(<span id="ast-76" class="other_trans">a</span>)</span><span id="ast-77" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-79"><span id="ast-80" class="other_trans">type</span>(<span id="ast-81" class="other_trans">b</span>)</span><span id="ast-78" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-82" class="other_trans">ListType</span>)</span>:<span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85"><span id="ast-86" class="other_trans">len</span>(<span id="ast-87" class="other_trans">b</span>)</span><span id="ast-88" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-89"><span id="ast-90">len</span>(<span id="ast-91" class="other_trans">a</span>)</span>)</span>:<span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-94" class="other_trans">a</span>,&nbsp;<span id="ast-95">b</span>)</span>&nbsp;=&nbsp;<span id="ast-96">(<span id="ast-97">b</span>,&nbsp;<span id="ast-98" class="other_trans">a</span>)</span></span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-100">(<span id="ast-101"><span id="ast-102">len</span>(<span id="ast-103" class="other_trans">b</span>)</span><span id="ast-104" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-105"><span id="ast-106">len</span>(<span id="ast-107" class="other_trans">a</span>)</span>)</span>:<span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>b</span>.append</span>(<span id="ast-112">0</span>)</span></span></span><span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>srs</span>.push</span>(<span id="ast-117"><span id="ast-118">sum</span>(<span id="ast-119">[<span id="ast-120"><span id="ast-121" class="other_trans">prod</span>(<span id="ast-122" class="other_trans">x</span>)</span><span id="ast-123">&nbsp;for&nbsp;<span id="ast-124" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-125"><span id="ast-126" class="other_trans">zip</span>(<span id="ast-127" class="other_trans">a</span>,&nbsp;<span id="ast-128">b</span>)</span></span>]</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-129"><span id="ast-130"><span id="ast-131"><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>srs</span>.push</span>(<span id="ast-133">(<span id="ast-134" class="other_trans">a</span>&nbsp;*&nbsp;<span id="ast-136">b</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;send(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">fail_silently</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Sends&nbsp;the&nbsp;sms&nbsp;message\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10">not</span>&nbsp;<span id="ast-11"><span id="ast-12">self</span>.to</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-14">0</span></span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.get_connection</span>(<span id="ast-22" class="other_trans">fail_silently</span>)</span>.send_messages</span>(<span id="ast-23">[<span id="ast-24">self</span>]</span>)</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sms_post_send</span>.send</span>(sender=<span id="ast-30">self</span>,&nbsp;to=<span id="ast-32"><span id="ast-33">self</span>.to</span>,&nbsp;from_phone=<span id="ast-35"><span id="ast-36">self</span>.from_phone</span>,&nbsp;body=<span id="ast-38" class="correct_node">body&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-40" class="other_trans">res</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;le(<span id="ast-2"><span id="ast-3" class="other_trans">a</span>,&nbsp;<span id="ast-4" class="other_trans">b</span>,&nbsp;<span id="ast-5" class="other_trans">fmt</span>,&nbsp;*args</span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">a</span><span id="ast-10" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-11" class="other_trans">b</span>)</span>,&nbsp;<span id="ast-12">(<span id="ast-13">'Failed:&nbsp;%s&nbsp;&lt;=&nbsp;%s&nbsp;(%s)'</span>&nbsp;%&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">a</span>,&nbsp;<span id="ast-17" class="other_trans">b</span>,&nbsp;<span id="ast-18">(<span id="ast-19" class="other_trans">fmt</span>&nbsp;%&nbsp;<span id="ast-21" class="other_trans">args</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_need_update(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">project_name</span>,&nbsp;<span id="ast-5" class="other_trans">updatetime</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Check&nbsp;if&nbsp;project_name&nbsp;need&nbsp;update'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11" class="other_trans">project_name</span><span id="ast-12">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-13"><span id="ast-14">self</span>.projects</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-16">True</span></span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-20" class="other_trans">updatetime</span>&nbsp;and&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">updatetime</span><span id="ast-23" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>.projects</span>[<span id="ast-30"><span id="ast-31" class="other_trans">project_name</span></span>]</span>[<span id="ast-32"><span id="ast-33">'info'</span></span>]</span>.get</span>(<span id="ast-34">'updatetime'</span>,&nbsp;<span id="ast-35">0</span>)</span>)</span>)</span>:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-37">True</span></span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40">(<span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48">self</span>.projects</span>[<span id="ast-49"><span id="ast-50" class="other_trans">project_name</span></span>]</span>[<span id="ast-51"><span id="ast-52">'load_time'</span></span>]</span>)</span><span id="ast-53" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-54"><span id="ast-55">self</span>.RELOAD_PROJECT_INTERVAL</span>)</span>:<span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-57">True</span></span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-59">False</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;will_close(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Save&nbsp;stuff&nbsp;here\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:return:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8" class="other_trans">PYTHONISTA_VERSION_LONG</span><span id="ast-9" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-10">'300010'</span>)</span>:<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stash</span>.runtime</span>.save_history</span>()</span></span><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stash</span>.cleanup</span>()</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stash</span>.runtime</span>.worker_registry</span>.purge</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;remove_artifact(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">artifact_name</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>con</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>.connect_to_database</span>()</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cur</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">con</span>.cursor</span>()</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cur</span>.execute</span>(<span id="ast-20">'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;delete&nbsp;from&nbsp;artifacts&nbsp;where&nbsp;artifact&nbsp;=&nbsp;?\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'</span>,&nbsp;<span id="ast-21">[<span id="ast-22" class="other_trans">artifact_name</span>]</span>)</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cur&nbsp;&rarr;&nbsp;con&nbsp;</span>.commit</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>finally:<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>con</span>.close</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;wrap(<span id="ast-2"><span id="ast-3" class="other_trans">source_files</span>,&nbsp;<span id="ast-4" class="other_trans">options</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>validate_args</span>(<span id="ast-8" class="other_trans">options</span>,&nbsp;<span id="ast-9" class="other_trans">source_files</span>)</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f_ast</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">generate_ast</span>(<span id="ast-14" class="incorrect_node">source_files&nbsp;&rarr;&nbsp;options&nbsp;</span>)</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fc_ast</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">wrap_fc</span>(<span id="ast-19" class="other_trans">f_ast</span>)</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cy_ast</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23">wrap_cy</span>(<span id="ast-24" class="other_trans">fc_ast</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>gens</span>&nbsp;=&nbsp;<span id="ast-27">[<span id="ast-28">(<span id="ast-29" class="other_trans">generate_type_specs</span>,&nbsp;<span id="ast-30" class="ref_node">f_ast&nbsp;&rarr;&nbsp;fc_ast&nbsp;</span>)</span>,&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">generate_fc_f</span>,&nbsp;<span id="ast-33" class="other_trans">fc_ast</span>)</span>,&nbsp;<span id="ast-34">(<span id="ast-35" class="other_trans">generate_fc_h</span>,&nbsp;<span id="ast-36" class="other_trans">fc_ast</span>)</span>,&nbsp;<span id="ast-37">(<span id="ast-38">generate_fc_pxd</span>,&nbsp;<span id="ast-39" class="other_trans">fc_ast</span>)</span>,&nbsp;<span id="ast-40">(<span id="ast-41">generate_cy_pxd</span>,&nbsp;<span id="ast-42" class="other_trans">cy_ast</span>)</span>,&nbsp;<span id="ast-43">(<span id="ast-44" class="other_trans">generate_cy_pyx</span>,&nbsp;<span id="ast-45" class="other_trans">cy_ast</span>)</span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;wrapper(<span id="ast-2"></span>):<span id="ast-3"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-4">True</span>:<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">fn</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-10" class="other_trans">AssertionError</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">time</span>.time</span>()</span><span id="ast-16" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-17" class="other_trans">timeout</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;hashes2landmarks(<span id="ast-2"><span id="ast-3" class="other_trans">hashes</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Convert&nbsp;the&nbsp;mashed-up&nbsp;landmarks&nbsp;in&nbsp;hashes&nbsp;back&nbsp;into&nbsp;a&nbsp;list\\u000a&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;(time,&nbsp;bin1,&nbsp;bin2,&nbsp;dtime)&nbsp;tuples.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>landmarks</span>&nbsp;=&nbsp;<span id="ast-8">[]</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-10">(<span id="ast-11" class="other_trans">time_</span>,&nbsp;<span id="ast-12" class="other_trans">hash_</span>)</span>&nbsp;in&nbsp;<span id="ast-13" class="other_trans">hashes</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dtime</span>&nbsp;=&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">hash_</span>&nbsp;&amp;&nbsp;<span id="ast-19" class="other_trans">DT_MASK</span>)</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bin1</span>&nbsp;=&nbsp;<span id="ast-22">(<span id="ast-23">(<span id="ast-24" class="other_trans">hash_</span>&nbsp;&gt;&gt;&nbsp;<span id="ast-26" class="other_trans">B1_SHIFT</span>)</span>&nbsp;&amp;&nbsp;<span id="ast-28" class="other_trans">B1_MASK</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dbin</span>&nbsp;=&nbsp;<span id="ast-31">(<span id="ast-32">(<span id="ast-33" class="other_trans">hash_</span>&nbsp;&gt;&gt;&nbsp;<span id="ast-35" class="other_trans">DF_SHIFT</span>)</span>&nbsp;&amp;&nbsp;<span id="ast-37" class="other_trans">DF_MASK</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40" class="other_trans">dbin</span><span id="ast-41" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-42">(<span id="ast-43">1</span>&nbsp;&lt;&lt;&nbsp;<span id="ast-45">(<span id="ast-46">DF_BITS</span>&nbsp;-&nbsp;<span id="ast-48">1</span>)</span>)</span>)</span>:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dbin</span>&nbsp;-=&nbsp;<span id="ast-52">(<span id="ast-53">1</span>&nbsp;&lt;&lt;&nbsp;<span id="ast-55" class="other_trans">DF_BITS</span>)</span></span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>landmarks</span>.append</span>(<span id="ast-60">(<span id="ast-61" class="other_trans">time_</span>,&nbsp;<span id="ast-62" class="other_trans">bin1</span>,&nbsp;<span id="ast-63">(<span id="ast-64" class="other_trans">bin1</span>&nbsp;+&nbsp;<span id="ast-66" class="other_trans">dbin</span>)</span>,&nbsp;<span id="ast-67" class="other_trans">dtime</span>)</span>)</span></span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-69" class="other_trans">landmarks</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_sort(<span id="ast-2"><span id="ast-3" class="other_trans">ob</span>,&nbsp;<span id="ast-4" class="other_trans">ol</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>reverse</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">ob</span>.startswith</span>(<span id="ast-10">'-'</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ob</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-15"><span id="ast-16" class="other_trans">ob</span>[<span id="ast-17"><span id="ast-18">1</span>:</span>]</span>&nbsp;if&nbsp;<span id="ast-14" class="other_trans">reverse</span>&nbsp;else&nbsp;<span id="ast-19" class="other_trans">ob</span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-21" class="other_trans">column</span>&nbsp;in&nbsp;<span id="ast-22"><span id="ast-23">self</span>.columns</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-27">(<span id="ast-28"><span id="ast-29" class="other_trans">column</span>.sort_key_fn</span><span id="ast-30" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-31" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">column</span>.name</span><span id="ast-35" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-36" class="other_trans">ob</span>)</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">sorted</span>(<span id="ast-40" class="other_trans">ol</span>,&nbsp;key=<span id="ast-42"><span id="ast-43" class="other_trans">column</span>.sort_key_fn</span>,&nbsp;reverse=<span id="ast-45" class="other_trans">reverse</span>)</span></span></span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>._meta</span>.order_by</span>&nbsp;and&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">hasattr</span>(<span id="ast-54" class="other_trans">ol</span>,&nbsp;<span id="ast-55">'order_by'</span>)</span>)</span>:<span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">list</span>(<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">ol</span>.order_by</span>(*<span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66">self</span>._meta</span>.order_by</span>.split</span>(<span id="ast-67">'|'</span>)</span>)</span>)</span></span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-69" class="ref_node">ob&nbsp;&rarr;&nbsp;ol&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;compare(<span id="ast-2"><span id="ast-3" class="other_trans">points</span>,&nbsp;<span id="ast-4" class="other_trans">user1</span>,&nbsp;<span id="ast-5" class="other_trans">user2</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">points</span>[<span id="ast-12"><span id="ast-13">'users'</span></span>]</span>[<span id="ast-14"><span id="ast-15" class="other_trans">user1</span></span>]</span>[<span id="ast-16"><span id="ast-17">'points'</span></span>]</span><span id="ast-18" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">points</span>[<span id="ast-23"><span id="ast-24">'users'</span></span>]</span>[<span id="ast-25"><span id="ast-26" class="other_trans">user2</span></span>]</span>[<span id="ast-27"><span id="ast-28">'points'</span></span>]</span>)</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-30">'it&nbsp;is&nbsp;a&nbsp;tie'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36">points</span>[<span id="ast-37"><span id="ast-38">'users'</span></span>]</span>[<span id="ast-39"><span id="ast-40" class="other_trans">user1</span></span>]</span>[<span id="ast-41"><span id="ast-42">'points'</span></span>]</span><span id="ast-43" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">points</span>[<span id="ast-48"><span id="ast-49">'users'</span></span>]</span>[<span id="ast-50"><span id="ast-51" class="other_trans">user2</span></span>]</span>[<span id="ast-52"><span id="ast-53">'points'</span></span>]</span>)</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57" class="other_trans">_</span>(<span id="ast-58">'%(nick1)s&nbsp;has&nbsp;%(numberofpoints)s&nbsp;more&nbsp;point(s)&nbsp;over&nbsp;%(nick2)s'</span>)</span>&nbsp;%&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">dict</span>(nick1=<span id="ast-63" class="other_trans">user1</span>,&nbsp;numberofpoints=<span id="ast-65"><span id="ast-66">str</span>(<span id="ast-67">(<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">points</span>[<span id="ast-72"><span id="ast-73">'users'</span></span>]</span>[<span id="ast-74"><span id="ast-75" class="other_trans">user1</span></span>]</span>[<span id="ast-76"><span id="ast-77">'points'</span></span>]</span>&nbsp;-&nbsp;<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">points</span>[<span id="ast-83"><span id="ast-84">'users'</span></span>]</span>[<span id="ast-85"><span id="ast-86" class="other_trans">user2</span></span>]</span>[<span id="ast-87"><span id="ast-88">'points'</span></span>]</span>)</span>)</span>,&nbsp;nick2=<span id="ast-90" class="other_trans">user2</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-92">(<span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans">points</span>[<span id="ast-97"><span id="ast-98">'users'</span></span>]</span>[<span id="ast-99"><span id="ast-100" class="other_trans">user1</span></span>]</span>[<span id="ast-101"><span id="ast-102">'points'</span></span>]</span><span id="ast-103" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans">points</span>[<span id="ast-108"><span id="ast-109">'users'</span></span>]</span>[<span id="ast-110"><span id="ast-111" class="other_trans">user2</span></span>]</span>[<span id="ast-112"><span id="ast-113">'points'</span></span>]</span>)</span>:<span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-115">(<span id="ast-116"><span id="ast-117" class="other_trans">_</span>(<span id="ast-118">'%(nick1)s&nbsp;has&nbsp;%(numberofpoints)s&nbsp;more&nbsp;point(s)&nbsp;over&nbsp;%(nick2)s'</span>)</span>&nbsp;%&nbsp;<span id="ast-120"><span id="ast-121">dict</span>(nick1=<span id="ast-123" class="other_trans">user2</span>,&nbsp;numberofpoints=<span id="ast-125"><span id="ast-126">str</span>(<span id="ast-127">(<span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans">points</span>[<span id="ast-132"><span id="ast-133">'users'</span></span>]</span>[<span id="ast-134"><span id="ast-135" class="other_trans">user2</span></span>]</span>[<span id="ast-136"><span id="ast-137">'points'</span></span>]</span>&nbsp;-&nbsp;<span id="ast-139"><span id="ast-140"><span id="ast-141"><span id="ast-142" class="other_trans">points</span>[<span id="ast-143"><span id="ast-144">'users'</span></span>]</span>[<span id="ast-145"><span id="ast-146" class="other_trans">user1</span></span>]</span>[<span id="ast-147"><span id="ast-148">'points'</span></span>]</span>)</span>)</span>,&nbsp;nick2=<span id="ast-150" class="other_trans">user1</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;iter_until_converge(<span id="ast-2"><span id="ast-3" class="other_trans">network</span>,&nbsp;<span id="ast-4" class="other_trans">epsilon</span>,&nbsp;<span id="ast-5" class="other_trans">max_epochs</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">network</span>.epoch</span></span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>error</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">network</span>.last_error</span>()</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">error</span><span id="ast-18" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-19" class="other_trans">epsilon</span>)</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>network</span>.epoch</span>&nbsp;+=&nbsp;<span id="ast-24">1</span></span><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">network</span>.epoch</span></span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>error</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">abs</span>(<span id="ast-33">(<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">network</span>.last_error</span>()</span>&nbsp;-&nbsp;<span id="ast-38" class="other_trans">error</span>)</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-42">(<span id="ast-43"><span id="ast-44" class="other_trans">network</span>.epoch</span><span id="ast-45" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-46" class="other_trans">max_epochs</span>)</span>&nbsp;and&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">error</span><span id="ast-49" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-50" class="other_trans">epsilon</span>)</span>)</span>:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>network</span>.logs</span>.log</span>(<span id="ast-56">'TRAIN'</span>,&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59">"Epoch&nbsp;#{}&nbsp;stopped.&nbsp;Network&nbsp;didn't&nbsp;converge&nbsp;after&nbsp;{}&nbsp;iterations"</span>.format</span>(<span id="ast-60"><span id="ast-61" class="other_trans">network</span>.epoch</span>,&nbsp;<span id="ast-62" class="other_trans">max_epochs</span>)</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;unsubscribe(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">channel</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Unsubscribe&nbsp;from&nbsp;channel&nbsp;.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Only&nbsp;works&nbsp;in&nbsp;async&nbsp;mode\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel:&nbsp;Channel&nbsp;name&nbsp;(&nbsp;string&nbsp;)&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">channel</span><span id="ast-10">&nbsp;in&nbsp;</span><span id="ast-12"><span id="ast-13">self</span>.subscriptions</span><span id="ast-11" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-14">False</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-16">False</span></span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-18"><span id="ast-19">self</span>._channel_list_lock</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">channel</span><span id="ast-23">&nbsp;in&nbsp;</span><span id="ast-24"><span id="ast-25">self</span>.subscriptions</span>)</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.subscriptions</span>[<span id="ast-31"><span id="ast-32" class="other_trans">channel</span></span>]</span>[<span id="ast-33"><span id="ast-34">'connected'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-35">0</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.subscriptions</span>[<span id="ast-41"><span id="ast-42" class="other_trans">channel</span></span>]</span>[<span id="ast-43"><span id="ast-44">'subscribed'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-45">False</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.subscriptions</span>[<span id="ast-51"><span id="ast-52" class="other_trans">channel</span></span>]</span>[<span id="ast-53"><span id="ast-54">'timetoken'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-55">0</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.subscriptions</span>[<span id="ast-61"><span id="ast-62" class="other_trans">channel</span></span>]</span>[<span id="ast-63"><span id="ast-64">'first'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-65">False</span></span><span id="ast-66"><span id="ast-67"><span id="ast-68"><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.leave_channel</span>(channel=<span id="ast-71" class="other_trans">channel</span>)</span></span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>STATE&nbsp;&rarr;&nbsp;self.&nbsp;</span>.pop</span>(<span id="ast-76" class="other_trans">channel</span>,&nbsp;<span id="ast-77" class="other_trans">None</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__getitem__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">key</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7" class="other_trans">key</span><span id="ast-8">&nbsp;in&nbsp;</span><span id="ast-9">self</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">dict</span>.__getitem__</span>(<span id="ast-14">self</span>,&nbsp;<span id="ast-15" class="other_trans">key</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>[<span id="ast-19"><span id="ast-20" class="other_trans">key</span></span>]</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">LpVariable</span>(<span id="ast-23">(<span id="ast-24" class="correct_node">name&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;%&nbsp;<span id="ast-26" class="other_trans">key</span>)</span>,&nbsp;<span id="ast-27" class="other_trans">lowBound</span>,&nbsp;<span id="ast-28" class="other_trans">upBound</span>,&nbsp;<span id="ast-29" class="other_trans">cat</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-31"><span id="ast-32">self</span>[<span id="ast-33"><span id="ast-34" class="other_trans">key</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;create_blank_hackpad(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">asUser</span>,&nbsp;<span id="ast-6" class="other_trans">content_type</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-9"><span id="ast-10" class="correct_node">create_hackpad&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-11">'Hackpad&nbsp;Title'</span>,&nbsp;<span id="ast-12">'Auto-generated&nbsp;Hackpad&nbsp;contents.'</span>,&nbsp;<span id="ast-13" class="other_trans">asUser</span>,&nbsp;<span id="ast-14" class="other_trans">content_type</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;next(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Returns&nbsp;the&nbsp;next&nbsp;item&nbsp;or&nbsp;None'</span></span><span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.index</span>&nbsp;+=&nbsp;<span id="ast-10">1</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>t</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.peek</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19">self</span>.depth</span><span id="ast-20" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-21">0</span>)</span>:<span id="ast-22"><span id="ast-23"><span id="ast-24" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cut&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26" class="other_trans">t</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">name</span>,&nbsp;<span id="ast-5" class="other_trans">entryList</span>,&nbsp;<span id="ast-6" class="other_trans">minT</span>,&nbsp;<span id="ast-8">maxT</span></span>):<span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>entryList</span>&nbsp;=&nbsp;<span id="ast-12">[<span id="ast-13">(<span id="ast-14"><span id="ast-15">float</span>(<span id="ast-16">start</span>)</span>,&nbsp;<span id="ast-17"><span id="ast-18">float</span>(<span id="ast-19" class="other_trans">stop</span>)</span>,&nbsp;<span id="ast-20">label</span>)</span><span id="ast-21">&nbsp;for&nbsp;<span id="ast-22">(<span id="ast-23">start</span>,&nbsp;<span id="ast-24" class="other_trans">stop</span>,&nbsp;<span id="ast-25" class="other_trans">label</span>)</span>&nbsp;in&nbsp;<span id="ast-26">entryList</span></span>]</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-29">minT</span><span id="ast-30" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-31" class="other_trans">None</span>)</span>:<span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>minT</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35">float</span>(<span id="ast-36">minT</span>)</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">maxT</span><span id="ast-40" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-41">None</span>)</span>:<span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>maxT</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45">float</span>(<span id="ast-46" class="other_trans">maxT</span>)</span></span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-48" class="other_trans">entry</span>&nbsp;in&nbsp;<span id="ast-49">entryList</span>:<span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-53" class="other_trans">entry</span>[<span id="ast-54"><span id="ast-55">0</span></span>]</span><span id="ast-56" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-57"><span id="ast-58" class="other_trans">entry</span>[<span id="ast-59"><span id="ast-60">1</span></span>]</span>)</span>:<span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fmtStr</span>&nbsp;=&nbsp;<span id="ast-63">'Anomaly:&nbsp;startTime=%f,&nbsp;stopTime=%f,&nbsp;label=%s'</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-65">(<span id="ast-66" class="other_trans">fmtStr</span>&nbsp;%&nbsp;<span id="ast-68">(<span id="ast-69"><span id="ast-70" class="other_trans">entry</span>[<span id="ast-71"><span id="ast-72">0</span></span>]</span>,&nbsp;<span id="ast-73"><span id="ast-74">entry</span>[<span id="ast-75"><span id="ast-76">1</span></span>]</span>,&nbsp;<span id="ast-77"><span id="ast-78">entry</span>[<span id="ast-79"><span id="ast-80">2</span></span>]</span>)</span>)</span></span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-82">(<span id="ast-83"><span id="ast-84" class="other_trans">entry</span>[<span id="ast-85"><span id="ast-86">0</span></span>]</span><span id="ast-87" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-88"><span id="ast-89" class="other_trans">entry</span>[<span id="ast-90"><span id="ast-91">1</span></span>]</span>)</span></span></span><span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tmpEntryList</span>&nbsp;=&nbsp;<span id="ast-94">[]</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-96">(<span id="ast-97" class="other_trans">start</span>,&nbsp;<span id="ast-98">stop</span>,&nbsp;<span id="ast-99" class="other_trans">label</span>)</span>&nbsp;in&nbsp;<span id="ast-100">entryList</span>:<span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tmpEntryList</span>.append</span>(<span id="ast-105">(<span id="ast-106" class="other_trans">start</span>,&nbsp;<span id="ast-107" class="other_trans">stop</span>,&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110" class="other_trans">label</span>.strip</span>()</span>)</span>)</span></span></span><span id="ast-111"><span id="ast-112" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>entryList</span>&nbsp;=&nbsp;<span id="ast-113" class="other_trans">tmpEntryList</span></span><span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>minTimeList</span>&nbsp;=&nbsp;<span id="ast-116">[<span id="ast-117"><span id="ast-118" class="other_trans">subList</span>[<span id="ast-119"><span id="ast-120">0</span></span>]</span><span id="ast-121">&nbsp;for&nbsp;<span id="ast-122">subList</span>&nbsp;in&nbsp;<span id="ast-123" class="other_trans">entryList</span></span>]</span></span><span id="ast-124"><span id="ast-125" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>maxTimeList</span>&nbsp;=&nbsp;<span id="ast-126">[<span id="ast-127"><span id="ast-128">subList</span>[<span id="ast-129"><span id="ast-130">1</span></span>]</span><span id="ast-131">&nbsp;for&nbsp;<span id="ast-132">subList</span>&nbsp;in&nbsp;<span id="ast-133" class="other_trans">entryList</span></span>]</span></span><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-135">(<span id="ast-136">minT</span><span id="ast-137" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-138" class="other_trans">None</span>)</span>:<span id="ast-139"><span id="ast-140"><span id="ast-141"><span id="ast-142" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>minTimeList</span>.append</span>(<span id="ast-143" class="other_trans">minT</span>)</span></span></span><span id="ast-144"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-145">(<span id="ast-146" class="other_trans">maxT</span><span id="ast-147" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-148" class="other_trans">None</span>)</span>:<span id="ast-149"><span id="ast-150"><span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>maxTimeList</span>.append</span>(<span id="ast-153">maxT</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_run_unary_metric_evaluation(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>unary_results</span>&nbsp;=&nbsp;<span id="ast-6">[]</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-8" class="other_trans">metric</span>&nbsp;in&nbsp;<span id="ast-9"><span id="ast-10">self</span>.unary_metrics</span>:<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>unary_results</span>.append</span>(<span id="ast-15">[]</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17"><span id="ast-18">self</span>.ref_dataset</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>unary_results</span>[<span id="ast-24"><span id="ast-25">-1</span></span>]</span>.append</span>(<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">metric</span>.run</span>(<span id="ast-29" class="correct_node">ref_dataset&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_auto_commit(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;if&nbsp;we&nbsp;have&nbsp;to&nbsp;commit&nbsp;based&nbsp;on&nbsp;number&nbsp;of&nbsp;messages&nbsp;and&nbsp;commit\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-9">(<span id="ast-10">not</span>&nbsp;<span id="ast-11"><span id="ast-12">self</span>.auto_commit</span>)</span>&nbsp;or&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15">self</span>.auto_commit_every_n</span><span id="ast-16" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-17" class="other_trans">None</span>)</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21"><span id="ast-22">self</span>.count_since_commit</span><span id="ast-23" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-24"><span id="ast-25">self</span>.auto_commit_every_n</span>)</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.commit</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;make_rating_request(<span id="ast-2"><span id="ast-3" class="other_trans">artist_ratings</span>,&nbsp;<span id="ast-4" class="other_trans">recording_ratings</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>NS</span>&nbsp;=&nbsp;<span id="ast-7">'http://musicbrainz.org/ns/mmd-2.0#'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>root</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">ET</span>.Element</span>(<span id="ast-13">(<span id="ast-14">'{%s}metadata'</span>&nbsp;%&nbsp;<span id="ast-16">NS</span>)</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rec_list</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">ET</span>.SubElement</span>(<span id="ast-22">root</span>,&nbsp;<span id="ast-23">(<span id="ast-24">'{%s}recording-list'</span>&nbsp;%&nbsp;<span id="ast-26" class="other_trans">NS</span>)</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-28">(<span id="ast-29">rec</span>,&nbsp;<span id="ast-30" class="other_trans">rating</span>)</span>&nbsp;in&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">recording_ratings</span>.items</span>()</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rec_xml</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">ET</span>.SubElement</span>(<span id="ast-39">rec_list</span>,&nbsp;<span id="ast-40">(<span id="ast-41">'{%s}recording'</span>&nbsp;%&nbsp;<span id="ast-43">NS</span>)</span>)</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rec_xml</span>.set</span>(<span id="ast-48">(<span id="ast-49">'{%s}id'</span>&nbsp;%&nbsp;<span id="ast-51" class="other_trans">NS</span>)</span>,&nbsp;<span id="ast-52">rec</span>)</span></span><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rating_xml</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">ET</span>.SubElement</span>(<span id="ast-58">rec_xml</span>,&nbsp;<span id="ast-59">(<span id="ast-60">'{%s}user-rating'</span>&nbsp;%&nbsp;<span id="ast-62" class="other_trans">NS</span>)</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">isinstance</span>(<span id="ast-66" class="other_trans">rating</span>,&nbsp;<span id="ast-67" class="other_trans">int</span>)</span>:<span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rating</span>&nbsp;=&nbsp;<span id="ast-70">(<span id="ast-71">'%d'</span>&nbsp;%&nbsp;<span id="ast-73">rating</span>)</span></span></span><span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rating_xml</span>.text</span>&nbsp;=&nbsp;<span id="ast-77" class="other_trans">rating</span></span></span><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>art_list</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82">ET</span>.SubElement</span>(<span id="ast-83">root</span>,&nbsp;<span id="ast-84">(<span id="ast-85">'{%s}artist-list'</span>&nbsp;%&nbsp;<span id="ast-87" class="other_trans">NS</span>)</span>)</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-89">(<span id="ast-90">art</span>,&nbsp;<span id="ast-91" class="other_trans">rating</span>)</span>&nbsp;in&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94" class="incorrect_node">artist_ratings&nbsp;&rarr;&nbsp;recording_ratings&nbsp;</span>.items</span>()</span>:<span id="ast-95"><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>art_xml</span>&nbsp;=&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans">ET</span>.SubElement</span>(<span id="ast-100">art_list</span>,&nbsp;<span id="ast-101">(<span id="ast-102">'{%s}artist'</span>&nbsp;%&nbsp;<span id="ast-104" class="other_trans">NS</span>)</span>)</span></span><span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>art_xml</span>.set</span>(<span id="ast-109">(<span id="ast-110">'{%s}id'</span>&nbsp;%&nbsp;<span id="ast-112">NS</span>)</span>,&nbsp;<span id="ast-113" class="other_trans">art</span>)</span></span><span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rating_xml</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans">ET</span>.SubElement</span>(<span id="ast-119" class="ref_node">rec_xml&nbsp;&rarr;&nbsp;art_xml&nbsp;</span>,&nbsp;<span id="ast-120">(<span id="ast-121">'{%s}user-rating'</span>&nbsp;%&nbsp;<span id="ast-123">NS</span>)</span>)</span></span><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-125"><span id="ast-126">isinstance</span>(<span id="ast-127" class="other_trans">rating</span>,&nbsp;<span id="ast-128">int</span>)</span>:<span id="ast-129"><span id="ast-130" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rating</span>&nbsp;=&nbsp;<span id="ast-131">(<span id="ast-132">'%d'</span>&nbsp;%&nbsp;<span id="ast-134" class="other_trans">rating</span>)</span></span></span><span id="ast-135"><span id="ast-136"><span id="ast-137" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rating_xml</span>.text</span>&nbsp;=&nbsp;<span id="ast-138" class="other_trans">rating</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">value</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7"><span id="ast-8">self</span>.previous_value</span><span id="ast-9" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-10" class="other_trans">None</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-12">(<span id="ast-13">(<span id="ast-14" class="other_trans">value</span>&nbsp;+&nbsp;<span id="ast-16"><span id="ast-17">self</span>.correction</span>)</span><span id="ast-18" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-19"><span id="ast-20">self</span>.previous_value</span>)</span>:<span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.correction</span>&nbsp;+=&nbsp;<span id="ast-25"><span id="ast-26">self</span>.modulo</span></span></span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.previous_value</span>&nbsp;=&nbsp;<span id="ast-30">(<span id="ast-31" class="other_trans">value</span>&nbsp;+&nbsp;<span id="ast-33"><span id="ast-34">self</span>.correction</span>)</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-36"><span id="ast-37">self</span>.previous_value</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">path</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>WorkingCopy</span>.__init__</span>(<span id="ast-10">self</span>,&nbsp;<span id="ast-11" class="other_trans">path</span>)</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.path</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">os</span>.path</span>.realpath</span>(<span id="ast-19" class="ref_node">path&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-20"><span id="ast-21" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>client&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">pysvn</span>.Client</span>()</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">client</span>.info</span>(<span id="ast-32"><span id="ast-33">self</span>.path</span>)</span>.url</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">pysvn</span>.ClientError</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_create_volume_with_capacity(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">cb</span>,&nbsp;<span id="ast-5" class="other_trans">params</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pool_name</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">params</span>.pop</span>(<span id="ast-11">'pool'</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>vol_xml</span>&nbsp;=&nbsp;<span id="ast-14">"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&lt;volume&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;%(name)s&lt;/name&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;allocation&nbsp;unit='bytes'&gt;%(allocation)s&lt;/allocation&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;capacity&nbsp;unit='bytes'&gt;%(capacity)s&lt;/capacity&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;source&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/source&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;target&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;format&nbsp;type='%(format)s'/&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/target&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&lt;/volume&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>.setdefault</span>(<span id="ast-19">'allocation'</span>,&nbsp;<span id="ast-20">0</span>)</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>.setdefault</span>(<span id="ast-25">'format'</span>,&nbsp;<span id="ast-26">'qcow2'</span>)</span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">params</span>[<span id="ast-31"><span id="ast-32">'name'</span></span>]</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pool</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">StoragePoolModel</span>.get_storagepool</span>(<span id="ast-39" class="other_trans">pool_name</span>,&nbsp;<span id="ast-40"><span id="ast-41">self</span>.conn</span>)</span></span><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>xml</span>&nbsp;=&nbsp;<span id="ast-44">(<span id="ast-45" class="other_trans">vol_xml</span>&nbsp;%&nbsp;<span id="ast-47" class="other_trans">params</span>)</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-49" class="other_trans">KeyError</span>&nbsp;as&nbsp;<span id="ast-50" class="other_trans">item</span>:<span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">MissingParameter</span>(<span id="ast-54">'KCHVOL0004E'</span>,&nbsp;<span id="ast-55">{<span id="ast-56">'item'</span>:&nbsp;<span id="ast-58"><span id="ast-59" class="other_trans">str</span>(<span id="ast-60" class="other_trans">item</span>)</span>,&nbsp;<span id="ast-57">'volume'</span>:&nbsp;<span id="ast-61" class="other_trans">name</span>}</span>)</span></span></span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pool</span>.createXML</span>(<span id="ast-67" class="other_trans">xml</span>,&nbsp;<span id="ast-68">0</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-70"><span id="ast-71">libvirt</span>.libvirtError</span>&nbsp;as&nbsp;<span id="ast-72" class="other_trans">e</span>:<span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-74"><span id="ast-75" class="other_trans">OperationFailed</span>(<span id="ast-76">'KCHVOL0007E'</span>,&nbsp;<span id="ast-77">{<span id="ast-78">'name'</span>:&nbsp;<span id="ast-81" class="other_trans">name</span>,&nbsp;<span id="ast-79">'pool'</span>:&nbsp;<span id="ast-82" class="location_node">pool&nbsp;&rarr;&nbsp;pool_name,&nbsp;pred:&nbsp;name&nbsp;</span>,&nbsp;<span id="ast-80">'err'</span>:&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">e</span>.get_error_message</span>()</span>}</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getLinks(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">id</span>,&nbsp;<span id="ast-5" class="other_trans">outwardOnly</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-9" class="other_trans">response</span>,&nbsp;<span id="ast-10" class="other_trans">content</span>)</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>._req</span>(<span id="ast-14">'GET'</span>,&nbsp;<span id="ast-15">(<span id="ast-16">(<span id="ast-17">'/issue/'</span>&nbsp;+&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">urllib</span>.quote</span>(<span id="ast-22" class="other_trans">id</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-24">'/link'</span>)</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>xml</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">minidom</span>.parseString</span>(<span id="ast-30" class="other_trans">content</span>)</span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>&nbsp;=&nbsp;<span id="ast-33">[]</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-35" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-36">[<span id="ast-37" class="other_trans">e</span><span id="ast-38">&nbsp;for&nbsp;<span id="ast-39" class="other_trans">e</span>&nbsp;in&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">xml</span>.documentElement</span>.childNodes</span>&nbsp;if&nbsp;<span id="ast-43">(<span id="ast-44"><span id="ast-45" class="other_trans">e</span>.nodeType</span><span id="ast-46" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-47"><span id="ast-48" class="other_trans">Node</span>.ELEMENT_NODE</span>)</span></span>]</span>:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>link</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53">youtrack</span>.Link</span>(<span id="ast-54" class="other_trans">c</span>,&nbsp;<span id="ast-55">self</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57">(<span id="ast-59">(<span id="ast-60"><span id="ast-61" class="other_trans">link</span>.source</span><span id="ast-62" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-63" class="other_trans">id</span>)</span>&nbsp;or&nbsp;<span id="ast-64">(<span id="ast-65">not</span>&nbsp;<span id="ast-66" class="other_trans">outwardOnly</span>)</span>)</span>:<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>.append</span>(<span id="ast-71" class="other_trans">link</span>)</span></span></span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-73" class="other_trans">res</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;describe_xml(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">E</span>.Input</span>(<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">OWS</span>.Identifier</span>(<span id="ast-12"><span id="ast-13">self</span>.identifier</span>)</span>,&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">OWS</span>.Title</span>(<span id="ast-17"><span id="ast-18">self</span>.title</span>)</span>)</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.attrib</span>[<span id="ast-23"><span id="ast-24">'minOccurs'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26">self</span>.min_occurs</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.attrib</span>[<span id="ast-31"><span id="ast-32">'maxOccurs'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34">self</span>.max_occurs</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36"><span id="ast-37">self</span>.abstract</span>:<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.append</span>(<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">OWS</span>.Abstract</span>(<span id="ast-45"><span id="ast-46">self</span>.abstract</span>)</span>)</span></span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48"><span id="ast-49">self</span>.metadata</span>:<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.append</span>(<span id="ast-54"><span id="ast-55"><span id="ast-56">OWS</span>.Metadata</span>(*<span id="ast-57"><span id="ast-58">self</span>.metadata</span>)</span>)</span></span></span><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_data_doc</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">E</span>.LiteralData</span>()</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-65"><span id="ast-66">self</span>.data_type</span>:<span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data_type</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71">OWS</span>.DataType</span>(<span id="ast-72"><span id="ast-73">self</span>.data_type</span>)</span></span><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data_type</span>.attrib</span>[<span id="ast-78"><span id="ast-79">(<span id="ast-80">'{%s}reference'</span>&nbsp;%&nbsp;<span id="ast-82"><span id="ast-83">NAMESPACES</span>[<span id="ast-84"><span id="ast-85">'ows'</span></span>]</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-86">(<span id="ast-87">XMLSCHEMA_2</span>&nbsp;+&nbsp;<span id="ast-89"><span id="ast-90">self</span>.data_type</span>)</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_data_doc</span>.append</span>(<span id="ast-95" class="other_trans">data_type</span>)</span></span></span><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-97"><span id="ast-98">self</span>.uom</span>:<span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>default_uom_element</span>&nbsp;=&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105">self</span>.uom</span>[<span id="ast-106"><span id="ast-107">0</span></span>]</span>.describe_xml</span>()</span></span><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>supported_uom_elements</span>&nbsp;=&nbsp;<span id="ast-110">[<span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans">u</span>.describe_xml</span>()</span><span id="ast-114">&nbsp;for&nbsp;<span id="ast-115" class="other_trans">u</span>&nbsp;in&nbsp;<span id="ast-116"><span id="ast-117">self</span>.uom</span></span>]</span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_data_doc</span>.append</span>(<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans">E</span>.UOMs</span>(<span id="ast-125"><span id="ast-126"><span id="ast-127" class="other_trans">E</span>.Default</span>(<span id="ast-128" class="other_trans">default_uom_element</span>)</span>,&nbsp;<span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans">E</span>.Supported</span>(*<span id="ast-132" class="other_trans">supported_uom_elements</span>)</span>)</span>)</span></span></span><span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.append</span>(<span id="ast-137" class="other_trans">literal_data_doc</span>)</span></span><span id="ast-138"><span id="ast-139"><span id="ast-140"><span id="ast-141" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc&nbsp;&rarr;&nbsp;literal_data_doc&nbsp;</span>.append</span>(<span id="ast-142"><span id="ast-143"><span id="ast-144">OWS</span>.AnyValue</span>()</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_func(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">conv</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pi</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">get_provider_info</span>(<span id="ast-9">conv</span>)</span></span><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>resp</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">conv</span>.client</span>.http_request</span>(<span id="ast-16"><span id="ast-17" class="other_trans">pi</span>[<span id="ast-18"><span id="ast-19">'jwks_uri'</span></span>]</span>,&nbsp;verify=<span id="ast-21">False</span>,&nbsp;allow_redirects=<span id="ast-23">True</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>err_status</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>._kwargs</span>[<span id="ast-30"><span id="ast-31">'err_status'</span></span>]</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-33">KeyError</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>err_status</span>&nbsp;=&nbsp;<span id="ast-36">WARNING</span></span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40" class="other_trans">resp</span>.status_code</span><span id="ast-41" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-42">200</span>)</span>:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jwks</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">json</span>.loads</span>(<span id="ast-48"><span id="ast-49" class="other_trans">resp</span>.text</span>)</span></span><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>txt</span>&nbsp;=&nbsp;<span id="ast-52">[]</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-55" class="other_trans">OK</span></span><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-58">{}</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-61" class="incorrect_node">key&nbsp;&rarr;&nbsp;_st&nbsp;</span>&nbsp;in&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">jwks</span>[<span id="ast-64"><span id="ast-65">'keys'</span></span>]</span>:<span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_txt</span>&nbsp;=&nbsp;<span id="ast-68">[]</span></span><span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_st</span>&nbsp;=&nbsp;<span id="ast-71" class="other_trans">OK</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75">key</span>[<span id="ast-76"><span id="ast-77">'kty'</span></span>]</span><span id="ast-78" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-79">'RSA'</span>)</span>:<span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-82">_st</span>,&nbsp;<span id="ast-83" class="other_trans">_txt</span>)</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86">self</span>._chk</span>(<span id="ast-87">key</span>,&nbsp;<span id="ast-88">[<span id="ast-89">'e'</span>,&nbsp;<span id="ast-90">'n'</span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-92">(<span id="ast-93"><span id="ast-94" class="other_trans">key</span>[<span id="ast-95"><span id="ast-96">'kty'</span></span>]</span><span id="ast-97" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-98">'EC'</span>)</span>:<span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-101" class="other_trans">_st</span>,&nbsp;<span id="ast-102">_txt</span>)</span>&nbsp;=&nbsp;<span id="ast-103"><span id="ast-104"><span id="ast-105">self</span>._chk</span>(<span id="ast-106" class="other_trans">key</span>,&nbsp;<span id="ast-107">[<span id="ast-108">'x'</span>,&nbsp;<span id="ast-109">'y'</span>]</span>)</span></span></span><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>txt</span>.extend</span>(<span id="ast-114" class="other_trans">_txt</span>)</span></span><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-116">(<span id="ast-117">s</span><span id="ast-118" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-120">_st</span><span id="ast-119" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-121">CRITICAL</span>)</span>:<span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-124" class="other_trans">_st</span></span></span></span><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-126">KeyError</span>:<span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._status</span>&nbsp;=&nbsp;<span id="ast-130" class="other_trans">err_status</span></span><span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._message</span>&nbsp;=&nbsp;<span id="ast-134">(<span id="ast-135">'Missing&nbsp;bare&nbsp;key&nbsp;info&nbsp;on&nbsp;%s&nbsp;key'</span>&nbsp;%&nbsp;<span id="ast-137"><span id="ast-138" class="other_trans">key</span>[<span id="ast-139"><span id="ast-140">'kty'</span></span>]</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-157"><span id="ast-158"><span id="ast-159"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._status</span>&nbsp;=&nbsp;<span id="ast-160" class="other_trans">err_status</span></span><span id="ast-161"><span id="ast-162"><span id="ast-163"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._message</span>&nbsp;=&nbsp;<span id="ast-164"><span id="ast-165"><span id="ast-166">'Could&nbsp;not&nbsp;load&nbsp;jwks&nbsp;from&nbsp;{}'</span>.format</span>(<span id="ast-167"><span id="ast-168">pi</span>[<span id="ast-169"><span id="ast-170">'jwks_uri'</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse_subscript(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">node</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>token</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.stream</span>.next</span>()</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14" class="other_trans">token</span>.type</span><span id="ast-15" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-16">'dot'</span>)</span>:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>attr_token</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.stream</span>.current</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24"><span id="ast-25" class="other_trans">attr_token</span>.type</span><span id="ast-26">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-27">(<span id="ast-28">'name'</span>,&nbsp;<span id="ast-29">'integer'</span>)</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">TemplateSyntaxError</span>(<span id="ast-33">'expected&nbsp;name&nbsp;or&nbsp;number'</span>,&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">attr_token</span>.lineno</span>,&nbsp;<span id="ast-36"><span id="ast-37">self</span>.filename</span>)</span></span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>arg</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42">nodes</span>.Const</span>(<span id="ast-43"><span id="ast-44" class="other_trans">attr_token</span>.value</span>,&nbsp;lineno=<span id="ast-46"><span id="ast-47" class="other_trans">attr_token</span>.lineno</span>)</span></span><span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stream</span>.next</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-54">(<span id="ast-55"><span id="ast-56" class="other_trans">token</span>.type</span><span id="ast-57" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-58">'lbracket'</span>)</span>:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-61">[]</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-63">(<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67">self</span>.stream</span>.current</span>.type</span><span id="ast-68" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-69">'rbracket'</span>)</span>:<span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-71" class="other_trans">args</span>:<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stream</span>.expect</span>(<span id="ast-77">'comma'</span>)</span></span></span><span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-82"><span id="ast-83"><span id="ast-84">self</span>.parse_subscribed</span>()</span>)</span></span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stream</span>.expect</span>(<span id="ast-90">'rbracket'</span>)</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-92">(<span id="ast-93"><span id="ast-94">len</span>(<span id="ast-95" class="other_trans">args</span>)</span><span id="ast-96" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-97">1</span>)</span>:<span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>arg</span>&nbsp;=&nbsp;<span id="ast-100"><span id="ast-101" class="other_trans">args</span>[<span id="ast-102"><span id="ast-103">0</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>arg</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107"><span id="ast-108" class="other_trans">nodes</span>.Tuple</span>(<span id="ast-109" class="other_trans">args</span>,&nbsp;<span id="ast-110" class="ref_node">lineno&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-111"><span id="ast-112">self</span>.filename</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-114"><span id="ast-115" class="other_trans">TemplateSyntaxError</span>(<span id="ast-116">'expected&nbsp;subscript&nbsp;expression'</span>,&nbsp;<span id="ast-117"><span id="ast-118">self</span>.lineno</span>,&nbsp;<span id="ast-119"><span id="ast-120">self</span>.filename</span>)</span></span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans">nodes</span>.Subscript</span>(<span id="ast-125" class="other_trans">node</span>,&nbsp;<span id="ast-126" class="other_trans">arg</span>,&nbsp;<span id="ast-127">'load'</span>,&nbsp;lineno=<span id="ast-129"><span id="ast-130" class="other_trans">token</span>.lineno</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_source_files(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">directory</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cached_dir</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>._get_cached_dir</span>(<span id="ast-10" class="other_trans">directory</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13">not</span>&nbsp;<span id="ast-14" class="other_trans">cached_dir</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>root_dir</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.cvs</span>._get_root</span>(<span id="ast-22" class="other_trans">directory</span>)</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._files_cache</span>[<span id="ast-27"><span id="ast-28" class="other_trans">root_dir</span></span>]</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32">self</span>.cvs</span>._get_tracked_files</span>(<span id="ast-33" class="correct_node">directory&nbsp;&rarr;&nbsp;root_dir&nbsp;</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-35" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-36" class="other_trans">e</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._files_cache</span>[<span id="ast-41"><span id="ast-42" class="other_trans">directory</span></span>]</span>&nbsp;=&nbsp;<span id="ast-43">[]</span></span></span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cached_dir</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48">self</span>._get_cached_dir</span>(<span id="ast-49" class="other_trans">directory</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;choose_next(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">scaffold</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>position</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">scaffold</span>._flow_position_instance</span>._position</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>idx</span>&nbsp;=&nbsp;<span id="ast-12">-1</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-14">(<span id="ast-15" class="other_trans">idx</span>,&nbsp;<span id="ast-16" class="other_trans">ffc</span>)</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18">enumerate</span>(<span id="ast-19"><span id="ast-20" class="other_trans">position</span>.flow_component_classes</span>)</span>:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24" class="other_trans">scaffold</span>.__class__</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26" class="other_trans">ffc</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">idx</span><span id="ast-31" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-32">-1</span>)</span>:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-34">ValueError</span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37">(<span id="ast-38" class="other_trans">idx</span>&nbsp;+&nbsp;<span id="ast-40">1</span>)</span><span id="ast-41" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-42"><span id="ast-43">len</span>(<span id="ast-44"><span id="ast-45" class="other_trans">position</span>.flow_component_classes</span>)</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-47" class="other_trans">ValueError</span></span></span><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>active_child</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">position</span>.flow_component_classes</span>[<span id="ast-53"><span id="ast-54">(<span id="ast-55" class="other_trans">idx</span>&nbsp;+&nbsp;<span id="ast-57">1</span>)</span></span>]</span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>action_set</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">scaffold</span>.action_set</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>child_idx</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">action_set</span>.index</span>(<span id="ast-67" class="other_trans">active_child</span>)</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-70">(<span id="ast-71" class="other_trans">child_idx</span>&nbsp;+&nbsp;<span id="ast-73">1</span>)</span><span id="ast-74" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-75"><span id="ast-76" class="other_trans">len</span>(<span id="ast-77" class="other_trans">action_set</span>)</span>)</span>:<span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-79" class="other_trans">COMPLETE</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;plot(<span id="ast-2"><span id="ast-3" class="other_trans">ix</span>,&nbsp;<span id="ast-5" class="other_trans">iloc</span>,&nbsp;<span id="ast-7" class="other_trans">columns</span>,&nbsp;<span id="ast-9">legend</span>,&nbsp;**kwargs</span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;wrapper&nbsp;around&nbsp;plotting.&nbsp;Matplotlib&nbsp;plot&nbsp;arguments&nbsp;can&nbsp;be&nbsp;passed&nbsp;in,&nbsp;plus:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ix:&nbsp;specify&nbsp;a&nbsp;time-based&nbsp;subsection&nbsp;of&nbsp;the&nbsp;curves&nbsp;to&nbsp;plot,&nbsp;ex:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.plot(ix=slice(0.,10.))&nbsp;will&nbsp;plot&nbsp;the&nbsp;time&nbsp;values&nbsp;between&nbsp;t=0.&nbsp;and&nbsp;t=10.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iloc:&nbsp;specify&nbsp;a&nbsp;location-based&nbsp;subsection&nbsp;of&nbsp;the&nbsp;curves&nbsp;to&nbsp;plot,&nbsp;ex:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.plot(iloc=slice(0,10))&nbsp;will&nbsp;plot&nbsp;the&nbsp;first&nbsp;10&nbsp;time&nbsp;points.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;columns:&nbsp;If&nbsp;not&nbsp;empty,&nbsp;plot&nbsp;a&nbsp;subset&nbsp;of&nbsp;columns&nbsp;from&nbsp;the&nbsp;cumulative_hazards_.&nbsp;Default&nbsp;all.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;legend:&nbsp;show&nbsp;legend&nbsp;in&nbsp;figure.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-14">(<span id="ast-16">(<span id="ast-17" class="other_trans">ix</span><span id="ast-18" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-19">None</span>)</span>&nbsp;or&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">iloc</span><span id="ast-22" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-23" class="other_trans">None</span>)</span>)</span>,&nbsp;<span id="ast-24">'Cannot&nbsp;set&nbsp;both&nbsp;ix&nbsp;and&nbsp;iloc&nbsp;in&nbsp;call&nbsp;to&nbsp;.plot'</span></span><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>get_method</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-32">'ix'</span>&nbsp;if&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">ix</span><span id="ast-30" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-31" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-33">'iloc'</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36" class="other_trans">iloc</span><span id="ast-37" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39" class="other_trans">ix</span><span id="ast-38" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-40">None</span>)</span>:<span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>user_submitted_ix</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44">slice</span>(<span id="ast-45">0</span>,&nbsp;<span id="ast-46">None</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>user_submitted_ix</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-54" class="other_trans">ix</span>&nbsp;if&nbsp;<span id="ast-50">(<span id="ast-51" class="other_trans">ix</span><span id="ast-52" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-53">None</span>)</span>&nbsp;else&nbsp;<span id="ast-55">iloc</span></span></span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>get_loc</span>&nbsp;=&nbsp;<span id="ast-58">lambda&nbsp;<span id="ast-59"><span id="ast-60">df</span></span>:&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">getattr</span>(<span id="ast-64" class="other_trans">df</span>,&nbsp;<span id="ast-65" class="other_trans">get_method</span>)</span>[<span id="ast-66"><span id="ast-67" class="other_trans">user_submitted_ix</span></span>]</span></span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-70"><span id="ast-71" class="other_trans">len</span>(<span id="ast-72" class="other_trans">columns</span>)</span><span id="ast-73" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-74">0</span>)</span>:<span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>columns</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79">self</span>.cumulative_hazards_</span>.columns</span></span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-81">(<span id="ast-82">'ax'</span><span id="ast-83">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-84">kwargs</span>)</span>:<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>[<span id="ast-88"><span id="ast-89">'ax'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94">plt</span>.figure</span>()</span>.add_subplot</span>(<span id="ast-95">111</span>)</span></span></span><span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>x</span>&nbsp;=&nbsp;<span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101"><span id="ast-102"><span id="ast-103" class="other_trans">get_loc</span>(<span id="ast-104"><span id="ast-105">self</span>.cumulative_hazards_</span>)</span>.index</span>.values</span>.astype</span>(<span id="ast-106">float</span>)</span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-108">column</span>&nbsp;in&nbsp;<span id="ast-109" class="other_trans">columns</span>:<span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>y</span>&nbsp;=&nbsp;<span id="ast-112"><span id="ast-113"><span id="ast-114" class="other_trans">get_loc</span>(<span id="ast-115"><span id="ast-116"><span id="ast-117">self</span>.cumulative_hazards_</span>[<span id="ast-118"><span id="ast-119" class="other_trans">column</span></span>]</span>)</span>.values</span></span><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>y_upper</span>&nbsp;=&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans">get_loc</span>(<span id="ast-125"><span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129">self</span>.confidence_intervals_</span>[<span id="ast-130"><span id="ast-131" class="other_trans">column</span></span>]</span>.ix</span>[<span id="ast-132"><span id="ast-133">'upper'</span></span>]</span>)</span>.values</span></span><span id="ast-134"><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>y_lower</span>&nbsp;=&nbsp;<span id="ast-136"><span id="ast-137"><span id="ast-138">get_loc</span>(<span id="ast-139"><span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143">self</span>.confidence_intervals_</span>[<span id="ast-144"><span id="ast-145">column</span></span>]</span>.ix</span>[<span id="ast-146"><span id="ast-147">'lower'</span></span>]</span>)</span>.values</span></span><span id="ast-148"><span id="ast-149"><span id="ast-150" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>shaded_plot</span>(<span id="ast-151">x</span>,&nbsp;<span id="ast-152" class="other_trans">y</span>,&nbsp;<span id="ast-153" class="other_trans">y_upper</span>,&nbsp;<span id="ast-154" class="other_trans">y_lower</span>,&nbsp;ax=<span id="ast-156"><span id="ast-157">kwargs</span>[<span id="ast-158"><span id="ast-159">'ax'</span></span>]</span>,&nbsp;label=<span id="ast-161"><span id="ast-162">coalesce</span>(<span id="ast-163"><span id="ast-164"><span id="ast-165">kwargs</span>.get</span>(<span id="ast-166">'label'</span>)</span>,&nbsp;<span id="ast-167" class="ref_node">columns&nbsp;&rarr;&nbsp;column&nbsp;</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;lint(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7">(<span id="ast-9"><span id="ast-10">self</span>.language</span>&nbsp;and&nbsp;<span id="ast-11"><span id="ast-12">self</span>.cmd</span>&nbsp;and&nbsp;<span id="ast-13"><span id="ast-14">self</span>.regex</span>)</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-16" class="other_trans">NotImplementedError</span></span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.run</span>(<span id="ast-22"><span id="ast-23">self</span>.cmd</span>,&nbsp;<span id="ast-24"><span id="ast-25">self</span>.code</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28">not</span>&nbsp;<span id="ast-29" class="other_trans">output</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>persist</span>.debug</span>(<span id="ast-35">'Output:'</span>,&nbsp;<span id="ast-36"><span id="ast-37">repr</span>(<span id="ast-38" class="other_trans">output</span>)</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">match</span>,&nbsp;<span id="ast-42" class="other_trans">row</span>,&nbsp;<span id="ast-43" class="other_trans">col</span>,&nbsp;<span id="ast-44">message</span>,&nbsp;<span id="ast-45">near</span>)</span>&nbsp;in&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48">self</span>.find_errors</span>(<span id="ast-49" class="other_trans">output</span>)</span>:<span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-53" class="other_trans">match</span>&nbsp;and&nbsp;<span id="ast-54">(<span id="ast-55" class="other_trans">row</span><span id="ast-56" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-57" class="other_trans">None</span>)</span>)</span>:<span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59">(<span id="ast-60" class="other_trans">col</span><span id="ast-61" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-62">None</span>)</span>:<span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65"><span id="ast-66">self</span>.tab_size</span><span id="ast-67" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-68">1</span>)</span>:<span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-71" class="other_trans">start</span>,&nbsp;<span id="ast-72" class="other_trans">end</span>)</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76">self</span>.highlight</span>.full_line</span>(<span id="ast-77" class="other_trans">row</span>)</span></span><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>code_line</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81" class="correct_node">code&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-82"><span id="ast-83" class="other_trans">start</span>:<span id="ast-84" class="other_trans">end</span></span>]</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;=&nbsp;<span id="ast-87">0</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-89" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-90"><span id="ast-91">range</span>(<span id="ast-92"><span id="ast-93" class="other_trans">len</span>(<span id="ast-94" class="other_trans">code_line</span>)</span>)</span>:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96">(<span id="ast-97"><span id="ast-98" class="other_trans">code_line</span>[<span id="ast-99"><span id="ast-100" class="other_trans">i</span></span>]</span><span id="ast-101" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-102">'\\u0009'</span>)</span>:<span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;+=&nbsp;<span id="ast-106">(<span id="ast-107"><span id="ast-108">self</span>.tab_size</span>&nbsp;-&nbsp;<span id="ast-110">1</span>)</span></span></span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;compute_float_num_unmasked(<span id="ast-2"><span id="ast-3" class="other_trans">data</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>M</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">data</span>.masks</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>O</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">data</span>.offsets</span>[<span id="ast-13">:<span id="ast-14">-1</span></span>]</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>n</span>&nbsp;=&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19" class="other_trans">bisect_left</span>(<span id="ast-20" class="other_trans">O</span>,&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">len</span>(<span id="ast-23" class="other_trans">M</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-25">1</span>)</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>O2</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">O</span>[<span id="ast-30">:<span id="ast-31" class="other_trans">n</span></span>]</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>U</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">hstack</span>(<span id="ast-36">(<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">add</span>.reduceat</span>(<span id="ast-40" class="other_trans">M</span>,&nbsp;<span id="ast-41" class="other_trans">O2</span>)</span>,&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">zeros</span>(<span id="ast-44">(<span id="ast-45"><span id="ast-46" class="other_trans">len</span>(<span id="ast-47" class="correct_node">M&nbsp;&rarr;&nbsp;O&nbsp;</span>)</span>&nbsp;-&nbsp;<span id="ast-49" class="other_trans">n</span>)</span>)</span>)</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51" class="other_trans">U</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;register_listener(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">events</span>,&nbsp;<span id="ast-5" class="other_trans">listener</span>,&nbsp;<span id="ast-6" class="other_trans">filterfunc</span></span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Allows&nbsp;you&nbsp;to&nbsp;specify&nbsp;event&nbsp;listeners&nbsp;for&nbsp;adding&nbsp;new&nbsp;features&nbsp;to&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:class:`Replay`&nbsp;objects&nbsp;on&nbsp;:meth:`~Replay.play`.&nbsp;sc2reader&nbsp;comes&nbsp;with&nbsp;a\\u000a&nbsp;&nbsp;&nbsp;&nbsp;small&nbsp;collection&nbsp;of&nbsp;:class:`Listener`&nbsp;classes&nbsp;that&nbsp;you&nbsp;can&nbsp;apply&nbsp;to&nbsp;your\\u000a&nbsp;&nbsp;&nbsp;&nbsp;replays&nbsp;as&nbsp;needed.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Events&nbsp;are&nbsp;sent&nbsp;to&nbsp;listeners&nbsp;in&nbsp;registration&nbsp;order&nbsp;as&nbsp;they&nbsp;come&nbsp;up.&nbsp;By\\u000a&nbsp;&nbsp;&nbsp;&nbsp;specifying&nbsp;a&nbsp;parent&nbsp;class&nbsp;you&nbsp;can&nbsp;register&nbsp;a&nbsp;listener&nbsp;to&nbsp;a&nbsp;set&nbsp;of&nbsp;events\\u000a&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;once&nbsp;instead&nbsp;of&nbsp;listing&nbsp;them&nbsp;out&nbsp;individually.&nbsp;See&nbsp;the&nbsp;tutorials&nbsp;for\\u000a&nbsp;&nbsp;&nbsp;&nbsp;more&nbsp;information.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;events:&nbsp;A&nbsp;list&nbsp;of&nbsp;event&nbsp;classes&nbsp;you&nbsp;want&nbsp;sent&nbsp;to&nbsp;this&nbsp;listener.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Registration&nbsp;to&nbsp;a&nbsp;single&nbsp;event&nbsp;can&nbsp;be&nbsp;done&nbsp;by&nbsp;specifying&nbsp;a&nbsp;single\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event&nbsp;class&nbsp;instead&nbsp;of&nbsp;a&nbsp;list.&nbsp;An&nbsp;isinstance()&nbsp;check&nbsp;is&nbsp;used&nbsp;so\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;you&nbsp;can&nbsp;catch&nbsp;sets&nbsp;of&nbsp;classes&nbsp;at&nbsp;once&nbsp;by&nbsp;supplying&nbsp;a&nbsp;parent&nbsp;class.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;listener:&nbsp;The&nbsp;:class:`Listener`&nbsp;object&nbsp;you&nbsp;want&nbsp;events&nbsp;sent&nbsp;to.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;filterfunc:&nbsp;A&nbsp;function&nbsp;that&nbsp;accepts&nbsp;a&nbsp;partially&nbsp;loaded\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:class:`Replay`&nbsp;object&nbsp;as&nbsp;an&nbsp;argument&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reader&nbsp;should&nbsp;be&nbsp;used&nbsp;on&nbsp;this&nbsp;replay.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-15" class="other_trans">event</span>&nbsp;in&nbsp;<span id="ast-16" class="other_trans">events</span>:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.registered_listeners</span>[<span id="ast-23"><span id="ast-24" class="other_trans">event</span></span>]</span>.append</span>(<span id="ast-25">(<span id="ast-26" class="other_trans">filterfunc</span>,&nbsp;<span id="ast-27" class="other_trans">listener</span>)</span>)</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-29" class="other_trans">TypeError</span>:<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.registered_listeners</span>[<span id="ast-36"><span id="ast-37" class="ref_node">event&nbsp;&rarr;&nbsp;events&nbsp;</span></span>]</span>.append</span>(<span id="ast-38">(<span id="ast-39" class="incorrect_node">filterfunc&nbsp;&rarr;&nbsp;events&nbsp;</span>,&nbsp;<span id="ast-40" class="other_trans">listener</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;purge_kernels(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">msg_content</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Handler&nbsp;for&nbsp;purge_kernels&nbsp;messages.'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>failures</span>&nbsp;=&nbsp;<span id="ast-9">[]</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-11" class="other_trans">kernel_id</span>&nbsp;in&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.km</span>._kernels</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>success</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.km</span>.kill_kernel</span>(<span id="ast-21" class="other_trans">kernel_id</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24">not</span>&nbsp;<span id="ast-25" class="other_trans">success</span>)</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>failures</span>.append</span>(<span id="ast-30" class="other_trans">kernel_id</span>)</span></span></span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>reply_content</span>&nbsp;=&nbsp;<span id="ast-33">{<span id="ast-34">'status'</span>:&nbsp;<span id="ast-35">'All&nbsp;kernels&nbsp;killed!'</span>}</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>success</span>&nbsp;=&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40" class="other_trans">len</span>(<span id="ast-41" class="other_trans">failures</span>)</span><span id="ast-42" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-43">0</span>)</span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46">not</span>&nbsp;<span id="ast-47" class="other_trans">success</span>)</span>:<span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply_content</span>[<span id="ast-51"><span id="ast-52">'status'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-53">(<span id="ast-54">'Could&nbsp;not&nbsp;kill&nbsp;kernels&nbsp;%s!'</span>&nbsp;%&nbsp;<span id="ast-56" class="incorrect_node">failures&nbsp;&rarr;&nbsp;success&nbsp;</span>)</span></span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>._form_message</span>(<span id="ast-61" class="other_trans">reply_content</span>,&nbsp;error=<span id="ast-63">(<span id="ast-64">not</span>&nbsp;<span id="ast-65" class="other_trans">success</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;transform_f(<span id="ast-2"><span id="ast-3" class="other_trans">data</span>,&nbsp;<span id="ast-4" class="other_trans">id_</span>,&nbsp;<span id="ast-5" class="other_trans">metadata</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">np</span>.where</span>(<span id="ast-10">(<span id="ast-11" class="other_trans">data</span><span id="ast-12" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;!=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-13">0</span>)</span>,&nbsp;<span id="ast-14">1.0</span>,&nbsp;<span id="ast-15">0.0</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;on_msg_receive(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">msg</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-8"><span id="ast-9" class="other_trans">msg</span>.out</span>&nbsp;or&nbsp;<span id="ast-10">(<span id="ast-11">not</span>&nbsp;<span id="ast-12"><span id="ast-13">self</span>.binlog_done</span>)</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>peer</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="correct_node">get_peer_to_send&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-19" class="other_trans">msg</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;bootdevice(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">'read'</span><span id="ast-7" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-8"><span id="ast-9">self</span>.op</span>)</span>:<span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootdev</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.ipmicmd</span>.get_bootdev</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19" class="other_trans">bootdev</span>[<span id="ast-20"><span id="ast-21">'bootdev'</span></span>]</span><span id="ast-22">&nbsp;in&nbsp;</span><span id="ast-23"><span id="ast-24">self</span>.bootdevices</span>)</span>:<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootdev</span>[<span id="ast-28"><span id="ast-29">'bootdev'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32">self</span>.bootdevices</span>[<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">bootdev</span>[<span id="ast-36"><span id="ast-37">'bootdev'</span></span>]</span></span>]</span></span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootmode</span>&nbsp;=&nbsp;<span id="ast-40">'unspecified'</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43">'uefimode'</span><span id="ast-44">&nbsp;in&nbsp;</span><span id="ast-45" class="other_trans">bootdev</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47"><span id="ast-48" class="correct_node">bootmode&nbsp;&rarr;&nbsp;bootdev&nbsp;</span>[<span id="ast-49"><span id="ast-50">'uefimode'</span></span>]</span>:<span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootmode</span>&nbsp;=&nbsp;<span id="ast-53">'uefi'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootmode</span>&nbsp;=&nbsp;<span id="ast-56">'bios'</span></span></span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">msg</span>.BootDevice</span>(node=<span id="ast-62"><span id="ast-63">self</span>.node</span>,&nbsp;device=<span id="ast-65"><span id="ast-66" class="other_trans">bootdev</span>[<span id="ast-67"><span id="ast-68">'bootdev'</span></span>]</span>,&nbsp;bootmode=<span id="ast-70" class="other_trans">bootmode</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-72">(<span id="ast-73">'update'</span><span id="ast-74" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-75"><span id="ast-76">self</span>.op</span>)</span>:<span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootdev</span>&nbsp;=&nbsp;<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82">self</span>.inputdata</span>.bootdevice</span>(<span id="ast-83"><span id="ast-84">self</span>.node</span>)</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootmode</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90">self</span>.inputdata</span>.bootmode</span>(<span id="ast-91"><span id="ast-92">self</span>.node</span>)</span></span><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootdev</span>&nbsp;=&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98">self</span>.ipmicmd</span>.set_bootdev</span>(<span id="ast-99" class="other_trans">bootdev</span>)</span></span><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-101">(<span id="ast-102"><span id="ast-103" class="other_trans">bootdev</span>[<span id="ast-104"><span id="ast-105">'bootdev'</span></span>]</span><span id="ast-106">&nbsp;in&nbsp;</span><span id="ast-107"><span id="ast-108">self</span>.bootdevices</span>)</span>:<span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bootdev</span>[<span id="ast-112"><span id="ast-113">'bootdev'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-114"><span id="ast-115"><span id="ast-116">self</span>.bootdevices</span>[<span id="ast-117"><span id="ast-118"><span id="ast-119" class="other_trans">bootdev</span>[<span id="ast-120"><span id="ast-121">'bootdev'</span></span>]</span></span>]</span></span></span><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125" class="other_trans">msg</span>.BootDevice</span>(node=<span id="ast-127"><span id="ast-128">self</span>.node</span>,&nbsp;device=<span id="ast-130"><span id="ast-131" class="other_trans">bootdev</span>[<span id="ast-132"><span id="ast-133">'bootdev'</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_buildMetadata(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;set&nbsp;up&nbsp;capabilities&nbsp;metadata&nbsp;objects&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>serviceelem</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>._capabilities</span>.find</span>(<span id="ast-12">'Service'</span>)</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.identification</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17">ServiceIdentification</span>(<span id="ast-18" class="other_trans">serviceelem</span>,&nbsp;<span id="ast-19"><span id="ast-20">self</span>.version</span>)</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.provider</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25">ServiceProvider</span>(<span id="ast-26">serviceelem</span>)</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.operations</span>&nbsp;=&nbsp;<span id="ast-30">[]</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32" class="other_trans">elem</span>&nbsp;in&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">self</span>._capabilities</span>.find</span>(<span id="ast-38">'Capability/Request'</span>)</span>[<span id="ast-39">:</span>]</span>:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.operations</span>.append</span>(<span id="ast-45"><span id="ast-46" class="other_trans">OperationMetadata</span>(<span id="ast-47" class="other_trans">elem</span>)</span>)</span></span></span><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contents</span>&nbsp;=&nbsp;<span id="ast-51">{}</span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>caps</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57">self</span>._capabilities</span>.find</span>(<span id="ast-58">'Capability'</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-60" class="other_trans">elem</span>&nbsp;in&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">caps</span>.findall</span>(<span id="ast-64">'Layer'</span>)</span>:<span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cm</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">ContentMetadata</span>(<span id="ast-69" class="other_trans">elem</span>)</span></span><span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contents</span>[<span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">cm</span>.id</span></span>]</span>&nbsp;=&nbsp;<span id="ast-77" class="other_trans">cm</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-79" class="other_trans">subelem</span>&nbsp;in&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">elem</span>.findall</span>(<span id="ast-83">'Layer'</span>)</span>:<span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subcm</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-87" class="other_trans">ContentMetadata</span>(<span id="ast-88" class="other_trans">subelem</span>,&nbsp;<span id="ast-89" class="other_trans">cm</span>)</span></span><span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contents</span>[<span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans">subcm</span>.id</span></span>]</span>&nbsp;=&nbsp;<span id="ast-97" class="other_trans">subcm</span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-99" class="other_trans">subsubelem</span>&nbsp;in&nbsp;<span id="ast-100"><span id="ast-101"><span id="ast-102" class="incorrect_node">subelem&nbsp;&rarr;&nbsp;subcm&nbsp;</span>.findall</span>(<span id="ast-103">'Layer'</span>)</span>:<span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subsubcm</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107">ContentMetadata</span>(<span id="ast-108" class="other_trans">subsubelem</span>,&nbsp;<span id="ast-109" class="ref_node">cm&nbsp;&rarr;&nbsp;subcm&nbsp;</span>)</span></span><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contents</span>[<span id="ast-114"><span id="ast-115"><span id="ast-116">subsubcm</span>.id</span></span>]</span>&nbsp;=&nbsp;<span id="ast-117" class="other_trans">subsubcm</span></span></span></span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.exceptions</span>&nbsp;=&nbsp;<span id="ast-121">[<span id="ast-122"><span id="ast-123" class="other_trans">f</span>.text</span><span id="ast-124">&nbsp;for&nbsp;<span id="ast-125" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129">self</span>._capabilities</span>.findall</span>(<span id="ast-130">'Capability/Exception/Format'</span>)</span></span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process_request(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">request</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7">not</span>&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">settings</span>.ST_PRIVATE_FORUM</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">request</span>.user</span>.is_authenticated</span>()</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>resolver_match</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">resolve</span>(<span id="ast-21"><span id="ast-22" class="other_trans">request</span>.path</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">resolver_match</span>.app_name</span><span id="ast-27" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-28">'spirit'</span>)</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>full_namespace</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34">':'</span>.join</span>(<span id="ast-35"><span id="ast-36" class="other_trans">resolver_match</span>.namespaces</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">full_namespace</span><span id="ast-40" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-41">'spirit:user:auth'</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;recv(<span id="ast-2"><span id="ast-3" class="other_trans">skt</span>,&nbsp;<span id="ast-4" class="other_trans">length</span>,&nbsp;<span id="ast-5" class="other_trans">buf</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9" class="other_trans">buf</span><span id="ast-10" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15" class="other_trans">len</span>(<span id="ast-16" class="other_trans">buf</span>)</span><span id="ast-17" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-18" class="other_trans">length</span>)</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-20" class="other_trans">buf</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>length</span>&nbsp;=&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">length</span>&nbsp;-&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">len</span>(<span id="ast-28" class="other_trans">buf</span>)</span>)</span></span></span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tmp_buf</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">ctypes</span>.create_string_buffer</span>(<span id="ast-34" class="other_trans">length</span>)</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>l</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">skt</span>.recv_into</span>(<span id="ast-40" class="other_trans">tmp_buf</span>,&nbsp;<span id="ast-41" class="other_trans">length</span>)</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-44">not</span>&nbsp;<span id="ast-45" class="other_trans">buf</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">tmp_buf</span>[<span id="ast-49">:<span id="ast-50" class="other_trans">l</span></span>]</span></span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-52">(<span id="ast-53" class="other_trans">buf</span>&nbsp;+&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">tmp_buf</span>[<span id="ast-57">:<span id="ast-58">l</span></span>]</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;write_file(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">respiter</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-8"><span id="ast-9" class="correct_node">can_sendfile&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span>&nbsp;and&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">util</span>.is_fileobject</span>(<span id="ast-13"><span id="ast-14" class="other_trans">respiter</span>.filelike</span>)</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">six</span>.callable</span>(<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">respiter</span>.filelike</span>.fileno</span>)</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fileno</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">respiter</span>.filelike</span>.fileno</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fileno</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">respiter</span>.filelike</span>.fileno</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;extend(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">df</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7">not</span>&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">df</span>.index</span>.is_monotonic_increasing</span>)</span>:<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>df</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">df</span>.sort_index</span>(inplace=<span id="ast-17">False</span>)</span></span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-21"><span id="ast-22" class="other_trans">len</span>(<span id="ast-23"><span id="ast-24">self</span>.partitions</span>)</span>&nbsp;and&nbsp;<span id="ast-25">(<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">df</span>.index</span>[<span id="ast-29"><span id="ast-30">0</span></span>]</span><span id="ast-31" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>.partitions</span>.index</span>[<span id="ast-36"><span id="ast-37">0</span></span>]</span>)</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">is_trivial_index</span>(<span id="ast-41"><span id="ast-42" class="other_trans">df</span>.index</span>)</span>:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>df</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">df</span>.copy</span>()</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start</span>&nbsp;=&nbsp;<span id="ast-50">(<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54">self</span>.partitions</span>.index</span>[<span id="ast-55"><span id="ast-56">-1</span></span>]</span>&nbsp;+&nbsp;<span id="ast-58">1</span>)</span></span><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_index</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63">pd</span>.Index</span>(<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">np</span>.arange</span>(<span id="ast-67" class="other_trans">start</span>,&nbsp;<span id="ast-68">(<span id="ast-69" class="other_trans">start</span>&nbsp;+&nbsp;<span id="ast-71"><span id="ast-72" class="other_trans">len</span>(<span id="ast-73" class="other_trans">df</span>)</span>)</span>)</span>,&nbsp;name=<span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">df</span>.index</span>.name</span>)</span></span><span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>df</span>.index</span>&nbsp;=&nbsp;<span id="ast-81" class="other_trans">new_index</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-83"><span id="ast-84" class="other_trans">ValueError</span>(<span id="ast-85">'Index&nbsp;of&nbsp;new&nbsp;dataframe&nbsp;less&nbsp;than&nbsp;known&nbsp;data'</span>)</span></span></span></span><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans">df</span>.index</span>.values</span></span><span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>partition_name</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95">'--'</span>.join</span>(<span id="ast-96">[<span id="ast-97"><span id="ast-98" class="other_trans">escape</span>(<span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans">index</span>.min</span>()</span>)</span>,&nbsp;<span id="ast-102"><span id="ast-103" class="other_trans">escape</span>(<span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans">index</span>.max</span>()</span>)</span>]</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;find_in_where(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">machineList</span>,&nbsp;<span id="ast-5" class="other_trans">criteria</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>matches</span>&nbsp;=&nbsp;<span id="ast-8">[]</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-10" class="other_trans">machine</span>&nbsp;in&nbsp;<span id="ast-11" class="other_trans">machineList</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13"><span id="ast-14" class="correct_node">match_criteria&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-15" class="other_trans">machine</span>,&nbsp;<span id="ast-16" class="other_trans">criteria</span>)</span>:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>matches</span>.append</span>(<span id="ast-21" class="other_trans">machine</span>)</span></span></span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-23" class="other_trans">matches</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;server_update(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>diff_time</span>&nbsp;=&nbsp;<span id="ast-6">(<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-11"><span id="ast-12">self</span>.lastcalled</span>)</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lastcalled</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">time</span>.time</span>()</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_server</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.bh</span>.pool</span>.get_current</span>()</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32">self</span>.bh</span>.pool</span>.get_entry</span>(<span id="ast-33" class="other_trans">current_server</span>)</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>[<span id="ast-37"><span id="ast-38">'slice'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41" class="other_trans">info</span>[<span id="ast-42"><span id="ast-43">'slice'</span></span>]</span>&nbsp;-&nbsp;<span id="ast-45" class="other_trans">diff_time</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48"><span id="ast-49">self</span>.initDone</span><span id="ast-50" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-51">False</span>)</span>:<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.bh</span>.select_best_server</span>()</span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-58">True</span></span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-61"><span id="ast-62" class="other_trans">info</span>[<span id="ast-63"><span id="ast-64">'slice'</span></span>]</span><span id="ast-65" class="incorrect_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-66">0</span>)</span>:<span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-68">True</span></span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70">(<span id="ast-71"><span id="ast-72" class="other_trans">info</span>[<span id="ast-73"><span id="ast-74">'slicedShares'</span></span>]</span><span id="ast-75" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-76"><span id="ast-77" class="other_trans">info</span>[<span id="ast-78"><span id="ast-79">'shares'</span></span>]</span>)</span>:<span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-81">True</span></span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-83">(<span id="ast-84"><span id="ast-85" class="other_trans">info</span>[<span id="ast-86"><span id="ast-87">'role'</span></span>]</span><span id="ast-88">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-89">[<span id="ast-90">'mine'</span>,&nbsp;<span id="ast-91">'mine_nmc'</span>,&nbsp;<span id="ast-92">'mine_slush'</span>]</span>)</span>:<span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-94">True</span></span></span><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>difficulty</span>&nbsp;=&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101">self</span>.bh</span>.difficulty</span>.get_difficulty</span>()</span></span><span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>shares</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105" class="other_trans">info</span>[<span id="ast-106"><span id="ast-107">'shares'</span></span>]</span></span><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>min_shares</span>&nbsp;=&nbsp;<span id="ast-110">(<span id="ast-111" class="other_trans">difficulty</span>&nbsp;*&nbsp;<span id="ast-113"><span id="ast-114">self</span>.difficultyThreshold</span>)</span></span><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-116">(<span id="ast-117"><span id="ast-118" class="other_trans">info</span>[<span id="ast-119"><span id="ast-120">'role'</span></span>]</span><span id="ast-121" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-122">'mine_slush'</span>)</span>:<span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>shares</span>&nbsp;=&nbsp;<span id="ast-125">(<span id="ast-126" class="other_trans">shares</span>&nbsp;*&nbsp;<span id="ast-128">4</span>)</span></span></span><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-130">(<span id="ast-131">'penalty'</span><span id="ast-132">&nbsp;in&nbsp;</span><span id="ast-133" class="other_trans">info</span>)</span>:<span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>shares</span>&nbsp;=&nbsp;<span id="ast-136">(<span id="ast-137" class="other_trans">shares</span>&nbsp;*&nbsp;<span id="ast-139"><span id="ast-140" class="other_trans">float</span>(<span id="ast-141"><span id="ast-142" class="other_trans">info</span>[<span id="ast-143"><span id="ast-144">'penalty'</span></span>]</span>)</span>)</span></span></span><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-146">(<span id="ast-147" class="other_trans">shares</span><span id="ast-148" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-149">min_shares</span>)</span>:<span id="ast-150"><span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>[<span id="ast-153"><span id="ast-154">'slice'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-155">-1</span></span><span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-157">True</span></span></span><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-159">False</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse_cmd(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">tree</span>,&nbsp;<span id="ast-5" class="other_trans">inp_cmd</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Extract&nbsp;command&nbsp;and&nbsp;options&nbsp;from&nbsp;string.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;tree&nbsp;argument&nbsp;should&nbsp;contain&nbsp;a&nbsp;specifically&nbsp;formatted&nbsp;dict\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;describes&nbsp;the&nbsp;available&nbsp;commands,&nbsp;options,&nbsp;arguments&nbsp;and\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;callbacks&nbsp;to&nbsp;methods&nbsp;for&nbsp;completion&nbsp;of&nbsp;arguments.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TODO:&nbsp;document&nbsp;dict&nbsp;format\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;inp_cmd&nbsp;argument&nbsp;should&nbsp;contain&nbsp;a&nbsp;list&nbsp;of&nbsp;strings&nbsp;containing\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;complete&nbsp;command&nbsp;to&nbsp;parse,&nbsp;such&nbsp;as&nbsp;sys.argv&nbsp;(without&nbsp;the&nbsp;first\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;element&nbsp;which&nbsp;specified&nbsp;the&nbsp;command&nbsp;itself).\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.exe</span>&nbsp;=&nbsp;<span id="ast-11" class="other_trans">None</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.arg</span>&nbsp;=&nbsp;<span id="ast-15" class="other_trans">None</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.exe_options</span>&nbsp;=&nbsp;<span id="ast-19">{}</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.params</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">tree</span>[<span id="ast-25"><span id="ast-26">'params'</span></span>]</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.key</span>&nbsp;=&nbsp;<span id="ast-30">{}</span></span><span id="ast-31"><span id="ast-32" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>option_parsing&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-33">False</span></span><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-36">0</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">i</span><span id="ast-40" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-41"><span id="ast-42" class="other_trans">len</span>(<span id="ast-43" class="other_trans">inp_cmd</span>)</span>)</span>:<span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">inp_cmd</span>[<span id="ast-48"><span id="ast-49" class="other_trans">i</span></span>]</span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.key</span>&nbsp;=&nbsp;<span id="ast-53">{}</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57">self</span>.params</span><span id="ast-58" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-59" class="other_trans">None</span>)</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.key_complete</span>&nbsp;=&nbsp;<span id="ast-63">False</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-65">(<span id="ast-66" class="other_trans">param</span>,&nbsp;<span id="ast-67" class="other_trans">content</span>)</span>&nbsp;in&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71">self</span>.params</span>.items</span>()</span>:<span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">string</span>.find</span>(<span id="ast-77" class="other_trans">param</span>,&nbsp;<span id="ast-78" class="other_trans">p</span>)</span><span id="ast-79" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-80">0</span>)</span>:<span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.key</span>[<span id="ast-85"><span id="ast-86" class="other_trans">param</span></span>]</span>&nbsp;=&nbsp;<span id="ast-87" class="other_trans">content</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;send(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">data</span>,&nbsp;<span id="ast-5" class="other_trans">flags</span>,&nbsp;<span id="ast-7" class="other_trans">timeout</span></span>):<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">ll</span>.get_log_level</span>()</span><span id="ast-14" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">ll</span>.LOG_LEVELS</span>[<span id="ast-18"><span id="ast-19">'DEBUG2'</span></span>]</span>)</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">hasattr</span>(<span id="ast-23" class="other_trans">data</span>,&nbsp;<span id="ast-24">'tobytes'</span>)</span>:<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ml</span>.ld2</span>(<span id="ast-29">'SSL:&nbsp;{{{0}}}/FD&nbsp;{1}:&nbsp;OUTDATA:&nbsp;{{{2}}}'</span>,&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">id</span>(<span id="ast-32">self</span>)</span>,&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36">self</span>._sock</span>.fileno</span>()</span>,&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">data</span>.tobytes</span>()</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ml</span>.ld2</span>(<span id="ast-44">'SSL:&nbsp;{{{0}}}/FD&nbsp;{1}:&nbsp;OUTDATA:&nbsp;{{{2}}}'</span>,&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">id</span>(<span id="ast-47">self</span>)</span>,&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>._sock</span>.fileno</span>()</span>,&nbsp;<span id="ast-52" class="other_trans">data</span>)</span></span></span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">self</span>._do_ssl</span>(<span id="ast-57">lambda&nbsp;<span id="ast-58"></span>:&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62">self</span>._sock</span>.send</span>(<span id="ast-63" class="other_trans">data</span>,&nbsp;<span id="ast-64" class="other_trans">flags</span>)</span></span>,&nbsp;<span id="ast-65" class="other_trans">timeout</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;is_vm_migrating(<span id="ast-2"><span id="ast-3" class="other_trans">nova</span>,&nbsp;<span id="ast-4" class="other_trans">vm</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Checking&nbsp;if&nbsp;a&nbsp;VM&nbsp;is&nbsp;migrating.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;nova:&nbsp;A&nbsp;Nova&nbsp;client.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;nova:&nbsp;*\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;vm:&nbsp;A&nbsp;VM&nbsp;UUID.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;vm:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:return:&nbsp;Whether&nbsp;the&nbsp;VM&nbsp;is&nbsp;migrating.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:rtype:&nbsp;bool\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">nova</span>.servers</span>.get</span>(<span id="ast-14">'vm'</span>)</span>.status</span><span id="ast-15" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-16">u'ACTIVE'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_restore_from_db(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Restores&nbsp;any&nbsp;user&nbsp;server&nbsp;persistent&nbsp;state&nbsp;we&nbsp;may&nbsp;have&nbsp;in&nbsp;the&nbsp;db.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;none&nbsp;saved&nbsp;yet&nbsp;then&nbsp;we&nbsp;save&nbsp;a&nbsp;bunch&nbsp;of&nbsp;default&nbsp;values.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>c</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.db</span>.conn</span>.cursor</span>()</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>c</span>.execute</span>(<span id="ast-17">'select&nbsp;uid_vv&nbsp;from&nbsp;user_server&nbsp;limit&nbsp;1'</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">c</span>.rowcount</span><span id="ast-22" class="location_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-23">0</span>)</span>:<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>c</span>.execute</span>(<span id="ast-28">'insert&nbsp;into&nbsp;user_server&nbsp;(uid_vv)&nbsp;values&nbsp;(?)'</span>,&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">str</span>(<span id="ast-31"><span id="ast-32">self</span>.uid_vv</span>)</span>)</span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>c</span>.close</span>()</span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.db</span>.commit</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.uid_vv</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">int</span>(<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">c</span>.fetchone</span>()</span>[<span id="ast-51"><span id="ast-52">0</span></span>]</span>)</span></span><span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>c</span>.close</span>()</span></span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span></span><br /><br /><hr />
</body></html>
