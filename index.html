<html><head><style>
.ast { font-family: monospace; font-size: 12pt; }
.correct_node { font-weight: bold; background-color: green; color: white; }
.incorrect_node { font-weight: bold; background-color: red; color: white; }
.ref_node { font-weight: bold; background-color: blue; color: white; }
.location_node { font-weight: bold; background-color: #ff00ff; color: white; }
.other_trans { color: #3333ff; }
.whitespace { background-color: white; color: black; }
.pred_rank_wrapper { font-weight: bold; }
.correct_pred_rank { font-weight: bold; color: green;}
.incorrect_pred_rank { font-weight: bold; color: red; }
.rank_type { font-weight: bold; }
.description { font-size: 16pt; }
</style></head><body><div class="description">
<div><b>This is the full set of system predictions for the Real-Bug Test set. This system achieves 41% Repair Accuracy and 54% Location Accuracy.</b></div><br /><div><b>Annotations</b>:</div><ul><li><span class="correct_node">foo &rarr; bar</span> - The bug was located at this node, and the system <i>correctly</i> predicted both the location and the repair as its top prediction.</li><li><span class="incorrect_node">foo &rarr; bar</span> - The system <i>incorrectly</i> predicted this repair as its top prediction.</li><li><span class="ref_node">foo &rarr; bar</span> - If the system incorrectly predicted the repair, this was the correct repair it should have made.</li><li><span class="location_node">foo &rarr; bar, pred: zap</span> - The system predicted the correct <i>location</i> of the repair, but the wrong repair label. It should have predicted 'bar', but it predicted 'zap' instead.</li></ul><div>The part before the arrow ('foo') is what the system actually saw at test time. Other candidate repair locations which the system could have chosen are marked in <span class="other_trans">this color</span>. For clarity the actual labels for those locations are not shown.</div>
<div><br />The predictions are split across 10 pages, linked here:
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.1_of_10.html">2</a>
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.2_of_10.html">3</a>
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.3_of_10.html">4</a>
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.4_of_10.html">5</a>
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.5_of_10.html">6</a>
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.6_of_10.html">7</a>
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.7_of_10.html">8</a>
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.8_of_10.html">9</a>
<a href="https://iclr2018anon.github.io/semantic_code_repair/RealBugTest_Results.9_of_10.html">10</a>
</div>
</div><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;prettyOut(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">value</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>names</span>&nbsp;=&nbsp;<span id="ast-7">[]</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>octets</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">tuple</span>(<span id="ast-12"><span id="ast-13" class="other_trans">map</span>(<span id="ast-14" class="other_trans">None</span>,&nbsp;<span id="ast-15"><span id="ast-16">str</span>(<span id="ast-17" class="other_trans">value</span>)</span>)</span>)</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-20">0</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-22">(<span id="ast-23" class="other_trans">i</span><span id="ast-24" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-25"><span id="ast-26" class="other_trans">len</span>(<span id="ast-27">octets</span>)</span>)</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">ord</span>(<span id="ast-32"><span id="ast-33" class="other_trans">octets</span>[<span id="ast-34"><span id="ast-35" class="other_trans">i</span></span>]</span>)</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-38">7</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">j</span><span id="ast-42" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-43">0</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46">v</span>&nbsp;&amp;&nbsp;<span id="ast-48">(<span id="ast-49">1</span>&nbsp;&lt;&lt;&nbsp;<span id="ast-51" class="other_trans">j</span>)</span>)</span>:<span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57">self</span>.__namedValues</span>.getName</span>(<span id="ast-58">(<span id="ast-59">(<span id="ast-60">(<span id="ast-61" class="other_trans">i</span>&nbsp;*&nbsp;<span id="ast-63">8</span>)</span>&nbsp;+&nbsp;<span id="ast-65">7</span>)</span>&nbsp;-&nbsp;<span id="ast-67" class="other_trans">j</span>)</span>)</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-70" class="other_trans">name</span><span id="ast-71" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-72" class="other_trans">None</span>)</span>:<span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76">error</span>.ProtocolError</span>(<span id="ast-77">(<span id="ast-78">'Unknown&nbsp;named&nbsp;value&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-80" class="other_trans">v</span>)</span>)</span></span></span><span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>names</span>.append</span>(<span id="ast-85" class="other_trans">name</span>)</span></span></span><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>j</span>&nbsp;=&nbsp;<span id="ast-88">(<span id="ast-89" class="other_trans">j</span>&nbsp;-&nbsp;<span id="ast-91">1</span>)</span></span></span><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-94">(<span id="ast-95" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-97">1</span>)</span></span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-99"><span id="ast-100"><span id="ast-101">string</span>.join</span>(<span id="ast-102"><span id="ast-103">map</span>(<span id="ast-104">lambda&nbsp;<span id="ast-105"><span id="ast-106" class="other_trans">x</span></span>:&nbsp;<span id="ast-107"><span id="ast-108" class="other_trans">str</span>(<span id="ast-109" class="other_trans">x</span>)</span></span>,&nbsp;<span id="ast-110" class="other_trans">names</span>)</span>,&nbsp;<span id="ast-111">',&nbsp;'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;createFeatureAction(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">samplingfeatureid</span>,&nbsp;<span id="ast-5" class="other_trans">actionid</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>featureaction</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">Featureaction</span>()</span></span><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>featureaction</span>.SamplingFeatureID</span>&nbsp;=&nbsp;<span id="ast-13" class="other_trans">samplingfeatureid</span></span><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>featureaction</span>.ActionID</span>&nbsp;=&nbsp;<span id="ast-17" class="other_trans">actionid</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._session</span>.add</span>(<span id="ast-23" class="correct_node">samplingfeatureid&nbsp;&rarr;&nbsp;featureaction&nbsp;</span>)</span></span><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._session</span>.commit</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;create(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span>,&nbsp;<span id="ast-4" class="other_trans">customer_id</span>,&nbsp;<span id="ast-5" class="other_trans">group_id</span>,&nbsp;<span id="ast-6" class="other_trans">amount_cents</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_transaction</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">cls</span>(group_id=<span id="ast-12" class="other_trans">group_id</span>,&nbsp;customer_id=<span id="ast-14" class="other_trans">customer_id</span>,&nbsp;amount_cents=<span id="ast-16" class="other_trans">amount_cents</span>,&nbsp;status=<span id="ast-18"><span id="ast-19" class="other_trans">Status</span>.PENDING</span>)</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_transaction</span>.event</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">ActionCatalog</span>.TR_CREATE</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cls</span>.session</span>.add</span>(<span id="ast-30" class="other_trans">new_transaction</span>)</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cls</span>.session</span>.commit</span>()</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-37" class="correct_node">cls&nbsp;&rarr;&nbsp;new_transaction&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__add__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">other</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Combine&nbsp;two&nbsp;feature&nbsp;sets&nbsp;to&nbsp;create&nbsp;a&nbsp;new&nbsp;one.&nbsp;&nbsp;This&nbsp;is&nbsp;done&nbsp;assuming\\u000a&nbsp;&nbsp;&nbsp;&nbsp;they&nbsp;both&nbsp;have&nbsp;the&nbsp;same&nbsp;instances&nbsp;with&nbsp;the&nbsp;same&nbsp;IDs&nbsp;in&nbsp;the&nbsp;same&nbsp;order.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_set</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">FeatureSet</span>(<span id="ast-11"><span id="ast-12"><span id="ast-13">'+'</span>.join</span>(<span id="ast-14"><span id="ast-15">sorted</span>(<span id="ast-16">[<span id="ast-17"><span id="ast-18">self</span>.name</span>,&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">other</span>.name</span>]</span>)</span>)</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24">self</span>.features</span><span id="ast-25" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-26">None</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-29">not</span>&nbsp;<span id="ast-30"><span id="ast-31">isinstance</span>(<span id="ast-32"><span id="ast-33">self</span>.vectorizer</span>,&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">type</span>(<span id="ast-36"><span id="ast-37" class="other_trans">other</span>.vectorizer</span>)</span>)</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-39"><span id="ast-40">ValueError</span>(<span id="ast-41">'Cannot&nbsp;combine&nbsp;FeatureSets&nbsp;because&nbsp;they&nbsp;are&nbsp;not&nbsp;both&nbsp;using&nbsp;the&nbsp;same&nbsp;type&nbsp;of&nbsp;feature&nbsp;vectorizer&nbsp;(e.g.,&nbsp;DictVectorizer,&nbsp;FeatureHasher)'</span>)</span></span></span><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>feature_hasher</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45">isinstance</span>(<span id="ast-46"><span id="ast-47">self</span>.vectorizer</span>,&nbsp;<span id="ast-48">FeatureHasher</span>)</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-50" class="other_trans">feature_hasher</span>:<span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52">(<span id="ast-53"><span id="ast-54"><span id="ast-55">self</span>.vectorizer</span>.n_features</span><span id="ast-56" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans">other</span>.vectorizer</span>.n_features</span>)</span>:<span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-61"><span id="ast-62">ValueError</span>(<span id="ast-63">'Cannot&nbsp;combine&nbsp;FeatureSets&nbsp;that&nbsp;uses&nbsp;FeatureHashers&nbsp;with&nbsp;different&nbsp;values&nbsp;of&nbsp;n_features&nbsp;setting.'</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-65">(<span id="ast-66"><span id="ast-67" class="other_trans">set</span>(<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71">self</span>.vectorizer</span>.get_feature_names</span>()</span>)</span>&nbsp;&amp;&nbsp;<span id="ast-73"><span id="ast-74">set</span>(<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans">other</span>.vectorizer</span>.get_feature_names</span>()</span>)</span>)</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-80"><span id="ast-81" class="other_trans">ValueError</span>(<span id="ast-82">'Cannot&nbsp;combine&nbsp;FeatureSets&nbsp;because&nbsp;they&nbsp;have&nbsp;duplicate&nbsp;feature&nbsp;names.'</span>)</span></span></span><span id="ast-83"><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>num_feats</span>&nbsp;=&nbsp;<span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88">self</span>.features</span>.shape</span>[<span id="ast-89"><span id="ast-90">1</span></span>]</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_set</span>.features</span>&nbsp;=&nbsp;<span id="ast-94"><span id="ast-95"><span id="ast-96">sp</span>.hstack</span>(<span id="ast-97">[<span id="ast-98"><span id="ast-99">self</span>.features</span>,&nbsp;<span id="ast-100"><span id="ast-101" class="other_trans">other</span>.features</span>]</span>,&nbsp;<span id="ast-102">'csr'</span>)</span></span><span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_set</span>.vectorizer</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107">deepcopy</span>(<span id="ast-108"><span id="ast-109">self</span>.vectorizer</span>)</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-111">(<span id="ast-112">not</span>&nbsp;<span id="ast-113">feature_hasher</span>)</span>:<span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vocab</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117" class="other_trans">sorted</span>(<span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122" class="ref_node">new_set&nbsp;&rarr;&nbsp;other&nbsp;</span>.vectorizer</span>.vocabulary_</span>.items</span>()</span>,&nbsp;key=<span id="ast-124">lambda&nbsp;<span id="ast-125"><span id="ast-126" class="other_trans">x</span></span>:&nbsp;<span id="ast-127"><span id="ast-128" class="other_trans">x</span>[<span id="ast-129"><span id="ast-130">1</span></span>]</span></span>)</span></span><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-132">(<span id="ast-133" class="other_trans">feat_name</span>,&nbsp;<span id="ast-134" class="other_trans">index</span>)</span>&nbsp;in&nbsp;<span id="ast-135" class="other_trans">vocab</span>:<span id="ast-136"><span id="ast-137"><span id="ast-138"><span id="ast-139"><span id="ast-140" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_set</span>.vectorizer</span>.vocabulary_</span>[<span id="ast-141"><span id="ast-142" class="other_trans">feat_name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-143">(<span id="ast-144" class="other_trans">index</span>&nbsp;+&nbsp;<span id="ast-146" class="other_trans">num_feats</span>)</span></span><span id="ast-147"><span id="ast-148"><span id="ast-149"><span id="ast-150"><span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_set</span>.vectorizer</span>.feature_names_</span>.append</span>(<span id="ast-153" class="other_trans">feat_name</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-154"><span id="ast-155"><span id="ast-156" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_set</span>.features</span>&nbsp;=&nbsp;<span id="ast-157"><span id="ast-158">deepcopy</span>(<span id="ast-159"><span id="ast-160" class="other_trans">other</span>.features</span>)</span></span><span id="ast-161"><span id="ast-162"><span id="ast-163" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_set</span>.vectorizer</span>&nbsp;=&nbsp;<span id="ast-164"><span id="ast-165">deepcopy</span>(<span id="ast-166"><span id="ast-167">other</span>.vectorizer</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;determine_memowner(<span id="ast-2"><span id="ast-3">nodes_sorted</span>,&nbsp;<span id="ast-4">updates</span>,&nbsp;<span id="ast-5">node2dev</span>,&nbsp;<span id="ast-6" class="other_trans">outputs</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>node2child</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10">defaultdict</span>(<span id="ast-11" class="other_trans">list</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-13" class="other_trans">node</span>&nbsp;in&nbsp;<span id="ast-14">nodes_sorted</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16" class="other_trans">parent</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">node</span>.parents</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>node2child</span>[<span id="ast-24"><span id="ast-25">parent</span></span>]</span>.append</span>(<span id="ast-26">node</span>)</span></span></span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>node2memowner</span>&nbsp;=&nbsp;<span id="ast-29">{}</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>after2before</span>&nbsp;=&nbsp;<span id="ast-32">{<span id="ast-33" class="other_trans">after</span>:&nbsp;<span id="ast-34" class="other_trans">before</span><span id="ast-35">&nbsp;for&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">before</span>,&nbsp;<span id="ast-38">after</span>)</span>&nbsp;in&nbsp;<span id="ast-39">updates</span></span>}</span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>enable_inplace_opt</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45">core</span>.get_config</span>()</span>[<span id="ast-46"><span id="ast-47">'enable_inplace_opt'</span></span>]</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-49" class="other_trans">node</span>&nbsp;in&nbsp;<span id="ast-50">nodes_sorted</span>:<span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-53">node</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">node</span>.is_argument</span>()</span>:<span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-60">(<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">node</span>.op</span>.writes_to_input</span><span id="ast-64" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-65">0</span>)</span>:<span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69">node2memowner</span>[<span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73">node</span>.parents</span>[<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">node</span>.op</span>.writes_to_input</span></span>]</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-79">(<span id="ast-80" class="other_trans">node</span><span id="ast-81">&nbsp;in&nbsp;</span><span id="ast-82">after2before</span>)</span>:<span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-85"><span id="ast-86" class="other_trans">after2before</span>[<span id="ast-87"><span id="ast-88" class="other_trans">node</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-90">(<span id="ast-92" class="other_trans">enable_inplace_opt</span>&nbsp;and&nbsp;<span id="ast-93">(<span id="ast-94"><span id="ast-95"><span id="ast-96">node</span>.op</span>.return_type</span><span id="ast-97" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-98">'byref'</span>)</span>)</span>:<span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nodeshape</span>&nbsp;=&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans">node</span>.op</span>.shp_apply</span>(<span id="ast-105"><span id="ast-106">node</span>.parents</span>)</span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-108" class="other_trans">parent</span>&nbsp;in&nbsp;<span id="ast-109"><span id="ast-110">node</span>.parents</span>:<span id="ast-111"><span id="ast-112" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parentowner</span>&nbsp;=&nbsp;<span id="ast-113"><span id="ast-114" class="other_trans">node2memowner</span>[<span id="ast-115"><span id="ast-116" class="other_trans">parent</span></span>]</span></span><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-118">(<span id="ast-120">(<span id="ast-121"><span id="ast-122">len</span>(<span id="ast-123"><span id="ast-124">node2child</span>[<span id="ast-125"><span id="ast-126" class="other_trans">parent</span></span>]</span>)</span><span id="ast-127" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-128">1</span>)</span>&nbsp;and&nbsp;<span id="ast-129">(<span id="ast-130">nodeshape</span><span id="ast-131" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-132"><span id="ast-133"><span id="ast-134" class="other_trans">cgt</span>.shape</span>(<span id="ast-135" class="other_trans">parent</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-136">(<span id="ast-137"><span id="ast-138">node</span>.dtype</span><span id="ast-139" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-140"><span id="ast-141">parent</span>.dtype</span>)</span>&nbsp;and&nbsp;<span id="ast-142"><span id="ast-143">_is_data_mutable</span>(<span id="ast-144">parentowner</span>)</span>&nbsp;and&nbsp;<span id="ast-145">(<span id="ast-146" class="ref_node">node&nbsp;&rarr;&nbsp;parent&nbsp;</span><span id="ast-147">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-148">outputs</span>)</span>)</span>:<span id="ast-149"><span id="ast-150" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-151" class="other_trans">parentowner</span></span><span id="ast-152"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span><span id="ast-153"><span id="ast-154"><span id="ast-155" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>node2memowner</span>[<span id="ast-156"><span id="ast-157" class="other_trans">node</span></span>]</span>&nbsp;=&nbsp;<span id="ast-158" class="other_trans">base</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;generate(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">environment</span>.Environment</span>(<span id="ast-9"><span id="ast-10">self</span>.source_dir</span>,&nbsp;<span id="ast-11"><span id="ast-12">self</span>.build_dir</span>,&nbsp;<span id="ast-13"><span id="ast-14">self</span>.meson_script_file</span>,&nbsp;<span id="ast-15"><span id="ast-16">self</span>.options</span>)</span></span><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mlog</span>.initialize</span>(<span id="ast-21"><span id="ast-22"><span id="ast-23">env</span>.get_log_dir</span>()</span>)</span></span><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mlog</span>.log</span>(<span id="ast-28"><span id="ast-29"><span id="ast-30">mlog</span>.bold</span>(<span id="ast-31">'The&nbsp;Meson&nbsp;build&nbsp;system'</span>)</span>)</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mlog</span>.log</span>(<span id="ast-36">'Version:'</span>,&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">coredata</span>.version</span>)</span></span><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mlog</span>.log</span>(<span id="ast-43">'Source&nbsp;dir:'</span>,&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46">mlog</span>.bold</span>(<span id="ast-47"><span id="ast-48">self</span>.source_dir</span>)</span>)</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mlog</span>.log</span>(<span id="ast-53">'Build&nbsp;dir:'</span>,&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">mlog</span>.bold</span>(<span id="ast-57"><span id="ast-58">self</span>.build_dir</span>)</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans">env</span>.is_cross_build</span>()</span>:<span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mlog</span>.log</span>(<span id="ast-67">'Build&nbsp;type:'</span>,&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans">mlog</span>.bold</span>(<span id="ast-71">'cross&nbsp;build'</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mlog</span>.log</span>(<span id="ast-76">'Build&nbsp;type:'</span>,&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79">mlog</span>.bold</span>(<span id="ast-80">'native&nbsp;build'</span>)</span>)</span></span></span><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>b</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85">build</span>.Build</span>(<span id="ast-86" class="other_trans">env</span>)</span></span><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>intr</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91">interpreter</span>.Interpreter</span>(<span id="ast-92" class="other_trans">b</span>)</span></span><span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>intr</span>.run</span>()</span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-98">(<span id="ast-99"><span id="ast-100"><span id="ast-101">self</span>.options</span>.backend</span><span id="ast-102" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-103">'ninja'</span>)</span>:<span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-105">ninjabackend</span></span><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>g</span>&nbsp;=&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110">ninjabackend</span>.NinjaBackend</span>(<span id="ast-111" class="other_trans">b</span>,&nbsp;<span id="ast-112" class="other_trans">intr</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-114">(<span id="ast-115"><span id="ast-116"><span id="ast-117">self</span>.options</span>.backend</span><span id="ast-118" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-119">'vs2010'</span>)</span>:<span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-121">vs2010backend</span></span><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>g</span>&nbsp;=&nbsp;<span id="ast-124"><span id="ast-125"><span id="ast-126">vs2010backend</span>.Vs2010Backend</span>(<span id="ast-127" class="other_trans">b</span>,&nbsp;<span id="ast-128" class="other_trans">intr</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-130">(<span id="ast-131"><span id="ast-132"><span id="ast-133">self</span>.options</span>.backend</span><span id="ast-134" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-135">'xcode'</span>)</span>:<span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-137">xcodebackend</span></span><span id="ast-138"><span id="ast-139" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>g</span>&nbsp;=&nbsp;<span id="ast-140"><span id="ast-141"><span id="ast-142">xcodebackend</span>.XCodeBackend</span>(<span id="ast-143" class="other_trans">b</span>,&nbsp;<span id="ast-144" class="other_trans">intr</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-146"><span id="ast-147">RuntimeError</span>(<span id="ast-148">(<span id="ast-149">'Unknown&nbsp;backend&nbsp;"%s".'</span>&nbsp;%&nbsp;<span id="ast-151"><span id="ast-152" class="ref_node">options&nbsp;&rarr;&nbsp;self.&nbsp;</span>.backend</span>)</span>)</span></span></span><span id="ast-153"><span id="ast-154"><span id="ast-155"><span id="ast-156" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>g</span>.generate</span>()</span></span><span id="ast-157"><span id="ast-158"><span id="ast-159"><span id="ast-160" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>env</span>.generating_finished</span>()</span></span><span id="ast-161"><span id="ast-162" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dumpfile</span>&nbsp;=&nbsp;<span id="ast-163"><span id="ast-164"><span id="ast-165"><span id="ast-166" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-167"><span id="ast-168"><span id="ast-169" class="other_trans">env</span>.get_scratch_dir</span>()</span>,&nbsp;<span id="ast-170">'build.dat'</span>)</span></span><span id="ast-171"><span id="ast-172"><span id="ast-173"><span id="ast-174" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pickle</span>.dump</span>(<span id="ast-175" class="incorrect_node">b&nbsp;&rarr;&nbsp;g&nbsp;</span>,&nbsp;<span id="ast-176"><span id="ast-177" class="other_trans">open</span>(<span id="ast-178">dumpfile</span>,&nbsp;<span id="ast-179">'wb'</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;completation(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">pos</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_row</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">pos</span>[<span id="ast-9"><span id="ast-10">'line'</span></span>]</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_col</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">pos</span>[<span id="ast-15"><span id="ast-16">'ch'</span></span>]</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_line</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22">self</span>.vim</span>.current</span>.line</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cached</span>&nbsp;=&nbsp;<span id="ast-25">(<span id="ast-26" class="other_trans">current_row</span><span id="ast-27" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-28"><span id="ast-29" class="other_trans">int</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32">self</span>.cached</span>[<span id="ast-33"><span id="ast-34">'row'</span></span>]</span>)</span>)</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cached</span>&nbsp;=&nbsp;<span id="ast-37">(<span id="ast-39" class="other_trans">cached</span>&nbsp;and&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">current_col</span><span id="ast-42" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-43"><span id="ast-44" class="other_trans">int</span>(<span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>.cached</span>[<span id="ast-48"><span id="ast-49">'end'</span></span>]</span>)</span>)</span>)</span></span><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cached</span>&nbsp;=&nbsp;<span id="ast-52">(<span id="ast-54" class="other_trans">cached</span>&nbsp;and&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57" class="other_trans">current_line</span>[<span id="ast-58"><span id="ast-59">0</span>:<span id="ast-60"><span id="ast-61" class="other_trans">int</span>(<span id="ast-62"><span id="ast-63"><span id="ast-64">self</span>.cached</span>[<span id="ast-65"><span id="ast-66">'end'</span></span>]</span>)</span></span>]</span><span id="ast-67" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-68"><span id="ast-69" class="ref_node">cached&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-70"><span id="ast-71">'word'</span></span>]</span>)</span>)</span></span><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cached</span>&nbsp;=&nbsp;<span id="ast-74">(<span id="ast-76" class="other_trans">cached</span>&nbsp;and&nbsp;<span id="ast-77">(<span id="ast-78">not</span>&nbsp;<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans">re</span>.match</span>(<span id="ast-82">'.*\\\\W'</span>,&nbsp;<span id="ast-83"><span id="ast-84" class="other_trans">current_line</span>[<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans">int</span>(<span id="ast-88"><span id="ast-89"><span id="ast-90">self</span>.cached</span>[<span id="ast-91"><span id="ast-92">'end'</span></span>]</span>)</span>:<span id="ast-93" class="other_trans">current_col</span></span>]</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_readnxclass(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">obj</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>nxclass</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">obj</span>.attrs</span>.get</span>(<span id="ast-11">'NX_class'</span>,&nbsp;<span id="ast-12" class="other_trans">None</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">isinstance</span>(<span id="ast-16" class="other_trans">nxclass</span>,&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">np</span>.ndarray</span>)</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nxclass</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">nxclass</span>[<span id="ast-23"><span id="ast-24">0</span></span>]</span></span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26" class="correct_node">obj&nbsp;&rarr;&nbsp;nxclass&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;Init(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Config</span>.LoadConfig</span>()</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>BCache</span>.Init</span>()</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>BoardManager</span>.Init</span>()</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>UCache</span>.Init</span>()</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>commondata</span>.CommonData</span>.Init</span>()</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fast_indexer_state</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">fast_indexer</span>.State</span>()</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fast_indexer</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">fast_indexer</span>.FastIndexer</span>(<span id="ast-37" class="correct_node">fast_indexer_state&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fast_indexer</span>.daemon</span>&nbsp;=&nbsp;<span id="ast-42">True</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fast_indexer</span>.start</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;vm_create(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">vm_name</span>,&nbsp;<span id="ast-5" class="other_trans">vm_type</span>,&nbsp;<span id="ast-6" class="other_trans">vm_networkassoc</span>,&nbsp;<span id="ast-7" class="other_trans">vm_cpuarch</span>,&nbsp;<span id="ast-8" class="other_trans">vm_image</span>,&nbsp;<span id="ast-9" class="other_trans">vm_mem</span>,&nbsp;<span id="ast-10" class="other_trans">vm_cores</span>,&nbsp;<span id="ast-11" class="other_trans">vm_storage</span>,&nbsp;<span id="ast-12" class="other_trans">customization</span>,&nbsp;<span id="ast-14" class="other_trans">vm_keepalive</span>,&nbsp;<span id="ast-16" class="other_trans">instance_type</span></span>):<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-22">(<span id="ast-23">'Trying&nbsp;to&nbsp;boot&nbsp;%s&nbsp;on&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-25">(<span id="ast-26" class="other_trans">vm_type</span>,&nbsp;<span id="ast-27"><span id="ast-28">self</span>.network_address</span>)</span>)</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30" class="incorrect_node">instance_type&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>instance_type</span>&nbsp;=&nbsp;<span id="ast-33" class="other_trans">instance_type</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>instance_type</span>&nbsp;=&nbsp;<span id="ast-36" class="ref_node">DEFAULT_INSTANCE_TYPE&nbsp;&rarr;&nbsp;self.&nbsp;</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;read_asset(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fn</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.get_asset</span>(<span id="ast-11" class="other_trans">name</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13" class="other_trans">fn</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">unicode</span>(<span id="ast-17"><span id="ast-18"><span id="ast-19" class="correct_node">name&nbsp;&rarr;&nbsp;fn&nbsp;</span>.read</span>()</span>,&nbsp;<span id="ast-20">'utf8'</span>)</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-22">''</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;string_parser(<span id="ast-2"><span id="ast-3" class="other_trans">stream</span>,&nbsp;<span id="ast-4" class="other_trans">index</span>,&nbsp;<span id="ast-5" class="other_trans">on_success</span>,&nbsp;<span id="ast-6" class="other_trans">on_failure</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10" class="other_trans">stream</span>[<span id="ast-11"><span id="ast-12" class="other_trans">index</span>:<span id="ast-13">(<span id="ast-14" class="other_trans">index</span>&nbsp;+&nbsp;<span id="ast-16" class="other_trans">slen</span>)</span></span>]</span><span id="ast-17" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-18" class="other_trans">s</span>)</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">on_success</span>(<span id="ast-22">(<span id="ast-23" class="incorrect_node">index&nbsp;&rarr;&nbsp;stream&nbsp;</span>&nbsp;+&nbsp;<span id="ast-25" class="other_trans">slen</span>)</span>,&nbsp;<span id="ast-26" class="other_trans">s</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">on_failure</span>(<span id="ast-30" class="ref_node">stream&nbsp;&rarr;&nbsp;index&nbsp;</span>,&nbsp;<span id="ast-31" class="other_trans">s</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Main&nbsp;entry&nbsp;point.'</span></span><span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirs</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">appdirs</span>.AppDirs</span>(<span id="ast-10">'hangups'</span>,&nbsp;<span id="ast-11">'hangups'</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>default_log_path</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">os</span>.path</span>.join</span>(<span id="ast-18"><span id="ast-19">dirs</span>.user_log_dir</span>,&nbsp;<span id="ast-20">'hangups.log'</span>)</span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>default_token_path</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26">os</span>.path</span>.join</span>(<span id="ast-27"><span id="ast-28">dirs</span>.user_cache_dir</span>,&nbsp;<span id="ast-29">'refresh_token.txt'</span>)</span></span><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>default_config_path</span>&nbsp;=&nbsp;<span id="ast-32">'default.conf'</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user_config_path</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38">os</span>.path</span>.join</span>(<span id="ast-39"><span id="ast-40" class="other_trans">dirs</span>.user_config_dir</span>,&nbsp;<span id="ast-41">'hangups.conf'</span>)</span></span><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dir_maker</span>(<span id="ast-45" class="other_trans">user_config_path</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48">not</span>&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52">os</span>.path</span>.isfile</span>(<span id="ast-53" class="other_trans">user_config_path</span>)</span>)</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-55"><span id="ast-56">open</span>(<span id="ast-57" class="other_trans">user_config_path</span>,&nbsp;<span id="ast-58">'a'</span>)</span>&nbsp;as&nbsp;<span id="ast-59" class="other_trans">cfg</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cfg</span>.write</span>(<span id="ast-64">''</span>)</span></span></span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">configargparse</span>.ArgumentParser</span>(prog=<span id="ast-71">'hangups'</span>,&nbsp;default_config_files=<span id="ast-73">[<span id="ast-74" class="other_trans">default_config_path</span>,&nbsp;<span id="ast-75" class="other_trans">user_config_path</span>]</span>,&nbsp;formatter_class=<span id="ast-77"><span id="ast-78">configargparse</span>.ArgumentDefaultsHelpFormatter</span>,&nbsp;add_help=<span id="ast-80">False</span>)</span></span><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85">parser</span>.add_argument_group</span>(<span id="ast-86">'General'</span>)</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>.add</span>(<span id="ast-91">'-h'</span>,&nbsp;<span id="ast-92">'--help'</span>,&nbsp;action=<span id="ast-94">'help'</span>,&nbsp;help=<span id="ast-96">'show&nbsp;this&nbsp;help&nbsp;message&nbsp;and&nbsp;exit'</span>)</span></span><span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>.add</span>(<span id="ast-101">'--token-path'</span>,&nbsp;default=<span id="ast-103">default_token_path</span>,&nbsp;help=<span id="ast-105">'path&nbsp;used&nbsp;to&nbsp;store&nbsp;OAuth&nbsp;refresh&nbsp;token'</span>)</span></span><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>.add</span>(<span id="ast-110">'--col-scheme'</span>,&nbsp;choices=<span id="ast-112"><span id="ast-113"><span id="ast-114" class="other_trans">COL_SCHEMES</span>.keys</span>()</span>,&nbsp;default=<span id="ast-116">'default'</span>,&nbsp;help=<span id="ast-118">'colour&nbsp;scheme&nbsp;to&nbsp;use'</span>)</span></span><span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>.add</span>(<span id="ast-123">'-c'</span>,&nbsp;<span id="ast-124">'--config'</span>,&nbsp;help=<span id="ast-126">'configuration&nbsp;file&nbsp;path'</span>,&nbsp;is_config_file=<span id="ast-128">True</span>,&nbsp;default=<span id="ast-130" class="ref_node">default_config_path&nbsp;&rarr;&nbsp;user_config_path&nbsp;</span>)</span></span><span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>.add</span>(<span id="ast-135">'-v'</span>,&nbsp;<span id="ast-136">'--version'</span>,&nbsp;action=<span id="ast-138">'version'</span>,&nbsp;version=<span id="ast-140"><span id="ast-141"><span id="ast-142">'hangups&nbsp;{}'</span>.format</span>(<span id="ast-143"><span id="ast-144">hangups</span>.__version__</span>)</span>)</span></span><span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>.add</span>(<span id="ast-149">'-d'</span>,&nbsp;<span id="ast-150">'--debug'</span>,&nbsp;action=<span id="ast-152">'store_true'</span>,&nbsp;help=<span id="ast-154">'log&nbsp;detailed&nbsp;debugging&nbsp;messages'</span>)</span></span><span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>.add</span>(<span id="ast-159">'-n'</span>,&nbsp;<span id="ast-160">'--disable-notifications'</span>,&nbsp;action=<span id="ast-162">'store_true'</span>,&nbsp;help=<span id="ast-164">'disable&nbsp;desktop&nbsp;notifications'</span>)</span></span><span id="ast-165"><span id="ast-166"><span id="ast-167"><span id="ast-168" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>general_group</span>.add</span>(<span id="ast-169">'--log'</span>,&nbsp;default=<span id="ast-171" class="other_trans">default_log_path</span>,&nbsp;help=<span id="ast-173">'log&nbsp;file&nbsp;path'</span>)</span></span><span id="ast-174"><span id="ast-175" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_group</span>&nbsp;=&nbsp;<span id="ast-176"><span id="ast-177"><span id="ast-178" class="incorrect_node">parser&nbsp;&rarr;&nbsp;general_group&nbsp;</span>.add_argument_group</span>(<span id="ast-179">'Keybindings'</span>)</span></span><span id="ast-180"><span id="ast-181"><span id="ast-182"><span id="ast-183" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_group</span>.add</span>(<span id="ast-184">'--key-next-tab'</span>,&nbsp;default=<span id="ast-186">'ctrl&nbsp;d'</span>,&nbsp;help=<span id="ast-188">'keybinding&nbsp;for&nbsp;next&nbsp;tab'</span>)</span></span><span id="ast-189"><span id="ast-190"><span id="ast-191"><span id="ast-192" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_group</span>.add</span>(<span id="ast-193">'--key-prev-tab'</span>,&nbsp;default=<span id="ast-195">'ctrl&nbsp;u'</span>,&nbsp;help=<span id="ast-197">'keybinding&nbsp;for&nbsp;previous&nbsp;tab'</span>)</span></span><span id="ast-198"><span id="ast-199"><span id="ast-200"><span id="ast-201" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_group</span>.add</span>(<span id="ast-202">'--key-close-tab'</span>,&nbsp;default=<span id="ast-204">'ctrl&nbsp;w'</span>,&nbsp;help=<span id="ast-206">'keybinding&nbsp;for&nbsp;close&nbsp;tab'</span>)</span></span><span id="ast-207"><span id="ast-208"><span id="ast-209"><span id="ast-210"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_group</span>.add</span>(<span id="ast-211">'--key-quit'</span>,&nbsp;default=<span id="ast-213">'ctrl&nbsp;e'</span>,&nbsp;help=<span id="ast-215">'keybinding&nbsp;for&nbsp;quitting'</span>)</span></span><span id="ast-216"><span id="ast-217"><span id="ast-218"><span id="ast-219"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_group</span>.add</span>(<span id="ast-220">'--key-menu'</span>,&nbsp;default=<span id="ast-222">'ctrl&nbsp;n'</span>,&nbsp;help=<span id="ast-224">'keybinding&nbsp;for&nbsp;context&nbsp;menu'</span>)</span></span><span id="ast-225"><span id="ast-226"><span id="ast-227"><span id="ast-228"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_group</span>.add</span>(<span id="ast-229">'--key-up'</span>,&nbsp;default=<span id="ast-231">'k'</span>,&nbsp;help=<span id="ast-233">'keybinding&nbsp;for&nbsp;alternate&nbsp;up&nbsp;key'</span>)</span></span><span id="ast-234"><span id="ast-235"><span id="ast-236"><span id="ast-237"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_group</span>.add</span>(<span id="ast-238">'--key-down'</span>,&nbsp;default=<span id="ast-240">'j'</span>,&nbsp;help=<span id="ast-242">'keybinding&nbsp;for&nbsp;alternate&nbsp;down&nbsp;key'</span>)</span></span><span id="ast-243"><span id="ast-244" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-245"><span id="ast-246"><span id="ast-247" class="other_trans">parser</span>.parse_args</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;from_list(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span>,&nbsp;<span id="ast-4" class="other_trans">language_code</span>,&nbsp;<span id="ast-5" class="other_trans">subtitles</span>,&nbsp;<span id="ast-6" class="other_trans">escape</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;a&nbsp;SubtitleSet&nbsp;from&nbsp;a&nbsp;list&nbsp;of&nbsp;subtitle&nbsp;tuples.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Each&nbsp;tuple&nbsp;should&nbsp;be&nbsp;(from_ms,&nbsp;to_ms,&nbsp;content).&nbsp;&nbsp;See&nbsp;the&nbsp;docstring&nbsp;of\\u000a&nbsp;&nbsp;&nbsp;&nbsp;append_subtitle&nbsp;for&nbsp;more&nbsp;information.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;example:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(0,&nbsp;1000,&nbsp;"Hello,&nbsp;",&nbsp;{\'new_paragraph\':True}),\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1100,&nbsp;None,&nbsp;"world!")]\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>subs</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">SubtitleSet</span>(language_code=<span id="ast-15" class="other_trans">language_code</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-17" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-18" class="other_trans">subtitles</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>extra</span>&nbsp;=&nbsp;<span id="ast-21">{}</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24"><span id="ast-25" class="other_trans">len</span>(<span id="ast-26" class="other_trans">s</span>)</span><span id="ast-27" class="correct_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-28">3</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>extra</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">s</span>[<span id="ast-33"><span id="ast-34">3</span></span>]</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">s</span>[<span id="ast-39">:<span id="ast-40">-1</span></span>]</span></span></span><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>extra</span>[<span id="ast-44"><span id="ast-45">'escape'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-46" class="other_trans">escape</span></span><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subs</span>.append_subtitle</span>(*<span id="ast-51" class="other_trans">s</span>,&nbsp;**<span id="ast-52" class="other_trans">extra</span>)</span></span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-54" class="other_trans">subs</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__get__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">instance</span>,&nbsp;<span id="ast-5">owner</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9" class="other_trans">instance</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>._get_cached_value</span>(<span id="ast-16" class="other_trans">instance</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18" class="other_trans">data</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-20" class="other_trans">data</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>.handle</span>(<span id="ast-27" class="other_trans">instance</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-29" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-30" class="other_trans">e</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">getattr</span>(<span id="ast-35" class="incorrect_node">instance&nbsp;&rarr;&nbsp;data&nbsp;</span>,&nbsp;<span id="ast-36" class="ref_node">field&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">settings</span>.ST_DEBUG</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">Exception</span>(<span id="ast-43" class="other_trans">e</span>)</span></span></span></span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cache</span>.set</span>(<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>._get_cache_key</span>(<span id="ast-51" class="other_trans">instance</span>)</span>,&nbsp;<span id="ast-52" class="other_trans">data</span>,&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">settings</span>.MARKUP_CONTENT_CACHE_TIMEOUT</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-56" class="other_trans">data</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">num_epochs</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dataset</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">load_data</span>()</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_layer</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">build_model</span>(input_dim=<span id="ast-14"><span id="ast-15" class="other_trans">dataset</span>[<span id="ast-16"><span id="ast-17">'input_dim'</span></span>]</span>,&nbsp;output_dim=<span id="ast-19"><span id="ast-20" class="other_trans">dataset</span>[<span id="ast-21"><span id="ast-22">'output_dim'</span></span>]</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iter_funcs</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26">create_iter_functions</span>(<span id="ast-27" class="other_trans">dataset</span>,&nbsp;<span id="ast-28" class="other_trans">output_layer</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-30">'Starting&nbsp;training...'</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32" class="other_trans">epoch</span>&nbsp;in&nbsp;<span id="ast-33"><span id="ast-34">train</span>(<span id="ast-35" class="other_trans">iter_funcs</span>,&nbsp;<span id="ast-36" class="other_trans">dataset</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-38">(<span id="ast-39">'Epoch&nbsp;%d&nbsp;of&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43" class="other_trans">epoch</span>[<span id="ast-44"><span id="ast-45">'number'</span></span>]</span>,&nbsp;<span id="ast-46" class="other_trans">num_epochs</span>)</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-48">(<span id="ast-49">'&nbsp;&nbsp;training&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">epoch</span>[<span id="ast-53"><span id="ast-54">'train_loss'</span></span>]</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-56">(<span id="ast-57">'&nbsp;&nbsp;validation&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">epoch</span>[<span id="ast-61"><span id="ast-62">'valid_loss'</span></span>]</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-64">(<span id="ast-65">'&nbsp;&nbsp;validation&nbsp;accuracy:\\u0009\\u0009%.2f&nbsp;%%'</span>&nbsp;%&nbsp;<span id="ast-67">(<span id="ast-68"><span id="ast-69" class="other_trans">epoch</span>[<span id="ast-70"><span id="ast-71">'valid_accuracy'</span></span>]</span>&nbsp;*&nbsp;<span id="ast-73">100</span>)</span>)</span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-75">(<span id="ast-76"><span id="ast-77" class="other_trans">epoch</span>[<span id="ast-78"><span id="ast-79">'number'</span></span>]</span><span id="ast-80" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-81" class="other_trans">num_epochs</span>)</span>:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;to_jsonable(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-5">{<span id="ast-6">'ntd_id'</span>:&nbsp;<span id="ast-21"><span id="ast-22">self</span>.ntd_id</span>,&nbsp;<span id="ast-7">'gtfs_data_exchange_id'</span>:&nbsp;<span id="ast-23"><span id="ast-24">self</span>.gtfs_data_exchange_id</span>,&nbsp;<span id="ast-8">'date_opened'</span>:&nbsp;<span id="ast-25"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31">self</span>.date_opened</span>.isoformat</span>(<span id="ast-32">'&nbsp;'</span>)</span>&nbsp;if&nbsp;<span id="ast-26"><span id="ast-27">self</span>.date_opened</span>&nbsp;else&nbsp;<span id="ast-33" class="other_trans">None</span></span>,&nbsp;<span id="ast-9">'passenger_miles'</span>:&nbsp;<span id="ast-34"><span id="ast-35">self</span>.passenger_miles</span>,&nbsp;<span id="ast-10">'is_public'</span>:&nbsp;<span id="ast-36"><span id="ast-37">self</span>.is_public</span>,&nbsp;<span id="ast-11">'name'</span>:&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans">cgi</span>.escape</span>(<span id="ast-41"><span id="ast-42">self</span>.name</span>)</span>,&nbsp;<span id="ast-12">'city'</span>:&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">cgi</span>.escape</span>(<span id="ast-46"><span id="ast-47">self</span>.city</span>)</span>,&nbsp;<span id="ast-13">'urlslug'</span>:&nbsp;<span id="ast-48"><span id="ast-49">self</span>.urlslug</span>,&nbsp;<span id="ast-14">'state'</span>:&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">cgi</span>.escape</span>(<span id="ast-53"><span id="ast-54">self</span>.state</span>)</span>,&nbsp;<span id="ast-15">'details_url'</span>:&nbsp;<span id="ast-55"><span id="ast-56">self</span>.details_url</span>,&nbsp;<span id="ast-16">'key_encoded'</span>:&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">str</span>(<span id="ast-59"><span id="ast-60"><span id="ast-61">self</span>.key</span>()</span>)</span>,&nbsp;<span id="ast-17">'has_real_time_data'</span>:&nbsp;<span id="ast-62"><span id="ast-63">self</span>.has_real_time_data</span>,&nbsp;<span id="ast-18">'latitude'</span>:&nbsp;<span id="ast-64"><span id="ast-67"><span id="ast-68"><span id="ast-69">self</span>.location</span>.lat</span>&nbsp;if&nbsp;<span id="ast-65"><span id="ast-66">self</span>.location</span>&nbsp;else&nbsp;<span id="ast-70" class="other_trans">None</span></span>,&nbsp;<span id="ast-19">'longitude'</span>:&nbsp;<span id="ast-71"><span id="ast-74"><span id="ast-75"><span id="ast-76">self</span>.location</span>.lon</span>&nbsp;if&nbsp;<span id="ast-72"><span id="ast-73">self</span>.location</span>&nbsp;else&nbsp;<span id="ast-77" class="other_trans">None</span></span>,&nbsp;<span id="ast-20">'executive_email'</span>:&nbsp;<span id="ast-78" class="correct_node">executive_email&nbsp;&rarr;&nbsp;self.&nbsp;</span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;render_templates(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>.components</span>[<span id="ast-9"><span id="ast-10">'saml'</span></span>]</span>[<span id="ast-11"><span id="ast-12">'enabled'</span></span>]</span>:<span id="ast-13"><span id="ast-14" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>oxTrustConfigGeneration&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-15">'enabled'</span></span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logIt</span>(<span id="ast-20">'Rendering&nbsp;templates'</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-22" class="other_trans">fullPath</span>&nbsp;in&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>.ce_templates</span>.keys</span>()</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logIt</span>(<span id="ast-32">(<span id="ast-33">'Rendering&nbsp;template&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-35" class="other_trans">fullPath</span>)</span>)</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fn</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">os</span>.path</span>.split</span>(<span id="ast-43" class="other_trans">fullPath</span>)</span>[<span id="ast-44"><span id="ast-45">-1</span></span>]</span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49">open</span>(<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53">os</span>.path</span>.join</span>(<span id="ast-54"><span id="ast-55">self</span>.templateFolder</span>,&nbsp;<span id="ast-56" class="other_trans">fn</span>)</span>)</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>template_text</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">f</span>.read</span>()</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.close</span>()</span></span><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>newFn</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">open</span>(<span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-74"><span id="ast-75">self</span>.outputFolder</span>,&nbsp;<span id="ast-76" class="incorrect_node">fn&nbsp;&rarr;&nbsp;fullPath&nbsp;</span>)</span>,&nbsp;<span id="ast-77">'w+'</span>)</span></span><span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>newFn</span>.write</span>(<span id="ast-82">(<span id="ast-83" class="other_trans">template_text</span>&nbsp;%&nbsp;<span id="ast-85"><span id="ast-86">self</span>.__dict__</span>)</span>)</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>newFn</span>.close</span>()</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logIt</span>(<span id="ast-96">(<span id="ast-97">'Error&nbsp;writing&nbsp;template&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-99" class="other_trans">fullPath</span>)</span>,&nbsp;<span id="ast-100">True</span>)</span></span><span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logIt</span>(<span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans">traceback</span>.format_exc</span>()</span>,&nbsp;<span id="ast-108">True</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__getitem__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">index</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>returned_elements</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">self</span>.returned_elements</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">returned_elements</span>[<span id="ast-13"><span id="ast-14" class="other_trans">index</span></span>]</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-16" class="other_trans">IndexError</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-18" class="other_trans">pos</span>&nbsp;in&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">range</span>(<span id="ast-21"><span id="ast-22" class="other_trans">len</span>(<span id="ast-23" class="other_trans">returned_elements</span>)</span>,&nbsp;<span id="ast-24">(<span id="ast-25" class="other_trans">index</span>&nbsp;+&nbsp;<span id="ast-27">1</span>)</span>)</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">next</span>(<span id="ast-32"><span id="ast-33">self</span>.iterable</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36" class="other_trans">value</span><span id="ast-37" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-38" class="other_trans">None</span>)</span>:<span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42" class="ref_node">none_converter&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-43" class="incorrect_node">pos&nbsp;&rarr;&nbsp;value&nbsp;</span>)</span></span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>returned_elements</span>.append</span>(<span id="ast-48" class="other_trans">value</span>)</span></span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">returned_elements</span>[<span id="ast-52"><span id="ast-53" class="other_trans">index</span></span>]</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;predict_probability_radius(<span id="ast-2"><span id="ast-3" class="other_trans">model</span>,&nbsp;<span id="ast-4" class="other_trans">radius</span>,&nbsp;<span id="ast-5" class="other_trans">center_point</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>total_prob</span>&nbsp;=&nbsp;<span id="ast-8">0</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>center_lat</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">center_point</span>[<span id="ast-13"><span id="ast-14">1</span></span>]</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>center_lon</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">center_point</span>[<span id="ast-19"><span id="ast-20">0</span></span>]</span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lat_dist</span>&nbsp;=&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">radius</span>&nbsp;/&nbsp;<span id="ast-26">111.32</span>)</span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>upper_lat</span>&nbsp;=&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">center_lat</span>&nbsp;+&nbsp;<span id="ast-32" class="other_trans">lat_dist</span>)</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lower_lat</span>&nbsp;=&nbsp;<span id="ast-35">(<span id="ast-36" class="other_trans">center_lat</span>&nbsp;-&nbsp;<span id="ast-38" class="other_trans">lat_dist</span>)</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lon_dist</span>&nbsp;=&nbsp;<span id="ast-41">(<span id="ast-42">(<span id="ast-43" class="other_trans">radius</span>&nbsp;/&nbsp;<span id="ast-45">111.32</span>)</span>&nbsp;*&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49">math</span>.cos</span>(<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">math</span>.radians</span>(<span id="ast-53" class="ref_node">center_lon&nbsp;&rarr;&nbsp;center_lat&nbsp;</span>)</span>)</span>)</span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>right_lon</span>&nbsp;=&nbsp;<span id="ast-56">(<span id="ast-57" class="other_trans">center_lon</span>&nbsp;+&nbsp;<span id="ast-59" class="other_trans">lon_dist</span>)</span></span><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>left_lon</span>&nbsp;=&nbsp;<span id="ast-62">(<span id="ast-63" class="incorrect_node">center_lon&nbsp;&rarr;&nbsp;center_lat&nbsp;</span>&nbsp;-&nbsp;<span id="ast-65" class="other_trans">lon_dist</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_latest_level_zero_increments(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">engine</span>,&nbsp;<span id="ast-5" class="other_trans">hostname_backup_name</span>,&nbsp;<span id="ast-6" class="other_trans">recent_to_date</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;the&nbsp;latest&nbsp;zero&nbsp;level&nbsp;backup&nbsp;with&nbsp;increments\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;engine:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;hostname_backup_name:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;recent_to_date:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:rtype:&nbsp;dict[int,&nbsp;freezer.storage.base.Backup]\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:return:&nbsp;Dictionary[backup_level,&nbsp;backup]\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>zeros</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.get_level_zero</span>(engine=<span id="ast-16" class="other_trans">engine</span>,&nbsp;hostname_backup_name=<span id="ast-18" class="other_trans">hostname_backup_name</span>,&nbsp;recent_to_date=<span id="ast-20" class="other_trans">recent_to_date</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23">not</span>&nbsp;<span id="ast-24" class="other_trans">zeros</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>err_msg</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">'No&nbsp;matching&nbsp;backup&nbsp;name&nbsp;"{0}"&nbsp;found'</span>.format</span>(<span id="ast-30" class="other_trans">hostname_backup_name</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">IndexError</span>(<span id="ast-34" class="other_trans">err_msg</span>)</span></span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>backup</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38">max</span>(<span id="ast-39" class="other_trans">zeros</span>,&nbsp;key=<span id="ast-41">lambda&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">backup</span></span>:&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">backup</span>.timestamp</span></span>)</span></span><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>':type&nbsp;:&nbsp;freezer.storage.base.Backup'</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>increments</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">backup</span>.get_increments</span>()</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-54">{<span id="ast-55" class="other_trans">level</span>:&nbsp;<span id="ast-56" class="other_trans">backup</span><span id="ast-57">&nbsp;for&nbsp;<span id="ast-58">(<span id="ast-59" class="other_trans">level</span>,&nbsp;<span id="ast-60" class="other_trans">backup</span>)</span>&nbsp;in&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">increments</span>.iteritems</span>()</span>&nbsp;if&nbsp;<span id="ast-64">(<span id="ast-66">(<span id="ast-67">not</span>&nbsp;<span id="ast-68" class="other_trans">recent_to_date</span>)</span>&nbsp;or&nbsp;<span id="ast-69">(<span id="ast-70"><span id="ast-71" class="other_trans">backup</span>.timestamp</span><span id="ast-72" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-73" class="other_trans">recent_to_date</span>)</span>)</span></span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_derive_y_from_x(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">x</span>,&nbsp;<span id="ast-5" class="other_trans">is_even</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Derive&nbsp;y&nbsp;point&nbsp;from&nbsp;x&nbsp;point&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>curve</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">ecdsa</span>.SECP256k1</span>.curve</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-15" class="other_trans">a</span>,&nbsp;<span id="ast-16" class="other_trans">b</span>,&nbsp;<span id="ast-17" class="other_trans">p</span>)</span>&nbsp;=&nbsp;<span id="ast-18">(<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">curve</span>.a</span>()</span>,&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">curve</span>.b</span>()</span>,&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">curve</span>.p</span>()</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>alpha</span>&nbsp;=&nbsp;<span id="ast-30">(<span id="ast-31">(<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">pow</span>(<span id="ast-35" class="other_trans">x</span>,&nbsp;<span id="ast-36">3</span>,&nbsp;<span id="ast-37" class="other_trans">p</span>)</span>&nbsp;+&nbsp;<span id="ast-39">(<span id="ast-40" class="other_trans">a</span>&nbsp;*&nbsp;<span id="ast-42" class="other_trans">x</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-44" class="other_trans">b</span>)</span>&nbsp;%&nbsp;<span id="ast-46" class="other_trans">p</span>)</span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>beta</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">ecdsa</span>.numbertheory</span>.square_root_mod_prime</span>(<span id="ast-53" class="other_trans">alpha</span>,&nbsp;<span id="ast-54" class="other_trans">p</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">(<span id="ast-57">(<span id="ast-58" class="other_trans">beta</span>&nbsp;%&nbsp;<span id="ast-60">2</span>)</span><span id="ast-61" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-62" class="other_trans">is_even</span>)</span>:<span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>beta</span>&nbsp;=&nbsp;<span id="ast-65">(<span id="ast-66" class="other_trans">p</span>&nbsp;-&nbsp;<span id="ast-68" class="other_trans">beta</span>)</span></span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-70" class="other_trans">beta</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">edit</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>menu_items</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>.FILE_DIFFS</span>[<span id="ast-10">:</span>]</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>saved</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14">self</span>.SAVED</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>non_empty_regions</span>&nbsp;=&nbsp;<span id="ast-17">[<span id="ast-18" class="other_trans">region</span><span id="ast-19">&nbsp;for&nbsp;<span id="ast-20" class="other_trans">region</span>&nbsp;in&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24">self</span>.view</span>.sel</span>()</span>&nbsp;if&nbsp;<span id="ast-25">(<span id="ast-26">not</span>&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">region</span>.empty</span>()</span>)</span></span>]</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32"><span id="ast-33" class="other_trans">len</span>(<span id="ast-34" class="other_trans">non_empty_regions</span>)</span><span id="ast-35" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-36">2</span>)</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>menu_items</span>.insert</span>(<span id="ast-41">1</span>,&nbsp;<span id="ast-42" class="correct_node">SELECTIONS&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">len</span>(<span id="ast-46" class="other_trans">non_empty_regions</span>)</span>:<span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>menu_items</span>&nbsp;=&nbsp;<span id="ast-49">[<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">f</span>.replace</span>(<span id="ast-53">u'Diff&nbsp;file'</span>,&nbsp;<span id="ast-54">u'Diff&nbsp;selection'</span>)</span><span id="ast-55">&nbsp;for&nbsp;<span id="ast-56" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-57" class="other_trans">menu_items</span></span>]</span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>saved</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans">saved</span>.replace</span>(<span id="ast-63">u'Diff&nbsp;file'</span>,&nbsp;<span id="ast-64">u'Diff&nbsp;selection'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_use_berry(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">berry_id</span>,&nbsp;<span id="ast-5" class="other_trans">berry_count</span>,&nbsp;<span id="ast-6" class="other_trans">encounter_id</span>,&nbsp;<span id="ast-7" class="other_trans">catch_rate_by_ball</span>,&nbsp;<span id="ast-8" class="other_trans">current_ball</span></span>):<span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_catch_rate_by_ball</span>&nbsp;=&nbsp;<span id="ast-11">[]</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-16">'pokemon_catch_rate'</span>,&nbsp;level=<span id="ast-18">'debug'</span>,&nbsp;formatted=<span id="ast-20">'Catch&nbsp;rate&nbsp;of&nbsp;{catch_rate}&nbsp;with&nbsp;{ball_name}&nbsp;is&nbsp;low.&nbsp;Throwing&nbsp;{berry_name}&nbsp;(have&nbsp;{berry_count})'</span>,&nbsp;data=<span id="ast-22">{<span id="ast-23">'catch_rate'</span>:&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>._pct</span>(<span id="ast-30"><span id="ast-31" class="other_trans">catch_rate_by_ball</span>[<span id="ast-32"><span id="ast-33" class="other_trans">current_ball</span></span>]</span>)</span>,&nbsp;<span id="ast-24">'ball_name'</span>:&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36">self</span>.item_list</span>[<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">str</span>(<span id="ast-40" class="other_trans">current_ball</span>)</span></span>]</span>,&nbsp;<span id="ast-25">'berry_name'</span>:&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43">self</span>.item_list</span>[<span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans">str</span>(<span id="ast-47" class="other_trans">berry_id</span>)</span></span>]</span>,&nbsp;<span id="ast-26">'berry_count'</span>:&nbsp;<span id="ast-48" class="other_trans">berry_count</span>}</span>)</span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response_dict</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54">self</span>.api</span>.use_item_capture</span>(item_id=<span id="ast-56" class="other_trans">berry_id</span>,&nbsp;encounter_id=<span id="ast-58" class="other_trans">encounter_id</span>,&nbsp;spawn_point_id=<span id="ast-60"><span id="ast-61">self</span>.spawn_point_guid</span>)</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>responses</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">response_dict</span>[<span id="ast-66"><span id="ast-67">'responses'</span></span>]</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-71" class="other_trans">response_dict</span>&nbsp;and&nbsp;<span id="ast-72">(<span id="ast-73"><span id="ast-74" class="other_trans">response_dict</span>[<span id="ast-75"><span id="ast-76">'status_code'</span></span>]</span><span id="ast-77" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-78">1</span>)</span>)</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-80">(<span id="ast-81">'item_capture_mult'</span><span id="ast-82">&nbsp;in&nbsp;</span><span id="ast-83"><span id="ast-84" class="other_trans">responses</span>[<span id="ast-85"><span id="ast-86">'USE_ITEM_CAPTURE'</span></span>]</span>)</span>:<span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-88" class="other_trans">rate</span>&nbsp;in&nbsp;<span id="ast-89" class="incorrect_node">catch_rate_by_ball&nbsp;&rarr;&nbsp;new_catch_rate_by_ball&nbsp;</span>:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_catch_rate_by_ball</span>.append</span>(<span id="ast-94">(<span id="ast-95" class="other_trans">rate</span>&nbsp;*&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans">responses</span>[<span id="ast-100"><span id="ast-101">'USE_ITEM_CAPTURE'</span></span>]</span>[<span id="ast-102"><span id="ast-103">'item_capture_mult'</span></span>]</span>)</span>)</span></span></span><span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-108">'threw_berry'</span>,&nbsp;formatted=<span id="ast-110">'Threw&nbsp;a&nbsp;{berry_name}!&nbsp;Catch&nbsp;rate&nbsp;with&nbsp;{ball_name}&nbsp;is&nbsp;now:&nbsp;{new_catch_rate}'</span>,&nbsp;data=<span id="ast-112">{<span id="ast-113">'berry_name'</span>:&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118">self</span>.item_list</span>[<span id="ast-119"><span id="ast-120"><span id="ast-121">str</span>(<span id="ast-122" class="other_trans">berry_id</span>)</span></span>]</span>,&nbsp;<span id="ast-114">'ball_name'</span>:&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125">self</span>.item_list</span>[<span id="ast-126"><span id="ast-127"><span id="ast-128" class="other_trans">str</span>(<span id="ast-129" class="other_trans">current_ball</span>)</span></span>]</span>,&nbsp;<span id="ast-115">'new_catch_rate'</span>:&nbsp;<span id="ast-130"><span id="ast-131"><span id="ast-132">self</span>._pct</span>(<span id="ast-133"><span id="ast-134" class="ref_node">catch_rate_by_ball&nbsp;&rarr;&nbsp;new_catch_rate_by_ball&nbsp;</span>[<span id="ast-135"><span id="ast-136" class="other_trans">current_ball</span></span>]</span>)</span>}</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;migrate_role(<span id="ast-2"><span id="ast-3" class="other_trans">context</span>,&nbsp;<span id="ast-4" class="other_trans">role_id</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>role_binding</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">'role-{}'</span>.format</span>(<span id="ast-10" class="other_trans">role_id</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>role_retrieve</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">'{}-retrieve'</span>.format</span>(<span id="ast-16" class="other_trans">role_binding</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>role_ensure</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">'{}-ensure'</span>.format</span>(<span id="ast-22" class="other_trans">role_binding</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29">linear_flow</span>.Flow</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32">'migrate-role-{}'</span>.format</span>(<span id="ast-33" class="other_trans">role_id</span>)</span>)</span>.add</span>(<span id="ast-34"><span id="ast-35" class="other_trans">RetrieveRole</span>(<span id="ast-36"><span id="ast-37" class="other_trans">context</span>.src_cloud</span>,&nbsp;name=<span id="ast-39" class="ref_node">role_retrieve&nbsp;&rarr;&nbsp;role_binding&nbsp;</span>,&nbsp;provides=<span id="ast-41" class="other_trans">role_binding</span>,&nbsp;rebind=<span id="ast-43">[<span id="ast-44" class="other_trans">role_retrieve</span>]</span>)</span>,&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">EnsureRole</span>(<span id="ast-47"><span id="ast-48" class="other_trans">context</span>.dst_cloud</span>,&nbsp;name=<span id="ast-50" class="incorrect_node">role_ensure&nbsp;&rarr;&nbsp;role_id&nbsp;</span>,&nbsp;provides=<span id="ast-52" class="other_trans">role_ensure</span>,&nbsp;rebind=<span id="ast-54">[<span id="ast-55" class="other_trans">role_binding</span>]</span>)</span>)</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>.store</span>[<span id="ast-60"><span id="ast-61" class="other_trans">role_retrieve</span></span>]</span>&nbsp;=&nbsp;<span id="ast-62" class="other_trans">role_id</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-64" class="other_trans">flow</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__contains__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">elem</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-6">(<span id="ast-8">(<span id="ast-9" class="other_trans">elem</span><span id="ast-10" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-11"><span id="ast-12">self</span>._start</span>)</span>&nbsp;and&nbsp;<span id="ast-13">(<span id="ast-14">(<span id="ast-15">(<span id="ast-16" class="other_trans">elem</span>&nbsp;-&nbsp;<span id="ast-18"><span id="ast-19">self</span>._start</span>)</span>&nbsp;%&nbsp;<span id="ast-21"><span id="ast-22">self</span>._step</span>)</span><span id="ast-23" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-24">0</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__equals__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">other</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7"><span id="ast-8" class="other_trans">type</span>(<span id="ast-9" class="other_trans">other</span>)</span><span id="ast-10" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-11"><span id="ast-12" class="other_trans">type</span>(<span id="ast-13">self</span>)</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-15">False</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;POST_confirm_trainer(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">workshop</span>,&nbsp;<span id="ast-5" class="other_trans">i</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">account</span>.get_current_user</span>()</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>org</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">workshop</span>.get_org</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-19" class="other_trans">user</span>&nbsp;and&nbsp;<span id="ast-20">(<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">user</span>.is_admin</span>()</span>&nbsp;or&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">org</span>.is_member</span>(<span id="ast-28" class="other_trans">user</span>)</span>)</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>trainer</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">User</span>.find</span>(username=<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">i</span>.get</span>(<span id="ast-38">'trainer'</span>)</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-42">(<span id="ast-43">not</span>&nbsp;<span id="ast-44" class="other_trans">trainer</span>)</span>&nbsp;or&nbsp;<span id="ast-45">(<span id="ast-46">not</span>&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49" class="incorrect_node">workshop&nbsp;&rarr;&nbsp;org&nbsp;</span>.is_interested_trainer</span>(<span id="ast-50" class="other_trans">trainer</span>)</span>)</span>)</span>:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>flash</span>(message=<span id="ast-55">'Sorry,&nbsp;unable&nbsp;to&nbsp;confirm&nbsp;the&nbsp;trainer.&nbsp;Please&nbsp;try&nbsp;again.'</span>,&nbsp;category=<span id="ast-57">'error'</span>)</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">web</span>.seeother</span>(<span id="ast-62"><span id="ast-63"><span id="ast-64">'/workshops/{}'</span>.format</span>(<span id="ast-65"><span id="ast-66" class="other_trans">workshop</span>.id</span>)</span>)</span></span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>workshop</span>.confirm_trainer</span>(<span id="ast-71" class="other_trans">trainer</span>)</span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>signals</span>.workshop_confirmed</span>.send</span>(<span id="ast-77" class="other_trans">workshop</span>,&nbsp;trainer=<span id="ast-79" class="ref_node">user&nbsp;&rarr;&nbsp;trainer&nbsp;</span>)</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>flash</span>(<span id="ast-83"><span id="ast-84"><span id="ast-85">'Done!&nbsp;Confirmed&nbsp;{}&nbsp;as&nbsp;trainer&nbsp;for&nbsp;this&nbsp;workshop.'</span>.format</span>(<span id="ast-86"><span id="ast-87" class="other_trans">trainer</span>.name</span>)</span>)</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans">web</span>.seeother</span>(<span id="ast-92"><span id="ast-93"><span id="ast-94">'/workshops/{}'</span>.format</span>(<span id="ast-95"><span id="ast-96" class="other_trans">workshop</span>.id</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-98"><span id="ast-99" class="other_trans">render_template</span>(<span id="ast-100">'workshops/view.html'</span>,&nbsp;workshop=<span id="ast-102" class="other_trans">workshop</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;validate(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">basket</span>,&nbsp;<span id="ast-5" class="other_trans">product</span>,&nbsp;<span id="ast-6" class="other_trans">quantity</span>,&nbsp;<span id="ast-7" class="other_trans">options</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>availability</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">basket</span>.strategy</span>.fetch_for_product</span>(<span id="ast-15" class="other_trans">product</span>)</span>.availability</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">availability</span>.is_available_to_buy</span>)</span>:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-22">(<span id="ast-23">False</span>,&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">availability</span>.message</span>)</span></span></span><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-28" class="other_trans">allowed</span>,&nbsp;<span id="ast-29" class="other_trans">message</span>)</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">availability</span>.is_purchase_permitted</span>(<span id="ast-33" class="other_trans">quantity</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36">not</span>&nbsp;<span id="ast-37" class="other_trans">allowed</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-39">(<span id="ast-40">False</span>,&nbsp;<span id="ast-41" class="other_trans">message</span>)</span></span></span><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-44" class="other_trans">allowed</span>,&nbsp;<span id="ast-45" class="other_trans">message</span>)</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">basket</span>.is_quantity_allowed</span>(<span id="ast-49" class="other_trans">quantity</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52">not</span>&nbsp;<span id="ast-53" class="other_trans">allowed</span>)</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-55">(<span id="ast-56">False</span>,&nbsp;<span id="ast-57" class="correct_node">quantity&nbsp;&rarr;&nbsp;message&nbsp;</span>)</span></span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-59">(<span id="ast-60">True</span>,&nbsp;<span id="ast-61" class="other_trans">None</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;dump_or_error(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">obj</span>,&nbsp;<span id="ast-5" class="other_trans">error_message</span>,&nbsp;<span id="ast-6" class="other_trans">callback</span>,&nbsp;<span id="ast-8" class="other_trans">success_status_code</span></span>):<span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Dump&nbsp;JSON&nbsp;or&nbsp;return&nbsp;error&nbsp;message,&nbsp;potentially&nbsp;with&nbsp;callback.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;`obj`&nbsp;is&nbsp;None&nbsp;`error_message`&nbsp;is&nbsp;returned&nbsp;and&nbsp;the&nbsp;HTTP&nbsp;status&nbsp;code\\u000a&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;set&nbsp;to&nbsp;400.&nbsp;Otherwise&nbsp;the&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;set&nbsp;to\\u000a&nbsp;&nbsp;&nbsp;&nbsp;`success_status_code`.&nbsp;If&nbsp;`callback`&nbsp;exists,&nbsp;the&nbsp;returned&nbsp;string&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;wrapped&nbsp;in&nbsp;the&nbsp;callback&nbsp;for&nbsp;JSONP.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;obj:&nbsp;Data&nbsp;to&nbsp;dump&nbsp;as&nbsp;JSON&nbsp;using&nbsp;BSON&nbsp;encoder.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;error_message:&nbsp;Error&nbsp;message&nbsp;to&nbsp;return&nbsp;is&nbsp;object&nbsp;is&nbsp;None.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;callback:&nbsp;Callback&nbsp;string&nbsp;to&nbsp;wrap&nbsp;obj&nbsp;in&nbsp;for&nbsp;JSONP.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;success_status_code:&nbsp;The&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;to&nbsp;return,&nbsp;default&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_SUCCESS_STATUS_CODE.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:returns:&nbsp;A&nbsp;JSON&nbsp;string&nbsp;wrapped&nbsp;with&nbsp;callback&nbsp;if&nbsp;callback&nbsp;is&nbsp;not&nbsp;False.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cherrypy</span>.response</span>.headers</span>[<span id="ast-17"><span id="ast-18">'Content-Type'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-19">'application/json'</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cherrypy</span>.response</span>.status</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-26" class="other_trans">success_status_code</span>&nbsp;if&nbsp;<span id="ast-25" class="other_trans">obj</span>&nbsp;else&nbsp;<span id="ast-27" class="ref_node">ERROR_STATUS_CODE&nbsp;&rarr;&nbsp;self.&nbsp;</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">obj</span><span id="ast-31" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-32" class="other_trans">None</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>obj</span>&nbsp;=&nbsp;<span id="ast-35">{<span id="ast-36"><span id="ast-37">self</span>.ERROR</span>:&nbsp;<span id="ast-38" class="other_trans">error_message</span>}</span></span></span><span id="ast-39"><span id="ast-40" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-46" class="other_trans">obj</span>&nbsp;if&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">isinstance</span>(<span id="ast-44" class="other_trans">obj</span>,&nbsp;<span id="ast-45" class="other_trans">str</span>)</span>&nbsp;else&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">dump_mongo_json</span>(<span id="ast-49" class="other_trans">obj</span>)</span></span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._add_cors_headers</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;tokenize_xhpy(<span id="ast-2"><span id="ast-3" class="other_trans">program</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-5">(<span id="ast-6" class="other_trans">id</span>,&nbsp;<span id="ast-7" class="other_trans">value</span>,&nbsp;<span id="ast-8" class="other_trans">start</span>,&nbsp;<span id="ast-9" class="other_trans">end</span>,&nbsp;<span id="ast-10" class="other_trans">type</span>)</span>&nbsp;in&nbsp;<span id="ast-11"><span id="ast-12">tokenize_python</span>(<span id="ast-13" class="other_trans">program</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">id</span><span id="ast-17" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-18">'(name)'</span>)</span>:<span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>symbol</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans">symbol_table</span>.get</span>(<span id="ast-24">value</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26" class="other_trans">symbol</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">symbol</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>symbol</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">symbol_table</span>[<span id="ast-35"><span id="ast-36">id</span></span>]</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40">symbol</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-42">(<span id="ast-43">id</span><span id="ast-44" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-45">'(operator)'</span>)</span>:<span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>symbol</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50">symbol_table</span>.get</span>(<span id="ast-51" class="other_trans">value</span>)</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-54">not</span>&nbsp;<span id="ast-55">symbol</span>)</span>:<span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-57"><span id="ast-58">XHPySyntaxError</span>(<span id="ast-59">(<span id="ast-60">'Unknown&nbsp;operator&nbsp;(%r)'</span>&nbsp;%&nbsp;<span id="ast-62" class="ref_node">id&nbsp;&rarr;&nbsp;value&nbsp;</span>)</span>)</span></span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66">symbol</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>symbol</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70">symbol_table</span>[<span id="ast-71"><span id="ast-72" class="incorrect_node">id&nbsp;&rarr;&nbsp;value&nbsp;</span></span>]</span></span><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76" class="other_trans">symbol</span>()</span></span></span><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>.value</span>&nbsp;=&nbsp;<span id="ast-80" class="other_trans">value</span></span><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>.start</span>&nbsp;=&nbsp;<span id="ast-84" class="other_trans">start</span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>.end</span>&nbsp;=&nbsp;<span id="ast-88" class="other_trans">end</span></span><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>.type</span>&nbsp;=&nbsp;<span id="ast-92" class="other_trans">type</span></span><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-95" class="other_trans">s</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_network_for_participant(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">participant</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7"><span id="ast-8" class="other_trans">len</span>(<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">participant</span>.nodes</span>(failed=<span id="ast-13">'all'</span>)</span>)</span><span id="ast-14" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-15"><span id="ast-16">self</span>.trials_per_participant</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">random</span>.choice</span>(<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.networks</span>()</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-25" class="other_trans">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_write_segment_data(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">i</span>,&nbsp;<span id="ast-5" class="other_trans">j</span>,&nbsp;<span id="ast-6" class="other_trans">f_sfr</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cols</span>&nbsp;=&nbsp;<span id="ast-9">[<span id="ast-10">'nseg'</span>,&nbsp;<span id="ast-11">'icalc'</span>,&nbsp;<span id="ast-12">'outseg'</span>,&nbsp;<span id="ast-13">'iupseg'</span>,&nbsp;<span id="ast-14">'iprior'</span>,&nbsp;<span id="ast-15">'nstrpts'</span>,&nbsp;<span id="ast-16">'flow'</span>,&nbsp;<span id="ast-17">'runoff'</span>,&nbsp;<span id="ast-18">'etsw'</span>,&nbsp;<span id="ast-19">'pptsw'</span>,&nbsp;<span id="ast-20">'roughch'</span>,&nbsp;<span id="ast-21">'roughbk'</span>,&nbsp;<span id="ast-22">'cdpth'</span>,&nbsp;<span id="ast-23">'fdpth'</span>,&nbsp;<span id="ast-24">'awdth'</span>,&nbsp;<span id="ast-25">'bwdth'</span>]</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fmts</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29">_fmt_string_list</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34">self</span>.segment_data</span>[<span id="ast-35"><span id="ast-36" class="other_trans">i</span></span>]</span>[<span id="ast-37"><span id="ast-38" class="other_trans">cols</span></span>]</span>[<span id="ast-39"><span id="ast-40" class="other_trans">j</span></span>]</span>)</span></span><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-43" class="other_trans">nseg</span>,&nbsp;<span id="ast-44" class="other_trans">icalc</span>,&nbsp;<span id="ast-45" class="other_trans">outseg</span>,&nbsp;<span id="ast-46" class="other_trans">iupseg</span>,&nbsp;<span id="ast-47" class="other_trans">iprior</span>,&nbsp;<span id="ast-48">nstrpts</span>,&nbsp;<span id="ast-49" class="other_trans">flow</span>,&nbsp;<span id="ast-50" class="other_trans">runoff</span>,&nbsp;<span id="ast-51" class="other_trans">etsw</span>,&nbsp;<span id="ast-52" class="other_trans">pptsw</span>,&nbsp;<span id="ast-53">roughch</span>,&nbsp;<span id="ast-54">roughbk</span>,&nbsp;<span id="ast-55">cdpth</span>,&nbsp;<span id="ast-56">fdpth</span>,&nbsp;<span id="ast-57" class="other_trans">awdth</span>,&nbsp;<span id="ast-58" class="other_trans">bwdth</span>)</span>&nbsp;=&nbsp;<span id="ast-59">[<span id="ast-60"><span id="ast-66">0</span>&nbsp;if&nbsp;<span id="ast-61">(<span id="ast-62" class="other_trans">v</span><span id="ast-63" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-64"><span id="ast-65">self</span>.default_value</span>)</span>&nbsp;else&nbsp;<span id="ast-67" class="other_trans">v</span></span><span id="ast-68">&nbsp;for&nbsp;<span id="ast-69" class="other_trans">v</span>&nbsp;in&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74">self</span>.segment_data</span>[<span id="ast-75"><span id="ast-76">i</span></span>]</span>[<span id="ast-77"><span id="ast-78">cols</span></span>]</span>[<span id="ast-79"><span id="ast-80" class="other_trans">j</span></span>]</span></span>]</span></span><span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f_sfr</span>.write</span>(<span id="ast-85">(<span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90">'&nbsp;'</span>.join</span>(<span id="ast-91"><span id="ast-92" class="other_trans">fmts</span>[<span id="ast-93"><span id="ast-94">0</span>:<span id="ast-95">4</span></span>]</span>)</span>.format</span>(<span id="ast-96" class="other_trans">nseg</span>,&nbsp;<span id="ast-97" class="other_trans">icalc</span>,&nbsp;<span id="ast-98" class="other_trans">outseg</span>,&nbsp;<span id="ast-99" class="other_trans">iupseg</span>)</span>&nbsp;+&nbsp;<span id="ast-101">'&nbsp;'</span>)</span>)</span></span><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-103">(<span id="ast-104" class="other_trans">iupseg</span><span id="ast-105" class="location_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;>,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-106">0</span>)</span>:<span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f_sfr</span>.write</span>(<span id="ast-111">(<span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans">fmts</span>[<span id="ast-116"><span id="ast-117">4</span></span>]</span>.format</span>(<span id="ast-118" class="other_trans">iprior</span>)</span>&nbsp;+&nbsp;<span id="ast-120">'&nbsp;'</span>)</span>)</span></span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122">(<span id="ast-123" class="other_trans">icalc</span><span id="ast-124" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-125">4</span>)</span>:<span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f_sfr</span>.write</span>(<span id="ast-130">(<span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134">fmts</span>[<span id="ast-135"><span id="ast-136">5</span></span>]</span>.format</span>(<span id="ast-137" class="other_trans">nstrpts</span>)</span>&nbsp;+&nbsp;<span id="ast-139">'&nbsp;'</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_transform_object(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">obj</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>classification</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">obj</span>[<span id="ast-9"><span id="ast-10">'classification'</span></span>]</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">classification</span><span id="ast-14" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-15">'dns'</span>)</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">errors</span>.IgnoreObject</span>(<span id="ast-20" class="other_trans">classification</span>)</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24">int</span>(<span id="ast-25"><span id="ast-26" class="other_trans">obj</span>[<span id="ast-27"><span id="ast-28">'success'</span></span>]</span>)</span><span id="ast-29" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-30">1</span>)</span>:<span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34">errors</span>.IgnoreObject</span>(<span id="ast-35">'Not&nbsp;a&nbsp;DNS&nbsp;resposne'</span>)</span></span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>zout</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39" class="incorrect_node">ZMapTransformOutput&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43">dict</span>()</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-47"><span id="ast-48">'supports'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-49">True</span></span><span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>errors_present</span>&nbsp;=&nbsp;<span id="ast-52">False</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54">(<span id="ast-55"><span id="ast-56" class="other_trans">obj</span>[<span id="ast-57"><span id="ast-58">'dns_parse_err'</span></span>]</span><span id="ast-59" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-60">True</span>)</span>:<span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>errors_present</span>&nbsp;=&nbsp;<span id="ast-63">True</span></span></span><span id="ast-64"><span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-67"><span id="ast-68">'questions'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-69">[]</span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-71" class="other_trans">question</span>&nbsp;in&nbsp;<span id="ast-72"><span id="ast-73" class="other_trans">obj</span>[<span id="ast-74"><span id="ast-75">'dns_questions'</span></span>]</span>:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>q</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79">dict</span>()</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>q</span>[<span id="ast-83"><span id="ast-84">'name'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-85"><span id="ast-86">question</span>[<span id="ast-87"><span id="ast-88">'name'</span></span>]</span></span><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>q</span>[<span id="ast-92"><span id="ast-93">'type'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-94"><span id="ast-95" class="other_trans">question</span>[<span id="ast-96"><span id="ast-97">'qtype_str'</span></span>]</span></span><span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101"><span id="ast-102" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-103"><span id="ast-104">'questions'</span></span>]</span>.append</span>(<span id="ast-105">q</span>)</span></span></span><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response_types</span>&nbsp;=&nbsp;<span id="ast-108">(<span id="ast-109">(<span id="ast-110">'answers'</span>,&nbsp;<span id="ast-111">'dns_answers'</span>)</span>,&nbsp;<span id="ast-112">(<span id="ast-113">'authorities'</span>,&nbsp;<span id="ast-114">'dns_authorities'</span>)</span>,&nbsp;<span id="ast-115">(<span id="ast-116">'additionals'</span>,&nbsp;<span id="ast-117">'dns_additionals'</span>)</span>)</span></span><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-119">(<span id="ast-120">out_field</span>,&nbsp;<span id="ast-121" class="other_trans">obj_field</span>)</span>&nbsp;in&nbsp;<span id="ast-122" class="other_trans">response_types</span>:<span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-125" class="other_trans">response_errors</span>,&nbsp;<span id="ast-126">responses</span>)</span>&nbsp;=&nbsp;<span id="ast-127"><span id="ast-128"><span id="ast-129">self</span>._transform_responses</span>(<span id="ast-130"><span id="ast-131" class="other_trans">obj</span>[<span id="ast-132"><span id="ast-133">obj_field</span></span>]</span>)</span></span><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-135">response_errors</span>:<span id="ast-136"><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>errors_present</span>&nbsp;=&nbsp;<span id="ast-138">True</span></span></span><span id="ast-139"><span id="ast-140"><span id="ast-141"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-142"><span id="ast-143">out_field</span></span>]</span>&nbsp;=&nbsp;<span id="ast-144" class="other_trans">responses</span></span></span><span id="ast-145"><span id="ast-146"><span id="ast-147" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-148"><span id="ast-149">'errors'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-150" class="other_trans">errors_present</span></span><span id="ast-151"><span id="ast-152"><span id="ast-153" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-154"><span id="ast-155">'open_resolver'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-156"><span id="ast-157" class="other_trans">bool</span>(<span id="ast-158">(<span id="ast-159">(<span id="ast-160"><span id="ast-161">len</span>(<span id="ast-162"><span id="ast-163">out</span>[<span id="ast-164"><span id="ast-165">'answers'</span></span>]</span>)</span>&nbsp;+&nbsp;<span id="ast-167"><span id="ast-168" class="other_trans">len</span>(<span id="ast-169"><span id="ast-170">out</span>[<span id="ast-171"><span id="ast-172">'additionals'</span></span>]</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-174"><span id="ast-175">len</span>(<span id="ast-176"><span id="ast-177" class="other_trans">out</span>[<span id="ast-178"><span id="ast-179">'authorities'</span></span>]</span>)</span>)</span>)</span></span><span id="ast-180"><span id="ast-181"><span id="ast-182"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-183"><span id="ast-184">'resolves_correctly'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-185">False</span></span><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-187">answer</span>&nbsp;in&nbsp;<span id="ast-188"><span id="ast-189" class="other_trans">out</span>[<span id="ast-190"><span id="ast-191">'answers'</span></span>]</span>:<span id="ast-192"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-193">(<span id="ast-195">(<span id="ast-196"><span id="ast-197" class="other_trans">answer</span>[<span id="ast-198"><span id="ast-199">'type'</span></span>]</span><span id="ast-200" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-201">'A'</span>)</span>&nbsp;and&nbsp;<span id="ast-202">(<span id="ast-203"><span id="ast-204" class="other_trans">answer</span>[<span id="ast-205"><span id="ast-206">'response'</span></span>]</span><span id="ast-207" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-208" class="ref_node">CORRECT_RESPONSE&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span>:<span id="ast-209"><span id="ast-210"><span id="ast-211" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>[<span id="ast-212"><span id="ast-213">'resolves_correctly'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-214">True</span></span><span id="ast-215"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;check_created(<span id="ast-2"><span id="ast-3" class="other_trans">created</span>,&nbsp;*required</span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Checks&nbsp;the&nbsp;given&nbsp;models&nbsp;were&nbsp;created&nbsp;inside&nbsp;a&nbsp;``post_syncdb``\\u000a&nbsp;&nbsp;&nbsp;&nbsp;signal&nbsp;for&nbsp;Django&nbsp;1.6&nbsp;or&nbsp;lower,&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;install&nbsp;initial\\u000a&nbsp;&nbsp;&nbsp;&nbsp;data.&nbsp;For&nbsp;Django&nbsp;1.7&nbsp;and&nbsp;greater,&nbsp;this&nbsp;can&nbsp;always&nbsp;retrun&nbsp;True.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-7">(<span id="ast-9">(<span id="ast-10" class="other_trans">VERSION</span><span id="ast-11" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-12">(<span id="ast-13">1</span>,&nbsp;<span id="ast-14">7</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">set</span>(<span id="ast-19" class="other_trans">required</span>)</span>.issubset</span>(<span id="ast-20"><span id="ast-21" class="other_trans">set</span>(<span id="ast-22" class="other_trans">created</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_get_time(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">hour</span>,&nbsp;<span id="ast-5" class="other_trans">min</span>,&nbsp;<span id="ast-6" class="other_trans">sec</span>,&nbsp;<span id="ast-7" class="other_trans">secfr</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10" class="other_trans">secfr</span><span id="ast-11" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-12" class="other_trans">None</span>)</span>:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>secfr</span>&nbsp;=&nbsp;<span id="ast-15">'0'</span></span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>&nbsp;=&nbsp;<span id="ast-18">(<span id="ast-19">(<span id="ast-20">(<span id="ast-21">(<span id="ast-22">(<span id="ast-23">(<span id="ast-24"><span id="ast-25" class="other_trans">int</span>(<span id="ast-26" class="other_trans">hour</span>)</span>&nbsp;*&nbsp;<span id="ast-28">60</span>)</span>&nbsp;*&nbsp;<span id="ast-30">60</span>)</span>&nbsp;+&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">int</span>(<span id="ast-35" class="other_trans">min</span>)</span>&nbsp;*&nbsp;<span id="ast-37">60</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-39"><span id="ast-40">int</span>(<span id="ast-41" class="other_trans">sec</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">float</span>(<span id="ast-45">(<span id="ast-46">'.'</span>&nbsp;+&nbsp;<span id="ast-48" class="other_trans">secfr</span>)</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-50">1000</span>)</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52">(<span id="ast-53" class="other_trans">res</span><span id="ast-54" class="location_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-55"><span id="ast-56" class="other_trans">utils</span>.UNSYNCED_TIME_ONE_HOUR_DIGIT</span>)</span>:<span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>&nbsp;=&nbsp;<span id="ast-59" class="other_trans">None</span></span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-61" class="other_trans">res</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;possible_actions(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">player</span>,&nbsp;<span id="ast-5">players</span>,&nbsp;<span id="ast-6" class="other_trans">cur_bet</span>,&nbsp;<span id="ast-7" class="other_trans">min_bet</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-11"><span id="ast-12" class="other_trans">player</span>.blind</span>&nbsp;and&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15" class="other_trans">player</span>.blind</span><span id="ast-16" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-17" class="other_trans">cur_bet</span>)</span>)</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-20">{<span id="ast-21">'check'</span>:&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">player</span>.blind</span>}</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-26"><span id="ast-27" class="other_trans">player</span>.stack</span><span id="ast-28" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-29">min_bet</span>)</span>:<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>[<span id="ast-33"><span id="ast-34">'raise'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37" class="other_trans">player</span>.blind</span>&nbsp;+&nbsp;<span id="ast-39">min_bet</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>[<span id="ast-43"><span id="ast-44">'allin'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-45">(<span id="ast-46"><span id="ast-47" class="other_trans">player</span>.blind</span>&nbsp;+&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">player</span>.stack</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-52">cur_bet</span>:<span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>allin_amount</span>&nbsp;=&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">player</span>.table_chips</span>()</span>&nbsp;+&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">player</span>.stack</span>)</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63">(<span id="ast-64" class="other_trans">cur_bet</span><span id="ast-65" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-66" class="other_trans">allin_amount</span>)</span>:<span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-69">{<span id="ast-70">'allin'</span>:&nbsp;<span id="ast-71" class="other_trans">allin_amount</span>}</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-74">{<span id="ast-75">'call'</span>:&nbsp;<span id="ast-76" class="other_trans">cur_bet</span>}</span></span><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>active_players</span>&nbsp;=&nbsp;<span id="ast-79">[<span id="ast-80" class="other_trans">pl</span><span id="ast-81">&nbsp;for&nbsp;<span id="ast-82">pl</span>&nbsp;in&nbsp;<span id="ast-83">players</span>&nbsp;if&nbsp;<span id="ast-84">(<span id="ast-86">(<span id="ast-87">not</span>&nbsp;<span id="ast-88"><span id="ast-89" class="other_trans">pl</span>.allin</span>)</span>&nbsp;and&nbsp;<span id="ast-90">(<span id="ast-91">not</span>&nbsp;<span id="ast-92"><span id="ast-93">pl</span>.folded</span>)</span>)</span></span>]</span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95">(<span id="ast-96"><span id="ast-97">len</span>(<span id="ast-98">active_players</span>)</span><span id="ast-99" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-100">1</span>)</span>:<span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise_amount</span>&nbsp;=&nbsp;<span id="ast-103">(<span id="ast-104" class="other_trans">cur_bet</span>&nbsp;+&nbsp;<span id="ast-106" class="other_trans">min_bet</span>)</span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-108">(<span id="ast-109" class="other_trans">raise_amount</span><span id="ast-110" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-111">(<span id="ast-112" class="other_trans">min_bet</span>&nbsp;*&nbsp;<span id="ast-114">4</span>)</span>)</span>:<span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-116">(<span id="ast-117" class="other_trans">raise_amount</span><span id="ast-118" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-119">allin_amount</span>)</span>:<span id="ast-120"><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>[<span id="ast-123"><span id="ast-124">'allin'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-125" class="other_trans">allin_amount</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-126"><span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>[<span id="ast-129"><span id="ast-130">'raise'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-131" class="other_trans">raise_amount</span></span></span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-134">{<span id="ast-135">'check'</span>:&nbsp;<span id="ast-136">0</span>}</span></span><span id="ast-137"><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>allin_amount</span>&nbsp;=&nbsp;<span id="ast-139">(<span id="ast-140"><span id="ast-141"><span id="ast-142" class="other_trans">player</span>.table_chips</span>()</span>&nbsp;+&nbsp;<span id="ast-144"><span id="ast-145" class="other_trans">player</span>.stack</span>)</span></span><span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-147">(<span id="ast-148">min_bet</span><span id="ast-149" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-150">allin_amount</span>)</span>:<span id="ast-151"><span id="ast-152"><span id="ast-153" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>[<span id="ast-154"><span id="ast-155">'allin'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-156" class="other_trans">allin_amount</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-157"><span id="ast-158"><span id="ast-159" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>[<span id="ast-160"><span id="ast-161">'bet'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-162" class="other_trans">min_bet</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;from_hosts(<span id="ast-2"><span id="ast-3">cls</span>,&nbsp;<span id="ast-4" class="other_trans">ssh_info</span>,&nbsp;<span id="ast-5" class="other_trans">ssh_key_path</span>,&nbsp;<span id="ast-6" class="other_trans">hosts</span>,&nbsp;<span id="ast-7" class="other_trans">num_masters</span>,&nbsp;<span id="ast-8" class="other_trans">num_agents</span>,&nbsp;<span id="ast-9" class="other_trans">num_public_agents</span></span>):<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">all</span>(<span id="ast-13">(<span id="ast-14">(<span id="ast-15" class="other_trans">x</span><span id="ast-16" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-17">0</span>)</span><span id="ast-18">&nbsp;for&nbsp;<span id="ast-19" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-20">[<span id="ast-21" class="other_trans">num_masters</span>,&nbsp;<span id="ast-22" class="other_trans">num_agents</span>,&nbsp;<span id="ast-23" class="other_trans">num_public_agents</span>]</span></span>)</span>)</span>,&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26">'num_masters,&nbsp;num_agents,&nbsp;and&nbsp;num_public_agents&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;greater.&nbsp;num_masters:&nbsp;{num_masters},&nbsp;num_agents:&nbsp;{num_agents},&nbsp;num_public_agents:&nbsp;{num_public_agents}'</span>.format</span>(num_masters=<span id="ast-28" class="other_trans">num_masters</span>,&nbsp;num_agents=<span id="ast-30" class="other_trans">num_agents</span>,&nbsp;num_public_agents=<span id="ast-32" class="other_trans">num_public_agents</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36" class="other_trans">len</span>(<span id="ast-37" class="other_trans">hosts</span>)</span><span id="ast-38" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39">(<span id="ast-40">(<span id="ast-41">(<span id="ast-42" class="other_trans">num_masters</span>&nbsp;+&nbsp;<span id="ast-44" class="other_trans">num_agents</span>)</span>&nbsp;+&nbsp;<span id="ast-46" class="other_trans">num_public_agents</span>)</span>&nbsp;+&nbsp;<span id="ast-48">1</span>)</span>)</span>,&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">'Number&nbsp;of&nbsp;hosts&nbsp;must&nbsp;be&nbsp;equal&nbsp;to&nbsp;sum&nbsp;of&nbsp;masters&nbsp;and&nbsp;agents&nbsp;plus&nbsp;the&nbsp;bootstrap&nbsp;host.num_masters:&nbsp;{num_masters},&nbsp;num_agents:&nbsp;{num_agents},&nbsp;num_public_agents:&nbsp;{num_public_agents},&nbsp;hosts:&nbsp;{hosts}'</span>.format</span>(num_masters=<span id="ast-53" class="other_trans">num_masters</span>,&nbsp;num_agents=<span id="ast-55" class="other_trans">num_agents</span>,&nbsp;num_public_agents=<span id="ast-57" class="other_trans">num_public_agents</span>,&nbsp;hosts=<span id="ast-59"><span id="ast-60" class="other_trans">repr</span>(<span id="ast-61" class="other_trans">hosts</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;onvm_coremask(<span id="ast-2"></span>):<span id="ast-3"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>global&nbsp;onvm_mgr_hex_coremask</span><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>global&nbsp;onvm_mgr_bin_coremask</span><span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>num_mgr_thread</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">args</span>.mgr</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>const_mgr_thread</span>&nbsp;=&nbsp;<span id="ast-11">3</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>total_mgr_thread</span>&nbsp;=&nbsp;<span id="ast-14">(<span id="ast-15" class="other_trans">const_mgr_thread</span>&nbsp;+&nbsp;<span id="ast-17" class="other_trans">num_mgr_thread</span>)</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rem_cores</span>&nbsp;=&nbsp;<span id="ast-20">(<span id="ast-21"><span id="ast-22">len</span>(<span id="ast-23" class="other_trans">cores</span>)</span>&nbsp;-&nbsp;<span id="ast-25" class="other_trans">total_mgr_thread</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">num_mgr_thread</span><span id="ast-29" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-30">0</span>)</span>:<span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-32">'ERROR:&nbsp;You&nbsp;cannot&nbsp;run&nbsp;the&nbsp;manager&nbsp;with&nbsp;less&nbsp;than&nbsp;0&nbsp;TX&nbsp;threads&nbsp;for&nbsp;NFs'</span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.print_help</span>()</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-38">SystemExit</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">num_mgr_thread</span><span id="ast-42" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-43" class="other_trans">rem_cores</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-45">(<span id="ast-46">'ERROR&nbsp;You&nbsp;cannot&nbsp;associate&nbsp;%d&nbsp;cores&nbsp;to&nbsp;the&nbsp;manager.&nbsp;&nbsp;You&nbsp;will&nbsp;leave&nbsp;0&nbsp;cores&nbsp;to&nbsp;run&nbsp;the&nbsp;NFs'</span>&nbsp;%&nbsp;<span id="ast-48" class="other_trans">num_mgr_thread</span>)</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.print_help</span>()</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-54" class="other_trans">SystemExit</span></span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>onvm_mgr_bin_coremask</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">list</span>(<span id="ast-59">(<span id="ast-60">'0'</span>&nbsp;*&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">len</span>(<span id="ast-64">cores</span>)</span>)</span>)</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-66" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-67"><span id="ast-68">range</span>(<span id="ast-69">(<span id="ast-70"><span id="ast-71">len</span>(<span id="ast-72" class="other_trans">cores</span>)</span>&nbsp;-&nbsp;<span id="ast-74">1</span>)</span>,&nbsp;<span id="ast-75">(<span id="ast-76">(<span id="ast-77"><span id="ast-78">len</span>(<span id="ast-79">cores</span>)</span>&nbsp;-&nbsp;<span id="ast-81">1</span>)</span>&nbsp;-&nbsp;<span id="ast-83" class="other_trans">total_mgr_thread</span>)</span>,&nbsp;<span id="ast-84">-1</span>)</span>:<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>onvm_mgr_bin_coremask</span>[<span id="ast-88"><span id="ast-89">i</span></span>]</span>&nbsp;=&nbsp;<span id="ast-90">'1'</span></span></span><span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>nf_id</span>&nbsp;=&nbsp;<span id="ast-93">0</span></span><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_cpu</span>&nbsp;=&nbsp;<span id="ast-96">0</span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-98">(<span id="ast-99" class="other_trans">rem_cores</span><span id="ast-100" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-101">0</span>)</span>:<span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-103">(<span id="ast-104">rem_cores</span><span id="ast-105" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-106">3</span>)</span>:<span id="ast-107"><span id="ast-108" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nf_core_mask</span>&nbsp;=&nbsp;<span id="ast-109"><span id="ast-110" class="other_trans">list</span>(<span id="ast-111">(<span id="ast-112">'0'</span>&nbsp;*&nbsp;<span id="ast-114"><span id="ast-115" class="other_trans">len</span>(<span id="ast-116" class="other_trans">cores</span>)</span>)</span>)</span></span><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nf_core_mask2</span>&nbsp;=&nbsp;<span id="ast-119"><span id="ast-120" class="other_trans">list</span>(<span id="ast-121">(<span id="ast-122">'0'</span>&nbsp;*&nbsp;<span id="ast-124"><span id="ast-125">len</span>(<span id="ast-126">cores</span>)</span>)</span>)</span></span><span id="ast-127"><span id="ast-128"><span id="ast-129" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nf_core_mask</span>[<span id="ast-130"><span id="ast-131" class="other_trans">current_cpu</span></span>]</span>&nbsp;=&nbsp;<span id="ast-132">'1'</span></span><span id="ast-133"><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nf_core_mask2</span>[<span id="ast-136"><span id="ast-137">(<span id="ast-138" class="other_trans">current_cpu</span>&nbsp;+&nbsp;<span id="ast-140">1</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-141">'1'</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;build_graph_from_watershed(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">allow_shared_boundaries</span>,&nbsp;<span id="ast-6" class="other_trans">idxs</span>,&nbsp;<span id="ast-8" class="other_trans">nozerosfast</span></span>):<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11" class="other_trans">nozerosfast</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-13"><span id="ast-14" class="correct_node">build_graph_from_watershed_nozerosfast&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-15" class="other_trans">idxs</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;send_sms(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">receiver</span>,&nbsp;<span id="ast-5" class="other_trans">template_id</span>,&nbsp;<span id="ast-6" class="other_trans">content</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Send&nbsp;SMS&nbsp;through&nbsp;ChinaTelecom&nbsp;Plateform\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;receiver:&nbsp;str|unicode\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;receiver:&nbsp;the&nbsp;telephone&nbsp;number.&nbsp;Example:&nbsp;"18217511111"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;template_id:&nbsp;constant&nbsp;integer\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;template_id:&nbsp;the&nbsp;id&nbsp;of&nbsp;sms-template.&nbsp;Example:&nbsp;SMS_CHINATELECOM_TEMPLATE.DEFAULT\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;content:&nbsp;dict\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;content:&nbsp;the&nbsp;content&nbsp;of&nbsp;SMS&nbsp;to&nbsp;replace&nbsp;slots&nbsp;in&nbsp;sms-template.&nbsp;Example:&nbsp;{"param1":"1849"}\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:rtype&nbsp;boolean\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:return&nbsp;True&nbsp;if&nbsp;SMS&nbsp;sends&nbsp;successfully.&nbsp;False&nbsp;if&nbsp;fails&nbsp;to&nbsp;send.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11">not</span>&nbsp;<span id="ast-12"><span id="ast-13">self</span>.available</span>)</span>:<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-18"><span id="ast-19">self</span>.error_message</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-21">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-23">(<span id="ast-25">(<span id="ast-26">not</span>&nbsp;<span id="ast-27"><span id="ast-28">self</span>.access_token_expiration_time</span>)</span>&nbsp;or&nbsp;<span id="ast-29">(<span id="ast-30"><span id="ast-31">self</span>.access_token_expiration_time</span><span id="ast-32" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-33"><span id="ast-34" class="other_trans">get_now</span>()</span>)</span>)</span>:<span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37">not</span>&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">self</span>.__get_access_token</span>()</span>)</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-42">False</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;image(<span id="ast-2"><span id="ast-3" class="other_trans">request</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"/&lt;issue&gt;/content/&lt;patchset&gt;/&lt;patch&gt;/&lt;content&gt;&nbsp;-&nbsp;Return&nbsp;patch's&nbsp;content."</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">HttpResponse</span>(<span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">request</span>.content</span>.data</span>,&nbsp;content_type=<span id="ast-14"><span id="ast-15" class="other_trans">request</span>.mime_type</span>)</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">re</span>.sub</span>(<span id="ast-21">'[^\\\\w\\\\.]'</span>,&nbsp;<span id="ast-22">'_'</span>,&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="correct_node">response&nbsp;&rarr;&nbsp;request&nbsp;</span>.patch</span>.filename</span>.encode</span>(<span id="ast-28">'ascii'</span>,&nbsp;<span id="ast-29">'replace'</span>)</span>)</span></span><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>[<span id="ast-33"><span id="ast-34">'Content-Disposition'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-35">(<span id="ast-36">'attachment;&nbsp;filename="%s"'</span>&nbsp;%&nbsp;<span id="ast-38" class="other_trans">filename</span>)</span></span><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>[<span id="ast-42"><span id="ast-43">'Cache-Control'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-44">'no-cache,&nbsp;no-store'</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46" class="other_trans">response</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-5">response</span>&nbsp;in&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>.cache</span>.get_responses</span>()</span>:<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.add_header</span>(<span id="ast-14" class="other_trans">response</span>)</span></span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">hdr</span>,&nbsp;<span id="ast-18" class="other_trans">val</span>,&nbsp;<span id="ast-19">url</span>)</span>&nbsp;in&nbsp;<span id="ast-20"><span id="ast-21">self</span>.headers</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24">hdr</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26">'Server'</span>)</span>:<span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-29">os</span>,&nbsp;<span id="ast-30">line</span>)</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>.split_server_line</span>(<span id="ast-34">val</span>)</span></span><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>&nbsp;=&nbsp;<span id="ast-37">[]</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-39" class="other_trans">part</span>&nbsp;in&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">line</span>.split</span>(<span id="ast-43">'&nbsp;'</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-47">pkg</span>,&nbsp;<span id="ast-48">version</span>)</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">part</span>.split</span>(<span id="ast-52">'/'</span>)</span></span><span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.add</span>(<span id="ast-58">{<span id="ast-59" class="other_trans">url</span>:&nbsp;<span id="ast-60">{<span id="ast-61">pkg</span>:&nbsp;<span id="ast-62">[<span id="ast-63" class="other_trans">version</span>]</span>}</span>}</span>)</span></span><span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>.add</span>(<span id="ast-69"><span id="ast-70">self</span>.category</span>,&nbsp;<span id="ast-71" class="other_trans">pkg</span>,&nbsp;<span id="ast-72">{<span id="ast-73">'version'</span>:&nbsp;<span id="ast-75">version</span>,&nbsp;<span id="ast-74">'count'</span>:&nbsp;<span id="ast-76">1</span>}</span>,&nbsp;<span id="ast-77">False</span>)</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-79">Exception</span>&nbsp;as&nbsp;<span id="ast-80">e</span>:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-83">(<span id="ast-84" class="other_trans">hdr</span><span id="ast-85" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-86">'X-Powered-By'</span>)</span>:<span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vals</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91">val</span>.split</span>(<span id="ast-92">'/'</span>)</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-94">(<span id="ast-95"><span id="ast-96" class="other_trans">len</span>(<span id="ast-97">vals</span>)</span><span id="ast-98" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-99">2</span>)</span>:<span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-102" class="other_trans">pkg</span>,&nbsp;<span id="ast-103">version</span>)</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105"><span id="ast-106">val</span>.split</span>(<span id="ast-107">'/'</span>)</span></span><span id="ast-108"><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-110">1</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-111"><span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-113" class="other_trans">pkg</span>,&nbsp;<span id="ast-114" class="other_trans">version</span>,&nbsp;<span id="ast-115" class="other_trans">count</span>)</span>&nbsp;=&nbsp;<span id="ast-116">(<span id="ast-117">val</span>,&nbsp;<span id="ast-118">''</span>,&nbsp;<span id="ast-119">0.1</span>)</span></span></span><span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.add</span>(<span id="ast-125">{<span id="ast-126">url</span>:&nbsp;<span id="ast-127">{<span id="ast-128">pkg</span>:&nbsp;<span id="ast-129">[<span id="ast-130" class="incorrect_node">version&nbsp;&rarr;&nbsp;count&nbsp;</span>]</span>}</span>}</span>)</span></span><span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>.add</span>(<span id="ast-136"><span id="ast-137">self</span>.category</span>,&nbsp;<span id="ast-138" class="other_trans">pkg</span>,&nbsp;<span id="ast-139">{<span id="ast-140">'version'</span>:&nbsp;<span id="ast-142" class="other_trans">version</span>,&nbsp;<span id="ast-141">'count'</span>:&nbsp;<span id="ast-143" class="other_trans">count</span>}</span>,&nbsp;<span id="ast-144">False</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-146">(<span id="ast-147" class="other_trans">hdr</span><span id="ast-148" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-149">'X-AspNet-Version'</span>)</span>:<span id="ast-150"><span id="ast-151" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pkg</span>&nbsp;=&nbsp;<span id="ast-152">'ASP.NET'</span></span><span id="ast-153"><span id="ast-154" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version</span>&nbsp;=&nbsp;<span id="ast-155" class="other_trans">val</span></span><span id="ast-156"><span id="ast-157"><span id="ast-158"><span id="ast-159"><span id="ast-160"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.add</span>(<span id="ast-161">{<span id="ast-162">url</span>:&nbsp;<span id="ast-163">{<span id="ast-164" class="other_trans">pkg</span>:&nbsp;<span id="ast-165">[<span id="ast-166" class="other_trans">version</span>]</span>}</span>}</span>)</span></span><span id="ast-167"><span id="ast-168"><span id="ast-169"><span id="ast-170"><span id="ast-171"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>.add</span>(<span id="ast-172"><span id="ast-173">self</span>.category</span>,&nbsp;<span id="ast-174" class="other_trans">pkg</span>,&nbsp;<span id="ast-175">{<span id="ast-176">'version'</span>:&nbsp;<span id="ast-178" class="other_trans">version</span>,&nbsp;<span id="ast-177">'count'</span>:&nbsp;<span id="ast-179">1</span>}</span>,&nbsp;<span id="ast-180">False</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-182">(<span id="ast-183">hdr</span><span id="ast-184" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-185">'Set-Cookie'</span>)</span>:<span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-187">(<span id="ast-188">'ASP.NET_SessionId'</span><span id="ast-189">&nbsp;in&nbsp;</span><span id="ast-190" class="ref_node">line&nbsp;&rarr;&nbsp;val&nbsp;</span>)</span>:<span id="ast-191"><span id="ast-192" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pkg</span>&nbsp;=&nbsp;<span id="ast-193">'ASP.NET'</span></span><span id="ast-194"><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version</span>&nbsp;=&nbsp;<span id="ast-196">''</span></span><span id="ast-197"><span id="ast-198"><span id="ast-199"><span id="ast-200"><span id="ast-201"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.add</span>(<span id="ast-202">{<span id="ast-203">url</span>:&nbsp;<span id="ast-204">{<span id="ast-205" class="other_trans">pkg</span>:&nbsp;<span id="ast-206">[<span id="ast-207" class="other_trans">version</span>]</span>}</span>}</span>)</span></span><span id="ast-208"><span id="ast-209"><span id="ast-210"><span id="ast-211"><span id="ast-212"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>.add</span>(<span id="ast-213"><span id="ast-214">self</span>.category</span>,&nbsp;<span id="ast-215" class="other_trans">pkg</span>,&nbsp;<span id="ast-216">{<span id="ast-217">'version'</span>:&nbsp;<span id="ast-219" class="other_trans">version</span>,&nbsp;<span id="ast-218">'count'</span>:&nbsp;<span id="ast-220">0.1</span>}</span>,&nbsp;<span id="ast-221">False</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;blockchain_certify(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5"><span id="ast-6">self</span>.tx</span>:<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-8">{<span id="ast-9">'success'</span>:&nbsp;<span id="ast-11">False</span>,&nbsp;<span id="ast-10">'error'</span>:&nbsp;<span id="ast-12">'already&nbsp;certified'</span>}</span></span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-15" class="other_trans">txid</span>,&nbsp;<span id="ast-16" class="other_trans">message</span>)</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">publish_data</span>(<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22">self</span>.digest</span>.decode</span>(<span id="ast-23">'hex'</span>)</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25" class="other_trans">txid</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.tx</span>&nbsp;=&nbsp;<span id="ast-29" class="other_trans">txid</span></span><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.txstamp</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">datetime</span>.datetime</span>.now</span>()</span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LatestBlockchainDocuments</span>.get_inst</span>()</span>.add_document</span>(<span id="ast-43" class="correct_node">digest&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.put</span>()</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-49">{<span id="ast-50">'success'</span>:&nbsp;<span id="ast-53">(<span id="ast-54" class="other_trans">txid</span><span id="ast-55" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-56" class="other_trans">None</span>)</span>,&nbsp;<span id="ast-51">'tx'</span>:&nbsp;<span id="ast-57" class="other_trans">txid</span>,&nbsp;<span id="ast-52">'message'</span>:&nbsp;<span id="ast-58" class="other_trans">message</span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;update_mesh_to_curve(<span id="ast-2"><span id="ast-3">lw_tool</span>,&nbsp;<span id="ast-4" class="other_trans">curve_tool</span>,&nbsp;<span id="ast-5">work_verts</span>,&nbsp;<span id="ast-6">side_dir</span>,&nbsp;<span id="ast-7">side_vec_len</span>,&nbsp;<span id="ast-8">bm</span>,&nbsp;<span id="ast-9" class="other_trans">deform_type</span>,&nbsp;<span id="ast-10" class="other_trans">up_dir</span>,&nbsp;<span id="ast-11">obj</span></span>):<span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lw_tool_vec</span>&nbsp;=&nbsp;<span id="ast-14">(<span id="ast-15"><span id="ast-16"><span id="ast-17">lw_tool</span>.end_point</span>.position</span>&nbsp;-&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">lw_tool</span>.start_point</span>.position</span>)</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lw_tool_dir</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26">(<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">lw_tool</span>.end_point</span>.position</span>&nbsp;-&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">lw_tool</span>.start_point</span>.position</span>)</span>.normalized</span>()</span></span><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>points_dists</span>&nbsp;=&nbsp;<span id="ast-36">[]</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-38" class="other_trans">point</span>&nbsp;in&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">curve_tool</span>.curve_points</span>:<span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bezier_dists</span>&nbsp;=&nbsp;<span id="ast-43">[]</span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p_dist</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49">mathu</span>.geometry</span>.distance_point_to_plane</span>(<span id="ast-50"><span id="ast-51" class="other_trans">point</span>.position</span>,&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54">lw_tool</span>.start_point</span>.position</span>,&nbsp;<span id="ast-55" class="other_trans">lw_tool_dir</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57">(<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61">curve_tool</span>.curve_points</span>.index</span>(<span id="ast-62">point</span>)</span><span id="ast-63" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-64">0</span>)</span>:<span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-66">b_point</span>&nbsp;in&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">curve_tool</span>.display_bezier</span>[<span id="ast-70"><span id="ast-71"><span id="ast-72">point</span>.point_id</span></span>]</span>:<span id="ast-73"><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>b_p_dist</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78">mathu</span>.geometry</span>.distance_point_to_plane</span>(<span id="ast-79">b_point</span>,&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82">lw_tool</span>.start_point</span>.position</span>,&nbsp;<span id="ast-83" class="other_trans">lw_tool_dir</span>)</span></span><span id="ast-84"><span id="ast-85" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>b_p_side_dist&nbsp;&rarr;&nbsp;b_p_dist&nbsp;</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89">mathu</span>.geometry</span>.distance_point_to_plane</span>(<span id="ast-90">b_point</span>,&nbsp;<span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans">lw_tool</span>.start_point</span>.position</span>,&nbsp;<span id="ast-94">side_dir</span>)</span></span><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bezier_dists</span>.append</span>(<span id="ast-99">(<span id="ast-100">b_p_dist</span>,&nbsp;<span id="ast-101" class="other_trans">b_p_side_dist</span>,&nbsp;<span id="ast-102">b_point</span>)</span>)</span></span></span></span><span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>points_dists</span>.append</span>(<span id="ast-107">(<span id="ast-108" class="other_trans">p_dist</span>,&nbsp;<span id="ast-109" class="other_trans">bezier_dists</span>)</span>)</span></span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-111">vert_id</span>&nbsp;in&nbsp;<span id="ast-112"><span id="ast-113"><span id="ast-114" class="other_trans">work_verts</span>.keys</span>()</span>:<span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vert</span>&nbsp;=&nbsp;<span id="ast-117"><span id="ast-118"><span id="ast-119">bm</span>.verts</span>[<span id="ast-120"><span id="ast-121">vert_id</span></span>]</span></span><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vert_data</span>&nbsp;=&nbsp;<span id="ast-124"><span id="ast-125">work_verts</span>[<span id="ast-126"><span id="ast-127" class="other_trans">vert_id</span></span>]</span></span><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deform_dir</span>&nbsp;=&nbsp;<span id="ast-130">None</span></span><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-132">(<span id="ast-133" class="other_trans">deform_type</span><span id="ast-134" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-135">'Scale'</span>)</span>:<span id="ast-136"><span id="ast-137" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deform_dir</span>&nbsp;=&nbsp;<span id="ast-138"><span id="ast-139"><span id="ast-140">(<span id="ast-141"><span id="ast-142" class="other_trans">vert_data</span>[<span id="ast-143"><span id="ast-144">0</span></span>]</span>&nbsp;-&nbsp;<span id="ast-146">(<span id="ast-147"><span id="ast-148"><span id="ast-149" class="other_trans">lw_tool</span>.start_point</span>.position</span>&nbsp;+&nbsp;<span id="ast-151">(<span id="ast-152">lw_tool_dir</span>&nbsp;*&nbsp;<span id="ast-154"><span id="ast-155">vert_data</span>[<span id="ast-156"><span id="ast-157">1</span></span>]</span>)</span>)</span>)</span>.normalized</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-158"><span id="ast-159" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deform_dir</span>&nbsp;=&nbsp;<span id="ast-160" class="other_trans">side_dir</span></span></span><span id="ast-161"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-162">(<span id="ast-163">i</span>,&nbsp;<span id="ast-164" class="other_trans">point_data</span>)</span>&nbsp;in&nbsp;<span id="ast-165"><span id="ast-166">enumerate</span>(<span id="ast-167">points_dists</span>)</span>:<span id="ast-168"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-169">(<span id="ast-170"><span id="ast-171" class="other_trans">point_data</span>[<span id="ast-172"><span id="ast-173">0</span></span>]</span><span id="ast-174" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-175"><span id="ast-176" class="other_trans">vert_data</span>[<span id="ast-177"><span id="ast-178">1</span></span>]</span>)</span>:<span id="ast-179"><span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>best_b_len</span>&nbsp;=&nbsp;<span id="ast-181">None</span></span><span id="ast-182"><span id="ast-183"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vert_front_pos</span>&nbsp;=&nbsp;<span id="ast-184">(<span id="ast-185"><span id="ast-186"><span id="ast-187">lw_tool</span>.start_point</span>.position</span>&nbsp;+&nbsp;<span id="ast-189">(<span id="ast-190" class="other_trans">lw_tool_dir</span>&nbsp;*&nbsp;<span id="ast-192"><span id="ast-193" class="other_trans">vert_data</span>[<span id="ast-194"><span id="ast-195">1</span></span>]</span>)</span>)</span></span><span id="ast-196"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-197">(<span id="ast-198">j</span>,&nbsp;<span id="ast-199">b_point</span>)</span>&nbsp;in&nbsp;<span id="ast-200"><span id="ast-201">enumerate</span>(<span id="ast-202"><span id="ast-203" class="other_trans">point_data</span>[<span id="ast-204"><span id="ast-205">1</span></span>]</span>)</span>:<span id="ast-206"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-207">(<span id="ast-208">not</span>&nbsp;<span id="ast-209">best_b_len</span>)</span>:<span id="ast-210"><span id="ast-211"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>best_b_len</span>&nbsp;=&nbsp;<span id="ast-212"><span id="ast-213">b_point</span>[<span id="ast-214"><span id="ast-215">1</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-217">(<span id="ast-218"><span id="ast-219" class="other_trans">b_point</span>[<span id="ast-220"><span id="ast-221">0</span></span>]</span><span id="ast-222" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-223"><span id="ast-224">vert_data</span>[<span id="ast-225"><span id="ast-226">1</span></span>]</span>)</span>:<span id="ast-227"><span id="ast-228"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bp_nor</span>&nbsp;=&nbsp;<span id="ast-229"><span id="ast-230"><span id="ast-231">(<span id="ast-232"><span id="ast-233">b_point</span>[<span id="ast-234"><span id="ast-235">2</span></span>]</span>&nbsp;-&nbsp;<span id="ast-237"><span id="ast-238"><span id="ast-239"><span id="ast-240">point_data</span>[<span id="ast-241"><span id="ast-242">1</span></span>]</span>[<span id="ast-243"><span id="ast-244">(<span id="ast-245">j</span>&nbsp;-&nbsp;<span id="ast-247">1</span>)</span></span>]</span>[<span id="ast-248"><span id="ast-249">2</span></span>]</span>)</span>.normalized</span>()</span></span><span id="ast-250"><span id="ast-251"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bp_nor</span>&nbsp;=&nbsp;<span id="ast-252"><span id="ast-253"><span id="ast-254"><span id="ast-255"><span id="ast-256">bp_nor</span>.cross</span>(<span id="ast-257">up_dir</span>)</span>.normalized</span>()</span></span><span id="ast-258"><span id="ast-259" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>final_pos</span>&nbsp;=&nbsp;<span id="ast-260"><span id="ast-261"><span id="ast-262"><span id="ast-263">mathu</span>.geometry</span>.intersect_line_plane</span>(<span id="ast-264">(<span id="ast-265">vert_front_pos</span>&nbsp;-&nbsp;<span id="ast-267">(<span id="ast-268">side_dir</span>&nbsp;*&nbsp;<span id="ast-270">1000.0</span>)</span>)</span>,&nbsp;<span id="ast-271">(<span id="ast-272">vert_front_pos</span>&nbsp;+&nbsp;<span id="ast-274">(<span id="ast-275">side_dir</span>&nbsp;*&nbsp;<span id="ast-277">1000.0</span>)</span>)</span>,&nbsp;<span id="ast-278"><span id="ast-279">b_point</span>[<span id="ast-280"><span id="ast-281">2</span></span>]</span>,&nbsp;<span id="ast-282">bp_nor</span>)</span></span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__job_program(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">_job</span>,&nbsp;<span id="ast-5">reply_addr</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>program</span>&nbsp;=&nbsp;<span id="ast-8">[<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.computations</span>[<span id="ast-13"><span id="ast-14"><span id="ast-15">_job</span>.compute_id</span></span>]</span>.name</span>]</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20">cPickle</span>.loads</span>(<span id="ast-21"><span id="ast-22" class="other_trans">_job</span>.args</span>)</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>program</span>.extend</span>(<span id="ast-27">args</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-32">'Executing&nbsp;"%s"'</span>,&nbsp;<span id="ast-33"><span id="ast-34">str</span>(<span id="ast-35">program</span>)</span>)</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39">_JobReply</span>(<span id="ast-40">_job</span>,&nbsp;<span id="ast-41"><span id="ast-42">self</span>.ip_addr</span>)</span></span><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>job_info</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46">_DispyJobInfo</span>(<span id="ast-47" class="other_trans">reply</span>,&nbsp;<span id="ast-48">reply_addr</span>,&nbsp;certfile=<span id="ast-50"><span id="ast-51">self</span>.certfile</span>,&nbsp;keyfile=<span id="ast-53"><span id="ast-54">self</span>.keyfile</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lock</span>.acquire</span>()</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>job_info</span>.proc</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66">subprocess</span>.Popen</span>(<span id="ast-67">program</span>,&nbsp;stdout=<span id="ast-69"><span id="ast-70">subprocess</span>.PIPE</span>,&nbsp;stderr=<span id="ast-72"><span id="ast-73">subprocess</span>.PIPE</span>,&nbsp;env=<span id="ast-75">{<span id="ast-76">'PATH'</span>:&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82">self</span>.computations</span>[<span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">_job</span>.compute_id</span></span>]</span>.env</span>.get</span>(<span id="ast-86">'PATH'</span>)</span>}</span>)</span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-88"><span id="ast-89" class="other_trans">isinstance</span>(<span id="ast-90"><span id="ast-91" class="other_trans">job_info</span>.proc</span>,&nbsp;<span id="ast-92"><span id="ast-93">subprocess</span>.Popen</span>)</span></span><span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.job_infos</span>[<span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans">_job</span>.uid</span></span>]</span>&nbsp;=&nbsp;<span id="ast-101" class="other_trans">job_info</span></span><span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lock</span>.release</span>()</span></span><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-109"><span id="ast-110" class="other_trans">reply</span>.stdout</span>,&nbsp;<span id="ast-111"><span id="ast-112" class="other_trans">reply</span>.stderr</span>)</span>&nbsp;=&nbsp;<span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116" class="other_trans">job_info</span>.proc</span>.communicate</span>()</span></span><span id="ast-117"><span id="ast-118"><span id="ast-119" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>.result</span>&nbsp;=&nbsp;<span id="ast-120"><span id="ast-121"><span id="ast-122" class="other_trans">job_info</span>.proc</span>.returncode</span></span><span id="ast-123"><span id="ast-124"><span id="ast-125" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>.status</span>&nbsp;=&nbsp;<span id="ast-126"><span id="ast-127">DispyJob</span>.Finished</span></span><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-129" class="other_trans">Exception</span>:<span id="ast-130"><span id="ast-131"><span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.debug</span>(<span id="ast-134">'Executing&nbsp;%s&nbsp;failed&nbsp;with&nbsp;%s'</span>,&nbsp;<span id="ast-135"><span id="ast-136">str</span>(<span id="ast-137" class="other_trans">program</span>)</span>,&nbsp;<span id="ast-138"><span id="ast-139">str</span>(<span id="ast-140"><span id="ast-141"><span id="ast-142" class="other_trans">sys</span>.exc_info</span>()</span>)</span>)</span></span><span id="ast-143"><span id="ast-144"><span id="ast-145" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>.exception</span>&nbsp;=&nbsp;<span id="ast-146"><span id="ast-147"><span id="ast-148">traceback</span>.format_exc</span>()</span></span><span id="ast-149"><span id="ast-150"><span id="ast-151" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>.status</span>&nbsp;=&nbsp;<span id="ast-152"><span id="ast-153">DispyJob</span>.Terminated</span></span></span></span><span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lock</span>.acquire</span>()</span></span><span id="ast-159"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-160">(<span id="ast-161"><span id="ast-162"><span id="ast-163"><span id="ast-164">self</span>.job_infos</span>.pop</span>(<span id="ast-165"><span id="ast-166">_job</span>.uid</span>,&nbsp;<span id="ast-167" class="other_trans">None</span>)</span><span id="ast-168" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-169" class="other_trans">job_info</span>)</span>:<span id="ast-170"><span id="ast-171"><span id="ast-172"><span id="ast-173"><span id="ast-174"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lock</span>.release</span>()</span></span><span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-176"><span id="ast-177"><span id="ast-178"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.avail_cpus</span>&nbsp;+=&nbsp;<span id="ast-180">1</span></span><span id="ast-181"><span id="ast-182"><span id="ast-183"><span id="ast-184"><span id="ast-185"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lock</span>.release</span>()</span></span><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-187" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-188"><span id="ast-189" class="other_trans">_job</span>.files</span>:<span id="ast-190"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-191"><span id="ast-192"><span id="ast-193"><span id="ast-194">os</span>.path</span>.isfile</span>(<span id="ast-195" class="other_trans">f</span>)</span>:<span id="ast-196"><span id="ast-197"><span id="ast-198"><span id="ast-199"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.remove</span>(<span id="ast-200">f</span>)</span></span></span></span><span id="ast-201"><span id="ast-202"><span id="ast-203" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>_send_job_reply&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-204" class="ref_node">reply&nbsp;&rarr;&nbsp;job_info&nbsp;</span>)</span></span><span id="ast-205"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-206">(<span id="ast-207"><span id="ast-208">self</span>.avail_cpus</span><span id="ast-209" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-210"><span id="ast-211">self</span>.cpus</span>)</span>:<span id="ast-212"><span id="ast-213"><span id="ast-214"><span id="ast-215"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.send_pong_msg</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;speed_between(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">track_point</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Compute&nbsp;the&nbsp;speed&nbsp;between&nbsp;specified&nbsp;point&nbsp;and&nbsp;this&nbsp;point.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;a&nbsp;computed&nbsp;speed,&nbsp;not&nbsp;the&nbsp;GPXTrackPoint&nbsp;speed&nbsp;that&nbsp;comes\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;GPX&nbsp;file.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;track_point&nbsp;:&nbsp;GPXTrackPoint\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;speed&nbsp;:&nbsp;float\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Speed&nbsp;returned&nbsp;in&nbsp;meters/second\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9">not</span>&nbsp;<span id="ast-10" class="other_trans">track_point</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12" class="other_trans">None</span></span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>seconds</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.time_difference</span>(<span id="ast-18" class="other_trans">track_point</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>length</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.distance_3d</span>(<span id="ast-24" class="other_trans">track_point</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-27">not</span>&nbsp;<span id="ast-28" class="other_trans">length</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>length</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>.distance_2d</span>(<span id="ast-34" class="other_trans">track_point</span>)</span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-38">(<span id="ast-39">not</span>&nbsp;<span id="ast-40" class="other_trans">seconds</span>)</span>&nbsp;or&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">length</span><span id="ast-43" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-44" class="other_trans">None</span>)</span>)</span>:<span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46" class="other_trans">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test110_copy_board(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>boards</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>._trello</span>.list_boards</span>(board_filter=<span id="ast-11">'open'</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>source_board</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">next</span>(<span id="ast-16">(<span id="ast-17" class="other_trans">x</span><span id="ast-18">&nbsp;for&nbsp;<span id="ast-19" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-20">boards</span>&nbsp;if&nbsp;<span id="ast-21">(<span id="ast-22"><span id="ast-23" class="other_trans">x</span>.name</span><span id="ast-24" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-25">'test_create_board'</span>)</span></span>)</span>)</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._trello</span>.add_board</span>(<span id="ast-31">'copied_board'</span>,&nbsp;source_board=<span id="ast-33" class="other_trans">source_board</span>)</span></span><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>listed_boards</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39">self</span>._trello</span>.list_boards</span>(board_filter=<span id="ast-41">'open'</span>)</span></span><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>copied_board</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45">next</span>(<span id="ast-46"><span id="ast-47" class="other_trans">iter</span>(<span id="ast-48">[<span id="ast-49" class="other_trans">x</span><span id="ast-50">&nbsp;for&nbsp;<span id="ast-51" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-52" class="other_trans">listed_boards</span>&nbsp;if&nbsp;<span id="ast-53">(<span id="ast-54"><span id="ast-55" class="other_trans">x</span>.name</span><span id="ast-56" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-57">'copied_board'</span>)</span></span>]</span>)</span>,&nbsp;<span id="ast-58">None</span>)</span></span><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertIsNotNone</span>(<span id="ast-63" class="other_trans">copied_board</span>)</span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>open_lists</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68" class="correct_node">source_board&nbsp;&rarr;&nbsp;copied_board&nbsp;</span>.open_lists</span>()</span></span><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-73"><span id="ast-74">len</span>(<span id="ast-75" class="other_trans">open_lists</span>)</span>,&nbsp;<span id="ast-76">4</span>)</span></span><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>test_list</span>&nbsp;=&nbsp;<span id="ast-79"><span id="ast-80" class="other_trans">open_lists</span>[<span id="ast-81"><span id="ast-82">0</span></span>]</span></span><span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-87"><span id="ast-88" class="other_trans">len</span>(<span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans">test_list</span>.list_cards</span>()</span>)</span>,&nbsp;<span id="ast-92">1</span>)</span></span><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>test_card</span>&nbsp;=&nbsp;<span id="ast-95"><span id="ast-96">next</span>(<span id="ast-97"><span id="ast-98" class="other_trans">iter</span>(<span id="ast-99">[<span id="ast-100" class="other_trans">x</span><span id="ast-101">&nbsp;for&nbsp;<span id="ast-102" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans">test_list</span>.list_cards</span>()</span>&nbsp;if&nbsp;<span id="ast-106">(<span id="ast-107"><span id="ast-108" class="other_trans">x</span>.name</span><span id="ast-109" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-110">'test_card'</span>)</span></span>]</span>)</span>,&nbsp;<span id="ast-111">None</span>)</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertIsNotNone</span>(<span id="ast-116" class="other_trans">test_card</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_parent(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">ct</span>,&nbsp;<span id="ast-5" class="other_trans">response</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pid</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.kwargs</span>.get</span>(<span id="ast-12"><span id="ast-13" class="other_trans">ct</span>.identifier</span>,&nbsp;<span id="ast-14" class="other_trans">None</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17">not</span>&nbsp;<span id="ast-18" class="other_trans">pid</span>)</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pcls</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24">ct</span>.model_class</span>()</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26"><span id="ast-27">self</span>.router</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>slug</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="correct_node">router&nbsp;&rarr;&nbsp;self.&nbsp;</span>.get_lookup_for_model</span>(<span id="ast-33" class="other_trans">pcls</span>)</span></span><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">pcls</span>.objects</span>.get</span>(**<span id="ast-40">{<span id="ast-41" class="other_trans">slug</span>:&nbsp;<span id="ast-42" class="other_trans">pid</span>}</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">get_by_identifier</span>(<span id="ast-47"><span id="ast-48" class="other_trans">pcls</span>.objects</span>,&nbsp;<span id="ast-49" class="other_trans">pid</span>)</span></span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-53" class="other_trans">ct</span>.urlbase</span><span id="ast-54" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-55">''</span>)</span>:<span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>urlbase</span>&nbsp;=&nbsp;<span id="ast-58">''</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>urlbase</span>&nbsp;=&nbsp;<span id="ast-61">(<span id="ast-62"><span id="ast-63" class="other_trans">ct</span>.urlbase</span>&nbsp;+&nbsp;<span id="ast-65">'/'</span>)</span></span></span><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>objid</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69">get_object_id</span>(<span id="ast-70">parent</span>)</span></span><span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>.data</span>[<span id="ast-75"><span id="ast-76">'parent_label'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78" class="other_trans">unicode</span>(<span id="ast-79" class="other_trans">parent</span>)</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>.data</span>[<span id="ast-84"><span id="ast-85">'parent_id'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-86" class="other_trans">objid</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>.data</span>[<span id="ast-91"><span id="ast-92">'parent_url'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-93">(<span id="ast-94">'%s%s'</span>&nbsp;%&nbsp;<span id="ast-96">(<span id="ast-97">urlbase</span>,&nbsp;<span id="ast-98" class="other_trans">objid</span>)</span>)</span></span><span id="ast-99"><span id="ast-100"><span id="ast-101"><span id="ast-102" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>.data</span>[<span id="ast-103"><span id="ast-104">(<span id="ast-105">'parent_is_'</span>&nbsp;+&nbsp;<span id="ast-107"><span id="ast-108">ct</span>.identifier</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-109">True</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-111" class="other_trans">parent</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;render(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">context</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>request</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.request</span>.resolve</span>(<span id="ast-11" class="other_trans">context</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fragment</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.fragment</span>.resolve</span>(<span id="ast-18" class="other_trans">context</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">request</span>._feincms_fragments</span>[<span id="ast-25"><span id="ast-26" class="other_trans">fragment</span></span>]</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">AttributeError</span>,&nbsp;<span id="ast-30" class="other_trans">KeyError</span>)</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-33">u''</span></span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35"><span id="ast-36">self</span>.as_var</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>[<span id="ast-40"><span id="ast-41" class="correct_node">as_var&nbsp;&rarr;&nbsp;self.&nbsp;</span></span>]</span>&nbsp;=&nbsp;<span id="ast-42" class="other_trans">value</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-44">u''</span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46" class="other_trans">value</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_invoice_edit_post(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>invoice</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>.get_invoice</span>()</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12">reverse</span>(<span id="ast-13">'edit_invoice'</span>,&nbsp;args=<span id="ast-15">(<span id="ast-16"><span id="ast-17" class="other_trans">invoice</span>.id</span>)</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">invoice</span>.status</span><span id="ast-22" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-23"><span id="ast-24" class="other_trans">EntryGroup</span>.INVOICED</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>status</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28">EntryGroup</span>.INVOICED</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>status</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">EntryGroup</span>.NOT_INVOICED</span></span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>&nbsp;=&nbsp;<span id="ast-35">{<span id="ast-36">'number'</span>:&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41">int</span>(<span id="ast-42"><span id="ast-43" class="other_trans">invoice</span>.number</span>)</span>&nbsp;+&nbsp;<span id="ast-45">1</span>)</span>,&nbsp;<span id="ast-37">'status'</span>:&nbsp;<span id="ast-46" class="other_trans">status</span>,&nbsp;<span id="ast-38">'comments'</span>:&nbsp;<span id="ast-47">'Comments'</span>}</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53">self</span>.client</span>.post</span>(<span id="ast-54" class="other_trans">url</span>,&nbsp;<span id="ast-55" class="other_trans">params</span>)</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-60"><span id="ast-61" class="other_trans">response</span>.status_code</span>,&nbsp;<span id="ast-62">302</span>)</span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_invoice</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans">EntryGroup</span>.objects</span>.get</span>(pk=<span id="ast-70"><span id="ast-71" class="other_trans">invoice</span>.id</span>)</span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-76">(<span id="ast-77"><span id="ast-78" class="other_trans">int</span>(<span id="ast-79"><span id="ast-80" class="other_trans">invoice</span>.number</span>)</span>&nbsp;+&nbsp;<span id="ast-82">1</span>)</span>,&nbsp;<span id="ast-83"><span id="ast-84" class="other_trans">int</span>(<span id="ast-85"><span id="ast-86" class="other_trans">new_invoice</span>.number</span>)</span>)</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-91">(<span id="ast-92"><span id="ast-93" class="other_trans">invoice</span>.status</span><span id="ast-94" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-95"><span id="ast-96" class="other_trans">new_invoice</span>.status</span>)</span>)</span></span><span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-101"><span id="ast-102" class="other_trans">new_invoice</span>.comments</span>,&nbsp;<span id="ast-103">'Comments'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__str__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>str_</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>._to_string</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">sys</span>.version_info</span>[<span id="ast-14"><span id="ast-15">0</span></span>]</span><span id="ast-16" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;>=&nbsp;</span><span id="ast-17">2</span>)</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>str_</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">str_</span>.encode</span>(<span id="ast-23">'utf-8'</span>)</span></span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-25" class="other_trans">str_</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_assign_boxes(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">box</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6"><span id="ast-7">self</span>.fixed</span>:<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>all_stacks</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11">self</span>.stack_list</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>all_stacks</span>&nbsp;=&nbsp;<span id="ast-14">[<span id="ast-15">s</span><span id="ast-16">&nbsp;for&nbsp;<span id="ast-17">s</span>&nbsp;in&nbsp;<span id="ast-18"><span id="ast-19">self</span>.stack_list</span>&nbsp;if&nbsp;<span id="ast-20">(<span id="ast-21">not</span>&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">s</span>.empty</span>)</span></span>]</span></span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>curw</span>&nbsp;=&nbsp;<span id="ast-26">0</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28"><span id="ast-29">self</span>.vertical</span>:<span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rstart</span>,&nbsp;<span id="ast-32">start</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34">box</span>.x</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>totalpx</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">box</span>.width</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rstart</span>,&nbsp;<span id="ast-41" class="other_trans">start</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">box</span>.y</span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>totalpx</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">box</span>.height</span></span></span><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>totpx</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51">sum</span>(<span id="ast-52">(<span id="ast-53">(<span id="ast-55"><span id="ast-56" class="other_trans">s</span>.size</span>&nbsp;or&nbsp;<span id="ast-57"><span id="ast-58">s</span>.min_size</span>)</span><span id="ast-59">&nbsp;for&nbsp;<span id="ast-60" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-61" class="other_trans">all_stacks</span></span>)</span>)</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>totw</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65">sum</span>(<span id="ast-66">(<span id="ast-67"><span id="ast-68">s</span>.weight</span><span id="ast-69">&nbsp;for&nbsp;<span id="ast-70" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-71">all_stacks</span>&nbsp;if&nbsp;<span id="ast-72">(<span id="ast-73"><span id="ast-74" class="other_trans">s</span>.size</span><span id="ast-75" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-76">None</span>)</span></span>)</span>)</span></span><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>skip_pixels</span>&nbsp;=&nbsp;<span id="ast-79">(<span id="ast-81">(<span id="ast-82">totpx</span><span id="ast-83" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-84" class="other_trans">totalpx</span>)</span>&nbsp;or&nbsp;<span id="ast-85">(<span id="ast-87">(<span id="ast-88">not</span>&nbsp;<span id="ast-89">totw</span>)</span>&nbsp;and&nbsp;<span id="ast-90">(<span id="ast-91" class="other_trans">totpx</span><span id="ast-92" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-93">totalpx</span>)</span>)</span>)</span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95" class="other_trans">skip_pixels</span>:<span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>totw</span>&nbsp;=&nbsp;<span id="ast-98"><span id="ast-99" class="other_trans">sum</span>(<span id="ast-100">(<span id="ast-101"><span id="ast-102" class="other_trans">s</span>.weight</span><span id="ast-103">&nbsp;for&nbsp;<span id="ast-104">s</span>&nbsp;in&nbsp;<span id="ast-105">all_stacks</span></span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>totalpx</span>&nbsp;-=&nbsp;<span id="ast-109"><span id="ast-110">sum</span>(<span id="ast-111">(<span id="ast-112"><span id="ast-113">s</span>.size</span><span id="ast-114">&nbsp;for&nbsp;<span id="ast-115">s</span>&nbsp;in&nbsp;<span id="ast-116" class="other_trans">all_stacks</span>&nbsp;if&nbsp;<span id="ast-117">(<span id="ast-118"><span id="ast-119">s</span>.size</span><span id="ast-120" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-121" class="other_trans">None</span>)</span></span>)</span>)</span></span></span><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pxoff</span>&nbsp;=&nbsp;<span id="ast-124">0</span></span><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-126" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-127">all_stacks</span>:<span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-129">(<span id="ast-131">(<span id="ast-132"><span id="ast-133">s</span>.size</span><span id="ast-134" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-135">None</span>)</span>&nbsp;and&nbsp;<span id="ast-136">(<span id="ast-137">not</span>&nbsp;<span id="ast-138" class="other_trans">skip_pixels</span>)</span>)</span>:<span id="ast-139"><span id="ast-140" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-141">(<span id="ast-142" class="ref_node">rstart&nbsp;&rarr;&nbsp;start&nbsp;</span>&nbsp;+&nbsp;<span id="ast-144"><span id="ast-145">s</span>.size</span>)</span></span><span id="ast-146"><span id="ast-147"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pxoff</span>&nbsp;+=&nbsp;<span id="ast-149"><span id="ast-150">s</span>.size</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>curw</span>&nbsp;+=&nbsp;<span id="ast-154"><span id="ast-155">s</span>.weight</span></span><span id="ast-156"><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>end</span>&nbsp;=&nbsp;<span id="ast-158">(<span id="ast-159">(<span id="ast-160" class="other_trans">rstart</span>&nbsp;+&nbsp;<span id="ast-162">pxoff</span>)</span>&nbsp;+&nbsp;<span id="ast-164"><span id="ast-165">int</span>(<span id="ast-166"><span id="ast-167">floor</span>(<span id="ast-168">(<span id="ast-169">(<span id="ast-170" class="other_trans">curw</span>&nbsp;/&nbsp;<span id="ast-172" class="other_trans">totw</span>)</span>&nbsp;*&nbsp;<span id="ast-174">totalpx</span>)</span>)</span>)</span>)</span></span></span><span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-176"><span id="ast-177">self</span>.vertical</span>:<span id="ast-178"><span id="ast-179"><span id="ast-180" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>.box</span>&nbsp;=&nbsp;<span id="ast-181"><span id="ast-182">Rectangle</span>(<span id="ast-183" class="other_trans">start</span>,&nbsp;<span id="ast-184"><span id="ast-185">box</span>.y</span>,&nbsp;<span id="ast-186">(<span id="ast-187">end</span>&nbsp;-&nbsp;<span id="ast-189" class="other_trans">start</span>)</span>,&nbsp;<span id="ast-190"><span id="ast-191">box</span>.height</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-192"><span id="ast-193"><span id="ast-194"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>.box</span>&nbsp;=&nbsp;<span id="ast-195"><span id="ast-196" class="other_trans">Rectangle</span>(<span id="ast-197"><span id="ast-198">box</span>.x</span>,&nbsp;<span id="ast-199">start</span>,&nbsp;<span id="ast-200"><span id="ast-201">box</span>.width</span>,&nbsp;<span id="ast-202">(<span id="ast-203">end</span>&nbsp;-&nbsp;<span id="ast-205">start</span>)</span>)</span></span></span><span id="ast-206"><span id="ast-207"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start</span>&nbsp;=&nbsp;<span id="ast-208" class="other_trans">end</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_browser_versions(<span id="ast-2"><span id="ast-3" class="other_trans">browser</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;very&nbsp;very&nbsp;hardcoded/dirty&nbsp;re/split&nbsp;stuff,&nbsp;but&nbsp;no&nbsp;dependencies\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>html</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">get</span>(<span id="ast-10"><span id="ast-11">settings</span>.BROWSER_BASE_PAGE</span>,&nbsp;<span id="ast-12" class="other_trans">browser</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>html</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">html</span>.decode</span>(<span id="ast-18">'iso-8859-1'</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>html</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">html</span>.split</span>(<span id="ast-25">"&lt;div&nbsp;id='liste'&gt;"</span>)</span>[<span id="ast-26"><span id="ast-27">1</span></span>]</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>html</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">html</span>.split</span>(<span id="ast-34">'&lt;/div&gt;'</span>)</span>[<span id="ast-35"><span id="ast-36">0</span></span>]</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>browsers_iter</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">re</span>.finditer</span>(<span id="ast-42">"\\\\?id=\\\\d+\\\\'&gt;(.+?)&lt;/a"</span>,&nbsp;<span id="ast-43" class="other_trans">html</span>,&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">re</span>.UNICODE</span>)</span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>browsers</span>&nbsp;=&nbsp;<span id="ast-48">[]</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-50" class="other_trans">browser</span>&nbsp;in&nbsp;<span id="ast-51" class="other_trans">browsers_iter</span>:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-54">'more'</span><span id="ast-55">&nbsp;in&nbsp;</span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">browser</span>.group</span>(<span id="ast-61">1</span>)</span>.lower</span>()</span>)</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>browsers</span>.append</span>(<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">browser</span>.group</span>(<span id="ast-70">1</span>)</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-73"><span id="ast-74" class="other_trans">len</span>(<span id="ast-75" class="correct_node">browser&nbsp;&rarr;&nbsp;browsers&nbsp;</span>)</span><span id="ast-76" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-77"><span id="ast-78" class="other_trans">settings</span>.BROWSERS_COUNT_LIMIT</span>)</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">fail_silently</span>,&nbsp;**kwargs</span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-11" class="other_trans">SendGridBackend</span>,&nbsp;<span id="ast-12">self</span>)</span>.__init__</span>(fail_silently=<span id="ast-14" class="other_trans">fail_silently</span>,&nbsp;**<span id="ast-15" class="incorrect_node">kwargs&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.api_key</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">getattr</span>(<span id="ast-21" class="other_trans">settings</span>,&nbsp;<span id="ast-22">'SENDGRID_API_KEY'</span>,&nbsp;<span id="ast-23" class="other_trans">None</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-26">not</span>&nbsp;<span id="ast-27"><span id="ast-28">self</span>.api_key</span>)</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">ImproperlyConfigured</span>(<span id="ast-32">'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SENDGRID_API_KEY&nbsp;must&nbsp;be&nbsp;declared&nbsp;in&nbsp;settings.py'</span>)</span></span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sg</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">sendgrid</span>.SendGridAPIClient</span>(apikey=<span id="ast-40"><span id="ast-41">self</span>.api_key</span>)</span></span><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.version</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">'sendgrid/{0};django'</span>.format</span>(<span id="ast-48" class="other_trans">__version__</span>)</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sg&nbsp;&rarr;&nbsp;self.&nbsp;</span>.client</span>.request_headers</span>[<span id="ast-54"><span id="ast-55">'User-agent'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57">self</span>.version</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-59">self</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;send_raw(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">stream</span>,&nbsp;<span id="ast-5" class="other_trans">msg_list</span>,&nbsp;<span id="ast-6" class="other_trans">flags</span>,&nbsp;<span id="ast-8" class="other_trans">copy</span>,&nbsp;<span id="ast-10" class="other_trans">ident</span></span>):<span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Send&nbsp;a&nbsp;raw&nbsp;message&nbsp;via&nbsp;ident&nbsp;path.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;method&nbsp;is&nbsp;used&nbsp;to&nbsp;send&nbsp;a&nbsp;already&nbsp;serialized&nbsp;message.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;stream&nbsp;:&nbsp;ZMQStream&nbsp;or&nbsp;Socket\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;ZMQ&nbsp;stream&nbsp;or&nbsp;socket&nbsp;to&nbsp;use&nbsp;for&nbsp;sending&nbsp;the&nbsp;message.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;msg_list&nbsp;:&nbsp;list\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;serialized&nbsp;list&nbsp;of&nbsp;messages&nbsp;to&nbsp;send.&nbsp;This&nbsp;only&nbsp;includes&nbsp;the\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[p_header,p_parent,p_metadata,p_content,buffer1,buffer2,...]&nbsp;portion&nbsp;of\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;message.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;ident&nbsp;:&nbsp;ident&nbsp;or&nbsp;list\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;single&nbsp;ident&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;idents&nbsp;to&nbsp;use&nbsp;in&nbsp;sending.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>to_send</span>&nbsp;=&nbsp;<span id="ast-16">[]</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18"><span id="ast-19">isinstance</span>(<span id="ast-20" class="other_trans">ident</span>,&nbsp;<span id="ast-21" class="other_trans">bytes</span>)</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ident</span>&nbsp;=&nbsp;<span id="ast-24">[<span id="ast-25" class="other_trans">ident</span>]</span></span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">ident</span><span id="ast-29" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-30" class="other_trans">None</span>)</span>:<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>to_send</span>.extend</span>(<span id="ast-35" class="other_trans">ident</span>)</span></span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>to_send</span>.append</span>(<span id="ast-40" class="other_trans">DELIM</span>)</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>to_send</span>.append</span>(<span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>.sign</span>(<span id="ast-48" class="other_trans">msg_list</span>)</span>)</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>to_send</span>.extend</span>(<span id="ast-53" class="other_trans">msg_list</span>)</span></span><span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>stream</span>.send_multipart</span>(<span id="ast-58" class="correct_node">msg_list&nbsp;&rarr;&nbsp;to_send&nbsp;</span>,&nbsp;<span id="ast-59" class="other_trans">flags</span>,&nbsp;copy=<span id="ast-61" class="other_trans">copy</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;env_var(<span id="ast-2"><span id="ast-3" class="other_trans">key</span>,&nbsp;<span id="ast-4" class="other_trans">default</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Retrieves&nbsp;env&nbsp;vars&nbsp;and&nbsp;makes&nbsp;Python&nbsp;boolean&nbsp;replacements'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">os</span>.environ</span>.get</span>(<span id="ast-14" class="other_trans">key</span>,&nbsp;<span id="ast-15" class="other_trans">default</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">val</span><span id="ast-19" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-20">'True'</span>)</span>:<span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-23">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-25">(<span id="ast-26" class="other_trans">val</span><span id="ast-27" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-28">'False'</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-31">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-33">(<span id="ast-34" class="other_trans">val</span><span id="ast-35" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-36">'None'</span>)</span>:<span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-39">None</span></span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41" class="other_trans">val</span></span></span><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
</span>BASE_LAYER_DIR</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-48" class="other_trans">BASE_DIR</span>,&nbsp;<span id="ast-49">'baselayers'</span>)</span></span><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
</span>BASE_LAYERS</span>&nbsp;=&nbsp;<span id="ast-52">{}</span></span><span id="ast-53"><span class="whitespace"><br />
</span>for&nbsp;<span id="ast-54" class="other_trans">filename</span>&nbsp;in&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">os</span>.listdir</span>(<span id="ast-58" class="other_trans">BASE_LAYER_DIR</span>)</span>:<span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-61" class="other_trans">base</span>,&nbsp;<span id="ast-62" class="other_trans">ext</span>)</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">os</span>.path</span>.splitext</span>(<span id="ast-67" class="other_trans">filename</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>BASE_LAYERS</span>[<span id="ast-71"><span id="ast-72" class="incorrect_node">base&nbsp;&rarr;&nbsp;filename&nbsp;</span></span>]</span>&nbsp;=&nbsp;<span id="ast-73" class="ref_node">base&nbsp;&rarr;&nbsp;filename&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;do(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">'authorized_file'</span><span id="ast-7">&nbsp;in&nbsp;</span><span id="ast-8"><span id="ast-9">self</span>.conf</span>)</span>:<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.enable_key</span>(<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.conf</span>.authorized_file</span>,&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.conf</span>.key</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>authorized_files</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="incorrect_node">list_authorized_files&nbsp;&rarr;&nbsp;self.&nbsp;</span>.get_authorized_files</span>(exclude_users=<span id="ast-26"><span id="ast-27"><span id="ast-28">self</span>.conf</span>.exclude_users</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-30">(<span id="ast-31" class="other_trans">user</span>,&nbsp;<span id="ast-32" class="other_trans">authorized_file</span>)</span>&nbsp;in&nbsp;<span id="ast-33" class="other_trans">authorized_files</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.enable_key</span>(<span id="ast-38" class="other_trans">authorized_file</span>,&nbsp;<span id="ast-39"><span id="ast-40" class="ref_node">conf&nbsp;&rarr;&nbsp;self.&nbsp;</span>.key</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_samples(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">gts</span>,&nbsp;<span id="ast-5">lbls</span>,&nbsp;<span id="ast-6" class="other_trans">splitter</span>,&nbsp;<span id="ast-11">model</span></span>):<span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Hack...'</span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>model</span>&nbsp;=&nbsp;<span id="ast-17">(<span id="ast-19" class="other_trans">model</span>&nbsp;or&nbsp;<span id="ast-20"><span id="ast-21">self</span>.model</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">model</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26">'auto_rec'</span>)</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ref</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">splitter</span>.split</span>(<span id="ast-33"><span id="ast-34" class="other_trans">gts</span>[<span id="ast-35"><span id="ast-36">0</span></span>]</span>)</span>[<span id="ast-37"><span id="ast-38">0</span></span>]</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-40">[<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">l</span>.split</span>(<span id="ast-45">'('</span>,&nbsp;<span id="ast-46">1</span>)</span>[<span id="ast-47"><span id="ast-48">0</span></span>]</span><span id="ast-49">&nbsp;for&nbsp;<span id="ast-50">(<span id="ast-51">gt</span>,&nbsp;<span id="ast-52" class="other_trans">l</span>)</span>&nbsp;in&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">it</span>.izip</span>(<span id="ast-56" class="other_trans">gts</span>,&nbsp;<span id="ast-57">lbls</span>)</span>&nbsp;if&nbsp;<span id="ast-58">(<span id="ast-59">not</span>&nbsp;<span id="ast-60">(<span id="ast-61" class="other_trans">ref</span><span id="ast-62">&nbsp;in&nbsp;</span><span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">splitter</span>.split</span>(<span id="ast-66" class="other_trans">gt</span>)</span>)</span>)</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-68">(<span id="ast-69" class="other_trans">model</span><span id="ast-70" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-71">'auto_dom'</span>)</span>:<span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-73">[<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">l</span>.split</span>(<span id="ast-78">'('</span>,&nbsp;<span id="ast-79">1</span>)</span>[<span id="ast-80"><span id="ast-81">0</span></span>]</span><span id="ast-82">&nbsp;for&nbsp;<span id="ast-83" class="other_trans">l</span>&nbsp;in&nbsp;<span id="ast-84">lbls</span>&nbsp;if&nbsp;<span id="ast-85">(<span id="ast-86">';affected'</span><span id="ast-87">&nbsp;in&nbsp;</span><span id="ast-88" class="correct_node">lbls&nbsp;&rarr;&nbsp;l&nbsp;</span>)</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-90">(<span id="ast-91">model</span><span id="ast-92" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-93">'de_novo'</span>)</span>:<span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parents</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97">set</span>(<span id="ast-98">(<span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans">splitter</span>.split</span>(<span id="ast-102"><span id="ast-103" class="other_trans">gts</span>[<span id="ast-104"><span id="ast-105">0</span></span>]</span>)</span>&nbsp;+&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109">splitter</span>.split</span>(<span id="ast-110"><span id="ast-111">gts</span>[<span id="ast-112"><span id="ast-113">1</span></span>]</span>)</span>)</span>)</span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-115">[<span id="ast-116"><span id="ast-117"><span id="ast-118"><span id="ast-119">l</span>.split</span>(<span id="ast-120">'('</span>,&nbsp;<span id="ast-121">1</span>)</span>[<span id="ast-122"><span id="ast-123">0</span></span>]</span><span id="ast-124">&nbsp;for&nbsp;<span id="ast-125">(<span id="ast-126" class="other_trans">gt</span>,&nbsp;<span id="ast-127">l</span>)</span>&nbsp;in&nbsp;<span id="ast-128"><span id="ast-129"><span id="ast-130">it</span>.izip</span>(<span id="ast-131"><span id="ast-132">gts</span>[<span id="ast-133"><span id="ast-134">2</span>:</span>]</span>,&nbsp;<span id="ast-135"><span id="ast-136" class="other_trans">lbls</span>[<span id="ast-137"><span id="ast-138">2</span>:</span>]</span>)</span>&nbsp;if&nbsp;<span id="ast-139">(<span id="ast-140"><span id="ast-141" class="other_trans">set</span>(<span id="ast-142"><span id="ast-143"><span id="ast-144">splitter</span>.split</span>(<span id="ast-145" class="other_trans">gt</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-147" class="other_trans">parents</span>)</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-149">(<span id="ast-150" class="other_trans">model</span><span id="ast-151" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-152">'mendel_violations'</span>)</span>:<span id="ast-153"><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-155">mom</span>,&nbsp;<span id="ast-156">dad</span>)</span>&nbsp;=&nbsp;<span id="ast-157">(<span id="ast-158"><span id="ast-159">set</span>(<span id="ast-160"><span id="ast-161"><span id="ast-162">splitter</span>.split</span>(<span id="ast-163"><span id="ast-164" class="other_trans">gts</span>[<span id="ast-165"><span id="ast-166">0</span></span>]</span>)</span>)</span>,&nbsp;<span id="ast-167"><span id="ast-168" class="other_trans">set</span>(<span id="ast-169"><span id="ast-170"><span id="ast-171">splitter</span>.split</span>(<span id="ast-172"><span id="ast-173">gts</span>[<span id="ast-174"><span id="ast-175">1</span></span>]</span>)</span>)</span>)</span></span><span id="ast-176"><span id="ast-177"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>samps</span>&nbsp;=&nbsp;<span id="ast-178"><span id="ast-179"><span id="ast-180">self</span>.get_samples</span>(<span id="ast-181">gts</span>,&nbsp;<span id="ast-182" class="other_trans">lbls</span>,&nbsp;model=<span id="ast-184">'de_novo'</span>)</span></span><span id="ast-185"><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>samps</span>&nbsp;+=&nbsp;<span id="ast-188">[<span id="ast-189"><span id="ast-190"><span id="ast-191"><span id="ast-192" class="other_trans">l</span>.split</span>(<span id="ast-193">'('</span>,&nbsp;<span id="ast-194">1</span>)</span>[<span id="ast-195"><span id="ast-196">0</span></span>]</span><span id="ast-197">&nbsp;for&nbsp;<span id="ast-198">(<span id="ast-199">gt</span>,&nbsp;<span id="ast-200">l</span>)</span>&nbsp;in&nbsp;<span id="ast-201"><span id="ast-202"><span id="ast-203">it</span>.izip</span>(<span id="ast-204"><span id="ast-205">gts</span>[<span id="ast-206"><span id="ast-207">2</span>:</span>]</span>,&nbsp;<span id="ast-208"><span id="ast-209">lbls</span>[<span id="ast-210"><span id="ast-211">2</span>:</span>]</span>)</span>&nbsp;if&nbsp;<span id="ast-212">(<span id="ast-213">not</span>&nbsp;<span id="ast-214">(<span id="ast-216">(<span id="ast-217"><span id="ast-218">set</span>(<span id="ast-219"><span id="ast-220"><span id="ast-221" class="other_trans">splitter</span>.split</span>(<span id="ast-222">gt</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-224">mom</span>)</span>&nbsp;and&nbsp;<span id="ast-225">(<span id="ast-226"><span id="ast-227">set</span>(<span id="ast-228"><span id="ast-229"><span id="ast-230">splitter</span>.split</span>(<span id="ast-231">gt</span>)</span>)</span>&nbsp;-&nbsp;<span id="ast-233" class="other_trans">dad</span>)</span>)</span>)</span></span>]</span></span><span id="ast-234"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-235">samps</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;package_to_path(<span id="ast-2"><span id="ast-3" class="other_trans">package</span>,&nbsp;<span id="ast-4" class="other_trans">module</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7" class="other_trans">package</span><span id="ast-8" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-9" class="other_trans">module</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-11">'%{pypi_name}'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-13" class="correct_node">package&nbsp;&rarr;&nbsp;module&nbsp;</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_args_from_msg_body(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">body</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Parse&nbsp;message&nbsp;body&nbsp;and&nbsp;return&nbsp;a&nbsp;list&nbsp;which&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;*args&nbsp;parameter&nbsp;for&nbsp;this&nbsp;command'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fun_spec</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10">self</span>.fun_spec</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>last_pos</span>&nbsp;=&nbsp;<span id="ast-13">(<span id="ast-14">(<span id="ast-15"><span id="ast-16" class="other_trans">fun_spec</span>.args_count</span>&nbsp;+&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">fun_spec</span>.kwargs_count</span>)</span>&nbsp;-&nbsp;<span id="ast-21">1</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-25">(<span id="ast-26" class="other_trans">last_pos</span><span id="ast-27" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-28">0</span>)</span>&nbsp;and&nbsp;<span id="ast-29">(<span id="ast-30">not</span>&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">fun_spec</span>.star_args</span>)</span>)</span>:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-34">[]</span></span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40">shlex</span>.split</span>(<span id="ast-41" class="other_trans">body</span>)</span>[<span id="ast-42"><span id="ast-43">1</span>:</span>]</span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params_count</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">len</span>(<span id="ast-48" class="other_trans">params</span>)</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">fun_spec</span>.args_count</span>:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-55">(<span id="ast-56" class="other_trans">params_count</span><span id="ast-57" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-58"><span id="ast-59" class="other_trans">fun_spec</span>.args_count</span>)</span>&nbsp;or&nbsp;<span id="ast-60">(<span id="ast-61">not</span>&nbsp;<span id="ast-62"><span id="ast-63">all</span>(<span id="ast-64"><span id="ast-65" class="other_trans">params</span>[<span id="ast-66">:<span id="ast-67"><span id="ast-68" class="other_trans">fun_spec</span>.args_count</span></span>]</span>)</span>)</span>)</span>:<span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-70">MissingParameter</span></span></span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-74"><span id="ast-75" class="other_trans">fun_spec</span>.star_args</span>&nbsp;or&nbsp;<span id="ast-76">(<span id="ast-77" class="other_trans">last_pos</span><span id="ast-78" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-79" class="other_trans">params_count</span>)</span>)</span>:<span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-81" class="other_trans">params</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-83">(<span id="ast-84"><span id="ast-85" class="other_trans">params</span>[<span id="ast-86">:<span id="ast-87" class="other_trans">last_pos</span></span>]</span>&nbsp;+&nbsp;<span id="ast-89">[<span id="ast-90"><span id="ast-91"><span id="ast-92">'&nbsp;'</span>.join</span>(<span id="ast-93"><span id="ast-94" class="other_trans">params</span>[<span id="ast-95"><span id="ast-96" class="other_trans">last_pos</span>:</span>]</span>)</span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;save(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">filename</span>,&nbsp;<span id="ast-5" class="other_trans">fh</span>,&nbsp;<span id="ast-7" class="other_trans">mode</span>,&nbsp;<span id="ast-9" class="other_trans">update_normals</span></span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Save&nbsp;the&nbsp;STL&nbsp;to&nbsp;a&nbsp;(binary)&nbsp;file\\u000a&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;mode&nbsp;is&nbsp;:py:data:`AUTOMATIC`&nbsp;an&nbsp;:py:data:`ASCII`&nbsp;file&nbsp;will&nbsp;be\\u000a&nbsp;&nbsp;&nbsp;&nbsp;written&nbsp;if&nbsp;the&nbsp;output&nbsp;is&nbsp;a&nbsp;TTY&nbsp;and&nbsp;a&nbsp;:py:data:`BINARY`&nbsp;file&nbsp;otherwise.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;str&nbsp;filename:&nbsp;The&nbsp;file&nbsp;to&nbsp;load\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;file&nbsp;fh:&nbsp;The&nbsp;file&nbsp;handle&nbsp;to&nbsp;open\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;int&nbsp;mode:&nbsp;The&nbsp;mode&nbsp;to&nbsp;write,&nbsp;default&nbsp;is&nbsp;:py:data:`AUTOMATIC`.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;bool&nbsp;update_normals:&nbsp;Whether&nbsp;to&nbsp;update&nbsp;the&nbsp;normals\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-14" class="other_trans">filename</span>,&nbsp;<span id="ast-15">'Filename&nbsp;is&nbsp;required&nbsp;for&nbsp;the&nbsp;STL&nbsp;headers'</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17" class="other_trans">update_normals</span>:<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.update_normals</span>()</span></span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">mode</span><span id="ast-25" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-26">AUTOMATIC</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-30" class="other_trans">fh</span>&nbsp;and&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">os</span>.isatty</span>(<span id="ast-34"><span id="ast-35"><span id="ast-36">fh</span>.fileno</span>()</span>)</span>)</span>:<span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40">self</span>._write_ascii</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44">self</span>._write_binary</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-46">(<span id="ast-47" class="other_trans">mode</span><span id="ast-48" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-49" class="other_trans">BINARY</span>)</span>:<span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53">self</span>._write_binary</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">mode</span><span id="ast-57" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-58">ASCII</span>)</span>:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62">self</span>._write_ascii</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">ValueError</span>(<span id="ast-66">(<span id="ast-67">'Mode&nbsp;%r&nbsp;is&nbsp;invalid'</span>&nbsp;%&nbsp;<span id="ast-69" class="other_trans">mode</span>)</span>)</span></span></span><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76">os</span>.path</span>.split</span>(<span id="ast-77" class="other_trans">filename</span>)</span>[<span id="ast-78"><span id="ast-79">-1</span></span>]</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-82" class="other_trans">fh</span>:<span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write</span>(<span id="ast-86" class="other_trans">fh</span>,&nbsp;<span id="ast-87">name</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-89"><span id="ast-90" class="other_trans">open</span>(<span id="ast-91" class="ref_node">name&nbsp;&rarr;&nbsp;filename&nbsp;</span>,&nbsp;<span id="ast-92">'wb'</span>)</span>&nbsp;as&nbsp;<span id="ast-93" class="other_trans">fh</span>:<span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write</span>(<span id="ast-97" class="other_trans">fh</span>,&nbsp;<span id="ast-98" class="incorrect_node">filename&nbsp;&rarr;&nbsp;name&nbsp;</span>)</span></span></span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-100">IOError</span>:<span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;clean_birthday(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>birthday</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>.cleaned_data</span>[<span id="ast-9"><span id="ast-10">'birthday'</span></span>]</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">birthday</span><span id="ast-14" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">date</span>.today</span>()</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">forms</span>.ValidationError</span>(<span id="ast-22">'You&nbsp;cannot&nbsp;be&nbsp;born&nbsp;in&nbsp;the&nbsp;future.'</span>)</span></span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-24" class="other_trans">birthday</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_make_callable(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">steps</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">hasattr</span>(<span id="ast-8" class="other_trans">steps</span>,&nbsp;<span id="ast-9">'__call__'</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-11" class="other_trans">steps</span></span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>num_steps</span>&nbsp;=&nbsp;<span id="ast-14">(<span id="ast-15">(<span id="ast-16">(<span id="ast-17"><span id="ast-18">self</span>.n</span>&nbsp;+&nbsp;<span id="ast-20"><span id="ast-21">self</span>.order</span>)</span>&nbsp;-&nbsp;<span id="ast-23">1</span>)</span>&nbsp;+&nbsp;<span id="ast-25">(<span id="ast-26">10</span>&nbsp;*&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">int</span>(<span id="ast-30">(<span id="ast-31" class="other_trans">steps</span><span id="ast-32" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-33" class="other_trans">None</span>)</span>)</span>)</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">StepsGenerator</span>(base_step=<span id="ast-38" class="other_trans">steps</span>,&nbsp;step_ratio=<span id="ast-40">(<span id="ast-41">4.0</span>&nbsp;**&nbsp;<span id="ast-43">(<span id="ast-44">1.0</span>&nbsp;/&nbsp;<span id="ast-46"><span id="ast-47">self</span>.n</span>)</span>)</span>,&nbsp;num_steps=<span id="ast-49" class="other_trans">num_steps</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_build_fpm_cmd_string(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.command</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.command</span>.format</span>(<span id="ast-11"><span id="ast-12">self</span>.name</span>,&nbsp;<span id="ast-13"><span id="ast-14">self</span>.input_type</span>,&nbsp;<span id="ast-15"><span id="ast-16">self</span>.output_type</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19"><span id="ast-20" class="incorrect_node">kwargs&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-21"><span id="ast-22">'version'</span></span>]</span><span id="ast-23" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-24" class="other_trans">None</span>)</span>:<span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.command</span>&nbsp;+=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31">'-v&nbsp;{}&nbsp;'</span>.format</span>(<span id="ast-32"><span id="ast-33" class="other_trans">kwargs</span>[<span id="ast-34"><span id="ast-35">'version'</span></span>]</span>)</span></span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">kwargs</span>[<span id="ast-39"><span id="ast-40">'chdir'</span></span>]</span>:<span id="ast-41"><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.command</span>&nbsp;+=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">'-C&nbsp;{}&nbsp;'</span>.format</span>(<span id="ast-48"><span id="ast-49" class="other_trans">kwargs</span>[<span id="ast-50"><span id="ast-51">'chdir'</span></span>]</span>)</span></span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">kwargs</span>[<span id="ast-55"><span id="ast-56">'depends'</span></span>]</span>:<span id="ast-57"><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.command</span>&nbsp;+=&nbsp;<span id="ast-61">(<span id="ast-62">'-d&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66">'&nbsp;-d&nbsp;'</span>.join</span>(<span id="ast-67"><span id="ast-68" class="other_trans">kwargs</span>[<span id="ast-69"><span id="ast-70">'depends'</span></span>]</span>)</span>)</span></span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72"><span id="ast-73" class="other_trans">kwargs</span>[<span id="ast-74"><span id="ast-75">'force'</span></span>]</span>:<span id="ast-76"><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.command</span>&nbsp;+=&nbsp;<span id="ast-80">'-f&nbsp;'</span></span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-82">(<span id="ast-83"><span id="ast-84" class="other_trans">kwargs</span>[<span id="ast-85"><span id="ast-86">'after_install'</span></span>]</span><span id="ast-87" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-88" class="other_trans">None</span>)</span>:<span id="ast-89"><span id="ast-90"><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.command</span>&nbsp;+=&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95">'--after-install&nbsp;{}&nbsp;'</span>.format</span>(<span id="ast-96">(<span id="ast-97">(<span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans">os</span>.getcwd</span>()</span>&nbsp;+&nbsp;<span id="ast-102">'/'</span>)</span>&nbsp;+&nbsp;<span id="ast-104"><span id="ast-105" class="other_trans">kwargs</span>[<span id="ast-106"><span id="ast-107">'after_install'</span></span>]</span>)</span>)</span></span></span><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-109">(<span id="ast-110"><span id="ast-111" class="other_trans">kwargs</span>[<span id="ast-112"><span id="ast-113">'before_install'</span></span>]</span><span id="ast-114" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-115" class="other_trans">None</span>)</span>:<span id="ast-116"><span id="ast-117"><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.command</span>&nbsp;+=&nbsp;<span id="ast-120"><span id="ast-121"><span id="ast-122">'--before-install&nbsp;{}&nbsp;'</span>.format</span>(<span id="ast-123">(<span id="ast-124">(<span id="ast-125"><span id="ast-126"><span id="ast-127" class="other_trans">os</span>.getcwd</span>()</span>&nbsp;+&nbsp;<span id="ast-129">'/'</span>)</span>&nbsp;+&nbsp;<span id="ast-131"><span id="ast-132" class="other_trans">kwargs</span>[<span id="ast-133"><span id="ast-134">'before_install'</span></span>]</span>)</span>)</span></span></span><span id="ast-135"><span id="ast-136"><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.command</span>&nbsp;+=&nbsp;<span id="ast-139"><span id="ast-140">self</span>.source</span></span><span id="ast-141"><span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lgr</span>.debug</span>(<span id="ast-145"><span id="ast-146"><span id="ast-147">'fpm&nbsp;cmd&nbsp;is:&nbsp;{}'</span>.format</span>(<span id="ast-148" class="ref_node">command&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;inject_parameter_values(<span id="ast-2"><span id="ast-3" class="other_trans">bricks</span>,&nbsp;<span id="ast-4" class="other_trans">param_values</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Inject&nbsp;parameter&nbsp;values&nbsp;into&nbsp;a&nbsp;bricks&nbsp;hierarchy.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;bricks&nbsp;:&nbsp;Brick&nbsp;or&nbsp;Selector\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;top&nbsp;bricks.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;param_values&nbsp;:&nbsp;dict&nbsp;of&nbsp;(parameter&nbsp;name,&nbsp;numpy&nbsp;array)&nbsp;pairs\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;parameter&nbsp;values.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">isinstance</span>(<span id="ast-10" class="other_trans">bricks</span>,&nbsp;<span id="ast-11">Brick</span>)</span>:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bricks</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15">Selector</span>(<span id="ast-16">[<span id="ast-17" class="other_trans">bricks</span>]</span>)</span></span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20">not</span>&nbsp;<span id="ast-21"><span id="ast-22">isinstance</span>(<span id="ast-23" class="other_trans">bricks</span>,&nbsp;<span id="ast-24" class="other_trans">Selector</span>)</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-26" class="other_trans">ValueError</span></span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">name</span>,&nbsp;<span id="ast-30" class="other_trans">value</span>)</span>&nbsp;in&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">param_values</span>.items</span>()</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selected</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">bricks</span>.select</span>(<span id="ast-39" class="other_trans">name</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43">len</span>(<span id="ast-44">selected</span>)</span><span id="ast-45" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-46">0</span>)</span>:<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-51"><span id="ast-52"><span id="ast-53">'Unknown&nbsp;parameter&nbsp;{}'</span>.format</span>(<span id="ast-54" class="other_trans">name</span>)</span>)</span></span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">(<span id="ast-57">not</span>&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60">len</span>(<span id="ast-61">selected</span>)</span><span id="ast-62" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-63">1</span>)</span>)</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-65">ValueError</span></span></span><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selected</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">selected</span>[<span id="ast-70"><span id="ast-71">0</span></span>]</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">selected</span>.get_value</span>(borrow=<span id="ast-79">True</span>,&nbsp;return_internal_type=<span id="ast-81">True</span>)</span>.shape</span><span id="ast-82" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-83"><span id="ast-84" class="other_trans">value</span>.shape</span>)</span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selected</span>.set_value</span>(<span id="ast-89" class="other_trans">value</span>)</span></span></span><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94">bricks</span>.get_params</span>()</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-96" class="other_trans">name</span>&nbsp;in&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99">params</span>.keys</span>()</span>:<span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-101">(<span id="ast-102" class="other_trans">name</span><span id="ast-103">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-104" class="ref_node">params&nbsp;&rarr;&nbsp;param_values&nbsp;</span>)</span>:<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-109"><span id="ast-110"><span id="ast-111">'No&nbsp;value&nbsp;is&nbsp;provided&nbsp;for&nbsp;the&nbsp;parameter&nbsp;{}'</span>.format</span>(<span id="ast-112" class="other_trans">name</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;save(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;If&nbsp;Listing&nbsp;is&nbsp;created,&nbsp;we&nbsp;create&nbsp;HitCount&nbsp;object&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9"><span id="ast-10">self</span>.slug</span>)</span>:<span id="ast-11"><span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.slug</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.publishable</span>.slug</span></span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18"><span id="ast-19">self</span>.pk</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>old_self</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">Placement</span>.objects</span>.get</span>(pk=<span id="ast-27"><span id="ast-28">self</span>.pk</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>old_path</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">old_self</span>.get_absolute_url</span>()</span></span><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_path</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38">self</span>.get_absolute_url</span>()</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-42">(<span id="ast-43" class="other_trans">old_path</span><span id="ast-44" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-45" class="other_trans">new_path</span>)</span>&nbsp;and&nbsp;<span id="ast-46" class="other_trans">new_path</span>)</span>:<span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-49" class="other_trans">redirect</span>,&nbsp;<span id="ast-50">created</span>)</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">Redirect</span>.objects</span>.get_or_create</span>(old_path=<span id="ast-56" class="other_trans">old_path</span>,&nbsp;site=<span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>.category</span>.site</span>)</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>redirect</span>.new_path</span>&nbsp;=&nbsp;<span id="ast-64" class="other_trans">new_path</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>redirect</span>.save</span>(force_update=<span id="ast-70">True</span>)</span></span><span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Redirect</span>.objects</span>.filter</span>(new_path=<span id="ast-81" class="other_trans">old_path</span>)</span>.exclude</span>(pk=<span id="ast-83"><span id="ast-84" class="other_trans">redirect</span>.pk</span>)</span>.update</span>(new_path=<span id="ast-86" class="other_trans">new_path</span>)</span></span></span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-92" class="other_trans">Placement</span>,&nbsp;<span id="ast-93">self</span>)</span>.save</span>(**<span id="ast-94" class="other_trans">kwargs</span>)</span></span><span id="ast-95"><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-97" class="other_trans">hc</span>,&nbsp;<span id="ast-98" class="other_trans">created</span>)</span>&nbsp;=&nbsp;<span id="ast-99"><span id="ast-100"><span id="ast-101"><span id="ast-102">HitCount</span>.objects</span>.get_or_create</span>(placement=<span id="ast-104">self</span>,&nbsp;defaults=<span id="ast-106">{<span id="ast-107">'hits'</span>:&nbsp;<span id="ast-108">0</span>}</span>)</span></span><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-110">(<span id="ast-111"><span id="ast-112"><span id="ast-113">self</span>.publishable</span>.publish_from</span><span id="ast-114" class="location_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;>,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-115"><span id="ast-116">self</span>.publish_from</span>)</span>:<span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Publishable</span>.objects</span>.filter</span>(pk=<span id="ast-125"><span id="ast-126">self</span>.publishable_id</span>)</span>.update</span>(publish_from=<span id="ast-128"><span id="ast-129">self</span>.publish_from</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;check(<span id="ast-2"><span id="ast-3" class="other_trans">raw</span>,&nbsp;<span id="ast-4" class="other_trans">length</span>,&nbsp;<span id="ast-6" class="other_trans">freq</span>,&nbsp;<span id="ast-8" class="other_trans">min_types</span>,&nbsp;<span id="ast-10" class="other_trans">level</span></span>):<span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Check&nbsp;the&nbsp;safety&nbsp;level&nbsp;of&nbsp;the&nbsp;password.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;raw:&nbsp;raw&nbsp;text&nbsp;password.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;length:&nbsp;minimal&nbsp;length&nbsp;of&nbsp;the&nbsp;password.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;freq:&nbsp;minimum&nbsp;frequency.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;min_types:&nbsp;minimum&nbsp;character&nbsp;family.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;level:&nbsp;minimum&nbsp;level&nbsp;to&nbsp;validate&nbsp;a&nbsp;password.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raw</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17">to_unicode</span>(<span id="ast-18" class="other_trans">raw</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">level</span><span id="ast-22" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-23">STRONG</span>)</span>:<span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>level</span>&nbsp;=&nbsp;<span id="ast-26" class="other_trans">STRONG</span></span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-29"><span id="ast-30">len</span>(<span id="ast-31" class="other_trans">raw</span>)</span><span id="ast-32" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-33">length</span>)</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-35"><span id="ast-36">Strength</span>(<span id="ast-37">False</span>,&nbsp;<span id="ast-38">'terrible'</span>,&nbsp;<span id="ast-39">'password&nbsp;is&nbsp;too&nbsp;short'</span>)</span></span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-43"><span id="ast-44">is_asdf</span>(<span id="ast-45">raw</span>)</span>&nbsp;or&nbsp;<span id="ast-46"><span id="ast-47">is_by_step</span>(<span id="ast-48" class="other_trans">raw</span>)</span>)</span>:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">Strength</span>(<span id="ast-52">False</span>,&nbsp;<span id="ast-53">'simple'</span>,&nbsp;<span id="ast-54">'password&nbsp;has&nbsp;a&nbsp;pattern'</span>)</span></span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56"><span id="ast-57">is_common_password</span>(<span id="ast-58">raw</span>,&nbsp;freq=<span id="ast-60" class="other_trans">freq</span>)</span>:<span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-62"><span id="ast-63">Strength</span>(<span id="ast-64">False</span>,&nbsp;<span id="ast-65">'simple'</span>,&nbsp;<span id="ast-66">'password&nbsp;is&nbsp;too&nbsp;common'</span>)</span></span></span><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>types</span>&nbsp;=&nbsp;<span id="ast-69">0</span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans">LOWER</span>.search</span>(<span id="ast-74">raw</span>)</span>:<span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>types</span>&nbsp;+=&nbsp;<span id="ast-78">1</span></span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">UPPER</span>.search</span>(<span id="ast-83" class="other_trans">raw</span>)</span>:<span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>types</span>&nbsp;+=&nbsp;<span id="ast-87">1</span></span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans">NUMBER</span>.search</span>(<span id="ast-92" class="other_trans">raw</span>)</span>:<span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>types</span>&nbsp;+=&nbsp;<span id="ast-96">1</span></span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans">MARKS</span>.search</span>(<span id="ast-101" class="other_trans">raw</span>)</span>:<span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>types</span>&nbsp;+=&nbsp;<span id="ast-105">1</span></span></span><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-107">(<span id="ast-109">(<span id="ast-110"><span id="ast-111">len</span>(<span id="ast-112">raw</span>)</span><span id="ast-113" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-114">8</span>)</span>&nbsp;and&nbsp;<span id="ast-115">(<span id="ast-116" class="other_trans">types</span><span id="ast-117" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-118">2</span>)</span>)</span>:<span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-120"><span id="ast-121" class="other_trans">Strength</span>(<span id="ast-122">(<span id="ast-123" class="other_trans">level</span><span id="ast-124" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-125">SIMPLE</span>)</span>,&nbsp;<span id="ast-126">'simple'</span>,&nbsp;<span id="ast-127">'password&nbsp;is&nbsp;too&nbsp;simple'</span>)</span></span></span><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-129">(<span id="ast-130" class="other_trans">types</span><span id="ast-131" class="ref_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-132" class="other_trans">min_types</span>)</span>:<span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-134"><span id="ast-135" class="other_trans">Strength</span>(<span id="ast-136">(<span id="ast-137">level</span><span id="ast-138" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-139" class="other_trans">MEDIUM</span>)</span>,&nbsp;<span id="ast-140">'medium'</span>,&nbsp;<span id="ast-141">'password&nbsp;is&nbsp;good&nbsp;enough,&nbsp;but&nbsp;not&nbsp;strong'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse_status_and_dispatch(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">stream_data</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Process&nbsp;an&nbsp;incoming&nbsp;status&nbsp;message.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>status</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">tweepy</span>.models</span>.Status</span>.parse</span>(<span id="ast-14"><span id="ast-15">self</span>.api</span>,&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">json</span>.loads</span>(<span id="ast-19" class="other_trans">stream_data</span>)</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.tweet_matchp</span>(<span id="ast-24" class="other_trans">status</span>)</span>:<span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.status_count</span>&nbsp;+=&nbsp;<span id="ast-29">1</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>.should_stop</span>()</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.running</span>&nbsp;=&nbsp;<span id="ast-37">False</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-39">False</span></span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43">self</span>.opts</span>.fields</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>csvrow</span>&nbsp;=&nbsp;<span id="ast-47">[]</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-49" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52">self</span>.opts</span>.fields</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">utils</span>.resolve_with_default</span>(<span id="ast-59" class="other_trans">status</span>,&nbsp;<span id="ast-60" class="other_trans">f</span>,&nbsp;<span id="ast-61" class="other_trans">None</span>)</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-63" class="other_trans">AttributeError</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-65"><span id="ast-66" class="correct_node">opts&nbsp;&rarr;&nbsp;self.&nbsp;</span>.terminate_on_error</span>:<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.error</span>(<span id="ast-72">(<span id="ast-73">"Field&nbsp;'%s'&nbsp;not&nbsp;found&nbsp;in&nbsp;tweet&nbsp;id=%s,&nbsp;terminating."</span>&nbsp;%&nbsp;<span id="ast-75">(<span id="ast-76" class="other_trans">f</span>,&nbsp;<span id="ast-77"><span id="ast-78" class="other_trans">status</span>.id_str</span>)</span>)</span>)</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.running</span>&nbsp;=&nbsp;<span id="ast-82">False</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-84">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-87" class="other_trans">MISSING_FIELD_VALUE</span></span></span></span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans">value</span>.encode</span>(<span id="ast-94">'utf8'</span>)</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-96" class="other_trans">AttributeError</span>:<span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span><span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>csvrow</span>.append</span>(<span id="ast-102" class="other_trans">value</span>)</span></span></span><span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.csv_writer</span>.writerow</span>(<span id="ast-108" class="other_trans">csvrow</span>)</span></span><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-110" class="other_trans">UnicodeEncodeError</span>&nbsp;as&nbsp;<span id="ast-111" class="other_trans">e</span>:<span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.warn</span>(<span id="ast-117" class="other_trans">f</span>,&nbsp;exc_info=<span id="ast-119" class="other_trans">e</span>)</span></span><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans">stream_data</span>.strip</span>()</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;see(<span id="ast-2"><span id="ast-3">cli</span>,&nbsp;<span id="ast-4" class="other_trans">nick</span>,&nbsp;<span id="ast-5">rest</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">var</span>.PHASE</span><span id="ast-10">&nbsp;in&nbsp;</span><span id="ast-11">(<span id="ast-12">'none'</span>,&nbsp;<span id="ast-13">'join'</span>)</span>)</span>:<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.notice</span>(<span id="ast-18" class="other_trans">nick</span>,&nbsp;<span id="ast-19">'No&nbsp;game&nbsp;is&nbsp;currently&nbsp;running.'</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-22">(<span id="ast-23">nick</span><span id="ast-24">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">var</span>.list_players</span>()</span>)</span>:<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.notice</span>(<span id="ast-32" class="other_trans">nick</span>,&nbsp;<span id="ast-33">"You're&nbsp;not&nbsp;currently&nbsp;playing."</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37">not</span>&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans">var</span>.is_role</span>(<span id="ast-41" class="other_trans">nick</span>,&nbsp;<span id="ast-42">'seer'</span>)</span>)</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-47">nick</span>,&nbsp;<span id="ast-48">'Only&nbsp;a&nbsp;seer&nbsp;may&nbsp;use&nbsp;this&nbsp;command'</span>)</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-53" class="other_trans">var</span>.PHASE</span><span id="ast-54" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-55">'night'</span>)</span>:<span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-60">nick</span>,&nbsp;<span id="ast-61">'You&nbsp;may&nbsp;only&nbsp;have&nbsp;visions&nbsp;at&nbsp;night.'</span>)</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65">nick</span><span id="ast-66">&nbsp;in&nbsp;</span><span id="ast-67"><span id="ast-68">var</span>.SEEN</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-73">nick</span>,&nbsp;<span id="ast-74">'You&nbsp;may&nbsp;only&nbsp;have&nbsp;one&nbsp;vision&nbsp;per&nbsp;round.'</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>victim</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">re</span>.split</span>(<span id="ast-86">'&nbsp;+'</span>,&nbsp;<span id="ast-87">rest</span>)</span>[<span id="ast-88"><span id="ast-89">0</span></span>]</span>.strip</span>()</span>.lower</span>()</span></span><span id="ast-90"><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pl</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94">var</span>.list_players</span>()</span></span><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pll</span>&nbsp;=&nbsp;<span id="ast-97">[<span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans">x</span>.lower</span>()</span><span id="ast-101">&nbsp;for&nbsp;<span id="ast-102" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-103" class="other_trans">pl</span></span>]</span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-105">(<span id="ast-106">not</span>&nbsp;<span id="ast-107" class="other_trans">victim</span>)</span>:<span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-112" class="other_trans">nick</span>,&nbsp;<span id="ast-113">'Not&nbsp;enough&nbsp;parameters'</span>)</span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-116">(<span id="ast-117" class="other_trans">victim</span><span id="ast-118">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-119" class="other_trans">pll</span>)</span>:<span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-124">nick</span>,&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127">'\\\\u0002{0}\\\\u0002&nbsp;is&nbsp;currently&nbsp;not&nbsp;playing.'</span>.format</span>(<span id="ast-128" class="other_trans">victim</span>)</span>)</span></span><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>victim</span>&nbsp;=&nbsp;<span id="ast-132"><span id="ast-133">pl</span>[<span id="ast-134"><span id="ast-135"><span id="ast-136"><span id="ast-137" class="other_trans">pll</span>.index</span>(<span id="ast-138">victim</span>)</span></span>]</span></span><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-140">(<span id="ast-141" class="ref_node">nick&nbsp;&rarr;&nbsp;victim&nbsp;</span><span id="ast-142">&nbsp;in&nbsp;</span><span id="ast-143"><span id="ast-144">var</span>.CURSED</span>)</span>:<span id="ast-145"><span id="ast-146" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>role</span>&nbsp;=&nbsp;<span id="ast-147">'wolf'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-149">(<span id="ast-150"><span id="ast-151"><span id="ast-152">var</span>.get_role</span>(<span id="ast-153">victim</span>)</span><span id="ast-154" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-155">'traitor'</span>)</span>:<span id="ast-156"><span id="ast-157" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>role</span>&nbsp;=&nbsp;<span id="ast-158">'villager'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-159"><span id="ast-160" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>role</span>&nbsp;=&nbsp;<span id="ast-161"><span id="ast-162"><span id="ast-163">var</span>.get_role</span>(<span id="ast-164" class="other_trans">victim</span>)</span></span></span><span id="ast-165"><span id="ast-166"><span id="ast-167"><span id="ast-168" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-169">nick</span>,&nbsp;<span id="ast-170"><span id="ast-171"><span id="ast-172">(<span id="ast-173">(<span id="ast-174">'You&nbsp;have&nbsp;a&nbsp;vision;&nbsp;in&nbsp;this&nbsp;vision,&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-176">'you&nbsp;see&nbsp;that&nbsp;\\\\u0002{0}\\\\u0002&nbsp;is&nbsp;a&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-178">'\\\\u0002{1}\\\\u0002!'</span>)</span>.format</span>(<span id="ast-179" class="other_trans">victim</span>,&nbsp;<span id="ast-180" class="other_trans">role</span>)</span>)</span></span><span id="ast-181"><span id="ast-182"><span id="ast-183"><span id="ast-184"><span id="ast-185" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>var</span>.SEEN</span>.append</span>(<span id="ast-186">nick</span>)</span></span><span id="ast-187"><span id="ast-188"><span id="ast-189"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>chk_nightdone</span>(<span id="ast-190" class="other_trans">cli</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;is_future_published(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-5">(<span id="ast-7"><span id="ast-8">self</span>.is_published</span>&nbsp;and&nbsp;<span id="ast-9">(<span id="ast-10"><span id="ast-11">self</span>.published</span><span id="ast-12" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-13" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-14">(<span id="ast-15"><span id="ast-16">self</span>.published</span><span id="ast-17" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;>,&nbsp;pred:&nbsp;>=&nbsp;</span><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">timezone</span>.now</span>()</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_fetch_metric(<span id="ast-2"><span id="ast-3">cc</span>,&nbsp;<span id="ast-4">metric</span>,&nbsp;<span id="ast-5" class="other_trans">type_</span>,&nbsp;<span id="ast-7">cf</span>,&nbsp;<span id="ast-9">dt</span>,&nbsp;<span id="ast-11">r</span></span>):<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirname</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">os</span>.path</span>.join</span>(<span id="ast-19" class="other_trans">RRD_PATH</span>,&nbsp;<span id="ast-20">metric</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23" class="other_trans">type_</span><span id="ast-24" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-25">None</span>)</span>:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rrdname</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31">os</span>.listdir</span>(<span id="ast-32">dirname</span>)</span>[<span id="ast-33"><span id="ast-34">0</span></span>]</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>type_</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">rrdname</span>.replace</span>(<span id="ast-40">'.rrd'</span>,&nbsp;<span id="ast-41">''</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rrdname</span>&nbsp;=&nbsp;<span id="ast-44">(<span id="ast-45" class="other_trans">type_</span>&nbsp;+&nbsp;<span id="ast-47">'.rrd'</span>)</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-50" class="other_trans">rrdname</span><span id="ast-51">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-52"><span id="ast-53"><span id="ast-54">os</span>.listdir</span>(<span id="ast-55">dirname</span>)</span>)</span>:<span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-57"><span id="ast-58">RuntimeError</span>(<span id="ast-59">'Unknown&nbsp;metric&nbsp;type'</span>)</span></span></span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cc</span>.flush</span>(identifier=<span id="ast-65">(<span id="ast-66">'minemeld/%s/%s'</span>&nbsp;%&nbsp;<span id="ast-68">(<span id="ast-69" class="other_trans">metric</span>,&nbsp;<span id="ast-70" class="other_trans">type_</span>)</span>)</span>)</span></span><span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.debug</span>(<span id="ast-75">'rrd&nbsp;file:&nbsp;%s'</span>,&nbsp;<span id="ast-76"><span id="ast-77">str</span>(<span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81">os</span>.path</span>.join</span>(<span id="ast-82">dirname</span>,&nbsp;<span id="ast-83" class="other_trans">rrdname</span>)</span>)</span>)</span></span><span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-86">(<span id="ast-87">start</span>,&nbsp;<span id="ast-88" class="other_trans">end</span>,&nbsp;<span id="ast-89">step</span>)</span>,&nbsp;<span id="ast-90">metrics</span>,&nbsp;<span id="ast-91">data</span>)</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94">rrdtool</span>.fetch</span>(<span id="ast-95"><span id="ast-96">str</span>(<span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100">os</span>.path</span>.join</span>(<span id="ast-101" class="other_trans">dirname</span>,&nbsp;<span id="ast-102" class="other_trans">rrdname</span>)</span>)</span>,&nbsp;<span id="ast-103">cf</span>,&nbsp;<span id="ast-104">'--start'</span>,&nbsp;<span id="ast-105">(<span id="ast-106">'-%d'</span>&nbsp;%&nbsp;<span id="ast-108">dt</span>)</span>,&nbsp;<span id="ast-109">'--resolution'</span>,&nbsp;<span id="ast-110">(<span id="ast-111">'%d'</span>&nbsp;%&nbsp;<span id="ast-113" class="other_trans">r</span>)</span>)</span></span><span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-116">[]</span></span><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-118">(<span id="ast-119">type_</span><span id="ast-120" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-121">'minemeld_delta'</span>)</span>:<span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>curts</span>&nbsp;=&nbsp;<span id="ast-124">start</span></span><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-126">v</span>&nbsp;in&nbsp;<span id="ast-127" class="other_trans">data</span>:<span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>.append</span>(<span id="ast-132">[<span id="ast-133" class="other_trans">curts</span>,&nbsp;<span id="ast-134"><span id="ast-135" class="other_trans">v</span>[<span id="ast-136"><span id="ast-137">0</span></span>]</span>]</span>)</span></span><span id="ast-138"><span id="ast-139" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>curts</span>&nbsp;+=&nbsp;<span id="ast-141" class="other_trans">step</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-142"><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>curts</span>&nbsp;=&nbsp;<span id="ast-144">(<span id="ast-145">start</span>&nbsp;+&nbsp;<span id="ast-147">step</span>)</span></span><span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ov</span>&nbsp;=&nbsp;<span id="ast-150"><span id="ast-151"><span id="ast-152">data</span>[<span id="ast-153"><span id="ast-154">0</span></span>]</span>[<span id="ast-155"><span id="ast-156">0</span></span>]</span></span><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-158" class="other_trans">v</span>&nbsp;in&nbsp;<span id="ast-159"><span id="ast-160" class="other_trans">data</span>[<span id="ast-161"><span id="ast-162">1</span>:</span>]</span>:<span id="ast-163"><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>&nbsp;=&nbsp;<span id="ast-165"><span id="ast-166">v</span>[<span id="ast-167"><span id="ast-168">0</span></span>]</span></span><span id="ast-169"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-170">(<span id="ast-172">(<span id="ast-173" class="other_trans">cv</span><span id="ast-174" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-175">None</span>)</span>&nbsp;and&nbsp;<span id="ast-176">(<span id="ast-177">ov</span><span id="ast-178" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-179">None</span>)</span>)</span>:<span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-181">(<span id="ast-182" class="other_trans">cv</span><span id="ast-183" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-184" class="other_trans">ov</span>)</span>:<span id="ast-185"><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>&nbsp;=&nbsp;<span id="ast-187">(<span id="ast-188" class="other_trans">cv</span>&nbsp;-&nbsp;<span id="ast-190" class="other_trans">ov</span>)</span></span></span></span><span id="ast-191"><span id="ast-192"><span id="ast-193"><span id="ast-194"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>.append</span>(<span id="ast-195">[<span id="ast-196" class="other_trans">curts</span>,&nbsp;<span id="ast-197">cv</span>]</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;for_instance(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">instance</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>field</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">copy</span>.copy</span>(<span id="ast-10">self</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">name</span>,&nbsp;<span id="ast-14" class="other_trans">attr</span>)</span>&nbsp;in&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.arguments</span>.items</span>()</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">getattr</span>(<span id="ast-23">self</span>,&nbsp;<span id="ast-24" class="other_trans">name</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-28"><span id="ast-29" class="other_trans">attr</span>.resolve_field</span>&nbsp;and&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">isinstance</span>(<span id="ast-32" class="other_trans">value</span>,&nbsp;<span id="ast-33" class="other_trans">Field</span>)</span>)</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-37" class="other_trans">field</span>,&nbsp;<span id="ast-38" class="other_trans">name</span>,&nbsp;<span id="ast-39"><span id="ast-40">getattr</span>(<span id="ast-41" class="other_trans">instance</span>,&nbsp;<span id="ast-42"><span id="ast-43" class="ref_node">attr&nbsp;&rarr;&nbsp;value&nbsp;</span>.name</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">hasattr</span>(<span id="ast-47" class="other_trans">value</span>,&nbsp;<span id="ast-48">'__call__'</span>)</span>:<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-52" class="other_trans">field</span>,&nbsp;<span id="ast-53" class="other_trans">name</span>,&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">value</span>(<span id="ast-56" class="incorrect_node">instance&nbsp;&rarr;&nbsp;value&nbsp;</span>)</span>)</span></span></span></span><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>field</span>.instance</span>&nbsp;=&nbsp;<span id="ast-60" class="other_trans">instance</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-62" class="other_trans">field</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;boxplot(<span id="ast-2">*args,&nbsp;**kwargs</span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Create&nbsp;a&nbsp;box-and-whisker&nbsp;plot&nbsp;showing&nbsp;the&nbsp;mean,&nbsp;25th&nbsp;percentile,&nbsp;and&nbsp;75th\\u000a&nbsp;&nbsp;&nbsp;&nbsp;percentile.&nbsp;The&nbsp;difference&nbsp;from&nbsp;matplotlib&nbsp;is&nbsp;only&nbsp;the&nbsp;left&nbsp;axis&nbsp;line&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;shown,&nbsp;and&nbsp;ticklabels&nbsp;labeling&nbsp;each&nbsp;category&nbsp;of&nbsp;data&nbsp;can&nbsp;be&nbsp;added.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;ax:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;x:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;kwargs:&nbsp;Besides&nbsp;xticklabels,&nbsp;which&nbsp;is&nbsp;a&nbsp;prettyplotlib-specific\\u000a&nbsp;&nbsp;&nbsp;&nbsp;argument&nbsp;which&nbsp;will&nbsp;label&nbsp;each&nbsp;individual&nbsp;boxplot,&nbsp;any&nbsp;argument&nbsp;for\\u000a&nbsp;&nbsp;&nbsp;&nbsp;matplotlib.pyplot.boxplot&nbsp;will&nbsp;be&nbsp;accepted:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;http://matplotlib.org/api/axes_api.html#matplotlib.axes.Axes.boxplot\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@return:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-7" class="other_trans">ax</span>,&nbsp;<span id="ast-8" class="other_trans">args</span>,&nbsp;<span id="ast-9" class="other_trans">kwargs</span>)</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11">maybe_get_ax</span>(*<span id="ast-12" class="other_trans">args</span>,&nbsp;**<span id="ast-13">kwargs</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>xticklabels</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">kwargs</span>.pop</span>(<span id="ast-19">'xticklabels'</span>,&nbsp;<span id="ast-20" class="other_trans">None</span>)</span></span><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fontsize</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">kwargs</span>.pop</span>(<span id="ast-26">'fontsize'</span>,&nbsp;<span id="ast-27">10</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>.setdefault</span>(<span id="ast-32">'widths'</span>,&nbsp;<span id="ast-33">0.15</span>)</span></span><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>bp</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">ax</span>.boxplot</span>(*<span id="ast-39">args</span>,&nbsp;**<span id="ast-40">kwargs</span>)</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">xticklabels</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ax</span>.xaxis</span>.set_ticklabels</span>(<span id="ast-48">xticklabels</span>,&nbsp;fontsize=<span id="ast-50" class="other_trans">fontsize</span>)</span></span></span><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>show_caps</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">kwargs</span>.pop</span>(<span id="ast-56">'show_caps'</span>,&nbsp;<span id="ast-57">True</span>)</span></span><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>show_ticks</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62">kwargs</span>.pop</span>(<span id="ast-63">'show_ticks'</span>,&nbsp;<span id="ast-64">False</span>)</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>remove_chartjunk</span>(<span id="ast-68">ax</span>,&nbsp;<span id="ast-69">[<span id="ast-70">'top'</span>,&nbsp;<span id="ast-71">'right'</span>,&nbsp;<span id="ast-72">'bottom'</span>]</span>,&nbsp;show_ticks=<span id="ast-74" class="other_trans">show_ticks</span>)</span></span><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>linewidth</span>&nbsp;=&nbsp;<span id="ast-77">0.75</span></span><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>blue</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82">colors</span>.set1</span>[<span id="ast-83"><span id="ast-84">1</span></span>]</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>red</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89">colors</span>.set1</span>[<span id="ast-90"><span id="ast-91">0</span></span>]</span></span><span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>plt</span>.setp</span>(<span id="ast-96"><span id="ast-97">bp</span>[<span id="ast-98"><span id="ast-99">'boxes'</span></span>]</span>,&nbsp;color=<span id="ast-101">blue</span>,&nbsp;linewidth=<span id="ast-103" class="other_trans">linewidth</span>)</span></span><span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>plt</span>.setp</span>(<span id="ast-108"><span id="ast-109" class="other_trans">bp</span>[<span id="ast-110"><span id="ast-111">'medians'</span></span>]</span>,&nbsp;color=<span id="ast-113">red</span>)</span></span><span id="ast-114"><span id="ast-115"><span id="ast-116"><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>plt</span>.setp</span>(<span id="ast-118"><span id="ast-119" class="other_trans">bp</span>[<span id="ast-120"><span id="ast-121">'whiskers'</span></span>]</span>,&nbsp;color=<span id="ast-123" class="other_trans">blue</span>,&nbsp;linestyle=<span id="ast-125">'solid'</span>,&nbsp;linewidth=<span id="ast-127" class="other_trans">linewidth</span>)</span></span><span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>plt</span>.setp</span>(<span id="ast-132"><span id="ast-133" class="other_trans">bp</span>[<span id="ast-134"><span id="ast-135">'fliers'</span></span>]</span>,&nbsp;color=<span id="ast-137" class="incorrect_node">blue&nbsp;&rarr;&nbsp;red&nbsp;</span>)</span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-139">show_caps</span>:<span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plt</span>.setp</span>(<span id="ast-144"><span id="ast-145" class="other_trans">bp</span>[<span id="ast-146"><span id="ast-147">'caps'</span></span>]</span>,&nbsp;color=<span id="ast-149" class="other_trans">blue</span>,&nbsp;linewidth=<span id="ast-151" class="other_trans">linewidth</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-152"><span id="ast-153"><span id="ast-154"><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plt</span>.setp</span>(<span id="ast-156"><span id="ast-157">bp</span>[<span id="ast-158"><span id="ast-159">'caps'</span></span>]</span>,&nbsp;color=<span id="ast-161">'none'</span>)</span></span></span><span id="ast-162"><span id="ast-163"><span id="ast-164"><span id="ast-165"><span id="ast-166" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ax</span>.spines</span>[<span id="ast-167"><span id="ast-168">'left'</span></span>]</span>._linewidth</span>&nbsp;=&nbsp;<span id="ast-169">0.5</span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-171" class="ref_node">ax&nbsp;&rarr;&nbsp;bp&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;set_hostname(<span id="ast-2"><span id="ast-3">filename</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>api_ver</span>&nbsp;=&nbsp;<span id="ast-6">'2008-02-01'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>metadata</span>&nbsp;=&nbsp;<span id="ast-9">None</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>base_url</span>&nbsp;=&nbsp;<span id="ast-12">(<span id="ast-13">'http://169.254.169.254/%s/meta-data'</span>&nbsp;%&nbsp;<span id="ast-15" class="other_trans">api_ver</span>)</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>my_hostname</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22">urllib</span>.urlopen</span>(<span id="ast-23">(<span id="ast-24">'%s/local-hostname/'</span>&nbsp;%&nbsp;<span id="ast-26" class="other_trans">base_url</span>)</span>)</span>.read</span>()</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.system</span>(<span id="ast-31">(<span id="ast-32">'hostname&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-34" class="other_trans">my_hostname</span>)</span>)</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mp</span>&nbsp;=&nbsp;<span id="ast-37">{<span id="ast-38">'hostname'</span>:&nbsp;<span id="ast-39" class="other_trans">my_hostname</span>}</span></span><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>t</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43">Template</span>(file=<span id="ast-45">'/etc/ec2-init/templates/hosts.tmpl'</span>,&nbsp;searchList=<span id="ast-47">[<span id="ast-48" class="other_trans">mp</span>]</span>)</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.system</span>(<span id="ast-53">'rm&nbsp;&nbsp;/etc/hosts'</span>)</span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57">open</span>(<span id="ast-58">'/etc/hosts'</span>,&nbsp;<span id="ast-59">'w'</span>)</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-64">(<span id="ast-65">'%s'</span>&nbsp;%&nbsp;<span id="ast-67" class="other_trans">t</span>)</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.close</span>()</span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.system</span>(<span id="ast-76">'rm&nbsp;&nbsp;/etc/hostname'</span>)</span></span><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>&nbsp;=&nbsp;<span id="ast-79"><span id="ast-80" class="other_trans">open</span>(<span id="ast-81">'/etc/hostname'</span>,&nbsp;<span id="ast-82">'w'</span>)</span></span><span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-87">(<span id="ast-88">'%s'</span>&nbsp;%&nbsp;<span id="ast-90" class="location_node">t&nbsp;&rarr;&nbsp;my_hostname,&nbsp;pred:&nbsp;api_ver&nbsp;</span>)</span>)</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.close</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__getitem__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">item</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-8" class="other_trans">offset</span>,&nbsp;<span id="ast-9" class="other_trans">things</span>)</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">next</span>(<span id="ast-12">(<span id="ast-13">(<span id="ast-14" class="other_trans">k</span>,&nbsp;<span id="ast-15" class="other_trans">v</span>)</span><span id="ast-16">&nbsp;for&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">k</span>,&nbsp;<span id="ast-19" class="other_trans">v</span>)</span>&nbsp;in&nbsp;<span id="ast-20"><span id="ast-21">self</span>.offsets</span>&nbsp;if&nbsp;<span id="ast-22">(<span id="ast-23" class="incorrect_node">item&nbsp;&rarr;&nbsp;v&nbsp;</span><span id="ast-24" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-25" class="other_trans">k</span>)</span></span>)</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">things</span>[<span id="ast-29"><span id="ast-30">(<span id="ast-31" class="other_trans">item</span>&nbsp;-&nbsp;<span id="ast-33" class="other_trans">offset</span>)</span></span>]</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-35" class="other_trans">StopIteration</span>:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">IndexError</span>(<span id="ast-39" class="other_trans">item</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">is_deprecated</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Constructor,&nbsp;set&nbsp;deprecation&nbsp;on&nbsp;member&nbsp;methods.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>deprecation</span>&nbsp;=&nbsp;<span id="ast-10" class="other_trans">is_deprecated</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13">not</span>&nbsp;<span id="ast-14" class="incorrect_node">deprecation&nbsp;&rarr;&nbsp;is_deprecated&nbsp;</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">hasattr</span>(<span id="ast-18">self</span>,&nbsp;<span id="ast-19">'deprecated'</span>)</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deprecation</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23">self</span>.deprecated</span></span></span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25" class="other_trans">deprecation</span>:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-27" class="other_trans">method_name</span>&nbsp;in&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30" class="ref_node">response_codes&nbsp;&rarr;&nbsp;self.&nbsp;</span>.keys</span>()</span>:<span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">hasattr</span>(<span id="ast-34">self</span>,&nbsp;<span id="ast-35" class="other_trans">method_name</span>)</span>:<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>getattr</span>(<span id="ast-40">self</span>,&nbsp;<span id="ast-41" class="other_trans">method_name</span>)</span>.is_deprecated</span>&nbsp;=&nbsp;<span id="ast-42" class="other_trans">deprecation</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">ssh_private_key</span>,&nbsp;<span id="ast-6" class="other_trans">login_as</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10" class="other_trans">ssh_private_key</span><span id="ast-11" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-12" class="other_trans">None</span>)</span>:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ssh_private_key</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">join</span>(<span id="ast-17"><span id="ast-18" class="other_trans">getenv</span>(<span id="ast-19">'HOME'</span>)</span>,&nbsp;<span id="ast-20">'.ssh'</span>,&nbsp;<span id="ast-21">'id_rsa'</span>)</span></span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ssh_private_key</span>&nbsp;=&nbsp;<span id="ast-25" class="other_trans">ssh_private_key</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ssh_public_key</span>&nbsp;=&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">ssh_private_key</span>&nbsp;+&nbsp;<span id="ast-32">'.pub'</span>)</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_hash</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">hashlib</span>.md5</span>()</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key_hash</span>.update</span>(<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">open</span>(<span id="ast-46"><span id="ast-47">self</span>.ssh_public_key</span>)</span>.read</span>()</span>)</span></span><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ssh_key_name</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">key_hash</span>.hexdigest</span>()</span></span><span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.login_as</span>&nbsp;=&nbsp;<span id="ast-57" class="other_trans">login_as</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>provider</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">getattr</span>(<span id="ast-63" class="incorrect_node">Provider&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-64"><span id="ast-65">self</span>.PROVIDER_NAME</span>)</span></span><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-67" class="other_trans">AttributeError</span>:<span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-69" class="other_trans">Exception</span>,&nbsp;<span id="ast-70">(<span id="ast-71">'Unknown&nbsp;cloud&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-73" class="ref_node">PROVIDER_NAME&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;dump(<span id="ast-2"><span id="ast-3">symbol</span>,&nbsp;<span id="ast-4" class="other_trans">day</span>,&nbsp;<span id="ast-5" class="other_trans">ticks</span>,&nbsp;<span id="ast-6">time_frame</span></span>):<span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>file_name</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">TEMPLATE_FILE_NAME</span>.format</span>(<span id="ast-14" class="other_trans">symbol</span>,&nbsp;<span id="ast-15"><span id="ast-16">day</span>.year</span>,&nbsp;<span id="ast-17"><span id="ast-18">day</span>.month</span>,&nbsp;<span id="ast-19"><span id="ast-20">day</span>.day</span>)</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Logger</span>.info</span>(<span id="ast-25"><span id="ast-26"><span id="ast-27">'Writing&nbsp;{0}'</span>.format</span>(<span id="ast-28" class="other_trans">file_name</span>)</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-30"><span id="ast-31">open</span>(<span id="ast-32" class="other_trans">file_name</span>,&nbsp;<span id="ast-33">'w'</span>)</span>&nbsp;as&nbsp;<span id="ast-34">csv_file</span>:<span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>writer</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">csv</span>.DictWriter</span>(<span id="ast-40">csv_file</span>,&nbsp;fieldnames=<span id="ast-42"><span id="ast-43">get_header</span>(<span id="ast-44">time_frame</span>)</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>writer</span>.writeheader</span>()</span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>previous_key</span>&nbsp;=&nbsp;<span id="ast-51">None</span></span><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>current_ticks</span>&nbsp;=&nbsp;<span id="ast-54">[]</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-56" class="other_trans">tick</span>&nbsp;in&nbsp;<span id="ast-57">ticks</span>:<span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59">(<span id="ast-60" class="other_trans">time_frame</span><span id="ast-61" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-62"><span id="ast-63" class="other_trans">TimeFrame</span>.TICK</span>)</span>:<span id="ast-64"><span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write_tick</span>(<span id="ast-67">writer</span>,&nbsp;<span id="ast-68">tick</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ts</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72"><span id="ast-73">time</span>.mktime</span>(<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77">tick</span>[<span id="ast-78"><span id="ast-79">0</span></span>]</span>.timetuple</span>()</span>)</span></span><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83">int</span>(<span id="ast-84">(<span id="ast-85">ts</span>&nbsp;-&nbsp;<span id="ast-87">(<span id="ast-88" class="other_trans">ts</span>&nbsp;%&nbsp;<span id="ast-90">time_frame</span>)</span>)</span>)</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-92">(<span id="ast-94">(<span id="ast-95" class="other_trans">previous_key</span><span id="ast-96" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-97">key</span>)</span>&nbsp;and&nbsp;<span id="ast-98">(<span id="ast-99" class="other_trans">previous_key</span><span id="ast-100" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-101">None</span>)</span>)</span>:<span id="ast-102"><span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write_candle</span>(<span id="ast-105" class="other_trans">writer</span>,&nbsp;<span id="ast-106"><span id="ast-107">Candle</span>(<span id="ast-108" class="other_trans">symbol</span>,&nbsp;<span id="ast-109" class="other_trans">previous_key</span>,&nbsp;<span id="ast-110">time_frame</span>,&nbsp;<span id="ast-111" class="incorrect_node">current_ticks&nbsp;&rarr;&nbsp;key&nbsp;</span>)</span>)</span></span><span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>current_ticks</span>&nbsp;=&nbsp;<span id="ast-114">[]</span></span></span><span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>current_ticks</span>.append</span>(<span id="ast-119"><span id="ast-120" class="other_trans">tick</span>[<span id="ast-121"><span id="ast-122">1</span></span>]</span>)</span></span><span id="ast-123"><span id="ast-124" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>previous_key</span>&nbsp;=&nbsp;<span id="ast-125" class="other_trans">key</span></span></span></span><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-127">(<span id="ast-128" class="other_trans">time_frame</span><span id="ast-129" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-130"><span id="ast-131">TimeFrame</span>.TICK</span>)</span>:<span id="ast-132"><span id="ast-133"><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write_candle</span>(<span id="ast-135">writer</span>,&nbsp;<span id="ast-136"><span id="ast-137" class="other_trans">Candle</span>(<span id="ast-138">symbol</span>,&nbsp;<span id="ast-139" class="other_trans">previous_key</span>,&nbsp;<span id="ast-140" class="other_trans">time_frame</span>,&nbsp;<span id="ast-141" class="ref_node">ticks&nbsp;&rarr;&nbsp;current_ticks&nbsp;</span>)</span>)</span></span></span></span><span id="ast-142"><span id="ast-143"><span id="ast-144"><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Logger</span>.info</span>(<span id="ast-146"><span id="ast-147"><span id="ast-148">'{0}&nbsp;completed'</span>.format</span>(<span id="ast-149" class="other_trans">file_name</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_object(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">queryset</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">super</span>(<span id="ast-12" class="other_trans">ConceptHistoryCompareView</span>,&nbsp;<span id="ast-13">self</span>)</span>.get_object</span>(<span id="ast-14" class="other_trans">queryset</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17">not</span>&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">user_can_view</span>(<span id="ast-20"><span id="ast-21"><span id="ast-22">self</span>.request</span>.user</span>,&nbsp;<span id="ast-23" class="other_trans">item</span>)</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="correct_node">request&nbsp;&rarr;&nbsp;self.&nbsp;</span>.user</span>.is_anonymous</span>()</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">redirect</span>(<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">reverse</span>(<span id="ast-35">'friendly_login'</span>)</span>&nbsp;+&nbsp;<span id="ast-37">(<span id="ast-38">'?next=%s'</span>&nbsp;%&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">request</span>.path</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-43" class="other_trans">PermissionDenied</span></span></span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.model</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">item</span>.item</span>.__class__</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51" class="other_trans">item</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;start_exp(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Serves&nbsp;up&nbsp;the&nbsp;experiment&nbsp;applet.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7">not</span>&nbsp;<span id="ast-8">(<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">request</span>.args</span>.has_key</span>(<span id="ast-14">'hitId'</span>)</span>&nbsp;and&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">request</span>.args</span>.has_key</span>(<span id="ast-19">'assignmentId'</span>)</span>&nbsp;and&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans">request</span>.args</span>.has_key</span>(<span id="ast-24">'workerId'</span>)</span>)</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">ExperimentError</span>(<span id="ast-28">'hit_assign_worker_id_not_set_in_exp'</span>)</span></span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>hitId</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">request</span>.args</span>[<span id="ast-34"><span id="ast-35">'hitId'</span></span>]</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assignmentId</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans">request</span>.args</span>[<span id="ast-41"><span id="ast-42">'assignmentId'</span></span>]</span></span><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>workerId</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">request</span>.args</span>[<span id="ast-48"><span id="ast-49">'workerId'</span></span>]</span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>app</span>.logger</span>.info</span>(<span id="ast-55">(<span id="ast-56">'Accessing&nbsp;/exp:&nbsp;%(h)s&nbsp;%(a)s&nbsp;%(w)s&nbsp;'</span>&nbsp;%&nbsp;<span id="ast-58">{<span id="ast-59">'h'</span>:&nbsp;<span id="ast-62" class="other_trans">hitId</span>,&nbsp;<span id="ast-60">'a'</span>:&nbsp;<span id="ast-63" class="other_trans">assignmentId</span>,&nbsp;<span id="ast-61">'w'</span>:&nbsp;<span id="ast-64" class="other_trans">workerId</span>}</span>)</span>)</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66">(<span id="ast-67"><span id="ast-68" class="other_trans">hitId</span>[<span id="ast-69">:<span id="ast-70">5</span></span>]</span><span id="ast-71" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-72">'debug'</span>)</span>:<span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_mode</span>&nbsp;=&nbsp;<span id="ast-75">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debug_mode</span>&nbsp;=&nbsp;<span id="ast-78">False</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_get_assign_names(<span id="ast-2"><span id="ast-3" class="other_trans">targets</span>,&nbsp;<span id="ast-4" class="other_trans">load_names</span>,&nbsp;<span id="ast-5" class="other_trans">store_names</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-7" class="other_trans">target</span>&nbsp;in&nbsp;<span id="ast-8" class="other_trans">targets</span>:<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>orig_target</span>&nbsp;=&nbsp;<span id="ast-11" class="other_trans">target</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>target</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15">_get_ast_name_node</span>(<span id="ast-16" class="other_trans">target</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-20"><span id="ast-21">isinstance</span>(<span id="ast-22" class="other_trans">target</span>,&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">ast</span>.Name</span>)</span>&nbsp;and&nbsp;<span id="ast-25"><span id="ast-26">isinstance</span>(<span id="ast-27"><span id="ast-28" class="other_trans">target</span>.ctx</span>,&nbsp;<span id="ast-29"><span id="ast-30">ast</span>.Store</span>)</span>)</span>:<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>store_names</span>.add</span>(<span id="ast-35"><span id="ast-36" class="other_trans">target</span>.id</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-38">(<span id="ast-40"><span id="ast-41">isinstance</span>(<span id="ast-42" class="other_trans">target</span>,&nbsp;<span id="ast-43"><span id="ast-44">ast</span>.Name</span>)</span>&nbsp;and&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">isinstance</span>(<span id="ast-47"><span id="ast-48">target</span>.ctx</span>,&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">ast</span>.Load</span>)</span>)</span>:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>load_names&nbsp;&rarr;&nbsp;store_names&nbsp;</span>.add</span>(<span id="ast-55"><span id="ast-56">target</span>.id</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-58"><span id="ast-59">isinstance</span>(<span id="ast-60" class="other_trans">target</span>,&nbsp;<span id="ast-61"><span id="ast-62">ast</span>.Tuple</span>)</span>:<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_get_assign_names</span>(<span id="ast-66"><span id="ast-67">target</span>.elts</span>,&nbsp;<span id="ast-68">load_names</span>,&nbsp;<span id="ast-69" class="other_trans">store_names</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-71"><span id="ast-72">isinstance</span>(<span id="ast-73" class="other_trans">target</span>,&nbsp;<span id="ast-74"><span id="ast-75" class="other_trans">ast</span>.Constant</span>)</span>:<span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-77"><span id="ast-78" class="other_trans">ComplexAssignment</span>(<span id="ast-79" class="other_trans">orig_target</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-81"><span id="ast-82" class="other_trans">isinstance</span>(<span id="ast-83" class="other_trans">target</span>,&nbsp;<span id="ast-84">(<span id="ast-85"><span id="ast-86" class="other_trans">ast</span>.Dict</span>,&nbsp;<span id="ast-87"><span id="ast-88">ast</span>.List</span>)</span>)</span>:<span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-91"><span id="ast-92">isinstance</span>(<span id="ast-93" class="other_trans">target</span>,&nbsp;<span id="ast-94"><span id="ast-95">ast</span>.Call</span>)</span>:<span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-97"><span id="ast-98">ComplexAssignment</span>(<span id="ast-99">orig_target</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-101"><span id="ast-102">Exception</span>(<span id="ast-103">(<span id="ast-104">'unsupported&nbsp;assign&nbsp;target:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-106"><span id="ast-107"><span id="ast-108" class="other_trans">ast</span>.dump</span>(<span id="ast-109" class="ref_node">orig_target&nbsp;&rarr;&nbsp;target&nbsp;</span>)</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_buildMetadata(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;set&nbsp;up&nbsp;capabilities&nbsp;metadata&nbsp;objects&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>serviceelem</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>._capabilities</span>.find</span>(<span id="ast-12">'Service'</span>)</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.identification</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17">ServiceIdentification</span>(<span id="ast-18" class="other_trans">serviceelem</span>,&nbsp;<span id="ast-19"><span id="ast-20">self</span>.version</span>)</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.provider</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25">ServiceProvider</span>(<span id="ast-26" class="other_trans">serviceelem</span>)</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.operations</span>&nbsp;=&nbsp;<span id="ast-30">[]</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32" class="other_trans">elem</span>&nbsp;in&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">self</span>._capabilities</span>.find</span>(<span id="ast-38">'Capability/Request'</span>)</span>[<span id="ast-39">:</span>]</span>:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.operations</span>.append</span>(<span id="ast-45"><span id="ast-46" class="other_trans">OperationMetadata</span>(<span id="ast-47" class="other_trans">elem</span>)</span>)</span></span></span><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contents</span>&nbsp;=&nbsp;<span id="ast-51">{}</span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>caps</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57">self</span>._capabilities</span>.find</span>(<span id="ast-58">'Capability'</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-60" class="other_trans">elem</span>&nbsp;in&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">caps</span>.findall</span>(<span id="ast-64">'Layer'</span>)</span>:<span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cm</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68">ContentMetadata</span>(<span id="ast-69">elem</span>)</span></span><span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contents</span>[<span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">cm</span>.id</span></span>]</span>&nbsp;=&nbsp;<span id="ast-77" class="other_trans">cm</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-79">subelem</span>&nbsp;in&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">elem</span>.findall</span>(<span id="ast-83">'Layer'</span>)</span>:<span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subcm</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-87" class="other_trans">ContentMetadata</span>(<span id="ast-88" class="other_trans">subelem</span>,&nbsp;<span id="ast-89" class="other_trans">cm</span>)</span></span><span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contents</span>[<span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans">subcm</span>.id</span></span>]</span>&nbsp;=&nbsp;<span id="ast-97" class="other_trans">subcm</span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-99" class="other_trans">subsubelem</span>&nbsp;in&nbsp;<span id="ast-100"><span id="ast-101"><span id="ast-102">subelem</span>.findall</span>(<span id="ast-103">'Layer'</span>)</span>:<span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subsubcm</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107">ContentMetadata</span>(<span id="ast-108" class="other_trans">subsubelem</span>,&nbsp;<span id="ast-109" class="correct_node">cm&nbsp;&rarr;&nbsp;subcm&nbsp;</span>)</span></span><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contents</span>[<span id="ast-114"><span id="ast-115"><span id="ast-116">subsubcm</span>.id</span></span>]</span>&nbsp;=&nbsp;<span id="ast-117" class="other_trans">subsubcm</span></span></span></span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.exceptions</span>&nbsp;=&nbsp;<span id="ast-121">[<span id="ast-122"><span id="ast-123" class="other_trans">f</span>.text</span><span id="ast-124">&nbsp;for&nbsp;<span id="ast-125" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129">self</span>._capabilities</span>.findall</span>(<span id="ast-130">'Capability/Exception/Format'</span>)</span></span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;fillsrc(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Method&nbsp;to&nbsp;fill&nbsp;the&nbsp;src_from&nbsp;in&nbsp;case&nbsp;it&nbsp;must&nbsp;be&nbsp;logical\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>.src_from</span><span id="ast-10" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-11">None</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-13">False</span></span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17" class="other_trans">type</span>(<span id="ast-18"><span id="ast-19">self</span>.src_from</span>)</span><span id="ast-20" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-21" class="other_trans">list</span>)</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>osf</span>&nbsp;=&nbsp;<span id="ast-24">[]</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-26" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-27" class="correct_node">src_from&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-31">(<span id="ast-32"><span id="ast-33" class="other_trans">type</span>(<span id="ast-34" class="other_trans">s</span>)</span><span id="ast-35" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-36" class="other_trans">dict</span>)</span>&nbsp;and&nbsp;<span id="ast-37">(<span id="ast-38">'version'</span><span id="ast-39">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-40" class="other_trans">s</span>)</span>&nbsp;and&nbsp;<span id="ast-41">(<span id="ast-42">'suffix'</span><span id="ast-43">&nbsp;in&nbsp;</span><span id="ast-44" class="other_trans">s</span>)</span>)</span>:<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>[<span id="ast-48"><span id="ast-49">'version'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51">self</span>.version</span></span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-55">(<span id="ast-56"><span id="ast-57">type</span>(<span id="ast-58" class="other_trans">s</span>)</span><span id="ast-59" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-60" class="other_trans">dict</span>)</span>&nbsp;and&nbsp;<span id="ast-61">(<span id="ast-62">'filename'</span><span id="ast-63">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-64" class="other_trans">s</span>)</span>)</span>:<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>[<span id="ast-68"><span id="ast-69">'filename'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71">self</span>.cname</span></span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>osf</span>.append</span>(<span id="ast-76" class="other_trans">s</span>)</span></span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.src_from</span>&nbsp;=&nbsp;<span id="ast-80">[<span id="ast-81"><span id="ast-88"><span id="ast-89" class="other_trans">fromKPMGRepo</span>(**<span id="ast-90" class="other_trans">s</span>)</span>&nbsp;if&nbsp;<span id="ast-82">(<span id="ast-83"><span id="ast-84" class="other_trans">type</span>(<span id="ast-85" class="other_trans">s</span>)</span><span id="ast-86" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-87">dict</span>)</span>&nbsp;else&nbsp;<span id="ast-91" class="other_trans">s</span></span><span id="ast-92">&nbsp;for&nbsp;<span id="ast-93" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-94" class="other_trans">osf</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-96">(<span id="ast-97"><span id="ast-98" class="other_trans">type</span>(<span id="ast-99"><span id="ast-100">self</span>.src_from</span>)</span><span id="ast-101" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-102">dict</span>)</span>:<span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-104">(<span id="ast-106">(<span id="ast-107">'version'</span><span id="ast-108">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-109"><span id="ast-110">self</span>.src_from</span>)</span>&nbsp;and&nbsp;<span id="ast-111">(<span id="ast-112">'suffix'</span><span id="ast-113">&nbsp;in&nbsp;</span><span id="ast-114"><span id="ast-115">self</span>.src_from</span>)</span>)</span>:<span id="ast-116"><span id="ast-117"><span id="ast-118"><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.src_from</span>[<span id="ast-120"><span id="ast-121">'version'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-122"><span id="ast-123">self</span>.version</span></span></span><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-125">(<span id="ast-126">'filename'</span><span id="ast-127">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-128"><span id="ast-129">self</span>.src_from</span>)</span>:<span id="ast-130"><span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.src_from</span>[<span id="ast-134"><span id="ast-135">'filename'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-136"><span id="ast-137">self</span>.cname</span></span></span><span id="ast-138"><span id="ast-139"><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.src_from</span>&nbsp;=&nbsp;<span id="ast-141"><span id="ast-142">fromKPMGRepo</span>(**<span id="ast-143"><span id="ast-144">self</span>.src_from</span>)</span></span></span><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-146">True</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;is_alive(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Calls&nbsp;the&nbsp;subprocess&nbsp;'poll'&nbsp;method&nbsp;on&nbsp;our&nbsp;popen&nbsp;object&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;still&nbsp;around.&nbsp;This&nbsp;needs&nbsp;to&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;attempt&nbsp;to&nbsp;establish\\u000a&nbsp;&nbsp;&nbsp;&nbsp;communication&nbsp;with&nbsp;the&nbsp;subprocess.&nbsp;If&nbsp;it&nbsp;returns&nbsp;false&nbsp;then&nbsp;'start()'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;attempting&nbsp;to&nbsp;talk&nbsp;to&nbsp;the&nbsp;subprocess.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>.subprocess</span><span id="ast-10" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-13">False</span></span></span><span id="ast-14"><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.rc</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.subprocess</span>.poll</span>()</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24">self</span>.rc</span><span id="ast-25" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-26" class="other_trans">None</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28">True</span></span></span><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.subprocess</span>&nbsp;=&nbsp;<span id="ast-32" class="other_trans">None</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36">self</span>.rc</span><span id="ast-37" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-38">0</span>)</span>:<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.error</span>(<span id="ast-44">(<span id="ast-45">'Subprocess&nbsp;had&nbsp;non-zero&nbsp;return&nbsp;code:&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-47" class="ref_node">rc&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-49">False</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getRandomQuery(<span id="ast-2"><span id="ast-3" class="other_trans">n</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>a</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">np</span>.random</span>.choice</span>(<span id="ast-10" class="other_trans">n</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-12">True</span>:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>b</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">np</span>.random</span>.choice</span>(<span id="ast-19" class="other_trans">n</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">a</span><span id="ast-23" class="location_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-24" class="other_trans">b</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26">[<span id="ast-27" class="other_trans">a</span>,&nbsp;<span id="ast-28" class="other_trans">b</span>]</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;prepare_cards(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">evaluator</span>,&nbsp;<span id="ast-5">evaluated</span>,&nbsp;<span id="ast-6">var</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>input_repr</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10">repr</span>(<span id="ast-11">evaluated</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-14">[<span id="ast-15">{<span id="ast-16">'title'</span>:&nbsp;<span id="ast-19">'SymPy'</span>,&nbsp;<span id="ast-17">'input'</span>:&nbsp;<span id="ast-20" class="other_trans">input_repr</span>,&nbsp;<span id="ast-18">'output'</span>:&nbsp;<span id="ast-21"><span id="ast-22">mathjax_latex</span>(<span id="ast-23" class="other_trans">evaluated</span>)</span>}</span>]</span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-26" class="other_trans">convert_input</span>,&nbsp;<span id="ast-27">cards</span>)</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29">find_result_set</span>(<span id="ast-30" class="other_trans">evaluated</span>)</span></span><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-33" class="other_trans">input_evaluated</span>,&nbsp;<span id="ast-34" class="other_trans">var</span>)</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">convert_input</span>(<span id="ast-37" class="other_trans">evaluated</span>,&nbsp;<span id="ast-38">var</span>)</span></span><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>evaluator</span>.set</span>(<span id="ast-43">'input_evaluated'</span>,&nbsp;<span id="ast-44">input_evaluated</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">(<span id="ast-47" class="other_trans">var</span><span id="ast-48" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-49">None</span>)</span>:<span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>input_repr</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53">repr</span>(<span id="ast-54" class="other_trans">input_evaluated</span>)</span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>line</span>&nbsp;=&nbsp;<span id="ast-57">'simplify(input_evaluated)'</span></span><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>simplified</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans">evaluator</span>.eval</span>(<span id="ast-63">line</span>,&nbsp;use_none_for_exceptions=<span id="ast-65">True</span>)</span></span><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69">sympify</span>(<span id="ast-70"><span id="ast-71"><span id="ast-72">evaluator</span>.eval</span>(<span id="ast-73" class="other_trans">line</span>,&nbsp;use_none_for_exceptions=<span id="ast-75">True</span>)</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77">(<span id="ast-79">(<span id="ast-80" class="other_trans">simplified</span><span id="ast-81" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-82">'None'</span>)</span>&nbsp;and&nbsp;<span id="ast-83">(<span id="ast-84">simplified</span><span id="ast-85" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-86" class="other_trans">input_repr</span>)</span>)</span>:<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>.append</span>(<span id="ast-91">{<span id="ast-92">'title'</span>:&nbsp;<span id="ast-95">'Simplification'</span>,&nbsp;<span id="ast-93">'input'</span>:&nbsp;<span id="ast-96" class="other_trans">simplified</span>,&nbsp;<span id="ast-94">'output'</span>:&nbsp;<span id="ast-97"><span id="ast-98">mathjax_latex</span>(<span id="ast-99">r</span>)</span>}</span>)</span></span></span><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-101" class="other_trans">card_name</span>&nbsp;in&nbsp;<span id="ast-102" class="other_trans">cards</span>:<span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>card</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106" class="incorrect_node">get_card&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-107">card_name</span>)</span></span><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-109">(<span id="ast-110">not</span>&nbsp;<span id="ast-111">card</span>)</span>:<span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-114"><span id="ast-115"><span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>.append</span>(<span id="ast-118">{<span id="ast-119">'card'</span>:&nbsp;<span id="ast-125" class="other_trans">card_name</span>,&nbsp;<span id="ast-120">'var'</span>:&nbsp;<span id="ast-126"><span id="ast-127">repr</span>(<span id="ast-128" class="other_trans">var</span>)</span>,&nbsp;<span id="ast-121">'title'</span>:&nbsp;<span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans">card</span>.format_title</span>(<span id="ast-132" class="ref_node">input_repr&nbsp;&rarr;&nbsp;input_evaluated&nbsp;</span>)</span>,&nbsp;<span id="ast-122">'input'</span>:&nbsp;<span id="ast-133"><span id="ast-134"><span id="ast-135">card</span>.format_input</span>(<span id="ast-136">input_repr</span>,&nbsp;<span id="ast-137">var</span>)</span>,&nbsp;<span id="ast-123">'pre_output'</span>:&nbsp;<span id="ast-138"><span id="ast-139" class="other_trans">latex</span>(<span id="ast-140"><span id="ast-141"><span id="ast-142">card</span>.pre_output_function</span>(<span id="ast-143">input_repr</span>,&nbsp;<span id="ast-144" class="other_trans">var</span>)</span>)</span>,&nbsp;<span id="ast-124">'parameters'</span>:&nbsp;<span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148">card</span>.card_info</span>.get</span>(<span id="ast-149">'parameters'</span>,&nbsp;<span id="ast-150">[]</span>)</span>}</span>)</span></span><span id="ast-151"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-152">(<span id="ast-153">SyntaxError</span>,&nbsp;<span id="ast-154">ValueError</span>)</span>&nbsp;as&nbsp;<span id="ast-155">e</span>:<span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span></span></span><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-158">result</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;is_installed(<span id="ast-2"><span id="ast-3" class="other_trans">model_class</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;True&nbsp;if&nbsp;a&nbsp;model_class&nbsp;is&nbsp;installed.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;model_class._meta.installed&nbsp;is&nbsp;only&nbsp;reliable&nbsp;in&nbsp;Django&nbsp;1.7+\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">django</span>.VERSION</span>[<span id="ast-11">:<span id="ast-12">2</span></span>]</span><span id="ast-13" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-14">(<span id="ast-15">1</span>,&nbsp;<span id="ast-16">7</span>)</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">model_class</span>._meta</span>.installed</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">re</span>.sub</span>(<span id="ast-26">'\\\\.models.*$'</span>,&nbsp;<span id="ast-27">''</span>,&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">model_class</span>.__module__</span>)</span><span id="ast-30">&nbsp;in&nbsp;</span><span id="ast-31"><span id="ast-32" class="other_trans">settings</span>.INSTALLED_APPS</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;buildProtocol(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">addr</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-9">(<span id="ast-10">'%s:&nbsp;New&nbsp;connection.'</span>&nbsp;%&nbsp;<span id="ast-12"><span id="ast-13">self</span>.name</span>)</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>circuit</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">network</span>.Circuit</span>(<span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.transport_class</span>()</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">OBFSSOCKSv5Protocol</span>(<span id="ast-25" class="other_trans">circuit</span>,&nbsp;<span id="ast-26" class="correct_node">pt_config&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;sendfile(<span id="ast-2"><span id="ast-3" class="other_trans">fdout</span>,&nbsp;<span id="ast-4" class="other_trans">fdin</span>,&nbsp;<span id="ast-5" class="other_trans">offset</span>,&nbsp;<span id="ast-6" class="other_trans">nbytes</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10">sys</span>.platform</span><span id="ast-11" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-12">'darwin'</span>)</span>:<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_sendfile</span>.argtypes</span>&nbsp;=&nbsp;<span id="ast-16">[<span id="ast-17"><span id="ast-18">ctypes</span>.c_int</span>,&nbsp;<span id="ast-19"><span id="ast-20">ctypes</span>.c_int</span>,&nbsp;<span id="ast-21"><span id="ast-22">ctypes</span>.c_uint64</span>,&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25">ctypes</span>.POINTER</span>(<span id="ast-26"><span id="ast-27">ctypes</span>.c_uint64</span>)</span>,&nbsp;<span id="ast-28"><span id="ast-29">ctypes</span>.c_voidp</span>,&nbsp;<span id="ast-30"><span id="ast-31">ctypes</span>.c_int</span>]</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_nbytes</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">ctypes</span>.c_uint64</span>(<span id="ast-37" class="incorrect_node">nbytes&nbsp;&rarr;&nbsp;_nbytes&nbsp;</span>)</span></span><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41">_sendfile</span>(<span id="ast-42">fdin</span>,&nbsp;<span id="ast-43" class="other_trans">fdout</span>,&nbsp;<span id="ast-44" class="other_trans">offset</span>,&nbsp;<span id="ast-45" class="other_trans">_nbytes</span>,&nbsp;<span id="ast-46" class="other_trans">None</span>,&nbsp;<span id="ast-47">0</span>)</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-50" class="other_trans">result</span><span id="ast-51" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-52">-1</span>)</span>:<span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">ctypes</span>.get_errno</span>()</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59">(<span id="ast-61">(<span id="ast-62">e</span><span id="ast-63" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-64"><span id="ast-65">errno</span>.EAGAIN</span>)</span>&nbsp;and&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">_nbytes</span>.value</span>)</span>:<span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-69"><span id="ast-70" class="ref_node">nbytes&nbsp;&rarr;&nbsp;_nbytes&nbsp;</span>.value</span></span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-72"><span id="ast-73">OSError</span>(<span id="ast-74">e</span>,&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77">os</span>.strerror</span>(<span id="ast-78" class="other_trans">e</span>)</span>)</span></span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-80"><span id="ast-81" class="other_trans">_nbytes</span>.value</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-83">(<span id="ast-84"><span id="ast-85">sys</span>.platform</span><span id="ast-86">&nbsp;in&nbsp;</span><span id="ast-87">(<span id="ast-88">'freebsd'</span>,&nbsp;<span id="ast-89">'dragonfly'</span>)</span>)</span>:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_sendfile</span>.argtypes</span>&nbsp;=&nbsp;<span id="ast-93">[<span id="ast-94"><span id="ast-95">ctypes</span>.c_int</span>,&nbsp;<span id="ast-96"><span id="ast-97">ctypes</span>.c_int</span>,&nbsp;<span id="ast-98"><span id="ast-99">ctypes</span>.c_uint64</span>,&nbsp;<span id="ast-100"><span id="ast-101">ctypes</span>.c_uint64</span>,&nbsp;<span id="ast-102"><span id="ast-103">ctypes</span>.c_voidp</span>,&nbsp;<span id="ast-104"><span id="ast-105"><span id="ast-106">ctypes</span>.POINTER</span>(<span id="ast-107"><span id="ast-108">ctypes</span>.c_uint64</span>)</span>,&nbsp;<span id="ast-109"><span id="ast-110">ctypes</span>.c_int</span>]</span></span><span id="ast-111"><span id="ast-112" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_sbytes</span>&nbsp;=&nbsp;<span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans">ctypes</span>.c_uint64</span>()</span></span><span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-118"><span id="ast-119">_sendfile</span>(<span id="ast-120">fdin</span>,&nbsp;<span id="ast-121">fdout</span>,&nbsp;<span id="ast-122" class="other_trans">offset</span>,&nbsp;<span id="ast-123">nbytes</span>,&nbsp;<span id="ast-124">None</span>,&nbsp;<span id="ast-125" class="other_trans">_sbytes</span>,&nbsp;<span id="ast-126">0</span>)</span></span><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-128">(<span id="ast-129" class="other_trans">result</span><span id="ast-130" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-131">-1</span>)</span>:<span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>&nbsp;=&nbsp;<span id="ast-134"><span id="ast-135"><span id="ast-136">ctypes</span>.get_errno</span>()</span></span><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-138">(<span id="ast-140">(<span id="ast-141" class="other_trans">e</span><span id="ast-142" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-143"><span id="ast-144" class="other_trans">errno</span>.EAGAIN</span>)</span>&nbsp;and&nbsp;<span id="ast-145"><span id="ast-146" class="other_trans">_sbytes</span>.value</span>)</span>:<span id="ast-147"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-148"><span id="ast-149">_sbytes</span>.value</span></span></span><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-151"><span id="ast-152">OSError</span>(<span id="ast-153">e</span>,&nbsp;<span id="ast-154"><span id="ast-155"><span id="ast-156" class="other_trans">os</span>.strerror</span>(<span id="ast-157" class="other_trans">e</span>)</span>)</span></span></span><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-159"><span id="ast-160" class="other_trans">_sbytes</span>.value</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;triggerAction(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">action</span>,&nbsp;<span id="ast-5" class="other_trans">main</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-8">0</span></span><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>no</span>&nbsp;=&nbsp;<span id="ast-11">False</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>up</span>&nbsp;=&nbsp;<span id="ast-14">False</span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>my_min</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.minimum</span>()</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>my_max</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24">self</span>.maximum</span>()</span></span><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>altControl</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28">QxtSpanSlider</span>.LowerHandle</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32">self</span>.mainControl</span><span id="ast-33" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-34"><span id="ast-35">QxtSpanSlider</span>.LowerHandle</span>)</span>:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>altControl</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39">QxtSpanSlider</span>.UpperHandle</span></span></span><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.blockTracking</span>&nbsp;=&nbsp;<span id="ast-43">True</span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>isUpperHandle</span>&nbsp;=&nbsp;<span id="ast-46">(<span id="ast-48">(<span id="ast-50" class="other_trans">main</span>&nbsp;and&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-53">self</span>.mainControl</span><span id="ast-54" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-55"><span id="ast-56">QxtSpanSlider</span>.UpperHandle</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-57">(<span id="ast-59">(<span id="ast-60">not</span>&nbsp;<span id="ast-61" class="other_trans">main</span>)</span>&nbsp;and&nbsp;<span id="ast-62">(<span id="ast-63" class="other_trans">altControl</span><span id="ast-64" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-65"><span id="ast-66" class="other_trans">QxtSpanSlider</span>.UpperHandle</span>)</span>)</span>)</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-68">(<span id="ast-69" class="other_trans">action</span><span id="ast-70" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-71"><span id="ast-72" class="other_trans">QAbstractSlider</span>.SliderSingleStepAdd</span>)</span>:<span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-74">isUpperHandle</span>:<span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78">clamp</span>(<span id="ast-79">(<span id="ast-80"><span id="ast-81">self</span>.upper</span>&nbsp;+&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85">self</span>.singleStep</span>()</span>)</span>,&nbsp;<span id="ast-86" class="other_trans">my_min</span>,&nbsp;<span id="ast-87">my_max</span>)</span></span><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>up</span>&nbsp;=&nbsp;<span id="ast-90">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94">clamp</span>(<span id="ast-95">(<span id="ast-96" class="correct_node">lower&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;+&nbsp;<span id="ast-98"><span id="ast-99"><span id="ast-100">self</span>.singleStep</span>()</span>)</span>,&nbsp;<span id="ast-101" class="other_trans">my_min</span>,&nbsp;<span id="ast-102" class="other_trans">my_max</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-104">(<span id="ast-105" class="other_trans">action</span><span id="ast-106" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-107"><span id="ast-108" class="other_trans">QAbstractSlider</span>.SliderSingleStepSub</span>)</span>:<span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-110" class="other_trans">isUpperHandle</span>:<span id="ast-111"><span id="ast-112" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-113"><span id="ast-114" class="other_trans">clamp</span>(<span id="ast-115">(<span id="ast-116"><span id="ast-117">self</span>.upper</span>&nbsp;-&nbsp;<span id="ast-119"><span id="ast-120"><span id="ast-121">self</span>.singleStep</span>()</span>)</span>,&nbsp;<span id="ast-122">my_min</span>,&nbsp;<span id="ast-123">my_max</span>)</span></span><span id="ast-124"><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>up</span>&nbsp;=&nbsp;<span id="ast-126">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-129"><span id="ast-130">clamp</span>(<span id="ast-131">(<span id="ast-132"><span id="ast-133">self</span>.lower</span>&nbsp;-&nbsp;<span id="ast-135"><span id="ast-136"><span id="ast-137">self</span>.singleStep</span>()</span>)</span>,&nbsp;<span id="ast-138" class="other_trans">my_min</span>,&nbsp;<span id="ast-139">my_max</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-141">(<span id="ast-142" class="other_trans">action</span><span id="ast-143" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-144"><span id="ast-145">QAbstractSlider</span>.SliderToMinimum</span>)</span>:<span id="ast-146"><span id="ast-147" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-148" class="other_trans">my_min</span></span><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-150" class="other_trans">isUpperHandle</span>:<span id="ast-151"><span id="ast-152"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>up</span>&nbsp;=&nbsp;<span id="ast-153">True</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-155">(<span id="ast-156" class="other_trans">action</span><span id="ast-157" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-158"><span id="ast-159">QAbstractSlider</span>.SliderToMaximum</span>)</span>:<span id="ast-160"><span id="ast-161" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-162">my_max</span></span><span id="ast-163"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-164">isUpperHandle</span>:<span id="ast-165"><span id="ast-166"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>up</span>&nbsp;=&nbsp;<span id="ast-167">True</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-169">(<span id="ast-170" class="other_trans">action</span><span id="ast-171" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-172"><span id="ast-173" class="other_trans">QAbstractSlider</span>.SliderMove</span>)</span>:<span id="ast-174"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-175">isUpperHandle</span>:<span id="ast-176"><span id="ast-177" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>up</span>&nbsp;=&nbsp;<span id="ast-178">True</span></span></span><span id="ast-179"><span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>no</span>&nbsp;=&nbsp;<span id="ast-181">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-183">(<span id="ast-184">action</span><span id="ast-185" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-186"><span id="ast-187">QAbstractSlider</span>.SliderNoAction</span>)</span>:<span id="ast-188"><span id="ast-189" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>no</span>&nbsp;=&nbsp;<span id="ast-190">True</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">sites</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.http</span>.request</span>(<span id="ast-12">'get'</span>,&nbsp;<span id="ast-13"><span id="ast-14">self</span>.url</span>)</span>.text</span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>match</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">re</span>.search</span>(<span id="ast-20">'src=(\\\\"|\\\\\')(http://www.svt.se/wd[^\\\\\'\\\\"]+)(\\\\"|\\\\\')'</span>,&nbsp;<span id="ast-21" class="other_trans">data</span>)</span></span><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>stream</span>&nbsp;=&nbsp;<span id="ast-24">None</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">match</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31">match</span>.group</span>(<span id="ast-32">2</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-34">i</span>&nbsp;in&nbsp;<span id="ast-35">sites</span>:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39">i</span>.handles</span>(<span id="ast-40">url</span>)</span>:<span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">url</span>.replace</span>(<span id="ast-48">'&amp;amp;'</span>,&nbsp;<span id="ast-49">'&amp;'</span>)</span>.replace</span>(<span id="ast-50">'&amp;#038;'</span>,&nbsp;<span id="ast-51">'&amp;'</span>)</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-53">(<span id="ast-54">url</span>,&nbsp;<span id="ast-55"><span id="ast-56">i</span>(<span id="ast-57">url</span>)</span>)</span></span></span></span></span><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>match</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62">re</span>.search</span>(<span id="ast-63">'src=\\\\"(http://player.vimeo.com/video/[0-9]+)\\\\"&nbsp;'</span>,&nbsp;<span id="ast-64" class="other_trans">data</span>)</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66">match</span>:<span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-68" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-69">sites</span>:<span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans">i</span>.handles</span>(<span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">match</span>.group</span>(<span id="ast-77">1</span>)</span>)</span>:<span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-79">(<span id="ast-80"><span id="ast-81"><span id="ast-82">match</span>.group</span>(<span id="ast-83">1</span>)</span>,&nbsp;<span id="ast-84"><span id="ast-85">i</span>(<span id="ast-86" class="other_trans">url</span>)</span>)</span></span></span></span></span><span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>match</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91">re</span>.search</span>(<span id="ast-92">'tv4play.se/iframe/video/(\\\\d+)?'</span>,&nbsp;<span id="ast-93" class="other_trans">data</span>)</span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95">match</span>:<span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-98">(<span id="ast-99">'http://www.tv4play.se/?video_id=%s'</span>&nbsp;%&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103">match</span>.group</span>(<span id="ast-104">1</span>)</span>)</span></span><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-106" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-107" class="other_trans">sites</span>:<span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-109"><span id="ast-110"><span id="ast-111">i</span>.handles</span>(<span id="ast-112">url</span>)</span>:<span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-114">(<span id="ast-115">url</span>,&nbsp;<span id="ast-116"><span id="ast-117" class="other_trans">i</span>(<span id="ast-118">url</span>)</span>)</span></span></span></span></span><span id="ast-119"><span id="ast-120" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>match</span>&nbsp;=&nbsp;<span id="ast-121"><span id="ast-122"><span id="ast-123">re</span>.search</span>(<span id="ast-124">'embed.bambuser.com/broadcast/(\\\\d+)'</span>,&nbsp;<span id="ast-125" class="other_trans">data</span>)</span></span><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-127" class="other_trans">match</span>:<span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-130">(<span id="ast-131">'http://bambuser.com/v/%s'</span>&nbsp;%&nbsp;<span id="ast-133"><span id="ast-134"><span id="ast-135">match</span>.group</span>(<span id="ast-136">1</span>)</span>)</span></span><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-138" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-139">sites</span>:<span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-141"><span id="ast-142"><span id="ast-143" class="other_trans">i</span>.handles</span>(<span id="ast-144">url</span>)</span>:<span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-146">(<span id="ast-147">url</span>,&nbsp;<span id="ast-148"><span id="ast-149">i</span>(<span id="ast-150">url</span>)</span>)</span></span></span></span></span><span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>match</span>&nbsp;=&nbsp;<span id="ast-153"><span id="ast-154"><span id="ast-155">re</span>.search</span>(<span id="ast-156">'src="(http://tv.aftonbladet[^"]*)"'</span>,&nbsp;<span id="ast-157">data</span>)</span></span><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-159">match</span>:<span id="ast-160"><span id="ast-161" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-162"><span id="ast-163"><span id="ast-164">match</span>.group</span>(<span id="ast-165">1</span>)</span></span><span id="ast-166"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-167">i</span>&nbsp;in&nbsp;<span id="ast-168" class="other_trans">sites</span>:<span id="ast-169"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-170"><span id="ast-171"><span id="ast-172">i</span>.handles</span>(<span id="ast-173" class="other_trans">url</span>)</span>:<span id="ast-174"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-175">(<span id="ast-176" class="other_trans">url</span>,&nbsp;<span id="ast-177"><span id="ast-178">i</span>(<span id="ast-179">url</span>)</span>)</span></span></span></span></span><span id="ast-180"><span id="ast-181" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>match</span>&nbsp;=&nbsp;<span id="ast-182"><span id="ast-183"><span id="ast-184">re</span>.search</span>(<span id="ast-185">'a&nbsp;href="(http://tv.aftonbladet[^"]*)"&nbsp;class="abVi'</span>,&nbsp;<span id="ast-186" class="other_trans">data</span>)</span></span><span id="ast-187"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-188" class="other_trans">match</span>:<span id="ast-189"><span id="ast-190" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-191"><span id="ast-192"><span id="ast-193" class="other_trans">match</span>.group</span>(<span id="ast-194">1</span>)</span></span><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-196">i</span>&nbsp;in&nbsp;<span id="ast-197" class="other_trans">sites</span>:<span id="ast-198"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-199"><span id="ast-200"><span id="ast-201">i</span>.handles</span>(<span id="ast-202">url</span>)</span>:<span id="ast-203"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-204">(<span id="ast-205">url</span>,&nbsp;<span id="ast-206"><span id="ast-207">i</span>(<span id="ast-208" class="other_trans">url</span>)</span>)</span></span></span></span></span><span id="ast-209"><span id="ast-210"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>match</span>&nbsp;=&nbsp;<span id="ast-211"><span id="ast-212"><span id="ast-213">re</span>.search</span>(<span id="ast-214">"iframe&nbsp;src='(http://www.svtplay[^']*)'"</span>,&nbsp;<span id="ast-215">data</span>)</span></span><span id="ast-216"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-217" class="other_trans">match</span>:<span id="ast-218"><span id="ast-219" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-220"><span id="ast-221"><span id="ast-222" class="other_trans">match</span>.group</span>(<span id="ast-223">1</span>)</span></span><span id="ast-224"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-225" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-226" class="other_trans">sites</span>:<span id="ast-227"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-228"><span id="ast-229"><span id="ast-230">i</span>.handles</span>(<span id="ast-231">url</span>)</span>:<span id="ast-232"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-233">(<span id="ast-234" class="other_trans">url</span>,&nbsp;<span id="ast-235"><span id="ast-236" class="other_trans">i</span>(<span id="ast-237" class="other_trans">url</span>)</span>)</span></span></span></span></span><span id="ast-238"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-239">(<span id="ast-240" class="location_node">url&nbsp;&rarr;&nbsp;self.,&nbsp;pred:&nbsp;sites&nbsp;</span>,&nbsp;<span id="ast-241">stream</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;stop(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">now</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>body</span>&nbsp;=&nbsp;<span id="ast-8">{<span id="ast-9">'kind'</span>:&nbsp;<span id="ast-12">'DeleteOptions'</span>,&nbsp;<span id="ast-10">'apiVersion'</span>:&nbsp;<span id="ast-13">'v1'</span>,&nbsp;<span id="ast-11">'gracePeriodSeconds'</span>:&nbsp;<span id="ast-14">0</span>}</span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.httpclient</span>.fetch</span>(<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.request</span>(url=<span id="ast-25"><span id="ast-26" class="other_trans">k8s_url</span>(<span id="ast-27"><span id="ast-28">self</span>.namespace</span>,&nbsp;<span id="ast-29">'pods'</span>,&nbsp;<span id="ast-30"><span id="ast-31">self</span>.pod_name</span>)</span>,&nbsp;method=<span id="ast-33">'DELETE'</span>,&nbsp;body=<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">json</span>.dumps</span>(<span id="ast-38" class="other_trans">body</span>)</span>,&nbsp;headers=<span id="ast-40">{<span id="ast-41">'Content-Type'</span>:&nbsp;<span id="ast-42">'application/json'</span>}</span>,&nbsp;allow_nonstandard_methods=<span id="ast-44">True</span>)</span>)</span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">(<span id="ast-47">not</span>&nbsp;<span id="ast-48" class="other_trans">now</span>)</span>:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-50">True</span>:<span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-53">yield&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">self</span>.get_pod_info</span>(<span id="ast-57"><span id="ast-58">self</span>.pod_name</span>)</span></span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-61" class="other_trans">data</span><span id="ast-62" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-63" class="other_trans">None</span>)</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-69">5</span>)</span></span></span></span></span></span></span><br /><br /><hr />
</body></html>
