<html><head><style>
.ast { font-family: monospace; font-size: 12pt; }
.correct_node { font-weight: bold; background-color: green; color: white; }
.incorrect_node { font-weight: bold; background-color: red; color: white; }
.ref_node { font-weight: bold; background-color: blue; color: white; }
.location_node { font-weight: bold; background-color: #ff00ff; color: white; }
.other_trans { color: #3333ff; }
.whitespace { background-color: white; color: black; }
.pred_rank_wrapper { font-weight: bold; }
.correct_pred_rank { font-weight: bold; color: green;}
.incorrect_pred_rank { font-weight: bold; color: red; }
.rank_type { font-weight: bold; }
.description { font-size: 16pt; }
</style></head><body><div class="description">
<div><b>This is part 10/10 of the system predictions for the Real-Bug Test set. This system achieves 41% Repair Accuracy and 54% Location Accuracy.</b></div><br /><div><b>Annotations</b>:</div><ul><li><span class="correct_node">foo &rarr; bar</span> - The bug was located at this node, and the system <i>correctly</i> predicted both the location and the repair as its top prediction.</li><li><span class="incorrect_node">foo &rarr; bar</span> - The system <i>incorrectly</i> predicted this repair as its top prediction.</li><li><span class="ref_node">foo &rarr; bar</span> - If the system incorrectly predicted the repair, this was the correct repair it should have made.</li><li><span class="location_node">foo &rarr; bar, pred: zap</span> - The system predicted the correct <i>location</i> of the repair, but the wrong repair label. It should have predicted 'bar', but it predicted 'zap' instead.</li></ul><div>The part before the arrow ('foo') is what the system actually saw at test time. Other candidate repair locations which the system could have chosen are marked in <span class="other_trans">this color</span>. For clarity the actual labels for those locations are not shown.</div></div><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getfullblock(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">block_hash</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>.bitcoind</span>(<span id="ast-10">'getblock'</span>,&nbsp;<span id="ast-11">[<span id="ast-12" class="other_trans">block_hash</span>]</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rawtxreq</span>&nbsp;=&nbsp;<span id="ast-15">[]</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-18">0</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-20" class="other_trans">txid</span>&nbsp;in&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">block</span>[<span id="ast-23"><span id="ast-24">'tx'</span></span>]</span>:<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rawtxreq</span>.append</span>(<span id="ast-29">{<span id="ast-30">'method'</span>:&nbsp;<span id="ast-33">'getrawtransaction'</span>,&nbsp;<span id="ast-31">'params'</span>:&nbsp;<span id="ast-34">[<span id="ast-35" class="other_trans">txid</span>]</span>,&nbsp;<span id="ast-32">'id'</span>:&nbsp;<span id="ast-36" class="other_trans">i</span>}</span>)</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-40">1</span></span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>postdata</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">dumps</span>(<span id="ast-45" class="other_trans">rawtxreq</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>respdata</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53">urllib</span>.urlopen</span>(<span id="ast-54"><span id="ast-55">self</span>.bitcoind_url</span>,&nbsp;<span id="ast-56" class="other_trans">postdata</span>)</span>.read</span>()</span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>traceback</span>.print_exc</span>(file=<span id="ast-63"><span id="ast-64" class="other_trans">sys</span>.stdout</span>)</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68"><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.shared</span>.stop</span>()</span></span></span></span><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73">loads</span>(<span id="ast-74" class="other_trans">respdata</span>)</span></span><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rawtxdata</span>&nbsp;=&nbsp;<span id="ast-77">[]</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-79" class="other_trans">ir</span>&nbsp;in&nbsp;<span id="ast-80" class="other_trans">r</span>:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-82">(<span id="ast-83"><span id="ast-84" class="other_trans">ir</span>[<span id="ast-85"><span id="ast-86">'error'</span></span>]</span><span id="ast-87" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-88" class="other_trans">None</span>)</span>:<span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-90"><span id="ast-91" class="other_trans">BaseException</span>(<span id="ast-92"><span id="ast-93" class="ref_node">r&nbsp;&rarr;&nbsp;ir&nbsp;</span>[<span id="ast-94"><span id="ast-95">'error'</span></span>]</span>)</span></span></span><span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rawtxdata</span>.append</span>(<span id="ast-100"><span id="ast-101" class="other_trans">ir</span>[<span id="ast-102"><span id="ast-103">'result'</span></span>]</span>)</span></span></span><span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>[<span id="ast-107"><span id="ast-108">'tx'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-109" class="other_trans">rawtxdata</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-111">block</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Main&nbsp;run&nbsp;loop&nbsp;for&nbsp;all&nbsp;spouts.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Performs&nbsp;initial&nbsp;handshake&nbsp;with&nbsp;Storm&nbsp;and&nbsp;reads&nbsp;tuples&nbsp;handing&nbsp;them&nbsp;off\\u000a&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;subclasses.&nbsp;&nbsp;Any&nbsp;exceptions&nbsp;are&nbsp;caught&nbsp;and&nbsp;logged&nbsp;back&nbsp;to&nbsp;Storm\\u000a&nbsp;&nbsp;&nbsp;&nbsp;prior&nbsp;to&nbsp;the&nbsp;Python&nbsp;process&nbsp;exiting.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Subclasses&nbsp;should&nbsp;**not**&nbsp;override&nbsp;this&nbsp;method.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-8" class="other_trans">storm_conf</span>,&nbsp;<span id="ast-9" class="other_trans">context</span>)</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11" class="correct_node">read_handshake&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._setup_component</span>(<span id="ast-16" class="other_trans">storm_conf</span>,&nbsp;<span id="ast-17" class="other_trans">context</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;unpin_variant(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">institute</span>,&nbsp;<span id="ast-5" class="other_trans">case</span>,&nbsp;<span id="ast-6" class="other_trans">user</span>,&nbsp;<span id="ast-7" class="other_trans">link</span>,&nbsp;<span id="ast-8" class="other_trans">variant</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Create&nbsp;an&nbsp;event&nbsp;for&nbsp;unpinning&nbsp;a&nbsp;variant.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Arguments:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;institute&nbsp;(Institute):&nbsp;A&nbsp;Institute&nbsp;object\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;(Case):&nbsp;Case&nbsp;object\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user&nbsp;(User):&nbsp;A&nbsp;User&nbsp;object\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;link&nbsp;(str):&nbsp;The&nbsp;url&nbsp;to&nbsp;be&nbsp;used&nbsp;in&nbsp;the&nbsp;event\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;variant&nbsp;(Variant):&nbsp;A&nbsp;variant&nbsp;object\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.info</span>(<span id="ast-15"><span id="ast-16"><span id="ast-17">'Creating&nbsp;event&nbsp;for&nbsp;unpinning&nbsp;variant&nbsp;{0}'</span>.format</span>(<span id="ast-18"><span id="ast-19" class="other_trans">variant</span>.display_name</span>)</span>)</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.info</span>(<span id="ast-24">'Remove&nbsp;variant&nbsp;from&nbsp;list&nbsp;of&nbsp;references&nbsp;in&nbsp;the&nbsp;case&nbsp;model'</span>)</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>case</span>.suspects</span>.remove</span>(<span id="ast-30" class="other_trans">variant</span>)</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>case</span>.save</span>()</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>create_event&nbsp;&rarr;&nbsp;self.&nbsp;</span>(institute=<span id="ast-39" class="other_trans">institute</span>,&nbsp;case=<span id="ast-41" class="other_trans">case</span>,&nbsp;user=<span id="ast-43" class="other_trans">user</span>,&nbsp;link=<span id="ast-45" class="other_trans">link</span>,&nbsp;category=<span id="ast-47">'variant'</span>,&nbsp;verb=<span id="ast-49">'unpin'</span>,&nbsp;variant_id=<span id="ast-51"><span id="ast-52" class="other_trans">variant</span>.variant_id</span>,&nbsp;subject=<span id="ast-54"><span id="ast-55" class="other_trans">variant</span>.display_name</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;GetUserCredentials(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Prompts&nbsp;the&nbsp;user&nbsp;for&nbsp;a&nbsp;username&nbsp;and&nbsp;password.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Only&nbsp;use&nbsp;keyring&nbsp;on&nbsp;the&nbsp;initial&nbsp;call.&nbsp;If&nbsp;the&nbsp;keyring&nbsp;contains&nbsp;the&nbsp;wrong\\u000a&nbsp;&nbsp;&nbsp;&nbsp;password,&nbsp;we&nbsp;want&nbsp;to&nbsp;give&nbsp;the&nbsp;user&nbsp;a&nbsp;chance&nbsp;to&nbsp;enter&nbsp;another&nbsp;one.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>global&nbsp;keyring</span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>email</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10">self</span>.email</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13">email</span><span id="ast-14" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-15" class="other_trans">None</span>)</span>:<span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>email</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19">GetEmail</span>(<span id="ast-20">(<span id="ast-21">'Email&nbsp;(login&nbsp;for&nbsp;uploading&nbsp;to&nbsp;%s)'</span>&nbsp;%&nbsp;<span id="ast-23"><span id="ast-24">self</span>.server</span>)</span>)</span></span></span><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>password</span>&nbsp;=&nbsp;<span id="ast-27" class="other_trans">None</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-31" class="incorrect_node">keyring&nbsp;&rarr;&nbsp;email&nbsp;</span>&nbsp;and&nbsp;<span id="ast-32">(<span id="ast-33">not</span>&nbsp;<span id="ast-34">(<span id="ast-35" class="other_trans">email</span><span id="ast-36">&nbsp;in&nbsp;</span><span id="ast-37"><span id="ast-38">self</span>.accounts_seen</span>)</span>)</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>password</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">keyring</span>.get_password</span>(<span id="ast-45"><span id="ast-46">self</span>.host</span>,&nbsp;<span id="ast-47" class="other_trans">email</span>)</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-50">'Failed&nbsp;to&nbsp;get&nbsp;password&nbsp;from&nbsp;keyring'</span></span><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>keyring</span>&nbsp;=&nbsp;<span id="ast-53" class="other_trans">None</span></span></span></span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">password</span><span id="ast-57" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-58">None</span>)</span>:<span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-60">'Using&nbsp;password&nbsp;from&nbsp;system&nbsp;keyring.'</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.accounts_seen</span>.add</span>(<span id="ast-66" class="other_trans">email</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>password</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">getpass</span>.getpass</span>(<span id="ast-72">(<span id="ast-73">'Password&nbsp;for&nbsp;%s:&nbsp;'</span>&nbsp;%&nbsp;<span id="ast-75" class="other_trans">email</span>)</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77" class="other_trans">keyring</span>:<span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>answer</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83">raw_input</span>(<span id="ast-84">'Store&nbsp;password&nbsp;in&nbsp;system&nbsp;keyring?(y/N)&nbsp;'</span>)</span>.strip</span>()</span></span><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-86">(<span id="ast-87" class="other_trans">answer</span><span id="ast-88" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-89">'y'</span>)</span>:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>keyring</span>.set_password</span>(<span id="ast-94" class="ref_node">host&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-95" class="other_trans">email</span>,&nbsp;<span id="ast-96" class="other_trans">password</span>)</span></span><span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.accounts_seen</span>.add</span>(<span id="ast-102" class="other_trans">email</span>)</span></span></span></span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-104">(<span id="ast-105" class="other_trans">email</span>,&nbsp;<span id="ast-106" class="other_trans">password</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>recipient</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7">self</span>.recipient</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">isinstance</span>(<span id="ast-11">recipient</span>,&nbsp;<span id="ast-12"><span id="ast-13">get_user_model</span>()</span>)</span>:<span id="ast-14"><span id="ast-15" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>email&nbsp;&rarr;&nbsp;language&nbsp;</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">recipient</span>.email</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>language</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">get_users_language</span>(<span id="ast-23" class="other_trans">recipient</span>)</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-25">LanguageStoreNotAvailable</span>:<span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>language</span>&nbsp;=&nbsp;<span id="ast-28">None</span></span></span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31" class="other_trans">language</span><span id="ast-32" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-33" class="other_trans">None</span>)</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>activate</span>(<span id="ast-37" class="other_trans">language</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>email</span>&nbsp;=&nbsp;<span id="ast-40">recipient</span></span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44">Context</span>(<span id="ast-45"><span id="ast-46">self</span>.default_context</span>)</span></span><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>[<span id="ast-50"><span id="ast-51">'recipient'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-52" class="other_trans">recipient</span></span><span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>[<span id="ast-56"><span id="ast-57">'email'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-58">email</span></span><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>subject</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64">render_to_string</span>(<span id="ast-65"><span id="ast-66">self</span>.subject_path</span>,&nbsp;<span id="ast-67" class="other_trans">context</span>)</span>.strip</span>()</span></span><span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>subject</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72">''</span>.join</span>(<span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans">subject</span>.splitlines</span>()</span>)</span></span><span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>text</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79">render_to_string</span>(<span id="ast-80"><span id="ast-81">self</span>.text_path</span>,&nbsp;<span id="ast-82" class="other_trans">context</span>)</span></span><span id="ast-83"><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-85"><span id="ast-86" class="other_trans">EmailMultiAlternatives</span>(<span id="ast-87" class="other_trans">subject</span>,&nbsp;<span id="ast-88" class="other_trans">text</span>,&nbsp;<span id="ast-89"><span id="ast-90">self</span>.from_email</span>,&nbsp;<span id="ast-91">[<span id="ast-92">email</span>]</span>)</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>body</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97">render_to_string</span>(<span id="ast-98"><span id="ast-99">self</span>.html_path</span>,&nbsp;<span id="ast-100" class="other_trans">context</span>)</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-102">pynliner</span>:<span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>body</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107">pynliner</span>.fromString</span>(<span id="ast-108" class="other_trans">body</span>)</span></span></span><span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>.attach_alternative</span>(<span id="ast-113">body</span>,&nbsp;<span id="ast-114">'text/html'</span>)</span></span><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-116" class="other_trans">TemplateDoesNotExist</span>:<span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.info</span>(<span id="ast-121">(<span id="ast-122">'Email&nbsp;sent&nbsp;without&nbsp;HTML,&nbsp;since&nbsp;%s&nbsp;not&nbsp;found'</span>&nbsp;%&nbsp;<span id="ast-124" class="ref_node">html_path&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;serve(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">server</span>,&nbsp;<span id="ast-6" class="other_trans">host</span>,&nbsp;<span id="ast-8">port</span>,&nbsp;<span id="ast-10">ssl</span>,&nbsp;<span id="ast-12" class="other_trans">key_file</span>,&nbsp;<span id="ast-14">cer_file</span></span>):<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.info</span>(<span id="ast-21">(<span id="ast-22">"Starting&nbsp;'%s'&nbsp;with&nbsp;'%s'..."</span>&nbsp;%&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26">self</span>.name</span>,&nbsp;<span id="ast-27" class="other_trans">server</span>)</span>)</span>)</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.server</span>&nbsp;=&nbsp;<span id="ast-31" class="other_trans">server</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.host</span>&nbsp;=&nbsp;<span id="ast-35" class="other_trans">host</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.port</span>&nbsp;=&nbsp;<span id="ast-39">port</span></span><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ssl</span>&nbsp;=&nbsp;<span id="ast-43" class="other_trans">ssl</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.start</span>()</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>method</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">getattr</span>(<span id="ast-52">self</span>,&nbsp;<span id="ast-53">(<span id="ast-54">'serve_'</span>&nbsp;+&nbsp;<span id="ast-56" class="other_trans">server</span>)</span>)</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">dict</span>()</span></span><span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>names</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">method</span>.func_code</span>.co_varnames</span></span><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-67">(<span id="ast-68">'ssl'</span><span id="ast-69">&nbsp;in&nbsp;</span><span id="ast-70" class="other_trans">names</span>)</span>:<span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>[<span id="ast-74"><span id="ast-75">'ssl'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-76" class="location_node">port&nbsp;&rarr;&nbsp;ssl,&nbsp;pred:&nbsp;names&nbsp;</span></span></span><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-78">(<span id="ast-79">'key_file'</span><span id="ast-80">&nbsp;in&nbsp;</span><span id="ast-81" class="other_trans">names</span>)</span>:<span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>[<span id="ast-85"><span id="ast-86">'key_file'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-87" class="other_trans">key_file</span></span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-89">(<span id="ast-90">'cer_file'</span><span id="ast-91">&nbsp;in&nbsp;</span><span id="ast-92" class="other_trans">names</span>)</span>:<span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>[<span id="ast-96"><span id="ast-97">'cer_file'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-98" class="other_trans">cer_file</span></span></span><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return_value</span>&nbsp;=&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">method</span>(host=<span id="ast-104" class="other_trans">host</span>,&nbsp;port=<span id="ast-106" class="other_trans">port</span>,&nbsp;**<span id="ast-107" class="other_trans">kwargs</span>)</span></span><span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stop</span>()</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.info</span>(<span id="ast-117">(<span id="ast-118">"Stopped&nbsp;'%s''&nbsp;in&nbsp;'%s'&nbsp;..."</span>&nbsp;%&nbsp;<span id="ast-120">(<span id="ast-121"><span id="ast-122">self</span>.name</span>,&nbsp;<span id="ast-123" class="other_trans">server</span>)</span>)</span>)</span></span><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-125" class="other_trans">return_value</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;write(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">data</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Output&nbsp;the&nbsp;given&nbsp;byte&nbsp;string&nbsp;over&nbsp;the&nbsp;serial&nbsp;port.'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9">not</span>&nbsp;<span id="ast-10"><span id="ast-11">self</span>.is_open</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-13" class="other_trans">portNotOpenError</span></span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17">to_bytes</span>(<span id="ast-18">data</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tx_len</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22">len</span>(<span id="ast-23" class="other_trans">d</span>)</span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>timeout</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27">Timeout</span>(<span id="ast-28"><span id="ast-29">self</span>._write_timeout</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-31">(<span id="ast-32">tx_len</span><span id="ast-33" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-34">0</span>)</span>:<span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>n</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">os</span>.write</span>(<span id="ast-41"><span id="ast-42">self</span>.fd</span>,&nbsp;<span id="ast-43">d</span>)</span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">timeout</span>.is_non_blocking</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-48" class="incorrect_node">n&nbsp;&rarr;&nbsp;d&nbsp;</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-50">(<span id="ast-51">not</span>&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">timeout</span>.is_infinite</span>)</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">timeout</span>.expired</span>()</span>:<span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-59" class="other_trans">writeTimeoutError</span></span></span><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-62" class="other_trans">abort</span>,&nbsp;<span id="ast-63" class="other_trans">ready</span>,&nbsp;<span id="ast-64" class="other_trans">_</span>)</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67">select</span>.select</span>(<span id="ast-68">[<span id="ast-69"><span id="ast-70">self</span>.pipe_abort_write_r</span>]</span>,&nbsp;<span id="ast-71">[<span id="ast-72"><span id="ast-73">self</span>.fd</span>]</span>,&nbsp;<span id="ast-74">[]</span>,&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">timeout</span>.time_left</span>()</span>)</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-79" class="other_trans">abort</span>:<span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.read</span>(<span id="ast-84"><span id="ast-85">self</span>.pipe_abort_write_r</span>,&nbsp;<span id="ast-86">1000</span>)</span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-89">(<span id="ast-90">not</span>&nbsp;<span id="ast-91" class="other_trans">ready</span>)</span>:<span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-93">writeTimeoutError</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-95">(<span id="ast-96"><span id="ast-97"><span id="ast-98">timeout</span>.time_left</span>()</span><span id="ast-99" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-100">None</span>)</span></span><span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-103" class="other_trans">abort</span>,&nbsp;<span id="ast-104">ready</span>,&nbsp;<span id="ast-105">_</span>)</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107"><span id="ast-108" class="other_trans">select</span>.select</span>(<span id="ast-109">[<span id="ast-110"><span id="ast-111">self</span>.pipe_abort_write_r</span>]</span>,&nbsp;<span id="ast-112">[<span id="ast-113"><span id="ast-114">self</span>.fd</span>]</span>,&nbsp;<span id="ast-115">[]</span>,&nbsp;<span id="ast-116" class="other_trans">None</span>)</span></span><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-118" class="other_trans">abort</span>:<span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.read</span>(<span id="ast-123"><span id="ast-124">self</span>.pipe_abort_write_r</span>,&nbsp;<span id="ast-125">1</span>)</span></span><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-128">(<span id="ast-129">not</span>&nbsp;<span id="ast-130" class="other_trans">ready</span>)</span>:<span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-132"><span id="ast-133">SerialException</span>(<span id="ast-134">'write&nbsp;failed&nbsp;(select)'</span>)</span></span></span></span><span id="ast-135"><span id="ast-136" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>&nbsp;=&nbsp;<span id="ast-137"><span id="ast-138" class="other_trans">d</span>[<span id="ast-139"><span id="ast-140" class="other_trans">n</span>:</span>]</span></span><span id="ast-141"><span id="ast-142" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tx_len</span>&nbsp;-=&nbsp;<span id="ast-144">n</span></span><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-146">SerialException</span>:<span id="ast-147"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-149">OSError</span>&nbsp;as&nbsp;<span id="ast-150" class="other_trans">v</span>:<span id="ast-151"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-152">(<span id="ast-153"><span id="ast-154" class="other_trans">v</span>.errno</span><span id="ast-155" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-156"><span id="ast-157">errno</span>.EAGAIN</span>)</span>:<span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-159"><span id="ast-160" class="other_trans">SerialException</span>(<span id="ast-161"><span id="ast-162"><span id="ast-163">'write&nbsp;failed:&nbsp;{}'</span>.format</span>(<span id="ast-164" class="other_trans">v</span>)</span>)</span></span></span><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-166"><span id="ast-167"><span id="ast-168">timeout</span>.expired</span>()</span>:<span id="ast-169"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-170">writeTimeoutError</span></span></span></span></span></span><span id="ast-171"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-172"><span id="ast-173" class="other_trans">len</span>(<span id="ast-174" class="ref_node">data&nbsp;&rarr;&nbsp;d&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span>,&nbsp;<span id="ast-5" class="other_trans">scanner</span>,&nbsp;<span id="ast-7" class="other_trans">url</span>,&nbsp;<span id="ast-9" class="other_trans">login</span>,&nbsp;<span id="ast-11" class="other_trans">password</span>,&nbsp;<span id="ast-13" class="other_trans">insecure</span>,&nbsp;<span id="ast-15" class="other_trans">template</span></span>):<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18" class="other_trans">scanner</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scanner</span>&nbsp;=&nbsp;<span id="ast-22" class="other_trans">scanner</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-23"><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scanner</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">nessrest</span>.Scanner</span>(url=<span id="ast-30" class="other_trans">url</span>,&nbsp;login=<span id="ast-32" class="other_trans">login</span>,&nbsp;password=<span id="ast-34" class="other_trans">password</span>,&nbsp;insecure=<span id="ast-36" class="other_trans">insecure</span>)</span></span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.name</span>&nbsp;=&nbsp;<span id="ast-40" class="other_trans">name</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scan_id</span>&nbsp;=&nbsp;<span id="ast-44">''</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scanner_id</span>&nbsp;=&nbsp;<span id="ast-48">'1'</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.folder_id</span>&nbsp;=&nbsp;<span id="ast-52">''</span></span><span id="ast-53"><span id="ast-54"><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.uuid</span>&nbsp;=&nbsp;<span id="ast-56">''</span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.category</span>&nbsp;=&nbsp;<span id="ast-60">''</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.settings</span>&nbsp;=&nbsp;<span id="ast-64">{<span id="ast-65">'launch'</span>:&nbsp;<span id="ast-70">'ONETIME'</span>,&nbsp;<span id="ast-66">'enabled'</span>:&nbsp;<span id="ast-71">False</span>,&nbsp;<span id="ast-67">'launch_now'</span>:&nbsp;<span id="ast-72">True</span>,&nbsp;<span id="ast-68">'text_targets'</span>:&nbsp;<span id="ast-73">''</span>,&nbsp;<span id="ast-69">'file_targets'</span>:&nbsp;<span id="ast-74">''</span>}</span></span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.audits</span>&nbsp;=&nbsp;<span id="ast-78">{}</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.creds</span>&nbsp;=&nbsp;<span id="ast-82">{}</span></span><span id="ast-83"><span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.uploads</span>&nbsp;=&nbsp;<span id="ast-86">[]</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.categories</span>&nbsp;=&nbsp;<span id="ast-90">{}</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._cache</span>&nbsp;=&nbsp;<span id="ast-94">{}</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96" class="other_trans">template</span>:<span id="ast-97"><span id="ast-98"><span id="ast-99" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>set_scan_template&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-100" class="other_trans">template</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_pixel_data_numpy(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Return&nbsp;a&nbsp;NumPy&nbsp;array&nbsp;of&nbsp;the&nbsp;pixel&nbsp;data&nbsp;if&nbsp;NumPy&nbsp;is&nbsp;available.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Falls&nbsp;back&nbsp;to&nbsp;GDCM&nbsp;in&nbsp;case&nbsp;of&nbsp;unsupported&nbsp;transfer&nbsp;syntaxes.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Raises\\u000a&nbsp;&nbsp;&nbsp;&nbsp;------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;TypeError\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;pixel&nbsp;data&nbsp;or&nbsp;not&nbsp;a&nbsp;supported&nbsp;data&nbsp;type\\u000a&nbsp;&nbsp;&nbsp;&nbsp;ImportError\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;NumPy&nbsp;isn't&nbsp;found,&nbsp;or&nbsp;in&nbsp;the&nbsp;case&nbsp;of&nbsp;fallback,&nbsp;if&nbsp;GDCM&nbsp;isn't&nbsp;found.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns\\u000a&nbsp;&nbsp;&nbsp;&nbsp;-------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;NumPy&nbsp;array\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>._is_uncompressed_transfer_syntax</span>()</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14">not</span>&nbsp;<span id="ast-15" class="other_trans">have_gdcm</span>)</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">NotImplementedError</span>(<span id="ast-19">'Pixel&nbsp;Data&nbsp;is&nbsp;compressed&nbsp;in&nbsp;a&nbsp;format&nbsp;pydicom&nbsp;does&nbsp;not&nbsp;yet&nbsp;handle.&nbsp;Cannot&nbsp;return&nbsp;array.&nbsp;Pydicom&nbsp;might&nbsp;be&nbsp;able&nbsp;to&nbsp;convert&nbsp;the&nbsp;pixel&nbsp;data&nbsp;using&nbsp;GDCM&nbsp;if&nbsp;it&nbsp;is&nbsp;installed.'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-21">(<span id="ast-22">not</span>&nbsp;<span id="ast-23"><span id="ast-24">self</span>.filename</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-26"><span id="ast-27">NotImplementedError</span>(<span id="ast-28">'GDCM&nbsp;is&nbsp;only&nbsp;supported&nbsp;when&nbsp;the&nbsp;dataset&nbsp;has&nbsp;been&nbsp;created&nbsp;with&nbsp;a&nbsp;filename.'</span>)</span></span></span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31">not</span>&nbsp;<span id="ast-32" class="other_trans">have_numpy</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-35">'The&nbsp;Numpy&nbsp;package&nbsp;is&nbsp;required&nbsp;to&nbsp;use&nbsp;pixel_array,&nbsp;and&nbsp;numpy&nbsp;could&nbsp;not&nbsp;be&nbsp;imported.\\u000a'</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-37"><span id="ast-38">ImportError</span>(<span id="ast-39" class="other_trans">msg</span>)</span></span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42">'PixelData'</span><span id="ast-43">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-44">self</span>)</span>:<span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-46"><span id="ast-47">TypeError</span>(<span id="ast-48">'No&nbsp;pixel&nbsp;data&nbsp;found&nbsp;in&nbsp;this&nbsp;dataset.'</span>)</span></span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52">self</span>._is_uncompressed_transfer_syntax</span>()</span>:<span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>format_str</span>&nbsp;=&nbsp;<span id="ast-55">(<span id="ast-56">'%sint%d'</span>&nbsp;%&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60">(<span id="ast-61">'u'</span>,&nbsp;<span id="ast-62">''</span>)</span>[<span id="ast-63"><span id="ast-64"><span id="ast-65">self</span>.PixelRepresentation</span></span>]</span>,&nbsp;<span id="ast-66"><span id="ast-67">self</span>.BitsAllocated</span>)</span>)</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>numpy_dtype</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72"><span id="ast-73">numpy</span>.dtype</span>(<span id="ast-74" class="other_trans">format_str</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-76" class="other_trans">TypeError</span>:<span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-79">"Data&nbsp;type&nbsp;not&nbsp;understood&nbsp;by&nbsp;NumPy:&nbsp;format='%s',&nbsp;PixelRepresentation=%d,&nbsp;BitsAllocated=%d"</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-81"><span id="ast-82">TypeError</span>(<span id="ast-83">(<span id="ast-84">msg</span>&nbsp;%&nbsp;<span id="ast-86">(<span id="ast-87" class="ref_node">numpy_dtype&nbsp;&rarr;&nbsp;format_str&nbsp;</span>,&nbsp;<span id="ast-88"><span id="ast-89">self</span>.PixelRepresentation</span>,&nbsp;<span id="ast-90"><span id="ast-91">self</span>.BitsAllocated</span>)</span>)</span>)</span></span></span></span><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-93">(<span id="ast-94"><span id="ast-95">self</span>.is_little_endian</span><span id="ast-96" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-97">sys_is_little_endian</span>)</span>:<span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>numpy_dtype</span>.newbyteorder</span>(<span id="ast-102">'S'</span>)</span></span></span><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pixel_bytearray</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106">self</span>.PixelData</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-108">(<span id="ast-110">have_gdcm</span>&nbsp;and&nbsp;<span id="ast-111"><span id="ast-112">self</span>.filename</span>)</span>:<span id="ast-113"><span id="ast-114" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>gdcm_image_reader</span>&nbsp;=&nbsp;<span id="ast-115"><span id="ast-116"><span id="ast-117">gdcm</span>.ImageReader</span>()</span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>gdcm_image_reader</span>.SetFileName</span>(<span id="ast-122"><span id="ast-123">self</span>.filename</span>)</span></span><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-125">(<span id="ast-126">not</span>&nbsp;<span id="ast-127"><span id="ast-128"><span id="ast-129" class="other_trans">gdcm_image_reader</span>.Read</span>()</span>)</span>:<span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-131"><span id="ast-132">TypeError</span>(<span id="ast-133">'GDCM&nbsp;could&nbsp;not&nbsp;read&nbsp;DICOM&nbsp;image'</span>)</span></span></span><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>gdcm_image</span>&nbsp;=&nbsp;<span id="ast-136"><span id="ast-137"><span id="ast-138" class="other_trans">gdcm_image_reader</span>.GetImage</span>()</span></span><span id="ast-139"><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>gdcm_numpy_typemap</span>&nbsp;=&nbsp;<span id="ast-141">{<span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans">gdcm</span>.PixelFormat</span>.INT8</span>:&nbsp;<span id="ast-166"><span id="ast-167">numpy</span>.int8</span>,&nbsp;<span id="ast-145"><span id="ast-146"><span id="ast-147">gdcm</span>.PixelFormat</span>.UINT8</span>:&nbsp;<span id="ast-168"><span id="ast-169">numpy</span>.uint8</span>,&nbsp;<span id="ast-148"><span id="ast-149"><span id="ast-150">gdcm</span>.PixelFormat</span>.UINT16</span>:&nbsp;<span id="ast-170"><span id="ast-171" class="other_trans">numpy</span>.uint16</span>,&nbsp;<span id="ast-151"><span id="ast-152"><span id="ast-153">gdcm</span>.PixelFormat</span>.INT16</span>:&nbsp;<span id="ast-172"><span id="ast-173">numpy</span>.int16</span>,&nbsp;<span id="ast-154"><span id="ast-155"><span id="ast-156" class="other_trans">gdcm</span>.PixelFormat</span>.UINT32</span>:&nbsp;<span id="ast-174"><span id="ast-175">numpy</span>.uint32</span>,&nbsp;<span id="ast-157"><span id="ast-158"><span id="ast-159">gdcm</span>.PixelFormat</span>.INT32</span>:&nbsp;<span id="ast-176"><span id="ast-177" class="other_trans">numpy</span>.int32</span>,&nbsp;<span id="ast-160"><span id="ast-161"><span id="ast-162" class="other_trans">gdcm</span>.PixelFormat</span>.FLOAT32</span>:&nbsp;<span id="ast-178"><span id="ast-179">numpy</span>.float32</span>,&nbsp;<span id="ast-163"><span id="ast-164"><span id="ast-165" class="other_trans">gdcm</span>.PixelFormat</span>.FLOAT64</span>:&nbsp;<span id="ast-180"><span id="ast-181">numpy</span>.float64</span>}</span></span><span id="ast-182"><span id="ast-183" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>gdcm_pixel_format</span>&nbsp;=&nbsp;<span id="ast-184"><span id="ast-185"><span id="ast-186"><span id="ast-187"><span id="ast-188" class="other_trans">gdcm_image</span>.GetPixelFormat</span>()</span>.GetScalarType</span>()</span></span><span id="ast-189"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-190">(<span id="ast-191">gdcm_pixel_format</span><span id="ast-192">&nbsp;in&nbsp;</span><span id="ast-193" class="other_trans">gdcm_numpy_typemap</span>)</span>:<span id="ast-194"><span id="ast-195" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>numpy_dtype</span>&nbsp;=&nbsp;<span id="ast-196"><span id="ast-197" class="other_trans">gdcm_numpy_typemap</span>[<span id="ast-198"><span id="ast-199" class="other_trans">gdcm_pixel_format</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-200"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-201"><span id="ast-202">TypeError</span>(<span id="ast-203"><span id="ast-204"><span id="ast-205">'{}&nbsp;is&nbsp;not&nbsp;a&nbsp;GDCM&nbsp;supported&nbsp;pixel&nbsp;format'</span>.format</span>(<span id="ast-206" class="other_trans">gdcm_pixel_format</span>)</span>)</span></span></span><span id="ast-207"><span id="ast-208" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pixel_bytearray</span>&nbsp;=&nbsp;<span id="ast-209"><span id="ast-210"><span id="ast-211" class="other_trans">gdcm_image</span>.GetBuffer</span>()</span></span><span id="ast-212"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-213">(<span id="ast-214"><span id="ast-215" class="other_trans">sys</span>.version_info</span><span id="ast-216" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-217">(<span id="ast-218">3</span>,&nbsp;<span id="ast-219">0</span>)</span>)</span>:<span id="ast-220"><span id="ast-221"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pixel_bytearray</span>&nbsp;=&nbsp;<span id="ast-222"><span id="ast-223"><span id="ast-224" class="other_trans">pixel_bytearray</span>.encode</span>(<span id="ast-225">'utf-8'</span>,&nbsp;<span id="ast-226">'surrogateescape'</span>)</span></span></span><span id="ast-227"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-228"><span id="ast-229"><span id="ast-230" class="incorrect_node">gdcm_image&nbsp;&rarr;&nbsp;pixel_bytearray&nbsp;</span>.GetNeedByteSwap</span>()</span>:<span id="ast-231"><span id="ast-232"><span id="ast-233"><span id="ast-234" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>numpy_dtype</span>.newbyteorder</span>(<span id="ast-235">'S'</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;collect_parameters(<span id="ast-2"><span id="ast-3" class="other_trans">uri_query</span>,&nbsp;<span id="ast-5" class="other_trans">body</span>,&nbsp;<span id="ast-7" class="other_trans">headers</span>,&nbsp;<span id="ast-9" class="other_trans">exclude_oauth_signature</span></span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Collect&nbsp;parameters&nbsp;from&nbsp;the&nbsp;uri&nbsp;query,&nbsp;authorization&nbsp;header,&nbsp;and&nbsp;request\\u000a&nbsp;&nbsp;&nbsp;&nbsp;body.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;paramters&nbsp;will&nbsp;be&nbsp;decoded&nbsp;into&nbsp;unicode&nbsp;using&nbsp;utf-8.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters&nbsp;starting&nbsp;with&nbsp;`oauth_`&nbsp;will&nbsp;be&nbsp;unescaped.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Per&nbsp;`section&nbsp;3.4.1.3.1`_&nbsp;of&nbsp;the&nbsp;spec.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;..&nbsp;_`section&nbsp;3.4.1.3.1`:&nbsp;http://tools.ietf.org/html/rfc5849#section-3.4.1.3.1\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-17" class="other_trans">headers</span>&nbsp;or&nbsp;<span id="ast-18">{}</span>)</span></span><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>&nbsp;=&nbsp;<span id="ast-21">[]</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">uri_query</span>:<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>.extend</span>(<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">urlparse</span>.parse_qsl</span>(<span id="ast-31">uri_query</span>,&nbsp;keep_blank_values=<span id="ast-33">True</span>)</span>)</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35" class="other_trans">headers</span>:<span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers_lower</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39">dict</span>(<span id="ast-40">(<span id="ast-41">(<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">k</span>.lower</span>()</span>,&nbsp;<span id="ast-45" class="other_trans">v</span>)</span><span id="ast-46">&nbsp;for&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">k</span>,&nbsp;<span id="ast-49" class="other_trans">v</span>)</span>&nbsp;in&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">headers</span>.items</span>()</span></span>)</span>)</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>authorization_header</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">headers_lower</span>.get</span>(<span id="ast-58">'authorization'</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-61">authorization_header</span><span id="ast-62" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-63">None</span>)</span>:<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>.extend</span>(<span id="ast-68"><span id="ast-69"><span id="ast-70">utils</span>.parse_authorization_header</span>(<span id="ast-71">authorization_header</span>)</span>)</span></span></span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-73"><span id="ast-74" class="other_trans">isinstance</span>(<span id="ast-75">body</span>,&nbsp;<span id="ast-76">(<span id="ast-77" class="other_trans">str</span>,&nbsp;<span id="ast-78">unicode</span>)</span>)</span>:<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>.extend</span>(<span id="ast-83"><span id="ast-84"><span id="ast-85">urlparse</span>.parse_qsl</span>(<span id="ast-86" class="other_trans">body</span>,&nbsp;keep_blank_values=<span id="ast-88">True</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-90"><span id="ast-91">isinstance</span>(<span id="ast-92">body</span>,&nbsp;<span id="ast-93">dict</span>)</span>:<span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>.extend</span>(<span id="ast-98"><span id="ast-99"><span id="ast-100">body</span>.items</span>()</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>.extend</span>(<span id="ast-106" class="other_trans">body</span>)</span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-108" class="other_trans">TypeError</span>:<span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-110"><span id="ast-111">ValueError</span>(<span id="ast-112">'Body&nbsp;must&nbsp;be&nbsp;a&nbsp;string,&nbsp;dict,&nbsp;or&nbsp;iterable'</span>)</span></span></span></span></span><span id="ast-113"><span id="ast-114" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>unicode_params</span>&nbsp;=&nbsp;<span id="ast-115">[]</span></span><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-117">(<span id="ast-118" class="other_trans">k</span>,&nbsp;<span id="ast-119" class="other_trans">v</span>)</span>&nbsp;in&nbsp;<span id="ast-120" class="other_trans">params</span>:<span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122"><span id="ast-123" class="other_trans">isinstance</span>(<span id="ast-124" class="other_trans">k</span>,&nbsp;<span id="ast-125">str</span>)</span>:<span id="ast-126"><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>k</span>&nbsp;=&nbsp;<span id="ast-128"><span id="ast-129"><span id="ast-130" class="incorrect_node">k&nbsp;&rarr;&nbsp;v&nbsp;</span>.decode</span>(<span id="ast-131">'utf-8'</span>)</span></span></span><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-133"><span id="ast-134" class="other_trans">isinstance</span>(<span id="ast-135">v</span>,&nbsp;<span id="ast-136" class="other_trans">str</span>)</span>:<span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-138"><span id="ast-139"><span id="ast-140" class="ref_node">v&nbsp;&rarr;&nbsp;k&nbsp;</span>.startswith</span>(<span id="ast-141">'oauth_'</span>)</span>:<span id="ast-142"><span id="ast-143" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v</span>&nbsp;=&nbsp;<span id="ast-144"><span id="ast-145"><span id="ast-146">utils</span>.unescape</span>(<span id="ast-147" class="other_trans">v</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-148"><span id="ast-149" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v</span>&nbsp;=&nbsp;<span id="ast-150"><span id="ast-151"><span id="ast-152" class="other_trans">v</span>.decode</span>(<span id="ast-153">'utf-8'</span>)</span></span></span></span><span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>unicode_params</span>.append</span>(<span id="ast-158">(<span id="ast-159" class="other_trans">k</span>,&nbsp;<span id="ast-160" class="other_trans">v</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;default_exit(<span id="ast-2"><span id="ast-3">path</span>,&nbsp;<span id="ast-4" class="other_trans">key</span>,&nbsp;<span id="ast-5" class="other_trans">old_parent</span>,&nbsp;<span id="ast-6" class="other_trans">new_parent</span>,&nbsp;<span id="ast-7" class="other_trans">new_items</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>&nbsp;=&nbsp;<span id="ast-10" class="other_trans">new_parent</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">isinstance</span>(<span id="ast-14" class="other_trans">new_parent</span>,&nbsp;<span id="ast-15" class="other_trans">Mapping</span>)</span>:<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_parent</span>.update</span>(<span id="ast-20" class="other_trans">new_items</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">isinstance</span>(<span id="ast-24" class="other_trans">new_parent</span>,&nbsp;<span id="ast-25">Sequence</span>)</span>:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vals</span>&nbsp;=&nbsp;<span id="ast-28">[<span id="ast-29" class="other_trans">v</span><span id="ast-30">&nbsp;for&nbsp;<span id="ast-31">(<span id="ast-32">i</span>,&nbsp;<span id="ast-33">v</span>)</span>&nbsp;in&nbsp;<span id="ast-34" class="other_trans">new_items</span></span>]</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_parent</span>.extend</span>(<span id="ast-40" class="other_trans">vals</span>)</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-42">AttributeError</span>:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">new_parent</span>.__class__</span>(<span id="ast-48" class="other_trans">vals</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">isinstance</span>(<span id="ast-52" class="other_trans">new_parent</span>,&nbsp;<span id="ast-53">Set</span>)</span>:<span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vals</span>&nbsp;=&nbsp;<span id="ast-56">[<span id="ast-57" class="other_trans">v</span><span id="ast-58">&nbsp;for&nbsp;<span id="ast-59">(<span id="ast-60">i</span>,&nbsp;<span id="ast-61">v</span>)</span>&nbsp;in&nbsp;<span id="ast-62" class="other_trans">new_items</span></span>]</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_parent&nbsp;&rarr;&nbsp;ret&nbsp;</span>.update</span>(<span id="ast-68" class="ref_node">new_items&nbsp;&rarr;&nbsp;vals&nbsp;</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-70">AttributeError</span>:<span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans">new_parent</span>.__class__</span>(<span id="ast-76" class="other_trans">vals</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-78"><span id="ast-79">RuntimeError</span>(<span id="ast-80">(<span id="ast-81">'unexpected&nbsp;iterable&nbsp;type:&nbsp;%r'</span>&nbsp;%&nbsp;<span id="ast-83"><span id="ast-84" class="other_trans">type</span>(<span id="ast-85" class="other_trans">new_parent</span>)</span>)</span>)</span></span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-87" class="other_trans">ret</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_user_api(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._test_backup</span>(<span id="ast-8">True</span>)</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logout</span>()</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>student</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">User</span>.lookup</span>(<span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.user1</span>.email</span>)</span></span><span id="ast-21">def&nbsp;test_both_endpoints(<span id="ast-22"><span id="ast-23" class="other_trans">user</span></span>):<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base_api</span>&nbsp;=&nbsp;<span id="ast-26">'/api/v3/user/{0}'</span></span><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>user1_endpoint</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">base_api</span>.format</span>(<span id="ast-32"><span id="ast-33">user</span>.email</span>)</span></span><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>current_user_endpoint</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">base_api</span>.format</span>(<span id="ast-39">''</span>)</span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>current</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45">self</span>.client</span>.get</span>(<span id="ast-46">current_user_endpoint</span>)</span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>specific</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52">self</span>.client</span>.get</span>(<span id="ast-53" class="other_trans">user1_endpoint</span>)</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">current</span>,&nbsp;<span id="ast-57">specific</span>)</span></span></span><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-60">current</span>,&nbsp;<span id="ast-61" class="other_trans">specific</span>)</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63">test_both_endpoints</span>(<span id="ast-64" class="other_trans">student</span>)</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_401</span>(<span id="ast-69">current</span>)</span></span><span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_401</span>(<span id="ast-74">specific</span>)</span></span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.login</span>(<span id="ast-79"><span id="ast-80"><span id="ast-81">self</span>.user1</span>.email</span>)</span></span><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-84" class="other_trans">current</span>,&nbsp;<span id="ast-85" class="other_trans">specific</span>)</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-87" class="other_trans">test_both_endpoints</span>(<span id="ast-88" class="other_trans">student</span>)</span></span><span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_200</span>(<span id="ast-93">current</span>)</span></span><span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_200</span>(<span id="ast-98">specific</span>)</span></span><span id="ast-99"><span id="ast-100" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>members&nbsp;&rarr;&nbsp;specific&nbsp;</span>&nbsp;=&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104">current</span>.json</span>[<span id="ast-105"><span id="ast-106">'data'</span></span>]</span>[<span id="ast-107"><span id="ast-108">'participations'</span></span>]</span></span><span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEquals</span>(<span id="ast-113"><span id="ast-114">len</span>(<span id="ast-115" class="other_trans">members</span>)</span>,&nbsp;<span id="ast-116">1</span>)</span></span><span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEquals</span>(<span id="ast-121"><span id="ast-122"><span id="ast-123" class="other_trans">current</span>.json</span>[<span id="ast-124"><span id="ast-125">'data'</span></span>]</span>,&nbsp;<span id="ast-126"><span id="ast-127"><span id="ast-128" class="other_trans">specific</span>.json</span>[<span id="ast-129"><span id="ast-130">'data'</span></span>]</span>)</span></span><span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.login</span>(<span id="ast-135"><span id="ast-136"><span id="ast-137">self</span>.staff1</span>.email</span>)</span></span><span id="ast-138"><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-140" class="other_trans">current</span>,&nbsp;<span id="ast-141">specific</span>)</span>&nbsp;=&nbsp;<span id="ast-142"><span id="ast-143">test_both_endpoints</span>(<span id="ast-144">student</span>)</span></span><span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_200</span>(<span id="ast-149">current</span>)</span></span><span id="ast-150"><span id="ast-151"><span id="ast-152"><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_403</span>(<span id="ast-154" class="other_trans">specific</span>)</span></span><span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.login</span>(<span id="ast-159"><span id="ast-160"><span id="ast-161">self</span>.user3</span>.email</span>)</span></span><span id="ast-162"><span id="ast-163"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-164" class="other_trans">current</span>,&nbsp;<span id="ast-165" class="other_trans">specific</span>)</span>&nbsp;=&nbsp;<span id="ast-166"><span id="ast-167" class="other_trans">test_both_endpoints</span>(<span id="ast-168" class="other_trans">student</span>)</span></span><span id="ast-169"><span id="ast-170"><span id="ast-171"><span id="ast-172"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_200</span>(<span id="ast-173">current</span>)</span></span><span id="ast-174"><span id="ast-175"><span id="ast-176"><span id="ast-177"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_403</span>(<span id="ast-178" class="other_trans">specific</span>)</span></span><span id="ast-179"><span id="ast-180"><span id="ast-181"><span id="ast-182"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.login</span>(<span id="ast-183"><span id="ast-184"><span id="ast-185">self</span>.admin</span>.email</span>)</span></span><span id="ast-186"><span id="ast-187"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-188" class="other_trans">current</span>,&nbsp;<span id="ast-189" class="other_trans">specific</span>)</span>&nbsp;=&nbsp;<span id="ast-190"><span id="ast-191" class="other_trans">test_both_endpoints</span>(<span id="ast-192">student</span>)</span></span><span id="ast-193"><span id="ast-194"><span id="ast-195"><span id="ast-196"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_200</span>(<span id="ast-197" class="other_trans">current</span>)</span></span><span id="ast-198"><span id="ast-199"><span id="ast-200"><span id="ast-201"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_200</span>(<span id="ast-202" class="other_trans">specific</span>)</span></span><span id="ast-203"><span id="ast-204"><span id="ast-205"><span id="ast-206"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEquals</span>(<span id="ast-207"><span id="ast-208"><span id="ast-209"><span id="ast-210" class="other_trans">specific</span>.json</span>[<span id="ast-211"><span id="ast-212">'data'</span></span>]</span>[<span id="ast-213"><span id="ast-214">'email'</span></span>]</span>,&nbsp;<span id="ast-215"><span id="ast-216">student</span>.email</span>)</span></span><span id="ast-217"><span id="ast-218"><span id="ast-219"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lab_assistant1</span>&nbsp;=&nbsp;<span id="ast-220"><span id="ast-221" class="ref_node">make_lab_assistant&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-222">1</span>)</span></span><span id="ast-223"><span id="ast-224"><span id="ast-225"><span id="ast-226"><span id="ast-227"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>db</span>.session</span>.commit</span>()</span></span><span id="ast-228"><span id="ast-229"><span id="ast-230"><span id="ast-231"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.login</span>(<span id="ast-232"><span id="ast-233"><span id="ast-234">self</span>.lab_assistant1</span>.email</span>)</span></span><span id="ast-235"><span id="ast-236"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-237">current</span>,&nbsp;<span id="ast-238" class="other_trans">specific</span>)</span>&nbsp;=&nbsp;<span id="ast-239"><span id="ast-240">test_both_endpoints</span>(<span id="ast-241">student</span>)</span></span><span id="ast-242"><span id="ast-243"><span id="ast-244"><span id="ast-245"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_200</span>(<span id="ast-246" class="other_trans">current</span>)</span></span><span id="ast-247"><span id="ast-248"><span id="ast-249"><span id="ast-250"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_403</span>(<span id="ast-251">specific</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;apply_corrections(<span id="ast-2"><span id="ast-3" class="other_trans">uri</span>,&nbsp;<span id="ast-4" class="other_trans">runtime_storage_inst</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.info</span>(<span id="ast-9">'Applying&nbsp;corrections&nbsp;from&nbsp;uri&nbsp;%s'</span>,&nbsp;<span id="ast-10" class="other_trans">uri</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>corrections_fd</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">urllib</span>.urlopen</span>(<span id="ast-16" class="other_trans">uri</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raw</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">corrections_fd</span>.read</span>()</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>corrections_fd</span>.close</span>()</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>corrections</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">json</span>.loads</span>(<span id="ast-32" class="other_trans">raw</span>)</span>[<span id="ast-33"><span id="ast-34">'corrections'</span></span>]</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>valid_corrections</span>&nbsp;=&nbsp;<span id="ast-37">[]</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-39" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-40" class="other_trans">corrections</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43">'primary_key'</span><span id="ast-44">&nbsp;in&nbsp;</span><span id="ast-45" class="other_trans">c</span>)</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>valid_corrections</span>.append</span>(<span id="ast-50" class="other_trans">c</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.warn</span>(<span id="ast-55">'Correction&nbsp;misses&nbsp;primary&nbsp;key:&nbsp;%s'</span>,&nbsp;<span id="ast-56" class="other_trans">c</span>)</span></span></span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>runtime_storage_inst</span>.apply_corrections</span>(<span id="ast-61" class="correct_node">corrections&nbsp;&rarr;&nbsp;valid_corrections&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;neq(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">other</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">isinstance</span>(<span id="ast-8" class="other_trans">other</span>,&nbsp;<span id="ast-9" class="other_trans">W_Int32</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13" class="other_trans">ord</span>(<span id="ast-14"><span id="ast-15">self</span>.char</span>)</span><span id="ast-16" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-17"><span id="ast-18" class="other_trans">other</span>.value</span>)</span></span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">NotImplementedError</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;post(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">states</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Direct&nbsp;successor&nbsp;set&nbsp;(1-hop)&nbsp;for&nbsp;given&nbsp;states.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Over&nbsp;all&nbsp;actions&nbsp;or&nbsp;letters,&nbsp;i.e.,&nbsp;edge&nbsp;labeling&nbsp;ignored\\u000a&nbsp;&nbsp;&nbsp;&nbsp;by&nbsp;states.pre,&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;undefined.&nbsp;Only&nbsp;classes\\u000a&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;have&nbsp;an&nbsp;action&nbsp;set,&nbsp;alphabet,&nbsp;or&nbsp;other&nbsp;transition\\u000a&nbsp;&nbsp;&nbsp;&nbsp;labeling&nbsp;set&nbsp;provide&nbsp;a&nbsp;pre(state,&nbsp;label)&nbsp;method,&nbsp;as&nbsp;for\\u000a&nbsp;&nbsp;&nbsp;&nbsp;example&nbsp;pre(state,&nbsp;action)&nbsp;in&nbsp;the&nbsp;case&nbsp;of&nbsp;closed&nbsp;transition\\u000a&nbsp;&nbsp;&nbsp;&nbsp;systems.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;multiple&nbsp;stats&nbsp;provided,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;union&nbsp;Post(s)&nbsp;for&nbsp;s&nbsp;in&nbsp;states&nbsp;provided.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;See&nbsp;Also\\u000a&nbsp;&nbsp;&nbsp;&nbsp;========\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;L{pre}\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Def.&nbsp;2.3,&nbsp;p.23&nbsp;U{[BK08]\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;http://tulip-control.sourceforge.net/doc/bibliography.html#bk08&gt;}\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>states</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>._single_state2singleton</span>(<span id="ast-12" class="other_trans">states</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>successors</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">list</span>()</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-18" class="other_trans">state</span>&nbsp;in&nbsp;<span id="ast-19" class="correct_node">state&nbsp;&rarr;&nbsp;states&nbsp;</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>successors</span>&nbsp;+=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>.graph</span>.successors</span>(<span id="ast-27" class="other_trans">state</span>)</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-29" class="other_trans">successors</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;arp_packet_in_handler(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">ev</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">ev</span>.msg</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>datapath</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">msg</span>.datapath</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>in_port</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">msg</span>.match</span>[<span id="ast-18"><span id="ast-19">'in_port'</span></span>]</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ofproto</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">datapath</span>.ofproto</span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">datapath</span>.ofproto_parser</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pkt</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">packet</span>.Packet</span>(<span id="ast-33"><span id="ast-34" class="other_trans">msg</span>.data</span>)</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>arp_header</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">pkt</span>.get_protocol</span>(<span id="ast-40"><span id="ast-41">arp</span>.arp</span>)</span></span><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>src_ip</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">arp_header</span>.src_ip</span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>src_mac</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">arp_header</span>.src_mac</span></span><span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dst_ip</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">arp_header</span>.dst_ip</span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dst_mac</span>&nbsp;=&nbsp;<span id="ast-56">None</span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60" class="correct_node">cfg_mgr&nbsp;&rarr;&nbsp;self.&nbsp;</span>.is_internal_host</span>(<span id="ast-61" class="other_trans">src_ip</span>)</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first_speaker_id</span>&nbsp;=&nbsp;<span id="ast-64" class="other_trans">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;modify_assignment(<span id="ast-2"><span id="ast-3" class="other_trans">current_user</span>,&nbsp;<span id="ast-4">id</span>,&nbsp;<span id="ast-5">name</span>,&nbsp;<span id="ast-7" class="other_trans">due</span>,&nbsp;<span id="ast-9">for_class</span>,&nbsp;<span id="ast-11" class="other_trans">due_cutoff</span></span>):<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assignment</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16">_get_assignment</span>(<span id="ast-17" class="other_trans">id</span>)</span></span><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>old_assignment_string</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21">_assignment_to_str</span>(<span id="ast-22" class="other_trans">assignment</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-26">(<span id="ast-27"><span id="ast-28" class="other_trans">current_user</span>.account_type</span><span id="ast-29" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-30">'admin'</span>)</span>&nbsp;and&nbsp;<span id="ast-31">(<span id="ast-32"><span id="ast-33" class="other_trans">assignment</span>.for_class</span><span id="ast-34">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-35"><span id="ast-36" class="other_trans">current_user</span>.classes</span>)</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">RuntimeError</span>(<span id="ast-40">'You&nbsp;can&nbsp;only&nbsp;modify&nbsp;assignments&nbsp;for&nbsp;classes&nbsp;you&nbsp;teach.'</span>)</span></span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>change_log</span>&nbsp;=&nbsp;<span id="ast-43">[]</span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45" class="other_trans">name</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>change_log</span>.append</span>(<span id="ast-50">(<span id="ast-51">"Name&nbsp;changed&nbsp;from&nbsp;'%s'&nbsp;to&nbsp;'%s'."</span>&nbsp;%&nbsp;<span id="ast-53">(<span id="ast-54"><span id="ast-55" class="other_trans">assignment</span>.name</span>,&nbsp;<span id="ast-56">name</span>)</span>)</span>)</span></span><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assignment</span>.name</span>&nbsp;=&nbsp;<span id="ast-60">name</span></span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-62" class="other_trans">due</span>:<span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>due_date</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">_to_datetime</span>(<span id="ast-67" class="other_trans">due</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>change_log</span>.append</span>(<span id="ast-72">(<span id="ast-73">"Due&nbsp;date&nbsp;changed&nbsp;from&nbsp;'%s'&nbsp;to&nbsp;'%s'."</span>&nbsp;%&nbsp;<span id="ast-75">(<span id="ast-76"><span id="ast-77">str</span>(<span id="ast-78"><span id="ast-79" class="other_trans">assignment</span>.due</span>)</span>,&nbsp;<span id="ast-80"><span id="ast-81" class="other_trans">str</span>(<span id="ast-82" class="other_trans">due_date</span>)</span>)</span>)</span>)</span></span><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assignment</span>.due</span>&nbsp;=&nbsp;<span id="ast-86" class="other_trans">due_date</span></span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-88" class="other_trans">due_cutoff</span>:<span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cutoff_date</span>&nbsp;=&nbsp;<span id="ast-91"><span id="ast-92">_to_datetime</span>(<span id="ast-93" class="correct_node">due&nbsp;&rarr;&nbsp;due_cutoff&nbsp;</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">request</span>,&nbsp;*args,&nbsp;**kwargs</span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>validate_session_for_mturk</span>(<span id="ast-8" class="other_trans">request</span>,&nbsp;<span id="ast-9"><span id="ast-10">self</span>.session</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mturk_settings</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.session</span>.config</span>[<span id="ast-17"><span id="ast-18">'mturk_hit_settings'</span></span>]</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>initial</span>&nbsp;=&nbsp;<span id="ast-21">{<span id="ast-22">'title'</span>:&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">mturk_settings</span>[<span id="ast-32"><span id="ast-33">'title'</span></span>]</span>,&nbsp;<span id="ast-23">'description'</span>:&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">mturk_settings</span>[<span id="ast-36"><span id="ast-37">'description'</span></span>]</span>,&nbsp;<span id="ast-24">'keywords'</span>:&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">',&nbsp;'</span>.join</span>(<span id="ast-41"><span id="ast-42" class="other_trans">mturk_settings</span>[<span id="ast-43"><span id="ast-44">'keywords'</span></span>]</span>)</span>,&nbsp;<span id="ast-25">'money_reward'</span>:&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48">self</span>.session</span>.config</span>[<span id="ast-49"><span id="ast-50">'participation_fee'</span></span>]</span>,&nbsp;<span id="ast-26">'in_sandbox'</span>:&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">settings</span>.DEBUG</span>,&nbsp;<span id="ast-27">'minutes_allotted_per_assignment'</span>:&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">mturk_settings</span>[<span id="ast-55"><span id="ast-56">'minutes_allotted_per_assignment'</span></span>]</span>,&nbsp;<span id="ast-28">'expiration_hours'</span>:&nbsp;<span id="ast-57"><span id="ast-58" class="other_trans">mturk_settings</span>[<span id="ast-59"><span id="ast-60">'expiration_hours'</span></span>]</span>,&nbsp;<span id="ast-29">'assignments'</span>:&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63">self</span>.session</span>.mturk_num_participants</span>}</span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>form</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68">self</span>.get_form</span>(initial=<span id="ast-70" class="other_trans">initial</span>)</span></span><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74"><span id="ast-75">self</span>.get_context_data</span>(form=<span id="ast-77" class="other_trans">form</span>)</span></span><span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>[<span id="ast-81"><span id="ast-82">'py3'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-83">(<span id="ast-84"><span id="ast-85" class="other_trans">sys</span>.version_info</span><span id="ast-86" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-87">(<span id="ast-88">3</span>,&nbsp;<span id="ast-89">0</span>)</span>)</span></span><span id="ast-90"><span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>[<span id="ast-93"><span id="ast-94">'mturk_enabled'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-95">(<span id="ast-97"><span id="ast-98" class="other_trans">bool</span>(<span id="ast-99"><span id="ast-100">settings</span>.AWS_ACCESS_KEY_ID</span>)</span>&nbsp;and&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">bool</span>(<span id="ast-103"><span id="ast-104" class="other_trans">settings</span>.AWS_SECRET_ACCESS_KEY</span>)</span>)</span></span><span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110">self</span>.request</span>.build_absolute_uri</span>(<span id="ast-111"><span id="ast-112" class="other_trans">reverse</span>(<span id="ast-113">'session_create_hit'</span>,&nbsp;args=<span id="ast-115">(<span id="ast-116"><span id="ast-117"><span id="ast-118">self</span>.session</span>.pk</span>)</span>)</span>)</span></span><span id="ast-119"><span id="ast-120" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>secured_url</span>&nbsp;=&nbsp;<span id="ast-121"><span id="ast-122" class="other_trans">urlunparse</span>(<span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans">urlparse</span>(<span id="ast-127" class="other_trans">url</span>)</span>._replace</span>(scheme=<span id="ast-129">'https'</span>)</span>)</span></span><span id="ast-130"><span id="ast-131"><span id="ast-132" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>[<span id="ast-133"><span id="ast-134">'secured_url'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-135" class="other_trans">secured_url</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;users(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raw</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>.iam</span>.get_all_users</span>()</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>users</span>&nbsp;=&nbsp;<span id="ast-12">[<span id="ast-13"><span id="ast-14" class="other_trans">x</span>[<span id="ast-15"><span id="ast-16">'user_name'</span></span>]</span><span id="ast-17">&nbsp;for&nbsp;<span id="ast-18" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">raw</span>[<span id="ast-23"><span id="ast-24">'list_users_response'</span></span>]</span>[<span id="ast-25"><span id="ast-26">'list_users_result'</span></span>]</span>[<span id="ast-27"><span id="ast-28">'users'</span></span>]</span></span>]</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">raw</span>[<span id="ast-35"><span id="ast-36">'list_users_response'</span></span>]</span>[<span id="ast-37"><span id="ast-38">'list_users_result'</span></span>]</span>[<span id="ast-39"><span id="ast-40">'is_truncated'</span></span>]</span><span id="ast-41" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-42">'true'</span>)</span>:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raw</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="correct_node">iam&nbsp;&rarr;&nbsp;self.&nbsp;</span>.get_all_users</span>(marker=<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">raw</span>[<span id="ast-53"><span id="ast-54">'list_users_response'</span></span>]</span>[<span id="ast-55"><span id="ast-56">'list_users_result'</span></span>]</span>[<span id="ast-57"><span id="ast-58">'marker'</span></span>]</span>)</span></span><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>users</span>&nbsp;+=&nbsp;<span id="ast-62">[<span id="ast-63"><span id="ast-64" class="other_trans">x</span>[<span id="ast-65"><span id="ast-66">'user_name'</span></span>]</span><span id="ast-67">&nbsp;for&nbsp;<span id="ast-68" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">raw</span>[<span id="ast-73"><span id="ast-74">'list_users_response'</span></span>]</span>[<span id="ast-75"><span id="ast-76">'list_users_result'</span></span>]</span>[<span id="ast-77"><span id="ast-78">'users'</span></span>]</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;calculateOccupancyMLE(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">mat</span>,&nbsp;<span id="ast-5" class="other_trans">bias_mat</span>,&nbsp;<span id="ast-6" class="other_trans">params</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Calculate&nbsp;Occupancy&nbsp;track'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;=&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13">self</span>.start</span>&nbsp;-&nbsp;<span id="ast-15"><span id="ast-16">mat</span>.start</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19">offset</span><span id="ast-20" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-21"><span id="ast-22" class="other_trans">params</span>.flank</span>)</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">Exception</span>(<span id="ast-26">'For&nbsp;calculateOccupancyMLE,&nbsp;mat&nbsp;does&nbsp;not&nbsp;have&nbsp;sufficient&nbsp;flanking&nbsp;regions'</span>)</span>,&nbsp;<span id="ast-27" class="other_trans">offset</span></span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.vals</span>&nbsp;=&nbsp;<span id="ast-31">(<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">np</span>.ones</span>(<span id="ast-35">(<span id="ast-36"><span id="ast-37">self</span>.end</span>&nbsp;-&nbsp;<span id="ast-39"><span id="ast-40">self</span>.start</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">float</span>(<span id="ast-44">'nan'</span>)</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.lower_bound</span>&nbsp;=&nbsp;<span id="ast-48">(<span id="ast-49"><span id="ast-50"><span id="ast-51">np</span>.ones</span>(<span id="ast-52">(<span id="ast-53"><span id="ast-54">self</span>.end</span>&nbsp;-&nbsp;<span id="ast-56"><span id="ast-57">self</span>.start</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">float</span>(<span id="ast-61">'nan'</span>)</span>)</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.upper_bound</span>&nbsp;=&nbsp;<span id="ast-65">(<span id="ast-66"><span id="ast-67"><span id="ast-68">np</span>.ones</span>(<span id="ast-69">(<span id="ast-70"><span id="ast-71">self</span>.end</span>&nbsp;-&nbsp;<span id="ast-73"><span id="ast-74">self</span>.start</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-76"><span id="ast-77">float</span>(<span id="ast-78">'nan'</span>)</span>)</span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-80">i</span>&nbsp;in&nbsp;<span id="ast-81"><span id="ast-82">xrange</span>(<span id="ast-83"><span id="ast-84">params</span>.halfstep</span>,&nbsp;<span id="ast-85"><span id="ast-86" class="other_trans">len</span>(<span id="ast-87"><span id="ast-88">self</span>.vals</span>)</span>,&nbsp;<span id="ast-89"><span id="ast-90" class="other_trans">params</span>.step</span>)</span>:<span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_inserts</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95">np</span>.sum</span>(<span id="ast-96"><span id="ast-97"><span id="ast-98">mat</span>.get</span>(lower=<span id="ast-100">0</span>,&nbsp;upper=<span id="ast-102"><span id="ast-103">params</span>.upper</span>,&nbsp;start=<span id="ast-105">(<span id="ast-106">(<span id="ast-107"><span id="ast-108">self</span>.start</span>&nbsp;+&nbsp;<span id="ast-110">i</span>)</span>&nbsp;-&nbsp;<span id="ast-112"><span id="ast-113">params</span>.flank</span>)</span>,&nbsp;end=<span id="ast-115">(<span id="ast-116">(<span id="ast-117">(<span id="ast-118"><span id="ast-119">self</span>.start</span>&nbsp;+&nbsp;<span id="ast-121" class="other_trans">i</span>)</span>&nbsp;+&nbsp;<span id="ast-123"><span id="ast-124" class="other_trans">params</span>.flank</span>)</span>&nbsp;+&nbsp;<span id="ast-126">1</span>)</span>)</span>,&nbsp;axis=<span id="ast-128">1</span>)</span></span><span id="ast-129"><span id="ast-130" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_bias</span>&nbsp;=&nbsp;<span id="ast-131"><span id="ast-132"><span id="ast-133">np</span>.sum</span>(<span id="ast-134"><span id="ast-135"><span id="ast-136">bias_mat</span>.get</span>(lower=<span id="ast-138">0</span>,&nbsp;upper=<span id="ast-140"><span id="ast-141">params</span>.upper</span>,&nbsp;start=<span id="ast-143">(<span id="ast-144">(<span id="ast-145"><span id="ast-146">self</span>.start</span>&nbsp;+&nbsp;<span id="ast-148" class="other_trans">i</span>)</span>&nbsp;-&nbsp;<span id="ast-150"><span id="ast-151" class="other_trans">params</span>.flank</span>)</span>,&nbsp;end=<span id="ast-153">(<span id="ast-154">(<span id="ast-155">(<span id="ast-156"><span id="ast-157">self</span>.start</span>&nbsp;+&nbsp;<span id="ast-159" class="other_trans">i</span>)</span>&nbsp;+&nbsp;<span id="ast-161"><span id="ast-162">params</span>.flank</span>)</span>&nbsp;+&nbsp;<span id="ast-164">1</span>)</span>)</span>,&nbsp;axis=<span id="ast-166">1</span>)</span></span><span id="ast-167"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-168">(<span id="ast-169"><span id="ast-170" class="other_trans">sum</span>(<span id="ast-171" class="other_trans">new_inserts</span>)</span><span id="ast-172" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-173">0</span>)</span>:<span id="ast-174"><span id="ast-175" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>left</span>&nbsp;=&nbsp;<span id="ast-176">(<span id="ast-177" class="other_trans">i</span>&nbsp;-&nbsp;<span id="ast-179"><span id="ast-180" class="other_trans">params</span>.halfstep</span>)</span></span><span id="ast-181"><span id="ast-182"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>right</span>&nbsp;=&nbsp;<span id="ast-183"><span id="ast-184">min</span>(<span id="ast-185">(<span id="ast-186">(<span id="ast-187" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-189"><span id="ast-190" class="other_trans">params</span>.halfstep</span>)</span>&nbsp;+&nbsp;<span id="ast-192">1</span>)</span>,&nbsp;<span id="ast-193"><span id="ast-194">len</span>(<span id="ast-195" class="ref_node">vals&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span><span id="ast-196"><span id="ast-197"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-198"><span id="ast-199"><span id="ast-200">self</span>.vals</span>[<span id="ast-201"><span id="ast-202">left</span>:<span id="ast-203">right</span></span>]</span>,&nbsp;<span id="ast-204"><span id="ast-205"><span id="ast-206">self</span>.lower_bound</span>[<span id="ast-207"><span id="ast-208" class="other_trans">left</span>:<span id="ast-209" class="other_trans">right</span></span>]</span>,&nbsp;<span id="ast-210"><span id="ast-211"><span id="ast-212">self</span>.upper_bound</span>[<span id="ast-213"><span id="ast-214">left</span>:<span id="ast-215" class="other_trans">right</span></span>]</span>)</span>&nbsp;=&nbsp;<span id="ast-216"><span id="ast-217">calculateOccupancy</span>(<span id="ast-218" class="other_trans">new_inserts</span>,&nbsp;<span id="ast-219" class="other_trans">new_bias</span>,&nbsp;<span id="ast-220"><span id="ast-221" class="other_trans">params</span>.occ_calc_params</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;create(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">path</span>,&nbsp;<span id="ast-5" class="other_trans">mode</span>,&nbsp;<span id="ast-6" class="other_trans">fi</span></span>):<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.logger</span>.debug</span>(<span id="ast-13">'Create&nbsp;%s&nbsp;(mode:%s)'</span>,&nbsp;<span id="ast-14" class="other_trans">path</span>,&nbsp;<span id="ast-15" class="other_trans">mode</span>)</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>._remove_start_slash</span>(<span id="ast-21" class="other_trans">path</span>)</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>file_info</span>&nbsp;=&nbsp;<span id="ast-24">{}</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>file_info</span>[<span id="ast-28"><span id="ast-29">'fileName'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-30" class="incorrect_node">path&nbsp;&rarr;&nbsp;mode&nbsp;</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.open_files</span>[<span id="ast-35"><span id="ast-36" class="other_trans">path</span></span>]</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38" class="ref_node">B2File&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-39">self</span>,&nbsp;<span id="ast-40" class="other_trans">file_info</span>,&nbsp;<span id="ast-41">True</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;*args,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-9" class="other_trans">RegistrationForm</span>,&nbsp;<span id="ast-10">self</span>)</span>.__init__</span>(*<span id="ast-11" class="other_trans">args</span>,&nbsp;**<span id="ast-12" class="other_trans">kwargs</span>)</span></span><span id="ast-13"><span id="ast-14" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>auth_db&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">get_or_create</span>(<span id="ast-17" class="other_trans">server_uri</span>,&nbsp;<span id="ast-18">(<span id="ast-19">'%s%s'</span>&nbsp;%&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">DB_PREFIX</span>,&nbsp;<span id="ast-23">'auth'</span>)</span>)</span>)</span></span><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>User&nbsp;&rarr;&nbsp;self.&nbsp;</span>.id_view</span>.sync</span>(<span id="ast-29" class="other_trans">auth_db</span>)</span></span><span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>User</span>.email_view</span>.sync</span>(<span id="ast-35" class="other_trans">auth_db</span>)</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>User</span>.is_active_view</span>.sync</span>(<span id="ast-41" class="other_trans">auth_db</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;round_up(<span id="ast-2"><span id="ast-3" class="other_trans">value</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>int_value</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">int</span>(<span id="ast-8" class="other_trans">value</span>)</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-16">1</span>&nbsp;if&nbsp;<span id="ast-12">(<span id="ast-13" class="ref_node">int_value&nbsp;&rarr;&nbsp;value&nbsp;</span><span id="ast-14" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-15">0</span>)</span>&nbsp;else&nbsp;<span id="ast-17">-1</span></span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-19"><span id="ast-24">(<span id="ast-25" class="other_trans">int_value</span>&nbsp;+&nbsp;<span id="ast-27" class="other_trans">diff</span>)</span>&nbsp;if&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">value</span><span id="ast-22" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-23" class="other_trans">int_value</span>)</span>&nbsp;else&nbsp;<span id="ast-28" class="incorrect_node">int_value&nbsp;&rarr;&nbsp;value&nbsp;</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;deploy(<span id="ast-2"><span id="ast-3" class="other_trans">filename</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-5"><span id="ast-6">open</span>(<span id="ast-7" class="other_trans">filename</span>)</span>&nbsp;as&nbsp;<span id="ast-8">f</span>:<span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>config</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">yaml</span>.load</span>(<span id="ast-14" class="other_trans">f</span>)</span></span></span><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>workdir</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">config</span>[<span id="ast-19"><span id="ast-20">'workdir'</span></span>]</span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>resource_save_path</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-27">workdir</span>,&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">config</span>[<span id="ast-30"><span id="ast-31">'resource-save-path'</span></span>]</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>clients_file</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-38">workdir</span>,&nbsp;<span id="ast-39">'clients.json'</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44">os</span>.path</span>.exists</span>(<span id="ast-45" class="other_trans">clients_file</span>)</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.remove</span>(<span id="ast-50" class="other_trans">clients_file</span>)</span></span></span><span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>shutil</span>.rmtree</span>(<span id="ast-55" class="other_trans">resource_save_path</span>,&nbsp;ignore_errors=<span id="ast-57">True</span>)</span></span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.makedirs</span>(<span id="ast-62" class="other_trans">resource_save_path</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-64" class="other_trans">resource_definition</span>&nbsp;in&nbsp;<span id="ast-65"><span id="ast-66">config</span>[<span id="ast-67"><span id="ast-68">'resources'</span></span>]</span>:<span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72" class="other_trans">resource_definition</span>[<span id="ast-73"><span id="ast-74">'name'</span></span>]</span></span><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>model</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-81" class="other_trans">workdir</span>,&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">resource_definition</span>[<span id="ast-84"><span id="ast-85">'model'</span></span>]</span>)</span></span><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90">resource_definition</span>.get</span>(<span id="ast-91">'args'</span>,&nbsp;<span id="ast-92">{}</span>)</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-94">'Creating&nbsp;'</span>,&nbsp;<span id="ast-95">name</span>,&nbsp;<span id="ast-96" class="other_trans">model</span>,&nbsp;<span id="ast-97" class="other_trans">resource_save_path</span>,&nbsp;<span id="ast-98" class="other_trans">args</span></span><span id="ast-99"><span id="ast-100"><span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>xr</span>.create</span>(<span id="ast-103" class="other_trans">name</span>,&nbsp;<span id="ast-104" class="other_trans">model</span>,&nbsp;<span id="ast-105">resource_save_path</span>,&nbsp;args=<span id="ast-107">args</span>)</span></span></span><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-109">connection</span>&nbsp;in&nbsp;<span id="ast-110"><span id="ast-111" class="other_trans">config</span>[<span id="ast-112"><span id="ast-113">'connections'</span></span>]</span>:<span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>emitter</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118">db</span>.get_resource</span>(<span id="ast-119"><span id="ast-120" class="other_trans">connection</span>[<span id="ast-121"><span id="ast-122">'emitter'</span></span>]</span>)</span></span><span id="ast-123"><span id="ast-124" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>receiver</span>&nbsp;=&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127">db</span>.get_resource</span>(<span id="ast-128"><span id="ast-129" class="other_trans">connection</span>[<span id="ast-130"><span id="ast-131">'receiver'</span></span>]</span>)</span></span><span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mapping</span>&nbsp;=&nbsp;<span id="ast-134"><span id="ast-135"><span id="ast-136" class="ref_node">config&nbsp;&rarr;&nbsp;connection&nbsp;</span>.get</span>(<span id="ast-137">'mapping'</span>)</span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-139">'Connecting&nbsp;'</span>,&nbsp;<span id="ast-140"><span id="ast-141" class="incorrect_node">emitter&nbsp;&rarr;&nbsp;receiver&nbsp;</span>.name</span>,&nbsp;<span id="ast-142"><span id="ast-143">receiver</span>.name</span>,&nbsp;<span id="ast-144">mapping</span></span><span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>xs</span>.connect</span>(<span id="ast-149">emitter</span>,&nbsp;<span id="ast-150" class="other_trans">receiver</span>,&nbsp;mapping=<span id="ast-152" class="other_trans">mapping</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_keyset_preprocess(<span id="ast-2"><span id="ast-3" class="other_trans">keyset</span>,&nbsp;<span id="ast-4" class="other_trans">params</span>,&nbsp;<span id="ast-5" class="other_trans">parts_list</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;parts_preprocess&nbsp;for&nbsp;a&nbsp;specific&nbsp;keyset&nbsp;'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">keyset</span>.get</span>(<span id="ast-12">'parts_preprocess'</span>,&nbsp;<span id="ast-13">False</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-15" class="other_trans">func</span>&nbsp;in&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">keyset</span>[<span id="ast-18"><span id="ast-19">'parts_preprocess'</span></span>]</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_list</span>&nbsp;=&nbsp;<span id="ast-22">[<span id="ast-23"><span id="ast-24"><span id="ast-25" class="location_node">parts&nbsp;&rarr;&nbsp;parts_list,&nbsp;pred:&nbsp;keyset&nbsp;</span>.get</span>(<span id="ast-26">'_keyset'</span>)</span>]</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-28" class="other_trans">parts</span>&nbsp;in&nbsp;<span id="ast-29" class="other_trans">parts_list</span>:<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_list</span>.extend</span>(<span id="ast-34">[<span id="ast-35" class="other_trans">x</span><span id="ast-36">&nbsp;for&nbsp;<span id="ast-37" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">func</span>(<span id="ast-40" class="other_trans">parts</span>,&nbsp;<span id="ast-41" class="other_trans">params</span>)</span></span>]</span>)</span></span></span><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parts_list</span>&nbsp;=&nbsp;<span id="ast-44" class="other_trans">new_list</span></span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46" class="other_trans">parts_list</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse_binary_operator_expression(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">lhs</span>,&nbsp;<span id="ast-5" class="other_trans">min_precedence</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parse&nbsp;an&nbsp;infix&nbsp;operator&nbsp;expression.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;See&nbsp;http://en.wikipedia.org/wiki/Operator-precedence_parser\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.precedence</span>(<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.peek</span>()</span>)</span><span id="ast-17" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-18" class="other_trans">min_precedence</span>)</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>op</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.next</span>()</span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>precedence</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28">self</span>.precedence</span>(<span id="ast-29"><span id="ast-30" class="other_trans">op</span>.type</span>)</span></span><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rhs</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>.parse_unary_expression</span>()</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>next_precedence</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">self</span>.precedence</span>(<span id="ast-41"><span id="ast-42"><span id="ast-43">self</span>.peek</span>()</span>)</span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-45">(<span id="ast-46" class="other_trans">next_precedence</span><span id="ast-47" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-48">precedence</span>)</span>:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rhs</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53">self</span>.parse_binary_operator_expression</span>(<span id="ast-54" class="other_trans">rhs</span>,&nbsp;<span id="ast-55" class="other_trans">next_precedence</span>)</span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>next_precedence</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>.precedence</span>(<span id="ast-61"><span id="ast-62"><span id="ast-63">self</span>.peek</span>()</span>)</span></span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67">self</span>.is_comparison_op</span>(<span id="ast-68"><span id="ast-69" class="other_trans">op</span>.type</span>)</span>:<span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lhs</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74">self</span>.create_compare_operation</span>(<span id="ast-75"><span id="ast-76" class="other_trans">op</span>.value</span>,&nbsp;<span id="ast-77" class="other_trans">lhs</span>,&nbsp;<span id="ast-78" class="other_trans">rhs</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lhs</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82"><span id="ast-83">self</span>.create_binary_operation</span>(<span id="ast-84"><span id="ast-85" class="other_trans">op</span>.value</span>,&nbsp;<span id="ast-86" class="other_trans">lhs</span>,&nbsp;<span id="ast-87" class="other_trans">rhs</span>)</span></span></span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-89" class="other_trans">lhs</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;read(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">size</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7">not</span>&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">isinstance</span>(<span id="ast-10" class="other_trans">size</span>,&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">six</span>.integer_types</span>)</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">TypeError</span>(<span id="ast-16">'size&nbsp;must&nbsp;be&nbsp;an&nbsp;integral&nbsp;type'</span>)</span></span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19" class="other_trans">size</span><span id="ast-20" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-21">0</span>)</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">ValueError</span>(<span id="ast-25">'Size&nbsp;must&nbsp;be&nbsp;positive.'</span>)</span></span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">size</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30">0</span>)</span>:<span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-32">''</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;recv_until(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">marker</span>,&nbsp;<span id="ast-5">timeout</span>,&nbsp;<span id="ast-7" class="other_trans">maxbytes</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'read&nbsp;off&nbsp;of&nbsp;socket&nbsp;until&nbsp;the&nbsp;marker&nbsp;is&nbsp;found'</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">maxbytes</span><span id="ast-14" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-15">_UNSET</span>)</span>:<span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>maxbytes</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19">self</span>.maxbytes</span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">timeout</span><span id="ast-23" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-24" class="other_trans">_UNSET</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>timeout</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28">self</span>.timeout</span></span></span><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>chunks</span>&nbsp;=&nbsp;<span id="ast-31">[]</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>recvd</span>&nbsp;=&nbsp;<span id="ast-34">0</span></span><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>nxt</span>&nbsp;=&nbsp;<span id="ast-37">''</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42">gevent</span>.Timeout</span>(<span id="ast-43" class="other_trans">timeout</span>,&nbsp;<span id="ast-44">False</span>)</span>:<span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nxt</span>&nbsp;=&nbsp;<span id="ast-47">(<span id="ast-49"><span id="ast-50">self</span>.rbuf</span>&nbsp;or&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54">self</span>.sock</span>.recv</span>(<span id="ast-55">(<span id="ast-56">32</span>&nbsp;*&nbsp;<span id="ast-58">1024</span>)</span>)</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-60">(<span id="ast-62">nxt</span>&nbsp;and&nbsp;<span id="ast-63">(<span id="ast-64" class="other_trans">marker</span><span id="ast-65">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-66">nxt</span>)</span>)</span>:<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>chunks</span>.append</span>(<span id="ast-71" class="other_trans">nxt</span>)</span></span><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>recvd</span>&nbsp;+=&nbsp;<span id="ast-75"><span id="ast-76">len</span>(<span id="ast-77">nxt</span>)</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-79">(<span id="ast-81">(<span id="ast-82" class="other_trans">maxbytes</span><span id="ast-83" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-84">None</span>)</span>&nbsp;and&nbsp;<span id="ast-85">(<span id="ast-86" class="other_trans">recvd</span><span id="ast-87" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-88" class="other_trans">maxbytes</span>)</span>)</span>:<span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-90"><span id="ast-91">NotFound</span>(<span id="ast-92" class="other_trans">marker</span>,&nbsp;<span id="ast-93" class="other_trans">recvd</span>)</span></span></span><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nxt</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99">self</span>.sock</span>.recv</span>(<span id="ast-100">(<span id="ast-101">32</span>&nbsp;*&nbsp;<span id="ast-103">1024</span>)</span>)</span></span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-105">(<span id="ast-106">not</span>&nbsp;<span id="ast-107" class="other_trans">nxt</span>)</span>:<span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-109"><span id="ast-110" class="other_trans">ConnectionClosed</span>(<span id="ast-111"><span id="ast-112"><span id="ast-113">'connection&nbsp;closed&nbsp;after&nbsp;reading&nbsp;{0}&nbsp;bytes&nbsp;without&nbsp;finding&nbsp;symbol&nbsp;{1}'</span>.format</span>(<span id="ast-114">recvd</span>,&nbsp;<span id="ast-115" class="other_trans">marker</span>)</span>)</span></span></span></span><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-117">(<span id="ast-118" class="other_trans">marker</span><span id="ast-119">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-120" class="other_trans">nxt</span>)</span>:<span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-122"><span id="ast-123">Timeout</span>(<span id="ast-124" class="other_trans">timeout</span>,&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127">'read&nbsp;{0}&nbsp;bytes&nbsp;without&nbsp;finding&nbsp;symbol&nbsp;{1}'</span>.format</span>(<span id="ast-128">recvd</span>,&nbsp;<span id="ast-129" class="other_trans">marker</span>)</span>)</span></span></span><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.rbuf</span>&nbsp;=&nbsp;<span id="ast-134"><span id="ast-135"><span id="ast-136">''</span>.join</span>(<span id="ast-137" class="other_trans">chunks</span>)</span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span></span><span id="ast-139"><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-141" class="other_trans">val</span>,&nbsp;<span id="ast-142" class="other_trans">_</span>,&nbsp;<span id="ast-143"><span id="ast-144">self</span>.rbuf</span>)</span>&nbsp;=&nbsp;<span id="ast-145"><span id="ast-146"><span id="ast-147">nxt</span>.partition</span>(<span id="ast-148" class="other_trans">marker</span>)</span></span><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-150">(<span id="ast-151"><span id="ast-152"><span id="ast-153">''</span>.join</span>(<span id="ast-154" class="other_trans">chunks</span>)</span>&nbsp;+&nbsp;<span id="ast-156">val</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;all_occurrences(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">from_date</span>,&nbsp;<span id="ast-6" class="other_trans">to_date</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;a&nbsp;generator&nbsp;yielding&nbsp;a&nbsp;(start,&nbsp;end)&nbsp;tuple&nbsp;for&nbsp;all&nbsp;dates\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;this&nbsp;occurrence,&nbsp;taking&nbsp;repetition&nbsp;into&nbsp;account.&nbsp;'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>from_date</span>&nbsp;=&nbsp;<span id="ast-12">(<span id="ast-14" class="other_trans">from_date</span>&nbsp;and&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">as_datetime</span>(<span id="ast-17" class="other_trans">from_date</span>)</span>)</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>to_date</span>&nbsp;=&nbsp;<span id="ast-20">(<span id="ast-22" class="other_trans">to_date</span>&nbsp;and&nbsp;<span id="ast-23"><span id="ast-24">as_datetime</span>(<span id="ast-25" class="other_trans">to_date</span>,&nbsp;<span id="ast-26">True</span>)</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-29"><span id="ast-30">self</span>.repeat</span><span id="ast-31" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-32" class="other_trans">None</span>)</span>:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34">(<span id="ast-36">(<span id="ast-38">(<span id="ast-39">not</span>&nbsp;<span id="ast-40" class="other_trans">from_date</span>)</span>&nbsp;or&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43">self</span>.start</span><span id="ast-44" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-45" class="other_trans">from_date</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-46">(<span id="ast-48">(<span id="ast-49">not</span>&nbsp;<span id="ast-50" class="other_trans">to_date</span>)</span>&nbsp;or&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-53">self</span>.start</span><span id="ast-54" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-55" class="other_trans">to_date</span>)</span>)</span>)</span>:<span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60">self</span>.start</span>,&nbsp;<span id="ast-61"><span id="ast-62">self</span>.end</span>,&nbsp;<span id="ast-63"><span id="ast-64">self</span>.occurrence_data</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>delta</span>&nbsp;=&nbsp;<span id="ast-67">(<span id="ast-68"><span id="ast-69">self</span>.end</span>&nbsp;-&nbsp;<span id="ast-71"><span id="ast-72">self</span>.start</span>)</span></span><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>repeater</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">rrule</span>.rrule</span>(<span id="ast-78"><span id="ast-79">self</span>.repeat</span>,&nbsp;dtstart=<span id="ast-81"><span id="ast-82">self</span>.start</span>,&nbsp;count=<span id="ast-84"><span id="ast-85">self</span>.REPEAT_MAX</span>)</span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-87">(<span id="ast-89"><span id="ast-90">self</span>.repeat_until</span>&nbsp;and&nbsp;<span id="ast-91">(<span id="ast-93">(<span id="ast-94">not</span>&nbsp;<span id="ast-95" class="other_trans">to_date</span>)</span>&nbsp;or&nbsp;<span id="ast-96">(<span id="ast-97"><span id="ast-98" class="other_trans">as_datetime</span>(<span id="ast-99"><span id="ast-100">self</span>.repeat_until</span>,&nbsp;<span id="ast-101">True</span>)</span><span id="ast-102" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-103" class="other_trans">to_date</span>)</span>)</span>)</span>:<span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>to_date</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107">as_datetime</span>(<span id="ast-108"><span id="ast-109">self</span>.repeat_until</span>,&nbsp;<span id="ast-110">True</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;initialize(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_set_logging</span>(<span id="ast-8"><span id="ast-9">self</span>.sock</span>,&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.CONFIG</span>[<span id="ast-14"><span id="ast-15">'CFx'</span></span>]</span>[<span id="ast-16"><span id="ast-17">'tincan_logging'</span></span>]</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21">self</span>.vpn_type</span><span id="ast-22" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-23">'GroupVPN'</span>)</span>:<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_set_translation</span>(<span id="ast-28"><span id="ast-29">self</span>.sock</span>,&nbsp;<span id="ast-30">0</span>)</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_set_switchmode</span>(<span id="ast-35"><span id="ast-36">self</span>.sock</span>,&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40">self</span>.CONFIG</span>[<span id="ast-41"><span id="ast-42">'TincanSender'</span></span>]</span>[<span id="ast-43"><span id="ast-44">'switchmode'</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-46">(<span id="ast-47"><span id="ast-48">self</span>.vpn_type</span><span id="ast-49" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-50">'SocialVPN'</span>)</span>:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_set_translation</span>(<span id="ast-55"><span id="ast-56">self</span>.sock</span>,&nbsp;<span id="ast-57">1</span>)</span></span></span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_set_cb_endpoint</span>(<span id="ast-62"><span id="ast-63">self</span>.sock</span>,&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67">self</span>.sock</span>.getsockname</span>()</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_set_local_ip</span>(<span id="ast-72"><span id="ast-73">self</span>.sock</span>,&nbsp;<span id="ast-74"><span id="ast-75">self</span>.uid</span>,&nbsp;<span id="ast-76"><span id="ast-77">self</span>.ip4</span>,&nbsp;<span id="ast-78"><span id="ast-79">self</span>.ip6</span>,&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83">self</span>.CONFIG</span>[<span id="ast-84"><span id="ast-85">'CFx'</span></span>]</span>[<span id="ast-86"><span id="ast-87">'ip4_mask'</span></span>]</span>,&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91">self</span>.CONFIG</span>[<span id="ast-92"><span id="ast-93">'CFx'</span></span>]</span>[<span id="ast-94"><span id="ast-95">'ip6_mask'</span></span>]</span>,&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99">self</span>.CONFIG</span>[<span id="ast-100"><span id="ast-101">'CFx'</span></span>]</span>[<span id="ast-102"><span id="ast-103">'subnet_mask'</span></span>]</span>,&nbsp;<span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107">self</span>.CONFIG</span>[<span id="ast-108"><span id="ast-109">'TincanSender'</span></span>]</span>[<span id="ast-110"><span id="ast-111">'switchmode'</span></span>]</span>)</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_register_service</span>(<span id="ast-116"><span id="ast-117">self</span>.sock</span>,&nbsp;<span id="ast-118"><span id="ast-119">self</span>.user</span>,&nbsp;<span id="ast-120"><span id="ast-121">self</span>.password</span>,&nbsp;<span id="ast-122"><span id="ast-123">self</span>.host</span>,&nbsp;<span id="ast-124"><span id="ast-125">self</span>.port</span>)</span></span><span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_set_trimpolicy</span>(<span id="ast-130"><span id="ast-131">self</span>.sock</span>,&nbsp;<span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135">self</span>.CONFIG</span>[<span id="ast-136"><span id="ast-137">'CFx'</span></span>]</span>[<span id="ast-138"><span id="ast-139">'trim_enabled'</span></span>]</span>)</span></span><span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.do_get_state</span>(<span id="ast-144"><span id="ast-145">self</span>.sock</span>)</span></span><span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-147">(<span id="ast-148">'network_ignore_list'</span><span id="ast-149">&nbsp;in&nbsp;</span><span id="ast-150"><span id="ast-151"><span id="ast-152">self</span>.CONFIG</span>[<span id="ast-153"><span id="ast-154">'CFx'</span></span>]</span>)</span>:<span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fxlib</span>.make_call</span>(<span id="ast-159"><span id="ast-160">self</span>.sock</span>,&nbsp;m=<span id="ast-162">'set_network_ignore_list'</span>,&nbsp;network_ignore_list=<span id="ast-164"><span id="ast-165"><span id="ast-166" class="correct_node">CONFIG&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-167"><span id="ast-168">'CFx'</span></span>]</span>[<span id="ast-169"><span id="ast-170">'network_ignore_list'</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getProject(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;a&nbsp;minimally&nbsp;hydrated&nbsp;Project&nbsp;instance&nbsp;with&nbsp;the&nbsp;Name&nbsp;and&nbsp;ref\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;project&nbsp;in&nbsp;the&nbsp;currently&nbsp;active&nbsp;context&nbsp;if&nbsp;the&nbsp;name&nbsp;keyword&nbsp;arg\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;not&nbsp;supplied&nbsp;or&nbsp;the&nbsp;Name&nbsp;and&nbsp;ref&nbsp;of&nbsp;the&nbsp;project&nbsp;identified&nbsp;by&nbsp;the&nbsp;name\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;name&nbsp;identifies&nbsp;a&nbsp;valid&nbsp;project&nbsp;in&nbsp;the&nbsp;currently&nbsp;selected&nbsp;workspace.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;None&nbsp;if&nbsp;a&nbsp;name&nbsp;parameter&nbsp;is&nbsp;supplied&nbsp;that&nbsp;does&nbsp;not&nbsp;identify&nbsp;a&nbsp;valid&nbsp;project\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;currently&nbsp;selected&nbsp;workspace.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.contextHelper</span>.currentContext</span>()</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16">not</span>&nbsp;<span id="ast-17">name</span>)</span>:<span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-20" class="other_trans">proj_name</span>,&nbsp;<span id="ast-21" class="other_trans">proj_ref</span>)</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.contextHelper</span>.getProject</span>()</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">_createShellInstance</span>(<span id="ast-29" class="other_trans">context</span>,&nbsp;<span id="ast-30">'Project'</span>,&nbsp;<span id="ast-31" class="other_trans">proj_name</span>,&nbsp;<span id="ast-32" class="other_trans">proj_ref</span>)</span></span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>projs</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38">self</span>.contextHelper</span>.getAccessibleProjects</span>(workspace=<span id="ast-40">'current'</span>)</span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>hits</span>&nbsp;=&nbsp;<span id="ast-43">[<span id="ast-44">(<span id="ast-45" class="other_trans">proj</span>,&nbsp;<span id="ast-46" class="other_trans">ref</span>)</span><span id="ast-47">&nbsp;for&nbsp;<span id="ast-48">(<span id="ast-49" class="other_trans">proj</span>,&nbsp;<span id="ast-50" class="other_trans">ref</span>)</span>&nbsp;in&nbsp;<span id="ast-51" class="other_trans">projs</span>&nbsp;if&nbsp;<span id="ast-52">(<span id="ast-53"><span id="ast-54">str</span>(<span id="ast-55" class="other_trans">proj</span>)</span><span id="ast-56" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-57"><span id="ast-58" class="other_trans">str</span>(<span id="ast-59" class="other_trans">name</span>)</span>)</span></span>]</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61">(<span id="ast-62">not</span>&nbsp;<span id="ast-63" class="other_trans">hits</span>)</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-65" class="other_trans">None</span></span></span><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tp</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="correct_node">projs&nbsp;&rarr;&nbsp;hits&nbsp;</span>[<span id="ast-70"><span id="ast-71">0</span></span>]</span></span><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tp_ref</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75" class="other_trans">tp</span>[<span id="ast-76"><span id="ast-77">1</span></span>]</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-79"><span id="ast-80">_createShellInstance</span>(<span id="ast-81" class="other_trans">context</span>,&nbsp;<span id="ast-82">'Project'</span>,&nbsp;<span id="ast-83" class="other_trans">name</span>,&nbsp;<span id="ast-84" class="other_trans">tp_ref</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;read(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">length</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">self</span>._offset</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11">(<span id="ast-12" class="other_trans">offset</span>&nbsp;+&nbsp;<span id="ast-14" class="other_trans">length</span>)</span><span id="ast-15" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-16"><span id="ast-17" class="other_trans">len</span>(<span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>._leaf</span>.data</span>)</span>)</span>:<span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._offset</span>&nbsp;+=&nbsp;<span id="ast-25" class="incorrect_node">length&nbsp;&rarr;&nbsp;offset&nbsp;</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30">self</span>._leaf</span>.data</span>[<span id="ast-31"><span id="ast-32" class="other_trans">offset</span>:<span id="ast-33">(<span id="ast-34" class="other_trans">offset</span>&nbsp;+&nbsp;<span id="ast-36" class="other_trans">length</span>)</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">title</span>,&nbsp;<span id="ast-5" class="other_trans">url</span>,&nbsp;<span id="ast-6" class="other_trans">width</span>,&nbsp;<span id="ast-7" class="other_trans">height</span>,&nbsp;<span id="ast-8" class="other_trans">resizable</span>,&nbsp;<span id="ast-9" class="other_trans">fullscreen</span>,&nbsp;<span id="ast-10" class="other_trans">min_size</span>,&nbsp;<span id="ast-11" class="other_trans">webview_ready</span></span>):<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>BrowserView</span>.instance</span>&nbsp;=&nbsp;<span id="ast-15">self</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.webview_ready</span>&nbsp;=&nbsp;<span id="ast-19" class="other_trans">webview_ready</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Gdk</span>.threads_init</span>()</span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28">gtk</span>.Window</span>(title=<span id="ast-30" class="other_trans">title</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">resizable</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.set_size_request</span>(<span id="ast-37"><span id="ast-38" class="other_trans">min_size</span>[<span id="ast-39"><span id="ast-40">0</span></span>]</span>,&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">min_size</span>[<span id="ast-43"><span id="ast-44">1</span></span>]</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.resize</span>(<span id="ast-49" class="other_trans">width</span>,&nbsp;<span id="ast-50" class="other_trans">height</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.set_size_request</span>(<span id="ast-55" class="other_trans">width</span>,&nbsp;<span id="ast-56" class="other_trans">height</span>)</span></span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.set_resizable</span>(<span id="ast-61" class="incorrect_node">resizable&nbsp;&rarr;&nbsp;min_size&nbsp;</span>)</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.set_position</span>(<span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans">gtk</span>.WindowPosition</span>.CENTER</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70" class="other_trans">fullscreen</span>:<span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.fullscreen</span>()</span></span></span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.connect</span>(<span id="ast-79">'delete-event'</span>,&nbsp;<span id="ast-80"><span id="ast-81" class="other_trans">gtk</span>.main_quit</span>)</span></span><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>scrolled_window</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans">gtk</span>.ScrolledWindow</span>()</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.add</span>(<span id="ast-91" class="other_trans">scrolled_window</span>)</span></span><span id="ast-92"><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.window</span>&nbsp;=&nbsp;<span id="ast-95">window</span></span><span id="ast-96"><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.webview</span>&nbsp;=&nbsp;<span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans">webkit</span>.WebView</span>()</span></span><span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.webview</span>.connect</span>(<span id="ast-107">'notify::visible'</span>,&nbsp;<span id="ast-108"><span id="ast-109">self</span>._handle_webview_ready</span>)</span></span><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.webview</span>.props</span>.settings</span>.props</span>.enable_default_context_menu</span>&nbsp;=&nbsp;<span id="ast-117">False</span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>scrolled_window</span>.add_with_viewport</span>(<span id="ast-122"><span id="ast-123">self</span>.webview</span>)</span></span><span id="ast-124"><span id="ast-125"><span id="ast-126"><span id="ast-127" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.show_all</span>()</span></span><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-129">(<span id="ast-130">url</span><span id="ast-131" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-132">None</span>)</span>:<span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>webview&nbsp;&rarr;&nbsp;self.&nbsp;</span>.load_uri</span>(<span id="ast-137" class="other_trans">url</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">compression</span>,&nbsp;<span id="ast-6" class="other_trans">interlace</span>,&nbsp;<span id="ast-8" class="other_trans">png8</span>,&nbsp;<span id="ast-10" class="other_trans">optimize</span>,&nbsp;**kwargs</span>):<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14">compression</span><span id="ast-15" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-16" class="other_trans">None</span>)</span>:<span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>compression</span>&nbsp;=&nbsp;<span id="ast-19">6</span></span></span><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>_compression</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">int</span>(<span id="ast-24">compression</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-27">not</span>&nbsp;<span id="ast-28">(<span id="ast-29">0</span><span id="ast-30" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-32" class="other_trans">_compression</span><span id="ast-31" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-33">9</span>)</span>)</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">ValueError</span>(<span id="ast-37"><span id="ast-38"><span id="ast-39">'compression&nbsp;must&nbsp;be&nbsp;between&nbsp;0&nbsp;and&nbsp;9:&nbsp;{0!r}'</span>.format</span>(<span id="ast-40">compression</span>)</span>)</span></span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.compression</span>&nbsp;=&nbsp;<span id="ast-44">_compression</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.interlace</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49">bool</span>(<span id="ast-50">interlace</span>)</span></span><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>_png8</span>&nbsp;=&nbsp;<span id="ast-53" class="other_trans">png8</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">_png8</span><span id="ast-57" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-58">None</span>)</span>:<span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_png8</span>&nbsp;=&nbsp;<span id="ast-61">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-63">(<span id="ast-64" class="other_trans">_png8</span><span id="ast-65" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-66">True</span>)</span>:<span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_png8</span>&nbsp;=&nbsp;<span id="ast-69">256</span></span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-71">(<span id="ast-72" class="other_trans">_png8</span><span id="ast-73" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-74">False</span>)</span>:<span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_png8</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78" class="other_trans">int</span>(<span id="ast-79" class="other_trans">_png8</span>)</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-81">(<span id="ast-82">not</span>&nbsp;<span id="ast-83">(<span id="ast-84">2</span><span id="ast-85" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-87">_png8</span><span id="ast-86" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-88">256</span>)</span>)</span>:<span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-90"><span id="ast-91">ValueError</span>(<span id="ast-92"><span id="ast-93"><span id="ast-94">'png8&nbsp;must&nbsp;be&nbsp;between&nbsp;2&nbsp;and&nbsp;256:&nbsp;{0!r}'</span>.format</span>(<span id="ast-95" class="other_trans">png8</span>)</span>)</span></span></span></span><span id="ast-96"><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.png8</span>&nbsp;=&nbsp;<span id="ast-99">_png8</span></span><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>_optimize</span>&nbsp;=&nbsp;<span id="ast-102" class="other_trans">optimize</span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-104">(<span id="ast-105" class="other_trans">_optimize</span><span id="ast-106" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-107" class="other_trans">None</span>)</span>:<span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_optimize</span>&nbsp;=&nbsp;<span id="ast-110">False</span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112">(<span id="ast-113" class="ref_node">optimize&nbsp;&rarr;&nbsp;_optimize&nbsp;</span><span id="ast-114" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-115">False</span>)</span>:<span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_optimize</span>&nbsp;=&nbsp;<span id="ast-118"><span id="ast-119">int</span>(<span id="ast-120" class="other_trans">_optimize</span>)</span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122">(<span id="ast-123">not</span>&nbsp;<span id="ast-124">(<span id="ast-125">0</span><span id="ast-126" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-128" class="other_trans">_optimize</span><span id="ast-127" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-129">7</span>)</span>)</span>:<span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-131"><span id="ast-132">ValueError</span>(<span id="ast-133"><span id="ast-134"><span id="ast-135">'optimize&nbsp;must&nbsp;be&nbsp;between&nbsp;0&nbsp;and&nbsp;7:&nbsp;{0!r}'</span>.format</span>(<span id="ast-136">optimize</span>)</span>)</span></span></span></span><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-138" class="other_trans">_optimize</span>:<span id="ast-139"><span id="ast-140"><span id="ast-141"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.compression</span>&nbsp;=&nbsp;<span id="ast-142">1</span></span></span><span id="ast-143"><span id="ast-144"><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.optimize</span>&nbsp;=&nbsp;<span id="ast-146" class="other_trans">_optimize</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_current_activity(<span id="ast-2"><span id="ast-3" class="other_trans">activities</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7" class="other_trans">activities</span>)</span>:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-9" class="other_trans">None</span></span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>activities_with_no_end_years</span>&nbsp;=&nbsp;<span id="ast-12">[<span id="ast-13" class="other_trans">a</span><span id="ast-14">&nbsp;for&nbsp;<span id="ast-15" class="other_trans">a</span>&nbsp;in&nbsp;<span id="ast-16" class="other_trans">activities</span>&nbsp;if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">a</span>[<span id="ast-21"><span id="ast-22">'end_year'</span></span>]</span>)</span></span>]</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24" class="other_trans">activities_with_no_end_years</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">sorted</span>(<span id="ast-29" class="correct_node">activities&nbsp;&rarr;&nbsp;activities_with_no_end_years&nbsp;</span>,&nbsp;key=<span id="ast-31">lambda&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">k</span></span>:&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">k</span>[<span id="ast-36"><span id="ast-37">'start_year'</span></span>]</span></span>,&nbsp;reverse=<span id="ast-39">True</span>)</span>[<span id="ast-40"><span id="ast-41">0</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;task_subdivide(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">orig_args</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Splits&nbsp;a&nbsp;single&nbsp;set&nbsp;of&nbsp;input&nbsp;files&nbsp;into&nbsp;multiple&nbsp;output&nbsp;file&nbsp;names,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;the&nbsp;number&nbsp;of&nbsp;output&nbsp;files&nbsp;may&nbsp;not&nbsp;be&nbsp;known&nbsp;beforehand.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>decorator_name</span>&nbsp;=&nbsp;<span id="ast-9">'@subdivide'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>error_type</span>&nbsp;=&nbsp;<span id="ast-12" class="other_trans">error_task_subdivide</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.set_action_type</span>(<span id="ast-17"><span id="ast-18" class="other_trans">_task</span>.action_task_subdivide</span>)</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>do_task_subdivide&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-22" class="other_trans">orig_args</span>,&nbsp;<span id="ast-23" class="other_trans">decorator_name</span>,&nbsp;<span id="ast-24" class="other_trans">error_type</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">key</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>key</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">hashlib</span>.sha256</span>(<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">key</span>.encode</span>(<span id="ast-15">'utf-8'</span>)</span>)</span>.digest</span>()</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">super</span>(<span id="ast-22" class="other_trans">CelestialChunks</span>,&nbsp;<span id="ast-23">self</span>)</span>.get</span>(<span id="ast-24" class="correct_node">data&nbsp;&rarr;&nbsp;key&nbsp;</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">zlib</span>.decompress</span>(<span id="ast-30" class="other_trans">data</span>)</span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>stream</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">io</span>.BytesIO</span>(<span id="ast-36" class="other_trans">data</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">read_versioned_json</span>(<span id="ast-40" class="other_trans">stream</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;checkConfig(<span id="ast-2"></span>):<span id="ast-3"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>global&nbsp;req_api_version</span><span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-6">{<span id="ast-7">'status'</span>:&nbsp;<span id="ast-9">False</span>,&nbsp;<span id="ast-8">'message'</span>:&nbsp;<span id="ast-10">''</span>}</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-14">(<span id="ast-15"><span id="ast-16" class="other_trans">Prefs</span>[<span id="ast-17"><span id="ast-18">'tvheadend_user'</span></span>]</span><span id="ast-19" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-20">''</span>)</span>&nbsp;and&nbsp;<span id="ast-21">(<span id="ast-22"><span id="ast-23" class="other_trans">Prefs</span>[<span id="ast-24"><span id="ast-25">'tvheadend_pass'</span></span>]</span><span id="ast-26" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-27">''</span>)</span>&nbsp;and&nbsp;<span id="ast-28">(<span id="ast-29"><span id="ast-30" class="other_trans">Prefs</span>[<span id="ast-31"><span id="ast-32">'tvheadend_host'</span></span>]</span><span id="ast-33" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-34">''</span>)</span>&nbsp;and&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37">Prefs</span>[<span id="ast-38"><span id="ast-39">'tvheadend_web_port'</span></span>]</span><span id="ast-40" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-41">''</span>)</span>&nbsp;and&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44">Prefs</span>[<span id="ast-45"><span id="ast-46">'tvheadend_user'</span></span>]</span><span id="ast-47" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-48">None</span>)</span>&nbsp;and&nbsp;<span id="ast-49">(<span id="ast-50"><span id="ast-51">Prefs</span>[<span id="ast-52"><span id="ast-53">'tvheadend_pass'</span></span>]</span><span id="ast-54" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-55" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58" class="other_trans">Prefs</span>[<span id="ast-59"><span id="ast-60">'tvheadend_host'</span></span>]</span><span id="ast-61" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-62">None</span>)</span>&nbsp;and&nbsp;<span id="ast-63">(<span id="ast-64"><span id="ast-65" class="other_trans">Prefs</span>[<span id="ast-66"><span id="ast-67">'tvheadend_web_port'</span></span>]</span><span id="ast-68" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-69">None</span>)</span>)</span>:<span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>json_data</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73">getTVHeadendJson</span>(<span id="ast-74">'getServerVersion'</span>,&nbsp;<span id="ast-75">''</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77">(<span id="ast-78" class="other_trans">json_data</span><span id="ast-79" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-80">False</span>)</span>:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-82">(<span id="ast-83"><span id="ast-84" class="other_trans">json_data</span>[<span id="ast-85"><span id="ast-86">'api_version'</span></span>]</span><span id="ast-87" class="location_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-88" class="other_trans">req_api_version</span>)</span>:<span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-92"><span id="ast-93">'status'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-94">True</span></span><span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-98"><span id="ast-99">'message'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-100">''</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-102" class="other_trans">result</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-106"><span id="ast-107">'status'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-108">False</span></span><span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-112"><span id="ast-113">'message'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-114"><span id="ast-115">L</span>(<span id="ast-116">'error_api_version'</span>)</span></span><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-118" class="other_trans">result</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-122"><span id="ast-123">'status'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-124">False</span></span><span id="ast-125"><span id="ast-126"><span id="ast-127" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-128"><span id="ast-129">'message'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-130"><span id="ast-131">L</span>(<span id="ast-132">'error_connection'</span>)</span></span><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-134" class="other_trans">result</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-136">(<span id="ast-138">(<span id="ast-139"><span id="ast-140">Prefs</span>[<span id="ast-141"><span id="ast-142">'tvheadend_user'</span></span>]</span><span id="ast-143" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-144">''</span>)</span>&nbsp;or&nbsp;<span id="ast-145">(<span id="ast-146"><span id="ast-147">Prefs</span>[<span id="ast-148"><span id="ast-149">'tvheadend_pass'</span></span>]</span><span id="ast-150" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-151">''</span>)</span>&nbsp;or&nbsp;<span id="ast-152">(<span id="ast-153"><span id="ast-154" class="other_trans">Prefs</span>[<span id="ast-155"><span id="ast-156">'tvheadend_user'</span></span>]</span><span id="ast-157" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-158" class="other_trans">None</span>)</span>&nbsp;or&nbsp;<span id="ast-159">(<span id="ast-160"><span id="ast-161" class="other_trans">Prefs</span>[<span id="ast-162"><span id="ast-163">'tvheadend_pass'</span></span>]</span><span id="ast-164" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-165">None</span>)</span>)</span>:<span id="ast-166"><span id="ast-167"><span id="ast-168" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-169"><span id="ast-170">'status'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-171">False</span></span><span id="ast-172"><span id="ast-173"><span id="ast-174" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-175"><span id="ast-176">'message'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-177"><span id="ast-178">L</span>(<span id="ast-179">'error_no_anonymous'</span>)</span></span><span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-181" class="other_trans">result</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-182"><span id="ast-183"><span id="ast-184" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-185"><span id="ast-186">'status'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-187">False</span></span><span id="ast-188"><span id="ast-189"><span id="ast-190" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>[<span id="ast-191"><span id="ast-192">'message'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-193"><span id="ast-194">L</span>(<span id="ast-195">'error_connection'</span>)</span></span><span id="ast-196"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-197" class="other_trans">result</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_write(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>._last_mtime</span><span id="ast-10" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14">self</span>._last_mtime</span><span id="ast-15" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">os</span>.path</span>.getmtime</span>(<span id="ast-20"><span id="ast-21">self</span>.path</span>)</span>)</span>)</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">exceptions</span>.PreconditionFailed</span>(<span id="ast-26"><span id="ast-27"><span id="ast-28">'Some&nbsp;other&nbsp;program&nbsp;modified&nbsp;the&nbsp;file&nbsp;{r!}'</span>.format</span>(<span id="ast-29" class="correct_node">path&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>text</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">join_collection</span>(<span id="ast-34">(<span id="ast-35"><span id="ast-36" class="other_trans">item</span>.raw</span><span id="ast-37">&nbsp;for&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">item</span>,&nbsp;<span id="ast-40" class="other_trans">etag</span>)</span>&nbsp;in&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">itervalues</span>(<span id="ast-43"><span id="ast-44">self</span>._items</span>)</span></span>)</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">safe_write</span>(<span id="ast-49"><span id="ast-50">self</span>.path</span>,&nbsp;<span id="ast-51"><span id="ast-52">self</span>._write_mode</span>)</span>&nbsp;as&nbsp;<span id="ast-53" class="other_trans">f</span>:<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">text</span>.encode</span>(<span id="ast-61"><span id="ast-62">self</span>.encoding</span>)</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>finally:<span id="ast-63"><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._items</span>&nbsp;=&nbsp;<span id="ast-66" class="other_trans">None</span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._last_mtime</span>&nbsp;=&nbsp;<span id="ast-70" class="other_trans">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">cfg</span>,&nbsp;<span id="ast-5" class="other_trans">logger</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.name</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">type</span>(<span id="ast-12">self</span>)</span>.__name__</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._cfg</span>&nbsp;=&nbsp;<span id="ast-16" class="other_trans">cfg</span></span><span id="ast-17"><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._log</span>&nbsp;=&nbsp;<span id="ast-20" class="other_trans">logger</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.launch_command</span>&nbsp;=&nbsp;<span id="ast-24" class="other_trans">None</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._configure</span>()</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32">self</span>.launch_command</span><span id="ast-33" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-34" class="other_trans">None</span>)</span>:<span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">RuntimeError</span>(<span id="ast-38">(<span id="ast-39">"Launch&nbsp;command&nbsp;not&nbsp;found&nbsp;for&nbsp;LaunchMethod&nbsp;'%s'"</span>&nbsp;%&nbsp;<span id="ast-41" class="correct_node">name&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;isSecure(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">path</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Ensure&nbsp;that&nbsp;(POSIX)&nbsp;path&nbsp;mode&nbsp;bits&nbsp;are&nbsp;0700.'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-8">(<span id="ast-9">(<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">os</span>.stat</span>(<span id="ast-14" class="other_trans">path</span>)</span>.st_mode</span>&nbsp;&amp;&nbsp;<span id="ast-16">63</span>)</span><span id="ast-17" class="correct_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-18">0</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;masked_terms(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>v</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">np</span>.ma</span>.masked_where</span>(<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">np</span>.logical_not</span>(<span id="ast-15"><span id="ast-16" class="incorrect_node">terms&nbsp;&rarr;&nbsp;self.&nbsp;</span>.mask</span>)</span>,&nbsp;<span id="ast-17"><span id="ast-18" class="ref_node">terms&nbsp;&rarr;&nbsp;self.&nbsp;</span>.data</span>,&nbsp;copy=<span id="ast-20">False</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;gzip_file(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">path</span>,&nbsp;<span id="ast-5" class="other_trans">html</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Zips&nbsp;up&nbsp;the&nbsp;provided&nbsp;HTML&nbsp;as&nbsp;a&nbsp;companion&nbsp;for&nbsp;the&nbsp;provided&nbsp;path.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Intended&nbsp;to&nbsp;take&nbsp;advantage&nbsp;of&nbsp;the&nbsp;peculiarities&nbsp;of\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Amazon&nbsp;S3's&nbsp;GZIP&nbsp;service.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;mtime,&nbsp;an&nbsp;option&nbsp;that&nbsp;writes&nbsp;a&nbsp;timestamp&nbsp;to&nbsp;the&nbsp;output&nbsp;file\\u000a&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;set&nbsp;to&nbsp;0,&nbsp;to&nbsp;avoid&nbsp;having&nbsp;s3cmd&nbsp;do&nbsp;unnecessary&nbsp;uploads&nbsp;because\\u000a&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;differences&nbsp;in&nbsp;the&nbsp;timestamp\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.debug</span>(<span id="ast-12">(<span id="ast-13">'Building&nbsp;gzipped&nbsp;HTML&nbsp;file&nbsp;to&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-15" class="other_trans">path</span>)</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18"><span id="ast-19" class="other_trans">float</span>(<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">sys</span>.version</span>[<span id="ast-23">:<span id="ast-24">3</span></span>]</span>)</span><span id="ast-25" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-26">2.7</span>)</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>outfile</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">gzip</span>.GzipFile</span>(<span id="ast-32" class="other_trans">path</span>,&nbsp;<span id="ast-33">'wb'</span>,&nbsp;mtime=<span id="ast-35">0</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>outfile</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans">gzip</span>.GzipFile</span>(<span id="ast-41" class="other_trans">path</span>,&nbsp;<span id="ast-42">'wb'</span>)</span></span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>outfile</span>.write</span>(<span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">six</span>.binary_type</span>(<span id="ast-50" class="other_trans">html</span>)</span>)</span></span><span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>outfile</span>.close</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;render(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">request</span>,&nbsp;<span id="ast-5" class="other_trans">context</span>,&nbsp;*args,&nbsp;**kwargs</span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>breadcrumb</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">data</span>(<span id="ast-10">self</span>,&nbsp;<span id="ast-11">request</span>,&nbsp;<span id="ast-12" class="other_trans">context</span>,&nbsp;*<span id="ast-13">args</span>,&nbsp;**<span id="ast-14" class="other_trans">kwargs</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">breadcrumb</span>.parent</span>:<span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent_data</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">breadcrumb</span>.parent</span>(<span id="ast-23">self</span>,&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">breadcrumb</span>.application</span>,&nbsp;<span id="ast-26" class="other_trans">request</span>,&nbsp;<span id="ast-27" class="other_trans">context</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent</span>&nbsp;=&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32" class="other_trans">parent_data</span>.title</span>,&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">parent_data</span>.url</span>(<span id="ast-36"><span id="ast-37" class="ref_node">breadcrumb&nbsp;&rarr;&nbsp;parent_data&nbsp;</span>.application</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent</span>&nbsp;=&nbsp;<span id="ast-40">None</span></span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index_view</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">resolve</span>(<span id="ast-46"><span id="ast-47">reverse</span>(<span id="ast-48">(<span id="ast-49">'%s:index'</span>&nbsp;%&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">breadcrumb</span>.application</span>)</span>)</span>)</span>[<span id="ast-53"><span id="ast-54">0</span></span>]</span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60">index_view</span>.breadcrumb</span>.data</span>(<span id="ast-61" class="other_trans">index_view</span>,&nbsp;<span id="ast-62" class="other_trans">request</span>,&nbsp;<span id="ast-63">context</span>)</span></span><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>index</span>&nbsp;=&nbsp;<span id="ast-66">(<span id="ast-67"><span id="ast-68" class="incorrect_node">index&nbsp;&rarr;&nbsp;breadcrumb&nbsp;</span>.title</span>,&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">index</span>.url</span>(<span id="ast-72"><span id="ast-73">breadcrumb</span>.application</span>)</span>)</span></span><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parent_is_index</span>&nbsp;=&nbsp;<span id="ast-76">(<span id="ast-77" class="other_trans">index</span><span id="ast-78" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-79" class="other_trans">parent</span>)</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-81">(<span id="ast-82"><span id="ast-83" class="other_trans">breadcrumb</span>.application</span>,&nbsp;<span id="ast-84" class="other_trans">index</span>,&nbsp;<span id="ast-85" class="other_trans">parent</span>,&nbsp;<span id="ast-86" class="other_trans">parent_is_index</span>,&nbsp;<span id="ast-87"><span id="ast-88" class="other_trans">breadcrumb</span>.title</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_get_value(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">field</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-8">(<span id="ast-9"><span id="ast-10" class="other_trans">field</span>.offset</span><span id="ast-11" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-12" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">hasattr</span>(<span id="ast-15">self</span>,&nbsp;<span id="ast-16">'seek'</span>)</span>)</span>:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.seek</span>(<span id="ast-21"><span id="ast-22" class="other_trans">field</span>.offset</span>)</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._raw_values</span>[<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">field</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">field</span>.read</span>(<span id="ast-33">self</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-35" class="other_trans">other_field</span>&nbsp;in&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38">self</span>.__class__</span>._fields</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41"><span id="ast-42" class="other_trans">other_field</span>.name</span><span id="ast-43">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-44"><span id="ast-45">self</span>._raw_values</span>)</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._raw_values</span>[<span id="ast-50"><span id="ast-51"><span id="ast-52" class="correct_node">field&nbsp;&rarr;&nbsp;other_field&nbsp;</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">other_field</span>.read</span>(<span id="ast-56">self</span>)</span></span></span><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-58">(<span id="ast-59" class="other_trans">other_field</span><span id="ast-60" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-61" class="other_trans">field</span>)</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">field</span>.decode</span>(<span id="ast-67"><span id="ast-68"><span id="ast-69">self</span>._raw_values</span>[<span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">field</span>.name</span></span>]</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;load_collection(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">data</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>foreign_id</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">data</span>.get</span>(<span id="ast-10">'foreign_id'</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">foreign_id</span><span id="ast-14" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-15" class="other_trans">None</span>)</span>:<span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>collection</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">Collection</span>.by_foreign_id</span>(<span id="ast-21" class="other_trans">foreign_id</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">collection</span><span id="ast-25" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-26" class="other_trans">None</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28" class="other_trans">collection</span></span></span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>collection</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">Collection</span>.create</span>(<span id="ast-34" class="other_trans">data</span>)</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>db</span>.session</span>.commit</span>()</span></span><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>update_collection</span>(<span id="ast-43" class="other_trans">collection</span>)</span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-45" class="other_trans">collection</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;listen(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Listen&nbsp;to&nbsp;all&nbsp;the&nbsp;events,&nbsp;and&nbsp;handle&nbsp;them\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-7">True</span>:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-11" class="other_trans">_</span>,&nbsp;<span id="ast-12" class="other_trans">event</span>)</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.session</span>.blpop</span>(<span id="ast-17">'events'</span>)</span></span><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-20" class="other_trans">driver</span>,&nbsp;<span id="ast-21" class="other_trans">fid</span>)</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans">event</span>.split</span>(<span id="ast-25">':'</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">redis</span>.ConnectionError</span>:<span id="ast-29"><span id="ast-30"><span id="ast-31" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>exit&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span></span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.session</span>.lrem</span>(<span id="ast-37">'events'</span>,&nbsp;<span id="ast-38" class="ref_node">fid&nbsp;&rarr;&nbsp;event&nbsp;</span>)</span></span><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._handle_event</span>(<span id="ast-43" class="other_trans">driver</span>,&nbsp;<span id="ast-44" class="other_trans">fid</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_do_request(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">method</span>,&nbsp;<span id="ast-5" class="other_trans">path</span>,&nbsp;<span id="ast-6" class="other_trans">params</span>,&nbsp;<span id="ast-8" class="other_trans">data</span></span>):<span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Query&nbsp;Marathon&nbsp;server.'</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>&nbsp;=&nbsp;<span id="ast-14">{<span id="ast-15">'Content-Type'</span>:&nbsp;<span id="ast-17">'application/json'</span>,&nbsp;<span id="ast-16">'Accept'</span>:&nbsp;<span id="ast-18">'application/json'</span>}</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">''</span>.join</span>(<span id="ast-24">[<span id="ast-25"><span id="ast-26">self</span>.base_url</span>,&nbsp;<span id="ast-27">path</span>]</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32">requests</span>.request</span>(<span id="ast-33">method</span>,&nbsp;<span id="ast-34" class="other_trans">url</span>,&nbsp;params=<span id="ast-36" class="other_trans">params</span>,&nbsp;data=<span id="ast-38" class="other_trans">data</span>,&nbsp;headers=<span id="ast-40" class="other_trans">headers</span>,&nbsp;auth=<span id="ast-42"><span id="ast-43">self</span>.auth</span>,&nbsp;timeout=<span id="ast-45"><span id="ast-46">self</span>.timeout</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48">(<span id="ast-49"><span id="ast-50" class="other_trans">response</span>.status_code</span><span id="ast-51" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-52">500</span>)</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>marathon</span>.log</span>.error</span>(<span id="ast-58"><span id="ast-59"><span id="ast-60">'Got&nbsp;HTTP&nbsp;{code}:&nbsp;{body}'</span>.format</span>(code=<span id="ast-62"><span id="ast-63" class="other_trans">response</span>.status_code</span>,&nbsp;body=<span id="ast-65"><span id="ast-66">response</span>.text</span>)</span>)</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-68"><span id="ast-69">InternalServerError</span>(<span id="ast-70" class="other_trans">response</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-72">(<span id="ast-73"><span id="ast-74" class="other_trans">response</span>.status_code</span><span id="ast-75" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-76">400</span>)</span>:<span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>marathon</span>.log</span>.error</span>(<span id="ast-82"><span id="ast-83"><span id="ast-84">'Got&nbsp;HTTP&nbsp;{code}:&nbsp;{body}'</span>.format</span>(code=<span id="ast-86"><span id="ast-87" class="other_trans">response</span>.status_code</span>,&nbsp;body=<span id="ast-89"><span id="ast-90" class="other_trans">response</span>.text</span>)</span>)</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-92">(<span id="ast-93"><span id="ast-94" class="other_trans">response</span>.status_code</span><span id="ast-95" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-96">404</span>)</span>:<span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-98"><span id="ast-99">NotFoundError</span>(<span id="ast-100" class="other_trans">response</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-102"><span id="ast-103" class="other_trans">MarathonHttpError</span>(<span id="ast-104" class="other_trans">response</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-106">(<span id="ast-107"><span id="ast-108" class="other_trans">response</span>.status_code</span><span id="ast-109" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-110">300</span>)</span>:<span id="ast-111"><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>marathon</span>.log</span>.warn</span>(<span id="ast-116"><span id="ast-117"><span id="ast-118">'Got&nbsp;HTTP&nbsp;{code}:&nbsp;{body}'</span>.format</span>(code=<span id="ast-120"><span id="ast-121" class="other_trans">response</span>.status_code</span>,&nbsp;body=<span id="ast-123"><span id="ast-124" class="other_trans">response</span>.text</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-125"><span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>marathon</span>.log</span>.debug</span>(<span id="ast-130"><span id="ast-131"><span id="ast-132">'Got&nbsp;HTTP&nbsp;{code}:&nbsp;{body}'</span>.format</span>(code=<span id="ast-134"><span id="ast-135">response</span>.status_code</span>,&nbsp;body=<span id="ast-137"><span id="ast-138" class="other_trans">response</span>.text</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;find_profile(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">rorg</span>,&nbsp;<span id="ast-5" class="other_trans">func</span>,&nbsp;<span id="ast-6" class="other_trans">type</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Find&nbsp;profile&nbsp;and&nbsp;data&nbsp;description,&nbsp;matching&nbsp;RORG,&nbsp;FUNC&nbsp;and&nbsp;TYPE&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11">not</span>&nbsp;<span id="ast-12"><span id="ast-13">self</span>.ok</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-15">(<span id="ast-16">None</span>,&nbsp;<span id="ast-17" class="other_trans">None</span>)</span></span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rorg</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.soup</span>.find</span>(<span id="ast-24">'telegram'</span>,&nbsp;<span id="ast-25">{<span id="ast-26">'rorg'</span>:&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>._get_hex</span>(<span id="ast-30" class="other_trans">rorg</span>)</span>}</span>)</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33">not</span>&nbsp;<span id="ast-34" class="incorrect_node">rorg&nbsp;&rarr;&nbsp;func&nbsp;</span>)</span>:<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warn</span>(<span id="ast-39">'Cannot&nbsp;find&nbsp;rorg&nbsp;in&nbsp;EEP!'</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">None</span>,&nbsp;<span id="ast-43" class="other_trans">None</span>)</span></span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>func</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">rorg</span>.find</span>(<span id="ast-49">'profiles'</span>,&nbsp;<span id="ast-50">{<span id="ast-51">'func'</span>:&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54">self</span>._get_hex</span>(<span id="ast-55" class="other_trans">func</span>)</span>}</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57">(<span id="ast-58">not</span>&nbsp;<span id="ast-59" class="other_trans">func</span>)</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warn</span>(<span id="ast-64">'Cannot&nbsp;find&nbsp;func&nbsp;in&nbsp;EEP!'</span>)</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-66">(<span id="ast-67" class="other_trans">None</span>,&nbsp;<span id="ast-68" class="other_trans">None</span>)</span></span></span><span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>profile</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72"><span id="ast-73" class="ref_node">rorg&nbsp;&rarr;&nbsp;func&nbsp;</span>.find</span>(<span id="ast-74">'profile'</span>,&nbsp;<span id="ast-75">{<span id="ast-76">'type'</span>:&nbsp;<span id="ast-77"><span id="ast-78"><span id="ast-79">self</span>._get_hex</span>(<span id="ast-80" class="other_trans">type</span>)</span>}</span>)</span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-82">(<span id="ast-83">not</span>&nbsp;<span id="ast-84" class="other_trans">profile</span>)</span>:<span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warn</span>(<span id="ast-89">'Cannot&nbsp;find&nbsp;type&nbsp;in&nbsp;EEP!'</span>)</span></span><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-91">(<span id="ast-92">None</span>,&nbsp;<span id="ast-93" class="other_trans">None</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_collectClassKerning(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Set&nbsp;up&nbsp;collections&nbsp;of&nbsp;different&nbsp;rule&nbsp;types.'</span></span><span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.leftClassKerning</span>&nbsp;=&nbsp;<span id="ast-9">{}</span></span><span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.rightClassKerning</span>&nbsp;=&nbsp;<span id="ast-13">{}</span></span><span id="ast-14"><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.classPairKerning</span>&nbsp;=&nbsp;<span id="ast-17">{}</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-19">(<span id="ast-20" class="other_trans">leftName</span>,&nbsp;<span id="ast-21" class="other_trans">leftContents</span>)</span>&nbsp;in&nbsp;<span id="ast-22"><span id="ast-23">self</span>.leftClasses</span>:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>leftKey</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">leftContents</span>[<span id="ast-28"><span id="ast-29">0</span></span>]</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">rightName</span>,&nbsp;<span id="ast-33" class="other_trans">rightContents</span>)</span>&nbsp;in&nbsp;<span id="ast-34"><span id="ast-35">self</span>.rightClasses</span>:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rightKey</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">rightContents</span>[<span id="ast-40"><span id="ast-41">0</span></span>]</span></span><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pair</span>&nbsp;=&nbsp;<span id="ast-44">(<span id="ast-45" class="other_trans">leftKey</span>,&nbsp;<span id="ast-46" class="other_trans">rightKey</span>)</span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kerningVal</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>.kerning</span>[<span id="ast-52"><span id="ast-53" class="other_trans">pair</span></span>]</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">kerningVal</span><span id="ast-57" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-58" class="other_trans">None</span>)</span>:<span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>classPairKerning&nbsp;&rarr;&nbsp;self.&nbsp;</span>[<span id="ast-63"><span id="ast-64">(<span id="ast-65" class="other_trans">leftName</span>,&nbsp;<span id="ast-66" class="other_trans">rightName</span>)</span></span>]</span>&nbsp;=&nbsp;<span id="ast-67" class="other_trans">kerningVal</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.kerning</span>.remove</span>(<span id="ast-73" class="other_trans">pair</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;unpack_update(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">buf</span>,&nbsp;<span id="ast-5" class="other_trans">af</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>wd_len</span>,&nbsp;<span id="ast-8"><span id="ast-9">self</span>.wd_len</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.val_num</span>(<span id="ast-13" class="other_trans">buf</span>,&nbsp;<span id="ast-14">2</span>)</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.withdrawn</span>&nbsp;=&nbsp;<span id="ast-18">[]</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">wd_len</span><span id="ast-22" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-23">0</span>)</span>:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>withdrawn</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">Nlri</span>()</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.p</span>&nbsp;+=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">withdrawn</span>.unpack</span>(<span id="ast-35"><span id="ast-36" class="other_trans">buf</span>[<span id="ast-37"><span id="ast-38"><span id="ast-39">self</span>.p</span>:</span>]</span>,&nbsp;<span id="ast-40" class="other_trans">af</span>)</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.withdrawn</span>.append</span>(<span id="ast-46" class="other_trans">withdrawn</span>)</span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>wd_len</span>&nbsp;-=&nbsp;<span id="ast-50"><span id="ast-51" class="other_trans">withdrawn</span>.p</span></span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>attr_len</span>,&nbsp;<span id="ast-54"><span id="ast-55">self</span>.attr_len</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58">self</span>.val_num</span>(<span id="ast-59" class="other_trans">buf</span>,&nbsp;<span id="ast-60">2</span>)</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.attr</span>&nbsp;=&nbsp;<span id="ast-64">[]</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-66">(<span id="ast-67" class="other_trans">attr_len</span><span id="ast-68" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-69">0</span>)</span>:<span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>attr</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73">BgpAttr</span>()</span></span><span id="ast-74"><span id="ast-75"><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.p</span>&nbsp;+=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans">attr</span>.unpack</span>(<span id="ast-81"><span id="ast-82" class="other_trans">buf</span>[<span id="ast-83"><span id="ast-84"><span id="ast-85">self</span>.p</span>:</span>]</span>)</span></span><span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.attr</span>.append</span>(<span id="ast-91" class="other_trans">attr</span>)</span></span><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>attr_len</span>&nbsp;-=&nbsp;<span id="ast-95"><span id="ast-96" class="other_trans">attr</span>.p</span></span></span><span id="ast-97"><span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.nlri</span>&nbsp;=&nbsp;<span id="ast-100">[]</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-102">(<span id="ast-103"><span id="ast-104">self</span>.p</span><span id="ast-105" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-106"><span id="ast-107">self</span>.len</span>)</span>:<span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nlri</span>&nbsp;=&nbsp;<span id="ast-110"><span id="ast-111" class="other_trans">Nlri</span>()</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.p</span>&nbsp;+=&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans">nlri</span>.unpack</span>(<span id="ast-119"><span id="ast-120" class="other_trans">buf</span>[<span id="ast-121"><span id="ast-122"><span id="ast-123">self</span>.p</span>:</span>]</span>,&nbsp;<span id="ast-124" class="other_trans">af</span>)</span></span><span id="ast-125"><span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.nlri</span>.append</span>(<span id="ast-130" class="other_trans">nlri</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_gzipped_tar(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.setup_QUERY</span>()</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>conf</span>&nbsp;=&nbsp;<span id="ast-10">[<span id="ast-11">{<span id="ast-12">'name'</span>:&nbsp;<span id="ast-15">'sort'</span>,&nbsp;<span id="ast-13">'exec'</span>:&nbsp;<span id="ast-16">{<span id="ast-17">'path'</span>:&nbsp;<span id="ast-18">'swift://a/c/exe'</span>}</span>,&nbsp;<span id="ast-14">'file_list'</span>:&nbsp;<span id="ast-19">[<span id="ast-20">{<span id="ast-21">'device'</span>:&nbsp;<span id="ast-23">'stdin'</span>,&nbsp;<span id="ast-22">'path'</span>:&nbsp;<span id="ast-24">'swift://a/c/o'</span>}</span>,&nbsp;<span id="ast-25">{<span id="ast-26">'device'</span>:&nbsp;<span id="ast-28">'stdout'</span>,&nbsp;<span id="ast-27">'path'</span>:&nbsp;<span id="ast-29">'swift://a/c/o2'</span>}</span>]</span>}</span>]</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>conf</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34">json</span>.dumps</span>(<span id="ast-35" class="other_trans">conf</span>)</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>prosrv</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">_test_servers</span>[<span id="ast-40"><span id="ast-41">0</span></span>]</span></span><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>req</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46">self</span>.zerovm_tar_request</span>()</span></span><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>req</span>.headers</span>[<span id="ast-51"><span id="ast-52">'content-type'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-53">'application/x-gzip'</span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sysmap</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57" class="other_trans">StringIO</span>(<span id="ast-58" class="other_trans">conf</span>)</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62">self</span>.create_tar</span>(<span id="ast-63">{<span id="ast-64" class="other_trans">CLUSTER_CONFIG_FILENAME</span>:&nbsp;<span id="ast-65" class="other_trans">sysmap</span>}</span>)</span>&nbsp;as&nbsp;<span id="ast-66" class="other_trans">tar</span>:<span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70">self</span>.create_gzip</span>(<span id="ast-71" class="other_trans">tar</span>)</span>&nbsp;as&nbsp;<span id="ast-72" class="other_trans">gzname</span>:<span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>req</span>.body_file</span>&nbsp;=&nbsp;<span id="ast-76"><span id="ast-77">open</span>(<span id="ast-78" class="other_trans">gzname</span>,&nbsp;<span id="ast-79">'rb'</span>)</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>req</span>.content_length</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans">os</span>.path</span>.getsize</span>(<span id="ast-87" class="correct_node">tar&nbsp;&rarr;&nbsp;gzname&nbsp;</span>)</span></span><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>res</span>&nbsp;=&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92" class="other_trans">req</span>.get_response</span>(<span id="ast-93" class="other_trans">prosrv</span>)</span></span><span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.executed_successfully</span>(<span id="ast-98" class="other_trans">res</span>)</span></span><span id="ast-99"><span id="ast-100"><span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.check_container_integrity</span>(<span id="ast-103" class="other_trans">prosrv</span>,&nbsp;<span id="ast-104">'/v1/a/c'</span>,&nbsp;<span id="ast-105">{<span id="ast-106">'o2'</span>:&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109">self</span>.get_sorted_numbers</span>()</span>}</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3">world_folder</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>world</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">McRegionWorldFolder</span>(<span id="ast-8">world_folder</span>)</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>bb</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">world</span>.get_boundingbox</span>()</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>map</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">Image</span>.new</span>(<span id="ast-19">'RGB'</span>,&nbsp;<span id="ast-20">(<span id="ast-21">(<span id="ast-22">16</span>&nbsp;*&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26">bb</span>.lenx</span>()</span>)</span>,&nbsp;<span id="ast-27">(<span id="ast-28">16</span>&nbsp;*&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">bb</span>.lenz</span>()</span>)</span>)</span>)</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>t</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37">world</span>.chunk_count</span>()</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-41">0.0</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-43" class="other_trans">chunk</span>&nbsp;in&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans">world</span>.iter_chunks</span>()</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48">(<span id="ast-49">(<span id="ast-50" class="other_trans">i</span>&nbsp;%&nbsp;<span id="ast-52">50</span>)</span><span id="ast-53" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-54">0</span>)</span>:<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.write</span>(<span id="ast-60">'Rendering&nbsp;image'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-62">(<span id="ast-63">(<span id="ast-64">i</span>&nbsp;%&nbsp;<span id="ast-66">2</span>)</span><span id="ast-67" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-68">0</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.write</span>(<span id="ast-74">'.'</span>)</span></span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.flush</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-81">(<span id="ast-82">(<span id="ast-83" class="other_trans">i</span>&nbsp;%&nbsp;<span id="ast-85">50</span>)</span><span id="ast-86" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-87">49</span>)</span>:<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.stdout</span>.write</span>(<span id="ast-93">(<span id="ast-94">'%5.1f%%\\u000a'</span>&nbsp;%&nbsp;<span id="ast-96">(<span id="ast-97">(<span id="ast-98">100</span>&nbsp;*&nbsp;<span id="ast-100">i</span>)</span>&nbsp;/&nbsp;<span id="ast-102" class="other_trans">t</span>)</span>)</span>)</span></span></span><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-106">1</span></span><span id="ast-107"><span id="ast-108" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>chunkmap</span>&nbsp;=&nbsp;<span id="ast-109"><span id="ast-110">get_map</span>(<span id="ast-111">chunk</span>)</span></span><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-114" class="other_trans">x</span>,&nbsp;<span id="ast-115">z</span>)</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118">chunk</span>.get_coords</span>()</span></span><span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>map</span>.paste</span>(<span id="ast-123">chunkmap</span>,&nbsp;<span id="ast-124">(<span id="ast-125">(<span id="ast-126">16</span>&nbsp;*&nbsp;<span id="ast-128">(<span id="ast-129" class="other_trans">x</span>&nbsp;-&nbsp;<span id="ast-131"><span id="ast-132">bb</span>.minx</span>)</span>)</span>,&nbsp;<span id="ast-133">(<span id="ast-134">16</span>&nbsp;*&nbsp;<span id="ast-136">(<span id="ast-137" class="other_trans">z</span>&nbsp;-&nbsp;<span id="ast-139"><span id="ast-140">bb</span>.minz</span>)</span>)</span>)</span>)</span></span></span><span id="ast-141"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-142">'&nbsp;done\\u000a'</span></span><span id="ast-143"><span id="ast-144" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-145">(<span id="ast-146"><span id="ast-147"><span id="ast-148"><span id="ast-149" class="other_trans">os</span>.path</span>.basename</span>(<span id="ast-150">world_folder</span>)</span>&nbsp;+&nbsp;<span id="ast-152">'.png'</span>)</span></span><span id="ast-153"><span id="ast-154"><span id="ast-155"><span id="ast-156" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>map</span>.save</span>(<span id="ast-157" class="other_trans">filename</span>,&nbsp;<span id="ast-158">'PNG'</span>)</span></span><span id="ast-159"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-160">(<span id="ast-161">'Saved&nbsp;map&nbsp;as&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-163" class="other_trans">filename</span>)</span></span><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-165" class="other_trans">KeyboardInterrupt</span>:<span id="ast-166"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-167">'&nbsp;aborted\\u000a'</span></span><span id="ast-168"><span id="ast-169" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-170">(<span id="ast-171"><span id="ast-172"><span id="ast-173"><span id="ast-174">os</span>.path</span>.basename</span>(<span id="ast-175">world_folder</span>)</span>&nbsp;+&nbsp;<span id="ast-177">'.partial.png'</span>)</span></span><span id="ast-178"><span id="ast-179"><span id="ast-180"><span id="ast-181" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>map</span>.save</span>(<span id="ast-182" class="other_trans">filename</span>,&nbsp;<span id="ast-183">'PNG'</span>)</span></span><span id="ast-184"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-185">(<span id="ast-186">'Saved&nbsp;map&nbsp;as&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-188">filename</span>)</span></span><span id="ast-189"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-190">75</span></span></span></span><span id="ast-191"><span id="ast-192"><span id="ast-193"><span id="ast-194" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>map</span>.show</span>()</span></span><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-196">0</span></span></span><span id="ast-197"><span class="whitespace"><br />
</span>if&nbsp;<span id="ast-198">(<span id="ast-199">__name__</span><span id="ast-200" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-201">'__main__'</span>)</span>:<span id="ast-202"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-203">(<span id="ast-204"><span id="ast-205" class="other_trans">len</span>(<span id="ast-206"><span id="ast-207" class="other_trans">sys</span>.argv</span>)</span><span id="ast-208" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-209">1</span>)</span>:<span id="ast-210"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-211">'No&nbsp;world&nbsp;folder&nbsp;specified!'</span></span><span id="ast-212"><span id="ast-213"><span id="ast-214"><span id="ast-215"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-216">64</span>)</span></span></span><span id="ast-217"><span id="ast-218" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>world_folder</span>&nbsp;=&nbsp;<span id="ast-219"><span id="ast-220"><span id="ast-221">sys</span>.argv</span>[<span id="ast-222"><span id="ast-223">1</span></span>]</span></span><span id="ast-224"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-225">(<span id="ast-226">not</span>&nbsp;<span id="ast-227"><span id="ast-228"><span id="ast-229"><span id="ast-230">os</span>.path</span>.exists</span>(<span id="ast-231" class="other_trans">world_folder</span>)</span>)</span>:<span id="ast-232"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-233">(<span id="ast-234">'No&nbsp;such&nbsp;folder&nbsp;as&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-236" class="correct_node">filename&nbsp;&rarr;&nbsp;world_folder&nbsp;</span>)</span></span><span id="ast-237"><span id="ast-238"><span id="ast-239"><span id="ast-240"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-241">72</span>)</span></span></span><span id="ast-242"><span id="ast-243"><span id="ast-244"><span id="ast-245"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-246"><span id="ast-247">main</span>(<span id="ast-248" class="other_trans">world_folder</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">header</span>,&nbsp;<span id="ast-6" class="other_trans">lines</span>,&nbsp;<span id="ast-8" class="other_trans">key</span>,&nbsp;<span id="ast-10" class="other_trans">RowClass</span>,&nbsp;<span id="ast-12" class="other_trans">dict</span>,&nbsp;<span id="ast-14" class="other_trans">cfgInstance</span></span>):<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19" class="other_trans">key</span>)</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-21" class="other_trans">ValueError</span>,&nbsp;<span id="ast-22">'Crap&nbsp;key'</span></span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ki</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">header</span>.index</span>(<span id="ast-28" class="other_trans">key</span>)</span></span><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Rowset</span>.__init__</span>(<span id="ast-33">self</span>,&nbsp;<span id="ast-34" class="other_trans">header</span>,&nbsp;<span id="ast-35">lines</span>,&nbsp;<span id="ast-36" class="other_trans">RowClass</span>,&nbsp;cfgInstance=<span id="ast-38" class="other_trans">cfgInstance</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">dict</span><span id="ast-42" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-43" class="other_trans">None</span>)</span>:<span id="ast-44"><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.items</span>&nbsp;=&nbsp;<span id="ast-47">{}</span></span><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.key</span>&nbsp;=&nbsp;<span id="ast-51" class="other_trans">ki</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-53" class="other_trans">line</span>&nbsp;in&nbsp;<span id="ast-54" class="location_node">lines&nbsp;&rarr;&nbsp;self.,&nbsp;pred:&nbsp;dict&nbsp;</span>:<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.items</span>[<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">line</span>[<span id="ast-62"><span id="ast-63" class="other_trans">ki</span></span>]</span></span>]</span>&nbsp;=&nbsp;<span id="ast-64" class="other_trans">line</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.items</span>&nbsp;=&nbsp;<span id="ast-68" class="other_trans">dict</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;solve_factored_clue(<span id="ast-2"><span id="ast-3" class="other_trans">clue</span>,&nbsp;<span id="ast-4">lengths</span>,&nbsp;<span id="ast-5">pattern</span>,&nbsp;<span id="ast-6" class="other_trans">solved_parts</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>length</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12">sum</span>(<span id="ast-13">lengths</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">clue</span><span id="ast-17">&nbsp;in&nbsp;</span><span id="ast-18">solved_parts</span>)</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">solved_parts</span>[<span id="ast-23"><span id="ast-24">clue</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28" class="other_trans">clue</span>[<span id="ast-29"><span id="ast-30">0</span></span>]</span><span id="ast-31">&nbsp;in&nbsp;</span><span id="ast-32">TRANSFORMS</span>)</span>:<span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36">set</span>(<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">TRANSFORMS</span>[<span id="ast-40"><span id="ast-41"><span id="ast-42">clue</span>[<span id="ast-43"><span id="ast-44">0</span></span>]</span></span>]</span>(<span id="ast-45"><span id="ast-46" class="other_trans">clue</span>[<span id="ast-47"><span id="ast-48">1</span></span>]</span>,&nbsp;<span id="ast-49" class="other_trans">length</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-53" class="other_trans">clue</span>[<span id="ast-54"><span id="ast-55">0</span></span>]</span><span id="ast-56">&nbsp;in&nbsp;</span><span id="ast-57">FUNCTIONS</span>)</span>:<span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">set</span>(<span id="ast-62">[]</span>)</span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>arg_sets</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66">tree_search</span>(<span id="ast-67">[<span id="ast-68"><span id="ast-69" class="other_trans">solve_factored_clue</span>(<span id="ast-70" class="other_trans">c</span>,&nbsp;<span id="ast-71" class="other_trans">lengths</span>,&nbsp;<span id="ast-72">pattern</span>,&nbsp;<span id="ast-73" class="other_trans">solved_parts</span>)</span><span id="ast-74">&nbsp;for&nbsp;<span id="ast-75">c</span>&nbsp;in&nbsp;<span id="ast-76"><span id="ast-77">clue</span>[<span id="ast-78"><span id="ast-79">1</span>:</span>]</span>&nbsp;if&nbsp;<span id="ast-80">(<span id="ast-81"><span id="ast-82">c</span>[<span id="ast-83"><span id="ast-84">0</span></span>]</span><span id="ast-85">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-86">HEADS</span>)</span></span>]</span>)</span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-88" class="other_trans">arg_set</span>&nbsp;in&nbsp;<span id="ast-89" class="other_trans">arg_sets</span>:<span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>arg_set</span>&nbsp;+=&nbsp;<span id="ast-93">[<span id="ast-94">length</span>]</span></span><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>.update</span>(<span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans">FUNCTIONS</span>[<span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans">clue</span>[<span id="ast-105"><span id="ast-106">0</span></span>]</span></span>]</span>(*<span id="ast-107">arg_set</span>)</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-109">(<span id="ast-110"><span id="ast-111" class="other_trans">clue</span>[<span id="ast-112"><span id="ast-113">0</span></span>]</span><span id="ast-114" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-115">'d'</span>)</span>:<span id="ast-116"><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-118">[<span id="ast-119">''</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-121">(<span id="ast-122"><span id="ast-123" class="other_trans">clue</span>[<span id="ast-124"><span id="ast-125">0</span></span>]</span><span id="ast-126" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-127">'clue'</span>)</span>:<span id="ast-128">def&nbsp;member_test(<span id="ast-129"><span id="ast-130" class="other_trans">x</span></span>):<span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-132"><span id="ast-133">partial_answer_test</span>(<span id="ast-134">x</span>,&nbsp;<span id="ast-135" class="other_trans">lengths</span>,&nbsp;<span id="ast-136" class="other_trans">pattern</span>,&nbsp;<span id="ast-137">INITIAL_NGRAMS</span>)</span></span></span><span id="ast-138"><span id="ast-139" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-140"><span id="ast-141">tree_search</span>(<span id="ast-142">[<span id="ast-143"><span id="ast-144">solve_factored_clue</span>(<span id="ast-145">c</span>,&nbsp;<span id="ast-146" class="ref_node">length&nbsp;&rarr;&nbsp;lengths&nbsp;</span>,&nbsp;<span id="ast-147">pattern</span>,&nbsp;<span id="ast-148" class="other_trans">solved_parts</span>)</span><span id="ast-149">&nbsp;for&nbsp;<span id="ast-150" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-151"><span id="ast-152" class="other_trans">clue</span>[<span id="ast-153"><span id="ast-154">1</span>:</span>]</span></span>]</span>,&nbsp;start=<span id="ast-156">[<span id="ast-157">''</span>]</span>,&nbsp;member_test=<span id="ast-159">member_test</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-160"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-161"><span id="ast-162">ValueError</span>(<span id="ast-163">(<span id="ast-164">'Unrecognized&nbsp;clue:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-166">clue</span>)</span>)</span></span></span><span id="ast-167"><span id="ast-168"><span id="ast-169" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>solved_parts</span>[<span id="ast-170"><span id="ast-171" class="other_trans">clue</span></span>]</span>&nbsp;=&nbsp;<span id="ast-172">result</span></span><span id="ast-173"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-174">(<span id="ast-175"><span id="ast-176">len</span>(<span id="ast-177">result</span>)</span><span id="ast-178" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-179">0</span>)</span>:<span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-181"><span id="ast-182">ClueUnsolvableError</span>(<span id="ast-183" class="other_trans">clue</span>)</span></span></span><span id="ast-184"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-185" class="other_trans">result</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_start_backoff(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">conn</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.backoff_block</span>&nbsp;=&nbsp;<span id="ast-8">True</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>backoff_interval</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.backoff_timer</span>.get_interval</span>()</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.conns</span>.itervalues</span>()</span>:<span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.info</span>(<span id="ast-25">(<span id="ast-26">'[%s:%s]&nbsp;backing&nbsp;off&nbsp;for&nbsp;%0.2f&nbsp;seconds'</span>&nbsp;%&nbsp;<span id="ast-28">(<span id="ast-29"><span id="ast-30" class="other_trans">c</span>.id</span>,&nbsp;<span id="ast-31"><span id="ast-32">self</span>.name</span>,&nbsp;<span id="ast-33" class="other_trans">backoff_interval</span>)</span>)</span>)</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._send_rdy</span>(<span id="ast-38" class="other_trans">c</span>,&nbsp;<span id="ast-39">0</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">c</span>.rdy_timeout</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ioloop</span>.remove_timeout</span>(<span id="ast-48"><span id="ast-49" class="other_trans">c</span>.rdy_timeout</span>)</span></span><span id="ast-50"><span id="ast-51"><span id="ast-52" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>conn&nbsp;&rarr;&nbsp;c&nbsp;</span>.rdy_timeout</span>&nbsp;=&nbsp;<span id="ast-53" class="other_trans">None</span></span></span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>send_rdy_callback</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">functools</span>.partial</span>(<span id="ast-59"><span id="ast-60">self</span>._send_rdy</span>,&nbsp;<span id="ast-61" class="other_trans">conn</span>,&nbsp;<span id="ast-62">1</span>)</span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>finish_backoff_callback</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans">functools</span>.partial</span>(<span id="ast-68"><span id="ast-69">self</span>._finish_backoff</span>,&nbsp;<span id="ast-70" class="other_trans">send_rdy_callback</span>)</span></span><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>deadline</span>&nbsp;=&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">time</span>.time</span>()</span>&nbsp;+&nbsp;<span id="ast-78" class="other_trans">backoff_interval</span>)</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>conn</span>.rdy_timeout</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85">self</span>.ioloop</span>.add_timeout</span>(<span id="ast-86" class="other_trans">deadline</span>,&nbsp;<span id="ast-87" class="other_trans">finish_backoff_callback</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;migrate_tenant(<span id="ast-2"><span id="ast-3" class="other_trans">context</span>,&nbsp;<span id="ast-4" class="other_trans">tenant_id</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tenant_binding</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">'tenant-{}'</span>.format</span>(<span id="ast-10" class="other_trans">tenant_id</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tenant_retrieve</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">'{}-retrieve'</span>.format</span>(<span id="ast-16" class="other_trans">tenant_binding</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tenant_ensure</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">'{}-ensure'</span>.format</span>(<span id="ast-22" class="other_trans">tenant_binding</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">linear_flow</span>.Flow</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32">'migrate-tenant-{}'</span>.format</span>(<span id="ast-33" class="other_trans">tenant_id</span>)</span>)</span>.add</span>(<span id="ast-34"><span id="ast-35" class="other_trans">RetrieveTenant</span>(<span id="ast-36"><span id="ast-37" class="other_trans">context</span>.src_cloud</span>,&nbsp;name=<span id="ast-39" class="ref_node">tenant_retrieve&nbsp;&rarr;&nbsp;tenant_binding&nbsp;</span>,&nbsp;provides=<span id="ast-41" class="other_trans">tenant_binding</span>,&nbsp;rebind=<span id="ast-43">[<span id="ast-44" class="other_trans">tenant_retrieve</span>]</span>)</span>,&nbsp;<span id="ast-45"><span id="ast-46">EnsureTenant</span>(<span id="ast-47"><span id="ast-48" class="other_trans">context</span>.dst_cloud</span>,&nbsp;name=<span id="ast-50" class="incorrect_node">tenant_ensure&nbsp;&rarr;&nbsp;tenant_id&nbsp;</span>,&nbsp;provides=<span id="ast-52" class="other_trans">tenant_ensure</span>,&nbsp;rebind=<span id="ast-54">[<span id="ast-55" class="other_trans">tenant_binding</span>]</span>)</span>)</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>.store</span>[<span id="ast-60"><span id="ast-61" class="other_trans">tenant_retrieve</span></span>]</span>&nbsp;=&nbsp;<span id="ast-62" class="other_trans">tenant_id</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-64" class="other_trans">flow</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_next_creature(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">rules_engine</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Get&nbsp;the&nbsp;character&nbsp;who&nbsp;is&nbsp;next&nbsp;to&nbsp;take&nbsp;action\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;rules_engine:&nbsp;engine&nbsp;containing&nbsp;rules\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;rules_engine:&nbsp;RulesEngine\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:returns:&nbsp;Character&nbsp;to&nbsp;act&nbsp;next\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:rtype:&nbsp;Character\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>level</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.player</span>.level</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">level</span><span id="ast-15" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-16" class="other_trans">None</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-18" class="other_trans">None</span></span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>creatures</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">level</span>.creatures</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">len</span>(<span id="ast-27" class="other_trans">creatures</span>)</span><span id="ast-28" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-29">0</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-31">(<span id="ast-32"><span id="ast-33">self</span>.player</span><span id="ast-34">&nbsp;in&nbsp;</span><span id="ast-35"><span id="ast-36" class="other_trans">level</span>.creatures</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-38">1</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-40" class="other_trans">creature</span>&nbsp;in&nbsp;<span id="ast-41" class="other_trans">creatures</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-44"><span id="ast-45" class="other_trans">creature</span>.tick</span><span id="ast-46" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-47">0</span>)</span>:<span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-49" class="other_trans">creature</span></span></span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-51" class="other_trans">creature</span>&nbsp;in&nbsp;<span id="ast-52" class="other_trans">creatures</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>creature</span>.tick</span>&nbsp;=&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58" class="other_trans">creature</span>.tick</span>&nbsp;-&nbsp;<span id="ast-60">1</span>)</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-62" class="other_trans">effect</span>&nbsp;in&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">creature</span>.get_effects</span>()</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-67">(<span id="ast-68"><span id="ast-69" class="other_trans">effect</span>.tick</span><span id="ast-70" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-71">None</span>)</span>:<span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>effect</span>.tick</span>&nbsp;=&nbsp;<span id="ast-75">(<span id="ast-76"><span id="ast-77" class="other_trans">effect</span>.tick</span>&nbsp;-&nbsp;<span id="ast-79">1</span>)</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-81">(<span id="ast-82"><span id="ast-83" class="other_trans">effect</span>.tick</span><span id="ast-84" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-85">0</span>)</span>:<span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>effect</span>.trigger</span>(<span id="ast-90"><span id="ast-91">rules_engine</span>.dying_rules</span>)</span></span></span></span></span><span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>creature</span>.remove_expired_effects</span>()</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_execute(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">options</span>,&nbsp;<span id="ast-5" class="other_trans">args</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Apply&nbsp;mincss&nbsp;the&nbsp;generated&nbsp;site.'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_folder</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.site</span>.config</span>[<span id="ast-14"><span id="ast-15">'OUTPUT_FOLDER'</span></span>]</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">Processor</span><span id="ast-19" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-20">None</span>)</span>:<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>req_missing</span>(<span id="ast-24">[<span id="ast-25">'mincss'</span>]</span>,&nbsp;<span id="ast-26">'use&nbsp;the&nbsp;"mincss"&nbsp;command'</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>p</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">Processor</span>(preserve_remote_urls=<span id="ast-33">False</span>)</span></span><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>urls</span>&nbsp;=&nbsp;<span id="ast-36">[]</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>css_files</span>&nbsp;=&nbsp;<span id="ast-39">{}</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-41">(<span id="ast-42">root</span>,&nbsp;<span id="ast-43">dirs</span>,&nbsp;<span id="ast-44" class="other_trans">files</span>)</span>&nbsp;in&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">os</span>.walk</span>(<span id="ast-48">output_folder</span>)</span>:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-50" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-51" class="other_trans">files</span>:<span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-58" class="other_trans">root</span>,&nbsp;<span id="ast-59" class="other_trans">f</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63">url</span>.endswith</span>(<span id="ast-64">'.css'</span>)</span>:<span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fname</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70">os</span>.path</span>.basename</span>(<span id="ast-71" class="other_trans">url</span>)</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-73">(<span id="ast-74" class="other_trans">fname</span><span id="ast-75">&nbsp;in&nbsp;</span><span id="ast-76" class="other_trans">css_files</span>)</span>:<span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger&nbsp;&rarr;&nbsp;self.&nbsp;</span>.error</span>(<span id="ast-81">'You&nbsp;have&nbsp;two&nbsp;CSS&nbsp;files&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;and&nbsp;that&nbsp;confuses&nbsp;me.'</span>)</span></span><span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-86">1</span>)</span></span></span><span id="ast-87"><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>css_files</span>[<span id="ast-90"><span id="ast-91" class="other_trans">fname</span></span>]</span>&nbsp;=&nbsp;<span id="ast-92" class="other_trans">url</span></span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-94">(<span id="ast-95">not</span>&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98" class="incorrect_node">f&nbsp;&rarr;&nbsp;url&nbsp;</span>.endswith</span>(<span id="ast-99">'.html'</span>)</span>)</span>:<span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>urls</span>.append</span>(<span id="ast-105" class="other_trans">url</span>)</span></span></span></span><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>p</span>.process</span>(*<span id="ast-110">urls</span>)</span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-112" class="other_trans">inline</span>&nbsp;in&nbsp;<span id="ast-113"><span id="ast-114" class="other_trans">p</span>.links</span>:<span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fname</span>&nbsp;=&nbsp;<span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120">os</span>.path</span>.basename</span>(<span id="ast-121"><span id="ast-122">inline</span>.href</span>)</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-124"><span id="ast-125">open</span>(<span id="ast-126"><span id="ast-127" class="other_trans">css_files</span>[<span id="ast-128"><span id="ast-129" class="other_trans">fname</span></span>]</span>,&nbsp;<span id="ast-130">'wb+'</span>)</span>&nbsp;as&nbsp;<span id="ast-131" class="other_trans">outf</span>:<span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>outf</span>.write</span>(<span id="ast-136"><span id="ast-137">inline</span>.after</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;format_messages(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">red</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>&nbsp;=&nbsp;<span id="ast-7">[]</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-9" class="other_trans">m</span>&nbsp;in&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">red</span>.messages</span>:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-14">{<span id="ast-15">'subject'</span>:&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">m</span>.subject</span>,&nbsp;<span id="ast-16">'category'</span>:&nbsp;<span id="ast-21"><span id="ast-22" class="correct_node">sm&nbsp;&rarr;&nbsp;m&nbsp;</span>.category</span>,&nbsp;<span id="ast-17">'level'</span>:&nbsp;<span id="ast-23"><span id="ast-24">m</span>.level</span>,&nbsp;<span id="ast-18">'summary'</span>:&nbsp;<span id="ast-25">(<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">m</span>.summary</span>[<span id="ast-29"><span id="ast-30"><span id="ast-31">self</span>.lang</span></span>]</span>&nbsp;%&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">m</span>.vars</span>)</span>}</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>smsgs</span>&nbsp;=&nbsp;<span id="ast-37">[<span id="ast-38" class="other_trans">i</span><span id="ast-39">&nbsp;for&nbsp;<span id="ast-40" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">getattr</span>(<span id="ast-43"><span id="ast-44" class="other_trans">m</span>.subrequest</span>,&nbsp;<span id="ast-45">'messages'</span>,&nbsp;<span id="ast-46">[]</span>)</span>&nbsp;if&nbsp;<span id="ast-47">(<span id="ast-48"><span id="ast-49" class="other_trans">i</span>.level</span><span id="ast-50">&nbsp;in&nbsp;</span><span id="ast-51">[<span id="ast-52"><span id="ast-53"><span id="ast-54">rs</span>.l</span>.BAD</span>]</span>)</span></span>]</span></span><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>[<span id="ast-58"><span id="ast-59">'subrequests'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-60">[<span id="ast-61">{<span id="ast-62">'subject'</span>:&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">sm</span>.subject</span>,&nbsp;<span id="ast-63">'category'</span>:&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">sm</span>.category</span>,&nbsp;<span id="ast-64">'level'</span>:&nbsp;<span id="ast-70"><span id="ast-71" class="other_trans">sm</span>.level</span>,&nbsp;<span id="ast-65">'summary'</span>:&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans">sm</span>.summary</span>[<span id="ast-75"><span id="ast-76"><span id="ast-77">self</span>.lang</span></span>]</span>}</span><span id="ast-78">&nbsp;for&nbsp;<span id="ast-79" class="other_trans">sm</span>&nbsp;in&nbsp;<span id="ast-80" class="other_trans">smsgs</span></span>]</span></span><span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-85" class="other_trans">msg</span>)</span></span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-87" class="other_trans">out</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;inject_parameter_values(<span id="ast-2"><span id="ast-3" class="other_trans">bricks</span>,&nbsp;<span id="ast-4" class="other_trans">param_values</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Inject&nbsp;parameter&nbsp;values&nbsp;into&nbsp;a&nbsp;bricks&nbsp;hierarchy.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;bricks&nbsp;:&nbsp;Brick&nbsp;or&nbsp;Selector\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;top&nbsp;bricks.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;param_values&nbsp;:&nbsp;dict&nbsp;of&nbsp;(parameter&nbsp;name,&nbsp;numpy&nbsp;array)&nbsp;pairs\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;parameter&nbsp;values.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">isinstance</span>(<span id="ast-10" class="other_trans">bricks</span>,&nbsp;<span id="ast-11" class="other_trans">Brick</span>)</span>:<span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bricks</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">Selector</span>(<span id="ast-16">[<span id="ast-17" class="other_trans">bricks</span>]</span>)</span></span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20">not</span>&nbsp;<span id="ast-21"><span id="ast-22">isinstance</span>(<span id="ast-23" class="other_trans">bricks</span>,&nbsp;<span id="ast-24" class="other_trans">Selector</span>)</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-26" class="other_trans">ValueError</span></span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">name</span>,&nbsp;<span id="ast-30">value</span>)</span>&nbsp;in&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">param_values</span>.items</span>()</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selected</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">bricks</span>.select</span>(<span id="ast-39" class="other_trans">name</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43" class="other_trans">len</span>(<span id="ast-44" class="other_trans">selected</span>)</span><span id="ast-45" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-46">0</span>)</span>:<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-51"><span id="ast-52"><span id="ast-53">'Unknown&nbsp;parameter&nbsp;{}'</span>.format</span>(<span id="ast-54" class="other_trans">name</span>)</span>)</span></span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">(<span id="ast-57">not</span>&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60">len</span>(<span id="ast-61" class="other_trans">selected</span>)</span><span id="ast-62" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-63">1</span>)</span>)</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-65">ValueError</span></span></span><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selected</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">selected</span>[<span id="ast-70"><span id="ast-71">0</span></span>]</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">selected</span>.get_value</span>(borrow=<span id="ast-79">True</span>,&nbsp;return_internal_type=<span id="ast-81">True</span>)</span>.shape</span><span id="ast-82" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-83"><span id="ast-84" class="other_trans">value</span>.shape</span>)</span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selected</span>.set_value</span>(<span id="ast-89" class="other_trans">value</span>)</span></span></span><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>params</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans">bricks</span>.get_params</span>()</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-96" class="other_trans">name</span>&nbsp;in&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans">params</span>.keys</span>()</span>:<span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-101">(<span id="ast-102" class="other_trans">name</span><span id="ast-103">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-104" class="ref_node">params&nbsp;&rarr;&nbsp;param_values&nbsp;</span>)</span>:<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-109"><span id="ast-110"><span id="ast-111">'No&nbsp;value&nbsp;is&nbsp;provided&nbsp;for&nbsp;the&nbsp;parameter&nbsp;{}'</span>.format</span>(<span id="ast-112" class="other_trans">name</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;do_c(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">request</span>,&nbsp;<span id="ast-5" class="other_trans">token</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9">not</span>&nbsp;<span id="ast-10" class="other_trans">token</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-12" class="other_trans">Http404</span></span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>token</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">token</span>.rstrip</span>(<span id="ast-20">'/'</span>)</span>.encode</span>(<span id="ast-21">'utf8'</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">signed</span>.unsign</span>(<span id="ast-28" class="other_trans">token</span>,&nbsp;key=<span id="ast-30">(<span id="ast-31">(<span id="ast-33"><span id="ast-34">self</span>.confirm_link_secret</span>&nbsp;or&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">settings</span>.SECRET_KEY</span>)</span>&nbsp;+&nbsp;<span id="ast-38"><span id="ast-39">self</span>.confirm_link_salt</span>)</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-41"><span id="ast-42" class="other_trans">signed</span>.BadSignature</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46">self</span>.show_message</span>(<span id="ast-47" class="other_trans">request</span>,&nbsp;<span id="ast-48"><span id="ast-49">self</span>.invalid_token_message</span>,&nbsp;<span id="ast-50">(<span id="ast-51">(<span id="ast-52"><span id="ast-53">self</span>.invalid_token_message</span>&nbsp;+&nbsp;<span id="ast-55">':&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-57" class="other_trans">token</span>)</span>)</span></span></span></span><span id="ast-58"><span id="ast-59" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user_id&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-60" class="other_trans">value</span></span><span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65">self</span>.lookup_user_by_id</span>(<span id="ast-66" class="other_trans">user_id</span>)</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-68">(<span id="ast-69">not</span>&nbsp;<span id="ast-70" class="other_trans">user</span>)</span>:<span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74">self</span>.show_error</span>(<span id="ast-75" class="other_trans">request</span>,&nbsp;<span id="ast-76" class="ref_node">r_user_not_found_message&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_get_context_from_gdoc(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">key</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Create&nbsp;a&nbsp;Jinja2&nbsp;context&nbsp;from&nbsp;a&nbsp;Google&nbsp;spreadsheet.'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.export_xlsx</span>(<span id="ast-13" class="other_trans">key</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">process_xlsx</span>(<span id="ast-18" class="other_trans">content</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21">'values'</span><span id="ast-22">&nbsp;in&nbsp;</span><span id="ast-23" class="other_trans">data</span>)</span>:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">copy_global_values</span>(<span id="ast-28" class="other_trans">data</span>)</span></span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-30" class="other_trans">data</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-32" class="other_trans">BadStatusLine</span>:<span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-35"><span id="ast-36">self</span>.project</span>,&nbsp;<span id="ast-37"><span id="ast-38">self</span>.base</span>)</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41">self</span>.load_project</span>(<span id="ast-42" class="correct_node">path&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.data</span>&nbsp;=&nbsp;<span id="ast-46">{}</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>._get_context_from_gdoc</span>(<span id="ast-51" class="other_trans">key</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Main&nbsp;run&nbsp;loop&nbsp;for&nbsp;all&nbsp;spouts.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Performs&nbsp;initial&nbsp;handshake&nbsp;with&nbsp;Storm&nbsp;and&nbsp;reads&nbsp;tuples&nbsp;handing&nbsp;them&nbsp;off\\u000a&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;subclasses.&nbsp;&nbsp;Any&nbsp;exceptions&nbsp;are&nbsp;caught&nbsp;and&nbsp;logged&nbsp;back&nbsp;to&nbsp;Storm\\u000a&nbsp;&nbsp;&nbsp;&nbsp;prior&nbsp;to&nbsp;the&nbsp;Python&nbsp;process&nbsp;exiting.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Subclasses&nbsp;should&nbsp;**not**&nbsp;override&nbsp;this&nbsp;method.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-8" class="other_trans">storm_conf</span>,&nbsp;<span id="ast-9" class="other_trans">context</span>)</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11" class="correct_node">read_handshake&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._setup_component</span>(<span id="ast-16" class="other_trans">storm_conf</span>,&nbsp;<span id="ast-17" class="other_trans">context</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_cursor(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6"><span id="ast-7">self</span>.connection</span><span id="ast-8" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-9" class="other_trans">None</span>)</span>:<span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.connection</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.pool</span>.get</span>()</span></span><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.connection</span>.set_client_encoding</span>(<span id="ast-22">'UTF8'</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tz</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-28">'UTC'</span>&nbsp;if&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">settings</span>.USE_TZ</span>&nbsp;else&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31" class="correct_node">settings_dict&nbsp;&rarr;&nbsp;self.&nbsp;</span>.get</span>(<span id="ast-32">'TIME_ZONE'</span>)</span></span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34" class="other_trans">tz</span>:<span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>get_parameter_status</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">self</span>.connection</span>.get_parameter_status</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-42" class="other_trans">AttributeError</span>:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>conn_tz</span>&nbsp;=&nbsp;<span id="ast-45" class="other_trans">None</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;prompt_ignore(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">ig</span>,&nbsp;<span id="ast-5">path</span>,&nbsp;<span id="ast-6">cb</span></span>):<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ignore</span>.create_flooignore</span>(<span id="ast-11"><span id="ast-12" class="other_trans">ig</span>.path</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirs</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">ig</span>.get_children</span>()</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirs</span>.append</span>(<span id="ast-22" class="other_trans">ig</span>)</span></span><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirs</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26">sorted</span>(<span id="ast-27" class="other_trans">dirs</span>,&nbsp;key=<span id="ast-29"><span id="ast-30">attrgetter</span>(<span id="ast-31">'size'</span>)</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>,&nbsp;<span id="ast-34">starting_size</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36">reduce</span>(<span id="ast-37">lambda&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">x</span>,&nbsp;<span id="ast-40" class="other_trans">c</span></span>:&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">x</span>&nbsp;+&nbsp;<span id="ast-44"><span id="ast-45">c</span>.size</span>)</span></span>,&nbsp;<span id="ast-46">dirs</span>,&nbsp;<span id="ast-47">0</span>)</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>too_big</span>&nbsp;=&nbsp;<span id="ast-50">[]</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-52">(<span id="ast-54">(<span id="ast-55">size</span><span id="ast-56" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-57">MAX_WORKSPACE_SIZE</span>)</span>&nbsp;and&nbsp;<span id="ast-58">dirs</span>)</span>:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cd</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63" class="ref_node">too_big&nbsp;&rarr;&nbsp;dirs&nbsp;</span>.pop</span>()</span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;-=&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">cd</span>.size</span></span><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>too_big</span>.append</span>(<span id="ast-73" class="other_trans">cd</span>)</span></span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-75">(<span id="ast-76">size</span><span id="ast-77" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-78">MAX_WORKSPACE_SIZE</span>)</span>:<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>editor</span>.error_message</span>(<span id="ast-83">(<span id="ast-84">'Maximum&nbsp;workspace&nbsp;size&nbsp;is&nbsp;%.2fMB.\\u000a\\u000a%s&nbsp;is&nbsp;too&nbsp;big&nbsp;(%.2fMB)&nbsp;to&nbsp;upload.&nbsp;Consider&nbsp;adding&nbsp;stuff&nbsp;to&nbsp;the&nbsp;.flooignore&nbsp;file.'</span>&nbsp;%&nbsp;<span id="ast-86">(<span id="ast-87">(<span id="ast-88" class="other_trans">MAX_WORKSPACE_SIZE</span>&nbsp;/&nbsp;<span id="ast-90">1000000.0</span>)</span>,&nbsp;<span id="ast-91">path</span>,&nbsp;<span id="ast-92">(<span id="ast-93"><span id="ast-94" class="other_trans">ig</span>.size</span>&nbsp;/&nbsp;<span id="ast-96">1000000.0</span>)</span>)</span>)</span>)</span></span><span id="ast-97"><span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cb</span>(<span id="ast-100">[<span id="ast-101"><span id="ast-102">set</span>()</span>,&nbsp;<span id="ast-103">0</span>]</span>)</span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-106" class="other_trans">too_big</span>:<span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>txt</span>&nbsp;=&nbsp;<span id="ast-109">(<span id="ast-110" class="other_trans">TOO_BIG_TEXT</span>&nbsp;%&nbsp;<span id="ast-112">(<span id="ast-113">(<span id="ast-114" class="other_trans">MAX_WORKSPACE_SIZE</span>&nbsp;/&nbsp;<span id="ast-116">1000000.0</span>)</span>,&nbsp;<span id="ast-117" class="other_trans">path</span>,&nbsp;<span id="ast-118">(<span id="ast-119">starting_size</span>&nbsp;/&nbsp;<span id="ast-121">1000000.0</span>)</span>,&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124">'\\u000a'</span>.join</span>(<span id="ast-125">[<span id="ast-126"><span id="ast-127" class="other_trans">x</span>.path</span><span id="ast-128">&nbsp;for&nbsp;<span id="ast-129" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-130" class="incorrect_node">too_big&nbsp;&rarr;&nbsp;dirs&nbsp;</span></span>]</span>)</span>)</span>)</span></span><span id="ast-131"><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>upload</span>&nbsp;=&nbsp;<span id="ast-133">yield&nbsp;<span id="ast-134">(<span id="ast-135"><span id="ast-136">self</span>.ok_cancel_dialog</span>,&nbsp;<span id="ast-137" class="other_trans">txt</span>)</span></span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-139">(<span id="ast-140">not</span>&nbsp;<span id="ast-141" class="other_trans">upload</span>)</span>:<span id="ast-142"><span id="ast-143"><span id="ast-144" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cb</span>(<span id="ast-145">[<span id="ast-146"><span id="ast-147">set</span>()</span>,&nbsp;<span id="ast-148">0</span>]</span>)</span></span><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span></span><span id="ast-150"><span id="ast-151" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>files</span>&nbsp;=&nbsp;<span id="ast-152"><span id="ast-153" class="other_trans">set</span>()</span></span><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-155">ig</span>&nbsp;in&nbsp;<span id="ast-156">dirs</span>:<span id="ast-157"><span id="ast-158" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>files</span>&nbsp;=&nbsp;<span id="ast-159"><span id="ast-160"><span id="ast-161" class="other_trans">files</span>.union</span>(<span id="ast-162"><span id="ast-163">set</span>(<span id="ast-164">[<span id="ast-165"><span id="ast-166"><span id="ast-167">utils</span>.to_rel_path</span>(<span id="ast-168" class="other_trans">x</span>)</span><span id="ast-169">&nbsp;for&nbsp;<span id="ast-170">x</span>&nbsp;in&nbsp;<span id="ast-171"><span id="ast-172" class="other_trans">ig</span>.files</span></span>]</span>)</span>)</span></span></span><span id="ast-173"><span id="ast-174"><span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cb</span>(<span id="ast-176">[<span id="ast-177" class="other_trans">files</span>,&nbsp;<span id="ast-178" class="other_trans">size</span>]</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;show_user(<span id="ast-2"><span id="ast-3" class="other_trans">store</span>,&nbsp;<span id="ast-4" class="other_trans">name</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>c</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">store</span>.get_cursor</span>()</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">store</span>.get_user</span>(<span id="ast-15" class="other_trans">name</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19" class="other_trans">user</span>)</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-24">(<span id="ast-25">'user&nbsp;%r&nbsp;does&nbsp;not&nbsp;exist'</span>&nbsp;%&nbsp;<span id="ast-27" class="other_trans">name</span>)</span>)</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29" class="other_trans">key</span>&nbsp;in&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">user</span>.keys</span>()</span>:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-34">(<span id="ast-35">'%s:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-37">(<span id="ast-38" class="other_trans">key</span>,&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">user</span>[<span id="ast-41"><span id="ast-42" class="other_trans">key</span></span>]</span>)</span>)</span></span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-44" class="other_trans">p</span>&nbsp;in&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">store</span>.get_user_packages</span>(<span id="ast-48" class="correct_node">user&nbsp;&rarr;&nbsp;name&nbsp;</span>)</span>:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-50">(<span id="ast-51">'%s:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-53">(<span id="ast-54"><span id="ast-55" class="other_trans">p</span>[<span id="ast-56"><span id="ast-57">'package_name'</span></span>]</span>,&nbsp;<span id="ast-58"><span id="ast-59" class="other_trans">p</span>[<span id="ast-60"><span id="ast-61">'role_name'</span></span>]</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;update_courses(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Updates&nbsp;courses&nbsp;state,&nbsp;when&nbsp;evaluation&nbsp;time&nbsp;begins/ends.'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>today</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">datetime</span>.date</span>.today</span>()</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-13" class="other_trans">course</span>&nbsp;in&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">Course</span>.objects</span>.all</span>()</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-22">(<span id="ast-23"><span id="ast-24" class="other_trans">course</span>.state</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26">'approved'</span>)</span>&nbsp;and&nbsp;<span id="ast-27">(<span id="ast-28"><span id="ast-29" class="other_trans">course</span>.vote_start_date</span><span id="ast-30" class="incorrect_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-31" class="other_trans">today</span>)</span>)</span>:<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>course</span>.evaluation_begin</span>()</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>course</span>.save</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-41">(<span id="ast-43">(<span id="ast-44"><span id="ast-45" class="other_trans">course</span>.state</span><span id="ast-46" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-47">'inEvaluation'</span>)</span>&nbsp;and&nbsp;<span id="ast-48">(<span id="ast-49"><span id="ast-50" class="other_trans">course</span>.vote_end_date</span><span id="ast-51" class="ref_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-52" class="other_trans">today</span>)</span>)</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>course</span>.evaluation_end</span>()</span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>course</span>.save</span>()</span></span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">arguments</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path_to_app</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">arguments</span>.get</span>(<span id="ast-9">'&lt;path_to_app&gt;'</span>)</span></span><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>source_app</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">arguments</span>.get</span>(<span id="ast-15">'--source-app'</span>)</span></span><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>confirm</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">arguments</span>.get</span>(<span id="ast-21">'-y'</span>)</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>appname</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">arguments</span>.get</span>(<span id="ast-27">'--appname'</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30">not</span>&nbsp;<span id="ast-31" class="other_trans">appname</span>)</span>:<span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>appname</span>&nbsp;=&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38">path_to_app</span>.split</span>(<span id="ast-39">'/'</span>)</span>[<span id="ast-40"><span id="ast-41">-1</span></span>]</span>&nbsp;+&nbsp;<span id="ast-43">'.app'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>appname</span>&nbsp;=&nbsp;<span id="ast-46">(<span id="ast-47">appname</span>&nbsp;+&nbsp;<span id="ast-49">'.app'</span>)</span></span></span><span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>icon</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54">arguments</span>.get</span>(<span id="ast-55">'--icon'</span>)</span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>strip</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">arguments</span>.get</span>(<span id="ast-61">'--strip'</span>,&nbsp;<span id="ast-62">True</span>)</span></span><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>deps</span>&nbsp;=&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans">arguments</span>.get</span>(<span id="ast-68">'--deps'</span>,&nbsp;<span id="ast-69">[]</span>)</span></span><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>gardendeps</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans">arguments</span>.get</span>(<span id="ast-75">'--gardendeps'</span>,&nbsp;<span id="ast-76">[]</span>)</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>bootstrap</span>(<span id="ast-80" class="other_trans">source_app</span>,&nbsp;<span id="ast-81">appname</span>,&nbsp;<span id="ast-82" class="other_trans">confirm</span>)</span></span><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>insert_app</span>(<span id="ast-86" class="incorrect_node">path_to_app&nbsp;&rarr;&nbsp;source_app&nbsp;</span>,&nbsp;<span id="ast-87" class="other_trans">appname</span>)</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-89">deps</span>:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>install_deps</span>(<span id="ast-93" class="other_trans">appname</span>,&nbsp;<span id="ast-94" class="other_trans">deps</span>)</span></span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96" class="other_trans">gardendeps</span>:<span id="ast-97"><span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>install_garden_deps</span>(<span id="ast-100" class="other_trans">appname</span>,&nbsp;<span id="ast-101" class="ref_node">deps&nbsp;&rarr;&nbsp;gardendeps&nbsp;</span>)</span></span></span><span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>compile_app</span>(<span id="ast-105" class="other_trans">appname</span>)</span></span><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-107" class="other_trans">icon</span>:<span id="ast-108"><span id="ast-109"><span id="ast-110" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setup_icon</span>(<span id="ast-111" class="other_trans">appname</span>,&nbsp;<span id="ast-112" class="other_trans">icon</span>)</span></span></span><span id="ast-113"><span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fill_meta</span>(<span id="ast-116">appname</span>,&nbsp;<span id="ast-117" class="other_trans">arguments</span>)</span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cleanup</span>(<span id="ast-121" class="other_trans">appname</span>,&nbsp;<span id="ast-122">strip</span>)</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-124">'All&nbsp;done!'</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;create(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">file_string</span>,&nbsp;<span id="ast-5" class="other_trans">blend</span>,&nbsp;<span id="ast-7" class="other_trans">flip</span>,&nbsp;<span id="ast-9" class="other_trans">size</span></span>):<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>texture</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.cache</span>.get</span>(<span id="ast-17">(<span id="ast-18" class="other_trans">file_string</span>,&nbsp;<span id="ast-19" class="other_trans">blend</span>,&nbsp;<span id="ast-20" class="other_trans">flip</span>,&nbsp;<span id="ast-21" class="other_trans">size</span>)</span>,&nbsp;<span id="ast-22" class="other_trans">None</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25">not</span>&nbsp;<span id="ast-26" class="other_trans">texture</span>)</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>texture</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">Texture</span>(<span id="ast-31" class="other_trans">file_string</span>,&nbsp;blend=<span id="ast-33" class="other_trans">blend</span>,&nbsp;flip=<span id="ast-35" class="correct_node">blend&nbsp;&rarr;&nbsp;flip&nbsp;</span>,&nbsp;size=<span id="ast-37" class="other_trans">size</span>)</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cache</span>[<span id="ast-42"><span id="ast-43" class="other_trans">file_string</span></span>]</span>&nbsp;=&nbsp;<span id="ast-44" class="other_trans">texture</span></span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46" class="other_trans">texture</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;configure(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-9" class="other_trans">Intelligence</span>,&nbsp;<span id="ast-10">self</span>)</span>.configure</span>()</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.url</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.config</span>.get</span>(<span id="ast-18">'url'</span>,&nbsp;<span id="ast-19" class="other_trans">None</span>)</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.polling_timeout</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>.config</span>.get</span>(<span id="ast-27">'polling_timeout'</span>,&nbsp;<span id="ast-28">20</span>)</span></span><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.verify_cert</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>.config</span>.get</span>(<span id="ast-36">'verify_cert'</span>,&nbsp;<span id="ast-37">True</span>)</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.prefix</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44">self</span>.config</span>.get</span>(<span id="ast-45">'prefix'</span>,&nbsp;<span id="ast-46">'anomali'</span>)</span></span><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fields</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53">self</span>.config</span>.get</span>(<span id="ast-54">'fields'</span>,&nbsp;<span id="ast-55" class="other_trans">None</span>)</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.query</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62">self</span>.config</span>.get</span>(<span id="ast-63">'query'</span>,&nbsp;<span id="ast-64" class="other_trans">None</span>)</span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>initial_interval</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70">self</span>.config</span>.get</span>(<span id="ast-71">'initial_interval'</span>,&nbsp;<span id="ast-72">'3600'</span>)</span></span><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.initial_interval</span>&nbsp;=&nbsp;<span id="ast-76"><span id="ast-77" class="other_trans">interval_in_sec</span>(<span id="ast-78" class="other_trans">initial_interval</span>)</span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-80">(<span id="ast-81" class="ref_node">initial_interval&nbsp;&rarr;&nbsp;self.&nbsp;</span><span id="ast-82" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-83" class="other_trans">None</span>)</span>:<span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.error</span>(<span id="ast-88">'%s&nbsp;-&nbsp;wrong&nbsp;initial_interval&nbsp;format:&nbsp;%s'</span>,&nbsp;<span id="ast-89"><span id="ast-90">self</span>.name</span>,&nbsp;<span id="ast-91" class="other_trans">initial_interval</span>)</span></span><span id="ast-92"><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.initial_interval</span>&nbsp;=&nbsp;<span id="ast-95">3600</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;dump(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">indent</span>,&nbsp;<span id="ast-6" class="other_trans">depth</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Diagnostic&nbsp;method&nbsp;for&nbsp;listing&nbsp;out&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;ParseResults.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Accepts&nbsp;an&nbsp;optional&nbsp;indent&nbsp;argument&nbsp;so&nbsp;that&nbsp;this&nbsp;string&nbsp;can&nbsp;be&nbsp;embedded\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;a&nbsp;nested&nbsp;display&nbsp;of&nbsp;other&nbsp;data.'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>&nbsp;=&nbsp;<span id="ast-12">[]</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>keys</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.items</span>()</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>keys</span>.sort</span>()</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">k</span>,&nbsp;<span id="ast-25" class="other_trans">v</span>)</span>&nbsp;in&nbsp;<span id="ast-26">keys</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28" class="other_trans">out</span>:<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-33">'\\u000a'</span>)</span></span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-38">(<span id="ast-39">'%s%s-&nbsp;%s:&nbsp;'</span>&nbsp;%&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">indent</span>,&nbsp;<span id="ast-43">(<span id="ast-44">'&nbsp;&nbsp;'</span>&nbsp;*&nbsp;<span id="ast-46" class="other_trans">depth</span>)</span>,&nbsp;<span id="ast-47" class="other_trans">k</span>)</span>)</span>)</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">isinstance</span>(<span id="ast-51" class="other_trans">v</span>,&nbsp;<span id="ast-52" class="other_trans">ParseResults</span>)</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">v</span>.keys</span>()</span>:<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-61">'\\u000a'</span>)</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-66"><span id="ast-67" class="correct_node">dump&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-68" class="other_trans">v</span>,&nbsp;<span id="ast-69" class="other_trans">indent</span>,&nbsp;<span id="ast-70">(<span id="ast-71">depth</span>&nbsp;+&nbsp;<span id="ast-73">1</span>)</span>)</span>)</span></span><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-78">'\\u000a'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-83"><span id="ast-84" class="other_trans">str</span>(<span id="ast-85" class="other_trans">v</span>)</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-90"><span id="ast-91" class="other_trans">str</span>(<span id="ast-92" class="other_trans">v</span>)</span>)</span></span></span></span><span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-97">'\\u000a'</span>)</span></span><span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>.append</span>(<span id="ast-102">(<span id="ast-103" class="other_trans">indent</span>&nbsp;+&nbsp;<span id="ast-105"><span id="ast-106" class="other_trans">str</span>(<span id="ast-107"><span id="ast-108"><span id="ast-109">self</span>.asList</span>()</span>)</span>)</span>)</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-111"><span id="ast-112"><span id="ast-113">''</span>.join</span>(<span id="ast-114" class="other_trans">out</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__bool__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-7"><span id="ast-8">isinstance</span>(<span id="ast-9">self</span>,&nbsp;<span id="ast-10" class="other_trans">_Operator</span>)</span>&nbsp;and&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13">self</span>.op</span><span id="ast-14" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-15">'=='</span>)</span>)</span>:<span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-18" class="other_trans">a</span>,&nbsp;<span id="ast-19" class="other_trans">b</span>)</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21">self</span>.operands</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-25"><span id="ast-26" class="other_trans">isinstance</span>(<span id="ast-27" class="other_trans">a</span>,&nbsp;<span id="ast-28">Constant</span>)</span>&nbsp;and&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">isinstance</span>(<span id="ast-31" class="other_trans">b</span>,&nbsp;<span id="ast-32" class="other_trans">Constant</span>)</span>)</span>:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36" class="other_trans">a</span>.value</span><span id="ast-37" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-38"><span id="ast-39" class="other_trans">b</span>.value</span>)</span></span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-43"><span id="ast-44" class="other_trans">isinstance</span>(<span id="ast-45" class="other_trans">a</span>,&nbsp;<span id="ast-46" class="other_trans">Signal</span>)</span>&nbsp;and&nbsp;<span id="ast-47"><span id="ast-48">isinstance</span>(<span id="ast-49" class="other_trans">b</span>,&nbsp;<span id="ast-50" class="other_trans">Signal</span>)</span>)</span>:<span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-52">(<span id="ast-53" class="other_trans">a</span><span id="ast-54" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-55" class="other_trans">b</span>)</span></span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57">(<span id="ast-59">(<span id="ast-61"><span id="ast-62" class="other_trans">isinstance</span>(<span id="ast-63" class="other_trans">a</span>,&nbsp;<span id="ast-64" class="other_trans">Constant</span>)</span>&nbsp;and&nbsp;<span id="ast-65"><span id="ast-66">isinstance</span>(<span id="ast-67" class="other_trans">b</span>,&nbsp;<span id="ast-68" class="other_trans">Signal</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-69">(<span id="ast-71"><span id="ast-72">isinstance</span>(<span id="ast-73" class="other_trans">a</span>,&nbsp;<span id="ast-74" class="other_trans">Signal</span>)</span>&nbsp;and&nbsp;<span id="ast-75"><span id="ast-76" class="other_trans">isinstance</span>(<span id="ast-77" class="ref_node">a&nbsp;&rarr;&nbsp;b&nbsp;</span>,&nbsp;<span id="ast-78">Constant</span>)</span>)</span>)</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-80">False</span></span></span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">TypeError</span>(<span id="ast-84">'Attempted&nbsp;to&nbsp;convert&nbsp;Migen&nbsp;value&nbsp;to&nbsp;boolean'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;readrequest(<span id="ast-2"></span>):<span id="ast-3"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-4">True</span>:<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>idx</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">buf</span>.find</span>(<span id="ast-10">'\\u000d\\u000a\\u000d\\u000a'</span>,&nbsp;<span id="ast-11"><span id="ast-12">pos</span>[<span id="ast-13"><span id="ast-14">0</span></span>]</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17">idx</span><span id="ast-18" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-19">0</span>)</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>readmore</span>()</span></span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>head</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27">buf</span>[<span id="ast-28"><span id="ast-29"><span id="ast-30">pos</span>[<span id="ast-31"><span id="ast-32">0</span></span>]</span>:<span id="ast-33">idx</span></span>]</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pos</span>[<span id="ast-37"><span id="ast-38">0</span></span>]</span>&nbsp;=&nbsp;<span id="ast-39">(<span id="ast-40" class="other_trans">idx</span>&nbsp;+&nbsp;<span id="ast-42">4</span>)</span></span><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lines</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">iter</span>(<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">head</span>.decode</span>(<span id="ast-52">'ascii'</span>)</span>.split</span>(<span id="ast-53">'\\u000d\\u000a'</span>)</span>)</span></span><span id="ast-54"><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>status</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57">next</span>(<span id="ast-58" class="other_trans">lines</span>)</span></span><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>&nbsp;=&nbsp;<span id="ast-61">{}</span></span><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>last_header</span>&nbsp;=&nbsp;<span id="ast-64" class="other_trans">None</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-66">line</span>&nbsp;in&nbsp;<span id="ast-67">lines</span>:<span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">line</span>.startswith</span>(<span id="ast-72">(<span id="ast-73">'&nbsp;'</span>,&nbsp;<span id="ast-74">'\\u0009'</span>)</span>)</span>:<span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-76">(<span id="ast-77" class="other_trans">last_header</span><span id="ast-78" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-79">None</span>)</span>:<span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>[<span id="ast-83"><span id="ast-84">last_header</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-86">line</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-88"><span id="ast-89">EOFError</span>(<span id="ast-90">'Wrong&nbsp;http&nbsp;headers'</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-92">(<span id="ast-93">':'</span><span id="ast-94">&nbsp;in&nbsp;</span><span id="ast-95" class="other_trans">line</span>)</span>:<span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-98" class="other_trans">k</span>,&nbsp;<span id="ast-99">v</span>)</span>&nbsp;=&nbsp;<span id="ast-100"><span id="ast-101"><span id="ast-102">line</span>.split</span>(<span id="ast-103">':'</span>,&nbsp;<span id="ast-104">1</span>)</span></span><span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>k</span>&nbsp;=&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans">k</span>.strip</span>()</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-111">(<span id="ast-112" class="other_trans">k</span><span id="ast-113">&nbsp;in&nbsp;</span><span id="ast-114" class="other_trans">headers</span>)</span>:<span id="ast-115"><span id="ast-116"><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>[<span id="ast-118"><span id="ast-119" class="other_trans">k</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-121">(<span id="ast-122">',&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-124"><span id="ast-125"><span id="ast-126">v</span>.strip</span>()</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-127"><span id="ast-128"><span id="ast-129" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>[<span id="ast-130"><span id="ast-131">k</span></span>]</span>&nbsp;=&nbsp;<span id="ast-132"><span id="ast-133"><span id="ast-134" class="other_trans">v</span>.strip</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-136"><span id="ast-137">EOFError</span>(<span id="ast-138">'Wrong&nbsp;http&nbsp;headers'</span>)</span></span></span></span><span id="ast-139"><span id="ast-140" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>clen</span>&nbsp;=&nbsp;<span id="ast-141"><span id="ast-142">int</span>(<span id="ast-143"><span id="ast-144"><span id="ast-145" class="other_trans">headers</span>.get</span>(<span id="ast-146">'Content-Length'</span>,&nbsp;<span id="ast-147">'0'</span>)</span>)</span></span><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-149">(<span id="ast-150" class="other_trans">clen</span><span id="ast-151" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-152">0</span>)</span>:<span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-154"><span id="ast-155" class="other_trans">EOFError</span>(<span id="ast-156">'Wrong&nbsp;content&nbsp;length'</span>)</span></span></span><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-158">(<span id="ast-159">(<span id="ast-160"><span id="ast-161" class="other_trans">pos</span>[<span id="ast-162"><span id="ast-163">0</span></span>]</span>&nbsp;+&nbsp;<span id="ast-165" class="other_trans">clen</span>)</span><span id="ast-166" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-167"><span id="ast-168">len</span>(<span id="ast-169">buf</span>)</span>)</span>:<span id="ast-170"><span id="ast-171"><span id="ast-172"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>readmore</span>()</span></span></span><span id="ast-173"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-174">(<span id="ast-175" class="other_trans">status</span>,&nbsp;<span id="ast-176" class="other_trans">headers</span>,&nbsp;<span id="ast-177"><span id="ast-178" class="other_trans">buf</span>[<span id="ast-179"><span id="ast-180"><span id="ast-181" class="other_trans">pos</span>[<span id="ast-182"><span id="ast-183">0</span></span>]</span>:<span id="ast-184">(<span id="ast-185"><span id="ast-186">pos</span>[<span id="ast-187"><span id="ast-188">0</span></span>]</span>&nbsp;+&nbsp;<span id="ast-190" class="other_trans">clen</span>)</span></span>]</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;runJobs(<span id="ast-2"><span id="ast-3" class="other_trans">commands</span>,&nbsp;<span id="ast-4" class="other_trans">environment</span>,&nbsp;<span id="ast-5" class="other_trans">j</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>running</span>&nbsp;=&nbsp;<span id="ast-9">[]</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">len</span>(<span id="ast-13" class="other_trans">commands</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17" class="other_trans">len</span>(<span id="ast-18" class="other_trans">running</span>)</span><span id="ast-19" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-20" class="other_trans">j</span>)</span>:<span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>thiscode</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">waitForAnyProcess</span>(<span id="ast-26" class="incorrect_node">running&nbsp;&rarr;&nbsp;commands&nbsp;</span>)</span>.returncode</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">thiscode</span><span id="ast-30" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-31">0</span>)</span>:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-33" class="other_trans">thiscode</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;is_vm_migrating(<span id="ast-2"><span id="ast-3" class="other_trans">nova</span>,&nbsp;<span id="ast-4" class="other_trans">vm</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Checking&nbsp;if&nbsp;a&nbsp;VM&nbsp;is&nbsp;migrating.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;nova:&nbsp;A&nbsp;Nova&nbsp;client.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;nova:&nbsp;*\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;vm:&nbsp;A&nbsp;VM&nbsp;UUID.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;vm:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:return:&nbsp;Whether&nbsp;the&nbsp;VM&nbsp;is&nbsp;migrating.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:rtype:&nbsp;bool\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">nova</span>.servers</span>.get</span>(<span id="ast-14">'vm'</span>)</span>.status</span><span id="ast-15" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-16">u'ACTIVE'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">looper</span>,&nbsp;<span id="ast-5" class="other_trans">basedirpath</span>,&nbsp;<span id="ast-6" class="other_trans">nodeReg</span>,&nbsp;<span id="ast-7" class="other_trans">cliNodeReg</span>,&nbsp;<span id="ast-8">output</span>,&nbsp;<span id="ast-10" class="other_trans">debug</span>,&nbsp;<span id="ast-12">logFileName</span></span>):<span id="ast-14"><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.curClientPort</span>&nbsp;=&nbsp;<span id="ast-17" class="other_trans">None</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.root</span>.addHandler</span>(<span id="ast-23"><span id="ast-24" class="other_trans">CliHandler</span>(<span id="ast-25"><span id="ast-26">self</span>.out</span>)</span>)</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cleanUp&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.looper</span>&nbsp;=&nbsp;<span id="ast-33" class="other_trans">looper</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.basedirpath</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40">os</span>.path</span>.expanduser</span>(<span id="ast-41" class="other_trans">basedirpath</span>)</span></span><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.nodeReg</span>&nbsp;=&nbsp;<span id="ast-45" class="other_trans">nodeReg</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cliNodeReg</span>&nbsp;=&nbsp;<span id="ast-49" class="other_trans">cliNodeReg</span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.nodeRegistry</span>&nbsp;=&nbsp;<span id="ast-53">{}</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">nStkNm</span>,&nbsp;<span id="ast-57" class="other_trans">nha</span>)</span>&nbsp;in&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61">self</span>.nodeReg</span>.items</span>()</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cStkNm</span>&nbsp;=&nbsp;<span id="ast-64">(<span id="ast-65" class="other_trans">nStkNm</span>&nbsp;+&nbsp;<span id="ast-67" class="other_trans">CLIENT_STACK_SUFFIX</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.nodeRegistry</span>[<span id="ast-72"><span id="ast-73" class="other_trans">nStkNm</span></span>]</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75">NodeDetail</span>(<span id="ast-76"><span id="ast-77" class="other_trans">HA</span>(*<span id="ast-78" class="other_trans">nha</span>)</span>,&nbsp;<span id="ast-79" class="incorrect_node">cStkNm&nbsp;&rarr;&nbsp;nha&nbsp;</span>,&nbsp;<span id="ast-80"><span id="ast-81" class="other_trans">HA</span>(*<span id="ast-82"><span id="ast-83"><span id="ast-84">self</span>.cliNodeReg</span>[<span id="ast-85"><span id="ast-86" class="other_trans">cStkNm</span></span>]</span>)</span>)</span></span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.clients</span>&nbsp;=&nbsp;<span id="ast-90">{}</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.requests</span>&nbsp;=&nbsp;<span id="ast-94">{}</span></span><span id="ast-95"><span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.nodes</span>&nbsp;=&nbsp;<span id="ast-98">{}</span></span><span id="ast-99"><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.externalClientKeys</span>&nbsp;=&nbsp;<span id="ast-102">{}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_signalandargs_inequality(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>signal_args1_1</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6" class="other_trans">SignalAndArgs</span>(signal_name=<span id="ast-8">'signal'</span>,&nbsp;args=<span id="ast-10">(<span id="ast-11">1</span>,&nbsp;<span id="ast-12">2</span>)</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>signal_args1_2</span>&nbsp;=&nbsp;<span id="ast-15">'foo'</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">signal_args1_1</span><span id="ast-19" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-20" class="other_trans">signal_args1_2</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;load_userdict(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">f</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Load&nbsp;personalized&nbsp;dict&nbsp;to&nbsp;improve&nbsp;detect&nbsp;rate.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameter:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;f&nbsp;:&nbsp;A&nbsp;plain&nbsp;text&nbsp;file&nbsp;contains&nbsp;words&nbsp;and&nbsp;their&nbsp;ocurrences.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;be&nbsp;a&nbsp;file-like&nbsp;object,&nbsp;or&nbsp;the&nbsp;path&nbsp;of&nbsp;the&nbsp;dictionary&nbsp;file,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;whose&nbsp;encoding&nbsp;must&nbsp;be&nbsp;utf-8.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Structure&nbsp;of&nbsp;dict&nbsp;file:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;word1&nbsp;freq1&nbsp;word_type1\\u000a&nbsp;&nbsp;&nbsp;&nbsp;word2&nbsp;freq2&nbsp;word_type2\\u000a&nbsp;&nbsp;&nbsp;&nbsp;...\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Word&nbsp;type&nbsp;may&nbsp;be&nbsp;ignored\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.check_initialized</span>()</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">isinstance</span>(<span id="ast-14" class="other_trans">f</span>,&nbsp;<span id="ast-15">string_types</span>)</span>:<span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19">open</span>(<span id="ast-20" class="other_trans">f</span>,&nbsp;<span id="ast-21">'rb'</span>)</span></span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23">(<span id="ast-24">lineno</span>,&nbsp;<span id="ast-25" class="other_trans">ln</span>)</span>&nbsp;in&nbsp;<span id="ast-26"><span id="ast-27">enumerate</span>(<span id="ast-28" class="other_trans">f</span>,&nbsp;<span id="ast-29">1</span>)</span>:<span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>line</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">ln</span>.strip</span>()</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37">not</span>&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">isinstance</span>(<span id="ast-40" class="correct_node">f&nbsp;&rarr;&nbsp;line&nbsp;</span>,&nbsp;<span id="ast-41" class="other_trans">text_type</span>)</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>line</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">line</span>.decode</span>(<span id="ast-50">'utf-8'</span>)</span>.lstrip</span>(<span id="ast-51">'\\\\ufeff'</span>)</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-53">UnicodeDecodeError</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-55"><span id="ast-56">ValueError</span>(<span id="ast-57">(<span id="ast-58">'dictionary&nbsp;file&nbsp;%s&nbsp;must&nbsp;be&nbsp;utf-8'</span>&nbsp;%&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">f</span>.name</span>)</span>)</span></span></span></span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63">(<span id="ast-64">not</span>&nbsp;<span id="ast-65" class="other_trans">line</span>)</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-69" class="other_trans">word</span>,&nbsp;<span id="ast-70">freq</span>,&nbsp;<span id="ast-71" class="other_trans">tag</span>)</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">re_userdict</span>.match</span>(<span id="ast-77">line</span>)</span>.groups</span>()</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-79">(<span id="ast-80" class="other_trans">freq</span><span id="ast-81" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-82" class="other_trans">None</span>)</span>:<span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>freq</span>&nbsp;=&nbsp;<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans">freq</span>.strip</span>()</span></span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-89">(<span id="ast-90" class="other_trans">tag</span><span id="ast-91" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-92">None</span>)</span>:<span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tag</span>&nbsp;=&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans">tag</span>.strip</span>()</span></span></span><span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.add_word</span>(<span id="ast-102" class="other_trans">word</span>,&nbsp;<span id="ast-103" class="other_trans">freq</span>,&nbsp;<span id="ast-104" class="other_trans">tag</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_extract(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">file</span>,&nbsp;<span id="ast-5">password</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>._verify_archive</span>(<span id="ast-12" class="other_trans">file</span>)</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-14" class="other_trans">None</span></span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>._is_overwritten</span>(<span id="ast-19">file</span>)</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-24">'ZIP&nbsp;file&nbsp;contains&nbsp;a&nbsp;file&nbsp;with&nbsp;the&nbsp;same&nbsp;name,&nbsp;original&nbsp;is&nbsp;going&nbsp;to&nbsp;be&nbsp;overwrite'</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_zip_path</span>&nbsp;=&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">file</span>&nbsp;+&nbsp;<span id="ast-30"><span id="ast-31" class="ref_node">_random_extension&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span>)</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>move</span>(<span id="ast-35" class="other_trans">file</span>,&nbsp;<span id="ast-36">new_zip_path</span>)</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>file</span>&nbsp;=&nbsp;<span id="ast-39" class="other_trans">new_zip_path</span></span></span><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>extract_path</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44">environ</span>.get</span>(<span id="ast-45">'TEMP'</span>,&nbsp;<span id="ast-46">'/tmp'</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">ZipFile</span>(<span id="ast-50" class="other_trans">file</span>,&nbsp;<span id="ast-51">'r'</span>)</span>&nbsp;as&nbsp;<span id="ast-52" class="other_trans">archive</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>archive</span>.extractall</span>(path=<span id="ast-60" class="other_trans">extract_path</span>,&nbsp;pwd=<span id="ast-62" class="other_trans">password</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-64" class="other_trans">BadZipfile</span>:<span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-66"><span id="ast-67">Exception</span>(<span id="ast-68">'Invalid&nbsp;Zip&nbsp;file'</span>)</span></span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-70" class="other_trans">RuntimeError</span>:<span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>archive</span>.extractall</span>(path=<span id="ast-77" class="other_trans">extract_path</span>,&nbsp;pwd=<span id="ast-79">'infected'</span>)</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-81">RuntimeError</span>&nbsp;as&nbsp;<span id="ast-82" class="other_trans">e</span>:<span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-84"><span id="ast-85">Exception</span>(<span id="ast-86"><span id="ast-87"><span id="ast-88">'Unable&nbsp;to&nbsp;extract&nbsp;Zip&nbsp;file:&nbsp;{0}'</span>.format</span>(<span id="ast-89" class="other_trans">e</span>)</span>)</span></span></span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>finally:<span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-91" class="other_trans">name</span>&nbsp;in&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans">archive</span>.namelist</span>()</span>:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98" class="other_trans">name</span>.endswith</span>(<span id="ast-99">'.zip'</span>)</span>:<span id="ast-100"><span id="ast-101"><span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._extract</span>(<span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107">os</span>.path</span>.join</span>(<span id="ast-108" class="other_trans">extract_path</span>,&nbsp;<span id="ast-109" class="other_trans">name</span>)</span>,&nbsp;<span id="ast-110" class="incorrect_node">password&nbsp;&rarr;&nbsp;name&nbsp;</span>)</span></span></span></span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-112"><span id="ast-113"><span id="ast-114" class="other_trans">archive</span>.namelist</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;submit(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">player_name</span>,&nbsp;<span id="ast-5" class="other_trans">move</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Submit&nbsp;a&nbsp;move&nbsp;for&nbsp;the&nbsp;specified&nbsp;player&nbsp;in&nbsp;the&nbsp;current&nbsp;round.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;True&nbsp;if&nbsp;the&nbsp;move&nbsp;was&nbsp;submitted,&nbsp;False&nbsp;otherwise.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>player</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>._players</span>.get</span>(<span id="ast-14" class="other_trans">player_name</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16" class="other_trans">player</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-20">(<span id="ast-21"><span id="ast-22">self</span>._round_num</span><span id="ast-23" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-24">0</span>)</span>&nbsp;and&nbsp;<span id="ast-25">(<span id="ast-26"><span id="ast-27">self</span>._round_num</span><span id="ast-28" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-29" class="other_trans">MAX_ROUNDS</span>)</span>&nbsp;and&nbsp;<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>._round</span>.submit</span>(<span id="ast-34" class="other_trans">player</span>,&nbsp;<span id="ast-35" class="other_trans">move</span>)</span>)</span>:<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._broadcast_status</span>()</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44">self</span>._round</span>.is_over</span>()</span>:<span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">(<span id="ast-47"><span id="ast-48">self</span>._round_num</span><span id="ast-49" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-50" class="other_trans">MAX_ROUNDS</span>)</span>:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._next_round</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._broadcast_status</span>()</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;runTest(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;most&nbsp;basic&nbsp;python&nbsp;test&nbsp;possible,&nbsp;checks&nbsp;that&nbsp;the&nbsp;files&nbsp;we&nbsp;have&nbsp;written\\u000a&nbsp;&nbsp;&nbsp;&nbsp;are&nbsp;importable&nbsp;in&nbsp;python,&nbsp;this&nbsp;is&nbsp;a&nbsp;basic&nbsp;sanity&nbsp;check\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>found</span>&nbsp;=&nbsp;<span id="ast-8">[]</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-10">(<span id="ast-11" class="other_trans">root</span>,&nbsp;<span id="ast-12">dirs</span>,&nbsp;<span id="ast-13" class="other_trans">files</span>)</span>&nbsp;in&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">os</span>.walk</span>(<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">os</span>.path</span>.realpath</span>(<span id="ast-21">(<span id="ast-22">__file__</span>&nbsp;+&nbsp;<span id="ast-24">'/../../../'</span>)</span>)</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-27">'.git'</span><span id="ast-28">&nbsp;in&nbsp;</span><span id="ast-29">root</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32">f</span>&nbsp;in&nbsp;<span id="ast-33">files</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">f</span>.endswith</span>(<span id="ast-40">'.png'</span>)</span>&nbsp;or&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43">f</span>.endswith</span>(<span id="ast-44">'.ppt'</span>)</span>&nbsp;or&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">f</span>.endswith</span>(<span id="ast-48">'.pptx'</span>)</span>&nbsp;or&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">f</span>.endswith</span>(<span id="ast-52">'.css'</span>)</span>&nbsp;or&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">f</span>.endswith</span>(<span id="ast-56">'.svg'</span>)</span>&nbsp;or&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59">f</span>.endswith</span>(<span id="ast-60">'.jpeg'</span>)</span>&nbsp;or&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63">f</span>.endswith</span>(<span id="ast-64">'.jpg'</span>)</span>&nbsp;or&nbsp;<span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans">f</span>.endswith</span>(<span id="ast-68">'.bmp'</span>)</span>&nbsp;or&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">f</span>.endswith</span>(<span id="ast-72">'.pdf'</span>)</span>&nbsp;or&nbsp;<span id="ast-73"><span id="ast-74"><span id="ast-75">f</span>.endswith</span>(<span id="ast-76">'.pyc'</span>)</span>)</span>:<span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-79">(<span id="ast-80">f</span><span id="ast-81">&nbsp;in&nbsp;</span><span id="ast-82"><span id="ast-83">self</span>.ignore</span>)</span>:<span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>found</span>&nbsp;=&nbsp;<span id="ast-87">(<span id="ast-88">found</span>&nbsp;+&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92">self</span>.findversion</span>(<span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96">os</span>.path</span>.join</span>(<span id="ast-97" class="other_trans">root</span>,&nbsp;<span id="ast-98" class="other_trans">f</span>)</span>)</span>)</span></span></span></span><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>found</span>&nbsp;=&nbsp;<span id="ast-101">[<span id="ast-102">i</span><span id="ast-103">&nbsp;for&nbsp;<span id="ast-104">i</span>&nbsp;in&nbsp;<span id="ast-105">found</span>&nbsp;if&nbsp;<span id="ast-106">(<span id="ast-108">(<span id="ast-109" class="other_trans">i</span><span id="ast-110" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-111">None</span>)</span>&nbsp;and&nbsp;<span id="ast-112"><span id="ast-113" class="other_trans">len</span>(<span id="ast-114" class="ref_node">found&nbsp;&rarr;&nbsp;i&nbsp;</span>)</span>)</span></span>]</span></span><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>foundn</span>&nbsp;=&nbsp;<span id="ast-117">[<span id="ast-118"><span id="ast-119"><span id="ast-120" class="other_trans">i</span>[<span id="ast-121"><span id="ast-122">-1</span></span>]</span>[<span id="ast-123"><span id="ast-124">0</span></span>]</span><span id="ast-125">&nbsp;for&nbsp;<span id="ast-126" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-127" class="other_trans">found</span></span>]</span></span><span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-132">(<span id="ast-133"><span id="ast-134">len</span>(<span id="ast-135"><span id="ast-136">set</span>(<span id="ast-137">foundn</span>)</span>)</span><span id="ast-138" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-139">1</span>)</span>,&nbsp;<span id="ast-140">(<span id="ast-141">'Mis-matching&nbsp;version&nbsp;numbers&nbsp;found!&nbsp;\\u000a\\u0009'</span>&nbsp;+&nbsp;<span id="ast-143"><span id="ast-144"><span id="ast-145">'\\u000a\\u0009'</span>.join</span>(<span id="ast-146">[<span id="ast-147"><span id="ast-148" class="other_trans">str</span>(<span id="ast-149">i</span>)</span><span id="ast-150">&nbsp;for&nbsp;<span id="ast-151">i</span>&nbsp;in&nbsp;<span id="ast-152">found</span></span>]</span>)</span>)</span>)</span></span><span id="ast-153"><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>foundp</span>&nbsp;=&nbsp;<span id="ast-155">[<span id="ast-156" class="other_trans">i</span><span id="ast-157">&nbsp;for&nbsp;<span id="ast-158" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-159" class="other_trans">foundn</span>&nbsp;if&nbsp;<span id="ast-160">(<span id="ast-161" class="other_trans">i</span><span id="ast-162" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-163"><span id="ast-164">self</span>.checkAgainst</span>)</span></span>]</span></span><span id="ast-165"><span id="ast-166"><span id="ast-167"><span id="ast-168"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertFalse</span>(<span id="ast-169"><span id="ast-170" class="other_trans">len</span>(<span id="ast-171"><span id="ast-172">set</span>(<span id="ast-173" class="other_trans">foundp</span>)</span>)</span>,&nbsp;<span id="ast-174">(<span id="ast-175">(<span id="ast-176">(<span id="ast-177">'Versions&nbsp;match,&nbsp;but&nbsp;are&nbsp;not&nbsp;what&nbsp;was&nbsp;expected:&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-179"><span id="ast-180">self</span>.checkAgainst</span>)</span>&nbsp;+&nbsp;<span id="ast-182">'&nbsp;\\u000a\\u0009'</span>)</span>&nbsp;+&nbsp;<span id="ast-184"><span id="ast-185"><span id="ast-186">'\\u000a\\u0009'</span>.join</span>(<span id="ast-187">[<span id="ast-188"><span id="ast-189" class="other_trans">str</span>(<span id="ast-190" class="other_trans">i</span>)</span><span id="ast-191">&nbsp;for&nbsp;<span id="ast-192" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-193">found</span></span>]</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__new__(<span id="ast-2"><span id="ast-3">mcs</span>,&nbsp;<span id="ast-4" class="other_trans">name</span>,&nbsp;<span id="ast-5">bases</span>,&nbsp;<span id="ast-6" class="other_trans">attrs</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>form_meta</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">_get_mro_attribute</span>(<span id="ast-11">bases</span>,&nbsp;<span id="ast-12">'_meta'</span>)</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>form_base_fields</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16">_get_mro_attribute</span>(<span id="ast-17">bases</span>,&nbsp;<span id="ast-18">'base_fields'</span>,&nbsp;<span id="ast-19">{}</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">form_meta</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>form_new_meta</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">attrs</span>.get</span>(<span id="ast-27">'Meta'</span>,&nbsp;<span id="ast-28">form_meta</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>form_model</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-33"><span id="ast-34" class="other_trans">form_new_meta</span>.model</span>&nbsp;if&nbsp;<span id="ast-32" class="other_trans">form_new_meta</span>&nbsp;else&nbsp;<span id="ast-35"><span id="ast-36">form_meta</span>.model</span></span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>translated_fields</span>&nbsp;=&nbsp;<span id="ast-39">[<span id="ast-40">f_name</span><span id="ast-41">&nbsp;for&nbsp;<span id="ast-42">(<span id="ast-43" class="other_trans">f_name</span>,&nbsp;<span id="ast-44" class="other_trans">attr_value</span>)</span>&nbsp;in&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">six</span>.iteritems</span>(<span id="ast-48" class="other_trans">attrs</span>)</span>&nbsp;if&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">isinstance</span>(<span id="ast-51" class="other_trans">attr_value</span>,&nbsp;<span id="ast-52">TranslatedField</span>)</span></span>]</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54">form_model</span>:<span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-56" class="other_trans">translations_model</span>&nbsp;in&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60">form_model</span>._parler_meta</span>.get_all_models</span>()</span>:<span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64" class="other_trans">getattr</span>(<span id="ast-65">form_new_meta</span>,&nbsp;<span id="ast-66">'fields'</span>,&nbsp;<span id="ast-67"><span id="ast-68">form_meta</span>.fields</span>)</span></span><span id="ast-69"><span id="ast-70" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>exclude&nbsp;&rarr;&nbsp;fields&nbsp;</span>&nbsp;=&nbsp;<span id="ast-71">(<span id="ast-73"><span id="ast-74" class="other_trans">getattr</span>(<span id="ast-75">form_new_meta</span>,&nbsp;<span id="ast-76">'exclude'</span>,&nbsp;<span id="ast-77"><span id="ast-78">form_meta</span>.exclude</span>)</span>&nbsp;or&nbsp;<span id="ast-79">()</span>)</span></span><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>widgets</span>&nbsp;=&nbsp;<span id="ast-82">(<span id="ast-84"><span id="ast-85">getattr</span>(<span id="ast-86">form_new_meta</span>,&nbsp;<span id="ast-87">'widgets'</span>,&nbsp;<span id="ast-88"><span id="ast-89" class="other_trans">form_meta</span>.widgets</span>)</span>&nbsp;or&nbsp;<span id="ast-90">()</span>)</span></span><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>formfield_callback</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95">attrs</span>.get</span>(<span id="ast-96">'formfield_callback'</span>,&nbsp;<span id="ast-97">None</span>)</span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-99">(<span id="ast-100">fields</span><span id="ast-101" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-102">'__all__'</span>)</span>:<span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>&nbsp;=&nbsp;<span id="ast-105">None</span></span></span><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-107" class="other_trans">f_name</span>&nbsp;in&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110" class="other_trans">translations_model</span>.get_translated_fields</span>()</span>:<span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112">(<span id="ast-113">f_name</span><span id="ast-114">&nbsp;in&nbsp;</span><span id="ast-115" class="other_trans">translated_fields</span>)</span>:<span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>attrs</span>[<span id="ast-119"><span id="ast-120" class="other_trans">f_name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-121"><span id="ast-122">_get_model_form_field</span>(<span id="ast-123">translations_model</span>,&nbsp;<span id="ast-124" class="other_trans">f_name</span>,&nbsp;formfield_callback=<span id="ast-126" class="other_trans">formfield_callback</span>,&nbsp;**<span id="ast-127"><span id="ast-128"><span id="ast-129" class="ref_node">translated_fields&nbsp;&rarr;&nbsp;attrs&nbsp;</span>[<span id="ast-130"><span id="ast-131">f_name</span></span>]</span>.kwargs</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-133">(<span id="ast-135">(<span id="ast-136" class="other_trans">f_name</span><span id="ast-137">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-138" class="other_trans">form_base_fields</span>)</span>&nbsp;and&nbsp;<span id="ast-139">(<span id="ast-141">(<span id="ast-142" class="other_trans">fields</span><span id="ast-143" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-144">None</span>)</span>&nbsp;or&nbsp;<span id="ast-145">(<span id="ast-146" class="other_trans">f_name</span><span id="ast-147">&nbsp;in&nbsp;</span><span id="ast-148">fields</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-149">(<span id="ast-150">f_name</span><span id="ast-151">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-152">exclude</span>)</span>&nbsp;and&nbsp;<span id="ast-153">(<span id="ast-154">not</span>&nbsp;<span id="ast-155">(<span id="ast-156">f_name</span><span id="ast-157">&nbsp;in&nbsp;</span><span id="ast-158">attrs</span>)</span>)</span>)</span>:<span id="ast-159"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-160">(<span id="ast-161">f_name</span><span id="ast-162">&nbsp;in&nbsp;</span><span id="ast-163" class="other_trans">widgets</span>)</span>:<span id="ast-164"><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>&nbsp;=&nbsp;<span id="ast-166">{<span id="ast-167">'widget'</span>:&nbsp;<span id="ast-168"><span id="ast-169">widgets</span>[<span id="ast-170"><span id="ast-171" class="other_trans">f_name</span></span>]</span>}</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-172"><span id="ast-173"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwargs</span>&nbsp;=&nbsp;<span id="ast-174">{}</span></span></span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;check_plugins(<span id="ast-2"><span id="ast-3" class="other_trans">config_parser</span>,&nbsp;<span id="ast-4" class="other_trans">head</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Check&nbsp;if&nbsp;the&nbsp;plugins&nbsp;exist&nbsp;in&nbsp;vcf&nbsp;file\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;config_parser&nbsp;(ConfigObj):&nbsp;A&nbsp;config&nbsp;object&nbsp;with&nbsp;the&nbsp;plugins\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;head&nbsp;(HeaderParser):&nbsp;A&nbsp;vcf&nbsp;header&nbsp;object\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Returns:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool:&nbsp;If&nbsp;all&nbsp;tests&nbsp;passed&nbsp;or&nbsp;not\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>all_pass</span>&nbsp;=&nbsp;<span id="ast-9">True</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-11">plugin</span>&nbsp;in&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">config_parser</span>.plugins</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_object</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">config_parser</span>.plugins</span>[<span id="ast-19"><span id="ast-20" class="other_trans">plugin</span></span>]</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.debug</span>(<span id="ast-25"><span id="ast-26"><span id="ast-27">'Checking&nbsp;plugin&nbsp;{0}'</span>.format</span>(<span id="ast-28" class="other_trans">plugin</span>)</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32">plugin_object</span>.field</span><span id="ast-33" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-34">'INFO'</span>)</span>:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>info_key</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">plugin_object</span>.info_key</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">info_key</span><span id="ast-42">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-43"><span id="ast-44" class="other_trans">head</span>.info_dict</span>)</span>:<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warning</span>(<span id="ast-49"><span id="ast-50"><span id="ast-51">'INFO&nbsp;field&nbsp;{0}&nbsp;is&nbsp;not&nbsp;in&nbsp;vcf&nbsp;INFO.&nbsp;This&nbsp;field&nbsp;will&nbsp;not&nbsp;be&nbsp;scored.'</span>.format</span>(<span id="ast-52" class="other_trans">info_key</span>)</span>)</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>all_pass</span>&nbsp;=&nbsp;<span id="ast-55">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.debug</span>(<span id="ast-60"><span id="ast-61"><span id="ast-62">'INFO&nbsp;field&nbsp;{0}&nbsp;was&nbsp;found&nbsp;in&nbsp;vcf&nbsp;INFO.'</span>.format</span>(<span id="ast-63" class="other_trans">info_key</span>)</span>)</span></span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-65">(<span id="ast-66" class="other_trans">info_key</span><span id="ast-67" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-68">'CSQ'</span>)</span>:<span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>csq_key</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72" class="correct_node">plugin&nbsp;&rarr;&nbsp;plugin_object&nbsp;</span>.csq_key</span></span><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-74">(<span id="ast-75">csq_key</span><span id="ast-76">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-77"><span id="ast-78" class="other_trans">head</span>.vep_columns</span>)</span>:<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warning</span>(<span id="ast-83"><span id="ast-84"><span id="ast-85">'CSQ&nbsp;field&nbsp;{0}&nbsp;is&nbsp;not&nbsp;in&nbsp;csq&nbsp;annotation.&nbsp;This&nbsp;field&nbsp;will&nbsp;not&nbsp;be&nbsp;scored.'</span>.format</span>(<span id="ast-86" class="other_trans">csq_key</span>)</span>)</span></span><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>all_pass</span>&nbsp;=&nbsp;<span id="ast-89">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.debug</span>(<span id="ast-94"><span id="ast-95"><span id="ast-96">'CSQ&nbsp;field&nbsp;{0}&nbsp;was&nbsp;found&nbsp;in&nbsp;csq&nbsp;annotation.'</span>.format</span>(<span id="ast-97" class="other_trans">csq_key</span>)</span>)</span></span></span></span></span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-99" class="other_trans">all_pass</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_partial_start_codons(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;test_partial_start_codons&nbsp;:&nbsp;Make&nbsp;sure&nbsp;none&nbsp;of&nbsp;the&nbsp;start&nbsp;codons&nbsp;returned\\u000a&nbsp;&nbsp;&nbsp;&nbsp;only&nbsp;partially&nbsp;overlap&nbsp;with&nbsp;an&nbsp;exon.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exon</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">ensembl77</span>.exon_by_id</span>(<span id="ast-10">'ENSE00003718948'</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-12" class="other_trans">start</span>&nbsp;in&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">exon</span>.start_codon_positions</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">start</span><span id="ast-18" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-19"><span id="ast-20" class="other_trans">exon</span>.start</span>)</span>,&nbsp;<span id="ast-21">(<span id="ast-22">'Exon&nbsp;at&nbsp;locus&nbsp;[%d,&nbsp;%d],&nbsp;start&nbsp;codon&nbsp;at&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">exon</span>.start</span>,&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">exon</span>.end</span>,&nbsp;<span id="ast-29" class="other_trans">start</span>)</span>)</span></span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-31" class="other_trans">offset</span>&nbsp;in&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">exon</span>.start_codon_offsets</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-35">(<span id="ast-36" class="other_trans">offset</span><span id="ast-37" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-38">0</span>)</span>,&nbsp;<span id="ast-39">(<span id="ast-40">'Invalid&nbsp;negative&nbsp;offset&nbsp;for&nbsp;start&nbsp;codon:&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-42" class="other_trans">offset</span>)</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-44">(<span id="ast-45" class="other_trans">offset</span><span id="ast-46" class="location_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=,&nbsp;pred:&nbsp;>=&nbsp;</span><span id="ast-47">0</span>)</span>,&nbsp;<span id="ast-48">'Partially&nbsp;overlapping&nbsp;start&nbsp;codon&nbsp;should&nbsp;not&nbsp;be&nbsp;included'</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;do_reset(<span id="ast-2"><span id="ast-3" class="other_trans">term</span>,&nbsp;<span id="ast-4" class="other_trans">handle</span>,&nbsp;<span id="ast-5" class="other_trans">email</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Password&nbsp;reset&nbsp;by&nbsp;e-mail&nbsp;loop.&nbsp;'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sep_ok</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">getattr</span>(<span id="ast-14" class="other_trans">term</span>,&nbsp;<span id="ast-15" class="other_trans">color_secondary</span>)</span>(<span id="ast-16">u'::'</span>)</span></span><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sep_bad</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">getattr</span>(<span id="ast-22" class="other_trans">term</span>,&nbsp;<span id="ast-23" class="other_trans">color_primary</span>)</span>(<span id="ast-24">u'::'</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>email</span>&nbsp;=&nbsp;<span id="ast-27">u''</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29" class="other_trans">_</span>&nbsp;in&nbsp;<span id="ast-30"><span id="ast-31">range</span>(<span id="ast-32" class="other_trans">passkey_max_attempts</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>handle</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">prompt_input</span>(term=<span id="ast-38" class="other_trans">term</span>,&nbsp;key=<span id="ast-40">'Username'</span>,&nbsp;content=<span id="ast-42">(<span id="ast-44" class="other_trans">handle</span>&nbsp;or&nbsp;<span id="ast-45">u''</span>)</span>,&nbsp;width=<span id="ast-47">username_max_length</span>)</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-50">not</span>&nbsp;<span id="ast-51" class="incorrect_node">handle&nbsp;&rarr;&nbsp;email&nbsp;</span>)</span>:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-53">False</span></span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>email</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57" class="other_trans">prompt_input</span>(term=<span id="ast-59" class="other_trans">term</span>,&nbsp;key=<span id="ast-61">'E-mail'</span>,&nbsp;content=<span id="ast-63">(<span id="ast-65" class="ref_node">handle&nbsp;&rarr;&nbsp;email&nbsp;</span>&nbsp;or&nbsp;<span id="ast-66">u''</span>)</span>,&nbsp;width=<span id="ast-68" class="other_trans">email_max_length</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70">(<span id="ast-71">not</span>&nbsp;<span id="ast-72" class="other_trans">email</span>)</span>:<span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-74">False</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;inner(<span id="ast-2"><span id="ast-3" class="other_trans">info</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">counter</span>.next</span>()</span><span id="ast-9" class="incorrect_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-10">patience</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12">False</span></span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">isinstance</span>(<span id="ast-16" class="other_trans">func_or_key</span>,&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">str</span>,&nbsp;<span id="ast-19" class="other_trans">unicode</span>)</span>)</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">info</span>[<span id="ast-24"><span id="ast-25" class="other_trans">func_or_key</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">func_or_key</span>()</span></span></span><span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>results</span>.append</span>(<span id="ast-34" class="other_trans">val</span>)</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37"><span id="ast-38" class="other_trans">len</span>(<span id="ast-39" class="other_trans">results</span>)</span><span id="ast-40" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-41">(<span id="ast-42" class="other_trans">n</span>&nbsp;+&nbsp;<span id="ast-44">1</span>)</span>)</span>:<span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46">False</span></span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48">(<span id="ast-49">(<span id="ast-50"><span id="ast-51" class="other_trans">results</span>[<span id="ast-52"><span id="ast-53">(<span id="ast-54">(<span id="ast-55">-</span><span id="ast-56" class="other_trans">n</span>)</span>&nbsp;-&nbsp;<span id="ast-58">1</span>)</span></span>]</span>&nbsp;+&nbsp;<span id="ast-60" class="other_trans">epsilon</span>)</span><span id="ast-61" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-62"><span id="ast-63" class="other_trans">results</span>[<span id="ast-64"><span id="ast-65">-1</span></span>]</span>)</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-67">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-69">False</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;setTemperature_Factor(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>temperature</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">epd</span>.get_temperature</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-10">(<span id="ast-11">'temperature&nbsp;=&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-13" class="other_trans">temperature</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">temperature</span><span id="ast-17" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-18">-10</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stageTime</span>&nbsp;=&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24"><span id="ast-25">self</span>.COG_Params</span>.stageTime</span>&nbsp;*&nbsp;<span id="ast-27">17</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">temperature</span><span id="ast-31" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-32">-5</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stageTime</span>&nbsp;=&nbsp;<span id="ast-36">(<span id="ast-37"><span id="ast-38"><span id="ast-39">self</span>.COG_Params</span>.stageTime</span>&nbsp;*&nbsp;<span id="ast-41">12</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-43">(<span id="ast-44" class="other_trans">temperature</span><span id="ast-45" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-46">5</span>)</span>:<span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stageTime</span>&nbsp;=&nbsp;<span id="ast-50">(<span id="ast-51"><span id="ast-52"><span id="ast-53">self</span>.COG_Params</span>.stageTime</span>&nbsp;*&nbsp;<span id="ast-55">8</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-57">(<span id="ast-58" class="other_trans">temperature</span><span id="ast-59" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-60">10</span>)</span>:<span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stageTime</span>&nbsp;=&nbsp;<span id="ast-64">(<span id="ast-65"><span id="ast-66"><span id="ast-67">self</span>.COG_Params</span>.stageTime</span>&nbsp;*&nbsp;<span id="ast-69">4</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-71">(<span id="ast-72" class="other_trans">temperature</span><span id="ast-73" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-74">15</span>)</span>:<span id="ast-75"><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stageTime</span>&nbsp;=&nbsp;<span id="ast-78">(<span id="ast-79"><span id="ast-80"><span id="ast-81">self</span>.COG_Params</span>.stageTime</span>&nbsp;*&nbsp;<span id="ast-83">3</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-85">(<span id="ast-86" class="other_trans">temperature</span><span id="ast-87" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-88">20</span>)</span>:<span id="ast-89"><span id="ast-90"><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stageTime</span>&nbsp;=&nbsp;<span id="ast-92">(<span id="ast-93"><span id="ast-94"><span id="ast-95">self</span>.COG_Params</span>.stageTime</span>&nbsp;*&nbsp;<span id="ast-97">2</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-99">(<span id="ast-100" class="other_trans">temperature</span><span id="ast-101" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-102">40</span>)</span>:<span id="ast-103"><span id="ast-104"><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stageTime</span>&nbsp;=&nbsp;<span id="ast-106">(<span id="ast-107"><span id="ast-108"><span id="ast-109">self</span>.COG_Params</span>.stageTime</span>&nbsp;*&nbsp;<span id="ast-111">1</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-112"><span id="ast-113"><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stageTime</span>&nbsp;=&nbsp;<span id="ast-115">(<span id="ast-116">(<span id="ast-117"><span id="ast-118"><span id="ast-119">self</span>.COG_Params</span>.stageTime</span>&nbsp;*&nbsp;<span id="ast-121">7</span>)</span>&nbsp;/&nbsp;<span id="ast-123">10</span>)</span></span></span><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-125">(<span id="ast-126">'stageTime&nbsp;=&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-128" class="correct_node">stageTime&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;one_request_per_plugin(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">items</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>out</span>&nbsp;=&nbsp;<span id="ast-7">[]</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sorting</span>&nbsp;=&nbsp;<span id="ast-10">{}</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-12" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-13" class="other_trans">items</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">item</span>[<span id="ast-18"><span id="ast-19">'url'</span></span>]</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>version</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="correct_node">items&nbsp;&rarr;&nbsp;item&nbsp;</span>[<span id="ast-24"><span id="ast-25">'output'</span></span>]</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sorting</span>[<span id="ast-31"><span id="ast-32" class="other_trans">url</span></span>]</span>[<span id="ast-33"><span id="ast-34">'counter'</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-36">1</span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sorting</span>[<span id="ast-43"><span id="ast-44" class="other_trans">url</span></span>]</span>[<span id="ast-45"><span id="ast-46">'versions'</span></span>]</span>.add</span>(<span id="ast-47" class="other_trans">version</span>)</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sorting</span>[<span id="ast-52"><span id="ast-53" class="other_trans">url</span></span>]</span>&nbsp;=&nbsp;<span id="ast-54">{<span id="ast-55">'counter'</span>:&nbsp;<span id="ast-57">1</span>,&nbsp;<span id="ast-56">'version'</span>:&nbsp;<span id="ast-58"><span id="ast-59" class="other_trans">set</span>(<span id="ast-60">[<span id="ast-61" class="other_trans">version</span>]</span>)</span>}</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;check_ordering(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">task</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Checks&nbsp;the&nbsp;ordering&nbsp;of&nbsp;a&nbsp;task&nbsp;in&nbsp;relation&nbsp;to&nbsp;other&nbsp;tasks&nbsp;and&nbsp;their&nbsp;phases\\u000a&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;function&nbsp;checks&nbsp;for&nbsp;a&nbsp;subset&nbsp;of&nbsp;what&nbsp;the&nbsp;strongly&nbsp;connected&nbsp;components&nbsp;algorithm&nbsp;does,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;can&nbsp;deliver&nbsp;a&nbsp;more&nbsp;precise&nbsp;error&nbsp;message,&nbsp;namely&nbsp;that&nbsp;there&nbsp;is&nbsp;a&nbsp;conflict&nbsp;between\\u000a&nbsp;&nbsp;&nbsp;&nbsp;what&nbsp;a&nbsp;task&nbsp;has&nbsp;specified&nbsp;as&nbsp;its&nbsp;predecessors&nbsp;or&nbsp;successors&nbsp;and&nbsp;in&nbsp;which&nbsp;phase&nbsp;it&nbsp;is&nbsp;placed.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;task&nbsp;(Task):&nbsp;The&nbsp;task&nbsp;to&nbsp;check&nbsp;the&nbsp;ordering&nbsp;for\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Raises:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TaskListError\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-8" class="other_trans">successor</span>&nbsp;in&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">task</span>.successors</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14" class="ref_node">successor&nbsp;&rarr;&nbsp;task&nbsp;</span>.phase</span><span id="ast-15" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-16"><span id="ast-17" class="other_trans">successor</span>.phase</span>)</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22">"The&nbsp;task&nbsp;{task}&nbsp;is&nbsp;specified&nbsp;as&nbsp;running&nbsp;before&nbsp;{other},&nbsp;but&nbsp;its&nbsp;phase&nbsp;'{phase}'&nbsp;lies&nbsp;after&nbsp;the&nbsp;phase&nbsp;'{other_phase}'"</span>.format</span>(task=<span id="ast-24" class="other_trans">task</span>,&nbsp;other=<span id="ast-26" class="other_trans">successor</span>,&nbsp;phase=<span id="ast-28"><span id="ast-29" class="other_trans">task</span>.phase</span>,&nbsp;other_phase=<span id="ast-31"><span id="ast-32" class="other_trans">successor</span>.phase</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-34"><span id="ast-35">TaskListError</span>(<span id="ast-36" class="other_trans">msg</span>)</span></span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-38" class="other_trans">predecessor</span>&nbsp;in&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">task</span>.predecessors</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44" class="other_trans">task</span>.phase</span><span id="ast-45" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-46"><span id="ast-47" class="other_trans">predecessor</span>.phase</span>)</span>:<span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52">"The&nbsp;task&nbsp;{task}&nbsp;is&nbsp;specified&nbsp;as&nbsp;running&nbsp;after&nbsp;{other},&nbsp;but&nbsp;its&nbsp;phase&nbsp;'{phase}'&nbsp;lies&nbsp;before&nbsp;the&nbsp;phase&nbsp;'{other_phase}'"</span>.format</span>(task=<span id="ast-54" class="other_trans">task</span>,&nbsp;other=<span id="ast-56" class="other_trans">predecessor</span>,&nbsp;phase=<span id="ast-58"><span id="ast-59" class="other_trans">task</span>.phase</span>,&nbsp;other_phase=<span id="ast-61"><span id="ast-62" class="other_trans">predecessor</span>.phase</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">TaskListError</span>(<span id="ast-66" class="other_trans">msg</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;should_release_pokemon(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">pokemon</span>,&nbsp;<span id="ast-5">keep_best_mode</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>release_config</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>._get_release_config_for</span>(<span id="ast-12"><span id="ast-13">pokemon</span>.name</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-17" class="other_trans">keep_best_mode</span>&nbsp;and&nbsp;<span id="ast-18">(<span id="ast-19">not</span>&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22">release_config</span>.has_key</span>(<span id="ast-23">'never_release'</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-24">(<span id="ast-25">not</span>&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">release_config</span>.has_key</span>(<span id="ast-29">'always_release'</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-30">(<span id="ast-31">not</span>&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34">release_config</span>.has_key</span>(<span id="ast-35">'release_below_cp'</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-36">(<span id="ast-37">not</span>&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans">release_config</span>.has_key</span>(<span id="ast-41">'release_below_iv'</span>)</span>)</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-43">True</span></span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cp_iv_logic</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48">release_config</span>.get</span>(<span id="ast-49">'logic'</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52">not</span>&nbsp;<span id="ast-53">cp_iv_logic</span>)</span>:<span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cp_iv_logic</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>._get_release_config_for</span>(<span id="ast-61">'any'</span>)</span>.get</span>(<span id="ast-62">'logic'</span>,&nbsp;<span id="ast-63">'and'</span>)</span></span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>release_results</span>&nbsp;=&nbsp;<span id="ast-66">{<span id="ast-67">'cp'</span>:&nbsp;<span id="ast-69">False</span>,&nbsp;<span id="ast-68">'iv'</span>:&nbsp;<span id="ast-70">False</span>}</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans">release_config</span>.get</span>(<span id="ast-75">'never_release'</span>,&nbsp;<span id="ast-76">False</span>)</span>:<span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-78">False</span></span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">release_config</span>.get</span>(<span id="ast-83">'always_release'</span>,&nbsp;<span id="ast-84">False</span>)</span>:<span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-86">True</span></span></span><span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>release_cp</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans">release_config</span>.get</span>(<span id="ast-92">'release_below_cp'</span>,&nbsp;<span id="ast-93">0</span>)</span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95">(<span id="ast-96"><span id="ast-97">pokemon</span>.cp</span><span id="ast-98" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-99" class="other_trans">release_cp</span>)</span>:<span id="ast-100"><span id="ast-101"><span id="ast-102" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>release_results</span>[<span id="ast-103"><span id="ast-104">'cp'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-105">True</span></span></span><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>release_iv</span>&nbsp;=&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110" class="other_trans">release_config</span>.get</span>(<span id="ast-111">'release_below_iv'</span>,&nbsp;<span id="ast-112">0</span>)</span></span><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-114">(<span id="ast-115"><span id="ast-116">pokemon</span>.iv</span><span id="ast-117" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-118">release_iv</span>)</span>:<span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>release_results</span>[<span id="ast-122"><span id="ast-123">'iv'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-124">True</span></span></span><span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>logic_to_function</span>&nbsp;=&nbsp;<span id="ast-127">{<span id="ast-128">'or'</span>:&nbsp;<span id="ast-130">lambda&nbsp;<span id="ast-131"><span id="ast-132" class="other_trans">x</span>,&nbsp;<span id="ast-133" class="other_trans">y</span></span>:&nbsp;<span id="ast-134">(<span id="ast-136" class="other_trans">x</span>&nbsp;or&nbsp;<span id="ast-137">y</span>)</span></span>,&nbsp;<span id="ast-129">'and'</span>:&nbsp;<span id="ast-138">lambda&nbsp;<span id="ast-139"><span id="ast-140" class="other_trans">x</span>,&nbsp;<span id="ast-141">y</span></span>:&nbsp;<span id="ast-142">(<span id="ast-144" class="other_trans">x</span>&nbsp;and&nbsp;<span id="ast-145" class="other_trans">y</span>)</span></span>}</span></span><span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-147"><span id="ast-148"><span id="ast-149">logic_to_function</span>[<span id="ast-150"><span id="ast-151" class="other_trans">cp_iv_logic</span></span>]</span>(*<span id="ast-152"><span id="ast-153"><span id="ast-154" class="other_trans">release_results</span>.values</span>()</span>)</span>:<span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-159">'future_pokemon_release'</span>,&nbsp;formatted=<span id="ast-161"><span id="ast-162"><span id="ast-163">'*Releasing&nbsp;{}*&nbsp;CP:&nbsp;{},&nbsp;IV:&nbsp;{}&nbsp;|&nbsp;based&nbsp;on&nbsp;rule:&nbsp;CP&nbsp;&lt;&nbsp;{}&nbsp;{}&nbsp;IV&nbsp;&lt;&nbsp;{}'</span>.format</span>(<span id="ast-164"><span id="ast-165">pokemon</span>.name</span>,&nbsp;<span id="ast-166"><span id="ast-167" class="other_trans">pokemon</span>.cp</span>,&nbsp;<span id="ast-168"><span id="ast-169" class="other_trans">pokemon</span>.iv</span>,&nbsp;<span id="ast-170">release_cp</span>,&nbsp;<span id="ast-171"><span id="ast-172"><span id="ast-173" class="other_trans">cp_iv_logic</span>.upper</span>()</span>,&nbsp;<span id="ast-174" class="ref_node">release_cp&nbsp;&rarr;&nbsp;release_iv&nbsp;</span>)</span>,&nbsp;data=<span id="ast-176">{<span id="ast-177">'pokemon'</span>:&nbsp;<span id="ast-183"><span id="ast-184" class="other_trans">pokemon</span>.name</span>,&nbsp;<span id="ast-178">'cp'</span>:&nbsp;<span id="ast-185"><span id="ast-186">pokemon</span>.cp</span>,&nbsp;<span id="ast-179">'iv'</span>:&nbsp;<span id="ast-187"><span id="ast-188" class="other_trans">pokemon</span>.iv</span>,&nbsp;<span id="ast-180">'below_cp'</span>:&nbsp;<span id="ast-189" class="other_trans">release_cp</span>,&nbsp;<span id="ast-181">'cp_iv_logic'</span>:&nbsp;<span id="ast-190"><span id="ast-191"><span id="ast-192" class="other_trans">cp_iv_logic</span>.upper</span>()</span>,&nbsp;<span id="ast-182">'below_iv'</span>:&nbsp;<span id="ast-193" class="other_trans">release_iv</span>}</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;normalize_label(<span id="ast-2"><span id="ast-3" class="other_trans">value</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">str</span>(<span id="ast-14" class="other_trans">value</span>)</span>.lower</span>()</span>.replace</span>(<span id="ast-15">'_'</span>,&nbsp;<span id="ast-16">'&nbsp;'</span>)</span>.strip</span>()</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">re</span>.search</span>(<span id="ast-21">'&lt;!--'</span>,&nbsp;<span id="ast-22" class="other_trans">value</span>)</span>:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">mwp</span>.parse</span>(<span id="ast-28" class="other_trans">value</span>)</span></span><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>.remove</span>(<span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans">value</span>.filter_comments</span>()</span>)</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">str</span>(<span id="ast-42" class="correct_node">label&nbsp;&rarr;&nbsp;value&nbsp;</span>)</span>.strip</span>()</span></span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-44">(<span id="ast-45" class="other_trans">label</span>,&nbsp;<span id="ast-46" class="other_trans">regex</span>)</span>&nbsp;in&nbsp;<span id="ast-47" class="other_trans">LABEL_MATCHES</span>:<span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">regex</span>.match</span>(<span id="ast-52" class="other_trans">value</span>)</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-54" class="other_trans">label</span></span></span></span></span></span></span><br /><br /><hr />
</body></html>
