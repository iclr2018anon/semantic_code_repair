<html><head><style>
.ast { font-family: monospace; font-size: 12pt; }
.correct_node { font-weight: bold; background-color: green; color: white; }
.incorrect_node { font-weight: bold; background-color: red; color: white; }
.ref_node { font-weight: bold; background-color: blue; color: white; }
.location_node { font-weight: bold; background-color: #ff00ff; color: white; }
.other_trans { color: #3333ff; }
.whitespace { background-color: white; color: black; }
.pred_rank_wrapper { font-weight: bold; }
.correct_pred_rank { font-weight: bold; color: green;}
.incorrect_pred_rank { font-weight: bold; color: red; }
.rank_type { font-weight: bold; }
.description { font-size: 16pt; }
</style></head><body><div class="description">
<div><b>This is part 8/10 of the system predictions for the Real-Bug Test set. This system achieves 41% Repair Accuracy and 54% Location Accuracy.</b></div><br /><div><b>Annotations</b>:</div><ul><li><span class="correct_node">foo &rarr; bar</span> - The bug was located at this node, and the system <i>correctly</i> predicted both the location and the repair as its top prediction.</li><li><span class="incorrect_node">foo &rarr; bar</span> - The system <i>incorrectly</i> predicted this repair as its top prediction.</li><li><span class="ref_node">foo &rarr; bar</span> - If the system incorrectly predicted the repair, this was the correct repair it should have made.</li><li><span class="location_node">foo &rarr; bar, pred: zap</span> - The system predicted the correct <i>location</i> of the repair, but the wrong repair label. It should have predicted 'bar', but it predicted 'zap' instead.</li></ul><div>The part before the arrow ('foo') is what the system actually saw at test time. Other candidate repair locations which the system could have chosen are marked in <span class="other_trans">this color</span>. For clarity the actual labels for those locations are not shown.</div></div><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">tiger_filepath</span>,&nbsp;<span id="ast-5" class="other_trans">name</span>,&nbsp;<span id="ast-7" class="other_trans">namespace</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Creates&nbsp;a&nbsp;directed&nbsp;graph&nbsp;that&nbsp;represents&nbsp;all&nbsp;syntax&nbsp;annotated\\u000a&nbsp;&nbsp;&nbsp;&nbsp;sentences&nbsp;in&nbsp;the&nbsp;given&nbsp;TigerXML&nbsp;file.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parameters\\u000a&nbsp;&nbsp;&nbsp;&nbsp;----------\\u000a&nbsp;&nbsp;&nbsp;&nbsp;tiger_filepath&nbsp;:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;absolute&nbsp;or&nbsp;relative&nbsp;path&nbsp;to&nbsp;the&nbsp;TigerXML&nbsp;file&nbsp;to&nbsp;be&nbsp;parsed\\u000a&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;:&nbsp;str&nbsp;or&nbsp;None\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;name&nbsp;or&nbsp;ID&nbsp;of&nbsp;the&nbsp;graph&nbsp;to&nbsp;be&nbsp;generated.&nbsp;If&nbsp;no&nbsp;name&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;given,&nbsp;the&nbsp;basename&nbsp;of&nbsp;the&nbsp;input&nbsp;file&nbsp;is&nbsp;used.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;namespace&nbsp;:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;namespace&nbsp;of&nbsp;the&nbsp;graph&nbsp;(default:&nbsp;tiger)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-16" class="other_trans">TigerDocumentGraph</span>,&nbsp;<span id="ast-17">self</span>)</span>.__init__</span>()</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>utf8_parser</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">etree</span>.XMLParser</span>(encoding=<span id="ast-24">'utf-8'</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tigerxml_tree</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">etree</span>.parse</span>(<span id="ast-30" class="other_trans">tiger_filepath</span>,&nbsp;<span id="ast-31" class="other_trans">utf8_parser</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tigerxml_root</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">tigerxml_tree</span>.getroot</span>()</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">name</span><span id="ast-40" class="ref_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-41" class="other_trans">None</span>)</span>:<span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.name</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">os</span>.path</span>.basename</span>(<span id="ast-49" class="incorrect_node">tiger_filepath&nbsp;&rarr;&nbsp;name&nbsp;</span>)</span></span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ns</span>&nbsp;=&nbsp;<span id="ast-53" class="other_trans">namespace</span></span><span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.corpus_id</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans">tigerxml_root</span>.attrib</span>[<span id="ast-60"><span id="ast-61">'id'</span></span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;setup_working_dir(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tmpdir</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">tempfile</span>.mkdtemp</span>()</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>monoroot</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-15" class="other_trans">tmpdir</span>,&nbsp;<span id="ast-16">'PKGROOT'</span>,&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.MONO_ROOT</span>[<span id="ast-20"><span id="ast-21">1</span>:</span>]</span>)</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>versions</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27">os</span>.path</span>.join</span>(<span id="ast-28" class="other_trans">monoroot</span>,&nbsp;<span id="ast-29">'Versions'</span>)</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pcl_assemblies</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35">os</span>.path</span>.join</span>(<span id="ast-36" class="other_trans">monoroot</span>,&nbsp;<span id="ast-37">'External'</span>,&nbsp;<span id="ast-38">'xbuild-frameworks'</span>,&nbsp;<span id="ast-39">'.NETPortable'</span>)</span></span><span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.makedirs</span>(<span id="ast-44" class="other_trans">versions</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.makedirs</span>(<span id="ast-49" class="other_trans">pcl_assemblies</span>)</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-51">(<span id="ast-52">'setup_working_dir&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-54">tmpdir</span>)</span></span><span id="ast-55"><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>backtick</span>(<span id="ast-58">(<span id="ast-59">'rsync&nbsp;-aP&nbsp;%s/*&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-61">(<span id="ast-62"><span id="ast-63">self</span>.packaging_dir</span>,&nbsp;<span id="ast-64" class="other_trans">tmpdir</span>)</span>)</span>)</span></span><span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parameter_map</span>&nbsp;=&nbsp;<span id="ast-67">{<span id="ast-68">'@@MONO_VERSION@@'</span>:&nbsp;<span id="ast-76"><span id="ast-77">self</span>.RELEASE_VERSION</span>,&nbsp;<span id="ast-69">'@@MONO_RELEASE@@'</span>:&nbsp;<span id="ast-78"><span id="ast-79">self</span>.BUILD_NUMBER</span>,&nbsp;<span id="ast-70">'@@MONO_VERSION_RELEASE@@'</span>:&nbsp;<span id="ast-80">(<span id="ast-81">(<span id="ast-82"><span id="ast-83">self</span>.RELEASE_VERSION</span>&nbsp;+&nbsp;<span id="ast-85">'_'</span>)</span>&nbsp;+&nbsp;<span id="ast-87"><span id="ast-88">self</span>.BUILD_NUMBER</span>)</span>,&nbsp;<span id="ast-71">'@@MONO_PACKAGE_GUID@@'</span>:&nbsp;<span id="ast-89"><span id="ast-90">self</span>.MRE_GUID</span>,&nbsp;<span id="ast-72">'@@MONO_CSDK_GUID@@'</span>:&nbsp;<span id="ast-91"><span id="ast-92">self</span>.MDK_GUID</span>,&nbsp;<span id="ast-73">'@@MONO_VERSION_RELEASE_INT@@'</span>:&nbsp;<span id="ast-93"><span id="ast-94">self</span>.updateid</span>,&nbsp;<span id="ast-74">'@@PACKAGES@@'</span>:&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97">string</span>.join</span>(<span id="ast-98"><span id="ast-99">set</span>(<span id="ast-100">[<span id="ast-101" class="other_trans">root</span><span id="ast-102">&nbsp;for&nbsp;<span id="ast-103">(<span id="ast-104" class="other_trans">root</span>,&nbsp;<span id="ast-105" class="other_trans">ext</span>)</span>&nbsp;in&nbsp;<span id="ast-106"><span id="ast-107">map</span>(<span id="ast-108"><span id="ast-109"><span id="ast-110" class="other_trans">os</span>.path</span>.splitext</span>,&nbsp;<span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans">os</span>.listdir</span>(<span id="ast-114"><span id="ast-115">self</span>.build_root</span>)</span>)</span></span>]</span>)</span>,&nbsp;<span id="ast-116">'\\\\\\u000a'</span>)</span>,&nbsp;<span id="ast-75">'@@DEP_PACKAGES@@'</span>:&nbsp;<span id="ast-117">''</span>}</span></span><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-119">(<span id="ast-120" class="other_trans">dirpath</span>,&nbsp;<span id="ast-121">d</span>,&nbsp;<span id="ast-122" class="other_trans">files</span>)</span>&nbsp;in&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125">os</span>.walk</span>(<span id="ast-126" class="other_trans">tmpdir</span>)</span>:<span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-128" class="other_trans">name</span>&nbsp;in&nbsp;<span id="ast-129" class="other_trans">files</span>:<span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-131">(<span id="ast-132">not</span>&nbsp;<span id="ast-133"><span id="ast-134"><span id="ast-135" class="other_trans">name</span>.startswith</span>(<span id="ast-136">'.'</span>)</span>)</span>:<span id="ast-137"><span id="ast-138"><span id="ast-139" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>replace_in_file&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-144" class="other_trans">dirpath</span>,&nbsp;<span id="ast-145" class="other_trans">name</span>)</span>,&nbsp;<span id="ast-146">parameter_map</span>)</span></span></span></span></span><span id="ast-147"><span id="ast-148"><span id="ast-149"><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.make_package_symlinks</span>(<span id="ast-151" class="other_trans">monoroot</span>)</span></span><span id="ast-152"><span id="ast-153"><span id="ast-154" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>backtick</span>(<span id="ast-155">(<span id="ast-156">'rsync&nbsp;-aP&nbsp;"%s"&nbsp;"%s"'</span>&nbsp;%&nbsp;<span id="ast-158">(<span id="ast-159"><span id="ast-160">self</span>.release_root</span>,&nbsp;<span id="ast-161" class="other_trans">versions</span>)</span>)</span>)</span></span><span id="ast-162"><span id="ast-163" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pcl_root</span>&nbsp;=&nbsp;<span id="ast-164"><span id="ast-165"><span id="ast-166"><span id="ast-167">os</span>.path</span>.join</span>(<span id="ast-168"><span id="ast-169">self</span>.MONO_ROOT</span>,&nbsp;<span id="ast-170">'External'</span>,&nbsp;<span id="ast-171">'xbuild-frameworks'</span>,&nbsp;<span id="ast-172">'.NETPortable'</span>)</span></span><span id="ast-173"><span id="ast-174"><span id="ast-175" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>backtick</span>(<span id="ast-176">(<span id="ast-177">'rsync&nbsp;-aP&nbsp;"%s"&nbsp;"%s"'</span>&nbsp;%&nbsp;<span id="ast-179">(<span id="ast-180">pcl_root</span>,&nbsp;<span id="ast-181" class="ref_node">versions&nbsp;&rarr;&nbsp;pcl_assemblies&nbsp;</span>)</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">filepath</span>,&nbsp;<span id="ast-5" class="other_trans">channel</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Constructs&nbsp;a&nbsp;ProcedureWorker&nbsp;to&nbsp;perform&nbsp;the&nbsp;Procedure&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;defined&nbsp;in&nbsp;the&nbsp;file&nbsp;at&nbsp;the&nbsp;filepath\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">Results</span>.load</span>(<span id="ast-14" class="other_trans">filepath</span>)</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.procedure</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19" class="ref_node">results&nbsp;&rarr;&nbsp;self.&nbsp;</span>.procedure</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.procedure</span>.status</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25" class="incorrect_node">Procedure&nbsp;&rarr;&nbsp;self.&nbsp;</span>.QUEUED</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;ec2_tags(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>boto_version</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6" class="other_trans">StrictVersion</span>(<span id="ast-7"><span id="ast-8">boto</span>.__version__</span>)</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>required_boto_version</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12">StrictVersion</span>(<span id="ast-13">'2.8.0'</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16">boto_version</span><span id="ast-17" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-18" class="other_trans">required_boto_version</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-23">"Installed&nbsp;boto&nbsp;version&nbsp;%s&nbsp;&lt;&nbsp;%s,&nbsp;can't&nbsp;find&nbsp;ec2_tags"</span>,&nbsp;<span id="ast-24">boto_version</span>,&nbsp;<span id="ast-25" class="other_trans">required_boto_version</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-27">None</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30">not</span>&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">_on_ec2</span>()</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.info</span>(<span id="ast-37">'Not&nbsp;an&nbsp;EC2&nbsp;instance,&nbsp;skipping'</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-39" class="other_trans">None</span></span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-42" class="other_trans">instance_id</span>,&nbsp;<span id="ast-43" class="other_trans">region</span>)</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45">_get_instance_info</span>()</span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>credentials</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">_get_credentials</span>()</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52">not</span>&nbsp;<span id="ast-53">(<span id="ast-55"><span id="ast-56" class="other_trans">credentials</span>[<span id="ast-57"><span id="ast-58">'access_key'</span></span>]</span>&nbsp;and&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">credentials</span>[<span id="ast-61"><span id="ast-62">'secret_key'</span></span>]</span>)</span>)</span>:<span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-67">'No&nbsp;AWS&nbsp;credentials&nbsp;found,&nbsp;see&nbsp;documentation&nbsp;for&nbsp;how&nbsp;to&nbsp;provide&nbsp;them.'</span>)</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-69" class="other_trans">None</span></span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>conn</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">boto</span>.ec2</span>.connect_to_region</span>(<span id="ast-77" class="other_trans">region</span>,&nbsp;aws_access_key_id=<span id="ast-79"><span id="ast-80" class="other_trans">credentials</span>[<span id="ast-81"><span id="ast-82">'access_key'</span></span>]</span>,&nbsp;aws_secret_access_key=<span id="ast-84"><span id="ast-85" class="other_trans">credentials</span>[<span id="ast-86"><span id="ast-87">'secret_key'</span></span>]</span>)</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-89">Exception</span>&nbsp;as&nbsp;<span id="ast-90">e</span>:<span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-95">'Could&nbsp;not&nbsp;get&nbsp;AWS&nbsp;connection:&nbsp;%s'</span>,&nbsp;<span id="ast-96">e</span>)</span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-98" class="other_trans">None</span></span></span></span><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ec2_tags</span>&nbsp;=&nbsp;<span id="ast-101">{}</span></span><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tags</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans">conn</span>.get_all_tags</span>(filters=<span id="ast-109">{<span id="ast-110">'resource-type'</span>:&nbsp;<span id="ast-112">'instance'</span>,&nbsp;<span id="ast-111">'resource-id'</span>:&nbsp;<span id="ast-113" class="other_trans">instance_id</span>}</span>)</span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-115" class="other_trans">tag</span>&nbsp;in&nbsp;<span id="ast-116" class="other_trans">tags</span>:<span id="ast-117"><span id="ast-118"><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ec2_tags</span>[<span id="ast-120"><span id="ast-121"><span id="ast-122" class="other_trans">tag</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-123"><span id="ast-124">tag</span>.value</span></span></span><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-126">Exception</span>&nbsp;as&nbsp;<span id="ast-127">e</span>:<span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-132">"Couldn't&nbsp;retrieve&nbsp;instance&nbsp;tags:&nbsp;%s"</span>,&nbsp;<span id="ast-133" class="other_trans">e</span>)</span></span><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-135">None</span></span></span></span><span id="ast-136"><span id="ast-137" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>&nbsp;=&nbsp;<span id="ast-138"><span id="ast-139">dict</span>(ec2_tags=<span id="ast-141">ec2_tags</span>)</span></span><span id="ast-142"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-143">(<span id="ast-144">'Roles'</span><span id="ast-145">&nbsp;in&nbsp;</span><span id="ast-146" class="other_trans">ec2_tags</span>)</span>:<span id="ast-147"><span id="ast-148"><span id="ast-149" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ret</span>[<span id="ast-150"><span id="ast-151">'ec2_roles'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-152"><span id="ast-153"><span id="ast-154"><span id="ast-155" class="ref_node">tags&nbsp;&rarr;&nbsp;ec2_tags&nbsp;</span>[<span id="ast-156"><span id="ast-157">'Roles'</span></span>]</span>.split</span>(<span id="ast-158">','</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;random_account(<span id="ast-2"><span id="ast-3">username</span>,&nbsp;<span id="ast-5" class="other_trans">password</span>,&nbsp;<span id="ast-7" class="other_trans">email</span>,&nbsp;<span id="ast-9" class="other_trans">birthday</span>,&nbsp;<span id="ast-11">email_tag</span></span>):<span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try_username</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-20"><span id="ast-21">_random_string</span>()</span>&nbsp;if&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">username</span><span id="ast-18" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-19">None</span>)</span>&nbsp;else&nbsp;<span id="ast-22"><span id="ast-23">str</span>(<span id="ast-24">username</span>)</span></span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>password</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-32"><span id="ast-33">_random_string</span>()</span>&nbsp;if&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">password</span><span id="ast-30" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-31">None</span>)</span>&nbsp;else&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">str</span>(<span id="ast-36" class="other_trans">password</span>)</span></span></span><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try_email</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-44"><span id="ast-45">_random_email</span>()</span>&nbsp;if&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">email</span><span id="ast-42" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-43">None</span>)</span>&nbsp;else&nbsp;<span id="ast-46"><span id="ast-47">str</span>(<span id="ast-48" class="other_trans">email</span>)</span></span></span><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try_birthday</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-56"><span id="ast-57">_random_birthday</span>()</span>&nbsp;if&nbsp;<span id="ast-52">(<span id="ast-53">birthday</span><span id="ast-54" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-55">None</span>)</span>&nbsp;else&nbsp;<span id="ast-58"><span id="ast-59">str</span>(<span id="ast-60" class="other_trans">birthday</span>)</span></span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-63">(<span id="ast-64"><span id="ast-65">len</span>(<span id="ast-66" class="other_trans">try_email</span>)</span><span id="ast-67" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-68">75</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70">(<span id="ast-72">(<span id="ast-73"><span id="ast-74">len</span>(<span id="ast-75">try_email</span>)</span><span id="ast-76" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-77">73</span>)</span>&nbsp;and&nbsp;<span id="ast-78">email_tag</span>)</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-80">AssertionError</span></span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-82" class="other_trans">AssertionError</span>:<span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-84"><span id="ast-85">PTCInvalidNameException</span>(<span id="ast-86">'Email&nbsp;is&nbsp;too&nbsp;long!'</span>)</span></span></span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-88">(<span id="ast-89">birthday</span><span id="ast-90" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-91">None</span>)</span>:<span id="ast-92"><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_validate_birthday</span>(<span id="ast-95" class="other_trans">try_birthday</span>)</span></span></span><span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>account_created</span>&nbsp;=&nbsp;<span id="ast-98">False</span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-100">(<span id="ast-101">not</span>&nbsp;<span id="ast-102" class="other_trans">account_created</span>)</span>:<span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-104" class="other_trans">email_tag</span>:<span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>use_email</span>&nbsp;=&nbsp;<span id="ast-107"><span id="ast-108">tag_email</span>(<span id="ast-109" class="other_trans">try_email</span>,&nbsp;<span id="ast-110" class="other_trans">try_username</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-111"><span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>use_email</span>&nbsp;=&nbsp;<span id="ast-113">try_email</span></span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-115"><span id="ast-116" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>account_created&nbsp;&rarr;&nbsp;use_email&nbsp;</span>&nbsp;=&nbsp;<span id="ast-117"><span id="ast-118" class="other_trans">create_account</span>(<span id="ast-119">try_username</span>,&nbsp;<span id="ast-120" class="other_trans">password</span>,&nbsp;<span id="ast-121" class="other_trans">use_email</span>,&nbsp;<span id="ast-122" class="other_trans">try_birthday</span>)</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-124">PTCInvalidNameException</span>:<span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-126">(<span id="ast-127" class="other_trans">username</span><span id="ast-128" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-129" class="other_trans">None</span>)</span>:<span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try_username</span>&nbsp;=&nbsp;<span id="ast-132"><span id="ast-133">_random_string</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span></span><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-136" class="other_trans">PTCInvalidEmailException</span>:<span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-138">(<span id="ast-139" class="other_trans">email</span><span id="ast-140" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-141">None</span>)</span>:<span id="ast-142"><span id="ast-143" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try_email</span>&nbsp;=&nbsp;<span id="ast-144"><span id="ast-145">_random_email</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span></span></span></span><span id="ast-147"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-148">{<span id="ast-149">'username'</span>:&nbsp;<span id="ast-152" class="other_trans">try_username</span>,&nbsp;<span id="ast-150">'password'</span>:&nbsp;<span id="ast-153">password</span>,&nbsp;<span id="ast-151">'email'</span>:&nbsp;<span id="ast-154" class="ref_node">try_email&nbsp;&rarr;&nbsp;use_email&nbsp;</span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;enqueue_messages(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">messages</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Put&nbsp;a&nbsp;set&nbsp;of&nbsp;messages&nbsp;into&nbsp;the&nbsp;internal&nbsp;message&nbsp;queue\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;messages:&nbsp;The&nbsp;messages&nbsp;to&nbsp;enqueue\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;messages:&nbsp;Iterable&nbsp;of&nbsp;:class:`pykafka.common.Message`\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-8" class="other_trans">message</span>&nbsp;in&nbsp;<span id="ast-9" class="other_trans">messages</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13" class="other_trans">message</span>.offset</span><span id="ast-14" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-15"><span id="ast-16">self</span>.last_offset_consumed</span>)</span>:<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-21">'Skipping&nbsp;enqueue&nbsp;for&nbsp;offset&nbsp;(%s)&nbsp;less&nbsp;than&nbsp;last_offset_consumed&nbsp;(%s)'</span>,&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">message</span>.offset</span>,&nbsp;<span id="ast-24"><span id="ast-25">self</span>.last_offset_consumed</span>)</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.partition</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31">self</span>.partition</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34"><span id="ast-35" class="other_trans">message</span>.partition_id</span><span id="ast-36" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-37"><span id="ast-38"><span id="ast-39">self</span>.partition</span>.id</span>)</span>:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-44">'Partition&nbsp;%s&nbsp;enqueued&nbsp;a&nbsp;message&nbsp;meant&nbsp;for&nbsp;partition&nbsp;%s'</span>,&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>.partition</span>.id</span>,&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">message</span>.partition_id</span>)</span></span></span><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>.partition_id</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">self</span>.partition</span>.id</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._messages</span>.put</span>(<span id="ast-61" class="other_trans">message</span>)</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.next_offset</span>&nbsp;=&nbsp;<span id="ast-65">(<span id="ast-66"><span id="ast-67" class="other_trans">message</span>.offset</span>&nbsp;+&nbsp;<span id="ast-69">1</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;jsonrpc_getwork(<span id="ast-2"><span id="ast-3" class="other_trans">agent</span>,&nbsp;<span id="ast-4">server</span>,&nbsp;<span id="ast-5" class="other_trans">data</span>,&nbsp;<span id="ast-6" class="other_trans">j_id</span>,&nbsp;<span id="ast-7" class="other_trans">request</span>,&nbsp;<span id="ast-8" class="other_trans">bitHopper</span></span>):<span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-11">0</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>work</span>&nbsp;=&nbsp;<span id="ast-14">None</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">work</span><span id="ast-18" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-19" class="other_trans">None</span>)</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-23">1</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-27">(<span id="ast-28" class="other_trans">data</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30">[]</span>)</span>&nbsp;and&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">i</span><span id="ast-33" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-34">2</span>)</span>)</span>:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>server</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">bitHopper</span>.get_new_server</span>(<span id="ast-40" class="other_trans">server</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-42">(<span id="ast-43" class="other_trans">i</span><span id="ast-44" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-45">1</span>)</span>:<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bitHopper</span>.get_new_server</span>(<span id="ast-50" class="other_trans">server</span>)</span></span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-54" class="other_trans">i</span><span id="ast-55" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-56">1</span>)</span>:<span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">sleep</span>(<span id="ast-61">1</span>,&nbsp;<span id="ast-62" class="other_trans">bitHopper</span>)</span></span></span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67">bitHopper</span>.request_store</span>.closed</span>(<span id="ast-68" class="other_trans">request</span>)</span>:<span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>work</span>&nbsp;=&nbsp;<span id="ast-72">yield&nbsp;<span id="ast-73"><span id="ast-74">jsonrpc_call</span>(<span id="ast-75" class="other_trans">agent</span>,&nbsp;<span id="ast-76" class="other_trans">server</span>,&nbsp;<span id="ast-77" class="other_trans">data</span>,&nbsp;<span id="ast-78" class="other_trans">bitHopper</span>)</span></span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-80">Exception</span>&nbsp;as&nbsp;<span id="ast-81" class="other_trans">e</span>:<span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bitHopper</span>.log_dbg</span>(<span id="ast-86">'caught,&nbsp;inner&nbsp;jsonrpc_call&nbsp;loop'</span>)</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bitHopper</span>.log_dbg</span>(<span id="ast-91">server</span>)</span></span><span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bitHopper</span>.log_dbg</span>(<span id="ast-96"><span id="ast-97">str</span>(<span id="ast-98" class="other_trans">e</span>)</span>)</span></span><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>work</span>&nbsp;=&nbsp;<span id="ast-101">None</span></span><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;print_result(<span id="ast-2"><span id="ast-3" class="other_trans">r</span>,&nbsp;<span id="ast-4" class="other_trans">option</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>all_functions</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">print_and_save_detail_information</span>(<span id="ast-9" class="other_trans">r</span>,&nbsp;<span id="ast-10" class="other_trans">option</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>warnings</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14">warning_filter</span>(<span id="ast-15" class="other_trans">option</span>,&nbsp;<span id="ast-16" class="other_trans">all_functions</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>warning_count</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">print_warnings</span>(<span id="ast-21" class="other_trans">option</span>,&nbsp;<span id="ast-22" class="other_trans">warnings</span>)</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print_total</span>(<span id="ast-26" class="other_trans">warning_count</span>,&nbsp;<span id="ast-27" class="other_trans">all_functions</span>,&nbsp;<span id="ast-28" class="other_trans">option</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-30" class="other_trans">extension</span>&nbsp;in&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">option</span>.extensions</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>extension</span>.print_result</span>()</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40" class="other_trans">option</span>.number</span><span id="ast-41" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-42" class="other_trans">warning_count</span>)</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-47">1</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;index(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">terms</span>,&nbsp;**kwargs</span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Index&nbsp;all&nbsp;word&nbsp;pair&nbsp;distances.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;terms:&nbsp;A&nbsp;list&nbsp;of&nbsp;terms&nbsp;to&nbsp;index.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.pairs</span>&nbsp;=&nbsp;<span id="ast-11">{}</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.terms</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-17" class="other_trans">terms</span>&nbsp;or&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22">self</span>.text</span>.terms</span>.keys</span>()</span>)</span></span><span id="ast-23"><span id="ast-24" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pairs&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26" class="other_trans">comb</span>(<span id="ast-27"><span id="ast-28" class="other_trans">len</span>(<span id="ast-29" class="ref_node">terms&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>,&nbsp;<span id="ast-30">2</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process_file(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">stream</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Processes&nbsp;the&nbsp;given&nbsp;input&nbsp;`stream`&nbsp;and&nbsp;stores&nbsp;the&nbsp;results&nbsp;in\\u000a&nbsp;&nbsp;&nbsp;&nbsp;`self.data`,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;``defaultdict(list)``'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-10">(<span id="ast-11"><span id="ast-12">self</span>.cols</span><span id="ast-13" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-14" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17">self</span>.sep</span><span id="ast-18" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-19">None</span>)</span>)</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.process_options</span>()</span></span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-26" class="other_trans">cols</span>,&nbsp;<span id="ast-27" class="other_trans">sep</span>)</span>&nbsp;=&nbsp;<span id="ast-28">(<span id="ast-29"><span id="ast-30">self</span>.cols</span>,&nbsp;<span id="ast-31"><span id="ast-32">self</span>.sep</span>)</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ncols</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">len</span>(<span id="ast-37" class="other_trans">cols</span>)</span></span><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>&nbsp;=&nbsp;<span id="ast-40">[<span id="ast-41">(<span id="ast-42">'Dataset&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-44" class="other_trans">idx</span>)</span><span id="ast-45">&nbsp;for&nbsp;<span id="ast-46">idx</span>&nbsp;in&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">xrange</span>(<span id="ast-49">ncols</span>)</span></span>]</span></span><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>[<span id="ast-53"><span id="ast-54">0</span></span>]</span>&nbsp;=&nbsp;<span id="ast-55">'__class__'</span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>seen_header</span>&nbsp;=&nbsp;<span id="ast-58">False</span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-60" class="other_trans">line</span>&nbsp;in&nbsp;<span id="ast-61">stream</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>line</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">line</span>.strip</span>()</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-68">(<span id="ast-69">not</span>&nbsp;<span id="ast-70">line</span>)</span>:<span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parts</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">line</span>.split</span>(<span id="ast-77" class="other_trans">sep</span>)</span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>int</span>(<span id="ast-82"><span id="ast-83">float</span>(<span id="ast-84"><span id="ast-85">parts</span>[<span id="ast-86"><span id="ast-87"><span id="ast-88">cols</span>[<span id="ast-89"><span id="ast-90">0</span></span>]</span></span>]</span>)</span>)</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-92">(<span id="ast-93">IndexError</span>,&nbsp;<span id="ast-94">ValueError</span>)</span>:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96" class="other_trans">seen_header</span>:<span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-98"><span id="ast-99">ValueError</span>(<span id="ast-100">'duplicate&nbsp;header&nbsp;row&nbsp;in&nbsp;input&nbsp;file'</span>)</span></span></span><span id="ast-101"><span id="ast-102" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>seen_header</span>&nbsp;=&nbsp;<span id="ast-103">True</span></span><span id="ast-104"><span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>[<span id="ast-107"><span id="ast-108">1</span>:</span>]</span>&nbsp;=&nbsp;<span id="ast-109">[<span id="ast-110"><span id="ast-111" class="other_trans">parts</span>[<span id="ast-112"><span id="ast-113">idx</span></span>]</span><span id="ast-114">&nbsp;for&nbsp;<span id="ast-115" class="other_trans">idx</span>&nbsp;in&nbsp;<span id="ast-116"><span id="ast-117" class="other_trans">cols</span>[<span id="ast-118"><span id="ast-119">1</span>:</span>]</span></span>]</span></span><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>anon_dataset_idx</span>&nbsp;=&nbsp;<span id="ast-122">1</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-124">(<span id="ast-125">idx</span>,&nbsp;<span id="ast-126" class="other_trans">header</span>)</span>&nbsp;in&nbsp;<span id="ast-127"><span id="ast-128" class="other_trans">enumerate</span>(<span id="ast-129">headers</span>)</span>:<span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-131">(<span id="ast-132">not</span>&nbsp;<span id="ast-133" class="other_trans">header</span>)</span>:<span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-135">(<span id="ast-136">(<span id="ast-137">'Dataset&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-139" class="other_trans">anon_dataset_idx</span>)</span><span id="ast-140">&nbsp;in&nbsp;</span><span id="ast-141" class="ref_node">data&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>:<span id="ast-142"><span id="ast-143" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>anon_dataset_idx</span>&nbsp;+=&nbsp;<span id="ast-145">1</span></span></span><span id="ast-146"><span id="ast-147"><span id="ast-148" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>[<span id="ast-149"><span id="ast-150">idx</span></span>]</span>&nbsp;=&nbsp;<span id="ast-151">(<span id="ast-152">'Dataset&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-154">anon_dataset_idx</span>)</span></span></span></span><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_tasks(<span id="ast-2"><span id="ast-3" class="other_trans">group_id</span>,&nbsp;<span id="ast-4">personal</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>&nbsp;=&nbsp;<span id="ast-7">{}</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9" class="other_trans">personal</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">group_id</span><span id="ast-13" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-14">'all'</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16">group</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">current_user</span>.groups</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>items</span>&nbsp;=&nbsp;<span id="ast-21">[]</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23">task</span>&nbsp;in&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">group</span>.tasks</span>:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28">current_user</span><span id="ast-29">&nbsp;in&nbsp;</span><span id="ast-30"><span id="ast-31" class="other_trans">task</span>.users</span>)</span>:<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>items</span>.append</span>(<span id="ast-36" class="other_trans">task</span>)</span></span></span></span><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">group</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-43" class="other_trans">items</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>query</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans">Task</span>.query</span>.filter</span>(<span id="ast-50">(<span id="ast-51"><span id="ast-52">Task</span>.group_id</span><span id="ast-53" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-54">group_id</span>)</span>)</span></span><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65">Group</span>.query</span>.filter</span>(<span id="ast-66">(<span id="ast-67"><span id="ast-68">Group</span>.id</span><span id="ast-69" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-70" class="other_trans">group_id</span>)</span>)</span>.first</span>()</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72"><span id="ast-73">query</span>.all</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-75">(<span id="ast-76" class="other_trans">group_id</span><span id="ast-77" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-78">'all'</span>)</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-80" class="other_trans">group</span>&nbsp;in&nbsp;<span id="ast-81"><span id="ast-82" class="other_trans">current_user</span>.groups</span>:<span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans">group</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90" class="other_trans">group</span>.tasks</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>query</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96">Task</span>.query</span>.filter</span>(<span id="ast-97">(<span id="ast-98"><span id="ast-99" class="other_trans">Task</span>.group_id</span><span id="ast-100" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-101" class="other_trans">group_id</span>)</span>)</span></span><span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112">Group</span>.query</span>.filter</span>(<span id="ast-113">(<span id="ast-114"><span id="ast-115" class="other_trans">Group</span>.id</span><span id="ast-116" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-117" class="other_trans">group_id</span>)</span>)</span>.first</span>()</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-118"><span id="ast-119"><span id="ast-120">query</span>.all</span>()</span></span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-122" class="other_trans">group_header</span>&nbsp;in&nbsp;<span id="ast-123">list_items</span>:<span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-127"><span id="ast-128">group_header</span></span>]</span>&nbsp;=&nbsp;<span id="ast-129"><span id="ast-130">filter</span>(<span id="ast-131">lambda&nbsp;<span id="ast-132"><span id="ast-133" class="other_trans">x</span></span>:&nbsp;<span id="ast-134">(<span id="ast-135"><span id="ast-136">x</span>.status</span><span id="ast-137" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-138">4</span>)</span></span>,&nbsp;<span id="ast-139"><span id="ast-140" class="other_trans">list_items</span>[<span id="ast-141"><span id="ast-142" class="other_trans">group_header</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;to_internal_value(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">data</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>.kwargs</span>[<span id="ast-9"><span id="ast-10">'many'</span></span>]</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">isinstance</span>(<span id="ast-14" class="other_trans">data</span>,&nbsp;<span id="ast-15" class="other_trans">list</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-17" class="other_trans">data</span></span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">isinstance</span>(<span id="ast-21" class="other_trans">data</span>,&nbsp;<span id="ast-22" class="other_trans">Model</span>)</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-24" class="other_trans">data</span></span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>related_model</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="correct_node">serializer&nbsp;&rarr;&nbsp;self.&nbsp;</span>.Meta</span>.model</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">related_model</span>.objects</span>.get</span>(pk=<span id="ast-36" class="other_trans">data</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse_run(<span id="ast-2"><span id="ast-3" class="other_trans">s</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">int</span>(<span id="ast-9" class="other_trans">s</span>)</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-11">ValueError</span>:<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.critical</span>(<span id="ast-16">'Error:&nbsp;Unknown&nbsp;run&nbsp;%s'</span>,&nbsp;<span id="ast-17">s</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-19">UsageError</span></span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-23">(<span id="ast-24" class="other_trans">r</span><span id="ast-25" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-26">0</span>)</span>&nbsp;or&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">r</span><span id="ast-29" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-30"><span id="ast-31" class="other_trans">len</span>(<span id="ast-32">runs</span>)</span>)</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.critical</span>(<span id="ast-37">'Error:&nbsp;Expected&nbsp;0&nbsp;&lt;=&nbsp;run&nbsp;&lt;=&nbsp;%d,&nbsp;got&nbsp;%d'</span>,&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40" class="other_trans">len</span>(<span id="ast-41" class="other_trans">runs</span>)</span>&nbsp;-&nbsp;<span id="ast-43">1</span>)</span>,&nbsp;<span id="ast-44" class="other_trans">r</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-49">1</span>)</span></span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51" class="other_trans">r</span></span></span><span id="ast-52"><span class="whitespace"><br />
</span>for&nbsp;<span id="ast-53" class="other_trans">run_item</span>&nbsp;in&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">selected_runs</span>.split</span>(<span id="ast-57">','</span>)</span>:<span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>run_item</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans">run_item</span>.strip</span>()</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65" class="other_trans">run_item</span><span id="ast-66">&nbsp;in&nbsp;</span><span id="ast-67">name_map</span>)</span>:<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run_list</span>.append</span>(<span id="ast-72"><span id="ast-73">name_map</span>[<span id="ast-74"><span id="ast-75" class="other_trans">run_item</span></span>]</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sep</span>&nbsp;=&nbsp;<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans">run_item</span>.find</span>(<span id="ast-82">'-'</span>)</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85" class="other_trans">sep</span><span id="ast-86" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-87">-1</span>)</span>:<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run_list</span>.append</span>(<span id="ast-92"><span id="ast-93">parse_run</span>(<span id="ast-94" class="other_trans">run_item</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96">(<span id="ast-97" class="other_trans">sep</span><span id="ast-98" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-99">0</span>)</span>:<span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103" class="other_trans">parse_run</span>(<span id="ast-104"><span id="ast-105" class="other_trans">run_item</span>[<span id="ast-106">:<span id="ast-107" class="other_trans">sep</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-108"><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first</span>&nbsp;=&nbsp;<span id="ast-110">0</span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112">(<span id="ast-113">(<span id="ast-114" class="other_trans">sep</span>&nbsp;+&nbsp;<span id="ast-116">1</span>)</span><span id="ast-117" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-118"><span id="ast-119">len</span>(<span id="ast-120">run_item</span>)</span>)</span>:<span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last</span>&nbsp;=&nbsp;<span id="ast-123"><span id="ast-124">parse_run</span>(<span id="ast-125"><span id="ast-126" class="other_trans">run_item</span>[<span id="ast-127"><span id="ast-128">(<span id="ast-129" class="other_trans">sep</span>&nbsp;+&nbsp;<span id="ast-131">1</span>)</span>:</span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last</span>&nbsp;=&nbsp;<span id="ast-134">(<span id="ast-135"><span id="ast-136">len</span>(<span id="ast-137" class="other_trans">runs</span>)</span>&nbsp;-&nbsp;<span id="ast-139">1</span>)</span></span></span><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-141">(<span id="ast-142">last</span><span id="ast-143" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-144" class="other_trans">first</span>)</span>:<span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.critical</span>(<span id="ast-149">'Error:&nbsp;Last&nbsp;run&nbsp;number&nbsp;should&nbsp;be&nbsp;greater&nbsp;than&nbsp;the&nbsp;first'</span>)</span></span><span id="ast-150"><span id="ast-151"><span id="ast-152"><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-154">1</span>)</span></span></span><span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run_list</span>.extend</span>(<span id="ast-159"><span id="ast-160">irange</span>(<span id="ast-161" class="other_trans">first</span>,&nbsp;<span id="ast-162">(<span id="ast-163">last</span>&nbsp;+&nbsp;<span id="ast-165">1</span>)</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;see(<span id="ast-2"><span id="ast-3" class="other_trans">cli</span>,&nbsp;<span id="ast-4">nick</span>,&nbsp;<span id="ast-5" class="other_trans">rest</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">var</span>.PHASE</span><span id="ast-10">&nbsp;in&nbsp;</span><span id="ast-11">(<span id="ast-12">'none'</span>,&nbsp;<span id="ast-13">'join'</span>)</span>)</span>:<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.notice</span>(<span id="ast-18" class="other_trans">nick</span>,&nbsp;<span id="ast-19">'No&nbsp;game&nbsp;is&nbsp;currently&nbsp;running.'</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-22">(<span id="ast-23" class="other_trans">nick</span><span id="ast-24">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-25"><span id="ast-26"><span id="ast-27">var</span>.list_players</span>()</span>)</span>:<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.notice</span>(<span id="ast-32">nick</span>,&nbsp;<span id="ast-33">"You're&nbsp;not&nbsp;currently&nbsp;playing."</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37">not</span>&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">var</span>.is_role</span>(<span id="ast-41" class="other_trans">nick</span>,&nbsp;<span id="ast-42">'seer'</span>)</span>)</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-47">nick</span>,&nbsp;<span id="ast-48">'Only&nbsp;a&nbsp;seer&nbsp;may&nbsp;use&nbsp;this&nbsp;command'</span>)</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-51">(<span id="ast-52"><span id="ast-53">var</span>.PHASE</span><span id="ast-54" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-55">'night'</span>)</span>:<span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-60">nick</span>,&nbsp;<span id="ast-61">'You&nbsp;may&nbsp;only&nbsp;have&nbsp;visions&nbsp;at&nbsp;night.'</span>)</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65" class="other_trans">nick</span><span id="ast-66">&nbsp;in&nbsp;</span><span id="ast-67"><span id="ast-68">var</span>.SEEN</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-73">nick</span>,&nbsp;<span id="ast-74">'You&nbsp;may&nbsp;only&nbsp;have&nbsp;one&nbsp;vision&nbsp;per&nbsp;round.'</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>victim</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">re</span>.split</span>(<span id="ast-86">'&nbsp;+'</span>,&nbsp;<span id="ast-87" class="other_trans">rest</span>)</span>[<span id="ast-88"><span id="ast-89">0</span></span>]</span>.strip</span>()</span>.lower</span>()</span></span><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pl</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94">var</span>.list_players</span>()</span></span><span id="ast-95"><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pll</span>&nbsp;=&nbsp;<span id="ast-97">[<span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans">x</span>.lower</span>()</span><span id="ast-101">&nbsp;for&nbsp;<span id="ast-102">x</span>&nbsp;in&nbsp;<span id="ast-103" class="other_trans">pl</span></span>]</span></span><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-105">(<span id="ast-106">not</span>&nbsp;<span id="ast-107" class="other_trans">victim</span>)</span>:<span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-112">nick</span>,&nbsp;<span id="ast-113">'Not&nbsp;enough&nbsp;parameters'</span>)</span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-116">(<span id="ast-117" class="other_trans">victim</span><span id="ast-118">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-119" class="other_trans">pll</span>)</span>:<span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-124" class="other_trans">nick</span>,&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127">'\\\\u0002{0}\\\\u0002&nbsp;is&nbsp;currently&nbsp;not&nbsp;playing.'</span>.format</span>(<span id="ast-128">victim</span>)</span>)</span></span><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>victim</span>&nbsp;=&nbsp;<span id="ast-132"><span id="ast-133" class="other_trans">pl</span>[<span id="ast-134"><span id="ast-135"><span id="ast-136"><span id="ast-137" class="other_trans">pll</span>.index</span>(<span id="ast-138">victim</span>)</span></span>]</span></span><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-140">(<span id="ast-141" class="ref_node">nick&nbsp;&rarr;&nbsp;victim&nbsp;</span><span id="ast-142">&nbsp;in&nbsp;</span><span id="ast-143"><span id="ast-144" class="other_trans">var</span>.CURSED</span>)</span>:<span id="ast-145"><span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>role</span>&nbsp;=&nbsp;<span id="ast-147">'wolf'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-149">(<span id="ast-150"><span id="ast-151"><span id="ast-152" class="other_trans">var</span>.get_role</span>(<span id="ast-153" class="other_trans">victim</span>)</span><span id="ast-154" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-155">'traitor'</span>)</span>:<span id="ast-156"><span id="ast-157" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>role</span>&nbsp;=&nbsp;<span id="ast-158">'villager'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-159"><span id="ast-160"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>role</span>&nbsp;=&nbsp;<span id="ast-161"><span id="ast-162"><span id="ast-163" class="other_trans">var</span>.get_role</span>(<span id="ast-164" class="other_trans">victim</span>)</span></span></span><span id="ast-165"><span id="ast-166"><span id="ast-167"><span id="ast-168" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cli</span>.msg</span>(<span id="ast-169">nick</span>,&nbsp;<span id="ast-170"><span id="ast-171"><span id="ast-172">(<span id="ast-173">(<span id="ast-174">'You&nbsp;have&nbsp;a&nbsp;vision;&nbsp;in&nbsp;this&nbsp;vision,&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-176">'you&nbsp;see&nbsp;that&nbsp;\\\\u0002{0}\\\\u0002&nbsp;is&nbsp;a&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-178">'\\\\u0002{1}\\\\u0002!'</span>)</span>.format</span>(<span id="ast-179" class="other_trans">victim</span>,&nbsp;<span id="ast-180" class="other_trans">role</span>)</span>)</span></span><span id="ast-181"><span id="ast-182"><span id="ast-183"><span id="ast-184"><span id="ast-185"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>var</span>.SEEN</span>.append</span>(<span id="ast-186" class="incorrect_node">nick&nbsp;&rarr;&nbsp;victim&nbsp;</span>)</span></span><span id="ast-187"><span id="ast-188"><span id="ast-189"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>chk_nightdone</span>(<span id="ast-190" class="other_trans">cli</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans">argparse</span>.ArgumentParser</span>(description=<span id="ast-9">'run&nbsp;a&nbsp;prediction&nbsp;algorithm&nbsp;for&nbsp;recommendation&nbsp;on&nbsp;given&nbsp;folds'</span>,&nbsp;epilog=<span id="ast-11">'example:&nbsp;main.py&nbsp;-algo&nbsp;KNNBasic&nbsp;-cv&nbsp;3&nbsp;-k&nbsp;30&nbsp;-sim&nbsp;cos&nbsp;--itemBased'</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>algoChoices</span>&nbsp;=&nbsp;<span id="ast-14">{<span id="ast-15">'Random'</span>:&nbsp;<span id="ast-25">Random</span>,&nbsp;<span id="ast-16">'BaselineOnly'</span>:&nbsp;<span id="ast-26">BaselineOnly</span>,&nbsp;<span id="ast-17">'KNNBasic'</span>:&nbsp;<span id="ast-27">KNNBasic</span>,&nbsp;<span id="ast-18">'KNNBaseline'</span>:&nbsp;<span id="ast-28">KNNBaseline</span>,&nbsp;<span id="ast-19">'KNNWithMeans'</span>:&nbsp;<span id="ast-29" class="other_trans">KNNWithMeans</span>,&nbsp;<span id="ast-20">'Parall'</span>:&nbsp;<span id="ast-30" class="other_trans">Parall</span>,&nbsp;<span id="ast-21">'Pattern'</span>:&nbsp;<span id="ast-31">Pattern</span>,&nbsp;<span id="ast-22">'CloneBruteforce'</span>:&nbsp;<span id="ast-32" class="other_trans">CloneBruteforce</span>,&nbsp;<span id="ast-23">'CloneMeanDiff'</span>:&nbsp;<span id="ast-33" class="other_trans">CloneMeanDiff</span>,&nbsp;<span id="ast-24">'CloneKNNMeanDiff'</span>:&nbsp;<span id="ast-34" class="other_trans">CloneKNNMeanDiff</span>}</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-39">'-algo'</span>,&nbsp;type=<span id="ast-41" class="other_trans">str</span>,&nbsp;default=<span id="ast-43">'KNNBaseline'</span>,&nbsp;choices=<span id="ast-45" class="other_trans">algoChoices</span>,&nbsp;help=<span id="ast-47">(<span id="ast-48">(<span id="ast-49">(<span id="ast-50">'the&nbsp;prediction&nbsp;algorithm&nbsp;to&nbsp;use.&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-52">'Allowed&nbsp;values&nbsp;are&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">',&nbsp;'</span>.join</span>(<span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans">algoChoices</span>.keys</span>()</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-61">'.&nbsp;(default:&nbsp;KNNBaseline)'</span>)</span>,&nbsp;metavar=<span id="ast-63">'&lt;prediction&nbsp;algorithm&gt;'</span>)</span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>simChoices</span>&nbsp;=&nbsp;<span id="ast-66">[<span id="ast-67">'cos'</span>,&nbsp;<span id="ast-68">'pearson'</span>,&nbsp;<span id="ast-69">'MSD'</span>,&nbsp;<span id="ast-70">'MSDClone'</span>]</span></span><span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-75">'-sim'</span>,&nbsp;type=<span id="ast-77">str</span>,&nbsp;default=<span id="ast-79">'MSD'</span>,&nbsp;choices=<span id="ast-81" class="other_trans">simChoices</span>,&nbsp;help=<span id="ast-83">(<span id="ast-84">(<span id="ast-85">(<span id="ast-86">(<span id="ast-87">'for&nbsp;algorithms&nbsp;using&nbsp;a&nbsp;similarity&nbsp;measure.&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-89">'Allowed&nbsp;values&nbsp;are&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-91"><span id="ast-92"><span id="ast-93">',&nbsp;'</span>.join</span>(<span id="ast-94" class="other_trans">simChoices</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-96">'.'</span>)</span>&nbsp;+&nbsp;<span id="ast-98">'&nbsp;(default:&nbsp;MSD)'</span>)</span>,&nbsp;metavar=<span id="ast-100">'&nbsp;&lt;&nbsp;sim&nbsp;measure&nbsp;&gt;'</span>)</span></span><span id="ast-101"><span id="ast-102" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>methodChoices</span>&nbsp;=&nbsp;<span id="ast-103">[<span id="ast-104">'als'</span>,&nbsp;<span id="ast-105">'sgd'</span>]</span></span><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-110">'-method'</span>,&nbsp;type=<span id="ast-112" class="other_trans">str</span>,&nbsp;default=<span id="ast-114">'als'</span>,&nbsp;choices=<span id="ast-116" class="other_trans">methodChoices</span>,&nbsp;help=<span id="ast-118">(<span id="ast-119">(<span id="ast-120">(<span id="ast-121">'for&nbsp;algorithms&nbsp;using&nbsp;a&nbsp;baseline,&nbsp;the&nbsp;method&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-123">'to&nbsp;compute&nbsp;it.&nbsp;Allowed&nbsp;values&nbsp;are&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127">',&nbsp;'</span>.join</span>(<span id="ast-128" class="correct_node">simChoices&nbsp;&rarr;&nbsp;methodChoices&nbsp;</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-130">'.&nbsp;(default:&nbsp;als)'</span>)</span>,&nbsp;metavar=<span id="ast-132">'&lt;method&gt;'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">project_paths</span>,&nbsp;<span id="ast-6" class="other_trans">project_package</span>,&nbsp;<span id="ast-8" class="other_trans">test_settings</span>,&nbsp;<span id="ast-10" class="other_trans">strict</span>,&nbsp;<span id="ast-12" class="other_trans">restart_command</span>,&nbsp;<span id="ast-14" class="other_trans">loaddata_command</span>,&nbsp;<span id="ast-16" class="other_trans">dumpdata_command</span>,&nbsp;<span id="ast-18" class="other_trans">requirements</span>,&nbsp;<span id="ast-20" class="other_trans">local_tables_to_flush</span>,&nbsp;<span id="ast-22" class="other_trans">urls</span></span>):<span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.project_paths</span>&nbsp;=&nbsp;<span id="ast-27">(<span id="ast-29" class="other_trans">project_paths</span>&nbsp;or&nbsp;<span id="ast-30"><span id="ast-31">self</span>.project_paths</span>)</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.project_package</span>&nbsp;=&nbsp;<span id="ast-35">(<span id="ast-37" class="other_trans">project_package</span>&nbsp;or&nbsp;<span id="ast-38"><span id="ast-39">self</span>.project_package</span>)</span></span><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.test_settings</span>&nbsp;=&nbsp;<span id="ast-43">(<span id="ast-45" class="other_trans">test_settings</span>&nbsp;or&nbsp;<span id="ast-46"><span id="ast-47">self</span>.test_settings</span>)</span></span><span id="ast-48"><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.restart_command</span>&nbsp;=&nbsp;<span id="ast-51">(<span id="ast-53" class="other_trans">restart_command</span>&nbsp;or&nbsp;<span id="ast-54"><span id="ast-55">self</span>.restart_command</span>)</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.loaddata_command</span>&nbsp;=&nbsp;<span id="ast-59">(<span id="ast-61" class="other_trans">loaddata_command</span>&nbsp;or&nbsp;<span id="ast-62"><span id="ast-63">self</span>.loaddata_command</span>)</span></span><span id="ast-64"><span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.dumpdata_command</span>&nbsp;=&nbsp;<span id="ast-67">(<span id="ast-69" class="other_trans">dumpdata_command</span>&nbsp;or&nbsp;<span id="ast-70"><span id="ast-71">self</span>.dumpdata_command</span>)</span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.local_tables_to_flush</span>&nbsp;=&nbsp;<span id="ast-75">(<span id="ast-77" class="other_trans">local_tables_to_flush</span>&nbsp;or&nbsp;<span id="ast-78"><span id="ast-79">self</span>.local_tables_to_flush</span>)</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.requirements</span>&nbsp;=&nbsp;<span id="ast-83">(<span id="ast-85" class="other_trans">requirements</span>&nbsp;or&nbsp;<span id="ast-86"><span id="ast-87">self</span>.requirements</span>)</span></span><span id="ast-88"><span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.strict</span>&nbsp;=&nbsp;<span id="ast-91">(<span id="ast-93" class="other_trans">strict</span>&nbsp;or&nbsp;<span id="ast-94"><span id="ast-95">self</span>.strict</span>)</span></span><span id="ast-96"><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.urls</span>&nbsp;=&nbsp;<span id="ast-99">(<span id="ast-101" class="incorrect_node">urls&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;or&nbsp;<span id="ast-102"><span id="ast-103">self</span>.urls</span>)</span></span><span id="ast-104"><span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fab_django</span>.project</span>(<span id="ast-108" class="ref_node">project_package&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__call__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">req</span>,&nbsp;<span id="ast-5" class="other_trans">res</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Parses&nbsp;cookies&nbsp;of&nbsp;the&nbsp;header&nbsp;request&nbsp;(using&nbsp;the&nbsp;'cookie'&nbsp;header&nbsp;key)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;adds&nbsp;a&nbsp;callback&nbsp;to&nbsp;the&nbsp;'on_headerstrings'&nbsp;response&nbsp;event.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.info</span>(<span id="ast-13">(<span id="ast-14">'%d&nbsp;built&nbsp;with&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-16">(<span id="ast-17"><span id="ast-18" class="other_trans">id</span>(<span id="ast-19">self</span>)</span>,&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">json</span>.dumps</span>(<span id="ast-23" class="correct_node">opts&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span>)</span>)</span></span><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>req</span>.cookies</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28" class="other_trans">None</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-30" class="other_trans">AttributeError</span>:<span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-33"><span id="ast-34" class="other_trans">req</span>.cookies</span>,&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">res</span>.cookies</span>)</span>&nbsp;=&nbsp;<span id="ast-37">(<span id="ast-38"><span id="ast-39" class="other_trans">SimpleCookie</span>()</span>,&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">SimpleCookie</span>()</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_handle_syslog_message(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">message</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.debug</span>(<span id="ast-9">'%s&nbsp;-&nbsp;%s'</span>,&nbsp;<span id="ast-10"><span id="ast-11">self</span>.name</span>,&nbsp;<span id="ast-12">message</span>)</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>devices_attribute</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-16">'%s_devices'</span>&nbsp;%&nbsp;<span id="ast-18"><span id="ast-19">self</span>.prefix</span>)</span></span><span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>now</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23">utc_millisec</span>()</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-25">f</span>&nbsp;in&nbsp;<span id="ast-26"><span id="ast-27">self</span>.rules</span>:<span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">indicator</span>,&nbsp;<span id="ast-31" class="other_trans">value</span>,&nbsp;<span id="ast-32">device</span>)</span>&nbsp;in&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>._apply_rule</span>(<span id="ast-36">f</span>,&nbsp;<span id="ast-37" class="other_trans">message</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40" class="other_trans">indicator</span><span id="ast-41" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-42">None</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.statistics</span>[<span id="ast-48"><span id="ast-49"><span id="ast-50">f</span>[<span id="ast-51"><span id="ast-52">'metric'</span></span>]</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-54">1</span></span><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>type_</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans">value</span>.get</span>(<span id="ast-60">'type'</span>,&nbsp;<span id="ast-61">None</span>)</span></span><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63">(<span id="ast-64" class="other_trans">type_</span><span id="ast-65" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-66">None</span>)</span>:<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.error</span>(<span id="ast-71">'%s&nbsp;-&nbsp;no&nbsp;type&nbsp;for&nbsp;indicator&nbsp;%s,&nbsp;ignored'</span>,&nbsp;<span id="ast-72"><span id="ast-73">self</span>.name</span>,&nbsp;<span id="ast-74">indicator</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ikey</span>&nbsp;=&nbsp;<span id="ast-78">(<span id="ast-79">(<span id="ast-80">indicator</span>&nbsp;+&nbsp;<span id="ast-82">'\\u0000'</span>)</span>&nbsp;+&nbsp;<span id="ast-84">type_</span>)</span></span><span id="ast-85"><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90">self</span>.table</span>.get</span>(<span id="ast-91" class="other_trans">ikey</span>)</span></span><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-93">(<span id="ast-94" class="other_trans">cv</span><span id="ast-95" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-96">None</span>)</span>:<span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>&nbsp;=&nbsp;<span id="ast-99"><span id="ast-100"><span id="ast-101">copy</span>.copy</span>(<span id="ast-102"><span id="ast-103">self</span>.attributes</span>)</span></span><span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>[<span id="ast-107"><span id="ast-108">'sources'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-109">[<span id="ast-110"><span id="ast-111">self</span>.source_name</span>]</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>[<span id="ast-115"><span id="ast-116">'last_seen'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-117" class="other_trans">now</span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>[<span id="ast-121"><span id="ast-122">'first_seen'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-123" class="other_trans">now</span></span><span id="ast-124"><span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>[<span id="ast-127"><span id="ast-128" class="other_trans">devices_attribute</span></span>]</span>&nbsp;=&nbsp;<span id="ast-129">[<span id="ast-130" class="other_trans">device</span>]</span></span><span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>.update</span>(<span id="ast-135" class="other_trans">value</span>)</span></span><span id="ast-136"><span id="ast-137"><span id="ast-138" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>[<span id="ast-139"><span id="ast-140">'_age_out'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-141"><span id="ast-142"><span id="ast-143">self</span>._calc_age_out</span>(<span id="ast-144">indicator</span>,&nbsp;<span id="ast-145" class="other_trans">cv</span>)</span></span><span id="ast-146"><span id="ast-147"><span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.statistics</span>[<span id="ast-150"><span id="ast-151">'added'</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-153">1</span></span><span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.table</span>.put</span>(<span id="ast-159" class="other_trans">ikey</span>,&nbsp;<span id="ast-160" class="other_trans">cv</span>)</span></span><span id="ast-161"><span id="ast-162"><span id="ast-163"><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_update</span>(<span id="ast-165" class="other_trans">indicator</span>,&nbsp;<span id="ast-166">cv</span>)</span></span><span id="ast-167"><span id="ast-168"><span id="ast-169"><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOG</span>.debug</span>(<span id="ast-171">'%s&nbsp;-&nbsp;added&nbsp;%s&nbsp;%s'</span>,&nbsp;<span id="ast-172"><span id="ast-173">self</span>.name</span>,&nbsp;<span id="ast-174" class="other_trans">indicator</span>,&nbsp;<span id="ast-175">cv</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-176"><span id="ast-177"><span id="ast-178"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>[<span id="ast-179"><span id="ast-180">'last_seen'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-181">now</span></span><span id="ast-182"><span id="ast-183"><span id="ast-184"><span id="ast-185"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>.update</span>(<span id="ast-186">value</span>)</span></span><span id="ast-187"><span id="ast-188"><span id="ast-189"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>[<span id="ast-190"><span id="ast-191">'_age_out'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-192"><span id="ast-193"><span id="ast-194">self</span>._calc_age_out</span>(<span id="ast-195" class="other_trans">indicator</span>,&nbsp;<span id="ast-196" class="other_trans">cv</span>)</span></span><span id="ast-197"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-198">(<span id="ast-199" class="other_trans">device</span><span id="ast-200">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-201"><span id="ast-202" class="other_trans">cv</span>[<span id="ast-203"><span id="ast-204" class="other_trans">devices_attribute</span></span>]</span>)</span>:<span id="ast-205"><span id="ast-206"><span id="ast-207"><span id="ast-208"><span id="ast-209"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cv</span>[<span id="ast-210"><span id="ast-211" class="other_trans">devices_attribute</span></span>]</span>.append</span>(<span id="ast-212">device</span>)</span></span></span><span id="ast-213"><span id="ast-214"><span id="ast-215"><span id="ast-216"><span id="ast-217"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.table</span>.put</span>(<span id="ast-218">ikey</span>,&nbsp;<span id="ast-219" class="other_trans">cv</span>)</span></span><span id="ast-220"><span id="ast-221"><span id="ast-222"><span id="ast-223"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_update</span>(<span id="ast-224" class="ref_node">ikey&nbsp;&rarr;&nbsp;indicator&nbsp;</span>,&nbsp;<span id="ast-225" class="other_trans">cv</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">argv</span>,&nbsp;<span id="ast-5" class="other_trans">key</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>()</span>.__init__</span>(<span id="ast-11" class="other_trans">argv</span>)</span></span><span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">logging</span>.getLogger</span>(<span id="ast-18">(<span id="ast-19">'commotion_client.'</span>&nbsp;+&nbsp;<span id="ast-21" class="incorrect_node">__name__&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.main</span>&nbsp;=&nbsp;<span id="ast-25">False</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.statusBar</span>&nbsp;=&nbsp;<span id="ast-29">False</span></span><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.controlPanel</span>&nbsp;=&nbsp;<span id="ast-33">False</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._key</span>&nbsp;=&nbsp;<span id="ast-37" class="other_trans">key</span></span><span id="ast-38"><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sharedMemory</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans">QtCore</span>.QSharedMemory</span>(<span id="ast-44">self</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sharedMemory</span>.setKey</span>(<span id="ast-50" class="other_trans">key</span>)</span></span><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55">self</span>.sharedMemory</span>.attach</span>()</span>:<span id="ast-56"><span id="ast-57"><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._isRunning</span>&nbsp;=&nbsp;<span id="ast-59">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._isRunning</span>&nbsp;=&nbsp;<span id="ast-63">False</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-65">(<span id="ast-66">not</span>&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70">self</span>.sharedMemory</span>.create</span>(<span id="ast-71">1</span>)</span>)</span>:<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log&nbsp;&rarr;&nbsp;self.&nbsp;</span>.info</span>(<span id="ast-76"><span id="ast-77"><span id="ast-78">self</span>.translate</span>(<span id="ast-79">'logs'</span>,&nbsp;<span id="ast-80">'Application&nbsp;shared&nbsp;memory&nbsp;already&nbsp;exists.'</span>)</span>)</span></span><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">RuntimeError</span>(<span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87">self</span>.sharedMemory</span>.errorString</span>()</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;perform(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">quiet</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">dialog</span>.Dialog</span>()</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12" class="other_trans">quiet</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14"><span id="ast-15">self</span>.successURL</span>:<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>.infobox</span>(<span id="ast-20"><span id="ast-21"><span id="ast-22">self</span>.get_display_string</span>()</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>.poll</span>(<span id="ast-27">10</span>,&nbsp;<span id="ast-28" class="other_trans">quiet</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-31" class="other_trans">exit</span>,&nbsp;<span id="ast-32"><span id="ast-33">self</span>.token</span>)</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">d</span>.inputbox</span>(<span id="ast-37"><span id="ast-38"><span id="ast-39">self</span>.get_display_string</span>()</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">exit</span><span id="ast-43" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-44"><span id="ast-45" class="other_trans">d</span>.OK</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-47">False</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>.get_display_string</span>()</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53" class="correct_node">successURL&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">self</span>.poll</span>(<span id="ast-58">10</span>,&nbsp;<span id="ast-59" class="other_trans">quiet</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.token</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64" class="other_trans">raw_input</span>(<span id="ast-65">'Enter&nbsp;the&nbsp;recovery&nbsp;token:'</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_tasks(<span id="ast-2"><span id="ast-3" class="other_trans">group_id</span>,&nbsp;<span id="ast-4">personal</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>&nbsp;=&nbsp;<span id="ast-7">{}</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9" class="other_trans">personal</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">group_id</span><span id="ast-13" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-14">'all'</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16" class="other_trans">group</span>&nbsp;in&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">current_user</span>.groups</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>items</span>&nbsp;=&nbsp;<span id="ast-21">[]</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23" class="other_trans">task</span>&nbsp;in&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">group</span>.tasks</span>:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28">current_user</span><span id="ast-29">&nbsp;in&nbsp;</span><span id="ast-30"><span id="ast-31" class="other_trans">task</span>.users</span>)</span>:<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>items</span>.append</span>(<span id="ast-36" class="other_trans">task</span>)</span></span></span></span><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-40"><span id="ast-41"><span id="ast-42">group</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-43" class="other_trans">items</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>query</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49">Task</span>.query</span>.filter</span>(<span id="ast-50">(<span id="ast-51"><span id="ast-52">Task</span>.group_id</span><span id="ast-53" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-54">group_id</span>)</span>)</span></span><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">Group</span>.query</span>.filter</span>(<span id="ast-66">(<span id="ast-67"><span id="ast-68">Group</span>.id</span><span id="ast-69" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-70" class="other_trans">group_id</span>)</span>)</span>.first</span>()</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans">query</span>.all</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-75">(<span id="ast-76" class="other_trans">group_id</span><span id="ast-77" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-78">'all'</span>)</span>:<span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-80">group</span>&nbsp;in&nbsp;<span id="ast-81"><span id="ast-82" class="other_trans">current_user</span>.groups</span>:<span id="ast-83"><span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans">group</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90" class="other_trans">group</span>.tasks</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-91"><span id="ast-92" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>query</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96">Task</span>.query</span>.filter</span>(<span id="ast-97">(<span id="ast-98"><span id="ast-99">Task</span>.group_id</span><span id="ast-100" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-101" class="other_trans">group_id</span>)</span>)</span></span><span id="ast-102"><span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111"><span id="ast-112">Group</span>.query</span>.filter</span>(<span id="ast-113">(<span id="ast-114"><span id="ast-115">Group</span>.id</span><span id="ast-116" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-117" class="other_trans">group_id</span>)</span>)</span>.first</span>()</span>.name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-118"><span id="ast-119"><span id="ast-120" class="other_trans">query</span>.all</span>()</span></span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-122" class="other_trans">group_header</span>&nbsp;in&nbsp;<span id="ast-123" class="other_trans">list_items</span>:<span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>list_items</span>[<span id="ast-127"><span id="ast-128" class="other_trans">group_header</span></span>]</span>&nbsp;=&nbsp;<span id="ast-129"><span id="ast-130">filter</span>(<span id="ast-131">lambda&nbsp;<span id="ast-132"><span id="ast-133">x</span></span>:&nbsp;<span id="ast-134">(<span id="ast-135"><span id="ast-136">x</span>.status</span><span id="ast-137" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-138">4</span>)</span></span>,&nbsp;<span id="ast-139"><span id="ast-140" class="other_trans">list_items</span>[<span id="ast-141"><span id="ast-142" class="other_trans">group_header</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">metric_type</span>,&nbsp;<span id="ast-5" class="other_trans">infile</span>,&nbsp;<span id="ast-6" class="other_trans">hostname</span>,&nbsp;<span id="ast-7" class="other_trans">outdir</span>,&nbsp;<span id="ast-8" class="other_trans">label</span>,&nbsp;<span id="ast-9" class="other_trans">ts_start</span>,&nbsp;<span id="ast-10" class="other_trans">ts_end</span>,&nbsp;**other_options</span>):<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Metric</span>.__init__</span>(<span id="ast-15">self</span>,&nbsp;<span id="ast-16" class="other_trans">metric_type</span>,&nbsp;<span id="ast-17" class="other_trans">infile</span>,&nbsp;<span id="ast-18" class="other_trans">hostname</span>,&nbsp;<span id="ast-19" class="other_trans">outdir</span>,&nbsp;<span id="ast-20" class="other_trans">label</span>,&nbsp;<span id="ast-21" class="other_trans">ts_start</span>,&nbsp;<span id="ast-22" class="other_trans">ts_end</span>)</span></span><span id="ast-23"><span id="ast-24" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>important_sub_metrics&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-25">(<span id="ast-26">'GC'</span>,&nbsp;<span id="ast-27">'used'</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">key</span>,&nbsp;<span id="ast-31" class="other_trans">val</span>)</span>&nbsp;in&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="incorrect_node">other_options&nbsp;&rarr;&nbsp;self.&nbsp;</span>.iteritems</span>()</span>:<span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">key</span><span id="ast-38" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39">'gc-options'</span>)</span>:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.gc_options</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">val</span>.split</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-49">self</span>,&nbsp;<span id="ast-50" class="other_trans">key</span>,&nbsp;<span id="ast-51" class="other_trans">val</span>)</span></span></span></span><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.metric_description</span>&nbsp;=&nbsp;<span id="ast-55">{<span id="ast-56">'appstop'</span>:&nbsp;<span id="ast-81">'approximate&nbsp;application&nbsp;stop&nbsp;times'</span>,&nbsp;<span id="ast-57">'gen0'</span>:&nbsp;<span id="ast-82">'&nbsp;young&nbsp;gen&nbsp;collection&nbsp;time,&nbsp;excluding&nbsp;gc_prologue&nbsp;&amp;&nbsp;gc_epilogue'</span>,&nbsp;<span id="ast-58">'gen0t'</span>:&nbsp;<span id="ast-83">'&nbsp;young&nbsp;gen&nbsp;collection&nbsp;time,&nbsp;including&nbsp;gc_prologue&nbsp;&amp;&nbsp;gc_epilogue'</span>,&nbsp;<span id="ast-59">'gen0usr'</span>:&nbsp;<span id="ast-84">'&nbsp;young&nbsp;gen&nbsp;collection&nbsp;time&nbsp;in&nbsp;cpu&nbsp;user&nbsp;secs'</span>,&nbsp;<span id="ast-60">'gen0sys'</span>:&nbsp;<span id="ast-85">'&nbsp;young&nbsp;gen&nbsp;collection&nbsp;time&nbsp;in&nbsp;cpu&nbsp;sys&nbsp;secs'</span>,&nbsp;<span id="ast-61">'gen1i'</span>:&nbsp;<span id="ast-86">'&nbsp;train&nbsp;generation&nbsp;incremental&nbsp;collection'</span>,&nbsp;<span id="ast-62">'gen1t'</span>:&nbsp;<span id="ast-87">'&nbsp;old&nbsp;generation&nbsp;collection/full&nbsp;GC'</span>,&nbsp;<span id="ast-63">'cmsIM'</span>:&nbsp;<span id="ast-88">'&nbsp;CMS&nbsp;initial&nbsp;mark&nbsp;pause'</span>,&nbsp;<span id="ast-64">'cmsRM'</span>:&nbsp;<span id="ast-89">'&nbsp;CMS&nbsp;remark&nbsp;pause'</span>,&nbsp;<span id="ast-65">'cmsRS'</span>:&nbsp;<span id="ast-90">'&nbsp;CMS&nbsp;resize&nbsp;pause'</span>,&nbsp;<span id="ast-66">'GC'</span>:&nbsp;<span id="ast-91">'&nbsp;all&nbsp;stop-the-world&nbsp;GC&nbsp;pauses'</span>,&nbsp;<span id="ast-67">'cmsCM'</span>:&nbsp;<span id="ast-92">'&nbsp;CMS&nbsp;concurrent&nbsp;mark&nbsp;phase'</span>,&nbsp;<span id="ast-68">'cmsCP'</span>:&nbsp;<span id="ast-93">'&nbsp;CMS&nbsp;concurrent&nbsp;preclean&nbsp;phase'</span>,&nbsp;<span id="ast-69">'cmsCS'</span>:&nbsp;<span id="ast-94">'&nbsp;CMS&nbsp;concurrent&nbsp;sweep&nbsp;phase'</span>,&nbsp;<span id="ast-70">'cmsCR'</span>:&nbsp;<span id="ast-95">'&nbsp;CMS&nbsp;concurrent&nbsp;reset&nbsp;phase'</span>,&nbsp;<span id="ast-71">'alloc'</span>:&nbsp;<span id="ast-96">'&nbsp;object&nbsp;allocation&nbsp;in&nbsp;MB&nbsp;(approximate***)'</span>,&nbsp;<span id="ast-72">'promo'</span>:&nbsp;<span id="ast-97">'&nbsp;object&nbsp;promotion&nbsp;in&nbsp;MB&nbsp;(approximate***)'</span>,&nbsp;<span id="ast-73">'used0'</span>:&nbsp;<span id="ast-98">'&nbsp;young&nbsp;gen&nbsp;used&nbsp;memory&nbsp;size&nbsp;(before&nbsp;gc)'</span>,&nbsp;<span id="ast-74">'used1'</span>:&nbsp;<span id="ast-99">'&nbsp;old&nbsp;gen&nbsp;used&nbsp;memory&nbsp;size&nbsp;(before&nbsp;gc)'</span>,&nbsp;<span id="ast-75">'used'</span>:&nbsp;<span id="ast-100">'&nbsp;heap&nbsp;space&nbsp;used&nbsp;memory&nbsp;size&nbsp;(before&nbsp;gc)&nbsp;(excludes&nbsp;perm&nbsp;gen)'</span>,&nbsp;<span id="ast-76">'commit0'</span>:&nbsp;<span id="ast-101">'&nbsp;young&nbsp;gen&nbsp;committed&nbsp;memory&nbsp;size&nbsp;(after&nbsp;gc)'</span>,&nbsp;<span id="ast-77">'commit1'</span>:&nbsp;<span id="ast-102">'&nbsp;old&nbsp;gen&nbsp;committed&nbsp;memory&nbsp;size&nbsp;(after&nbsp;gc)'</span>,&nbsp;<span id="ast-78">'commit'</span>:&nbsp;<span id="ast-103">'&nbsp;heap&nbsp;committed&nbsp;memory&nbsp;size&nbsp;(after&nbsp;gc)&nbsp;(excludes&nbsp;perm&nbsp;gen)'</span>,&nbsp;<span id="ast-79">'apptime'</span>:&nbsp;<span id="ast-104">'&nbsp;amount&nbsp;of&nbsp;time&nbsp;application&nbsp;threads&nbsp;were&nbsp;running'</span>,&nbsp;<span id="ast-80">'safept'</span>:&nbsp;<span id="ast-105">'&nbsp;amount&nbsp;of&nbsp;time&nbsp;the&nbsp;VM&nbsp;spent&nbsp;at&nbsp;safepoints&nbsp;(app&nbsp;threads&nbsp;stopped)'</span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;migrate_user(<span id="ast-2"><span id="ast-3" class="other_trans">context</span>,&nbsp;<span id="ast-4" class="other_trans">user_id</span>,&nbsp;<span id="ast-5" class="other_trans">tenant_id</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user_binding</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">'user-{}'</span>.format</span>(<span id="ast-12" class="other_trans">user_id</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user_retrieve</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">'{}-retrieve'</span>.format</span>(<span id="ast-18" class="other_trans">user_binding</span>)</span></span><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user_ensure</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">'{}-ensure'</span>.format</span>(<span id="ast-24" class="other_trans">user_binding</span>)</span></span><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">linear_flow</span>.Flow</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32">'migrate-user-{}'</span>.format</span>(<span id="ast-33">user_id</span>)</span>)</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>.add</span>(<span id="ast-38"><span id="ast-39">RetrieveUser</span>(<span id="ast-40"><span id="ast-41" class="other_trans">context</span>.src_cloud</span>,&nbsp;name=<span id="ast-43" class="ref_node">user_retrieve&nbsp;&rarr;&nbsp;user_binding&nbsp;</span>,&nbsp;provides=<span id="ast-45" class="other_trans">user_binding</span>,&nbsp;rebind=<span id="ast-47">[<span id="ast-48">user_retrieve</span>]</span>)</span>)</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-50">(<span id="ast-51" class="other_trans">tenant_id</span><span id="ast-52" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-53" class="other_trans">None</span>)</span>:<span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tenant_ensure</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58">'tenant-{}-ensure'</span>.format</span>(<span id="ast-59" class="other_trans">tenant_id</span>)</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>.add</span>(<span id="ast-64"><span id="ast-65" class="other_trans">EnsureUser</span>(<span id="ast-66"><span id="ast-67" class="other_trans">context</span>.dst_cloud</span>,&nbsp;name=<span id="ast-69" class="other_trans">user_ensure</span>,&nbsp;provides=<span id="ast-71" class="other_trans">user_ensure</span>,&nbsp;rebind=<span id="ast-73">[<span id="ast-74" class="other_trans">user_binding</span>,&nbsp;<span id="ast-75">tenant_ensure</span>]</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>flow</span>.add</span>(<span id="ast-80"><span id="ast-81" class="other_trans">EnsureOrphanUser</span>(<span id="ast-82"><span id="ast-83" class="other_trans">context</span>.dst_cloud</span>,&nbsp;name=<span id="ast-85" class="other_trans">user_ensure</span>,&nbsp;provides=<span id="ast-87">user_ensure</span>,&nbsp;rebind=<span id="ast-89">[<span id="ast-90" class="other_trans">user_binding</span>]</span>)</span>)</span></span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>.store</span>[<span id="ast-95"><span id="ast-96" class="other_trans">user_retrieve</span></span>]</span>&nbsp;=&nbsp;<span id="ast-97" class="incorrect_node">user_id&nbsp;&rarr;&nbsp;flow&nbsp;</span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-99" class="other_trans">flow</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_mendeley_percent_of_products(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7"><span id="ast-8">self</span>.all_products</span>)</span>:<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-10" class="other_trans">None</span></span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-13">0</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-15" class="other_trans">p</span>&nbsp;in&nbsp;<span id="ast-16"><span id="ast-17">self</span>.all_products</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-21"><span id="ast-22" class="other_trans">p</span>.mendeley_api_raw</span>&nbsp;and&nbsp;<span id="ast-23">(<span id="ast-24">'reader_count'</span><span id="ast-25">&nbsp;in&nbsp;</span><span id="ast-26"><span id="ast-27" class="other_trans">p</span>.mendeley_api_raw</span>)</span>)</span>:<span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">p</span>.mendeley_api_raw</span>[<span id="ast-33"><span id="ast-34">'reader_count'</span></span>]</span><span id="ast-35" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-36">1</span>)</span>:<span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;+=&nbsp;<span id="ast-40">1</span></span></span></span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44" class="other_trans">float</span>(<span id="ast-45" class="other_trans">count</span>)</span>&nbsp;/&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">len</span>(<span id="ast-49"><span id="ast-50">self</span>.all_products</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;set_players(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">players</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>._pmenu_lists</span>[<span id="ast-11"><span id="ast-12">0</span></span>]</span>[<span id="ast-13"><span id="ast-14">1</span></span>]</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;=&nbsp;<span id="ast-17">lambda&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">a</span>,&nbsp;<span id="ast-20" class="other_trans">b</span></span>:&nbsp;<span id="ast-21">[<span id="ast-22">[<span id="ast-23" class="other_trans">e</span><span id="ast-24">&nbsp;for&nbsp;<span id="ast-25">e</span>&nbsp;in&nbsp;<span id="ast-26">d</span>&nbsp;if&nbsp;<span id="ast-27">(<span id="ast-28">not</span>&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">e</span><span id="ast-31">&nbsp;in&nbsp;</span><span id="ast-32" class="other_trans">c</span>)</span>)</span></span>]</span><span id="ast-33">&nbsp;for&nbsp;<span id="ast-34">(<span id="ast-35">c</span>,&nbsp;<span id="ast-36" class="other_trans">d</span>)</span>&nbsp;in&nbsp;<span id="ast-37">(<span id="ast-38">(<span id="ast-39" class="other_trans">a</span>,&nbsp;<span id="ast-40">b</span>)</span>,&nbsp;<span id="ast-41">(<span id="ast-42">b</span>,&nbsp;<span id="ast-43" class="other_trans">a</span>)</span>)</span></span>]</span></span></span><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-46" class="other_trans">add</span>,&nbsp;<span id="ast-47" class="other_trans">remove</span>)</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">diff</span>(<span id="ast-50">[<span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">b</span>.original_widget</span>.label</span><span id="ast-54">&nbsp;for&nbsp;<span id="ast-55" class="other_trans">b</span>&nbsp;in&nbsp;<span id="ast-56"><span id="ast-57">list</span>(<span id="ast-58" class="other_trans">content</span>)</span></span>]</span>,&nbsp;<span id="ast-59" class="other_trans">players</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-61" class="other_trans">b</span>&nbsp;in&nbsp;<span id="ast-62"><span id="ast-63">list</span>(<span id="ast-64" class="other_trans">content</span>)</span>:<span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66">(<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">b</span>.original_widget</span>.label</span><span id="ast-70">&nbsp;in&nbsp;</span><span id="ast-71" class="other_trans">remove</span>)</span>:<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>.remove</span>(<span id="ast-76" class="other_trans">b</span>)</span></span></span></span><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-79">0</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-81">(<span id="ast-82"><span id="ast-83" class="other_trans">len</span>(<span id="ast-84">add</span>)</span><span id="ast-85" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-86">0</span>)</span>:<span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>a</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91">add</span>.pop</span>(<span id="ast-92">0</span>)</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-94">(<span id="ast-96">(<span id="ast-97">i</span><span id="ast-98" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-99">(<span id="ast-100"><span id="ast-101">len</span>(<span id="ast-102" class="other_trans">content</span>)</span>&nbsp;-&nbsp;<span id="ast-104">1</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-105">(<span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109">content</span>[<span id="ast-110"><span id="ast-111" class="other_trans">i</span></span>]</span>.original_widget</span>.label</span><span id="ast-112" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-113" class="other_trans">a</span>)</span>)</span>:<span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-117">1</span></span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>.insert</span>(<span id="ast-122" class="other_trans">i</span>,&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125" class="other_trans">urwid</span>.AttrMap</span>(<span id="ast-126"><span id="ast-127" class="other_trans">PMenuButton</span>(<span id="ast-128" class="other_trans">a</span>,&nbsp;<span id="ast-129"><span id="ast-130">self</span>.next</span>,&nbsp;<span id="ast-131" class="other_trans">a</span>)</span>,&nbsp;<span id="ast-132">'menu_item'</span>,&nbsp;<span id="ast-133">'menu_item_focus'</span>)</span>)</span></span><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-137">1</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;work(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>._should_run</span>()</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>._sort_and_filter</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-19">(<span id="ast-20"><span id="ast-21" class="other_trans">len</span>(<span id="ast-22"><span id="ast-23">self</span>.evolve_list</span>)</span><span id="ast-24" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-25">0</span>)</span>&nbsp;and&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>.evolve_list</span>[<span id="ast-30"><span id="ast-31">0</span></span>]</span><span id="ast-32" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-33">'all'</span>)</span>)</span>:<span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">filter</span>(<span id="ast-38">lambda&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">x</span></span>:&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43" class="other_trans">x</span>.name</span><span id="ast-44">&nbsp;in&nbsp;</span><span id="ast-45"><span id="ast-46">self</span>.evolve_list</span>)</span></span>,&nbsp;<span id="ast-47" class="other_trans">filtered_list</span>)</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-49">(<span id="ast-51">(<span id="ast-52"><span id="ast-53" class="other_trans">len</span>(<span id="ast-54"><span id="ast-55">self</span>.donot_evolve_list</span>)</span><span id="ast-56" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-57">0</span>)</span>&nbsp;and&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60"><span id="ast-61">self</span>.donot_evolve_list</span>[<span id="ast-62"><span id="ast-63">0</span></span>]</span><span id="ast-64" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-65">'none'</span>)</span>)</span>:<span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filtered_list</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">filter</span>(<span id="ast-70">lambda&nbsp;<span id="ast-71"><span id="ast-72" class="other_trans">pokemon</span></span>:&nbsp;<span id="ast-73">(<span id="ast-74"><span id="ast-75" class="other_trans">pokemon</span>.name</span><span id="ast-76">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-77" class="correct_node">donot_evolve_list&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span>,&nbsp;<span id="ast-78" class="other_trans">filtered_list</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;flatten(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">pages</span>,&nbsp;<span id="ast-6" class="other_trans">inherit</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>inheritablePageAttributes</span>&nbsp;=&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12" class="other_trans">NameObject</span>(<span id="ast-13">'/Resources'</span>)</span>,&nbsp;<span id="ast-14"><span id="ast-15">NameObject</span>(<span id="ast-16">'/MediaBox'</span>)</span>,&nbsp;<span id="ast-17"><span id="ast-18">NameObject</span>(<span id="ast-19">'/CropBox'</span>)</span>,&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">NameObject</span>(<span id="ast-22">'/Rotate'</span>)</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25" class="other_trans">inherit</span><span id="ast-26" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-27">None</span>)</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>inherit</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">dict</span>()</span></span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34" class="incorrect_node">pages&nbsp;&rarr;&nbsp;inherit&nbsp;</span><span id="ast-35" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-36" class="other_trans">None</span>)</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.flattenedPages</span>&nbsp;=&nbsp;<span id="ast-40">[]</span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>catalog</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45">self</span>.getObject</span>(<span id="ast-46"><span id="ast-47"><span id="ast-48">self</span>.trailer</span>[<span id="ast-49"><span id="ast-50">'/Root'</span></span>]</span>)</span></span><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pages</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55">self</span>.getObject</span>(<span id="ast-56"><span id="ast-57" class="other_trans">catalog</span>[<span id="ast-58"><span id="ast-59">'/Pages'</span></span>]</span>)</span></span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61"><span id="ast-62">isinstance</span>(<span id="ast-63" class="other_trans">pages</span>,&nbsp;<span id="ast-64">IndirectObject</span>)</span>:<span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pages</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69">self</span>.getObject</span>(<span id="ast-70" class="other_trans">pages</span>)</span></span></span><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>t</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74">pages</span>[<span id="ast-75"><span id="ast-76">'/Type'</span></span>]</span></span><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-78">(<span id="ast-79">t</span><span id="ast-80" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-81">'/Pages'</span>)</span>:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-83" class="other_trans">attr</span>&nbsp;in&nbsp;<span id="ast-84">inheritablePageAttributes</span>:<span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-86"><span id="ast-87"><span id="ast-88">pages</span>.has_key</span>(<span id="ast-89">attr</span>)</span>:<span id="ast-90"><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>inherit</span>[<span id="ast-93"><span id="ast-94" class="other_trans">attr</span></span>]</span>&nbsp;=&nbsp;<span id="ast-95"><span id="ast-96" class="ref_node">t&nbsp;&rarr;&nbsp;pages&nbsp;</span>[<span id="ast-97"><span id="ast-98">attr</span></span>]</span></span></span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-100" class="other_trans">page</span>&nbsp;in&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">pages</span>[<span id="ast-103"><span id="ast-104">'/Kids'</span></span>]</span>:<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.flatten</span>(<span id="ast-109">page</span>,&nbsp;<span id="ast-110" class="other_trans">inherit</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-112">(<span id="ast-113" class="other_trans">t</span><span id="ast-114" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-115">'/Page'</span>)</span>:<span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-117">(<span id="ast-118" class="other_trans">attr</span>,&nbsp;<span id="ast-119" class="other_trans">value</span>)</span>&nbsp;in&nbsp;<span id="ast-120"><span id="ast-121"><span id="ast-122" class="other_trans">inherit</span>.items</span>()</span>:<span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124">(<span id="ast-125">not</span>&nbsp;<span id="ast-126"><span id="ast-127"><span id="ast-128" class="other_trans">pages</span>.has_key</span>(<span id="ast-129">attr</span>)</span>)</span>:<span id="ast-130"><span id="ast-131"><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pages</span>[<span id="ast-133"><span id="ast-134">attr</span></span>]</span>&nbsp;=&nbsp;<span id="ast-135">value</span></span></span></span><span id="ast-136"><span id="ast-137" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pageObj</span>&nbsp;=&nbsp;<span id="ast-138"><span id="ast-139">PageObject</span>()</span></span><span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pageObj</span>.update</span>(<span id="ast-144" class="other_trans">pages</span>)</span></span><span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.flattenedPages</span>.append</span>(<span id="ast-150" class="other_trans">pageObj</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;strip(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"Clean&nbsp;the&nbsp;page's&nbsp;raw&nbsp;text&nbsp;by&nbsp;removing&nbsp;templates&nbsp;and&nbsp;formatting.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;the&nbsp;page's&nbsp;text&nbsp;with&nbsp;all&nbsp;HTML&nbsp;and&nbsp;wikicode&nbsp;formatting&nbsp;removed,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;including&nbsp;templates,&nbsp;tables,&nbsp;and&nbsp;references.&nbsp;It&nbsp;retains&nbsp;punctuation\\u000a&nbsp;&nbsp;&nbsp;&nbsp;(spacing,&nbsp;paragraphs,&nbsp;periods,&nbsp;commas,&nbsp;(semi)-colons,&nbsp;parentheses,\\u000a&nbsp;&nbsp;&nbsp;&nbsp;quotes),&nbsp;original&nbsp;capitalization,&nbsp;and&nbsp;so&nbsp;forth.&nbsp;HTML&nbsp;entities&nbsp;are\\u000a&nbsp;&nbsp;&nbsp;&nbsp;replaced&nbsp;by&nbsp;their&nbsp;unicode&nbsp;equivalents.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;actual&nbsp;stripping&nbsp;is&nbsp;handled&nbsp;by&nbsp;:py:mod:`mwparserfromhell`.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-6">def&nbsp;remove(<span id="ast-7"><span id="ast-8" class="other_trans">code</span>,&nbsp;<span id="ast-9" class="other_trans">node</span></span>):<span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>'Remove&nbsp;a&nbsp;node&nbsp;from&nbsp;a&nbsp;code&nbsp;object,&nbsp;ignoring&nbsp;ValueError.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sometimes&nbsp;we&nbsp;will&nbsp;remove&nbsp;a&nbsp;node&nbsp;that&nbsp;contains&nbsp;another&nbsp;node&nbsp;we&nbsp;wish\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;remove,&nbsp;and&nbsp;we&nbsp;fail&nbsp;when&nbsp;we&nbsp;try&nbsp;to&nbsp;remove&nbsp;the&nbsp;inner&nbsp;one.&nbsp;Easiest\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;solution&nbsp;is&nbsp;to&nbsp;just&nbsp;ignore&nbsp;the&nbsp;exception.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>code</span>.remove</span>(<span id="ast-17" class="other_trans">node</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-19" class="other_trans">ValueError</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>wikicode</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">mwparserfromhell</span>.parse</span>(<span id="ast-26"><span id="ast-27">self</span>.text</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>bad_prefixes</span>&nbsp;=&nbsp;<span id="ast-30">(<span id="ast-31">'file:'</span>,&nbsp;<span id="ast-32">'image:'</span>,&nbsp;<span id="ast-33">'category:'</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-35" class="other_trans">link</span>&nbsp;in&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">wikicode</span>.filter_wikilinks</span>()</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans">link</span>.title</span>.strip</span>()</span>.lower</span>()</span>.startswith</span>(<span id="ast-48" class="other_trans">bad_prefixes</span>)</span>:<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>remove</span>(<span id="ast-52" class="other_trans">wikicode</span>,&nbsp;<span id="ast-53" class="other_trans">link</span>)</span></span></span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-55" class="other_trans">tag</span>&nbsp;in&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">wikicode</span>.filter_tags</span>(matches=<span id="ast-60">lambda&nbsp;<span id="ast-61"><span id="ast-62" class="other_trans">tag</span></span>:&nbsp;<span id="ast-63">(<span id="ast-64"><span id="ast-65" class="other_trans">tag</span>.tag</span><span id="ast-66" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-67">'ref'</span>)</span></span>)</span>:<span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>remove</span>(<span id="ast-71" class="other_trans">wikicode</span>,&nbsp;<span id="ast-72" class="other_trans">tag</span>)</span></span></span><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._merge_templates</span>(<span id="ast-77" class="correct_node">code&nbsp;&rarr;&nbsp;wikicode&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;do_rm_command(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">argv</span>,&nbsp;<span id="ast-5">parser</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-10">'bundle_spec'</span>,&nbsp;help=<span id="ast-12"><span id="ast-13">self</span>.BUNDLE_SPEC_FORMAT</span>,&nbsp;nargs=<span id="ast-15">'+'</span>)</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-20">'-f'</span>,&nbsp;<span id="ast-21">'--force'</span>,&nbsp;action=<span id="ast-23">'store_true'</span>,&nbsp;help=<span id="ast-25">'delete&nbsp;bundle&nbsp;(DANGEROUS&nbsp;-&nbsp;breaking&nbsp;dependencies!)'</span>)</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-30">'-r'</span>,&nbsp;<span id="ast-31">'--recursive'</span>,&nbsp;action=<span id="ast-33">'store_true'</span>,&nbsp;help=<span id="ast-35">'delete&nbsp;all&nbsp;bundles&nbsp;downstream&nbsp;that&nbsp;depend&nbsp;on&nbsp;this&nbsp;bundle'</span>)</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-40">'-i'</span>,&nbsp;<span id="ast-41">'--dry-run'</span>,&nbsp;action=<span id="ast-43">'store_true'</span>,&nbsp;help=<span id="ast-45">'delete&nbsp;all&nbsp;bundles&nbsp;downstream&nbsp;that&nbsp;depend&nbsp;on&nbsp;this&nbsp;bundle'</span>)</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-50">'-w'</span>,&nbsp;<span id="ast-51">'--worksheet_spec'</span>,&nbsp;help=<span id="ast-53">(<span id="ast-54">'operate&nbsp;on&nbsp;this&nbsp;worksheet&nbsp;(%s)'</span>&nbsp;%&nbsp;<span id="ast-56"><span id="ast-57">self</span>.WORKSHEET_SPEC_FORMAT</span>)</span>,&nbsp;nargs=<span id="ast-59">'?'</span>)</span></span><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans">parser</span>.parse_args</span>(<span id="ast-65" class="other_trans">argv</span>)</span></span><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.bundle_spec</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">spec_util</span>.expand_specs</span>(<span id="ast-72"><span id="ast-73">args</span>.bundle_spec</span>)</span></span><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-76">client</span>,&nbsp;<span id="ast-77" class="other_trans">worksheet_uuid</span>)</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80">self</span>.parse_client_worksheet_uuid</span>(<span id="ast-81"><span id="ast-82" class="other_trans">args</span>.worksheet_spec</span>)</span></span><span id="ast-83"><span id="ast-84" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>bundle_uuids</span>&nbsp;=&nbsp;<span id="ast-85">[<span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans">worksheet_util</span>.get_bundle_uuid</span>(<span id="ast-89" class="other_trans">client</span>,&nbsp;<span id="ast-90" class="other_trans">worksheet_uuid</span>,&nbsp;<span id="ast-91" class="other_trans">bundle_spec</span>)</span><span id="ast-92">&nbsp;for&nbsp;<span id="ast-93">bundle_spec</span>&nbsp;in&nbsp;<span id="ast-94"><span id="ast-95" class="other_trans">args</span>.bundle_spec</span></span>]</span></span><span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>deleted_uuids</span>&nbsp;=&nbsp;<span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans">client</span>.delete_bundles</span>(<span id="ast-101">bundle_uuids</span>,&nbsp;<span id="ast-102"><span id="ast-103" class="other_trans">args</span>.force</span>,&nbsp;<span id="ast-104"><span id="ast-105">args</span>.recursive</span>,&nbsp;<span id="ast-106"><span id="ast-107" class="other_trans">args</span>.dry_run</span>)</span></span><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-109"><span id="ast-110" class="other_trans">args</span>.dry_run</span>:<span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-112">'This&nbsp;command&nbsp;would&nbsp;permanently&nbsp;remove&nbsp;the&nbsp;following&nbsp;bundles&nbsp;(not&nbsp;doing&nbsp;so&nbsp;yet):'</span></span><span id="ast-113"><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bundle_infos</span>&nbsp;=&nbsp;<span id="ast-115"><span id="ast-116"><span id="ast-117">client</span>.get_bundle_infos</span>(<span id="ast-118" class="incorrect_node">deleted_uuids&nbsp;&rarr;&nbsp;bundle_uuids&nbsp;</span>)</span></span><span id="ast-119"><span id="ast-120" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bundle_info_list</span>&nbsp;=&nbsp;<span id="ast-121">[<span id="ast-122"><span id="ast-123" class="other_trans">bundle_infos</span>[<span id="ast-124"><span id="ast-125">uuid</span></span>]</span><span id="ast-126">&nbsp;for&nbsp;<span id="ast-127" class="other_trans">uuid</span>&nbsp;in&nbsp;<span id="ast-128" class="ref_node">bundle_uuids&nbsp;&rarr;&nbsp;deleted_uuids&nbsp;</span></span>]</span></span><span id="ast-129"><span id="ast-130"><span id="ast-131"><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.print_bundle_info_list</span>(<span id="ast-133">bundle_info_list</span>,&nbsp;uuid_only=<span id="ast-135">False</span>,&nbsp;print_ref=<span id="ast-137">False</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-139">uuid</span>&nbsp;in&nbsp;<span id="ast-140" class="other_trans">deleted_uuids</span>:<span id="ast-141"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-142" class="other_trans">uuid</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getJson(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">url</span>,&nbsp;<span id="ast-5" class="other_trans">method</span>,&nbsp;<span id="ast-7" class="other_trans">headers</span>,&nbsp;<span id="ast-9" class="other_trans">data</span></span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Fetch&nbsp;a&nbsp;JSON&nbsp;result&nbsp;via&nbsp;HTTP\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15">not</span>&nbsp;<span id="ast-16">(<span id="ast-17">'Content-Type'</span><span id="ast-18">&nbsp;in&nbsp;</span><span id="ast-19" class="other_trans">headers</span>)</span>)</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>[<span id="ast-23"><span id="ast-24">'Content-Type'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-25">[<span id="ast-26">'application/json'</span>]</span></span></span><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>body</span>&nbsp;=&nbsp;<span id="ast-29">yield&nbsp;<span id="ast-30"><span id="ast-31" class="correct_node">getBody&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-32" class="other_trans">url</span>,&nbsp;<span id="ast-33" class="other_trans">method</span>,&nbsp;<span id="ast-34" class="other_trans">headers</span>,&nbsp;<span id="ast-35" class="other_trans">data</span>)</span></span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>defer</span>.returnValue</span>(<span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">json</span>.loads</span>(<span id="ast-43" class="other_trans">body</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;recv(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Recieve&nbsp;some&nbsp;bytes&nbsp;fromt&nbsp;he&nbsp;socket,&nbsp;handling&nbsp;buffering&nbsp;internally'</span></span><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.recv_to_buffer</span>()</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13" class="other_trans">chr</span>(<span id="ast-14">0</span>)</span><span id="ast-15">&nbsp;in&nbsp;</span><span id="ast-16"><span id="ast-17">self</span>.buffer</span>)</span>,&nbsp;<span id="ast-18">'NUL&nbsp;not&nbsp;in&nbsp;buffer,&nbsp;something&nbsp;has&nbsp;gone&nbsp;awfully&nbsp;wrong'</span></span><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-21" class="other_trans">segment_length</span>,&nbsp;<span id="ast-22" class="other_trans">_</span>,&nbsp;<span id="ast-23"><span id="ast-24">self</span>.buffer</span>)</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28">self</span>.buffer</span>.partition</span>(<span id="ast-29"><span id="ast-30" class="other_trans">chr</span>(<span id="ast-31">0</span>)</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>segment_length</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">int</span>(<span id="ast-36" class="other_trans">segment_length</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40" class="other_trans">len</span>(<span id="ast-41"><span id="ast-42">self</span>.buffer</span>)</span><span id="ast-43" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-44" class="other_trans">segment_length</span>)</span>,&nbsp;<span id="ast-45">'Not&nbsp;enough&nbsp;data&nbsp;to&nbsp;build&nbsp;the&nbsp;next&nbsp;segment'</span></span><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>.buffer</span>[<span id="ast-51">:<span id="ast-52" class="other_trans">segment_length</span></span>]</span></span><span id="ast-53"><span id="ast-54"><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.buffer</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58">self</span>.buffer</span>[<span id="ast-59"><span id="ast-60" class="other_trans">segment_length</span>:</span>]</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-65">(<span id="ast-66">'RECV&nbsp;%i&nbsp;bytes:&nbsp;%s&nbsp;from&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-68">(<span id="ast-69"><span id="ast-70" class="other_trans">len</span>(<span id="ast-71" class="other_trans">data</span>)</span>,&nbsp;<span id="ast-72"><span id="ast-73" class="other_trans">repr</span>(<span id="ast-74" class="other_trans">data</span>)</span>,&nbsp;<span id="ast-75"><span id="ast-76">self</span>.peer</span>)</span>)</span>)</span></span><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-78" class="other_trans">data</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_edge(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">filenum</span>,&nbsp;<span id="ast-5" class="other_trans">offset</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8" class="other_trans">filenum</span><span id="ast-9">&nbsp;in&nbsp;</span><span id="ast-10"><span id="ast-11">self</span>.open_file_cache</span>)</span>:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fileobj</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.open_file_cache</span>[<span id="ast-17"><span id="ast-18" class="other_trans">filenum</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-21">(<span id="ast-22">'part_%02d.msgpack'</span>&nbsp;%&nbsp;<span id="ast-24" class="other_trans">filenum</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fileobj</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">open</span>(<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-33"><span id="ast-34">self</span>.edge_dir</span>,&nbsp;<span id="ast-35" class="other_trans">filename</span>)</span>,&nbsp;<span id="ast-36">'rb'</span>)</span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.open_file_cache</span>[<span id="ast-41"><span id="ast-42" class="ref_node">filename&nbsp;&rarr;&nbsp;filenum&nbsp;</span></span>]</span>&nbsp;=&nbsp;<span id="ast-43" class="other_trans">fileobj</span></span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fileobj</span>.seek</span>(<span id="ast-48" class="other_trans">offset</span>)</span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>unpacker</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52" class="other_trans">Unpacker</span>(<span id="ast-53" class="other_trans">fileobj</span>,&nbsp;encoding=<span id="ast-55" class="incorrect_node">encoding&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59" class="other_trans">unpacker</span>.unpack</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;add_params_to_uri(<span id="ast-2"><span id="ast-3" class="other_trans">uri</span>,&nbsp;<span id="ast-4" class="other_trans">params</span>,&nbsp;<span id="ast-5">fragment</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Add&nbsp;a&nbsp;list&nbsp;of&nbsp;two-tuples&nbsp;to&nbsp;the&nbsp;uri&nbsp;query&nbsp;components.'</span></span><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-11" class="other_trans">sch</span>,&nbsp;<span id="ast-12" class="other_trans">net</span>,&nbsp;<span id="ast-13" class="other_trans">path</span>,&nbsp;<span id="ast-14" class="other_trans">par</span>,&nbsp;<span id="ast-15" class="other_trans">query</span>,&nbsp;<span id="ast-16" class="other_trans">fra</span>)</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">urlparse</span>.urlparse</span>(<span id="ast-20" class="other_trans">uri</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22" class="other_trans">fragment</span>:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fra</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26" class="other_trans">add_params_to_qs</span>(<span id="ast-27" class="ref_node">query&nbsp;&rarr;&nbsp;fra&nbsp;</span>,&nbsp;<span id="ast-28" class="other_trans">params</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-29"><span id="ast-30" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>query&nbsp;&rarr;&nbsp;fra&nbsp;</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32">add_params_to_qs</span>(<span id="ast-33" class="other_trans">query</span>,&nbsp;<span id="ast-34" class="other_trans">params</span>)</span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">urlparse</span>.urlunparse</span>(<span id="ast-39">(<span id="ast-40" class="other_trans">sch</span>,&nbsp;<span id="ast-41" class="other_trans">net</span>,&nbsp;<span id="ast-42" class="other_trans">path</span>,&nbsp;<span id="ast-43" class="other_trans">par</span>,&nbsp;<span id="ast-44" class="other_trans">query</span>,&nbsp;<span id="ast-45" class="other_trans">fra</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;form_valid(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">form</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>form</span>.save</span>()</span></span><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>get_adapter</span>()</span>.add_message</span>(<span id="ast-14"><span id="ast-15">self</span>.request</span>,&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">messages</span>.SUCCESS</span>,&nbsp;<span id="ast-18">'account/messages/password_changed.txt'</span>)</span></span><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>signals</span>.password_reset</span>.send</span>(sender=<span id="ast-25"><span id="ast-26"><span id="ast-27">self</span>.reset_user</span>.__class__</span>,&nbsp;request=<span id="ast-29"><span id="ast-30">self</span>.request</span>,&nbsp;user=<span id="ast-32"><span id="ast-33">self</span>.reset_user</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">app_settings</span>.LOGIN_ON_PASSWORD_RESET</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">perform_login</span>(<span id="ast-40" class="correct_node">request&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-41"><span id="ast-42">self</span>.reset_user</span>,&nbsp;email_verification=<span id="ast-44"><span id="ast-45" class="other_trans">app_settings</span>.EMAIL_VERIFICATION</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;loadReleaseMethod(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">modulename</span>,&nbsp;<span id="ast-5" class="other_trans">config</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>klass</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.getKlass</span>(<span id="ast-11" class="other_trans">modulename</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sections</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">klass</span>.getConfigSections</span>()</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cfg</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">copy</span>.deepcopy</span>(<span id="ast-22" class="other_trans">config</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-24" class="other_trans">section</span>&nbsp;in&nbsp;<span id="ast-25" class="other_trans">sections</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cfg</span>.update</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">config</span>.get</span>(<span id="ast-33" class="other_trans">section</span>,&nbsp;<span id="ast-34">{}</span>)</span>)</span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">klass</span>(<span id="ast-38" class="correct_node">config&nbsp;&rarr;&nbsp;cfg&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;bench_network_mcore(<span id="ast-2"><span id="ast-3" class="other_trans">thread_num</span>,&nbsp;<span id="ast-4" class="other_trans">master_node</span>,&nbsp;*client_node</span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Run&nbsp;iperf&nbsp;from&nbsp;master_node&nbsp;and&nbsp;then&nbsp;call&nbsp;from&nbsp;all&nbsp;client_nodes&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;CLI&nbsp;Example:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;..&nbsp;code-block::&nbsp;bash\\u000a&nbsp;&nbsp;&nbsp;&nbsp;salt&nbsp;'salt-master'&nbsp;ceph_sles.bench_network&nbsp;thread_number&nbsp;test_node&nbsp;client1&nbsp;client2&nbsp;client3&nbsp;...&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-8">multiprocessing</span></span><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>core_num</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">multiprocessing</span>.cpu_count</span>()</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>total</span>&nbsp;=&nbsp;<span id="ast-16">0.0</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iperf_out</span>&nbsp;=&nbsp;<span id="ast-19">''</span></span><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log_count</span>&nbsp;=&nbsp;<span id="ast-22">[]</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iperf_result</span>&nbsp;=&nbsp;<span id="ast-25">[]</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>node_name</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30">socket</span>.gethostname</span>()</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33" class="other_trans">node_name</span><span id="ast-34" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-35">master_node</span>)</span>:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>state_iperf</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">__salt__</span>[<span id="ast-41"><span id="ast-42">'state.sls'</span></span>]</span>(<span id="ast-43">'iperf'</span>)</span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-45" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-46"><span id="ast-47">range</span>(<span id="ast-48">1</span>,&nbsp;<span id="ast-49">(<span id="ast-50" class="other_trans">thread_num</span>&nbsp;+&nbsp;<span id="ast-52">1</span>)</span>)</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log_count</span>.append</span>(<span id="ast-57"><span id="ast-58"><span id="ast-59">__salt__</span>[<span id="ast-60"><span id="ast-61">'cmd.run'</span></span>]</span>(<span id="ast-62">(<span id="ast-63">(<span id="ast-64">(<span id="ast-65">(<span id="ast-66">'/usr/bin/iperf3&nbsp;-f&nbsp;M&nbsp;-A&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-68"><span id="ast-69">str</span>(<span id="ast-70">(<span id="ast-71" class="other_trans">i</span>&nbsp;%&nbsp;<span id="ast-73">core_num</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-75">'&nbsp;-p&nbsp;53'</span>)</span>&nbsp;+&nbsp;<span id="ast-77">(<span id="ast-78">'%02d'</span>&nbsp;%&nbsp;<span id="ast-80">(<span id="ast-81" class="other_trans">i</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-83">'&nbsp;&nbsp;-s&nbsp;-D'</span>)</span>,&nbsp;output_loglevel=<span id="ast-85">'debug'</span>)</span>)</span></span></span><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>thread_per_node</span>&nbsp;=&nbsp;<span id="ast-88">(<span id="ast-89" class="other_trans">thread_num</span>&nbsp;/&nbsp;<span id="ast-91"><span id="ast-92">len</span>(<span id="ast-93" class="other_trans">client_node</span>)</span>)</span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-95">(<span id="ast-96" class="other_trans">i</span>,&nbsp;<span id="ast-97" class="other_trans">node</span>)</span>&nbsp;in&nbsp;<span id="ast-98"><span id="ast-99">enumerate</span>(<span id="ast-100">client_node</span>)</span>:<span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-102" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-103"><span id="ast-104">range</span>(<span id="ast-105">0</span>,&nbsp;<span id="ast-106" class="other_trans">thread_per_node</span>)</span>:<span id="ast-107"><span id="ast-108" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base</span>&nbsp;=&nbsp;<span id="ast-109">(<span id="ast-110">(<span id="ast-111" class="other_trans">i</span>&nbsp;*&nbsp;<span id="ast-113" class="other_trans">thread_per_node</span>)</span>&nbsp;+&nbsp;<span id="ast-115" class="other_trans">x</span>)</span></span><span id="ast-116"><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>iperf_out</span>&nbsp;+=&nbsp;<span id="ast-119">(<span id="ast-120">(<span id="ast-121">(<span id="ast-122">(<span id="ast-123">(<span id="ast-124">(<span id="ast-125">(<span id="ast-126">(<span id="ast-127">'\\u000a&nbsp;node&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-129" class="other_trans">node</span>)</span>&nbsp;+&nbsp;<span id="ast-131">'&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-133"><span id="ast-134" class="other_trans">str</span>(<span id="ast-135">(<span id="ast-136" class="ref_node">i&nbsp;&rarr;&nbsp;x&nbsp;</span>&nbsp;%&nbsp;<span id="ast-138">core_num</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-140">'&nbsp;53'</span>)</span>&nbsp;+&nbsp;<span id="ast-142">(<span id="ast-143">'%02d'</span>&nbsp;%&nbsp;<span id="ast-145">(<span id="ast-146">(<span id="ast-147">base</span>&nbsp;+&nbsp;<span id="ast-149">1</span>)</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-151">'&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-153" class="incorrect_node">master_node&nbsp;&rarr;&nbsp;x&nbsp;</span>)</span>&nbsp;+&nbsp;<span id="ast-155">'\\u000a'</span>)</span></span><span id="ast-156"><span id="ast-157"><span id="ast-158"><span id="ast-159" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log_count</span>.append</span>(<span id="ast-160">(<span id="ast-161"><span id="ast-162"><span id="ast-163">__salt__</span>[<span id="ast-164"><span id="ast-165">'cmd.run'</span></span>]</span>(<span id="ast-166">(<span id="ast-167">(<span id="ast-168">(<span id="ast-169">(<span id="ast-170">(<span id="ast-171">(<span id="ast-172">(<span id="ast-173">'/usr/bin/salt&nbsp;--async&nbsp;"'</span>&nbsp;+&nbsp;<span id="ast-175" class="other_trans">node</span>)</span>&nbsp;+&nbsp;<span id="ast-177">'"&nbsp;ceph_sles.iperf&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-179"><span id="ast-180" class="other_trans">str</span>(<span id="ast-181">(<span id="ast-182" class="other_trans">i</span>&nbsp;%&nbsp;<span id="ast-184" class="other_trans">core_num</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-186">'&nbsp;53'</span>)</span>&nbsp;+&nbsp;<span id="ast-188">(<span id="ast-189">'%02d'</span>&nbsp;%&nbsp;<span id="ast-191">(<span id="ast-192">(<span id="ast-193" class="other_trans">base</span>&nbsp;+&nbsp;<span id="ast-195">1</span>)</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-197">'&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-199">master_node</span>)</span>,&nbsp;output_loglevel=<span id="ast-201">'debug'</span>)</span>&nbsp;+&nbsp;<span id="ast-203">'\\u000a'</span>)</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;on_msg(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">data</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>message</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">data</span>.get</span>(<span id="ast-10">'data'</span>)</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.chat</span>(<span id="ast-15"><span id="ast-16" class="other_trans">data</span>[<span id="ast-17"><span id="ast-18">'username'</span></span>]</span>,&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">data</span>[<span id="ast-21"><span id="ast-22">'time'</span></span>]</span>,&nbsp;<span id="ast-23" class="other_trans">message</span>)</span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">G</span>.ROOM_WINDOW</span></span><span id="ast-28">def&nbsp;cb(<span id="ast-29"><span id="ast-30" class="other_trans">selected</span></span>):<span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33" class="other_trans">selected</span><span id="ast-34" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-35">-1</span>)</span>:<span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>envelope</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41">self</span>.chat_deck</span>[<span id="ast-42"><span id="ast-43" class="other_trans">selected</span></span>]</span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.run_command</span>(<span id="ast-48">'floobits_prompt_msg'</span>,&nbsp;<span id="ast-49">{<span id="ast-50">'msg'</span>:&nbsp;<span id="ast-51">(<span id="ast-52">'%s:&nbsp;'</span>&nbsp;%&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">envelope</span>.username</span>)</span>}</span>)</span></span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-57">(<span id="ast-58"><span id="ast-59"><span id="ast-60" class="incorrect_node">message&nbsp;&rarr;&nbsp;data&nbsp;</span>.find</span>(<span id="ast-61"><span id="ast-62">self</span>.username</span>)</span><span id="ast-63" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-64">0</span>)</span>:<span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>window</span>.show_quick_panel</span>(<span id="ast-69">[<span id="ast-70"><span id="ast-71" class="other_trans">str</span>(<span id="ast-72" class="other_trans">x</span>)</span><span id="ast-73">&nbsp;for&nbsp;<span id="ast-74" class="other_trans">x</span>&nbsp;in&nbsp;<span id="ast-75"><span id="ast-76">self</span>.chat_deck</span></span>]</span>,&nbsp;<span id="ast-77" class="other_trans">cb</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;migrate_vms(<span id="ast-2"><span id="ast-3">db</span>,&nbsp;<span id="ast-4" class="other_trans">nova</span>,&nbsp;<span id="ast-5" class="other_trans">vm_instance_directory</span>,&nbsp;<span id="ast-6" class="other_trans">placement</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Synchronously&nbsp;live&nbsp;migrate&nbsp;a&nbsp;set&nbsp;of&nbsp;VMs.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;db:&nbsp;The&nbsp;database&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;db:&nbsp;Database\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;nova:&nbsp;A&nbsp;Nova&nbsp;client.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;nova:&nbsp;*\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;vm_instance_directory:&nbsp;The&nbsp;VM&nbsp;instance&nbsp;directory.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;vm_instance_directory:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;placement:&nbsp;A&nbsp;dict&nbsp;of&nbsp;VM&nbsp;UUIDs&nbsp;to&nbsp;host&nbsp;names.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;placement:&nbsp;dict(str:&nbsp;str)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>vms</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">placement</span>.keys</span>()</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>vm_pairs</span>&nbsp;=&nbsp;<span id="ast-16">[<span id="ast-17"><span id="ast-18" class="other_trans">vms</span>[<span id="ast-19"><span id="ast-20">x</span>:<span id="ast-21">(<span id="ast-22" class="other_trans">x</span>&nbsp;+&nbsp;<span id="ast-24">2</span>)</span></span>]</span><span id="ast-25">&nbsp;for&nbsp;<span id="ast-26">x</span>&nbsp;in&nbsp;<span id="ast-27"><span id="ast-28">xrange</span>(<span id="ast-29">0</span>,&nbsp;<span id="ast-30"><span id="ast-31">len</span>(<span id="ast-32" class="other_trans">vms</span>)</span>,&nbsp;<span id="ast-33">2</span>)</span></span>]</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-35">vm_pair</span>&nbsp;in&nbsp;<span id="ast-36" class="other_trans">vm_pairs</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subprocess</span>.call</span>(<span id="ast-41">(<span id="ast-42">'chown&nbsp;-R&nbsp;nova:nova&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-44" class="other_trans">vm_instance_directory</span>)</span>,&nbsp;shell=<span id="ast-46">True</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-48" class="other_trans">vm</span>&nbsp;in&nbsp;<span id="ast-49">vm_pair</span>:<span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>host</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">placement</span>[<span id="ast-54"><span id="ast-55" class="other_trans">vm</span></span>]</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nova</span>.servers</span>.live_migrate</span>(<span id="ast-61">vm</span>,&nbsp;<span id="ast-62" class="other_trans">host</span>,&nbsp;<span id="ast-63">False</span>,&nbsp;<span id="ast-64">False</span>)</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68">log</span>.isEnabledFor</span>(<span id="ast-69"><span id="ast-70" class="other_trans">logging</span>.INFO</span>)</span>:<span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.info</span>(<span id="ast-75">'Started&nbsp;migration&nbsp;of&nbsp;VM&nbsp;%s&nbsp;to&nbsp;%s'</span>,&nbsp;<span id="ast-76">vm</span>,&nbsp;<span id="ast-77" class="other_trans">host</span>)</span></span></span></span><span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-82">10</span>)</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-84">True</span>:<span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-86">vm_uuid</span>&nbsp;in&nbsp;<span id="ast-87"><span id="ast-88">list</span>(<span id="ast-89" class="other_trans">vm_pair</span>)</span>:<span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vm</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95">nova</span>.servers</span>.get</span>(<span id="ast-96">vm_uuid</span>)</span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans">log</span>.isEnabledFor</span>(<span id="ast-101"><span id="ast-102">logging</span>.DEBUG</span>)</span>:<span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-107">'VM&nbsp;%s:&nbsp;%s,&nbsp;%s'</span>,&nbsp;<span id="ast-108" class="other_trans">vm_uuid</span>,&nbsp;<span id="ast-109"><span id="ast-110">vm_hostname</span>(<span id="ast-111">vm</span>)</span>,&nbsp;<span id="ast-112"><span id="ast-113">vm</span>.status</span>)</span></span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-115">(<span id="ast-117">(<span id="ast-118"><span id="ast-119">vm_hostname</span>(<span id="ast-120">vm</span>)</span><span id="ast-121" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-122"><span id="ast-123" class="other_trans">placement</span>[<span id="ast-124"><span id="ast-125">vm_uuid</span></span>]</span>)</span>&nbsp;or&nbsp;<span id="ast-126">(<span id="ast-127"><span id="ast-128" class="other_trans">vm</span>.status</span><span id="ast-129" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-130">u'ACTIVE'</span>)</span>)</span>:<span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vms&nbsp;&rarr;&nbsp;vm_pair&nbsp;</span>.remove</span>(<span id="ast-136" class="other_trans">vm_uuid</span>)</span></span><span id="ast-137"><span id="ast-138"><span id="ast-139"><span id="ast-140" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>db</span>.insert_vm_migration</span>(<span id="ast-141" class="other_trans">vm_uuid</span>,&nbsp;<span id="ast-142"><span id="ast-143">placement</span>[<span id="ast-144"><span id="ast-145" class="other_trans">vm_uuid</span></span>]</span>)</span></span><span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-147"><span id="ast-148"><span id="ast-149">log</span>.isEnabledFor</span>(<span id="ast-150"><span id="ast-151">logging</span>.INFO</span>)</span>:<span id="ast-152"><span id="ast-153"><span id="ast-154"><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.info</span>(<span id="ast-156">'Completed&nbsp;migration&nbsp;of&nbsp;VM&nbsp;%s&nbsp;to&nbsp;%s'</span>,&nbsp;<span id="ast-157" class="other_trans">vm_uuid</span>,&nbsp;<span id="ast-158"><span id="ast-159" class="other_trans">placement</span>[<span id="ast-160"><span id="ast-161">vm_uuid</span></span>]</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-162"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-163"><span id="ast-164"><span id="ast-165"><span id="ast-166" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-167">3</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;outdated(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Whether&nbsp;the&nbsp;feature&nbsp;is&nbsp;outdated.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;A&nbsp;feature&nbsp;is&nbsp;outdated,&nbsp;if&nbsp;the&nbsp;modification&nbsp;time&nbsp;of&nbsp;the&nbsp;file&nbsp;it&nbsp;was\\u000a&nbsp;&nbsp;&nbsp;&nbsp;loaded&nbsp;from&nbsp;is&nbsp;newer&nbsp;than&nbsp;the&nbsp;load&nbsp;time&nbsp;of&nbsp;the&nbsp;feature.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Use&nbsp;this&nbsp;property&nbsp;to&nbsp;determine&nbsp;whether&nbsp;``feature``&nbsp;should&nbsp;be&nbsp;loaded\\u000a&nbsp;&nbsp;&nbsp;&nbsp;again.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-7">(<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">os</span>.path</span>.isfile</span>(<span id="ast-13"><span id="ast-14">self</span>.filename</span>)</span>&nbsp;and&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">os</span>.path</span>.getmtime</span>(<span id="ast-20"><span id="ast-21">self</span>.filename</span>)</span><span id="ast-22" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-23"><span id="ast-24">self</span>.load_time</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;runAdobeSetup(<span id="ast-2"><span id="ast-3" class="other_trans">dmgpath</span>,&nbsp;<span id="ast-4" class="other_trans">uninstalling</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_status</span>(<span id="ast-10">(<span id="ast-11">'Mounting&nbsp;disk&nbsp;image&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">os</span>.path</span>.basename</span>(<span id="ast-17" class="other_trans">dmgpath</span>)</span>)</span>)</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mountpoints</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">mountAdobeDmg</span>(<span id="ast-22" class="other_trans">dmgpath</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24" class="other_trans">mountpoints</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setup_path</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28">findSetupApp</span>(<span id="ast-29"><span id="ast-30">mountpoints</span>[<span id="ast-31"><span id="ast-32">0</span></span>]</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34" class="other_trans">setup_path</span>:<span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deploymentfile</span>&nbsp;=&nbsp;<span id="ast-37">None</span></span><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>installxml</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43">os</span>.path</span>.join</span>(<span id="ast-44"><span id="ast-45" class="other_trans">mountpoints</span>[<span id="ast-46"><span id="ast-47">0</span></span>]</span>,&nbsp;<span id="ast-48">'install.xml'</span>)</span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>uninstallxml</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54">os</span>.path</span>.join</span>(<span id="ast-55"><span id="ast-56" class="other_trans">mountpoints</span>[<span id="ast-57"><span id="ast-58">0</span></span>]</span>,&nbsp;<span id="ast-59">'uninstall.xml'</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61">uninstalling</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-67" class="other_trans">uninstallxml</span>)</span>:<span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deploymentfile</span>&nbsp;=&nbsp;<span id="ast-70">uninstallxml</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.unmountdmg</span>(<span id="ast-75"><span id="ast-76" class="other_trans">mountpoints</span>[<span id="ast-77"><span id="ast-78">0</span></span>]</span>)</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_error</span>(<span id="ast-83">(<span id="ast-84">"%s&nbsp;doesn't&nbsp;appear&nbsp;to&nbsp;contain&nbsp;uninstall&nbsp;info."</span>&nbsp;%&nbsp;<span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89">os</span>.path</span>.basename</span>(<span id="ast-90">dmgpath</span>)</span>)</span>)</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-92">-1</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97">os</span>.path</span>.exists</span>(<span id="ast-98" class="other_trans">installxml</span>)</span>:<span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deploymentfile</span>&nbsp;=&nbsp;<span id="ast-101" class="ref_node">uninstallxml&nbsp;&rarr;&nbsp;installxml&nbsp;</span></span></span><span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>number_of_payloads</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105">countPayloads</span>(<span id="ast-106"><span id="ast-107">mountpoints</span>[<span id="ast-108"><span id="ast-109">0</span></span>]</span>)</span></span><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_status</span>(<span id="ast-114">'Running&nbsp;Adobe&nbsp;Setup'</span>)</span></span><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>adobe_setup</span>&nbsp;=&nbsp;<span id="ast-117">[<span id="ast-118" class="incorrect_node">setup_path&nbsp;&rarr;&nbsp;uninstallxml&nbsp;</span>,&nbsp;<span id="ast-119">'--mode=silent'</span>,&nbsp;<span id="ast-120">'--skipProcessCheck=1'</span>]</span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122" class="other_trans">deploymentfile</span>:<span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>adobe_setup</span>.append</span>(<span id="ast-127">(<span id="ast-128">'--deploymentFile=%s'</span>&nbsp;%&nbsp;<span id="ast-130">deploymentFile</span>)</span>)</span></span></span><span id="ast-131"><span id="ast-132" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>retcode</span>&nbsp;=&nbsp;<span id="ast-133"><span id="ast-134">runAdobeInstallTool</span>(<span id="ast-135">adobe_setup</span>,&nbsp;<span id="ast-136" class="other_trans">number_of_payloads</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-137"><span id="ast-138"><span id="ast-139"><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_error</span>(<span id="ast-141">(<span id="ast-142">"%s&nbsp;doesn't&nbsp;appear&nbsp;to&nbsp;contain&nbsp;Adobe&nbsp;Setup."</span>&nbsp;%&nbsp;<span id="ast-144"><span id="ast-145"><span id="ast-146"><span id="ast-147">os</span>.path</span>.basename</span>(<span id="ast-148" class="other_trans">dmgpath</span>)</span>)</span>)</span></span><span id="ast-149"><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>retcode</span>&nbsp;=&nbsp;<span id="ast-151">-1</span></span></span><span id="ast-152"><span id="ast-153"><span id="ast-154"><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.unmountdmg</span>(<span id="ast-156"><span id="ast-157" class="other_trans">mountpoints</span>[<span id="ast-158"><span id="ast-159">0</span></span>]</span>)</span></span><span id="ast-160"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-161" class="other_trans">retcode</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-162"><span id="ast-163"><span id="ast-164"><span id="ast-165" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_error</span>(<span id="ast-166">(<span id="ast-167">'No&nbsp;mountable&nbsp;filesystems&nbsp;on&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-169">dmgpath</span>)</span>)</span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-171">-1</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;add_common_vars(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">host_groups</span>,&nbsp;<span id="ast-5" class="other_trans">layout</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>common_vars</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">layout</span>[<span id="ast-10"><span id="ast-11">'vars'</span></span>]</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-13" class="other_trans">group</span>&nbsp;in&nbsp;<span id="ast-14" class="other_trans">host_groups</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>items</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">dict</span>(<span id="ast-21"><span id="ast-22"><span id="ast-23" class="correct_node">config&nbsp;&rarr;&nbsp;self.&nbsp;</span>.items</span>(<span id="ast-24" class="other_trans">group</span>)</span>)</span>.keys</span>()</span></span><span id="ast-25"><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.config</span>.remove_section</span>(<span id="ast-30" class="other_trans">group</span>)</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.config</span>.add_section</span>(<span id="ast-36" class="other_trans">group</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-38" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-39" class="other_trans">items</span>:<span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>host_string</span>&nbsp;=&nbsp;<span id="ast-42" class="other_trans">item</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-44" class="other_trans">var</span>&nbsp;in&nbsp;<span id="ast-45" class="other_trans">common_vars</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48"><span id="ast-49" class="other_trans">common_vars</span>[<span id="ast-50"><span id="ast-51" class="other_trans">var</span></span>]</span><span id="ast-52" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-53">'__IP__'</span>)</span>:<span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>host_string</span>&nbsp;+=&nbsp;<span id="ast-57">(<span id="ast-58">(<span id="ast-59">(<span id="ast-60">(<span id="ast-61">'&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-63" class="other_trans">var</span>)</span>&nbsp;+&nbsp;<span id="ast-65">'='</span>)</span>&nbsp;+&nbsp;<span id="ast-67" class="other_trans">item</span>)</span>&nbsp;+&nbsp;<span id="ast-69">'&nbsp;'</span>)</span></span></span></span><span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.config</span>.set</span>(<span id="ast-75" class="other_trans">group</span>,&nbsp;<span id="ast-76" class="other_trans">host_string</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;provide_context_and_uptodate(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">classification</span>,&nbsp;<span id="ast-5">lang</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Provide&nbsp;data&nbsp;for&nbsp;the&nbsp;context&nbsp;and&nbsp;the&nbsp;uptodate&nbsp;list&nbsp;for&nbsp;the&nbsp;list&nbsp;of&nbsp;the&nbsp;given&nbsp;classifiation.'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>hierarchy</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.extract_hierarchy</span>(<span id="ast-13">classification</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>&nbsp;=&nbsp;<span id="ast-16">{<span id="ast-17">'messages'</span>:&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>.site</span>.MESSAGES</span>}</span></span><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>page_kind</span>&nbsp;=&nbsp;<span id="ast-23">'list'</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25"><span id="ast-26">self</span>.show_list_as_index</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-30">(<span id="ast-31">not</span>&nbsp;<span id="ast-32"><span id="ast-33">self</span>.show_list_as_subcategories_list</span>)</span>&nbsp;or&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36">len</span>(<span id="ast-37">hierarchy</span>)</span><span id="ast-38" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39"><span id="ast-40">self</span>.max_levels</span>)</span>)</span>:<span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>page_kind</span>&nbsp;=&nbsp;<span id="ast-43">'index'</span></span></span></span><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46"><span id="ast-47">len</span>(<span id="ast-48" class="other_trans">hierarchy</span>)</span><span id="ast-49" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-50">0</span>)</span>:<span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>title</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">kw</span>[<span id="ast-57"><span id="ast-58">'messages'</span></span>]</span>[<span id="ast-59"><span id="ast-60" class="other_trans">lang</span></span>]</span>[<span id="ast-61"><span id="ast-62">'Archive'</span></span>]</span></span><span id="ast-63"><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-66"><span id="ast-67">'is_feed_stale'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-68">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-70">(<span id="ast-71"><span id="ast-72">len</span>(<span id="ast-73">hierarchy</span>)</span><span id="ast-74" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-75">1</span>)</span>:<span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>title</span>&nbsp;=&nbsp;<span id="ast-78">(<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">kw</span>[<span id="ast-83"><span id="ast-84">'messages'</span></span>]</span>[<span id="ast-85"><span id="ast-86" class="other_trans">lang</span></span>]</span>[<span id="ast-87"><span id="ast-88">'Posts&nbsp;for&nbsp;year&nbsp;%s'</span></span>]</span>&nbsp;%&nbsp;<span id="ast-90"><span id="ast-91" class="other_trans">hierarchy</span>[<span id="ast-92"><span id="ast-93">0</span></span>]</span>)</span></span><span id="ast-94"><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-97"><span id="ast-98">'is_feed_stale'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-99">(<span id="ast-100"><span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans">datetime</span>.datetime</span>.utcnow</span>()</span>.strftime</span>(<span id="ast-106">'%Y'</span>)</span><span id="ast-107" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-108"><span id="ast-109">hierarchy</span>[<span id="ast-110"><span id="ast-111">0</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-113">(<span id="ast-114"><span id="ast-115" class="other_trans">len</span>(<span id="ast-116" class="other_trans">hierarchy</span>)</span><span id="ast-117" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-118">2</span>)</span>:<span id="ast-119"><span id="ast-120"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>title</span>&nbsp;=&nbsp;<span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans">kw</span>[<span id="ast-127"><span id="ast-128">'messages'</span></span>]</span>[<span id="ast-129"><span id="ast-130" class="other_trans">lang</span></span>]</span>[<span id="ast-131"><span id="ast-132">'Posts&nbsp;for&nbsp;{month}&nbsp;{year}'</span></span>]</span>.format</span>(year=<span id="ast-134"><span id="ast-135" class="other_trans">hierarchy</span>[<span id="ast-136"><span id="ast-137">0</span></span>]</span>,&nbsp;month=<span id="ast-139"><span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143"><span id="ast-144">nikola</span>.utils</span>.LocaleBorg</span>()</span>.get_month_name</span>(<span id="ast-145"><span id="ast-146">int</span>(<span id="ast-147"><span id="ast-148">hierarchy</span>[<span id="ast-149"><span id="ast-150">1</span></span>]</span>)</span>,&nbsp;<span id="ast-151" class="other_trans">lang</span>)</span>)</span></span><span id="ast-152"><span id="ast-153"><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-155"><span id="ast-156">'is_feed_stale'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-157">(<span id="ast-158"><span id="ast-159"><span id="ast-160"><span id="ast-161"><span id="ast-162"><span id="ast-163">datetime</span>.datetime</span>.utcnow</span>()</span>.strftime</span>(<span id="ast-164">'%Y/%m'</span>)</span><span id="ast-165" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-166" class="other_trans">classification</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-168">(<span id="ast-169"><span id="ast-170">len</span>(<span id="ast-171">hierarchy</span>)</span><span id="ast-172" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-173">3</span>)</span>:<span id="ast-174"><span id="ast-175" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>title</span>&nbsp;=&nbsp;<span id="ast-176"><span id="ast-177"><span id="ast-178"><span id="ast-179"><span id="ast-180"><span id="ast-181">kw</span>[<span id="ast-182"><span id="ast-183">'messages'</span></span>]</span>[<span id="ast-184"><span id="ast-185">lang</span></span>]</span>[<span id="ast-186"><span id="ast-187">'Posts&nbsp;for&nbsp;{month}&nbsp;{day},&nbsp;{year}'</span></span>]</span>.format</span>(year=<span id="ast-189"><span id="ast-190" class="other_trans">hierarchy</span>[<span id="ast-191"><span id="ast-192">0</span></span>]</span>,&nbsp;month=<span id="ast-194"><span id="ast-195"><span id="ast-196"><span id="ast-197"><span id="ast-198"><span id="ast-199">nikola</span>.utils</span>.LocaleBorg</span>()</span>.get_month_name</span>(<span id="ast-200"><span id="ast-201">int</span>(<span id="ast-202"><span id="ast-203" class="other_trans">hierarchy</span>[<span id="ast-204"><span id="ast-205">1</span></span>]</span>)</span>,&nbsp;<span id="ast-206" class="other_trans">lang</span>)</span>,&nbsp;day=<span id="ast-208"><span id="ast-209">int</span>(<span id="ast-210"><span id="ast-211">hierarchy</span>[<span id="ast-212"><span id="ast-213">2</span></span>]</span>)</span>)</span></span><span id="ast-214"><span id="ast-215"><span id="ast-216" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-217"><span id="ast-218">'is_feed_stale'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-219">(<span id="ast-220"><span id="ast-221"><span id="ast-222"><span id="ast-223"><span id="ast-224"><span id="ast-225" class="other_trans">datetime</span>.datetime</span>.utcnow</span>()</span>.strftime</span>(<span id="ast-226">'%Y/%m/%d'</span>)</span><span id="ast-227" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-228" class="incorrect_node">classification&nbsp;&rarr;&nbsp;title&nbsp;</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-229"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-230"><span id="ast-231">Exception</span>(<span id="ast-232"><span id="ast-233"><span id="ast-234">'Cannot&nbsp;interpret&nbsp;classification&nbsp;{}!'</span>.format</span>(<span id="ast-235"><span id="ast-236" class="other_trans">repr</span>(<span id="ast-237" class="other_trans">classification</span>)</span>)</span>)</span></span></span><span id="ast-238"><span id="ast-239" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>&nbsp;=&nbsp;<span id="ast-240">{<span id="ast-241">'title'</span>:&nbsp;<span id="ast-244" class="other_trans">title</span>,&nbsp;<span id="ast-242">'classification_title'</span>:&nbsp;<span id="ast-245" class="other_trans">classification</span>,&nbsp;<span id="ast-243">'pagekind'</span>:&nbsp;<span id="ast-246">[<span id="ast-247">page_kind</span>,&nbsp;<span id="ast-248">'archive_page'</span>]</span>}</span></span><span id="ast-249"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-250">(<span id="ast-251" class="other_trans">page_kind</span><span id="ast-252" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-253">'index'</span>)</span>:<span id="ast-254"><span id="ast-255"><span id="ast-256"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>[<span id="ast-257"><span id="ast-258">'archive_name'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-259" class="ref_node">title&nbsp;&rarr;&nbsp;classification&nbsp;</span></span><span id="ast-260"><span id="ast-261"><span id="ast-262"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>context</span>[<span id="ast-263"><span id="ast-264">'is_feed_stale'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-265"><span id="ast-266" class="other_trans">kw</span>[<span id="ast-267"><span id="ast-268">'is_feed_stale'</span></span>]</span></span></span><span id="ast-269"><span id="ast-270"><span id="ast-271"><span id="ast-272"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>.update</span>(<span id="ast-273">context</span>)</span></span><span id="ast-274"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-275">(<span id="ast-276">context</span>,&nbsp;<span id="ast-277" class="other_trans">kw</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_post_dict(<span id="ast-2"><span id="ast-3" class="other_trans">index</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">0</span><span id="ast-7" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-9" class="other_trans">index</span><span id="ast-8" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-10"><span id="ast-11" class="other_trans">len</span>(<span id="ast-12" class="other_trans">posts</span>)</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">posts</span>[<span id="ast-18"><span id="ast-19" class="other_trans">index</span></span>]</span>.to_dict</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;clean(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>.article</span>.published</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">ValidationError</span>(<span id="ast-13">'Article&nbsp;not&nbsp;published!'</span>)</span></span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.article</span>.date_available</span><span id="ast-19" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">timezone</span>.now</span>()</span>)</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">ValidationError</span>(<span id="ast-26">'Article&nbsp;not&nbsp;published!'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse_run(<span id="ast-2"><span id="ast-3" class="other_trans">s</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">int</span>(<span id="ast-9">s</span>)</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-11">ValueError</span>:<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.critical</span>(<span id="ast-16">'Error:&nbsp;Unknown&nbsp;run&nbsp;%s'</span>,&nbsp;<span id="ast-17" class="other_trans">s</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-19">UsageError</span></span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-23">(<span id="ast-24" class="other_trans">r</span><span id="ast-25" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-26">0</span>)</span>&nbsp;or&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">r</span><span id="ast-29" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-30"><span id="ast-31" class="other_trans">len</span>(<span id="ast-32" class="other_trans">runs</span>)</span>)</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.critical</span>(<span id="ast-37">'Error:&nbsp;Expected&nbsp;0&nbsp;&lt;=&nbsp;run&nbsp;&lt;=&nbsp;%d,&nbsp;got&nbsp;%d'</span>,&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40">len</span>(<span id="ast-41">runs</span>)</span>&nbsp;-&nbsp;<span id="ast-43">1</span>)</span>,&nbsp;<span id="ast-44" class="other_trans">r</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-49">1</span>)</span></span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51">r</span></span></span><span id="ast-52"><span class="whitespace"><br />
</span>for&nbsp;<span id="ast-53" class="other_trans">run_item</span>&nbsp;in&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">selected_runs</span>.split</span>(<span id="ast-57">','</span>)</span>:<span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>run_item</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans">run_item</span>.strip</span>()</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65">run_item</span><span id="ast-66">&nbsp;in&nbsp;</span><span id="ast-67">name_map</span>)</span>:<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run_list</span>.append</span>(<span id="ast-72"><span id="ast-73">name_map</span>[<span id="ast-74"><span id="ast-75" class="other_trans">run_item</span></span>]</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sep</span>&nbsp;=&nbsp;<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans">run_item</span>.find</span>(<span id="ast-82">'-'</span>)</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85" class="other_trans">sep</span><span id="ast-86" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-87">-1</span>)</span>:<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run_list</span>.append</span>(<span id="ast-92"><span id="ast-93">parse_run</span>(<span id="ast-94" class="other_trans">run_item</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96">(<span id="ast-97" class="other_trans">sep</span><span id="ast-98" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-99">0</span>)</span>:<span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103" class="other_trans">parse_run</span>(<span id="ast-104"><span id="ast-105">run_item</span>[<span id="ast-106">:<span id="ast-107" class="other_trans">sep</span></span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first</span>&nbsp;=&nbsp;<span id="ast-110">0</span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112">(<span id="ast-113">(<span id="ast-114">sep</span>&nbsp;+&nbsp;<span id="ast-116">1</span>)</span><span id="ast-117" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-118"><span id="ast-119">len</span>(<span id="ast-120" class="other_trans">run_item</span>)</span>)</span>:<span id="ast-121"><span id="ast-122" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last</span>&nbsp;=&nbsp;<span id="ast-123"><span id="ast-124" class="other_trans">parse_run</span>(<span id="ast-125"><span id="ast-126" class="other_trans">run_item</span>[<span id="ast-127"><span id="ast-128">(<span id="ast-129" class="other_trans">sep</span>&nbsp;+&nbsp;<span id="ast-131">1</span>)</span>:</span>]</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>last</span>&nbsp;=&nbsp;<span id="ast-134">(<span id="ast-135"><span id="ast-136" class="other_trans">len</span>(<span id="ast-137">runs</span>)</span>&nbsp;-&nbsp;<span id="ast-139">1</span>)</span></span></span><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-141">(<span id="ast-142" class="other_trans">last</span><span id="ast-143" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-144" class="other_trans">first</span>)</span>:<span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.critical</span>(<span id="ast-149">'Error:&nbsp;Last&nbsp;run&nbsp;number&nbsp;should&nbsp;be&nbsp;greater&nbsp;than&nbsp;the&nbsp;first'</span>)</span></span><span id="ast-150"><span id="ast-151"><span id="ast-152"><span id="ast-153" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-154">1</span>)</span></span></span><span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run_list</span>.extend</span>(<span id="ast-159"><span id="ast-160">irange</span>(<span id="ast-161" class="other_trans">first</span>,&nbsp;<span id="ast-162">(<span id="ast-163" class="other_trans">last</span>&nbsp;+&nbsp;<span id="ast-165">1</span>)</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">byte_code</span>,&nbsp;<span id="ast-5" class="other_trans">arguments</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pc</span>&nbsp;=&nbsp;<span id="ast-9">0</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>stack</span>&nbsp;=&nbsp;<span id="ast-12">[]</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>variables</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-16">[<span id="ast-17" class="other_trans">None</span>]</span>&nbsp;*&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">len</span>(<span id="ast-21"><span id="ast-22" class="other_trans">byte_code</span>.variables</span>)</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">len</span>(<span id="ast-27"><span id="ast-28" class="other_trans">byte_code</span>.arguments</span>)</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30"><span id="ast-31" class="other_trans">len</span>(<span id="ast-32" class="other_trans">arguments</span>)</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-34" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-35"><span id="ast-36">xrange</span>(<span id="ast-37"><span id="ast-38" class="other_trans">len</span>(<span id="ast-39"><span id="ast-40" class="other_trans">byte_code</span>.arguments</span>)</span>)</span>:<span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">byte_code</span>.arguments</span>[<span id="ast-46"><span id="ast-47" class="other_trans">i</span></span>]</span></span><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>index</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">byte_code</span>.variables</span>[<span id="ast-53"><span id="ast-54" class="other_trans">name</span></span>]</span></span><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>variables</span>[<span id="ast-58"><span id="ast-59" class="other_trans">index</span></span>]</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61" class="correct_node">variables&nbsp;&rarr;&nbsp;arguments&nbsp;</span>[<span id="ast-62"><span id="ast-63" class="other_trans">i</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;initializeInputFiles(<span id="ast-2"><span id="ast-3">args</span>,&nbsp;<span id="ast-4" class="other_trans">mainDirectory</span>,&nbsp;<span id="ast-5">maskDir</span></span>):<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10" class="other_trans">len</span>(<span id="ast-11">args</span>)</span><span id="ast-12" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-13">1</span>)</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-15">'Error:&nbsp;no&nbsp;source&nbsp;image&nbsp;provided\\u000a'</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>()</span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-21">i</span>&nbsp;in&nbsp;<span id="ast-22"><span id="ast-23">range</span>(<span id="ast-24"><span id="ast-25" class="other_trans">len</span>(<span id="ast-26">args</span>)</span>)</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ext</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31">splitext</span>(<span id="ast-32"><span id="ast-33">args</span>[<span id="ast-34"><span id="ast-35">i</span></span>]</span>)</span>[<span id="ast-36"><span id="ast-37">1</span></span>]</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41"><span id="ast-42">re</span>.match</span>(<span id="ast-43">'.mnc'</span>,&nbsp;<span id="ast-44" class="other_trans">ext</span>)</span><span id="ast-45" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-46">None</span>)</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-48">'Error:&nbsp;input&nbsp;file&nbsp;is&nbsp;not&nbsp;a&nbsp;MINC&nbsp;file:,&nbsp;'</span>,&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">args</span>[<span id="ast-51"><span id="ast-52">i</span></span>]</span>,&nbsp;<span id="ast-53">'\\u000a'</span></span><span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>()</span></span></span></span><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>inputs</span>&nbsp;=&nbsp;<span id="ast-60">[]</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-62">(<span id="ast-63">not</span>&nbsp;<span id="ast-64">(<span id="ast-65"><span id="ast-66">type</span>(<span id="ast-67" class="other_trans">args</span>)</span><span id="ast-68" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-69">list</span>)</span>)</span>:<span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-72">[<span id="ast-73" class="other_trans">args</span>]</span></span></span><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-75" class="other_trans">iFile</span>&nbsp;in&nbsp;<span id="ast-76"><span id="ast-77">range</span>(<span id="ast-78"><span id="ast-79">len</span>(<span id="ast-80" class="other_trans">args</span>)</span>)</span>:<span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>inputPipeFH</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">rfh</span>.RegistrationPipeFH</span>(<span id="ast-86"><span id="ast-87" class="other_trans">abspath</span>(<span id="ast-88"><span id="ast-89" class="other_trans">args</span>[<span id="ast-90"><span id="ast-91" class="other_trans">iFile</span></span>]</span>)</span>,&nbsp;basedir=<span id="ast-93" class="other_trans">mainDirectory</span>)</span></span><span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>inputs</span>.append</span>(<span id="ast-98">inputPipeFH</span>)</span></span></span><span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'After&nbsp;file&nbsp;handlers&nbsp;initialized,&nbsp;assign&nbsp;mask&nbsp;to&nbsp;each&nbsp;file\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;directory&nbsp;of&nbsp;masks&nbsp;is&nbsp;specified,&nbsp;apply&nbsp;to&nbsp;each&nbsp;file&nbsp;handler.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Two&nbsp;options:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;One&nbsp;mask&nbsp;in&nbsp;directory&nbsp;--&gt;&nbsp;use&nbsp;for&nbsp;all&nbsp;scans.&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Same&nbsp;number&nbsp;of&nbsp;masks&nbsp;as&nbsp;files,&nbsp;with&nbsp;same&nbsp;naming&nbsp;convention.&nbsp;Individual\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mask&nbsp;for&nbsp;each&nbsp;scan.&nbsp;&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-102" class="other_trans">maskDir</span>:<span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>absMaskPath</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106">abspath</span>(<span id="ast-107" class="other_trans">maskDir</span>)</span></span><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>masks</span>&nbsp;=&nbsp;<span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113"><span id="ast-114">walk</span>(<span id="ast-115" class="other_trans">absMaskPath</span>)</span>.next</span>()</span>[<span id="ast-116"><span id="ast-117">2</span></span>]</span></span><span id="ast-118"><span id="ast-119" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>numMasks</span>&nbsp;=&nbsp;<span id="ast-120"><span id="ast-121">len</span>(<span id="ast-122">masks</span>)</span></span><span id="ast-123"><span id="ast-124" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>numScans&nbsp;&rarr;&nbsp;numMasks&nbsp;</span>&nbsp;=&nbsp;<span id="ast-125"><span id="ast-126">len</span>(<span id="ast-127">inputs</span>)</span></span><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-129">(<span id="ast-130" class="other_trans">numMasks</span><span id="ast-131" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-132">1</span>)</span>:<span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-134">inputFH</span>&nbsp;in&nbsp;<span id="ast-135">inputs</span>:<span id="ast-136"><span id="ast-137"><span id="ast-138"><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>inputFH</span>.setMask</span>(<span id="ast-140">(<span id="ast-141">(<span id="ast-142">absMaskPath</span>&nbsp;+&nbsp;<span id="ast-144">'/'</span>)</span>&nbsp;+&nbsp;<span id="ast-146"><span id="ast-147">masks</span>[<span id="ast-148"><span id="ast-149">0</span></span>]</span>)</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-151">(<span id="ast-152" class="other_trans">numMasks</span><span id="ast-153" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-154">numScans</span>)</span>:<span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-156">m</span>&nbsp;in&nbsp;<span id="ast-157">masks</span>:<span id="ast-158"><span id="ast-159" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>maskBase</span>&nbsp;=&nbsp;<span id="ast-160"><span id="ast-161"><span id="ast-162"><span id="ast-163"><span id="ast-164"><span id="ast-165">fh</span>.removeBaseAndExtension</span>(<span id="ast-166" class="other_trans">m</span>)</span>.split</span>(<span id="ast-167">'_mask'</span>)</span>[<span id="ast-168"><span id="ast-169">0</span></span>]</span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-171">inputFH</span>&nbsp;in&nbsp;<span id="ast-172" class="other_trans">inputs</span>:<span id="ast-173"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-174"><span id="ast-175"><span id="ast-176" class="other_trans">fnmatch</span>.fnmatch</span>(<span id="ast-177"><span id="ast-178"><span id="ast-179">inputFH</span>.getLastBasevol</span>()</span>,&nbsp;<span id="ast-180">(<span id="ast-181">(<span id="ast-182">'*'</span>&nbsp;+&nbsp;<span id="ast-184" class="other_trans">maskBase</span>)</span>&nbsp;+&nbsp;<span id="ast-186">'*'</span>)</span>)</span>:<span id="ast-187"><span id="ast-188"><span id="ast-189"><span id="ast-190"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>inputFH</span>.setMask</span>(<span id="ast-191">(<span id="ast-192">(<span id="ast-193">absMaskPath</span>&nbsp;+&nbsp;<span id="ast-195">'/'</span>)</span>&nbsp;+&nbsp;<span id="ast-197">m</span>)</span>)</span></span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-198"><span id="ast-199"><span id="ast-200"><span id="ast-201"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-202">'Number&nbsp;of&nbsp;masks&nbsp;in&nbsp;directory&nbsp;does&nbsp;not&nbsp;match&nbsp;number&nbsp;of&nbsp;scans,&nbsp;but&nbsp;is&nbsp;greater&nbsp;than&nbsp;1.&nbsp;Exiting...'</span>)</span></span><span id="ast-203"><span id="ast-204"><span id="ast-205"><span id="ast-206" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-207"><span id="ast-208"><span id="ast-209"><span id="ast-210" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.info</span>(<span id="ast-211">'No&nbsp;mask&nbsp;directory&nbsp;specified&nbsp;as&nbsp;command&nbsp;line&nbsp;option.&nbsp;No&nbsp;masks&nbsp;included&nbsp;during&nbsp;RegistrationPipeFH&nbsp;initialization.'</span>)</span></span></span><span id="ast-212"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-213">inputs</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_moved(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Has&nbsp;the&nbsp;library&nbsp;been&nbsp;moved?'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>old_root</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9">self</span>._realroot</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">old_root</span><span id="ast-13" class="correct_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-14"><span id="ast-15">self</span>.root</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">conf</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>libs</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">packages</span>.build_srcs</span>(<span id="ast-10" class="other_trans">conf</span>,&nbsp;<span id="ast-11"><span id="ast-12">self</span>.libs</span>)</span></span><span id="ast-13"><span id="ast-14" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>srcs&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">packages</span>.build_srcs</span>(<span id="ast-18" class="other_trans">conf</span>,&nbsp;<span id="ast-19" class="ref_node">srcs&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_list(<span id="ast-2"><span id="ast-3" class="other_trans">total</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">requests</span>.get</span>(<span id="ast-9">'http://localhost:5000/users'</span>)</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13" class="other_trans">r</span>.status_code</span><span id="ast-14" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-15">200</span>)</span>,&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">r</span>.status_code</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">r</span>.json</span>()</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26">data</span>[<span id="ast-27"><span id="ast-28">'_total'</span></span>]</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30" class="other_trans">total</span>)</span>,&nbsp;<span id="ast-31">(<span id="ast-32">'expected&nbsp;%s,&nbsp;got&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-34">(<span id="ast-35" class="other_trans">total</span>,&nbsp;<span id="ast-36"><span id="ast-37">data</span>[<span id="ast-38"><span id="ast-39">'_total'</span></span>]</span>)</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-41">(<span id="ast-42"><span id="ast-43">len</span>(<span id="ast-44"><span id="ast-45">data</span>[<span id="ast-46"><span id="ast-47">'_items'</span></span>]</span>)</span><span id="ast-48" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-49">total</span>)</span>,&nbsp;<span id="ast-50">(<span id="ast-51">'expected&nbsp;%s,&nbsp;got&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-53">(<span id="ast-54" class="other_trans">total</span>,&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">len</span>(<span id="ast-57"><span id="ast-58" class="other_trans">data</span>[<span id="ast-59"><span id="ast-60">'_items'</span></span>]</span>)</span>)</span>)</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-62" class="other_trans">data</span></span></span><span id="ast-63"><span class="whitespace"><br />
</span>with&nbsp;<span id="ast-64"><span id="ast-65">Tester</span>(<span id="ast-66">'List&nbsp;all'</span>)</span>:<span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70">test_list</span>(<span id="ast-71">7</span>)</span></span></span><span id="ast-72"><span class="whitespace"><br />
</span>with&nbsp;<span id="ast-73"><span id="ast-74">Tester</span>(<span id="ast-75">'Get&nbsp;one&nbsp;by&nbsp;id'</span>)</span>:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80">data</span>[<span id="ast-81"><span id="ast-82">'_items'</span></span>]</span>[<span id="ast-83"><span id="ast-84">0</span></span>]</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89">requests</span>.get</span>(<span id="ast-90">(<span id="ast-91">'http://localhost:5000/users/%s'</span>&nbsp;%&nbsp;<span id="ast-93"><span id="ast-94">user</span>[<span id="ast-95"><span id="ast-96">'id'</span></span>]</span>)</span>)</span></span><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-98">(<span id="ast-99"><span id="ast-100" class="other_trans">r</span>.status_code</span><span id="ast-101" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-102">200</span>)</span>,&nbsp;<span id="ast-103"><span id="ast-104" class="other_trans">r</span>.status_code</span></span><span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109">r</span>.json</span>()</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-111">(<span id="ast-112">user</span><span id="ast-113" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-114">data</span>)</span>,&nbsp;<span id="ast-115">(<span id="ast-116">'user:&nbsp;%s,&nbsp;data:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-118">(<span id="ast-119">user</span>,&nbsp;<span id="ast-120" class="other_trans">data</span>)</span>)</span></span></span><span id="ast-121"><span class="whitespace"><br />
</span>with&nbsp;<span id="ast-122"><span id="ast-123">Tester</span>(<span id="ast-124">'Get&nbsp;one&nbsp;by&nbsp;nick'</span>)</span>:<span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-127"><span id="ast-128"><span id="ast-129" class="other_trans">requests</span>.get</span>(<span id="ast-130">(<span id="ast-131">'http://localhost:5000/users/%s'</span>&nbsp;%&nbsp;<span id="ast-133"><span id="ast-134" class="other_trans">user</span>[<span id="ast-135"><span id="ast-136">'nick'</span></span>]</span>)</span>)</span></span><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-138">(<span id="ast-139"><span id="ast-140">r</span>.status_code</span><span id="ast-141" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-142">200</span>)</span>,&nbsp;<span id="ast-143"><span id="ast-144" class="other_trans">r</span>.status_code</span></span><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-146">(<span id="ast-147" class="other_trans">data</span><span id="ast-148" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-149"><span id="ast-150"><span id="ast-151">r</span>.json</span>()</span>)</span>,&nbsp;<span id="ast-152">(<span id="ast-153">'data:&nbsp;%s,&nbsp;nick_data:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-155">(<span id="ast-156" class="incorrect_node">data&nbsp;&rarr;&nbsp;total&nbsp;</span>,&nbsp;<span id="ast-157"><span id="ast-158"><span id="ast-159">r</span>.json</span>()</span>)</span>)</span></span></span><span id="ast-160"><span class="whitespace"><br />
</span>with&nbsp;<span id="ast-161"><span id="ast-162">Tester</span>(<span id="ast-163">'404&nbsp;on&nbsp;one'</span>)</span>:<span id="ast-164"><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-166"><span id="ast-167"><span id="ast-168" class="other_trans">requests</span>.get</span>(<span id="ast-169">'http://localhost:5000/users/572c59bf13abf21bf84890a0'</span>)</span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-171">(<span id="ast-172"><span id="ast-173">r</span>.status_code</span><span id="ast-174" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-175">404</span>)</span>,&nbsp;<span id="ast-176"><span id="ast-177" class="other_trans">r</span>.status_code</span></span></span><span id="ast-178"><span class="whitespace"><br />
</span>with&nbsp;<span id="ast-179"><span id="ast-180">Tester</span>(<span id="ast-181">'Create&nbsp;one'</span>)</span>:<span id="ast-182"><span id="ast-183" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>payload</span>&nbsp;=&nbsp;<span id="ast-184">{<span id="ast-185">'nick'</span>:&nbsp;<span id="ast-188">'n00b'</span>,&nbsp;<span id="ast-186">'birthday'</span>:&nbsp;<span id="ast-189">'2016-05-18T11:40:32+00:00'</span>,&nbsp;<span id="ast-187">'password'</span>:&nbsp;<span id="ast-190">'123456'</span>}</span></span><span id="ast-191"><span id="ast-192"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-193"><span id="ast-194"><span id="ast-195">requests</span>.post</span>(<span id="ast-196">'http://localhost:5000/users'</span>,&nbsp;json=<span id="ast-198" class="other_trans">payload</span>)</span></span><span id="ast-199"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-200">(<span id="ast-201"><span id="ast-202">r</span>.status_code</span><span id="ast-203" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-204">200</span>)</span>,&nbsp;<span id="ast-205"><span id="ast-206" class="other_trans">r</span>.status_code</span></span><span id="ast-207"><span id="ast-208" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-209"><span id="ast-210"><span id="ast-211" class="other_trans">r</span>.json</span>()</span></span><span id="ast-212"><span id="ast-213"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_user_id</span>&nbsp;=&nbsp;<span id="ast-214"><span id="ast-215"><span id="ast-216" class="other_trans">data</span>.pop</span>(<span id="ast-217">'id'</span>)</span></span><span id="ast-218"><span id="ast-219" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>expected</span>&nbsp;=&nbsp;<span id="ast-220">{<span id="ast-221">'nick'</span>:&nbsp;<span id="ast-223">'n00b'</span>,&nbsp;<span id="ast-222">'birthday'</span>:&nbsp;<span id="ast-224">'2016-05-18T11:40:32+00:00'</span>}</span></span><span id="ast-225"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-226">(<span id="ast-227" class="other_trans">data</span><span id="ast-228" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-229">expected</span>)</span>,&nbsp;<span id="ast-230">(<span id="ast-231">'data:&nbsp;%s,&nbsp;expected:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-233">(<span id="ast-234" class="ref_node">payload&nbsp;&rarr;&nbsp;data&nbsp;</span>,&nbsp;<span id="ast-235">expected</span>)</span>)</span></span><span id="ast-236"><span id="ast-237"><span id="ast-238"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>test_list</span>(<span id="ast-239">8</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;resolve_redirects(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">resp</span>,&nbsp;<span id="ast-5" class="other_trans">req</span>,&nbsp;<span id="ast-6" class="other_trans">stream</span>,&nbsp;<span id="ast-8" class="other_trans">timeout</span>,&nbsp;<span id="ast-10" class="other_trans">verify</span>,&nbsp;<span id="ast-12" class="other_trans">cert</span>,&nbsp;<span id="ast-14" class="other_trans">proxies</span></span>):<span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Receives&nbsp;a&nbsp;Response.&nbsp;Returns&nbsp;a&nbsp;generator&nbsp;of&nbsp;Responses.'</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-20">0</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-22">(<span id="ast-24">(<span id="ast-25">'location'</span><span id="ast-26">&nbsp;in&nbsp;</span><span id="ast-27"><span id="ast-28" class="other_trans">resp</span>.headers</span>)</span>&nbsp;and&nbsp;<span id="ast-29">(<span id="ast-30"><span id="ast-31" class="other_trans">resp</span>.status_code</span><span id="ast-32">&nbsp;in&nbsp;</span><span id="ast-33" class="other_trans">REDIRECT_STATI</span>)</span>)</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-35" class="other_trans">cookie</span>&nbsp;in&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">resp</span>.cookies</span>:<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.cookies</span>.set_cookie</span>(<span id="ast-43" class="other_trans">cookie</span>)</span></span></span><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resp</span>.content</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48">(<span id="ast-49" class="other_trans">i</span><span id="ast-50" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-51"><span id="ast-52">self</span>.max_redirects</span>)</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">TooManyRedirects</span>(<span id="ast-56">(<span id="ast-57">'Exceeded&nbsp;%s&nbsp;redirects.'</span>&nbsp;%&nbsp;<span id="ast-59"><span id="ast-60">self</span>.max_redirects</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;log(<span id="ast-2"><span id="ast-3" class="other_trans">text</span>,&nbsp;<span id="ast-4" class="other_trans">level</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8" class="other_trans">log_level</span><span id="ast-9" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>,&nbsp;pred:&nbsp;<=&nbsp;</span><span id="ast-10" class="other_trans">level</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-12" class="other_trans">text</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;transplant(<span id="ast-2"><span id="ast-3" class="other_trans">exif_src</span>,&nbsp;<span id="ast-4" class="other_trans">image</span>,&nbsp;<span id="ast-5">new_file</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Transplants&nbsp;exif&nbsp;to&nbsp;another&nbsp;JPEG\\u000a&nbsp;&nbsp;&nbsp;&nbsp;transplant(exif_src,&nbsp;image,&nbsp;new_file[optional])\\u000a&nbsp;&nbsp;&nbsp;&nbsp;When&nbsp;"new_file"&nbsp;is&nbsp;not&nbsp;given,&nbsp;"image"&nbsp;file&nbsp;is&nbsp;overwritten.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12" class="other_trans">exif_src</span>[<span id="ast-13"><span id="ast-14">0</span>:<span id="ast-15">2</span></span>]</span><span id="ast-16" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-17">'\\u00ff\\u00d8'</span>)</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>src_data</span>&nbsp;=&nbsp;<span id="ast-20" class="other_trans">exif_src</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">open</span>(<span id="ast-24">exif_src</span>,&nbsp;<span id="ast-25">'rb'</span>)</span>&nbsp;as&nbsp;<span id="ast-26" class="other_trans">f</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>src_data</span>&nbsp;=&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">f</span>.read</span>()</span></span></span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>segments</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">split_into_segments</span>(<span id="ast-36">src_data</span>)</span></span><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exif</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40">get_exif</span>(<span id="ast-41" class="other_trans">segments</span>)</span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-44" class="other_trans">exif</span><span id="ast-45" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-46">None</span>)</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">ValueError</span>(<span id="ast-50">'not&nbsp;found&nbsp;exif&nbsp;in&nbsp;input'</span>)</span></span></span><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_file</span>&nbsp;=&nbsp;<span id="ast-53">False</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57">image</span>[<span id="ast-58"><span id="ast-59">0</span>:<span id="ast-60">2</span></span>]</span><span id="ast-61" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-62">'\\u00ff\\u00d8'</span>)</span>:<span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>image_data</span>&nbsp;=&nbsp;<span id="ast-65">image</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">open</span>(<span id="ast-69" class="other_trans">image</span>,&nbsp;<span id="ast-70">'rb'</span>)</span>&nbsp;as&nbsp;<span id="ast-71" class="other_trans">f</span>:<span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>image_data</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans">f</span>.read</span>()</span></span></span><span id="ast-77"><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>output_file</span>&nbsp;=&nbsp;<span id="ast-79">True</span></span></span><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>segments</span>&nbsp;=&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">split_into_segments</span>(<span id="ast-84">image_data</span>)</span></span><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>image_exif</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88" class="other_trans">get_exif</span>(<span id="ast-89" class="other_trans">segments</span>)</span></span><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-91">image_exif</span>:<span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_data</span>&nbsp;=&nbsp;<span id="ast-94"><span id="ast-95"><span id="ast-96">image_data</span>.replace</span>(<span id="ast-97" class="other_trans">image_exif</span>,&nbsp;<span id="ast-98" class="other_trans">exif</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p</span>&nbsp;=&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103" class="ref_node">src_data&nbsp;&rarr;&nbsp;image_data&nbsp;</span>.find</span>(<span id="ast-104">'\\u00ff\\u00db'</span>)</span></span><span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_data</span>&nbsp;=&nbsp;<span id="ast-107">(<span id="ast-108">(<span id="ast-109"><span id="ast-110" class="incorrect_node">image_data&nbsp;&rarr;&nbsp;segments&nbsp;</span>[<span id="ast-111"><span id="ast-112">0</span>:<span id="ast-113" class="other_trans">p</span></span>]</span>&nbsp;+&nbsp;<span id="ast-115" class="other_trans">exif</span>)</span>&nbsp;+&nbsp;<span id="ast-117"><span id="ast-118">image_data</span>[<span id="ast-119"><span id="ast-120" class="other_trans">p</span>:</span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_current_activity(<span id="ast-2"><span id="ast-3" class="other_trans">activities</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">not</span>&nbsp;<span id="ast-7" class="other_trans">activities</span>)</span>:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-9" class="other_trans">None</span></span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>activities_with_no_end_years</span>&nbsp;=&nbsp;<span id="ast-12">[<span id="ast-13" class="other_trans">a</span><span id="ast-14">&nbsp;for&nbsp;<span id="ast-15" class="other_trans">a</span>&nbsp;in&nbsp;<span id="ast-16" class="other_trans">activities</span>&nbsp;if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">a</span>[<span id="ast-21"><span id="ast-22">'end_year'</span></span>]</span>)</span></span>]</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24" class="other_trans">activities_with_no_end_years</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">sorted</span>(<span id="ast-29" class="correct_node">activities&nbsp;&rarr;&nbsp;activities_with_no_end_years&nbsp;</span>,&nbsp;key=<span id="ast-31">lambda&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">k</span></span>:&nbsp;<span id="ast-34"><span id="ast-35" class="other_trans">k</span>[<span id="ast-36"><span id="ast-37">'start_year'</span></span>]</span></span>,&nbsp;reverse=<span id="ast-39">True</span>)</span>[<span id="ast-40"><span id="ast-41">0</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_capabilities(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>process_elements</span>&nbsp;=&nbsp;<span id="ast-6">[<span id="ast-7"><span id="ast-8"><span id="ast-9">p</span>.capabilities_xml</span>()</span><span id="ast-10">&nbsp;for&nbsp;<span id="ast-11" class="other_trans">p</span>&nbsp;in&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.processes</span>.values</span>()</span></span>]</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="incorrect_node">WPS&nbsp;&rarr;&nbsp;self.&nbsp;</span>.Capabilities</span>()</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.attrib</span>[<span id="ast-25"><span id="ast-26">'service'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-27">'WPS'</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.attrib</span>[<span id="ast-32"><span id="ast-33">'version'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-34">'1.0.0'</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.attrib</span>[<span id="ast-39"><span id="ast-40">'{http://www.w3.org/XML/1998/namespace}lang'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-41">'en-US'</span></span><span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.attrib</span>[<span id="ast-46"><span id="ast-47">'{http://www.w3.org/2001/XMLSchema-instance}schemaLocation'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-48">'http://www.opengis.net/wps/1.0.0&nbsp;http://schemas.opengis.net/wps/1.0.0/wpsDescribeProcess_response.xsd'</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>doc</span>.attrib</span>[<span id="ast-53"><span id="ast-54">'updateSequence'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-55">'1'</span></span><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>service_ident_doc</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60">OWS</span>.ServiceIdentification</span>(<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">OWS</span>.Title</span>(<span id="ast-64"><span id="ast-65"><span id="ast-66" class="other_trans">config</span>.get_config_value</span>(<span id="ast-67">'metadata:main'</span>,&nbsp;<span id="ast-68">'identification_title'</span>)</span>)</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">config</span>.get_config_value</span>(<span id="ast-73">'metadata:main'</span>,&nbsp;<span id="ast-74">'identification_abstract'</span>)</span>:<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>service_ident_doc</span>.append</span>(<span id="ast-79"><span id="ast-80"><span id="ast-81">OWS</span>.Abstract</span>(<span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans">config</span>.get_config_value</span>(<span id="ast-85">'metadata:main'</span>,&nbsp;<span id="ast-86">'identification_abstract'</span>)</span>)</span>)</span></span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90">config</span>.get_config_value</span>(<span id="ast-91">'metadata:main'</span>,&nbsp;<span id="ast-92">'identification_keywords'</span>)</span>:<span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>keywords_doc</span>&nbsp;=&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97" class="other_trans">OWS</span>.Keywords</span>()</span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-99" class="other_trans">k</span>&nbsp;in&nbsp;<span id="ast-100"><span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104">config</span>.get_config_value</span>(<span id="ast-105">'metadata:main'</span>,&nbsp;<span id="ast-106">'identification_keywords'</span>)</span>.split</span>(<span id="ast-107">','</span>)</span>:<span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-109" class="other_trans">k</span>:<span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>keywords_doc</span>.append</span>(<span id="ast-114"><span id="ast-115"><span id="ast-116" class="other_trans">OWS</span>.Keyword</span>(<span id="ast-117" class="other_trans">k</span>)</span>)</span></span></span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>service_ident_doc</span>.append</span>(<span id="ast-122" class="other_trans">keywords_doc</span>)</span></span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans">config</span>.get_config_value</span>(<span id="ast-127">'metadata:main'</span>,&nbsp;<span id="ast-128">'identification_keywords_type'</span>)</span>:<span id="ast-129"><span id="ast-130" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>keywords_type</span>&nbsp;=&nbsp;<span id="ast-131"><span id="ast-132"><span id="ast-133" class="other_trans">OWS</span>.Type</span>(<span id="ast-134"><span id="ast-135"><span id="ast-136" class="other_trans">config</span>.get_config_value</span>(<span id="ast-137">'metadata:main'</span>,&nbsp;<span id="ast-138">'identification_keywords_type'</span>)</span>)</span></span><span id="ast-139"><span id="ast-140"><span id="ast-141"><span id="ast-142" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>keywords_type</span>.attrib</span>[<span id="ast-143"><span id="ast-144">'codeSpace'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-145">'ISOTC211/19115'</span></span><span id="ast-146"><span id="ast-147"><span id="ast-148"><span id="ast-149" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>service_ident_doc&nbsp;&rarr;&nbsp;keywords_doc&nbsp;</span>.append</span>(<span id="ast-150" class="other_trans">keywords_type</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;client_for(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">config_path</span>,&nbsp;<span id="ast-5" class="other_trans">create</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>abs_path</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">os</span>.path</span>.abspath</span>(<span id="ast-13" class="other_trans">config_path</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">abs_path</span><span id="ast-17">&nbsp;in&nbsp;</span><span id="ast-18"><span id="ast-19">self</span>.clients</span>)</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.clients</span>[<span id="ast-24"><span id="ast-25" class="other_trans">abs_path</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-27" class="other_trans">create</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>client</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">EnsimeClient</span>(<span id="ast-32" class="ref_node">vim&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-33" class="incorrect_node">config_path&nbsp;&rarr;&nbsp;abs_path&nbsp;</span>)</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.clients</span>[<span id="ast-38"><span id="ast-39" class="other_trans">abs_path</span></span>]</span>&nbsp;=&nbsp;<span id="ast-40" class="other_trans">client</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.__message</span>(<span id="ast-45">'Starting&nbsp;up&nbsp;ensime&nbsp;server...'</span>)</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>client</span>.setup</span>()</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51" class="other_trans">client</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-53" class="other_trans">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;analyze(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">M_c</span>,&nbsp;<span id="ast-5" class="other_trans">T</span>,&nbsp;<span id="ast-6" class="other_trans">X_L</span>,&nbsp;<span id="ast-7">X_D</span>,&nbsp;<span id="ast-8" class="other_trans">kernel_list</span>,&nbsp;<span id="ast-10">n_steps</span>,&nbsp;<span id="ast-12" class="other_trans">c</span>,&nbsp;<span id="ast-14" class="other_trans">r</span>,&nbsp;<span id="ast-16">max_iterations</span>,&nbsp;<span id="ast-18" class="other_trans">max_time</span>,&nbsp;**kwargs</span>):<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_path</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23">self</span>.output_path</span></span><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>input_filename</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27">self</span>.input_filename</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>table_data_filename</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31">self</span>.table_data_filename</span></span><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>analyze_args_dict_filename</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35">self</span>.command_dict_filename</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>xu</span>.assert_vpn_is_connected</span>()</span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>table_data</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43">dict</span>(M_c=<span id="ast-45">M_c</span>,&nbsp;T=<span id="ast-47" class="other_trans">T</span>)</span></span><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>analyze_args_dict</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51">dict</span>(command=<span id="ast-53">'analyze'</span>,&nbsp;kernel_list=<span id="ast-55" class="other_trans">kernel_list</span>,&nbsp;n_steps=<span id="ast-57">n_steps</span>,&nbsp;c=<span id="ast-59">c</span>,&nbsp;r=<span id="ast-61">r</span>,&nbsp;max_time=<span id="ast-63">max_time</span>)</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-65">(<span id="ast-66">'chunk_size'</span><span id="ast-67">&nbsp;in&nbsp;</span><span id="ast-68" class="other_trans">kwargs</span>)</span>:<span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>chunk_size</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72">kwargs</span>[<span id="ast-73"><span id="ast-74">'chunk_size'</span></span>]</span></span><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>chunk_filename_prefix</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78">kwargs</span>[<span id="ast-79"><span id="ast-80">'chunk_filename_prefix'</span></span>]</span></span><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>chunk_dest_dir</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84" class="other_trans">kwargs</span>[<span id="ast-85"><span id="ast-86">'chunk_dest_dir'</span></span>]</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>analyze_args_dict</span>[<span id="ast-90"><span id="ast-91">'command'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-92">'chunk_analyze'</span></span><span id="ast-93"><span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>analyze_args_dict</span>[<span id="ast-96"><span id="ast-97">'chunk_size'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-98" class="other_trans">chunk_size</span></span><span id="ast-99"><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>analyze_args_dict</span>[<span id="ast-102"><span id="ast-103">'chunk_filename_prefix'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-104" class="other_trans">chunk_filename_prefix</span></span><span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>analyze_args_dict</span>[<span id="ast-108"><span id="ast-109">'chunk_dest_dir'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-110" class="other_trans">chunk_dest_dir</span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112">(<span id="ast-113">not</span>&nbsp;<span id="ast-114"><span id="ast-115"><span id="ast-116" class="other_trans">xu</span>.get_is_multistate</span>(<span id="ast-117">X_L</span>,&nbsp;<span id="ast-118">X_D</span>)</span>)</span>:<span id="ast-119"><span id="ast-120" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>X_L</span>&nbsp;=&nbsp;<span id="ast-121">[<span id="ast-122">X_L</span>]</span></span><span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>X_D</span>&nbsp;=&nbsp;<span id="ast-125">[<span id="ast-126">X_D</span>]</span></span></span><span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>SEEDS</span>&nbsp;=&nbsp;<span id="ast-129"><span id="ast-130"><span id="ast-131">kwargs</span>.get</span>(<span id="ast-132">'SEEDS'</span>,&nbsp;<span id="ast-133">None</span>)</span></span><span id="ast-134"><span id="ast-135"><span id="ast-136"><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>xu</span>.write_analyze_files</span>(<span id="ast-138" class="other_trans">input_filename</span>,&nbsp;<span id="ast-139">X_L</span>,&nbsp;<span id="ast-140">X_D</span>,&nbsp;<span id="ast-141" class="other_trans">table_data</span>,&nbsp;<span id="ast-142" class="incorrect_node">table_data_filename&nbsp;&rarr;&nbsp;X_L&nbsp;</span>,&nbsp;<span id="ast-143">analyze_args_dict</span>,&nbsp;<span id="ast-144" class="other_trans">analyze_args_dict_filename</span>,&nbsp;<span id="ast-145" class="other_trans">SEEDS</span>)</span></span><span id="ast-146"><span id="ast-147"><span id="ast-148"><span id="ast-149" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.system</span>(<span id="ast-150">(<span id="ast-151">'cp&nbsp;%s&nbsp;analyze_input'</span>&nbsp;%&nbsp;<span id="ast-153">input_filename</span>)</span>)</span></span><span id="ast-154"><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>n_tasks</span>&nbsp;=&nbsp;<span id="ast-156"><span id="ast-157">len</span>(<span id="ast-158" class="other_trans">X_L</span>)</span></span><span id="ast-159"><span id="ast-160"><span id="ast-161" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>send_hadoop_command&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-162">n_tasks</span>)</span></span><span id="ast-163"><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>was_successful</span>&nbsp;=&nbsp;<span id="ast-165"><span id="ast-166"><span id="ast-167">self</span>.get_hadoop_results</span>()</span></span><span id="ast-168"><span id="ast-169" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>hadoop_output</span>&nbsp;=&nbsp;<span id="ast-170">None</span></span><span id="ast-171"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-172">was_successful</span>:<span id="ast-173"><span id="ast-174"><span id="ast-175"><span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hu</span>.copy_hadoop_output</span>(<span id="ast-177" class="other_trans">output_path</span>,&nbsp;<span id="ast-178">'analyze_output'</span>)</span></span><span id="ast-179"><span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-181">X_L_list</span>,&nbsp;<span id="ast-182">X_D_list</span>)</span>&nbsp;=&nbsp;<span id="ast-183"><span id="ast-184"><span id="ast-185">hu</span>.read_hadoop_output</span>(<span id="ast-186" class="other_trans">output_path</span>)</span></span><span id="ast-187"><span id="ast-188" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hadoop_output</span>&nbsp;=&nbsp;<span id="ast-189">(<span id="ast-190">X_L_list</span>,&nbsp;<span id="ast-191">X_D_list</span>)</span></span></span><span id="ast-192"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-193" class="other_trans">hadoop_output</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_role_attribution(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">cli</span>,&nbsp;<span id="ast-5" class="other_trans">var</span>,&nbsp;<span id="ast-6">villagers</span>,&nbsp;<span id="ast-7">do_templates</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lpl</span>&nbsp;=&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12">len</span>(<span id="ast-13">villagers</span>)</span>&nbsp;-&nbsp;<span id="ast-15">1</span>)</span></span><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>&nbsp;=&nbsp;<span id="ast-18">{}</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-20">role</span>&nbsp;in&nbsp;<span id="ast-21"><span id="ast-22">var</span>.ROLE_GUIDE</span>:<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-26"><span id="ast-27" class="other_trans">role</span></span>]</span>&nbsp;=&nbsp;<span id="ast-28">0</span></span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>wolves</span>&nbsp;=&nbsp;<span id="ast-31">(<span id="ast-32"><span id="ast-33" class="other_trans">var</span>.WOLF_ROLES</span>&nbsp;-&nbsp;<span id="ast-35">{<span id="ast-36">'wolf&nbsp;cub'</span>}</span>)</span></span><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43">random</span>.choice</span>(<span id="ast-44"><span id="ast-45" class="other_trans">list</span>(<span id="ast-46">wolves</span>)</span>)</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-48">1</span></span><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>roles</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52">list</span>(<span id="ast-53">(<span id="ast-54">(<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">var</span>.ROLE_GUIDE</span>.keys</span>()</span>&nbsp;-&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63">var</span>.TEMPLATE_RESTRICTIONS</span>.keys</span>()</span>)</span>&nbsp;-&nbsp;<span id="ast-65">{<span id="ast-66">'amnesiac'</span>,&nbsp;<span id="ast-67">'clone'</span>,&nbsp;<span id="ast-68">'dullahan'</span>}</span>)</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70">(<span id="ast-71">not</span>&nbsp;<span id="ast-72">do_templates</span>)</span>:<span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>roles</span>.remove</span>(<span id="ast-77">'matchmaker'</span>)</span></span></span><span id="ast-78"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-79">lpl</span>:<span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans">random</span>.choice</span>(<span id="ast-87" class="other_trans">roles</span>)</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-89">1</span></span><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lpl</span>&nbsp;-=&nbsp;<span id="ast-93">1</span></span></span><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-95">do_templates</span>:<span id="ast-96"><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-99"><span id="ast-100">'gunner'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103">random</span>.randrange</span>(<span id="ast-104">4</span>)</span></span><span id="ast-105"><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-108"><span id="ast-109">'sharpshooter'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-110"><span id="ast-111"><span id="ast-112">random</span>.randrange</span>(<span id="ast-113">(<span id="ast-114"><span id="ast-115">addroles</span>[<span id="ast-116"><span id="ast-117">'gunner'</span></span>]</span>&nbsp;+&nbsp;<span id="ast-119">1</span>)</span>)</span></span><span id="ast-120"><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-123"><span id="ast-124">'assassin'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127" class="other_trans">random</span>.randrange</span>(<span id="ast-128">3</span>)</span></span><span id="ast-129"><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-132"><span id="ast-133">'cursed&nbsp;villager'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-134"><span id="ast-135"><span id="ast-136">random</span>.randrange</span>(<span id="ast-137">3</span>)</span></span><span id="ast-138"><span id="ast-139"><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-141"><span id="ast-142">'mayor'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-143"><span id="ast-144"><span id="ast-145">random</span>.randrange</span>(<span id="ast-146">2</span>)</span></span><span id="ast-147"><span id="ast-148"><span id="ast-149" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-150"><span id="ast-151">'bureaucrat'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-152"><span id="ast-153"><span id="ast-154">random</span>.randrange</span>(<span id="ast-155">2</span>)</span></span><span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-157">(<span id="ast-159">(<span id="ast-160"><span id="ast-161"><span id="ast-162" class="other_trans">random</span>.randrange</span>(<span id="ast-163">100</span>)</span><span id="ast-164" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-165">0</span>)</span>&nbsp;and&nbsp;<span id="ast-166">(<span id="ast-167"><span id="ast-168"><span id="ast-169">addroles</span>.get</span>(<span id="ast-170">'villager'</span>,&nbsp;<span id="ast-171">0</span>)</span><span id="ast-172" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-173">0</span>)</span>)</span>:<span id="ast-174"><span id="ast-175"><span id="ast-176" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addroles</span>[<span id="ast-177"><span id="ast-178">'blessed&nbsp;villager'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-179">1</span></span></span></span><span id="ast-180"><span id="ast-181" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lpl</span>&nbsp;=&nbsp;<span id="ast-182"><span id="ast-183" class="other_trans">len</span>(<span id="ast-184">villagers</span>)</span></span><span id="ast-185"><span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lwolves</span>&nbsp;=&nbsp;<span id="ast-187"><span id="ast-188">sum</span>(<span id="ast-189">(<span id="ast-190"><span id="ast-191" class="other_trans">addroles</span>[<span id="ast-192"><span id="ast-193">r</span></span>]</span><span id="ast-194">&nbsp;for&nbsp;<span id="ast-195" class="other_trans">r</span>&nbsp;in&nbsp;<span id="ast-196"><span id="ast-197">var</span>.WOLFCHAT_ROLES</span></span>)</span>)</span></span><span id="ast-198"><span id="ast-199"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lcubs</span>&nbsp;=&nbsp;<span id="ast-200"><span id="ast-201" class="other_trans">addroles</span>[<span id="ast-202"><span id="ast-203">'wolf&nbsp;cub'</span></span>]</span></span><span id="ast-204"><span id="ast-205"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lrealwolves</span>&nbsp;=&nbsp;<span id="ast-206"><span id="ast-207">sum</span>(<span id="ast-208">(<span id="ast-209"><span id="ast-210">addroles</span>[<span id="ast-211"><span id="ast-212" class="other_trans">r</span></span>]</span><span id="ast-213">&nbsp;for&nbsp;<span id="ast-214">r</span>&nbsp;in&nbsp;<span id="ast-215">(<span id="ast-216"><span id="ast-217">var</span>.WOLF_ROLES</span>&nbsp;-&nbsp;<span id="ast-219">{<span id="ast-220">'wolf&nbsp;cub'</span>}</span>)</span></span>)</span>)</span></span><span id="ast-221"><span id="ast-222"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lmonsters</span>&nbsp;=&nbsp;<span id="ast-223"><span id="ast-224">addroles</span>[<span id="ast-225"><span id="ast-226">'monster'</span></span>]</span></span><span id="ast-227"><span id="ast-228"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ldemoniacs</span>&nbsp;=&nbsp;<span id="ast-229"><span id="ast-230" class="other_trans">addroles</span>[<span id="ast-231"><span id="ast-232">'demoniac'</span></span>]</span></span><span id="ast-233"><span id="ast-234" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ltraitors</span>&nbsp;=&nbsp;<span id="ast-235"><span id="ast-236">addroles</span>[<span id="ast-237"><span id="ast-238">'traitor'</span></span>]</span></span><span id="ast-239"><span id="ast-240"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lpipers</span>&nbsp;=&nbsp;<span id="ast-241"><span id="ast-242" class="other_trans">addroles</span>[<span id="ast-243"><span id="ast-244">'piper'</span></span>]</span></span><span id="ast-245"><span id="ast-246"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lsuccubi</span>&nbsp;=&nbsp;<span id="ast-247"><span id="ast-248" class="other_trans">addroles</span>[<span id="ast-249"><span id="ast-250">'succubus'</span></span>]</span></span><span id="ast-251"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-252"><span id="ast-253"><span id="ast-254">self</span>.chk_win_conditions</span>(<span id="ast-255">lpl</span>,&nbsp;<span id="ast-256">lwolves</span>,&nbsp;<span id="ast-257" class="other_trans">lcubs</span>,&nbsp;<span id="ast-258">lrealwolves</span>,&nbsp;<span id="ast-259">lmonsters</span>,&nbsp;<span id="ast-260" class="other_trans">ldemoniacs</span>,&nbsp;<span id="ast-261" class="other_trans">ltraitors</span>,&nbsp;<span id="ast-262" class="other_trans">lpipers</span>,&nbsp;<span id="ast-263" class="other_trans">lsuccubi</span>,&nbsp;<span id="ast-264">0</span>,&nbsp;<span id="ast-265" class="incorrect_node">cli&nbsp;&rarr;&nbsp;lsuccubi&nbsp;</span>,&nbsp;end_game=<span id="ast-267">False</span>)</span>:<span id="ast-268"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-269"><span id="ast-270"><span id="ast-271">self</span>._role_attribution</span>(<span id="ast-272">cli</span>,&nbsp;<span id="ast-273" class="ref_node">chk_win_conditions&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-274">var</span>,&nbsp;<span id="ast-275">villagers</span>,&nbsp;<span id="ast-276" class="other_trans">do_templates</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;record_exists(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">model</span>,&nbsp;**conditions</span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-6">(<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.session</span>.query</span>(<span id="ast-15" class="other_trans">model</span>)</span>.filter_by</span>(**<span id="ast-16" class="incorrect_node">conditions&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>.count</span>()</span><span id="ast-17" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-18">0</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.attributes</span>&nbsp;=&nbsp;<span id="ast-7">[<span id="ast-8">(<span id="ast-9" class="other_trans">attribute</span>,&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">xdy</span>(<span id="ast-12">3</span>,&nbsp;<span id="ast-13">6</span>)</span>)</span><span id="ast-14">&nbsp;for&nbsp;<span id="ast-15" class="other_trans">attribute</span>&nbsp;in&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">characterclass</span>.ATTRIBUTES</span></span>]</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.character_class</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.get_character_class</span>()</span></span><span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.equipment</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30">self</span>.character_class</span>[<span id="ast-31"><span id="ast-32">'equipment'</span></span>]</span>[<span id="ast-33"><span id="ast-34">(<span id="ast-35"><span id="ast-36" class="other_trans">xdy</span>(<span id="ast-37">3</span>,&nbsp;<span id="ast-38">6</span>)</span>&nbsp;-&nbsp;<span id="ast-40">3</span>)</span></span>]</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.hp</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45"><span id="ast-46">self</span>.get_hp</span>()</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48">(<span id="ast-49"><span id="ast-50">self</span>.hp</span><span id="ast-51" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-52">0</span>)</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.hp</span>&nbsp;=&nbsp;<span id="ast-56">1</span></span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.ac</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61"><span id="ast-62">self</span>.get_ac</span>()</span></span><span id="ast-63"><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.thac9</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68">self</span>.get_thac9</span>()</span></span><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.saves</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74">self</span>.get_saves</span>()</span></span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.languages</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80">self</span>.get_languages</span>()</span></span><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.spell</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86">self</span>.get_spell</span>()</span></span><span id="ast-87"><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.notes</span>&nbsp;=&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92">self</span>.get_notes</span>()</span></span><span id="ast-93"><span id="ast-94"><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.attr</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97" class="other_trans">dict</span>(<span id="ast-98">(<span id="ast-99">(<span id="ast-100" class="other_trans">attr</span>,&nbsp;<span id="ast-101"><span id="ast-102"><span id="ast-103">self</span>.with_bonus</span>(<span id="ast-104" class="other_trans">attr</span>,&nbsp;<span id="ast-105" class="other_trans">value</span>)</span>)</span><span id="ast-106">&nbsp;for&nbsp;<span id="ast-107">(<span id="ast-108" class="other_trans">attr</span>,&nbsp;<span id="ast-109" class="other_trans">value</span>)</span>&nbsp;in&nbsp;<span id="ast-110"><span id="ast-111">self</span>.attributes</span></span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;to_css(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">context</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Evaluate&nbsp;the&nbsp;code&nbsp;and&nbsp;generate&nbsp;a&nbsp;CSS&nbsp;file.'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9"><span id="ast-10">context</span>.minified</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.to_css_min</span>(<span id="ast-15" class="other_trans">context</span>)</span></span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>blocks</span>&nbsp;=&nbsp;<span id="ast-18">[]</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>current_media</span>&nbsp;=&nbsp;<span id="ast-21" class="other_trans">None</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">media</span>,&nbsp;<span id="ast-25" class="other_trans">selectors</span>,&nbsp;<span id="ast-26" class="other_trans">defs</span>)</span>&nbsp;in&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">self</span>.evaluate</span>(<span id="ast-30" class="other_trans">context</span>)</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>&nbsp;=&nbsp;<span id="ast-33">[]</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36">media</span><span id="ast-37" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-38" class="other_trans">current_media</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40" class="other_trans">current_media</span>:<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>.append</span>(<span id="ast-45">(<span id="ast-46">'}&nbsp;/*&nbsp;@&nbsp;media&nbsp;%s&nbsp;*/\\u000a\\u000a'</span>&nbsp;%&nbsp;<span id="ast-48" class="ref_node">media&nbsp;&rarr;&nbsp;current_media&nbsp;</span>)</span>)</span></span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>.append</span>(<span id="ast-53">(<span id="ast-54">'@media&nbsp;%s&nbsp;{\\u000a'</span>&nbsp;%&nbsp;<span id="ast-56" class="other_trans">media</span>)</span>)</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>current_media</span>&nbsp;=&nbsp;<span id="ast-59" class="other_trans">media</span></span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>.append</span>(<span id="ast-64">(<span id="ast-65"><span id="ast-66"><span id="ast-67">u',\\u000a'</span>.join</span>(<span id="ast-68" class="other_trans">selectors</span>)</span>&nbsp;+&nbsp;<span id="ast-70">'&nbsp;{'</span>)</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-72">(<span id="ast-73" class="other_trans">key</span>,&nbsp;<span id="ast-74" class="other_trans">value</span>)</span>&nbsp;in&nbsp;<span id="ast-75" class="other_trans">defs</span>:<span id="ast-76"><span id="ast-77"><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>.append</span>(<span id="ast-80">(<span id="ast-81">u'&nbsp;&nbsp;%s:&nbsp;%s;'</span>&nbsp;%&nbsp;<span id="ast-83">(<span id="ast-84" class="other_trans">key</span>,&nbsp;<span id="ast-85" class="other_trans">value</span>)</span>)</span>)</span></span></span><span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>block</span>.append</span>(<span id="ast-90">'}'</span>)</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>blocks</span>.append</span>(<span id="ast-95"><span id="ast-96"><span id="ast-97">u'\\u000a'</span>.join</span>(<span id="ast-98" class="other_trans">block</span>)</span>)</span></span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-100">current_media</span>:<span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>blocks</span>.append</span>(<span id="ast-105">(<span id="ast-106">'}&nbsp;/*&nbsp;@&nbsp;media&nbsp;%s&nbsp;*/'</span>&nbsp;%&nbsp;<span id="ast-108" class="other_trans">current_media</span>)</span>)</span></span></span><span id="ast-109"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-110"><span id="ast-111"><span id="ast-112">u'\\u000a\\u000a'</span>.join</span>(<span id="ast-113" class="other_trans">blocks</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_and_add_db_list(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">databases</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Handle&nbsp;the&nbsp;list&nbsp;of&nbsp;databases&nbsp;while&nbsp;supporting&nbsp;authentication&nbsp;for\\u000a&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;admin&nbsp;if&nbsp;needed\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;list&nbsp;databases:&nbsp;The&nbsp;database&nbsp;list\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>client</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.connect</span>()</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-13" class="other_trans">database</span>&nbsp;in&nbsp;<span id="ast-14" class="other_trans">databases</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>db</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">client</span>[<span id="ast-19"><span id="ast-20" class="other_trans">database</span></span>]</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">database</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26"><span id="ast-27" class="correct_node">database&nbsp;&rarr;&nbsp;databases&nbsp;</span>[<span id="ast-28"><span id="ast-29">0</span></span>]</span>)</span>:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34">self</span>.config</span>.get</span>(<span id="ast-35">'admin_username'</span>)</span>:<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>db</span>.authenticate</span>(<span id="ast-40"><span id="ast-41"><span id="ast-42">self</span>.config</span>[<span id="ast-43"><span id="ast-44">'admin_username'</span></span>]</span>,&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48">self</span>.config</span>.get</span>(<span id="ast-49">'admin_password'</span>)</span>)</span></span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.add_server_datapoints</span>(<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">db</span>.command</span>(<span id="ast-57">'serverStatus'</span>)</span>)</span></span></span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.add_datapoints</span>(<span id="ast-62" class="other_trans">database</span>,&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">db</span>.command</span>(<span id="ast-66">'dbStats'</span>)</span>)</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">errors</span>.OperationFailure</span>&nbsp;as&nbsp;<span id="ast-70" class="other_trans">error</span>:<span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOGGER</span>.critical</span>(<span id="ast-75">'Could&nbsp;not&nbsp;fetch&nbsp;stats:&nbsp;%s'</span>,&nbsp;<span id="ast-76" class="other_trans">error</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">num_epochs</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dataset</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8">load_data</span>()</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_layer</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">build_model</span>(input_width=<span id="ast-14"><span id="ast-15" class="other_trans">dataset</span>[<span id="ast-16"><span id="ast-17">'input_width'</span></span>]</span>,&nbsp;input_height=<span id="ast-19"><span id="ast-20" class="other_trans">dataset</span>[<span id="ast-21"><span id="ast-22">'input_width'</span></span>]</span>,&nbsp;output_dim=<span id="ast-24"><span id="ast-25" class="other_trans">dataset</span>[<span id="ast-26"><span id="ast-27">'output_dim'</span></span>]</span>)</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iter_funcs</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">create_iter_functions</span>(<span id="ast-32" class="other_trans">dataset</span>,&nbsp;<span id="ast-33" class="other_trans">output_layer</span>,&nbsp;X_tensor_type=<span id="ast-35"><span id="ast-36" class="other_trans">T</span>.tensor4</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-38">'Starting&nbsp;training...'</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-40" class="other_trans">epoch</span>&nbsp;in&nbsp;<span id="ast-41"><span id="ast-42">train</span>(<span id="ast-43" class="other_trans">iter_funcs</span>,&nbsp;<span id="ast-44" class="other_trans">dataset</span>)</span>:<span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-46">(<span id="ast-47">'Epoch&nbsp;%d&nbsp;of&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-49">(<span id="ast-50"><span id="ast-51" class="other_trans">epoch</span>[<span id="ast-52"><span id="ast-53">'number'</span></span>]</span>,&nbsp;<span id="ast-54" class="other_trans">num_epochs</span>)</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-56">(<span id="ast-57">'&nbsp;&nbsp;training&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">epoch</span>[<span id="ast-61"><span id="ast-62">'train_loss'</span></span>]</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-64">(<span id="ast-65">'&nbsp;&nbsp;validation&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">epoch</span>[<span id="ast-69"><span id="ast-70">'valid_loss'</span></span>]</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-72">(<span id="ast-73">'&nbsp;&nbsp;validation&nbsp;accuracy:\\u0009\\u0009%.2f&nbsp;%%'</span>&nbsp;%&nbsp;<span id="ast-75">(<span id="ast-76"><span id="ast-77" class="other_trans">epoch</span>[<span id="ast-78"><span id="ast-79">'valid_accuracy'</span></span>]</span>&nbsp;*&nbsp;<span id="ast-81">100</span>)</span>)</span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-83">(<span id="ast-84"><span id="ast-85" class="other_trans">epoch</span>[<span id="ast-86"><span id="ast-87">'number'</span></span>]</span><span id="ast-88" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-89" class="other_trans">num_epochs</span>)</span>:<span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;rrmse(<span id="ast-2"><span id="ast-3" class="other_trans">evaluation</span>,&nbsp;<span id="ast-4" class="other_trans">simulation</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Relative&nbsp;Root&nbsp;Mean&nbsp;Squared&nbsp;Error\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..&nbsp;math::&nbsp;&nbsp;&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RRMSE=\\\\frac{\\\\sqrt{\\\\frac{1}{N}\\\\sum_{i=1}^{N}(e_{i}-s_{i})^2}}{\\\\bar{e}}\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:evaluation:&nbsp;Observed&nbsp;data&nbsp;to&nbsp;compared&nbsp;with&nbsp;simulation&nbsp;data.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type:&nbsp;list\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:simulation:&nbsp;simulation&nbsp;data&nbsp;to&nbsp;compared&nbsp;with&nbsp;evaluation&nbsp;data\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type:&nbsp;list\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:return:&nbsp;Relative&nbsp;Root&nbsp;Mean&nbsp;Squared&nbsp;Error\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:rtype:&nbsp;float\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-9"><span id="ast-10" class="other_trans">len</span>(<span id="ast-11" class="other_trans">evaluation</span>)</span><span id="ast-12" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-13"><span id="ast-14" class="other_trans">len</span>(<span id="ast-15" class="other_trans">simulation</span>)</span>)</span>:<span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>RRMSE</span>&nbsp;=&nbsp;<span id="ast-18">(<span id="ast-19"><span id="ast-20" class="other_trans">rmse</span>(<span id="ast-21" class="other_trans">evaluation</span>,&nbsp;<span id="ast-22" class="other_trans">simulation</span>)</span>&nbsp;/&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">np</span>.mean</span>(<span id="ast-27" class="ref_node">simulation&nbsp;&rarr;&nbsp;evaluation&nbsp;</span>)</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-29" class="other_trans">RRMSE</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-31">'Error:&nbsp;evaluation&nbsp;and&nbsp;simulation&nbsp;lists&nbsp;does&nbsp;not&nbsp;have&nbsp;the&nbsp;same&nbsp;length.'</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">np</span>.nan</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;handle(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;*args,&nbsp;**options</span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-5">'Creating&nbsp;session...'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9" class="other_trans">len</span>(<span id="ast-10" class="incorrect_node">args&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span><span id="ast-11" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-12">1</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">CommandError</span>(<span id="ast-16"><span id="ast-17"><span id="ast-18">"Wrong&nbsp;number&nbsp;of&nbsp;arguments&nbsp;(expecting&nbsp;'{}')"</span>.format</span>(<span id="ast-19"><span id="ast-20">self</span>.args</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;on_status(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">status</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-7"><span id="ast-8" class="other_trans">status</span>.in_reply_to_status_id</span><span id="ast-9" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-10">tweetID</span>)</span>:<span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parsedNumbers</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27">''</span>.join</span>(<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">status</span>.text</span>.split</span>(<span id="ast-33">'&nbsp;'</span>)</span>[<span id="ast-34"><span id="ast-35">1</span>:</span>]</span>)</span>.replace</span>(<span id="ast-36">'&nbsp;'</span>,&nbsp;<span id="ast-37">''</span>)</span>.replace</span>(<span id="ast-38">'['</span>,&nbsp;<span id="ast-39">''</span>)</span>.replace</span>(<span id="ast-40">']'</span>,&nbsp;<span id="ast-41">''</span>)</span>.replace</span>(<span id="ast-42">'('</span>,&nbsp;<span id="ast-43">''</span>)</span>.replace</span>(<span id="ast-44">')'</span>,&nbsp;<span id="ast-45">''</span>)</span>.split</span>(<span id="ast-46">','</span>)</span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>givenNumbers</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50">list</span>(<span id="ast-51"><span id="ast-52" class="other_trans">map</span>(<span id="ast-53" class="other_trans">int</span>,&nbsp;<span id="ast-54" class="other_trans">parsedNumbers</span>)</span>)</span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>areSorted</span>&nbsp;=&nbsp;<span id="ast-57">True</span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-59">(<span id="ast-60"><span id="ast-61" class="other_trans">len</span>(<span id="ast-62" class="other_trans">givenNumbers</span>)</span><span id="ast-63" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-64"><span id="ast-65" class="other_trans">len</span>(<span id="ast-66">numbers</span>)</span>)</span>:<span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>areSorted</span>&nbsp;=&nbsp;<span id="ast-69">False</span></span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-71" class="other_trans">n</span>&nbsp;in&nbsp;<span id="ast-72" class="other_trans">givenNumbers</span>:<span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-74">(<span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">givenNumbers</span>.count</span>(<span id="ast-78" class="other_trans">n</span>)</span><span id="ast-79" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans">numbers</span>.count</span>(<span id="ast-83" class="other_trans">n</span>)</span>)</span>:<span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>areSorted</span>&nbsp;=&nbsp;<span id="ast-86">False</span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-89" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-90"><span id="ast-91" class="other_trans">range</span>(<span id="ast-92"><span id="ast-93" class="other_trans">len</span>(<span id="ast-94" class="other_trans">givenNumbers</span>)</span>)</span>:<span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96">(<span id="ast-97" class="other_trans">i</span><span id="ast-98" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-99">0</span>)</span>:<span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-101">(<span id="ast-102">not</span>&nbsp;<span id="ast-103">(<span id="ast-104"><span id="ast-105" class="other_trans">givenNumbers</span>[<span id="ast-106"><span id="ast-107" class="other_trans">i</span></span>]</span><span id="ast-108" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-109"><span id="ast-110" class="other_trans">givenNumbers</span>[<span id="ast-111"><span id="ast-112">(<span id="ast-113" class="other_trans">i</span>&nbsp;-&nbsp;<span id="ast-115">1</span>)</span></span>]</span>)</span>)</span>:<span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>areSorted</span>&nbsp;=&nbsp;<span id="ast-118">False</span></span><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;fixterm_handler(<span id="ast-2"><span id="ast-3" class="other_trans">exc</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5"><span id="ast-6" class="other_trans">isinstance</span>(<span id="ast-7" class="other_trans">exc</span>,&nbsp;<span id="ast-8" class="other_trans">UnicodeDecodeError</span>)</span>:<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-11">u''</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lc</span>&nbsp;=&nbsp;<span id="ast-14">0</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ci</span>&nbsp;=&nbsp;<span id="ast-17">0</span></span><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cr</span>&nbsp;=&nbsp;<span id="ast-20">0</span></span><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pos</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">exc</span>.start</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-26" class="other_trans">c</span>&nbsp;in&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">exc</span>.object</span>[<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">exc</span>.start</span>:</span>]</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pos</span>&nbsp;=&nbsp;<span id="ast-35">(<span id="ast-36" class="other_trans">pos</span>&nbsp;+&nbsp;<span id="ast-38">1</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">ci</span><span id="ast-42" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-43">0</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46"><span id="ast-47">ord</span>(<span id="ast-48" class="other_trans">c</span>)</span><span id="ast-49" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-50">128</span>)</span>:<span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;+=&nbsp;<span id="ast-54" class="other_trans">c</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ci</span>&nbsp;=&nbsp;<span id="ast-58">1</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-60">(<span id="ast-61" class="other_trans">ci</span><span id="ast-62" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-63">1</span>)</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-65">(<span id="ast-66"><span id="ast-67" class="other_trans">ord</span>(<span id="ast-68" class="other_trans">c</span>)</span><span id="ast-69" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-70">64</span>)</span>:<span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-73"><span id="ast-74" class="other_trans">ord</span>(<span id="ast-75" class="other_trans">c</span>)</span><span id="ast-76" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-77">27</span>)</span>:<span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cr</span>&nbsp;=&nbsp;<span id="ast-80" class="other_trans">lc</span></span><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;+=&nbsp;<span id="ast-84" class="other_trans">c</span></span><span id="ast-85"><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;+=&nbsp;<span id="ast-88">'[50m'</span></span><span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;+=&nbsp;<span id="ast-92" class="other_trans">c</span></span><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ci</span>&nbsp;=&nbsp;<span id="ast-95">2</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-96"><span id="ast-97" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;+=&nbsp;<span id="ast-99" class="other_trans">c</span></span><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ci</span>&nbsp;=&nbsp;<span id="ast-102">0</span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;find_test_cases_in_class(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">test_class_ref</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-6" class="other_trans">class_element</span>&nbsp;in&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">dir</span>(<span id="ast-9" class="other_trans">test_class_ref</span>)</span>:<span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>test_case_ref</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">getattr</span>(<span id="ast-14"><span id="ast-15" class="other_trans">test_class_ref</span>()</span>,&nbsp;<span id="ast-16" class="other_trans">class_element</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-21">(<span id="ast-22"><span id="ast-23" class="other_trans">test_case_ref</span>.__pd_type__</span><span id="ast-24" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-25"><span id="ast-26" class="other_trans">PDecoratorType</span>.Test</span>)</span>&nbsp;and&nbsp;<span id="ast-27"><span id="ast-28" class="correct_node">test_class_ref&nbsp;&rarr;&nbsp;test_case_ref&nbsp;</span>.__enabled__</span>&nbsp;and&nbsp;<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32">self</span>.test_case_filter_group</span>.filter</span>(<span id="ast-33" class="other_trans">test_case_ref</span>)</span>)</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.found_test_case_count</span>&nbsp;+=&nbsp;<span id="ast-38">1</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41">not</span>&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45">self</span>.target_test_suite</span>.add_test_case</span>(<span id="ast-46" class="other_trans">test_case_ref</span>)</span>)</span>:<span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.repeated_test_case_count</span>&nbsp;+=&nbsp;<span id="ast-51">1</span></span></span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-53" class="other_trans">AttributeError</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;selectsharesResponse(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">response</span>,&nbsp;<span id="ast-5" class="other_trans">args</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>server</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.servers</span>[<span id="ast-11"><span id="ast-12">args</span></span>]</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15"><span id="ast-16">server</span>[<span id="ast-17"><span id="ast-18">'role'</span></span>]</span><span id="ast-19">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-20"><span id="ast-21">self</span>.api_pull</span>)</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26">server</span>[<span id="ast-27"><span id="ast-28">'api_method'</span></span>]</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30">'json'</span>)</span>:<span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35">json</span>.loads</span>(<span id="ast-36">response</span>)</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-38">value</span>&nbsp;in&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42">server</span>[<span id="ast-43"><span id="ast-44">'api_key'</span></span>]</span>.split</span>(<span id="ast-45">','</span>)</span>:<span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">info</span>[<span id="ast-50"><span id="ast-51" class="other_trans">value</span></span>]</span></span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-54">'api_strip'</span><span id="ast-55">&nbsp;in&nbsp;</span><span id="ast-56">server</span>)</span>:<span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>strip_char</span>&nbsp;=&nbsp;<span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans">server</span>[<span id="ast-62"><span id="ast-63">'api_strip'</span></span>]</span>[<span id="ast-64"><span id="ast-65">1</span>:<span id="ast-66">-1</span></span>]</span></span><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71">info</span>.replace</span>(<span id="ast-72">strip_char</span>,&nbsp;<span id="ast-73">''</span>)</span></span></span><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>round_shares</span>&nbsp;=&nbsp;<span id="ast-76"><span id="ast-77">int</span>(<span id="ast-78" class="other_trans">info</span>)</span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-80">(<span id="ast-81" class="other_trans">round_shares</span><span id="ast-82" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-83" class="other_trans">None</span>)</span>:<span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>round_shares</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-87">int</span>(<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92">self</span>.bitHopper</span>.difficulty</span>.get_difficulty</span>()</span>)</span></span></span><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ghash</span>&nbsp;=&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97">self</span>.get_ghash</span>(<span id="ast-98" class="other_trans">server</span>,&nbsp;<span id="ast-99" class="other_trans">response</span>,&nbsp;<span id="ast-100">True</span>)</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-102">(<span id="ast-103" class="other_trans">ghash</span><span id="ast-104" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-105">0</span>)</span>:<span id="ast-106"><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>server</span>[<span id="ast-109"><span id="ast-110">'ghash'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-111">ghash</span></span></span><span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-113">(<span id="ast-114">'api_key_duration'</span><span id="ast-115">&nbsp;in&nbsp;</span><span id="ast-116">server</span>)</span>:<span id="ast-117"><span id="ast-118"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dur</span>&nbsp;=&nbsp;<span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans">json</span>.loads</span>(<span id="ast-122" class="other_trans">response</span>)</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-124" class="other_trans">value</span>&nbsp;in&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127"><span id="ast-128" class="other_trans">server</span>[<span id="ast-129"><span id="ast-130">'api_key_duration'</span></span>]</span>.split</span>(<span id="ast-131">','</span>)</span>:<span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dur</span>&nbsp;=&nbsp;<span id="ast-134"><span id="ast-135">dur</span>[<span id="ast-136"><span id="ast-137">value</span></span>]</span></span></span><span id="ast-138"><span id="ast-139" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>duration</span>&nbsp;=&nbsp;<span id="ast-140"><span id="ast-141"><span id="ast-142">self</span>.get_duration</span>(<span id="ast-143">server</span>,&nbsp;<span id="ast-144"><span id="ast-145" class="other_trans">str</span>(<span id="ast-146">dur</span>)</span>)</span></span><span id="ast-147"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-148">(<span id="ast-149" class="other_trans">duration</span><span id="ast-150" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-151">0</span>)</span>:<span id="ast-152"><span id="ast-153"><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>server</span>[<span id="ast-155"><span id="ast-156">'duration'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-157">duration</span></span></span></span><span id="ast-158"><span id="ast-159"><span id="ast-160"><span id="ast-161"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.UpdateShares</span>(<span id="ast-162">args</span>,&nbsp;<span id="ast-163">round_shares</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-165">(<span id="ast-166"><span id="ast-167" class="other_trans">server</span>[<span id="ast-168"><span id="ast-169">'api_method'</span></span>]</span><span id="ast-170" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-171">'json_ec'</span>)</span>:<span id="ast-172"><span id="ast-173" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>&nbsp;=&nbsp;<span id="ast-174"><span id="ast-175"><span id="ast-176">json</span>.loads</span>(<span id="ast-177"><span id="ast-178" class="other_trans">response</span>[<span id="ast-179">:<span id="ast-180">(<span id="ast-181"><span id="ast-182"><span id="ast-183">response</span>.find</span>(<span id="ast-184">'}'</span>)</span>&nbsp;+&nbsp;<span id="ast-186">1</span>)</span></span>]</span>)</span></span><span id="ast-187"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-188">value</span>&nbsp;in&nbsp;<span id="ast-189"><span id="ast-190"><span id="ast-191"><span id="ast-192">server</span>[<span id="ast-193"><span id="ast-194">'api_key'</span></span>]</span>.split</span>(<span id="ast-195">','</span>)</span>:<span id="ast-196"><span id="ast-197" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>&nbsp;=&nbsp;<span id="ast-198"><span id="ast-199">info</span>[<span id="ast-200"><span id="ast-201" class="other_trans">value</span></span>]</span></span></span><span id="ast-202"><span id="ast-203"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>round_shares</span>&nbsp;=&nbsp;<span id="ast-204"><span id="ast-205">int</span>(<span id="ast-206">info</span>)</span></span><span id="ast-207"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-208">(<span id="ast-209">round_shares</span><span id="ast-210" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-211">None</span>)</span>:<span id="ast-212"><span id="ast-213"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>round_shares</span>&nbsp;=&nbsp;<span id="ast-214"><span id="ast-215" class="other_trans">int</span>(<span id="ast-216">self</span>,&nbsp;<span id="ast-217"><span id="ast-218"><span id="ast-219"><span id="ast-220" class="ref_node">bitHopper&nbsp;&rarr;&nbsp;self.&nbsp;</span>.difficulty</span>.get_difficulty</span>()</span>)</span></span></span><span id="ast-221"><span id="ast-222"><span id="ast-223"><span id="ast-224"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.UpdateShares</span>(<span id="ast-225" class="incorrect_node">args&nbsp;&rarr;&nbsp;info&nbsp;</span>,&nbsp;<span id="ast-226">round_shares</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;interval_tuples(<span id="ast-2"><span id="ast-3" class="other_trans">first</span>,&nbsp;<span id="ast-4" class="other_trans">last</span>,&nbsp;<span id="ast-5" class="other_trans">interval</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9" class="other_trans">first</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-11">[]</span></span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>interval_tuples</span>&nbsp;=&nbsp;<span id="ast-14">[]</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">first</span><span id="ast-18" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-19" class="other_trans">last</span>)</span>:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>next_date</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">get_next_interval</span>(<span id="ast-24" class="other_trans">first</span>,&nbsp;<span id="ast-25" class="other_trans">interval</span>)</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>interval_tuples</span>.append</span>(<span id="ast-30">(<span id="ast-31" class="other_trans">first</span>,&nbsp;<span id="ast-32" class="other_trans">next_date</span>)</span>)</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first</span>&nbsp;=&nbsp;<span id="ast-35" class="other_trans">next_date</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;discovery_all(<span id="ast-2"><span id="ast-3" class="other_trans">dut</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dut</span>._log</span>.info</span>(<span id="ast-9">'Trying&nbsp;to&nbsp;discover'</span>)</span></span><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">Timer</span>(<span id="ast-14">0</span>)</span></span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-16" class="other_trans">thing</span>&nbsp;in&nbsp;<span id="ast-17" class="other_trans">dut</span>:<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>thing</span>._log</span>.info</span>(<span id="ast-23">(<span id="ast-24">'Found&nbsp;something:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">thing</span>._fullname</span>)</span>)</span></span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>thing&nbsp;&rarr;&nbsp;dut&nbsp;</span>._log</span>.info</span>(<span id="ast-33">(<span id="ast-34">'length&nbsp;of&nbsp;dut.inst_acs&nbsp;is&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">len</span>(<span id="ast-38"><span id="ast-39" class="other_trans">dut</span>.gen_acs</span>)</span>)</span>)</span></span><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">dut</span>.gen_acs</span>[<span id="ast-45"><span id="ast-46">3</span></span>]</span></span><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>._log</span>.info</span>(<span id="ast-52">'this&nbsp;is&nbsp;item'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_configure_torque(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-9">(<span id="ast-10">'Configured&nbsp;to&nbsp;run&nbsp;on&nbsp;system&nbsp;with&nbsp;%s.'</span>&nbsp;%&nbsp;<span id="ast-12" class="other_trans">LRMS_TORQUE</span>)</span>)</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_nodefile</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">os</span>.environ</span>.get</span>(<span id="ast-19">'PBS_NODEFILE'</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22">torque_nodefile</span><span id="ast-23" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-24" class="other_trans">None</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-27">'$PBS_NODEFILE&nbsp;not&nbsp;set!'</span></span><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.error</span>(<span id="ast-33" class="other_trans">msg</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">Exception</span>(<span id="ast-37" class="other_trans">msg</span>)</span></span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_nodes</span>&nbsp;=&nbsp;<span id="ast-40">[<span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans">line</span>.strip</span>()</span><span id="ast-44">&nbsp;for&nbsp;<span id="ast-45" class="other_trans">line</span>&nbsp;in&nbsp;<span id="ast-46"><span id="ast-47">open</span>(<span id="ast-48" class="other_trans">torque_nodefile</span>)</span></span>]</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-54">(<span id="ast-55">'Found&nbsp;Torque&nbsp;PBS_NODEFILE&nbsp;%s:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-57">(<span id="ast-58" class="other_trans">torque_nodefile</span>,&nbsp;<span id="ast-59">torque_nodes</span>)</span>)</span>)</span></span><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65">os</span>.environ</span>.get</span>(<span id="ast-66">'PBS_NCPUS'</span>)</span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-68" class="other_trans">val</span>:<span id="ast-69"><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_num_cpus</span>&nbsp;=&nbsp;<span id="ast-71"><span id="ast-72">int</span>(<span id="ast-73" class="other_trans">val</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-76">'$PBS_NCPUS&nbsp;not&nbsp;set!&nbsp;(new&nbsp;Torque&nbsp;version?)'</span></span><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_num_cpus</span>&nbsp;=&nbsp;<span id="ast-79">None</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.warning</span>(<span id="ast-85" class="other_trans">msg</span>)</span></span></span><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans">os</span>.environ</span>.get</span>(<span id="ast-92">'PBS_NUM_NODES'</span>)</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-94">val</span>:<span id="ast-95"><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_num_nodes</span>&nbsp;=&nbsp;<span id="ast-97"><span id="ast-98">int</span>(<span id="ast-99" class="other_trans">val</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-102">'$PBS_NUM_NODES&nbsp;not&nbsp;set!&nbsp;(old&nbsp;Torque&nbsp;version?)'</span></span><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_num_nodes</span>&nbsp;=&nbsp;<span id="ast-105" class="other_trans">None</span></span><span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.warning</span>(<span id="ast-111">msg</span>)</span></span></span><span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>val</span>&nbsp;=&nbsp;<span id="ast-114"><span id="ast-115"><span id="ast-116"><span id="ast-117">os</span>.environ</span>.get</span>(<span id="ast-118">'PBS_NUM_PPN'</span>)</span></span><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-120">val</span>:<span id="ast-121"><span id="ast-122" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_cores_per_node</span>&nbsp;=&nbsp;<span id="ast-123"><span id="ast-124" class="other_trans">int</span>(<span id="ast-125" class="other_trans">val</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-126"><span id="ast-127"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-128">'$PBS_NUM_PPN&nbsp;or&nbsp;$PBS_PPN&nbsp;not&nbsp;set!'</span></span><span id="ast-129"><span id="ast-130" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_cores_per_node</span>&nbsp;=&nbsp;<span id="ast-131">None</span></span><span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.warning</span>(<span id="ast-137">msg</span>)</span></span></span><span id="ast-138"><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>torque_nodes_length</span>&nbsp;=&nbsp;<span id="ast-140"><span id="ast-141">len</span>(<span id="ast-142" class="other_trans">torque_nodes</span>)</span></span><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-144">(<span id="ast-146" class="other_trans">torque_num_nodes</span>&nbsp;and&nbsp;<span id="ast-147" class="other_trans">torque_cores_per_node</span>&nbsp;and&nbsp;<span id="ast-148">(<span id="ast-149" class="other_trans">torque_nodes_length</span><span id="ast-150" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-151">(<span id="ast-152" class="other_trans">torque_num_nodes</span>&nbsp;*&nbsp;<span id="ast-154" class="other_trans">torque_cores_per_node</span>)</span>)</span>)</span>:<span id="ast-155"><span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-157">(<span id="ast-158">'Number&nbsp;of&nbsp;entries&nbsp;in&nbsp;$PBS_NODEFILE&nbsp;(%s)&nbsp;does&nbsp;not&nbsp;match&nbsp;with&nbsp;$PBS_NUM_NODES*$PBS_NUM_PPN&nbsp;(%s*%s)'</span>&nbsp;%&nbsp;<span id="ast-160">(<span id="ast-161">torque_nodes_length</span>,&nbsp;<span id="ast-162" class="ref_node">torque_nodes&nbsp;&rarr;&nbsp;torque_num_nodes&nbsp;</span>,&nbsp;<span id="ast-163">torque_cores_per_node</span>)</span>)</span></span><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-165"><span id="ast-166">Exception</span>(<span id="ast-167" class="other_trans">msg</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_sign_arch(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">arch_macho</span>,&nbsp;<span id="ast-5" class="other_trans">arch_end</span>,&nbsp;<span id="ast-6" class="other_trans">signer</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cmds</span>&nbsp;=&nbsp;<span id="ast-9">{}</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-11" class="other_trans">cmd</span>&nbsp;in&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">arch_macho</span>.commands</span>:<span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">cmd</span>.cmd</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cmds</span>[<span id="ast-21"><span id="ast-22" class="other_trans">name</span></span>]</span>&nbsp;=&nbsp;<span id="ast-23" class="other_trans">cmd</span></span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-26">'LC_CODE_SIGNATURE'</span><span id="ast-27">&nbsp;in&nbsp;</span><span id="ast-28">cmds</span>)</span>:<span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lc_cmd</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32">cmds</span>[<span id="ast-33"><span id="ast-34">'LC_CODE_SIGNATURE'</span></span>]</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-39">'re-signing'</span>)</span></span><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>codesig_offset</span>&nbsp;=&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44" class="incorrect_node">arch_macho&nbsp;&rarr;&nbsp;lc_cmd&nbsp;</span>.macho_start</span>&nbsp;+&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48">lc_cmd</span>.data</span>.dataoff</span>)</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.f</span>.seek</span>(<span id="ast-54">codesig_offset</span>)</span></span><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>codesig_data</span>&nbsp;=&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>.f</span>.read</span>(<span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans">lc_cmd</span>.data</span>.datasize</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">Exception</span>(<span id="ast-67">'not&nbsp;implemented'</span>)</span></span></span><span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>codesig</span>&nbsp;=&nbsp;<span id="ast-70"><span id="ast-71">Codesig</span>(<span id="ast-72">self</span>,&nbsp;<span id="ast-73" class="other_trans">codesig_data</span>)</span></span><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>codesig</span>.resign</span>(<span id="ast-78"><span id="ast-79">self</span>.app</span>,&nbsp;<span id="ast-80" class="other_trans">signer</span>)</span></span><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_codesig_data</span>&nbsp;=&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85">codesig</span>.build_data</span>()</span></span><span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-90"><span id="ast-91"><span id="ast-92">'old&nbsp;len:&nbsp;{0}'</span>.format</span>(<span id="ast-93"><span id="ast-94">len</span>(<span id="ast-95" class="other_trans">codesig_data</span>)</span>)</span>)</span></span><span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-100"><span id="ast-101"><span id="ast-102">'new&nbsp;len:&nbsp;{0}'</span>.format</span>(<span id="ast-103"><span id="ast-104" class="other_trans">len</span>(<span id="ast-105">new_codesig_data</span>)</span>)</span>)</span></span><span id="ast-106"><span id="ast-107" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>padding_length</span>&nbsp;=&nbsp;<span id="ast-108">(<span id="ast-109"><span id="ast-110">len</span>(<span id="ast-111" class="other_trans">codesig_data</span>)</span>&nbsp;-&nbsp;<span id="ast-113"><span id="ast-114" class="other_trans">len</span>(<span id="ast-115" class="other_trans">new_codesig_data</span>)</span>)</span></span><span id="ast-116"><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_codesig_data</span>&nbsp;+=&nbsp;<span id="ast-119">(<span id="ast-120">'\\u0000'</span>&nbsp;*&nbsp;<span id="ast-122" class="other_trans">padding_length</span>)</span></span><span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-127"><span id="ast-128"><span id="ast-129">'padded&nbsp;len:&nbsp;{0}'</span>.format</span>(<span id="ast-130"><span id="ast-131" class="other_trans">len</span>(<span id="ast-132" class="other_trans">new_codesig_data</span>)</span>)</span>)</span></span><span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-137">'----'</span>)</span></span><span id="ast-138"><span id="ast-139" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lc_cmd</span>&nbsp;=&nbsp;<span id="ast-140"><span id="ast-141" class="other_trans">cmds</span>[<span id="ast-142"><span id="ast-143">'LC_CODE_SIGNATURE'</span></span>]</span></span><span id="ast-144"><span id="ast-145"><span id="ast-146"><span id="ast-147" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lc_cmd</span>.data</span>.datasize</span>&nbsp;=&nbsp;<span id="ast-148"><span id="ast-149">len</span>(<span id="ast-150" class="other_trans">new_codesig_data</span>)</span></span><span id="ast-151"><span id="ast-152"><span id="ast-153" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lc_cmd</span>.bytes</span>&nbsp;=&nbsp;<span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157" class="other_trans">macho</span>.CodeSigRef</span>.build</span>(<span id="ast-158"><span id="ast-159" class="ref_node">cmd&nbsp;&rarr;&nbsp;lc_cmd&nbsp;</span>.data</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;gct(<span id="ast-2"><span id="ast-3" class="other_trans">node</span>,&nbsp;<span id="ast-4" class="other_trans">names</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-6" class="other_trans">name</span>&nbsp;in&nbsp;<span id="ast-7" class="other_trans">names</span>:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10"><span id="ast-11"><span id="ast-12">node</span>.find</span>(<span id="ast-13" class="other_trans">name</span>)</span><span id="ast-14" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-15">None</span>)</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">node</span>.find</span>(<span id="ast-23" class="other_trans">name</span>)</span>.text</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-26" class="other_trans">name</span><span id="ast-27" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-28">'pubDate'</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">datetime</span>.fromtimestamp</span>(<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">email</span>.utils</span>.mktime_tz</span>(<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">email</span>.utils</span>.parsedate_tz</span>(<span id="ast-42" class="other_trans">value</span>)</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-44">(<span id="ast-45" class="other_trans">name</span><span id="ast-46" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-47"><span id="ast-48">atom</span>(<span id="ast-49">'published'</span>)</span>)</span>:<span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">dateutil</span>.parser</span>.parse</span>(<span id="ast-56" class="other_trans">value</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-58">(<span id="ast-59" class="other_trans">name</span><span id="ast-60" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-61">'{itunes:}duration'</span>)</span>:<span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">int</span>(<span id="ast-66" class="other_trans">value</span>)</span></span></span><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-68" class="other_trans">value</span></span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-70">None</span></span></span><span id="ast-71"><span id="ast-72" class="other_trans"><span class="whitespace"><br />
</span>xml</span>&nbsp;=&nbsp;<span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">etree</span>.parse</span>(<span id="ast-78"><span id="ast-79"><span id="ast-80">urllib</span>.urlopen</span>(<span id="ast-81"><span id="ast-82">podcast</span>.rss_url</span>)</span>)</span>.getroot</span>()</span></span><span id="ast-83"><span class="whitespace"><br />
</span>try:<span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>podcast</span>.title</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90" class="other_trans">xml</span>.find</span>(<span id="ast-91">'.//channel/title'</span>)</span>.text</span></span><span id="ast-92"><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>podcast</span>.description</span>&nbsp;=&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98" class="other_trans">xml</span>.find</span>(<span id="ast-99">'.//channel/description'</span>)</span>.text</span></span><span id="ast-100"><span class="whitespace"><br />
</span>except&nbsp;<span id="ast-101" class="other_trans">AttributeError</span>:<span id="ast-102"><span id="ast-103"><span id="ast-104"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>podcast</span>.title</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108" class="other_trans">xml</span>.find</span>(<span id="ast-109"><span id="ast-110">atom</span>(<span id="ast-111">'title'</span>)</span>)</span>.text</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>podcast</span>.description</span>&nbsp;=&nbsp;<span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans">xml</span>.find</span>(<span id="ast-119"><span id="ast-120">atom</span>(<span id="ast-121">'subtitle'</span>)</span>)</span>.text</span></span></span></span><span id="ast-122"><span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
</span>podcast</span>.license</span>&nbsp;=&nbsp;<span id="ast-125"><span id="ast-126"><span id="ast-127">self</span>.determine_license</span>(<span id="ast-128"><span id="ast-129"><span id="ast-130" class="other_trans">xml</span>.find</span>(<span id="ast-131">'.//channel'</span>)</span>)</span></span><span id="ast-132"><span class="whitespace"><br />
</span>if&nbsp;<span id="ast-133">(<span id="ast-134"><span id="ast-135">self</span>.medium</span><span id="ast-136" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-137">None</span>)</span>:<span id="ast-138"><span id="ast-139"><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>podcast</span>.medium</span>&nbsp;=&nbsp;<span id="ast-141" class="ref_node">medium&nbsp;&rarr;&nbsp;self.&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;set_response_params(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">obj</span>,&nbsp;<span id="ast-5" class="other_trans">success_status_code</span>,&nbsp;<span id="ast-7" class="other_trans">content_type</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Set&nbsp;response&nbsp;parameters.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;obj:&nbsp;The&nbsp;object&nbsp;to&nbsp;set&nbsp;the&nbsp;response&nbsp;for.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;content_type:&nbsp;The&nbsp;content&nbsp;type.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;success_status_code:&nbsp;The&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;to&nbsp;return,&nbsp;default&nbsp;is\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEFAULT_SUCCESS_STATUS_CODE.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cherrypy</span>.response</span>.headers</span>[<span id="ast-16"><span id="ast-17">'Content-Type'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-18">(<span id="ast-19">'application/%s'</span>&nbsp;%&nbsp;<span id="ast-21" class="other_trans">content_type</span>)</span></span><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cherrypy</span>.response</span>.status</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-31" class="other_trans">success_status_code</span>&nbsp;if&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">obj</span><span id="ast-29" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-30" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-32"><span id="ast-33">self</span>.ERROR_STATUS_CODE</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;internal_host_route_handler(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">ev</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Handle&nbsp;internal&nbsp;network&nbsp;host&nbsp;routing\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">ev</span>.msg</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dp</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">msg</span>.datapath</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dpid</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">dp</span>.id</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ofproto</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">dp</span>.ofproto</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pkt</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">packet</span>.Packet</span>(<span id="ast-28"><span id="ast-29" class="other_trans">msg</span>.data</span>)</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ipv4_header</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">pkt</span>.get_protocol</span>(<span id="ast-35"><span id="ast-36" class="other_trans">ipv4</span>.ipv4</span>)</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>src_ip</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">ipv4_header</span>.src</span></span><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dst_ip</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">ipv4_header</span>.dst</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">(<span id="ast-47">not</span>&nbsp;<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51">self</span>.cfg_mgr</span>.is_internal_host</span>(<span id="ast-52" class="other_trans">dst_ip</span>)</span>)</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-54"><span id="ast-55"><span id="ast-56" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>install_internal_host_path&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-57" class="other_trans">dst_ip</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_assert_no_missing_args(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">args</span>,&nbsp;<span id="ast-5" class="other_trans">kwargs</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>free_params</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.get_free_parameters</span>(<span id="ast-11" class="other_trans">args</span>,&nbsp;<span id="ast-12" class="other_trans">kwargs</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>missing_args</span>&nbsp;=&nbsp;<span id="ast-15">[<span id="ast-16" class="other_trans">m</span><span id="ast-17">&nbsp;for&nbsp;<span id="ast-18" class="other_trans">m</span>&nbsp;in&nbsp;<span id="ast-19" class="other_trans">free_params</span>&nbsp;if&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">m</span><span id="ast-22">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-23"><span id="ast-24">self</span>.kwargs</span>)</span></span>]</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26" class="other_trans">missing_args</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">TypeError</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32">'{}&nbsp;is&nbsp;missing&nbsp;value(s)&nbsp;for&nbsp;{}'</span>.format</span>(<span id="ast-33"><span id="ast-34">self</span>.name</span>,&nbsp;<span id="ast-35" class="correct_node">free_params&nbsp;&rarr;&nbsp;missing_args&nbsp;</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;save_task(<span id="ast-2"><span id="ast-3" class="other_trans">task</span>,&nbsp;<span id="ast-4" class="other_trans">broker</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Saves&nbsp;the&nbsp;task&nbsp;package&nbsp;to&nbsp;Django&nbsp;or&nbsp;the&nbsp;cache\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8">(<span id="ast-10">(<span id="ast-11">not</span>&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">task</span>.get</span>(<span id="ast-15">'save'</span>,&nbsp;<span id="ast-16">(<span id="ast-17"><span id="ast-18">Conf</span>.SAVE_LIMIT</span><span id="ast-19" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-20">0</span>)</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-21"><span id="ast-22">task</span>[<span id="ast-23"><span id="ast-24">'success'</span></span>]</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">task</span>.get</span>(<span id="ast-30">'chain'</span>,&nbsp;<span id="ast-31">None</span>)</span>:<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tasks</span>.async_chain</span>(<span id="ast-36"><span id="ast-37">task</span>[<span id="ast-38"><span id="ast-39">'chain'</span></span>]</span>,&nbsp;group=<span id="ast-41"><span id="ast-42" class="other_trans">task</span>[<span id="ast-43"><span id="ast-44">'group'</span></span>]</span>,&nbsp;cached=<span id="ast-46"><span id="ast-47" class="other_trans">task</span>[<span id="ast-48"><span id="ast-49">'cached'</span></span>]</span>,&nbsp;sync=<span id="ast-51"><span id="ast-52" class="other_trans">task</span>[<span id="ast-53"><span id="ast-54">'sync'</span></span>]</span>,&nbsp;broker=<span id="ast-56" class="other_trans">broker</span>)</span></span></span><span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>db</span>.close_old_connections</span>()</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63">(<span id="ast-65"><span id="ast-66">task</span>[<span id="ast-67"><span id="ast-68">'success'</span></span>]</span>&nbsp;and&nbsp;<span id="ast-69">(<span id="ast-70">0</span><span id="ast-71" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-73"><span id="ast-74">Conf</span>.SAVE_LIMIT</span><span id="ast-72" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans">Success</span>.objects</span>.count</span>()</span>)</span>)</span>:<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Success</span>.objects</span>.last</span>()</span>.delete</span>()</span></span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92" class="other_trans">Task</span>.objects</span>.filter</span>(id=<span id="ast-94"><span id="ast-95" class="other_trans">task</span>[<span id="ast-96"><span id="ast-97">'id'</span></span>]</span>,&nbsp;name=<span id="ast-99"><span id="ast-100">task</span>[<span id="ast-101"><span id="ast-102">'name'</span></span>]</span>)</span>.exists</span>()</span>:<span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>existing_task</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108">Task</span>.objects</span>.get</span>(id=<span id="ast-110"><span id="ast-111">task</span>[<span id="ast-112"><span id="ast-113">'id'</span></span>]</span>,&nbsp;name=<span id="ast-115"><span id="ast-116">task</span>[<span id="ast-117"><span id="ast-118">'name'</span></span>]</span>)</span></span><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-120">(<span id="ast-121">not</span>&nbsp;<span id="ast-122"><span id="ast-123">existing_task</span>.success</span>)</span>:<span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>existing_task</span>.stopped</span>&nbsp;=&nbsp;<span id="ast-127"><span id="ast-128" class="other_trans">task</span>[<span id="ast-129"><span id="ast-130">'stopped'</span></span>]</span></span><span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>existing_task</span>.result</span>&nbsp;=&nbsp;<span id="ast-134"><span id="ast-135" class="other_trans">task</span>[<span id="ast-136"><span id="ast-137">'result'</span></span>]</span></span><span id="ast-138"><span id="ast-139"><span id="ast-140" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>existing_task</span>.success</span>&nbsp;=&nbsp;<span id="ast-141"><span id="ast-142" class="other_trans">task</span>[<span id="ast-143"><span id="ast-144">'success'</span></span>]</span></span><span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>existing_task</span>.save</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-149"><span id="ast-150"><span id="ast-151"><span id="ast-152"><span id="ast-153" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Task</span>.objects</span>.create</span>(id=<span id="ast-155"><span id="ast-156">task</span>[<span id="ast-157"><span id="ast-158">'id'</span></span>]</span>,&nbsp;name=<span id="ast-160"><span id="ast-161" class="other_trans">task</span>[<span id="ast-162"><span id="ast-163">'name'</span></span>]</span>,&nbsp;func=<span id="ast-165"><span id="ast-166">task</span>[<span id="ast-167"><span id="ast-168">'func'</span></span>]</span>,&nbsp;hook=<span id="ast-170"><span id="ast-171"><span id="ast-172" class="other_trans">task</span>.get</span>(<span id="ast-173">'hook'</span>)</span>,&nbsp;args=<span id="ast-175"><span id="ast-176">task</span>[<span id="ast-177"><span id="ast-178">'args'</span></span>]</span>,&nbsp;kwargs=<span id="ast-180"><span id="ast-181">task</span>[<span id="ast-182"><span id="ast-183">'kwargs'</span></span>]</span>,&nbsp;started=<span id="ast-185"><span id="ast-186" class="other_trans">task</span>[<span id="ast-187"><span id="ast-188">'started'</span></span>]</span>,&nbsp;stopped=<span id="ast-190"><span id="ast-191" class="other_trans">task</span>[<span id="ast-192"><span id="ast-193">'stopped'</span></span>]</span>,&nbsp;result=<span id="ast-195"><span id="ast-196" class="other_trans">task</span>[<span id="ast-197"><span id="ast-198">'result'</span></span>]</span>,&nbsp;group=<span id="ast-200"><span id="ast-201"><span id="ast-202">task</span>.get</span>(<span id="ast-203">'group'</span>)</span>,&nbsp;success=<span id="ast-205"><span id="ast-206" class="other_trans">task</span>[<span id="ast-207"><span id="ast-208">'success'</span></span>]</span>)</span></span></span><span id="ast-209"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-210" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-211" class="other_trans">e</span>:<span id="ast-212"><span id="ast-213"><span id="ast-214"><span id="ast-215" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-216" class="other_trans">e</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">zbx</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">open</span>(<span id="ast-8">'/proc/stat'</span>,&nbsp;<span id="ast-9">'r'</span>)</span>&nbsp;as&nbsp;<span id="ast-10" class="other_trans">f</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-12" class="other_trans">line</span>&nbsp;in&nbsp;<span id="ast-13" class="other_trans">f</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">line</span>.split</span>()</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-20" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-21"><span id="ast-22">self</span>.ProcessItems</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24">(<span id="ast-25"><span id="ast-26" class="other_trans">data</span>[<span id="ast-27"><span id="ast-28">0</span></span>]</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30"><span id="ast-31" class="other_trans">item</span>[<span id="ast-32"><span id="ast-33">0</span></span>]</span>)</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zbx</span>.send</span>(<span id="ast-38"><span id="ast-39"><span id="ast-40">'system.{0}'</span>.format</span>(<span id="ast-41"><span id="ast-42" class="other_trans">item</span>[<span id="ast-43"><span id="ast-44">1</span></span>]</span>)</span>,&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">data</span>[<span id="ast-47"><span id="ast-48">1</span></span>]</span>,&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">item</span>[<span id="ast-51"><span id="ast-52">3</span></span>]</span>)</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56"><span id="ast-57" class="other_trans">data</span>[<span id="ast-58"><span id="ast-59">0</span></span>]</span><span id="ast-60" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-61">'cpu'</span>)</span>:<span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>m</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67">self</span>.re_stat</span>.match</span>(<span id="ast-68">line</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70">(<span id="ast-71" class="other_trans">m</span><span id="ast-72" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-73" class="other_trans">None</span>)</span>:<span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-76" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-77"><span id="ast-78">self</span>.CpuItems</span>:<span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82"><span id="ast-83" class="other_trans">m</span>.group</span>(<span id="ast-84"><span id="ast-85" class="other_trans">item</span>[<span id="ast-86"><span id="ast-87">0</span></span>]</span>)</span></span><span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zbx</span>.send</span>(<span id="ast-92"><span id="ast-93"><span id="ast-94">'system.{0}'</span>.format</span>(<span id="ast-95"><span id="ast-96" class="other_trans">item</span>[<span id="ast-97"><span id="ast-98">1</span></span>]</span>)</span>,&nbsp;<span id="ast-99"><span id="ast-100">int</span>(<span id="ast-101" class="other_trans">value</span>)</span>,&nbsp;<span id="ast-102"><span id="ast-103" class="correct_node">data&nbsp;&rarr;&nbsp;item&nbsp;</span>[<span id="ast-104"><span id="ast-105">3</span></span>]</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getpydocspec(<span id="ast-2"><span id="ast-3">f</span>,&nbsp;<span id="ast-4" class="other_trans">func</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>argspec</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">pydoc</span>.getdoc</span>(<span id="ast-11">f</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-13" class="other_trans">NameError</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-15" class="other_trans">None</span></span></span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>s</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20">getpydocspec_re</span>.search</span>(<span id="ast-21">argspec</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">s</span><span id="ast-25" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-26">None</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28">None</span></span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-32">(<span id="ast-33">not</span>&nbsp;<span id="ast-34"><span id="ast-35">hasattr</span>(<span id="ast-36">f</span>,&nbsp;<span id="ast-37">'__name__'</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">s</span>.groups</span>()</span>[<span id="ast-43"><span id="ast-44">0</span></span>]</span><span id="ast-45" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-46"><span id="ast-47" class="other_trans">f</span>.__name__</span>)</span>)</span>:<span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-49" class="other_trans">None</span></span></span><span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53" class="other_trans">list</span>()</span></span><span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>defaults</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57" class="other_trans">list</span>()</span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>varargs</span>,&nbsp;<span id="ast-60" class="other_trans">varkwargs</span>&nbsp;=&nbsp;<span id="ast-61">None</span></span><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kwonly_args</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-65">list</span>()</span></span><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kwonly_defaults</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69">dict</span>()</span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-71">arg</span>&nbsp;in&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76">s</span>.group</span>(<span id="ast-77">2</span>)</span>.split</span>(<span id="ast-78">','</span>)</span>:<span id="ast-79"><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>arg</span>&nbsp;=&nbsp;<span id="ast-81"><span id="ast-82"><span id="ast-83" class="other_trans">arg</span>.strip</span>()</span></span><span id="ast-84"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans">arg</span>.startswith</span>(<span id="ast-88">'**'</span>)</span>:<span id="ast-89"><span id="ast-90" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>varkwargs</span>&nbsp;=&nbsp;<span id="ast-91"><span id="ast-92" class="other_trans">arg</span>[<span id="ast-93"><span id="ast-94">2</span>:</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98" class="other_trans">arg</span>.startswith</span>(<span id="ast-99">'*'</span>)</span>:<span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>varargs</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103" class="other_trans">arg</span>[<span id="ast-104"><span id="ast-105">1</span>:</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-108" class="other_trans">arg</span>,&nbsp;<span id="ast-109">_</span>,&nbsp;<span id="ast-110" class="other_trans">default</span>)</span>&nbsp;=&nbsp;<span id="ast-111"><span id="ast-112"><span id="ast-113">arg</span>.partition</span>(<span id="ast-114">'='</span>)</span></span><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-116">(<span id="ast-117" class="other_trans">varargs</span><span id="ast-118" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-119">None</span>)</span>:<span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwonly_args</span>.append</span>(<span id="ast-124">arg</span>)</span></span><span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-126" class="other_trans">default</span>:<span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kwonly_defaults</span>[<span id="ast-130"><span id="ast-131">arg</span></span>]</span>&nbsp;=&nbsp;<span id="ast-132">default</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>.append</span>(<span id="ast-137" class="other_trans">arg</span>)</span></span><span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-139">default</span>:<span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>defaults</span>.append</span>(<span id="ast-144">default</span>)</span></span></span></span></span></span><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-146"><span id="ast-147" class="other_trans">ArgSpec</span>(<span id="ast-148">args</span>,&nbsp;<span id="ast-149">varargs</span>,&nbsp;<span id="ast-150" class="other_trans">varkwargs</span>,&nbsp;<span id="ast-151" class="ref_node">default&nbsp;&rarr;&nbsp;defaults&nbsp;</span>,&nbsp;<span id="ast-152" class="other_trans">kwonly_args</span>,&nbsp;<span id="ast-153" class="other_trans">kwonly_defaults</span>,&nbsp;<span id="ast-154">None</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;package_versions(<span id="ast-2"><span id="ast-3" class="other_trans">request</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Render&nbsp;the&nbsp;links&nbsp;for&nbsp;all&nbsp;versions&nbsp;of&nbsp;a&nbsp;package&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>package_name</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">request</span>.matchdict</span>[<span id="ast-11"><span id="ast-12">'package'</span></span>]</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>package</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">Package</span>(<span id="ast-17" class="other_trans">package_name</span>)</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pkgs</span>&nbsp;=&nbsp;<span id="ast-20">[<span id="ast-21" class="other_trans">pkg</span><span id="ast-22">&nbsp;for&nbsp;<span id="ast-23" class="other_trans">pkg</span>&nbsp;in&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">request</span>.packages</span>&nbsp;if&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28" class="other_trans">pkg</span>.name</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30"><span id="ast-31" class="other_trans">package</span>.name</span>)</span></span>]</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">request</span>.registry</span>.use_fallback</span>&nbsp;and&nbsp;<span id="ast-38">(<span id="ast-39">not</span>&nbsp;<span id="ast-40" class="other_trans">pkgs</span>)</span>)</span>:<span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>redirect_url</span>&nbsp;=&nbsp;<span id="ast-43">(<span id="ast-44">'%s/%s/'</span>&nbsp;%&nbsp;<span id="ast-46">(<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">request</span>.registry</span>.fallback_url</span>.rstrip</span>(<span id="ast-52">'/'</span>)</span>,&nbsp;<span id="ast-53" class="correct_node">package&nbsp;&rarr;&nbsp;package_name&nbsp;</span>)</span>)</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">HTTPFound</span>(location=<span id="ast-58" class="other_trans">redirect_url</span>)</span></span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-60">{<span id="ast-61">'pkgs'</span>:&nbsp;<span id="ast-62" class="other_trans">pkgs</span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;connect(<span id="ast-2"><span id="ast-3" class="other_trans">emitter</span>,&nbsp;<span id="ast-4" class="other_trans">receiver</span>,&nbsp;<span id="ast-5" class="other_trans">mapping</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>guessed</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">guess_mapping</span>(<span id="ast-11" class="other_trans">emitter</span>,&nbsp;<span id="ast-12" class="other_trans">receiver</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mapping</span>&nbsp;=&nbsp;<span id="ast-15">(<span id="ast-17" class="other_trans">mapping</span>&nbsp;or&nbsp;<span id="ast-18" class="other_trans">guessed</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">src</span>,&nbsp;<span id="ast-22" class="other_trans">dst</span>)</span>&nbsp;in&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="correct_node">guessed&nbsp;&rarr;&nbsp;mapping&nbsp;</span>.items</span>()</span>:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">receiver</span>.input_types</span>.get</span>(<span id="ast-32" class="other_trans">dst</span>,&nbsp;<span id="ast-33">''</span>)</span><span id="ast-34" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-35">'list'</span>)</span>:<span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>disconnect_receiver_by_input</span>(<span id="ast-39" class="other_trans">receiver</span>,&nbsp;<span id="ast-40" class="other_trans">dst</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_update_addresses(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>stage_path</span>&nbsp;=&nbsp;<span id="ast-6">(<span id="ast-7">(<span id="ast-8">'/x/web/'</span>&nbsp;+&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.hostname</span>.upper</span>()</span>)</span>&nbsp;+&nbsp;<span id="ast-15">'/topo/STAGE2.default.topo'</span>)</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dev_path</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">os</span>.path</span>.expanduser</span>(<span id="ast-22">'~/.pyinfra/topo/STAGE2.default.topo'</span>)</span></span><span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>altus_path</span>&nbsp;=&nbsp;<span id="ast-25">'/x/web/LIVE/topo/STAGE2.default.topo'</span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27"><span id="ast-28">self</span>.stage_host</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-30">topos</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32" class="other_trans">path</span>&nbsp;in&nbsp;<span id="ast-33">(<span id="ast-34" class="other_trans">stage_path</span>,&nbsp;<span id="ast-35" class="other_trans">dev_path</span>,&nbsp;<span id="ast-36" class="other_trans">altus_path</span>)</span>:<span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-42" class="other_trans">path</span>)</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.topos</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48" class="other_trans">topos</span>.TopoFile</span>(<span id="ast-49" class="correct_node">stage_path&nbsp;&rarr;&nbsp;path&nbsp;</span>,&nbsp;ip=<span id="ast-51"><span id="ast-52">self</span>.stage_ip</span>)</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55"><span id="ast-56">self</span>.topos</span>:<span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addresses</span>&nbsp;=&nbsp;<span id="ast-59">(<span id="ast-61"><span id="ast-62"><span id="ast-63"><span id="ast-64">self</span>.topos</span>.get</span>(<span id="ast-65"><span id="ast-66">self</span>.appname</span>)</span>&nbsp;or&nbsp;<span id="ast-67">{}</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>addresses</span>&nbsp;=&nbsp;<span id="ast-70">{}</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__new__(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span>,&nbsp;<span id="ast-4" class="other_trans">name</span>,&nbsp;<span id="ast-5" class="other_trans">bases</span>,&nbsp;<span id="ast-6" class="other_trans">body</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>klass</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">type</span>.__new__</span>(<span id="ast-12" class="other_trans">cls</span>,&nbsp;<span id="ast-13" class="other_trans">name</span>,&nbsp;<span id="ast-14" class="other_trans">bases</span>,&nbsp;<span id="ast-15" class="other_trans">body</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">bases</span><span id="ast-19" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-20">(<span id="ast-21" class="other_trans">object</span>)</span>)</span>:<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cls</span>.binding_classes</span>.append</span>(<span id="ast-27" class="other_trans">klass</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">cls</span>.register_immediately</span>:<span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cls&nbsp;&rarr;&nbsp;klass&nbsp;</span>.register</span>()</span></span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-36" class="other_trans">klass</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__call__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">cb</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-7" class="other_trans">parts</span>,&nbsp;<span id="ast-8" class="other_trans">badchar</span>)</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">process</span>.clinetoargv</span>(<span id="ast-12"><span id="ast-13">self</span>.cline</span>,&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.kwargs</span>[<span id="ast-17"><span id="ast-18">'cwd'</span></span>]</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">parts</span><span id="ast-22" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-23" class="other_trans">None</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-25"><span id="ast-26">DataError</span>(<span id="ast-27">(<span id="ast-28">"native&nbsp;command&nbsp;'%s':&nbsp;shell&nbsp;metacharacter&nbsp;'%s'&nbsp;in&nbsp;command&nbsp;line"</span>&nbsp;%&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32">self</span>.cline</span>,&nbsp;<span id="ast-33" class="other_trans">badchar</span>)</span>)</span>,&nbsp;<span id="ast-34"><span id="ast-35">self</span>.loc</span>)</span></span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37">(<span id="ast-38"><span id="ast-39" class="other_trans">len</span>(<span id="ast-40" class="other_trans">parts</span>)</span><span id="ast-41" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-42">2</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-44"><span id="ast-45" class="other_trans">DataError</span>(<span id="ast-46">(<span id="ast-47">"native&nbsp;command&nbsp;'%s':&nbsp;no&nbsp;method&nbsp;name&nbsp;specified"</span>&nbsp;%&nbsp;<span id="ast-49" class="correct_node">cline&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>,&nbsp;<span id="ast-50"><span id="ast-51">self</span>.loc</span>)</span></span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>module</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">parts</span>[<span id="ast-56"><span id="ast-57">0</span></span>]</span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>method</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">parts</span>[<span id="ast-62"><span id="ast-63">1</span></span>]</span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cline_list</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">parts</span>[<span id="ast-68"><span id="ast-69">2</span>:</span>]</span></span><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.usercb</span>&nbsp;=&nbsp;<span id="ast-73" class="other_trans">cb</span></span><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>process</span>.call_native</span>(<span id="ast-78" class="other_trans">module</span>,&nbsp;<span id="ast-79" class="other_trans">method</span>,&nbsp;<span id="ast-80" class="other_trans">cline_list</span>,&nbsp;loc=<span id="ast-82"><span id="ast-83">self</span>.loc</span>,&nbsp;cb=<span id="ast-85"><span id="ast-86">self</span>._cb</span>,&nbsp;context=<span id="ast-88"><span id="ast-89">self</span>.context</span>,&nbsp;pycommandpath=<span id="ast-91"><span id="ast-92">self</span>.pycommandpath</span>,&nbsp;**<span id="ast-93"><span id="ast-94">self</span>.kwargs</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">name</span>,&nbsp;<span id="ast-5" class="other_trans">choices</span>,&nbsp;<span id="ast-7" class="other_trans">default_key</span>,&nbsp;<span id="ast-9" class="other_trans">default_value</span>,&nbsp;<span id="ast-11" class="other_trans">coerce_fn</span>,&nbsp;**kwargs</span>):<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Col</span>.__init__</span>(<span id="ast-17">self</span>,&nbsp;<span id="ast-18" class="other_trans">name</span>,&nbsp;**<span id="ast-19" class="incorrect_node">kwargs&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">choices</span><span id="ast-23" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-24" class="other_trans">None</span>)</span>:<span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.choices</span>&nbsp;=&nbsp;<span id="ast-28">{}</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-29"><span id="ast-30"><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.choices</span>&nbsp;=&nbsp;<span id="ast-32" class="other_trans">choices</span></span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.default_value</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38" class="ref_node">choices&nbsp;&rarr;&nbsp;self.&nbsp;</span>.get</span>(<span id="ast-39" class="other_trans">default_key</span>,&nbsp;<span id="ast-40" class="other_trans">default_value</span>)</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.coerce_fn</span>&nbsp;=&nbsp;<span id="ast-44" class="other_trans">coerce_fn</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;search(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">direction</span>,&nbsp;<span id="ast-5">args</span>,&nbsp;<span id="ast-6" class="other_trans">kwargs</span>,&nbsp;<span id="ast-7" class="other_trans">loss0</span></span>):<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11">loss0</span><span id="ast-12" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-13">None</span>)</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>loss0</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.f</span>(<span id="ast-19"><span id="ast-20">self</span>.wrt</span>,&nbsp;*<span id="ast-21" class="other_trans">args</span>,&nbsp;**<span id="ast-22" class="other_trans">kwargs</span>)</span></span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-24">s</span>&nbsp;in&nbsp;<span id="ast-25"><span id="ast-26">self</span>.schedule</span>:<span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>step</span>&nbsp;=&nbsp;<span id="ast-29">(<span id="ast-30">s</span>&nbsp;*&nbsp;<span id="ast-32" class="other_trans">direction</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34">(<span id="ast-35"><span id="ast-36">abs</span>(<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">step</span>.max</span>()</span>)</span><span id="ast-40" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-41"><span id="ast-42">self</span>.tolerance</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-44">0.0</span></span></span><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>candidate</span>&nbsp;=&nbsp;<span id="ast-47">(<span id="ast-48"><span id="ast-49">self</span>.wrt</span>&nbsp;+&nbsp;<span id="ast-51" class="other_trans">step</span>)</span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>loss</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">self</span>.f</span>(<span id="ast-57" class="other_trans">candidate</span>,&nbsp;*<span id="ast-58" class="other_trans">args</span>,&nbsp;**<span id="ast-59" class="other_trans">kwargs</span>)</span></span><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dir_dot_grad0</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans">scipy</span>.inner</span>(<span id="ast-65" class="other_trans">direction</span>,&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68">self</span>.fprime</span>(<span id="ast-69"><span id="ast-70">self</span>.wrt</span>)</span>)</span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72">(<span id="ast-73">loss</span><span id="ast-74" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-75">(<span id="ast-76" class="other_trans">loss0</span>&nbsp;+&nbsp;<span id="ast-78">(<span id="ast-79">(<span id="ast-80"><span id="ast-81">self</span>.c1</span>&nbsp;*&nbsp;<span id="ast-83" class="other_trans">s</span>)</span>&nbsp;*&nbsp;<span id="ast-85" class="other_trans">dir_dot_grad0</span>)</span>)</span>)</span>:<span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>grad</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90">self</span>.fprime</span>(<span id="ast-91" class="other_trans">candidate</span>,&nbsp;*<span id="ast-92" class="other_trans">args</span>,&nbsp;**<span id="ast-93" class="other_trans">kwargs</span>)</span></span><span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dir_dot_grad</span>&nbsp;=&nbsp;<span id="ast-96"><span id="ast-97"><span id="ast-98">scipy</span>.inner</span>(<span id="ast-99" class="other_trans">direction</span>,&nbsp;<span id="ast-100" class="other_trans">grad</span>)</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-102">(<span id="ast-103"><span id="ast-104">abs</span>(<span id="ast-105" class="other_trans">dir_dot_grad</span>)</span><span id="ast-106" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-107">(<span id="ast-108"><span id="ast-109">self</span>.c2</span>&nbsp;*&nbsp;<span id="ast-111"><span id="ast-112">abs</span>(<span id="ast-113" class="incorrect_node">dir_dot_grad0&nbsp;&rarr;&nbsp;dir_dot_grad&nbsp;</span>)</span>)</span>)</span>:<span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-115" class="other_trans">s</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;save_task(<span id="ast-2"><span id="ast-3" class="other_trans">task</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Saves&nbsp;the&nbsp;task&nbsp;package&nbsp;to&nbsp;Django\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-9">(<span id="ast-10">not</span>&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">task</span>.get</span>(<span id="ast-14">'save'</span>,&nbsp;<span id="ast-15">(<span id="ast-16"><span id="ast-17" class="other_trans">Conf</span>.SAVE_LIMIT</span><span id="ast-18" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-19">0</span>)</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">task</span>[<span id="ast-22"><span id="ast-23">'success'</span></span>]</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-27">(<span id="ast-29"><span id="ast-30" class="other_trans">task</span>[<span id="ast-31"><span id="ast-32">'success'</span></span>]</span>&nbsp;and&nbsp;<span id="ast-33">(<span id="ast-34">0</span><span id="ast-35" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-37"><span id="ast-38" class="other_trans">Conf</span>.SAVE_LIMIT</span><span id="ast-36" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">Success</span>.objects</span>.count</span>()</span>)</span>)</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Success</span>.objects</span>.last</span>()</span>.delete</span>()</span></span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Task</span>.objects</span>.create</span>(id=<span id="ast-56"><span id="ast-57" class="other_trans">task</span>[<span id="ast-58"><span id="ast-59">'id'</span></span>]</span>,&nbsp;name=<span id="ast-61"><span id="ast-62" class="other_trans">task</span>[<span id="ast-63"><span id="ast-64">'name'</span></span>]</span>,&nbsp;func=<span id="ast-66"><span id="ast-67" class="other_trans">task</span>[<span id="ast-68"><span id="ast-69">'func'</span></span>]</span>,&nbsp;hook=<span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans">task</span>.get</span>(<span id="ast-74">'hook'</span>)</span>,&nbsp;args=<span id="ast-76"><span id="ast-77" class="other_trans">task</span>[<span id="ast-78"><span id="ast-79">'args'</span></span>]</span>,&nbsp;kwargs=<span id="ast-81"><span id="ast-82" class="other_trans">task</span>[<span id="ast-83"><span id="ast-84">'kwargs'</span></span>]</span>,&nbsp;started=<span id="ast-86"><span id="ast-87" class="other_trans">task</span>[<span id="ast-88"><span id="ast-89">'started'</span></span>]</span>,&nbsp;stopped=<span id="ast-91"><span id="ast-92" class="other_trans">task</span>[<span id="ast-93"><span id="ast-94">'stopped'</span></span>]</span>,&nbsp;result=<span id="ast-96"><span id="ast-97" class="other_trans">task</span>[<span id="ast-98"><span id="ast-99">'result'</span></span>]</span>,&nbsp;group=<span id="ast-101"><span id="ast-102"><span id="ast-103" class="other_trans">task</span>.get</span>(<span id="ast-104">'group'</span>)</span>,&nbsp;success=<span id="ast-106"><span id="ast-107" class="other_trans">task</span>[<span id="ast-108"><span id="ast-109">'success'</span></span>]</span>)</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-111" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-112" class="other_trans">e</span>:<span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-117" class="other_trans">e</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">parent</span>,&nbsp;<span id="ast-5" class="other_trans">name</span>,&nbsp;<span id="ast-7">text</span>,&nbsp;<span id="ast-9" class="other_trans">font</span>,&nbsp;<span id="ast-11" class="other_trans">pt_size</span>,&nbsp;<span id="ast-13" class="other_trans">color</span>,&nbsp;<span id="ast-15" class="other_trans">outline_color</span>,&nbsp;<span id="ast-17" class="other_trans">outline_size</span>,&nbsp;<span id="ast-19">outline_smoothing</span>,&nbsp;<span id="ast-21" class="other_trans">pos</span>,&nbsp;<span id="ast-25" class="other_trans">sub_theme</span>,&nbsp;<span id="ast-27" class="other_trans">options</span></span>):<span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;parent:&nbsp;the&nbsp;widget's&nbsp;parent\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;name:&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;widget\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;text:&nbsp;the&nbsp;text&nbsp;to&nbsp;display&nbsp;(this&nbsp;can&nbsp;be&nbsp;changed&nbsp;later&nbsp;via&nbsp;the&nbsp;text&nbsp;property)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;font:&nbsp;the&nbsp;font&nbsp;to&nbsp;use\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;pt_size:&nbsp;the&nbsp;point&nbsp;size&nbsp;of&nbsp;the&nbsp;text&nbsp;to&nbsp;draw&nbsp;(defaults&nbsp;to&nbsp;30&nbsp;if&nbsp;None)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;color:&nbsp;the&nbsp;color&nbsp;to&nbsp;use&nbsp;when&nbsp;rendering&nbsp;the&nbsp;font\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;pos:&nbsp;a&nbsp;tuple&nbsp;containing&nbsp;the&nbsp;x&nbsp;and&nbsp;y&nbsp;position\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;sub_theme:&nbsp;name&nbsp;of&nbsp;a&nbsp;sub_theme&nbsp;defined&nbsp;in&nbsp;the&nbsp;theme&nbsp;file&nbsp;(similar&nbsp;to&nbsp;CSS&nbsp;classes)\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;options:&nbsp;various&nbsp;other&nbsp;options\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Widget</span>.__init__</span>(<span id="ast-35">self</span>,&nbsp;<span id="ast-36" class="other_trans">parent</span>,&nbsp;<span id="ast-37" class="other_trans">name</span>,&nbsp;<span id="ast-38" class="other_trans">None</span>,&nbsp;<span id="ast-39">[<span id="ast-40">0</span>,&nbsp;<span id="ast-41">0</span>]</span>,&nbsp;<span id="ast-42" class="other_trans">pos</span>,&nbsp;<span id="ast-43" class="other_trans">sub_theme</span>,&nbsp;<span id="ast-44" class="other_trans">options</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-46">font</span>:<span id="ast-47"><span id="ast-48"><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fontid</span>&nbsp;=&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52" class="other_trans">blf</span>.load</span>(<span id="ast-53">font</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-54"><span id="ast-55" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>font</span>&nbsp;=&nbsp;<span id="ast-56"><span id="ast-57"><span id="ast-58">self</span>.theme</span>[<span id="ast-59"><span id="ast-60">'Font'</span></span>]</span></span><span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.fontid</span>&nbsp;=&nbsp;<span id="ast-64"><span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans">blf</span>.load</span>(<span id="ast-69" class="other_trans">font</span>)</span>&nbsp;if&nbsp;<span id="ast-65" class="other_trans">font</span>&nbsp;else&nbsp;<span id="ast-70">0</span></span></span></span><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-72" class="other_trans">pt_size</span>:<span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.pt_size</span>&nbsp;=&nbsp;<span id="ast-76" class="other_trans">pt_size</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.pt_size</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82">self</span>.theme</span>[<span id="ast-83"><span id="ast-84">'Size'</span></span>]</span></span></span><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-86" class="other_trans">color</span>:<span id="ast-87"><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.color</span>&nbsp;=&nbsp;<span id="ast-90" class="incorrect_node">color&nbsp;&rarr;&nbsp;outline_color&nbsp;</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-91"><span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.color</span>&nbsp;=&nbsp;<span id="ast-94"><span id="ast-95"><span id="ast-96">self</span>.theme</span>[<span id="ast-97"><span id="ast-98">'Color'</span></span>]</span></span></span><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-100" class="other_trans">outline_color</span>:<span id="ast-101"><span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.outline_color</span>&nbsp;=&nbsp;<span id="ast-104" class="ref_node">color&nbsp;&rarr;&nbsp;outline_color&nbsp;</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-105"><span id="ast-106"><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.outline_color</span>&nbsp;=&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110">self</span>.theme</span>[<span id="ast-111"><span id="ast-112">'OutlineColor'</span></span>]</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;putOpaque(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">value</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Appends&nbsp;an&nbsp;Opaque&nbsp;data&nbsp;value&nbsp;to&nbsp;the&nbsp;message.'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">value</span>.string</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>length</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14" class="other_trans">len</span>(<span id="ast-15" class="other_trans">data</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-19">(<span id="ast-20" class="other_trans">systemVersion</span><span id="ast-21" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-22">'3'</span>)</span>&nbsp;and&nbsp;<span id="ast-23">(<span id="ast-24"><span id="ast-25" class="other_trans">type</span>(<span id="ast-26" class="ref_node">value&nbsp;&rarr;&nbsp;data&nbsp;</span>)</span><span id="ast-27" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-28" class="other_trans">bytes</span>)</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">data</span>.decode</span>(<span id="ast-34">'latin-1'</span>)</span></span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">length</span><span id="ast-38" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-39">40</span>)</span>:<span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>packed</span>&nbsp;=&nbsp;<span id="ast-42">(<span id="ast-43"><span id="ast-44" class="other_trans">chr</span>(<span id="ast-45">(<span id="ast-46"><span id="ast-47" class="other_trans">protocol</span>.OPAQUELEN0</span>&nbsp;+&nbsp;<span id="ast-49" class="other_trans">length</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-51" class="other_trans">data</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lengthStr</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">toByteString</span>(<span id="ast-56" class="other_trans">length</span>)</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>packed</span>&nbsp;=&nbsp;<span id="ast-59">(<span id="ast-60">(<span id="ast-61"><span id="ast-62">chr</span>(<span id="ast-63">(<span id="ast-64">(<span id="ast-65"><span id="ast-66">protocol</span>.OPAQUECOUNT1</span>&nbsp;-&nbsp;<span id="ast-68">1</span>)</span>&nbsp;+&nbsp;<span id="ast-70"><span id="ast-71" class="other_trans">len</span>(<span id="ast-72" class="other_trans">lengthStr</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-74" class="other_trans">lengthStr</span>)</span>&nbsp;+&nbsp;<span id="ast-76" class="other_trans">data</span>)</span></span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.__output</span>&nbsp;+=&nbsp;<span id="ast-81" class="other_trans">packed</span></span><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-83">self</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;buildPackages(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-5">(<span id="ast-6" class="other_trans">pack</span>,&nbsp;<span id="ast-7">(<span id="ast-8" class="other_trans">regex_single</span>,&nbsp;<span id="ast-9" class="other_trans">regex_split</span>)</span>)</span>&nbsp;in&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.packageRegex</span>.items</span>()</span>:<span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-15">dirname</span>&nbsp;in&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18">os</span>.listdir</span>(<span id="ast-19"><span id="ast-20">self</span>.distDir</span>)</span>:<span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subdir</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-27"><span id="ast-28">self</span>.distDir</span>,&nbsp;<span id="ast-29" class="other_trans">dirname</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-33">(<span id="ast-34">not</span>&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans">os</span>.path</span>.isdir</span>(<span id="ast-39" class="other_trans">subdir</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-40">(<span id="ast-41">not</span>&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44" class="location_node">subdir&nbsp;&rarr;&nbsp;dirname,&nbsp;pred:&nbsp;filename&nbsp;</span>.startswith</span>(<span id="ast-45">'_'</span>)</span>)</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-48" class="other_trans">filename</span>&nbsp;in&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51">os</span>.listdir</span>(<span id="ast-52">subdir</span>)</span>:<span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">re</span>.compile</span>(<span id="ast-59">regex_split</span>)</span>.match</span>(<span id="ast-60">filename</span>)</span>:<span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-62">(<span id="ast-63">not</span>&nbsp;<span id="ast-64"><span id="ast-65"><span id="ast-66">self</span>.buildSplitFiles</span>(<span id="ast-67" class="other_trans">pack</span>,&nbsp;<span id="ast-68" class="other_trans">subdir</span>,&nbsp;<span id="ast-69" class="other_trans">filename</span>)</span>)</span>:<span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-74">'Could&nbsp;not&nbsp;build&nbsp;split&nbsp;files&nbsp;packages'</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-76">False</span></span></span></span><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82">re</span>.compile</span>(<span id="ast-83" class="other_trans">regex_single</span>)</span>.match</span>(<span id="ast-84">filename</span>)</span>:<span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>file</span>&nbsp;=&nbsp;<span id="ast-87"><span id="ast-88"><span id="ast-89"><span id="ast-90">os</span>.path</span>.join</span>(<span id="ast-91" class="other_trans">subdir</span>,&nbsp;<span id="ast-92" class="other_trans">filename</span>)</span></span><span id="ast-93"><span id="ast-94" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ascfile</span>&nbsp;=&nbsp;<span id="ast-95">(<span id="ast-96" class="other_trans">file</span>&nbsp;+&nbsp;<span id="ast-98">'.asc'</span>)</span></span><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zpack</span>&nbsp;=&nbsp;<span id="ast-101">(<span id="ast-102" class="other_trans">pack</span>&nbsp;+&nbsp;<span id="ast-104">'.z'</span>)</span></span><span id="ast-105"><span id="ast-106" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zipFileName</span>&nbsp;=&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110">os</span>.path</span>.join</span>(<span id="ast-111"><span id="ast-112">self</span>.packDir</span>,&nbsp;<span id="ast-113" class="other_trans">zpack</span>)</span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-115"><span id="ast-116"><span id="ast-117">os</span>.access</span>(<span id="ast-118">ascfile</span>,&nbsp;<span id="ast-119"><span id="ast-120">os</span>.R_OK</span>)</span>:<span id="ast-121"><span id="ast-122" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zip</span>&nbsp;=&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125">zipfile</span>.ZipFile</span>(<span id="ast-126">zipFileName</span>,&nbsp;<span id="ast-127">'w'</span>)</span></span><span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zip</span>.write</span>(<span id="ast-132" class="other_trans">file</span>,&nbsp;<span id="ast-133"><span id="ast-134"><span id="ast-135"><span id="ast-136">os</span>.path</span>.basename</span>(<span id="ast-137" class="other_trans">file</span>)</span>)</span></span><span id="ast-138"><span id="ast-139"><span id="ast-140"><span id="ast-141" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zip</span>.write</span>(<span id="ast-142" class="other_trans">ascfile</span>,&nbsp;<span id="ast-143"><span id="ast-144"><span id="ast-145"><span id="ast-146">os</span>.path</span>.basename</span>(<span id="ast-147" class="other_trans">ascfile</span>)</span>)</span></span><span id="ast-148"><span id="ast-149"><span id="ast-150"><span id="ast-151" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zip</span>.close</span>()</span></span><span id="ast-152"><span id="ast-153"><span id="ast-154"><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.packageList</span>[<span id="ast-156"><span id="ast-157" class="other_trans">pack</span></span>]</span>&nbsp;=&nbsp;<span id="ast-158">zipFileName</span></span><span id="ast-159"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><span id="ast-160"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-161">(<span id="ast-162"><span id="ast-163">len</span>(<span id="ast-164"><span id="ast-165">self</span>.packageList</span>)</span><span id="ast-166" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-167">0</span>)</span>:<span id="ast-168"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-169">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-170"><span id="ast-171"><span id="ast-172"><span id="ast-173" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.error</span>(<span id="ast-174">'Failed&nbsp;to&nbsp;build&nbsp;packages'</span>)</span></span><span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-176">False</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process_fn(<span id="ast-2"><span id="ast-3" class="other_trans">record</span>,&nbsp;<span id="ast-4" class="other_trans">ht</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">record</span>[<span id="ast-10"><span id="ast-11">'name'</span></span>]</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>seq</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">record</span>[<span id="ast-16"><span id="ast-17">'sequence'</span></span>]</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20">'N'</span><span id="ast-21">&nbsp;in&nbsp;</span><span id="ast-22" class="other_trans">seq</span>)</span>:<span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-24">(<span id="ast-25" class="other_trans">None</span>,&nbsp;<span id="ast-26" class="other_trans">None</span>)</span></span></span><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-29" class="other_trans">trim_seq</span>,&nbsp;<span id="ast-30" class="other_trans">trim_at</span>)</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33" class="other_trans">ht</span>.trim_on_sodd</span>(<span id="ast-34" class="other_trans">seq</span>,&nbsp;<span id="ast-35" class="other_trans">MAX_SODD</span>)</span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37">(<span id="ast-38" class="other_trans">trim_at</span><span id="ast-39" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;<&nbsp;</span><span id="ast-40" class="other_trans">K</span>)</span>:<span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-42">(<span id="ast-43" class="other_trans">name</span>,&nbsp;<span id="ast-44" class="other_trans">trim_seq</span>)</span></span></span></span></span></span><br /><br /><hr />
</body></html>
