<html><head><style>
.ast { font-family: monospace; font-size: 12pt; }
.correct_node { font-weight: bold; background-color: green; color: white; }
.incorrect_node { font-weight: bold; background-color: red; color: white; }
.ref_node { font-weight: bold; background-color: blue; color: white; }
.location_node { font-weight: bold; background-color: #ff00ff; color: white; }
.other_trans { color: #3333ff; }
.whitespace { background-color: white; color: black; }
.pred_rank_wrapper { font-weight: bold; }
.correct_pred_rank { font-weight: bold; color: green;}
.incorrect_pred_rank { font-weight: bold; color: red; }
.rank_type { font-weight: bold; }
.description { font-size: 16pt; }
</style></head><body><div class="description">
<div><b>This is part 6/10 of the system predictions for the Real-Bug Test set. This system achieves 41% Repair Accuracy and 54% Location Accuracy.</b></div><br /><div><b>Annotations</b>:</div><ul><li><span class="correct_node">foo &rarr; bar</span> - The bug was located at this node, and the system <i>correctly</i> predicted both the location and the repair as its top prediction.</li><li><span class="incorrect_node">foo &rarr; bar</span> - The system <i>incorrectly</i> predicted this repair as its top prediction.</li><li><span class="ref_node">foo &rarr; bar</span> - If the system incorrectly predicted the repair, this was the correct repair it should have made.</li><li><span class="location_node">foo &rarr; bar, pred: zap</span> - The system predicted the correct <i>location</i> of the repair, but the wrong repair label. It should have predicted 'bar', but it predicted 'zap' instead.</li></ul><div>The part before the arrow ('foo') is what the system actually saw at test time. Other candidate repair locations which the system could have chosen are marked in <span class="other_trans">this color</span>. For clarity the actual labels for those locations are not shown.</div></div><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">chain</span>,&nbsp;<span id="ast-5" class="other_trans">private_key_bin</span>,&nbsp;<span id="ast-6" class="other_trans">transport</span>,&nbsp;<span id="ast-7">discovery</span>,&nbsp;<span id="ast-8" class="other_trans">config</span></span>):<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-12">(<span id="ast-13">not</span>&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">isinstance</span>(<span id="ast-16">private_key_bin</span>,&nbsp;<span id="ast-17" class="other_trans">bytes</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-18">(<span id="ast-19"><span id="ast-20">len</span>(<span id="ast-21" class="other_trans">private_key_bin</span>)</span><span id="ast-22" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-23">32</span>)</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-25"><span id="ast-26">ValueError</span>(<span id="ast-27">'invalid&nbsp;private_key'</span>)</span></span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>private_key</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31">PrivateKey</span>(<span id="ast-32" class="other_trans">private_key_bin</span>,&nbsp;ctx=<span id="ast-34">GLOBAL_CTX</span>,&nbsp;raw=<span id="ast-36">True</span>)</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pubkey</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">private_key</span>.pubkey</span>.serialize</span>(compressed=<span id="ast-44">False</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.registries</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">list</span>()</span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.managers_by_asset_address</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54">dict</span>()</span></span><span id="ast-55"><span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.managers_by_address</span>&nbsp;=&nbsp;<span id="ast-58"><span id="ast-59">dict</span>()</span></span><span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.event_listeners</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64" class="other_trans">list</span>()</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.chain</span>&nbsp;=&nbsp;<span id="ast-68" class="other_trans">chain</span></span><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.config</span>&nbsp;=&nbsp;<span id="ast-72" class="other_trans">config</span></span><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.privkey</span>&nbsp;=&nbsp;<span id="ast-76" class="other_trans">private_key_bin</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.pubkey</span>&nbsp;=&nbsp;<span id="ast-80" class="other_trans">pubkey</span></span><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.private_key</span>&nbsp;=&nbsp;<span id="ast-84" class="other_trans">private_key</span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.address</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89">privatekey_to_address</span>(<span id="ast-90" class="other_trans">private_key_bin</span>)</span></span><span id="ast-91"><span id="ast-92"><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.protocol</span>&nbsp;=&nbsp;<span id="ast-94"><span id="ast-95" class="other_trans">RaidenProtocol</span>(<span id="ast-96" class="other_trans">transport</span>,&nbsp;<span id="ast-97" class="other_trans">discovery</span>,&nbsp;<span id="ast-98">self</span>)</span></span><span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>transport</span>.protocol</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103">self</span>.protocol</span></span><span id="ast-104"><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>message_handler</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107">RaidenMessageHandler</span>(<span id="ast-108">self</span>)</span></span><span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>event_handler</span>&nbsp;=&nbsp;<span id="ast-111"><span id="ast-112">RaidenEventHandler</span>(<span id="ast-113">self</span>)</span></span><span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>alarm</span>&nbsp;=&nbsp;<span id="ast-116"><span id="ast-117">AlarmTask</span>(<span id="ast-118" class="other_trans">chain</span>)</span></span><span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>alarm</span>.start</span>()</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124">(<span id="ast-125"><span id="ast-126" class="other_trans">config</span>[<span id="ast-127"><span id="ast-128">'max_unresponsive_time'</span></span>]</span><span id="ast-129" class="correct_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-130">0</span>)</span>:<span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.healthcheck</span>&nbsp;=&nbsp;<span id="ast-134"><span id="ast-135" class="other_trans">HealthcheckTask</span>(<span id="ast-136">self</span>,&nbsp;<span id="ast-137"><span id="ast-138" class="other_trans">config</span>[<span id="ast-139"><span id="ast-140">'send_ping_time'</span></span>]</span>,&nbsp;<span id="ast-141"><span id="ast-142">config</span>[<span id="ast-143"><span id="ast-144">'max_unresponsive_time'</span></span>]</span>)</span></span><span id="ast-145"><span id="ast-146"><span id="ast-147"><span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.healthcheck</span>.start</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-150"><span id="ast-151"><span id="ast-152"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.healthcheck</span>&nbsp;=&nbsp;<span id="ast-153" class="other_trans">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;grunt_config(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">config</span>,&nbsp;<span id="ast-6" class="other_trans">key</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">grunt_conf</span>(config=<span id="ast-12"><span id="ast-17">{}</span>&nbsp;if&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">config</span><span id="ast-15" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-16" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-18" class="other_trans">config</span></span>,&nbsp;key=<span id="ast-20"><span id="ast-25" class="other_trans">key</span>&nbsp;if&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">key</span><span id="ast-23" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-24" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-26"><span id="ast-27">self</span>.grunt_config_key</span></span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;register_sdram_phy(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">phy_dfi</span>,&nbsp;<span id="ast-5" class="other_trans">phy_settings</span>,&nbsp;<span id="ast-6" class="other_trans">sdram_geom</span>,&nbsp;<span id="ast-7" class="other_trans">sdram_timing</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9"><span id="ast-10">self</span>._sdram_phy_registered</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-12" class="other_trans">FinalizeError</span></span></span><span id="ast-13"><span id="ast-14"><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._sdram_phy_registered</span>&nbsp;=&nbsp;<span id="ast-16">True</span></span><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.submodules</span>.dfii</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans">dfii</span>.DFIInjector</span>(<span id="ast-24"><span id="ast-25" class="other_trans">sdram_geom</span>.mux_a</span>,&nbsp;<span id="ast-26"><span id="ast-27" class="other_trans">sdram_geom</span>.bank_a</span>,&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">phy_settings</span>.dfi_d</span>,&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">phy_settings</span>.nphases</span>)</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.submodules</span>.dficon0</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38">dfi</span>.Interconnect</span>(<span id="ast-39"><span id="ast-40"><span id="ast-41">self</span>.dfii</span>.master</span>,&nbsp;<span id="ast-42" class="other_trans">phy_dfi</span>)</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-44">(<span id="ast-45"><span id="ast-46">self</span>.ramcon_type</span><span id="ast-47" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-48">'lasmicon'</span>)</span>:<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.submodules</span>.lasmicon</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">lasmicon</span>.LASMIcon</span>(<span id="ast-56" class="other_trans">phy_settings</span>,&nbsp;<span id="ast-57" class="other_trans">sdram_geom</span>,&nbsp;<span id="ast-58" class="other_trans">sdram_timing</span>)</span></span><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.submodules</span>.dficon1</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">dfi</span>.Interconnect</span>(<span id="ast-66"><span id="ast-67"><span id="ast-68">self</span>.lasmicon</span>.dfi</span>,&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71">self</span>.dfii</span>.slave</span>)</span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.submodules</span>.lasmixbar</span>&nbsp;=&nbsp;<span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans">lasmibus</span>.Crossbar</span>(<span id="ast-79">[<span id="ast-80"><span id="ast-81"><span id="ast-82">self</span>.lasmicon</span>.lasmic</span>]</span>,&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85">self</span>.lasmicon</span>.nrowbits</span>)</span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-87"><span id="ast-88">self</span>.with_memtest</span>:<span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.submodules</span>.memtest_w</span>&nbsp;=&nbsp;<span id="ast-93"><span id="ast-94"><span id="ast-95" class="other_trans">memtest</span>.MemtestWriter</span>(<span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99">self</span>.lasmixbar</span>.get_master</span>()</span>)</span></span><span id="ast-100"><span id="ast-101"><span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.submodules</span>.memtest_r</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans">memtest</span>.MemtestReader</span>(<span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110">self</span>.lasmixbar</span>.get_master</span>()</span>)</span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-112"><span id="ast-113">self</span>.with_l2</span>:<span id="ast-114"><span id="ast-115"><span id="ast-116"><span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.submodules</span>.wishbone2lasmi</span>&nbsp;=&nbsp;<span id="ast-118"><span id="ast-119"><span id="ast-120" class="other_trans">wishbone2lasmi</span>.WB2LASMI</span>(<span id="ast-121">(<span id="ast-122"><span id="ast-123">self</span>.l2_size</span>&nbsp;//&nbsp;<span id="ast-125">4</span>)</span>,&nbsp;<span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129">self</span>.lasmixbar</span>.get_master</span>()</span>)</span></span><span id="ast-130"><span id="ast-131" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sdram_size</span>&nbsp;=&nbsp;<span id="ast-132">(<span id="ast-133">(<span id="ast-134">(<span id="ast-135">(<span id="ast-136">2</span>&nbsp;**&nbsp;<span id="ast-138"><span id="ast-139"><span id="ast-140"><span id="ast-141">self</span>.lasmicon</span>.lasmic</span>.aw</span>)</span>&nbsp;*&nbsp;<span id="ast-143"><span id="ast-144"><span id="ast-145"><span id="ast-146">self</span>.lasmicon</span>.lasmic</span>.dw</span>)</span>&nbsp;*&nbsp;<span id="ast-148"><span id="ast-149"><span id="ast-150"><span id="ast-151">self</span>.lasmicon</span>.lasmic</span>.nbanks</span>)</span>&nbsp;//&nbsp;<span id="ast-153">8</span>)</span></span><span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.register_mem</span>(<span id="ast-158">'sdram'</span>,&nbsp;<span id="ast-159"><span id="ast-160"><span id="ast-161">self</span>.mem_map</span>[<span id="ast-162"><span id="ast-163">'sdram'</span></span>]</span>,&nbsp;<span id="ast-164"><span id="ast-165"><span id="ast-166">self</span>.wishbone2lasmi</span>.wishbone</span>,&nbsp;<span id="ast-167" class="other_trans">sdram_size</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-169">(<span id="ast-170"><span id="ast-171">self</span>.ramcon_type</span><span id="ast-172" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-173">'minicon'</span>)</span>:<span id="ast-174"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-175" class="correct_node">with_l2&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-177"><span id="ast-178" class="other_trans">ValueError</span>(<span id="ast-179">'MINICON&nbsp;does&nbsp;not&nbsp;implement&nbsp;L2&nbsp;cache&nbsp;(Use&nbsp;LASMICON)'</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>global&nbsp;mraa</span><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-7">mraa&nbsp;as&nbsp;mraa</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-9" class="other_trans">ImportError</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-11"><span id="ast-12" class="other_trans">ImportError</span>(<span id="ast-13">'pingo.galileo.Galileo2&nbsp;requires&nbsp;mraa&nbsp;installed'</span>)</span></span></span></span><span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-19" class="other_trans">Galileo2</span>,&nbsp;<span id="ast-20">self</span>)</span>.__init__</span>()</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.PIN_MODES</span>&nbsp;=&nbsp;<span id="ast-24">{<span id="ast-25"><span id="ast-26">pingo</span>.IN</span>:&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">mraa</span>.DIR_IN</span>,&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">pingo</span>.OUT</span>:&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">mraa</span>.DIR_OUT</span>}</span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.PIN_STATES</span>&nbsp;=&nbsp;<span id="ast-36">{<span id="ast-37"><span id="ast-38" class="other_trans">pingo</span>.HIGH</span>:&nbsp;<span id="ast-41">1</span>,&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">pingo</span>.LOW</span>:&nbsp;<span id="ast-42">0</span>}</span></span><span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pwm_pin_numbers</span>&nbsp;=&nbsp;<span id="ast-45">[<span id="ast-46">3</span>,&nbsp;<span id="ast-47">5</span>,&nbsp;<span id="ast-48">6</span>,&nbsp;<span id="ast-49">9</span>,&nbsp;<span id="ast-50">10</span>,&nbsp;<span id="ast-51">11</span>,&nbsp;<span id="ast-52">13</span>]</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>digital_pin_numbers</span>&nbsp;=&nbsp;<span id="ast-55">[<span id="ast-56">1</span>,&nbsp;<span id="ast-57">2</span>,&nbsp;<span id="ast-58">4</span>,&nbsp;<span id="ast-59">7</span>,&nbsp;<span id="ast-60">8</span>,&nbsp;<span id="ast-61">12</span>]</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._add_pins</span>(<span id="ast-66">(<span id="ast-67">(<span id="ast-68">[<span id="ast-69"><span id="ast-70"><span id="ast-71">pingo</span>.PwmPin</span>(<span id="ast-72">self</span>,&nbsp;<span id="ast-73" class="other_trans">location</span>)</span><span id="ast-74">&nbsp;for&nbsp;<span id="ast-75" class="other_trans">location</span>&nbsp;in&nbsp;<span id="ast-76" class="other_trans">pwm_pin_numbers</span></span>]</span>&nbsp;+&nbsp;<span id="ast-78">[<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans">pingo</span>.DigitalPin</span>(<span id="ast-82">self</span>,&nbsp;<span id="ast-83" class="other_trans">location</span>)</span><span id="ast-84">&nbsp;for&nbsp;<span id="ast-85" class="other_trans">location</span>&nbsp;in&nbsp;<span id="ast-86" class="other_trans">digital_pin_numbers</span></span>]</span>)</span>&nbsp;+&nbsp;<span id="ast-88">[<span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans">pingo</span>.AnalogPin</span>(<span id="ast-92">self</span>,&nbsp;<span id="ast-93">(<span id="ast-94">'A'</span>&nbsp;+&nbsp;<span id="ast-96" class="other_trans">location</span>)</span>,&nbsp;<span id="ast-97">12</span>)</span><span id="ast-98">&nbsp;for&nbsp;<span id="ast-99" class="other_trans">location</span>&nbsp;in&nbsp;<span id="ast-100">'012345'</span></span>]</span>)</span>)</span></span><span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-103"><span id="ast-104">self</span>.mraa_pins</span>,&nbsp;<span id="ast-105"><span id="ast-106">self</span>.mraa_analogs</span>,&nbsp;<span id="ast-107" class="correct_node">mraa_pwms&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>&nbsp;=&nbsp;<span id="ast-108">(<span id="ast-109">{}</span>,&nbsp;<span id="ast-110">{}</span>,&nbsp;<span id="ast-111">{}</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_has_connections_support(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Return&nbsp;True&nbsp;if&nbsp;this&nbsp;Windows&nbsp;version&nbsp;supports\\u000a&nbsp;&nbsp;&nbsp;&nbsp;GetExtendedTcpTable()&nbsp;and&nbsp;GetExtendedTcpTable()&nbsp;functions\\u000a&nbsp;&nbsp;&nbsp;&nbsp;introduced&nbsp;in&nbsp;Windows&nbsp;XP&nbsp;SP2.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-6">re</span></span><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-9" class="other_trans">maj</span>,&nbsp;<span id="ast-10" class="other_trans">_min</span>,&nbsp;<span id="ast-11" class="other_trans">build</span>,&nbsp;<span id="ast-12" class="other_trans">platf</span>,&nbsp;<span id="ast-13" class="other_trans">sp</span>)</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans">sys</span>.getwindowsversion</span>()</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sp</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">int</span>(<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">re</span>.search</span>(<span id="ast-27">'(\\\\d)'</span>,&nbsp;<span id="ast-28" class="other_trans">sp</span>)</span>.group</span>()</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-30">(<span id="ast-31">ValueError</span>,&nbsp;<span id="ast-32">AttributeError</span>)</span>:<span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sp</span>&nbsp;=&nbsp;<span id="ast-35">-1</span></span></span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37">(<span id="ast-38">(<span id="ast-39" class="other_trans">maj</span>,&nbsp;<span id="ast-40" class="other_trans">_min</span>)</span><span id="ast-41" class="ref_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-42">(<span id="ast-43">5</span>,&nbsp;<span id="ast-44">1</span>)</span>)</span>:<span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-48">(<span id="ast-49">(<span id="ast-50" class="other_trans">maj</span>,&nbsp;<span id="ast-51" class="other_trans">_min</span>)</span><span id="ast-52" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-53">(<span id="ast-54">5</span>,&nbsp;<span id="ast-55">1</span>)</span>)</span>:<span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-57">(<span id="ast-58" class="other_trans">sp</span><span id="ast-59" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-60">2</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-62">(<span id="ast-63">(<span id="ast-64" class="other_trans">maj</span>,&nbsp;<span id="ast-65" class="other_trans">_min</span>)</span><span id="ast-66" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-67">(<span id="ast-68">5</span>,&nbsp;<span id="ast-69">2</span>)</span>)</span>:<span id="ast-70"><span id="ast-71" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ver</span>&nbsp;=&nbsp;<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="other_trans">platform</span>.win32_ver</span>()</span>[<span id="ast-78"><span id="ast-79">0</span></span>]</span>.upper</span>()</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-81">(<span id="ast-82" class="other_trans">ver</span><span id="ast-83" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-84">'XP'</span>)</span>:<span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-86">(<span id="ast-87" class="other_trans">sp</span><span id="ast-88" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-89">2</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-91">(<span id="ast-93">(<span id="ast-94">'2003'</span><span id="ast-95">&nbsp;in&nbsp;</span><span id="ast-96" class="other_trans">ver</span>)</span>&nbsp;or&nbsp;<span id="ast-97">(<span id="ast-98">'SERVER'</span><span id="ast-99">&nbsp;in&nbsp;</span><span id="ast-100" class="other_trans">ver</span>)</span>)</span>:<span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-102">(<span id="ast-103" class="other_trans">sp</span><span id="ast-104" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-105">1</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-107">False</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-109">(<span id="ast-110">(<span id="ast-111" class="other_trans">maj</span>,&nbsp;<span id="ast-112" class="other_trans">_min</span>)</span><span id="ast-113" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-114">(<span id="ast-115">5</span>,&nbsp;<span id="ast-116">2</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;check_alias_uniqueness(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Check&nbsp;if&nbsp;the&nbsp;series&nbsp;alias&nbsp;is&nbsp;unique&nbsp;before&nbsp;initalizing&nbsp;the&nbsp;series&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>alias</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9">self</span>.alias</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-12">1</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="incorrect_node">session&nbsp;&rarr;&nbsp;self.&nbsp;</span>.query</span>(<span id="ast-21" class="other_trans">Series</span>)</span>.filter_by</span>(alias=<span id="ast-23" class="other_trans">alias</span>)</span>.all</span>()</span>:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>alias</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28">'{}-{}'</span>.format</span>(<span id="ast-29" class="ref_node">alias&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-30" class="other_trans">count</span>)</span></span><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;+=&nbsp;<span id="ast-34">1</span></span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.alias</span>&nbsp;=&nbsp;<span id="ast-38" class="other_trans">alias</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;partial_update(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">index</span>,&nbsp;<span id="ast-5" class="other_trans">doc_type</span>,&nbsp;<span id="ast-6" class="other_trans">id</span>,&nbsp;<span id="ast-7" class="other_trans">doc</span>,&nbsp;<span id="ast-9" class="other_trans">script</span>,&nbsp;<span id="ast-11" class="other_trans">params</span>,&nbsp;<span id="ast-13" class="other_trans">upsert</span>,&nbsp;<span id="ast-15" class="other_trans">querystring_args</span></span>):<span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Partially&nbsp;update&nbsp;a&nbsp;document&nbsp;with&nbsp;a&nbsp;script\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">querystring_args</span><span id="ast-22" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-23" class="other_trans">None</span>)</span>:<span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>querystring_args</span>&nbsp;=&nbsp;<span id="ast-26">{}</span></span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-30">(<span id="ast-31">doc</span><span id="ast-32" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-33" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-34">(<span id="ast-35" class="other_trans">script</span><span id="ast-36" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-37">None</span>)</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-39"><span id="ast-40">InvalidQuery</span>(<span id="ast-41">'script&nbsp;or&nbsp;doc&nbsp;can&nbsp;not&nbsp;both&nbsp;be&nbsp;None'</span>)</span></span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-44" class="other_trans">doc</span><span id="ast-45" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-46">None</span>)</span>:<span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cmd</span>&nbsp;=&nbsp;<span id="ast-49">{<span id="ast-50">'script'</span>:&nbsp;<span id="ast-51">script</span>}</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53" class="other_trans">params</span>:<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cmd</span>[<span id="ast-57"><span id="ast-58">'params'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-59" class="other_trans">params</span></span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61" class="other_trans">upsert</span>:<span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cmd</span>[<span id="ast-65"><span id="ast-66">'upsert'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-67" class="ref_node">params&nbsp;&rarr;&nbsp;upsert&nbsp;</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cmd</span>&nbsp;=&nbsp;<span id="ast-70">{<span id="ast-71">'doc'</span>:&nbsp;<span id="ast-72" class="other_trans">doc</span>}</span></span></span><span id="ast-73"><span id="ast-74" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76">make_path</span>(<span id="ast-77" class="other_trans">index</span>,&nbsp;<span id="ast-78">doc_type</span>,&nbsp;<span id="ast-79">id</span>,&nbsp;<span id="ast-80">'_update'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;extract_image(<span id="ast-2"><span id="ast-3" class="other_trans">path</span>,&nbsp;<span id="ast-4" class="other_trans">languages</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Use&nbsp;tesseract&nbsp;to&nbsp;extract&nbsp;text&nbsp;in&nbsp;the&nbsp;given&nbsp;``languages``&nbsp;from&nbsp;an\\u000a&nbsp;&nbsp;&nbsp;&nbsp;image&nbsp;file.&nbsp;Tesseract&nbsp;should&nbsp;support&nbsp;a&nbsp;wide&nbsp;range&nbsp;of&nbsp;formats,&nbsp;including\\u000a&nbsp;&nbsp;&nbsp;&nbsp;PNG,&nbsp;TIFF&nbsp;and&nbsp;JPG.&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-10" class="other_trans">sysfd</span>,&nbsp;<span id="ast-11" class="other_trans">page_dest</span>)</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13">mkstemp</span>()</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>page_out</span>&nbsp;=&nbsp;<span id="ast-16">(<span id="ast-17">'%s.txt'</span>&nbsp;%&nbsp;<span id="ast-19" class="other_trans">page_dest</span>)</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-25">(<span id="ast-26">languages</span><span id="ast-27" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-28">None</span>)</span>&nbsp;or&nbsp;<span id="ast-29">(<span id="ast-30">not</span>&nbsp;<span id="ast-31"><span id="ast-32">len</span>(<span id="ast-33" class="other_trans">languages</span>)</span>)</span>)</span>:<span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>languages</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38">LANGUAGES</span>.keys</span>()</span></span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>languages</span>&nbsp;=&nbsp;<span id="ast-41">[<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45">l</span>[<span id="ast-46">:<span id="ast-47">2</span></span>]</span>.lower</span>()</span><span id="ast-48">&nbsp;for&nbsp;<span id="ast-49" class="other_trans">l</span>&nbsp;in&nbsp;<span id="ast-50" class="other_trans">languages</span></span>]</span></span><span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>languages</span>&nbsp;=&nbsp;<span id="ast-53">[<span id="ast-54"><span id="ast-55"><span id="ast-56">LANGUAGES</span>.get</span>(<span id="ast-57" class="other_trans">l</span>)</span><span id="ast-58">&nbsp;for&nbsp;<span id="ast-59" class="other_trans">l</span>&nbsp;in&nbsp;<span id="ast-60" class="other_trans">languages</span></span>]</span></span><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>languages</span>&nbsp;=&nbsp;<span id="ast-63">[<span id="ast-64" class="other_trans">l</span><span id="ast-65">&nbsp;for&nbsp;<span id="ast-66">l</span>&nbsp;in&nbsp;<span id="ast-67">languages</span>&nbsp;if&nbsp;<span id="ast-68">(<span id="ast-69">l</span><span id="ast-70" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-71" class="other_trans">None</span>)</span></span>]</span></span><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>languages</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75"><span id="ast-76">'+'</span>.join</span>(<span id="ast-77" class="other_trans">languages</span>)</span></span><span id="ast-78"><span id="ast-79" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>bin_path</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83">os</span>.environ</span>.get</span>(<span id="ast-84">'TESSERACT_BIN'</span>,&nbsp;<span id="ast-85">'tesseract'</span>)</span></span><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-88">[<span id="ast-89">bin_path</span>,&nbsp;<span id="ast-90" class="other_trans">path</span>,&nbsp;<span id="ast-91" class="other_trans">page_dest</span>,&nbsp;<span id="ast-92">'-l'</span>,&nbsp;<span id="ast-93" class="other_trans">languages</span>,&nbsp;<span id="ast-94">'-psm'</span>,&nbsp;<span id="ast-95">'1'</span>]</span></span><span id="ast-96"><span id="ast-97"><span id="ast-98"><span id="ast-99"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subprocess</span>.call</span>(<span id="ast-100">args</span>)</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-102"><span id="ast-103">open</span>(<span id="ast-104" class="other_trans">page_out</span>,&nbsp;<span id="ast-105">'rb'</span>)</span>&nbsp;as&nbsp;<span id="ast-106">fh</span>:<span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-108"><span id="ast-109"><span id="ast-110">fh</span>.read</span>()</span></span></span><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-112">Exception</span>&nbsp;as&nbsp;<span id="ast-113">ex</span>:<span id="ast-114"><span id="ast-115"><span id="ast-116"><span id="ast-117" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.exception</span>(<span id="ast-118">ex</span>)</span></span><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-120">''</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>finally:<span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.close</span>(<span id="ast-125" class="other_trans">sysfd</span>)</span></span><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130" class="other_trans">os</span>.path</span>.isfile</span>(<span id="ast-131" class="other_trans">page_dest</span>)</span>:<span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.unlink</span>(<span id="ast-136" class="other_trans">page_dest</span>)</span></span></span><span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-138"><span id="ast-139"><span id="ast-140"><span id="ast-141">os</span>.path</span>.isfile</span>(<span id="ast-142" class="other_trans">page_out</span>)</span>:<span id="ast-143"><span id="ast-144"><span id="ast-145"><span id="ast-146" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.unlink</span>(<span id="ast-147">page_out</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7" class="other_trans">argparse</span>.ArgumentParser</span>()</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-12">'-c'</span>,&nbsp;<span id="ast-13">'--conf'</span>,&nbsp;default=<span id="ast-15">'snapraid-runner.conf'</span>,&nbsp;metavar=<span id="ast-17">'CONFIG'</span>,&nbsp;help=<span id="ast-19">'Configuration&nbsp;file&nbsp;(default:&nbsp;%(default)s)'</span>)</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>parser</span>.add_argument</span>(<span id="ast-24">'--no-scrub'</span>,&nbsp;action=<span id="ast-26">'store_false'</span>,&nbsp;dest=<span id="ast-28">'scrub'</span>,&nbsp;default=<span id="ast-30" class="other_trans">None</span>,&nbsp;help=<span id="ast-32">'Do&nbsp;not&nbsp;scrub&nbsp;(overrides&nbsp;config)'</span>)</span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">parser</span>.parse_args</span>()</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40">not</span>&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-45"><span id="ast-46" class="other_trans">args</span>.conf</span>)</span>)</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-48">'snapraid-runner&nbsp;configuration&nbsp;file&nbsp;not&nbsp;found'</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>args&nbsp;&rarr;&nbsp;parser&nbsp;</span>.print_help</span>()</span></span><span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-57">2</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_context_data(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>review_stage</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="incorrect_node">ReviewsConfig&nbsp;&rarr;&nbsp;self.&nbsp;</span>.stage</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>other_reviews</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">Review</span>.objects</span>.filter_current_reviews</span>(proposal=<span id="ast-17"><span id="ast-18">self</span>.proposal</span>,&nbsp;exclude_user=<span id="ast-20"><span id="ast-21"><span id="ast-22">self</span>.request</span>.user</span>)</span>.order_by</span>(<span id="ast-23">'stage'</span>,&nbsp;<span id="ast-24">'?'</span>)</span></span><span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>my_reviews</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">Review</span>.objects</span>.filter_current_reviews</span>(proposal=<span id="ast-34"><span id="ast-35">self</span>.proposal</span>,&nbsp;filter_user=<span id="ast-37"><span id="ast-38"><span id="ast-39">self</span>.request</span>.user</span>)</span>.order_by</span>(<span id="ast-40">'stage'</span>)</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42">(<span id="ast-44">(<span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>.proposal</span>.accepted</span><span id="ast-48" class="ref_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-49" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-50"><span id="ast-51">self</span>.object</span>)</span>:<span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>my_reviews</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">my_reviews</span>.exclude</span>(pk=<span id="ast-58"><span id="ast-59"><span id="ast-60">self</span>.object</span>.pk</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;eval_result_as_kmap_grid(<span id="ast-2"><span id="ast-3" class="other_trans">eval_result</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Convert&nbsp;an&nbsp;``EvaluationResultWrapper``&nbsp;instance&nbsp;to&nbsp;a&nbsp;representation&nbsp;of&nbsp;a\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Karnuagh&nbsp;Map.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval_result&nbsp;(EvaluationResultWrapper):&nbsp;The&nbsp;result&nbsp;instance&nbsp;which&nbsp;will\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;be&nbsp;converted&nbsp;to&nbsp;a&nbsp;more&nbsp;intuitive&nbsp;representation&nbsp;of&nbsp;a&nbsp;Karnaugh&nbsp;Map.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Returns:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List[List[KmapPoint]]:&nbsp;A&nbsp;list&nbsp;array&nbsp;of&nbsp;``KmapPoint``s,&nbsp;in&nbsp;row-by-row\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ordering&nbsp;according&nbsp;to&nbsp;increasing&nbsp;Gray&nbsp;Code.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Raises:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TooFewKarnaughMapInputs:&nbsp;Raise&nbsp;if&nbsp;less&nbsp;than&nbsp;2&nbsp;inputs&nbsp;are&nbsp;found&nbsp;in\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;``eval_result``.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>num_vars</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">len</span>(<span id="ast-10"><span id="ast-11" class="other_trans">eval_result</span>.input_symbols</span>)</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">num_vars</span><span id="ast-15" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-16">2</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">TooFewKarnaughMapInputs</span>(<span id="ast-20">'Karnaugh&nbsp;Map&nbsp;generation&nbsp;requires&nbsp;an&nbsp;equation&nbsp;of&nbsp;at&nbsp;least&nbsp;2&nbsp;variables.'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_login(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">position</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.log</span>.info</span>(<span id="ast-10">'Attempting&nbsp;login'</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>consecutive_fails</span>&nbsp;=&nbsp;<span id="ast-13">0</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-15">(<span id="ast-16">not</span>&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20">self</span>._auth_provider</span>.login</span>()</span>)</span>:<span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sleep_t</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">min</span>(<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">math</span>.exp</span>(<span id="ast-28">(<span id="ast-29" class="other_trans">consecutive_fails</span>&nbsp;/&nbsp;<span id="ast-31">1.7</span>)</span>)</span>,&nbsp;<span id="ast-32">(<span id="ast-33">5</span>&nbsp;*&nbsp;<span id="ast-35">60</span>)</span>)</span></span><span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log&nbsp;&rarr;&nbsp;self.&nbsp;</span>.info</span>(<span id="ast-40"><span id="ast-41"><span id="ast-42">'Login&nbsp;failed,&nbsp;retrying&nbsp;in&nbsp;{:.2f}&nbsp;seconds'</span>.format</span>(<span id="ast-43" class="other_trans">sleep_t</span>)</span>)</span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>consecutive_fails</span>&nbsp;+=&nbsp;<span id="ast-47">1</span></span><span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time</span>.sleep</span>(<span id="ast-52" class="other_trans">sleep_t</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;align(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">alignParams</span>,&nbsp;<span id="ast-5" class="other_trans">scope</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-10" class="other_trans">alignProgram</span>,&nbsp;<span id="ast-11" class="other_trans">alignExt</span>,&nbsp;<span id="ast-12" class="other_trans">alignBinary</span>,&nbsp;<span id="ast-13" class="other_trans">binaryParams</span>,&nbsp;<span id="ast-14" class="other_trans">alignRef</span>)</span>&nbsp;=&nbsp;<span id="ast-15" class="other_trans">alignParams</span></span><span id="ast-16"><span id="ast-17"><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.scope</span>&nbsp;=&nbsp;<span id="ast-19" class="other_trans">scope</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>utils</span>.log</span>(<span id="ast-24"><span id="ast-25">self</span>.loggingName</span>,&nbsp;<span id="ast-26">'info'</span>,&nbsp;<span id="ast-27">(<span id="ast-28">'Running&nbsp;realignment&nbsp;with&nbsp;%s,&nbsp;storing&nbsp;results&nbsp;in&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-30">(<span id="ast-31" class="other_trans">alignProgram</span>,&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>.contig</span>.meta</span>.fa_fn</span>)</span>)</span>)</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>resultFn</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-42"><span id="ast-43"><span id="ast-44" class="correct_node">contig&nbsp;&rarr;&nbsp;self.&nbsp;</span>.get_path</span>()</span>,&nbsp;<span id="ast-45">(<span id="ast-46">'%s_res.%s.%s'</span>&nbsp;%&nbsp;<span id="ast-48">(<span id="ast-49" class="other_trans">alignProgram</span>,&nbsp;<span id="ast-50" class="other_trans">scope</span>,&nbsp;<span id="ast-51" class="other_trans">alignExt</span>)</span>)</span>)</span></span><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.results</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">AlignResults</span>(<span id="ast-57" class="other_trans">alignProgram</span>,&nbsp;<span id="ast-58" class="other_trans">scope</span>,&nbsp;<span id="ast-59" class="other_trans">resultFn</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">argv</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6"><span id="ast-7" class="other_trans">len</span>(<span id="ast-8" class="other_trans">argv</span>)</span><span id="ast-9" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-10">2</span>)</span>:<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-5">True</span>:<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-9" class="other_trans">_</span>,&nbsp;<span id="ast-10" class="other_trans">event</span>)</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.session</span>.blpop</span>(<span id="ast-15"><span id="ast-16"><span id="ast-17">'drivers:{}:events'</span>.format</span>(<span id="ast-18"><span id="ast-19">self</span>.name</span>)</span>)</span></span><span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-22" class="other_trans">driver</span>,&nbsp;<span id="ast-23" class="other_trans">fid</span>)</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">event</span>.split</span>(<span id="ast-27">':'</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-29"><span id="ast-30" class="other_trans">redis</span>.ConnectionError</span>:<span id="ast-31"><span id="ast-32"><span id="ast-33" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>exit&nbsp;&rarr;&nbsp;self.&nbsp;</span>()</span></span></span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.session</span>.lrem</span>(<span id="ast-39"><span id="ast-40"><span id="ast-41">'drivers:{}:events'</span>.format</span>(<span id="ast-42"><span id="ast-43">self</span>.name</span>)</span>,&nbsp;<span id="ast-44" class="ref_node">fid&nbsp;&rarr;&nbsp;event&nbsp;</span>)</span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.get_file</span>(<span id="ast-49" class="other_trans">fid</span>,&nbsp;<span id="ast-50" class="other_trans">driver</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_subnet_edge(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>secondaddress</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">network</span>.allocate_ip</span>(<span id="ast-9">'netuser'</span>,&nbsp;<span id="ast-10">'project0'</span>,&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">utils</span>.generate_mac</span>()</span>)</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>hostname</span>&nbsp;=&nbsp;<span id="ast-16">'toomany-hosts'</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-18" class="other_trans">project</span>&nbsp;in&nbsp;<span id="ast-19"><span id="ast-20">range</span>(<span id="ast-21">1</span>,&nbsp;<span id="ast-22">5</span>)</span>:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>project_id</span>&nbsp;=&nbsp;<span id="ast-25">(<span id="ast-26">'project%s'</span>&nbsp;%&nbsp;<span id="ast-28">project</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mac</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32"><span id="ast-33">utils</span>.generate_mac</span>()</span></span><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mac2</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37"><span id="ast-38">utils</span>.generate_mac</span>()</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mac3</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans">utils</span>.generate_mac</span>()</span></span><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>address</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48">network</span>.allocate_ip</span>(<span id="ast-49">'netuser'</span>,&nbsp;<span id="ast-50">project_id</span>,&nbsp;<span id="ast-51" class="other_trans">mac</span>)</span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>address2</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56">network</span>.allocate_ip</span>(<span id="ast-57">'netuser'</span>,&nbsp;<span id="ast-58">project_id</span>,&nbsp;<span id="ast-59" class="other_trans">mac2</span>)</span></span><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>address3</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans">network</span>.allocate_ip</span>(<span id="ast-65">'netuser'</span>,&nbsp;<span id="ast-66" class="other_trans">project_id</span>,&nbsp;<span id="ast-67" class="other_trans">mac3</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-72">False</span>,&nbsp;<span id="ast-73"><span id="ast-74">is_in_project</span>(<span id="ast-75" class="other_trans">address</span>,&nbsp;<span id="ast-76">'project0'</span>)</span>)</span></span><span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-81">False</span>,&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">is_in_project</span>(<span id="ast-84">address2</span>,&nbsp;<span id="ast-85">'project0'</span>)</span>)</span></span><span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-90">False</span>,&nbsp;<span id="ast-91"><span id="ast-92" class="other_trans">is_in_project</span>(<span id="ast-93">address3</span>,&nbsp;<span id="ast-94">'project0'</span>)</span>)</span></span><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rv</span>&nbsp;=&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99">network</span>.deallocate_ip</span>(<span id="ast-100" class="other_trans">address</span>)</span></span><span id="ast-101"><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rv</span>&nbsp;=&nbsp;<span id="ast-103"><span id="ast-104"><span id="ast-105">network</span>.deallocate_ip</span>(<span id="ast-106" class="other_trans">address2</span>)</span></span><span id="ast-107"><span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rv</span>&nbsp;=&nbsp;<span id="ast-109"><span id="ast-110"><span id="ast-111">network</span>.deallocate_ip</span>(<span id="ast-112">address3</span>)</span></span><span id="ast-113"><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>net</span>&nbsp;=&nbsp;<span id="ast-115"><span id="ast-116"><span id="ast-117" class="other_trans">network</span>.get_project_network</span>(<span id="ast-118" class="other_trans">project_id</span>,&nbsp;<span id="ast-119">'default'</span>)</span></span><span id="ast-120"><span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.dnsmasq</span>.release_ip</span>(<span id="ast-125" class="other_trans">mac</span>,&nbsp;<span id="ast-126" class="other_trans">address</span>,&nbsp;<span id="ast-127">hostname</span>,&nbsp;<span id="ast-128"><span id="ast-129" class="other_trans">net</span>.bridge_name</span>)</span></span><span id="ast-130"><span id="ast-131"><span id="ast-132"><span id="ast-133"><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.dnsmasq</span>.release_ip</span>(<span id="ast-135" class="other_trans">mac2</span>,&nbsp;<span id="ast-136" class="other_trans">address2</span>,&nbsp;<span id="ast-137" class="other_trans">hostname</span>,&nbsp;<span id="ast-138"><span id="ast-139" class="other_trans">net</span>.bridge_name</span>)</span></span><span id="ast-140"><span id="ast-141"><span id="ast-142"><span id="ast-143"><span id="ast-144"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.dnsmasq</span>.release_ip</span>(<span id="ast-145" class="incorrect_node">mac3&nbsp;&rarr;&nbsp;project_id&nbsp;</span>,&nbsp;<span id="ast-146" class="other_trans">address3</span>,&nbsp;<span id="ast-147" class="other_trans">hostname</span>,&nbsp;<span id="ast-148"><span id="ast-149">net</span>.bridge_name</span>)</span></span></span><span id="ast-150"><span id="ast-151" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>net</span>&nbsp;=&nbsp;<span id="ast-152"><span id="ast-153"><span id="ast-154">network</span>.get_project_network</span>(<span id="ast-155">'project0'</span>,&nbsp;<span id="ast-156">'default'</span>)</span></span><span id="ast-157"><span id="ast-158" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rv</span>&nbsp;=&nbsp;<span id="ast-159"><span id="ast-160"><span id="ast-161">network</span>.deallocate_ip</span>(<span id="ast-162" class="other_trans">secondaddress</span>)</span></span><span id="ast-163"><span id="ast-164"><span id="ast-165"><span id="ast-166"><span id="ast-167"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.dnsmasq</span>.release_ip</span>(<span id="ast-168">mac</span>,&nbsp;<span id="ast-169" class="ref_node">address&nbsp;&rarr;&nbsp;secondaddress&nbsp;</span>,&nbsp;<span id="ast-170" class="other_trans">hostname</span>,&nbsp;<span id="ast-171"><span id="ast-172" class="other_trans">net</span>.bridge_name</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-9" class="other_trans">Notify</span>,&nbsp;<span id="ast-10">self</span>)</span>.__init__</span>()</span></span><span id="ast-11"><span id="ast-12"><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.messages</span>&nbsp;=&nbsp;<span id="ast-14">{}</span></span><span id="ast-15"><span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.notify_func</span>&nbsp;=&nbsp;<span id="ast-18" class="other_trans">None</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">common</span>.IS_MACOSX</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>commands</span>&nbsp;=&nbsp;<span id="ast-24">[<span id="ast-25">'terminal-notifier'</span>,&nbsp;<span id="ast-26">'growlnotify'</span>]</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-28" class="other_trans">commands</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>command</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="correct_node">command&nbsp;&rarr;&nbsp;commands&nbsp;</span>.pop</span>()</span></span><span id="ast-35"><span id="ast-36"><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>common</span>.extract_app_paths</span>(<span id="ast-39" class="other_trans">command</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-41" class="other_trans">ValueError</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_get_python_files(<span id="ast-2"><span id="ast-3" class="other_trans">paths</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-5" class="other_trans">path</span>&nbsp;in&nbsp;<span id="ast-6" class="other_trans">paths</span>:<span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">os</span>.path</span>.isdir</span>(<span id="ast-12" class="other_trans">path</span>)</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-14">(<span id="ast-15" class="other_trans">dirpath</span>,&nbsp;<span id="ast-16">dirnames</span>,&nbsp;<span id="ast-17" class="other_trans">filenames</span>)</span>&nbsp;in&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">os</span>.walk</span>(<span id="ast-21" class="other_trans">path</span>)</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">pep8style</span>.excluded</span>(<span id="ast-26" class="other_trans">dirpath</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29" class="other_trans">filename</span>&nbsp;in&nbsp;<span id="ast-30" class="other_trans">filenames</span>:<span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33">not</span>&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">filename</span>.endswith</span>(<span id="ast-37">'.py'</span>)</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fullpath</span>&nbsp;=&nbsp;<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44">os</span>.path</span>.join</span>(<span id="ast-45" class="other_trans">dirpath</span>,&nbsp;<span id="ast-46" class="other_trans">filename</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48">(<span id="ast-50">(<span id="ast-51">not</span>&nbsp;<span id="ast-52"><span id="ast-53">skip_file</span>(<span id="ast-54" class="other_trans">fullpath</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">pep8style</span>.excluded</span>(<span id="ast-58" class="other_trans">fullpath</span>)</span>)</span>:<span id="ast-59"><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-61" class="other_trans">fullpath</span></span></span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-63">(<span id="ast-65">(<span id="ast-66">not</span>&nbsp;<span id="ast-67"><span id="ast-68" class="other_trans">skip_file</span>(<span id="ast-69" class="other_trans">path</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">pep8style</span>.excluded</span>(<span id="ast-73" class="ref_node">fullpath&nbsp;&rarr;&nbsp;path&nbsp;</span>)</span>)</span>:<span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-76" class="incorrect_node">path&nbsp;&rarr;&nbsp;fullpath&nbsp;</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;sync_older_local_file(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">local_file</span>,&nbsp;<span id="ast-5" class="other_trans">remote_file</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9">self</span>._check_del_unmatched</span>(<span id="ast-10" class="other_trans">remote_file</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.options</span>.get</span>(<span id="ast-18">'force'</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._log_action</span>(<span id="ast-23">'restore'</span>,&nbsp;<span id="ast-24">'older'</span>,&nbsp;<span id="ast-25">'&gt;'</span>,&nbsp;<span id="ast-26" class="other_trans">local_file</span>)</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._copy_file</span>(<span id="ast-31"><span id="ast-32">self</span>.local</span>,&nbsp;<span id="ast-33"><span id="ast-34">self</span>.remote</span>,&nbsp;<span id="ast-35" class="correct_node">remote_file&nbsp;&rarr;&nbsp;local_file&nbsp;</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-36"><span id="ast-37"><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._log_action</span>(<span id="ast-40">'skip'</span>,&nbsp;<span id="ast-41">'older'</span>,&nbsp;<span id="ast-42">'?'</span>,&nbsp;<span id="ast-43" class="other_trans">local_file</span>,&nbsp;<span id="ast-44">4</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">_obj</span>,&nbsp;**kwargs</span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-11" class="other_trans">JsonObject</span>,&nbsp;<span id="ast-12">self</span>)</span>.__init__</span>()</span></span><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-16">self</span>,&nbsp;<span id="ast-17">'_$'</span>,&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">_JsonObjectPrivateInstanceVariables</span>()</span>)</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._obj</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">check_type</span>(<span id="ast-25" class="other_trans">_obj</span>,&nbsp;<span id="ast-26" class="other_trans">dict</span>,&nbsp;<span id="ast-27">'JsonObject&nbsp;must&nbsp;wrap&nbsp;a&nbsp;dict&nbsp;or&nbsp;None'</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">key</span>,&nbsp;<span id="ast-31" class="other_trans">value</span>)</span>&nbsp;in&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>._obj</span>.items</span>()</span>:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>wrapped</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39"><span id="ast-40">self</span>.__wrap</span>(<span id="ast-41" class="other_trans">key</span>,&nbsp;<span id="ast-42" class="other_trans">value</span>)</span></span><span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-44">(<span id="ast-45" class="other_trans">key</span><span id="ast-46">&nbsp;in&nbsp;</span><span id="ast-47"><span id="ast-48">self</span>._properties_by_key</span>)</span>:<span id="ast-49"><span id="ast-50"><span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>[<span id="ast-52"><span id="ast-53" class="other_trans">key</span></span>]</span>&nbsp;=&nbsp;<span id="ast-54" class="other_trans">wrapped</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setattr</span>(<span id="ast-58">self</span>,&nbsp;<span id="ast-59" class="other_trans">key</span>,&nbsp;<span id="ast-60" class="correct_node">value&nbsp;&rarr;&nbsp;wrapped&nbsp;</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;client_for(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">config_path</span>,&nbsp;<span id="ast-5" class="other_trans">create</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>abs_path</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11"><span id="ast-12" class="other_trans">os</span>.path</span>.abspath</span>(<span id="ast-13" class="other_trans">config_path</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">abs_path</span><span id="ast-17">&nbsp;in&nbsp;</span><span id="ast-18"><span id="ast-19">self</span>.clients</span>)</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.clients</span>[<span id="ast-24"><span id="ast-25" class="other_trans">abs_path</span></span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-27" class="other_trans">create</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>client</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">EnsimeClient</span>(<span id="ast-32" class="ref_node">vim&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-33" class="incorrect_node">config_path&nbsp;&rarr;&nbsp;abs_path&nbsp;</span>)</span></span><span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.clients</span>[<span id="ast-38"><span id="ast-39" class="other_trans">abs_path</span></span>]</span>&nbsp;=&nbsp;<span id="ast-40" class="other_trans">client</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.__message</span>(<span id="ast-45">'Starting&nbsp;up&nbsp;ensime&nbsp;server...'</span>)</span></span><span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>client</span>.setup</span>()</span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-51" class="other_trans">client</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-53" class="other_trans">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;is_exit(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'``True``&nbsp;if&nbsp;the&nbsp;process&nbsp;is&nbsp;terminated\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type:&nbsp;:class:`bool`\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>.exit_code</span><span id="ast-10" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-11" class="incorrect_node">STILL_ACTIVE&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;check_token(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">user</span>,&nbsp;<span id="ast-5" class="other_trans">token</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Check&nbsp;that&nbsp;a&nbsp;token&nbsp;is&nbsp;correct&nbsp;for&nbsp;a&nbsp;given&nbsp;user.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-11" class="other_trans">ts_b36</span>,&nbsp;<span id="ast-12" class="other_trans">hash</span>)</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">token</span>.split</span>(<span id="ast-16">'-'</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-18" class="other_trans">ValueError</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-20">False</span></span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ts</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">base36_to_int</span>(<span id="ast-26" class="other_trans">ts_b36</span>)</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-28" class="other_trans">ValueError</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-30">False</span></span></span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34"><span id="ast-35">self</span>._make_token_with_timestamp</span>(<span id="ast-36" class="other_trans">user</span>,&nbsp;<span id="ast-37" class="other_trans">ts</span>)</span><span id="ast-38" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-39" class="incorrect_node">token&nbsp;&rarr;&nbsp;ts&nbsp;</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41">False</span></span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-43">(<span id="ast-44">(<span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>._num_days</span>(<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>._today</span>()</span>)</span>&nbsp;-&nbsp;<span id="ast-52" class="other_trans">ts</span>)</span><span id="ast-53" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-54" class="ref_node">TOKEN_TIMEOUT_DAYS&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>:<span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-56">False</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;run&nbsp;all&nbsp;requested&nbsp;plugins\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>failed_msgs</span>&nbsp;=&nbsp;<span id="ast-8">[]</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-10" class="other_trans">plugin_request</span>&nbsp;in&nbsp;<span id="ast-11"><span id="ast-12">self</span>.plugins_conf</span>:<span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_name</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">plugin_request</span>[<span id="ast-18"><span id="ast-19">'name'</span></span>]</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-21">(<span id="ast-22" class="other_trans">TypeError</span>,&nbsp;<span id="ast-23">KeyError</span>)</span>:<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-28">"invalid&nbsp;plugin&nbsp;request,&nbsp;no&nbsp;key&nbsp;'name':&nbsp;%s"</span>,&nbsp;<span id="ast-29" class="other_trans">plugin_request</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_conf</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">plugin_request</span>.get</span>(<span id="ast-37">'args'</span>,&nbsp;<span id="ast-38">{}</span>)</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-40">AttributeError</span>:<span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-45">"invalid&nbsp;plugin&nbsp;request,&nbsp;no&nbsp;key&nbsp;'args':&nbsp;%s"</span>,&nbsp;<span id="ast-46" class="other_trans">plugin_request</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_class</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53">self</span>.plugin_classes</span>[<span id="ast-54"><span id="ast-55" class="other_trans">plugin_name</span></span>]</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-57" class="other_trans">KeyError</span>:<span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.error</span>(<span id="ast-62">"no&nbsp;such&nbsp;plugin:&nbsp;'%s',&nbsp;did&nbsp;you&nbsp;set&nbsp;the&nbsp;correct&nbsp;plugin&nbsp;type?"</span>,&nbsp;<span id="ast-63" class="other_trans">plugin_name</span>)</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_can_fail</span>&nbsp;=&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">plugin_request</span>[<span id="ast-70"><span id="ast-71">'can_fail'</span></span>]</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-73">(<span id="ast-74" class="other_trans">TypeError</span>,&nbsp;<span id="ast-75">KeyError</span>)</span>:<span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_can_fail</span>&nbsp;=&nbsp;<span id="ast-78"><span id="ast-79">getattr</span>(<span id="ast-80" class="other_trans">plugin_class</span>,&nbsp;<span id="ast-81">'can_fail'</span>,&nbsp;<span id="ast-82">True</span>)</span></span></span></span><span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.debug</span>(<span id="ast-87">"running&nbsp;plugin&nbsp;'%s'"</span>,&nbsp;<span id="ast-88" class="other_trans">plugin_name</span>)</span></span><span id="ast-89"><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_instance</span>&nbsp;=&nbsp;<span id="ast-91"><span id="ast-92"><span id="ast-93">self</span>.create_instance_from_plugin</span>(<span id="ast-94" class="other_trans">plugin_class</span>,&nbsp;<span id="ast-95">plugin_conf</span>)</span></span><span id="ast-96"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_response</span>&nbsp;=&nbsp;<span id="ast-99"><span id="ast-100"><span id="ast-101" class="other_trans">plugin_instance</span>.run</span>()</span></span><span id="ast-102"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-103">Exception</span>&nbsp;as&nbsp;<span id="ast-104" class="other_trans">ex</span>:<span id="ast-105"><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-107">(<span id="ast-108">"plugin&nbsp;'%s'&nbsp;raised&nbsp;an&nbsp;exception:&nbsp;'%s'"</span>&nbsp;%&nbsp;<span id="ast-110">(<span id="ast-111"><span id="ast-112" class="other_trans">plugin_instance</span>.key</span>,&nbsp;<span id="ast-113"><span id="ast-114" class="other_trans">repr</span>(<span id="ast-115" class="other_trans">ex</span>)</span>)</span>)</span></span><span id="ast-116"><span id="ast-117"><span id="ast-118"><span id="ast-119"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warning</span>(<span id="ast-120" class="other_trans">msg</span>)</span></span><span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.debug</span>(<span id="ast-125"><span id="ast-126"><span id="ast-127">traceback</span>.format_exc</span>()</span>)</span></span><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-129">(<span id="ast-130">not</span>&nbsp;<span id="ast-131">plugin_can_fail</span>)</span>:<span id="ast-132"><span id="ast-133"><span id="ast-134"><span id="ast-135" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>failed_msgs</span>.append</span>(<span id="ast-136" class="other_trans">msg</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-137"><span id="ast-138"><span id="ast-139"><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.info</span>(<span id="ast-141">'error&nbsp;is&nbsp;not&nbsp;fatal,&nbsp;continuing...'</span>)</span></span></span><span id="ast-142"><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>plugin_response</span>&nbsp;=&nbsp;<span id="ast-144" class="location_node">msg&nbsp;&rarr;&nbsp;ex,&nbsp;pred:&nbsp;failed_msgs&nbsp;</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;start(<span id="ast-2"><span id="ast-3" class="other_trans">nova_client</span>,&nbsp;<span id="ast-4" class="other_trans">start_retry_interval</span>,&nbsp;<span id="ast-5" class="other_trans">private_key_path</span>,&nbsp;**kwargs</span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>server</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">get_server_by_context</span>(<span id="ast-10" class="other_trans">nova_client</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12"><span id="ast-13">is_external_resource</span>(<span id="ast-14">ctx</span>)</span>:<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ctx</span>.logger</span>.info</span>(<span id="ast-20">'Validating&nbsp;external&nbsp;server&nbsp;is&nbsp;started'</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23"><span id="ast-24" class="other_trans">server</span>.status</span><span id="ast-25" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-26" class="other_trans">SERVER_STATUS_ACTIVE</span>)</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">NonRecoverableError</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32">'Expected&nbsp;external&nbsp;resource&nbsp;server&nbsp;{0}&nbsp;to&nbsp;be&nbsp;in&nbsp;"{1}"&nbsp;status'</span>.format</span>(<span id="ast-33"><span id="ast-34" class="other_trans">server</span>.id</span>,&nbsp;<span id="ast-35">SERVER_STATUS_ACTIVE</span>)</span>)</span></span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40" class="other_trans">server</span>.status</span><span id="ast-41" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-42">SERVER_STATUS_ACTIVE</span>)</span>:<span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46"><span id="ast-47" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ctx</span>.logger</span>.info</span>(<span id="ast-48"><span id="ast-49"><span id="ast-50">'Server&nbsp;is&nbsp;{0}'</span>.format</span>(<span id="ast-51"><span id="ast-52" class="other_trans">server</span>.status</span>)</span>)</span></span><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57">ctx</span>.node</span>.properties</span>[<span id="ast-58"><span id="ast-59">'use_password'</span></span>]</span>:<span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>private_key</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">_get_private_key</span>(<span id="ast-64" class="other_trans">private_key_path</span>)</span></span><span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>password</span>&nbsp;=&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69" class="correct_node">nova_client&nbsp;&rarr;&nbsp;server&nbsp;</span>.get_password</span>(<span id="ast-70" class="other_trans">private_key</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;slideback(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">lease</span>,&nbsp;<span id="ast-5">earliest</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-8">vmrr</span>,&nbsp;<span id="ast-9" class="other_trans">susprr</span>)</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">lease</span>.getLastVMRR</span>()</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>vmrrnew</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">copy</span>.copy</span>(<span id="ast-18">vmrr</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>nodes</span>&nbsp;=&nbsp;<span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24">vmrrnew</span>.nodes</span>.values</span>()</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28" class="other_trans">lease</span>.state</span><span id="ast-29" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-30"><span id="ast-31">constants</span>.LEASE_STATE_SUSPENDED</span>)</span>:<span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resmrr</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36">lease</span>.prevRR</span>(<span id="ast-37" class="ref_node">vmrrnew&nbsp;&rarr;&nbsp;vmrr&nbsp;</span>)</span></span><span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>originalstart</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41">resmrr</span>.start</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resmrr</span>&nbsp;=&nbsp;<span id="ast-44">None</span></span><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>originalstart</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48" class="other_trans">vmrrnew</span>.start</span></span></span><span id="ast-49"><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cp</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53">self</span>.findChangePointsAfter</span>(after=<span id="ast-55">earliest</span>,&nbsp;until=<span id="ast-57" class="other_trans">originalstart</span>,&nbsp;nodes=<span id="ast-59">nodes</span>)</span></span><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cp</span>&nbsp;=&nbsp;<span id="ast-62">(<span id="ast-63">[<span id="ast-64" class="other_trans">earliest</span>]</span>&nbsp;+&nbsp;<span id="ast-66" class="other_trans">cp</span>)</span></span><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>newstart</span>&nbsp;=&nbsp;<span id="ast-69">None</span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-71">p</span>&nbsp;in&nbsp;<span id="ast-72">cp</span>:<span id="ast-73"><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.availabilitywindow</span>.initWindow</span>(<span id="ast-78">p</span>,&nbsp;<span id="ast-79"><span id="ast-80" class="other_trans">lease</span>.resreq</span>,&nbsp;canpreempt=<span id="ast-82">False</span>)</span></span><span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.availabilitywindow</span>.printContents</span>()</span></span><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-89">(<span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93">self</span>.availabilitywindow</span>.fitAtStart</span>(nodes=<span id="ast-95">nodes</span>)</span><span id="ast-96" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-97"><span id="ast-98">lease</span>.numnodes</span>)</span>:<span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-101" class="other_trans">end</span>,&nbsp;<span id="ast-102" class="other_trans">canfit</span>)</span>&nbsp;=&nbsp;<span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106">self</span>.availabilitywindow</span>.findPhysNodesForVMs</span>(<span id="ast-107"><span id="ast-108" class="other_trans">lease</span>.numnodes</span>,&nbsp;<span id="ast-109" class="other_trans">originalstart</span>)</span></span><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-111">(<span id="ast-113">(<span id="ast-114" class="other_trans">end</span><span id="ast-115" class="incorrect_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-116">originalstart</span>)</span>&nbsp;and&nbsp;<span id="ast-117">(<span id="ast-118"><span id="ast-119">set</span>(<span id="ast-120" class="other_trans">nodes</span>)</span><span id="ast-121" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-122"><span id="ast-123">set</span>(<span id="ast-124"><span id="ast-125"><span id="ast-126" class="other_trans">canfit</span>.keys</span>()</span>)</span>)</span>)</span>:<span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>info</span>(<span id="ast-130">(<span id="ast-131">'Can&nbsp;slide&nbsp;back&nbsp;to&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-133">p</span>)</span>,&nbsp;<span id="ast-134"><span id="ast-135">constants</span>.ST</span>,&nbsp;<span id="ast-136"><span id="ast-137"><span id="ast-138">self</span>.rm</span>.time</span>)</span></span><span id="ast-139"><span id="ast-140"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>newstart</span>&nbsp;=&nbsp;<span id="ast-141">p</span></span><span id="ast-142"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-144">(<span id="ast-145">newstart</span><span id="ast-146" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-147" class="other_trans">None</span>)</span>:<span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-149"><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;=&nbsp;<span id="ast-151">(<span id="ast-152">originalstart</span>&nbsp;-&nbsp;<span id="ast-154" class="other_trans">newstart</span>)</span></span><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-156">(<span id="ast-157">resmrr</span><span id="ast-158" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-159" class="other_trans">None</span>)</span>:<span id="ast-160"><span id="ast-161"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resmrrnew</span>&nbsp;=&nbsp;<span id="ast-162"><span id="ast-163"><span id="ast-164">copy</span>.copy</span>(<span id="ast-165">resmrr</span>)</span></span><span id="ast-166"><span id="ast-167"><span id="ast-168" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resmrrnew</span>.start</span>&nbsp;-=&nbsp;<span id="ast-170">diff</span></span><span id="ast-171"><span id="ast-172"><span id="ast-173"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>resmrrnew</span>.end</span>&nbsp;-=&nbsp;<span id="ast-175" class="other_trans">diff</span></span><span id="ast-176"><span id="ast-177"><span id="ast-178"><span id="ast-179"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.updateReservationWithKeyChange</span>(<span id="ast-180" class="other_trans">resmrr</span>,&nbsp;<span id="ast-181">resmrrnew</span>)</span></span></span><span id="ast-182"><span id="ast-183"><span id="ast-184"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vmrrnew</span>.start</span>&nbsp;-=&nbsp;<span id="ast-186">diff</span></span><span id="ast-187"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-188">(<span id="ast-189" class="other_trans">susprr</span><span id="ast-190" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-191" class="other_trans">None</span>)</span>:<span id="ast-192"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-193">(<span id="ast-194">(<span id="ast-195"><span id="ast-196" class="other_trans">vmrrnew</span>.end</span>&nbsp;-&nbsp;<span id="ast-198" class="other_trans">newstart</span>)</span><span id="ast-199" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-200"><span id="ast-201" class="other_trans">lease</span>.remdur</span>)</span>:<span id="ast-202"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-203">(<span id="ast-204">(<span id="ast-205">newstart</span>&nbsp;+&nbsp;<span id="ast-207"><span id="ast-208">lease</span>.realremdur</span>)</span><span id="ast-209" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-210"><span id="ast-211" class="other_trans">vmrrnew</span>.end</span>)</span>:<span id="ast-212"><span id="ast-213"><span id="ast-214" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vmrrnew</span>.realend</span>&nbsp;=&nbsp;<span id="ast-215">(<span id="ast-216" class="other_trans">newstart</span>&nbsp;+&nbsp;<span id="ast-218"><span id="ast-219">lease</span>.realremdur</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-220"><span id="ast-221"><span id="ast-222"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vmrrnew</span>.end</span>&nbsp;-=&nbsp;<span id="ast-224">diff</span></span><span id="ast-225"><span id="ast-226"><span id="ast-227" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vmrrnew</span>.realend</span>&nbsp;-=&nbsp;<span id="ast-229">diff</span></span><span id="ast-230"><span id="ast-231"><span id="ast-232" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vmrrnew</span>.oncomplete</span>&nbsp;=&nbsp;<span id="ast-233"><span id="ast-234">constants</span>.ONCOMPLETE_ENDLEASE</span></span><span id="ast-235"><span id="ast-236"><span id="ast-237"><span id="ast-238"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lease</span>.removeRR</span>(<span id="ast-239" class="other_trans">susprr</span>)</span></span><span id="ast-240"><span id="ast-241"><span id="ast-242"><span id="ast-243"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.removeReservation</span>(<span id="ast-244">susprr</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-245"><span id="ast-246"><span id="ast-247"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vmrrnew</span>.end</span>&nbsp;-=&nbsp;<span id="ast-249" class="other_trans">diff</span></span><span id="ast-250"><span id="ast-251"><span id="ast-252"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vmrrnew</span>.realend</span>&nbsp;-=&nbsp;<span id="ast-254">diff</span></span></span><span id="ast-255"><span id="ast-256"><span id="ast-257"><span id="ast-258"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.updateReservationWithKeyChange</span>(<span id="ast-259">vmrr</span>,&nbsp;<span id="ast-260">vmrrnew</span>)</span></span><span id="ast-261"><span id="ast-262"><span id="ast-263"><span id="ast-264"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.dirty</span>()</span></span><span id="ast-265"><span id="ast-266"><span id="ast-267" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>edebug</span>(<span id="ast-268">'New&nbsp;lease&nbsp;descriptor&nbsp;(after&nbsp;slideback):'</span>,&nbsp;<span id="ast-269"><span id="ast-270">constants</span>.ST</span>,&nbsp;<span id="ast-271"><span id="ast-272"><span id="ast-273">self</span>.rm</span>.time</span>)</span></span><span id="ast-274"><span id="ast-275"><span id="ast-276"><span id="ast-277"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lease</span>.printContents</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>devices</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>._Exploit__info__</span>[<span id="ast-9"><span id="ast-10">'devices'</span></span>]</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-14">(<span id="ast-15"><span id="ast-16">self</span>.device</span><span id="ast-17" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-18">''</span>)</span>&nbsp;or&nbsp;<span id="ast-19">(<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">re</span>.match</span>(<span id="ast-23">'^\\\\d+?$'</span>,&nbsp;<span id="ast-24"><span id="ast-25">self</span>.device</span>)</span><span id="ast-26" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-27" class="other_trans">None</span>)</span>&nbsp;or&nbsp;<span id="ast-28">(<span id="ast-29"><span id="ast-30" class="other_trans">int</span>(<span id="ast-31"><span id="ast-32">self</span>.device</span>)</span><span id="ast-33" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-34">0</span>)</span>&nbsp;or&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37" class="other_trans">int</span>(<span id="ast-38"><span id="ast-39">self</span>.device</span>)</span><span id="ast-40" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-41"><span id="ast-42" class="other_trans">len</span>(<span id="ast-43" class="other_trans">devices</span>)</span>)</span>)</span>:<span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print_error</span>(<span id="ast-47">'Invalid&nbsp;device&nbsp;identifier&nbsp;option'</span>)</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>number</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">devices</span>[<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">int</span>(<span id="ast-57"><span id="ast-58">self</span>.device</span>)</span></span>]</span>[<span id="ast-59"><span id="ast-60">'number'</span></span>]</span></span><span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;=&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65" class="other_trans">devices</span>[<span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans">int</span>(<span id="ast-69"><span id="ast-70">self</span>.device</span>)</span></span>]</span>[<span id="ast-71"><span id="ast-72">'offset'</span></span>]</span></span><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>url</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76" class="other_trans">sanitize_url</span>(<span id="ast-77"><span id="ast-78"><span id="ast-79">'{}:{}'</span>.format</span>(<span id="ast-80"><span id="ast-81">self</span>.target</span>,&nbsp;<span id="ast-82"><span id="ast-83">self</span>.port</span>)</span>)</span></span><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>user_agent</span>&nbsp;=&nbsp;<span id="ast-86">'Mozilla/4.0&nbsp;(compatible;&nbsp;MSIE&nbsp;8.0;&nbsp;Windows&nbsp;NT&nbsp;6.1)'</span></span><span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>headers</span>&nbsp;=&nbsp;<span id="ast-89">{<span id="ast-90">'User-Agent'</span>:&nbsp;<span id="ast-97" class="other_trans">user_agent</span>,&nbsp;<span id="ast-91">'Accept'</span>:&nbsp;<span id="ast-98">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span>,&nbsp;<span id="ast-92">'Accept-language'</span>:&nbsp;<span id="ast-99">'sk,cs;q=0.8,en-US;q=0.5,en;q,0.3'</span>,&nbsp;<span id="ast-93">'Connection'</span>:&nbsp;<span id="ast-100">'keep-alive'</span>,&nbsp;<span id="ast-94">'Accept-Encoding'</span>:&nbsp;<span id="ast-101">'gzip,&nbsp;deflate'</span>,&nbsp;<span id="ast-95">'Cache-Control'</span>:&nbsp;<span id="ast-102">'no-cache'</span>,&nbsp;<span id="ast-96">'Cookie'</span>:&nbsp;<span id="ast-103">(<span id="ast-104">(<span id="ast-105">(<span id="ast-106">(<span id="ast-107">'C'</span>&nbsp;+&nbsp;<span id="ast-109"><span id="ast-110" class="other_trans">str</span>(<span id="ast-111" class="other_trans">number</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-113">'='</span>)</span>&nbsp;+&nbsp;<span id="ast-115">(<span id="ast-116">'B'</span>&nbsp;*&nbsp;<span id="ast-118" class="other_trans">offset</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-120">'\\u0000'</span>)</span>}</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_bytecode_file(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Tests&nbsp;compiled&nbsp;byte-code&nbsp;file'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filepath</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9" class="other_trans">abspath</span>(<span id="ast-10" class="other_trans">__file__</span>)</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pypath</span>&nbsp;=&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18" class="other_trans">os</span>.path</span>.splitext</span>(<span id="ast-19" class="other_trans">filepath</span>)</span>[<span id="ast-20"><span id="ast-21">0</span></span>]</span>&nbsp;+&nbsp;<span id="ast-23">'.py'</span>)</span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pycpath</span>&nbsp;=&nbsp;<span id="ast-26">(<span id="ast-27" class="other_trans">pypath</span>&nbsp;+&nbsp;<span id="ast-29">'c'</span>)</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-32">not</span>&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-37" class="other_trans">pycpath</span>)</span>)</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-39">py_compile</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-41">'Compile'</span>,&nbsp;<span id="ast-42" class="other_trans">pycpath</span></span><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>py_compile</span>.compile</span>(<span id="ast-47" class="other_trans">pypath</span>,&nbsp;<span id="ast-48" class="other_trans">pycpath</span>)</span></span><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assert_</span>(<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-57" class="other_trans">pycpath</span>)</span>)</span></span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>script</span>&nbsp;=&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">PyScript</span>(<span id="ast-62" class="other_trans">pycpath</span>)</span></span><span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertNotNone</span>(<span id="ast-67" class="other_trans">script</span>)</span></span><span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-72" class="location_node">filepath&nbsp;&rarr;&nbsp;pycpath,&nbsp;pred:&nbsp;pypath&nbsp;</span>,&nbsp;<span id="ast-73"><span id="ast-74" class="other_trans">script</span>.filename</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;**kwargs</span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-9" class="other_trans">S3NotebookManager</span>,&nbsp;<span id="ast-10">self</span>)</span>.__init__</span>(**<span id="ast-11" class="incorrect_node">kwargs&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>config</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">kwargs</span>[<span id="ast-18"><span id="ast-19">'parent'</span></span>]</span>.config</span>[<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23">self</span>.__class__</span>.__name__</span></span>]</span></span><span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.s3_base_uri</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">config</span>[<span id="ast-29"><span id="ast-30">'s3_base_uri'</span></span>]</span></span><span id="ast-31"><span id="ast-32"><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.s3_key_delimiter</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">config</span>.get</span>(<span id="ast-37">'s3_key_delimiter'</span>,&nbsp;<span id="ast-38">'/'</span>)</span></span><span id="ast-39"><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-41"><span id="ast-42">self</span>.s3_bucket</span>,&nbsp;<span id="ast-43"><span id="ast-44">self</span>.s3_prefix</span>)</span>&nbsp;=&nbsp;<span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>._parse_s3_uri</span>(<span id="ast-48"><span id="ast-49">self</span>.s3_base_uri</span>,&nbsp;<span id="ast-50"><span id="ast-51">self</span>.s3_key_delimiter</span>)</span></span><span id="ast-52"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-53">(<span id="ast-54">not</span>&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58">self</span>.s3_prefix</span>.endswith</span>(<span id="ast-59"><span id="ast-60">self</span>.s3_key_delimiter</span>)</span>)</span>:<span id="ast-61"><span id="ast-62"><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.s3_prefix</span>&nbsp;+=&nbsp;<span id="ast-65" class="ref_node">s3_key_delimiter&nbsp;&rarr;&nbsp;self.&nbsp;</span></span></span><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.s3_connection</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71" class="other_trans">boto</span>.connect_s3</span>()</span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.bucket</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78">self</span>.s3_connection</span>.get_bucket</span>(<span id="ast-79"><span id="ast-80">self</span>.s3_bucket</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;prepare(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;**kwargs</span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-5"><span id="ast-6">self</span>.url</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>html</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">get_content</span>(<span id="ast-11"><span id="ast-12">self</span>.url</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>video_type</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16">match1</span>(<span id="ast-17" class="other_trans">html</span>,&nbsp;<span id="ast-18">'VideoType":"([^"]+)"'</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">video_type</span><span id="ast-22" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-23">'LIVE'</span>)</span>:<span id="ast-24"><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.live</span>&nbsp;=&nbsp;<span id="ast-27">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-29">(<span id="ast-30">not</span>&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">video_type</span><span id="ast-33" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-34">'VOD'</span>)</span>)</span>:<span id="ast-35"><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>NotImplementedError</span>(<span id="ast-38">'Unknown_video_type'</span>)</span></span></span><span id="ast-39"><span id="ast-40"><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.title</span>&nbsp;=&nbsp;<span id="ast-42"><span id="ast-43">match1</span>(<span id="ast-44" class="other_trans">html</span>,&nbsp;<span id="ast-45">'&lt;title&gt;([^&lt;]+)'</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47"><span id="ast-48">self</span>.live</span>:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rtmp_id</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54">match1</span>(<span id="ast-55" class="other_trans">html</span>,&nbsp;<span id="ast-56">'videoId":"([^"]+)"'</span>)</span>.replace</span>(<span id="ast-57">'\\\\/'</span>,&nbsp;<span id="ast-58">'/'</span>)</span></span><span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>request_url</span>&nbsp;=&nbsp;<span id="ast-61">(<span id="ast-62">(<span id="ast-63">(<span id="ast-64"><span id="ast-65">self</span>.live_base</span>&nbsp;+&nbsp;<span id="ast-67">'/'</span>)</span>&nbsp;+&nbsp;<span id="ast-69" class="other_trans">rtmp_id</span>)</span>&nbsp;+&nbsp;<span id="ast-71">'.flv?get_url=1'</span>)</span></span><span id="ast-72"><span id="ast-73"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>real_url</span>&nbsp;=&nbsp;<span id="ast-74">[<span id="ast-75"><span id="ast-76">get_html</span>(<span id="ast-77">request_url</span>)</span>]</span></span><span id="ast-78"><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stream_types</span>.append</span>(<span id="ast-83">'current'</span>)</span></span><span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.streams</span>[<span id="ast-88"><span id="ast-89">'current'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-90">{<span id="ast-91">'container'</span>:&nbsp;<span id="ast-95">'flv'</span>,&nbsp;<span id="ast-92">'video_profile'</span>:&nbsp;<span id="ast-96">'current'</span>,&nbsp;<span id="ast-93">'src'</span>:&nbsp;<span id="ast-97" class="other_trans">real_url</span>,&nbsp;<span id="ast-94">'size'</span>:&nbsp;<span id="ast-98"><span id="ast-99" class="other_trans">float</span>(<span id="ast-100">'inf'</span>)</span>}</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-101"><span id="ast-102" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vod_m3u8_request</span>&nbsp;=&nbsp;<span id="ast-103">(<span id="ast-104"><span id="ast-105">self</span>.vod_base</span>&nbsp;+&nbsp;<span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110">match1</span>(<span id="ast-111" class="other_trans">html</span>,&nbsp;<span id="ast-112">'VideoID":"([^"]+)'</span>)</span>.replace</span>(<span id="ast-113">'\\\\/'</span>,&nbsp;<span id="ast-114">'/'</span>)</span>)</span></span><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>vod_m3u8</span>&nbsp;=&nbsp;<span id="ast-117"><span id="ast-118" class="other_trans">get_html</span>(<span id="ast-119" class="other_trans">vod_m3u8_request</span>)</span></span><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>part_url</span>&nbsp;=&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans">re</span>.findall</span>(<span id="ast-125">'(/[^#]+)\\\\.ts'</span>,&nbsp;<span id="ast-126">vod_m3u8</span>)</span></span><span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>real_url</span>&nbsp;=&nbsp;<span id="ast-129">[]</span></span><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-131">i</span>&nbsp;in&nbsp;<span id="ast-132" class="other_trans">part_url</span>:<span id="ast-133"><span id="ast-134" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-135">(<span id="ast-136">(<span id="ast-137" class="ref_node">vod_base&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;+&nbsp;<span id="ast-139" class="other_trans">i</span>)</span>&nbsp;+&nbsp;<span id="ast-141">'.ts'</span>)</span></span><span id="ast-142"><span id="ast-143"><span id="ast-144"><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>real_url</span>.append</span>(<span id="ast-146" class="other_trans">i</span>)</span></span></span><span id="ast-147"><span id="ast-148"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>type_</span>&nbsp;=&nbsp;<span id="ast-149">''</span></span><span id="ast-150"><span id="ast-151"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;=&nbsp;<span id="ast-152">0</span></span><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-154">url</span>&nbsp;in&nbsp;<span id="ast-155" class="incorrect_node">real_url&nbsp;&rarr;&nbsp;part_url&nbsp;</span>:<span id="ast-156"><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-158">_</span>,&nbsp;<span id="ast-159" class="other_trans">type_</span>,&nbsp;<span id="ast-160">temp</span>)</span>&nbsp;=&nbsp;<span id="ast-161"><span id="ast-162" class="other_trans">url_info</span>(<span id="ast-163" class="other_trans">url</span>)</span></span><span id="ast-164"><span id="ast-165" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;+=&nbsp;<span id="ast-167">(<span id="ast-169" class="other_trans">temp</span>&nbsp;or&nbsp;<span id="ast-170">0</span>)</span></span></span><span id="ast-171"><span id="ast-172"><span id="ast-173"><span id="ast-174"><span id="ast-175"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.stream_types</span>.append</span>(<span id="ast-176">'current'</span>)</span></span><span id="ast-177"><span id="ast-178"><span id="ast-179"><span id="ast-180"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.streams</span>[<span id="ast-181"><span id="ast-182">'current'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-183">{<span id="ast-184">'container'</span>:&nbsp;<span id="ast-188">'flv'</span>,&nbsp;<span id="ast-185">'video_profile'</span>:&nbsp;<span id="ast-189">'current'</span>,&nbsp;<span id="ast-186">'src'</span>:&nbsp;<span id="ast-190">real_url</span>,&nbsp;<span id="ast-187">'size'</span>:&nbsp;<span id="ast-191" class="other_trans">size</span>}</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;appleSoftwareUpdatesAvailable(<span id="ast-2"><span id="ast-3">forcecheck</span>,&nbsp;<span id="ast-5" class="other_trans">suppresscheck</span></span>):<span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Checks&nbsp;for&nbsp;available&nbsp;Apple&nbsp;Software&nbsp;Updates,&nbsp;trying&nbsp;not&nbsp;to&nbsp;hit&nbsp;the&nbsp;SUS\\u000a&nbsp;&nbsp;&nbsp;&nbsp;more&nbsp;than&nbsp;needed'</span></span><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>updatesindexfile</span>&nbsp;=&nbsp;<span id="ast-11">'/Library/Updates/index.plist'</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">os</span>.path</span>.exists</span>(<span id="ast-19">appleUpdatesFile</span>)</span>&nbsp;and&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23">os</span>.path</span>.exists</span>(<span id="ast-24" class="other_trans">updatesindexfile</span>)</span>)</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>appleUpdatesFile_modtime</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">os</span>.stat</span>(<span id="ast-31" class="other_trans">appleUpdatesFile</span>)</span>.st_mtime</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>updatesindexfile_modtime</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">os</span>.stat</span>(<span id="ast-38" class="other_trans">updatesindexfile</span>)</span>.st_mtime</span></span><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">appleUpdatesFile_modtime</span><span id="ast-42" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-43" class="other_trans">updatesindexfile_modtime</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-45">True</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-47"><span id="ast-48">writeAppleUpdatesFile</span>()</span></span></span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-50" class="other_trans">forcecheck</span>:<span id="ast-51"><span id="ast-52" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>retcode</span>&nbsp;=&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">checkForSoftwareUpdates</span>()</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-56" class="other_trans">suppresscheck</span>:<span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-58">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-59"><span id="ast-60" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>now</span>&nbsp;=&nbsp;<span id="ast-61"><span id="ast-62"><span id="ast-63">NSDate</span>.new</span>()</span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nextSUcheck</span>&nbsp;=&nbsp;<span id="ast-66">now</span></span><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cmd</span>&nbsp;=&nbsp;<span id="ast-69">[<span id="ast-70">'/usr/bin/defaults'</span>,&nbsp;<span id="ast-71">'read'</span>,&nbsp;<span id="ast-72">'/Library/Preferences/com.apple.softwareupdate'</span>,&nbsp;<span id="ast-73">'LastSuccessfulDate'</span>]</span></span><span id="ast-74"><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p</span>&nbsp;=&nbsp;<span id="ast-76"><span id="ast-77"><span id="ast-78">subprocess</span>.Popen</span>(<span id="ast-79" class="other_trans">cmd</span>,&nbsp;shell=<span id="ast-81">False</span>,&nbsp;bufsize=<span id="ast-83">1</span>,&nbsp;stdin=<span id="ast-85"><span id="ast-86">subprocess</span>.PIPE</span>,&nbsp;stdout=<span id="ast-88"><span id="ast-89">subprocess</span>.PIPE</span>,&nbsp;stderr=<span id="ast-91"><span id="ast-92" class="other_trans">subprocess</span>.PIPE</span>)</span></span><span id="ast-93"><span id="ast-94"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-95">out</span>,&nbsp;<span id="ast-96">err</span>)</span>&nbsp;=&nbsp;<span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans">p</span>.communicate</span>()</span></span><span id="ast-100"><span id="ast-101" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lastSUcheckString</span>&nbsp;=&nbsp;<span id="ast-102"><span id="ast-103"><span id="ast-104" class="other_trans">out</span>.rstrip</span>(<span id="ast-105">'\\u000a'</span>)</span></span><span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-107" class="other_trans">lastSUcheckString</span>:<span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lastSUcheck</span>&nbsp;=&nbsp;<span id="ast-111"><span id="ast-112"><span id="ast-113" class="other_trans">NSDate</span>.dateWithString_</span>(<span id="ast-114" class="other_trans">lastSUcheckString</span>)</span></span><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>interval</span>&nbsp;=&nbsp;<span id="ast-117">(<span id="ast-118">(<span id="ast-119">24</span>&nbsp;*&nbsp;<span id="ast-121">60</span>)</span>&nbsp;*&nbsp;<span id="ast-123">60</span>)</span></span><span id="ast-124"><span id="ast-125" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nextSUcheck</span>&nbsp;=&nbsp;<span id="ast-126"><span id="ast-127"><span id="ast-128">lastSUcheck</span>.dateByAddingTimeInterval_</span>(<span id="ast-129" class="other_trans">interval</span>)</span></span><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-131">ValueError</span>:<span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span></span><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-134">(<span id="ast-135"><span id="ast-136"><span id="ast-137" class="other_trans">now</span>.timeIntervalSinceDate_</span>(<span id="ast-138">nextSUcheck</span>)</span><span id="ast-139" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-140">0</span>)</span>:<span id="ast-141"><span id="ast-142" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>retcode</span>&nbsp;=&nbsp;<span id="ast-143"><span id="ast-144">checkForSoftwareUpdates</span>()</span></span></span></span><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-146"><span id="ast-147">writeAppleUpdatesFile</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">section</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>execute</span>(<span id="ast-11">'firewall.update_files'</span>,&nbsp;section=<span id="ast-13" class="other_trans">section</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15" class="other_trans">section</span>:<span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sections</span>&nbsp;=&nbsp;<span id="ast-18">[<span id="ast-19" class="other_trans">section</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-20"><span id="ast-21" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sections</span>&nbsp;=&nbsp;<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans">env</span>.config_object</span>.sections</span>()</span></span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>task</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">functions</span>.get_task_instance</span>(<span id="ast-31">'firewall.update_files'</span>)</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-33" class="other_trans">s</span>&nbsp;in&nbsp;<span id="ast-34" class="other_trans">sections</span>:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-37"><span id="ast-38"><span id="ast-39" class="other_trans">task</span>.get_section_path</span>(<span id="ast-40" class="other_trans">s</span>)</span></span><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>execute</span>(<span id="ast-44">'firewall.sync_single'</span>,&nbsp;filename=<span id="ast-46" class="other_trans">filename</span>,&nbsp;hosts=<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">env</span>.config_object</span>.get_list</span>(<span id="ast-52" class="correct_node">section&nbsp;&rarr;&nbsp;s&nbsp;</span>,&nbsp;<span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">env</span>.config_object</span>.CONNECTIONS</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;scan(<span id="ast-2"><span id="ast-3" class="other_trans">tokens</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_start_idx</span>&nbsp;=&nbsp;<span id="ast-6">None</span></span><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_started</span>&nbsp;=&nbsp;<span id="ast-9">None</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>prev_was_escape</span>&nbsp;=&nbsp;<span id="ast-12">False</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lexeme</span>&nbsp;=&nbsp;<span id="ast-15">[]</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-18">0</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">i</span><span id="ast-22" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-23"><span id="ast-24">len</span>(<span id="ast-25">tokens</span>)</span>)</span>:<span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>token</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">tokens</span>[<span id="ast-30"><span id="ast-31" class="other_trans">i</span></span>]</span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">literal_start_idx</span>:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35" class="other_trans">prev_was_escape</span>:<span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>prev_was_escape</span>&nbsp;=&nbsp;<span id="ast-38">False</span></span><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lexeme</span>.append</span>(<span id="ast-43">token</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-45">(<span id="ast-46" class="other_trans">token</span><span id="ast-47" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-48" class="other_trans">literal_started</span>)</span>:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-50">(<span id="ast-52">(<span id="ast-53" class="other_trans">literal_started</span><span id="ast-54" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-55">"'"</span>)</span>&nbsp;and&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58">len</span>(<span id="ast-59" class="other_trans">tokens</span>)</span><span id="ast-60" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-61">(<span id="ast-62">i</span>&nbsp;+&nbsp;<span id="ast-64">1</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-65">(<span id="ast-66"><span id="ast-67" class="other_trans">tokens</span>[<span id="ast-68"><span id="ast-69">(<span id="ast-70" class="other_trans">i</span>&nbsp;+&nbsp;<span id="ast-72">1</span>)</span></span>]</span><span id="ast-73" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-74">"'"</span>)</span>)</span>:<span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-78">1</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lexeme</span>.append</span>(<span id="ast-83">"'"</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>yield&nbsp;<span id="ast-86">(<span id="ast-87" class="other_trans">i</span>,&nbsp;<span id="ast-88"><span id="ast-89" class="other_trans">Literal</span>(<span id="ast-90" class="incorrect_node">literal_started&nbsp;&rarr;&nbsp;token&nbsp;</span>,&nbsp;<span id="ast-91"><span id="ast-92"><span id="ast-93">''</span>.join</span>(<span id="ast-94" class="other_trans">lexeme</span>)</span>)</span>)</span></span></span><span id="ast-95"><span id="ast-96" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_start_idx</span>&nbsp;=&nbsp;<span id="ast-97">None</span></span><span id="ast-98"><span id="ast-99" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_started</span>&nbsp;=&nbsp;<span id="ast-100">None</span></span><span id="ast-101"><span id="ast-102" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lexeme</span>&nbsp;=&nbsp;<span id="ast-103">[]</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-105">(<span id="ast-106" class="other_trans">token</span><span id="ast-107" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-108">'\\\\'</span>)</span>:<span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>prev_was_escape</span>&nbsp;=&nbsp;<span id="ast-111" class="other_trans">token</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-112"><span id="ast-113" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>prev_was_escape</span>&nbsp;=&nbsp;<span id="ast-114">False</span></span><span id="ast-115"><span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>lexeme</span>.append</span>(<span id="ast-119">token</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-121">(<span id="ast-122">literal_start_idx</span><span id="ast-123" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-124" class="other_trans">None</span>)</span>:<span id="ast-125"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-126">(<span id="ast-127">token</span><span id="ast-128">&nbsp;in&nbsp;</span><span id="ast-129">[<span id="ast-130">"'"</span>,&nbsp;<span id="ast-131">'"'</span>,&nbsp;<span id="ast-132">'`'</span>]</span>)</span>:<span id="ast-133"><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_start_idx</span>&nbsp;=&nbsp;<span id="ast-135">i</span></span><span id="ast-136"><span id="ast-137" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>literal_started</span>&nbsp;=&nbsp;<span id="ast-138" class="other_trans">token</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-140">(<span id="ast-141" class="other_trans">token</span><span id="ast-142" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-143">'$'</span>)</span>:<span id="ast-144"><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>skipped_token</span>&nbsp;=&nbsp;<span id="ast-146"><span id="ast-147">skip_to</span>(<span id="ast-148">(<span id="ast-149">i</span>&nbsp;+&nbsp;<span id="ast-151">1</span>)</span>,&nbsp;<span id="ast-152">tokens</span>,&nbsp;<span id="ast-153">'$'</span>)</span></span><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-155">(<span id="ast-156">skipped_token</span><span id="ast-157" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-158" class="other_trans">None</span>)</span>:<span id="ast-159"><span id="ast-160" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dollar_token</span>&nbsp;=&nbsp;<span id="ast-161">(<span id="ast-162">[<span id="ast-163">'$'</span>]</span>&nbsp;+&nbsp;<span id="ast-165">skipped_token</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">world_folder</span>,&nbsp;<span id="ast-4" class="other_trans">start</span>,&nbsp;<span id="ast-6" class="other_trans">stop</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-9">(<span id="ast-10">not</span>&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13"><span id="ast-14" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-15" class="other_trans">world_folder</span>)</span>)</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-17">(<span id="ast-18">'No&nbsp;such&nbsp;folder&nbsp;as&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-20" class="correct_node">filename&nbsp;&rarr;&nbsp;world_folder&nbsp;</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-22">2</span></span></span><span id="ast-23"><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>regions</span>&nbsp;=&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">glob</span>.glob</span>(<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-32" class="other_trans">world_folder</span>,&nbsp;<span id="ast-33">'region'</span>,&nbsp;<span id="ast-34">'*.mcr'</span>)</span>)</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>block_data_totals</span>&nbsp;=&nbsp;<span id="ast-37">[<span id="ast-38">(<span id="ast-39">[<span id="ast-40">0</span>]</span>&nbsp;*&nbsp;<span id="ast-42">16</span>)</span><span id="ast-43">&nbsp;for&nbsp;<span id="ast-44" class="other_trans">i</span>&nbsp;in&nbsp;<span id="ast-45"><span id="ast-46" class="other_trans">range</span>(<span id="ast-47">256</span>)</span></span>]</span></span><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-50" class="other_trans">filename</span>&nbsp;in&nbsp;<span id="ast-51" class="other_trans">regions</span>:<span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>region_totals</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55">process_region_file</span>(<span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59">os</span>.path</span>.join</span>(<span id="ast-60" class="other_trans">world_folder</span>,&nbsp;<span id="ast-61">'region'</span>,&nbsp;<span id="ast-62" class="other_trans">filename</span>)</span>,&nbsp;<span id="ast-63" class="other_trans">start</span>,&nbsp;<span id="ast-64" class="other_trans">stop</span>)</span></span><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-66">(<span id="ast-67" class="other_trans">i</span>,&nbsp;<span id="ast-68" class="other_trans">data</span>)</span>&nbsp;in&nbsp;<span id="ast-69"><span id="ast-70">enumerate</span>(<span id="ast-71">region_totals</span>)</span>:<span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-73">(<span id="ast-74">j</span>,&nbsp;<span id="ast-75" class="other_trans">total</span>)</span>&nbsp;in&nbsp;<span id="ast-76"><span id="ast-77">enumerate</span>(<span id="ast-78">data</span>)</span>:<span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>block_data_totals</span>[<span id="ast-83"><span id="ast-84" class="other_trans">i</span></span>]</span>[<span id="ast-85"><span id="ast-86" class="other_trans">j</span></span>]</span>&nbsp;+=&nbsp;<span id="ast-88" class="other_trans">total</span></span></span></span></span><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-90">KeyboardInterrupt</span>:<span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print_results</span>(<span id="ast-94">block_data_totals</span>)</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-96">75</span></span></span></span><span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print_results</span>(<span id="ast-100" class="other_trans">block_data_totals</span>)</span></span><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-102">0</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;clean_source(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6">'download'</span><span id="ast-7">&nbsp;in&nbsp;</span><span id="ast-8"><span id="ast-9">self</span>.__configuration</span>)</span>:<span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>source</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="incorrect_node">Download&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-14"><span id="ast-15"><span id="ast-16">self</span>.__configuration</span>[<span id="ast-17"><span id="ast-18">'download'</span></span>]</span>,&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.__configuration</span>[<span id="ast-22"><span id="ast-23">'checksum'</span></span>]</span>,&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26">self</span>.source_directory</span>()</span>,&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-31"><span id="ast-32"><span id="ast-33">self</span>.directory</span>()</span>,&nbsp;<span id="ast-34">'download'</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-36">(<span id="ast-37">'repository'</span><span id="ast-38">&nbsp;in&nbsp;</span><span id="ast-39"><span id="ast-40">self</span>.__configuration</span>)</span>:<span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>source</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">GitRepository</span>(<span id="ast-45"><span id="ast-46"><span id="ast-47">self</span>.__configuration</span>[<span id="ast-48"><span id="ast-49">'repository'</span></span>]</span>,&nbsp;<span id="ast-50"><span id="ast-51"><span id="ast-52">self</span>.__configuration</span>[<span id="ast-53"><span id="ast-54">'commit'</span></span>]</span>,&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57">self</span>.source_directory</span>()</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-59">(<span id="ast-60">'directory'</span><span id="ast-61">&nbsp;in&nbsp;</span><span id="ast-62"><span id="ast-63">self</span>.__configuration</span>)</span>:<span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>source</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67" class="other_trans">Directory</span>(<span id="ast-68"><span id="ast-78"><span id="ast-79"><span id="ast-80">self</span>.__configuration</span>[<span id="ast-81"><span id="ast-82">'directory'</span></span>]</span>&nbsp;if&nbsp;<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">os</span>.path</span>.isabs</span>(<span id="ast-73"><span id="ast-74"><span id="ast-75">self</span>.__configuration</span>[<span id="ast-76"><span id="ast-77">'directory'</span></span>]</span>)</span>&nbsp;else&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-87"><span id="ast-88"><span id="ast-89" class="ref_node">needy&nbsp;&rarr;&nbsp;self.&nbsp;</span>.path</span>()</span>,&nbsp;<span id="ast-90"><span id="ast-91"><span id="ast-92">self</span>.__configuration</span>[<span id="ast-93"><span id="ast-94">'directory'</span></span>]</span>)</span></span>,&nbsp;<span id="ast-95"><span id="ast-96"><span id="ast-97">self</span>.source_directory</span>()</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-99"><span id="ast-100" class="other_trans">ValueError</span>(<span id="ast-101">'no&nbsp;source&nbsp;specified&nbsp;in&nbsp;configuration'</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;getUUID(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-5">(<span id="ast-6"><span id="ast-7"><span id="ast-8" class="other_trans">r9Setup</span>.mayaVersion</span>()</span><span id="ast-9" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-10">2016</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">cmds</span>.ls</span>(<span id="ast-16"><span id="ast-17">self</span>.mNode</span>,&nbsp;uuid=<span id="ast-19">True</span>)</span>[<span id="ast-20"><span id="ast-21">0</span></span>]</span></span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-23"><span id="ast-24">self</span>.UUID</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;run(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">handler</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-6" class="other_trans">sa</span>&nbsp;in&nbsp;<span id="ast-7" class="correct_node">adapters&nbsp;&rarr;&nbsp;self.&nbsp;</span>:<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">sa</span>(<span id="ast-14"><span id="ast-15">self</span>.host</span>,&nbsp;<span id="ast-16"><span id="ast-17">self</span>.port</span>,&nbsp;**<span id="ast-18"><span id="ast-19">self</span>.options</span>)</span>.run</span>()</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-21" class="other_trans">ImportError</span>:<span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">world_folder</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-10" class="other_trans">world_folder</span>,&nbsp;<span id="ast-11">'level.dat'</span>)</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>level</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">NBTFile</span>(<span id="ast-16" class="other_trans">filename</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">level</span>[<span id="ast-21"><span id="ast-22">'Data'</span></span>]</span>[<span id="ast-23"><span id="ast-24">'RandomSeed'</span></span>]</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-26">0</span></span></span><span id="ast-27"><span class="whitespace"><br />
</span>if&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">__name__</span><span id="ast-30" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-31">'__main__'</span>)</span>:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34"><span id="ast-35" class="other_trans">len</span>(<span id="ast-36"><span id="ast-37" class="other_trans">sys</span>.argv</span>)</span><span id="ast-38" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-39">1</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-41">'No&nbsp;world&nbsp;folder&nbsp;specified!'</span></span><span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-46">64</span>)</span></span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>world_folder</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans">sys</span>.argv</span>[<span id="ast-52"><span id="ast-53">1</span></span>]</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56">not</span>&nbsp;<span id="ast-57"><span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-61" class="incorrect_node">world_folder&nbsp;&rarr;&nbsp;filename&nbsp;</span>)</span>)</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-63">(<span id="ast-64">'No&nbsp;such&nbsp;folder&nbsp;as&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-66" class="ref_node">filename&nbsp;&rarr;&nbsp;world_folder&nbsp;</span>)</span></span><span id="ast-67"><span id="ast-68"><span id="ast-69"><span id="ast-70" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-71">72</span>)</span></span></span><span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sys</span>.exit</span>(<span id="ast-76"><span id="ast-77" class="other_trans">main</span>(<span id="ast-78" class="other_trans">world_folder</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>args</span>&nbsp;=&nbsp;<span id="ast-5"><span id="ast-6" class="other_trans">get_args</span>()</span></span><span id="ast-7"><span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>uces</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10" class="other_trans">set</span>(<span id="ast-11">[<span id="ast-12"><span id="ast-13" class="other_trans">get_name</span>(<span id="ast-14"><span id="ast-15" class="other_trans">read</span>.identifier</span>,&nbsp;<span id="ast-16">'|'</span>,&nbsp;<span id="ast-17">1</span>)</span><span id="ast-18">&nbsp;for&nbsp;<span id="ast-19" class="other_trans">read</span>&nbsp;in&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">fasta</span>.FastaReader</span>(<span id="ast-23"><span id="ast-24" class="other_trans">args</span>.query</span>)</span></span>]</span>)</span></span><span id="ast-25"><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>files</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29">glob</span>.glob</span>(<span id="ast-30"><span id="ast-31"><span id="ast-32"><span id="ast-33">os</span>.path</span>.join</span>(<span id="ast-34"><span id="ast-35">args</span>.lastz</span>,&nbsp;<span id="ast-36">'*.lastz'</span>)</span>)</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>organisms</span>&nbsp;=&nbsp;<span id="ast-39">[<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46">os</span>.path</span>.splitext</span>(<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53">os</span>.path</span>.basename</span>(<span id="ast-54">f</span>)</span>.split</span>(<span id="ast-55">'-'</span>)</span>[<span id="ast-56"><span id="ast-57">-1</span></span>]</span>)</span>[<span id="ast-58"><span id="ast-59">0</span></span>]</span>.replace</span>(<span id="ast-60">'-'</span>,&nbsp;<span id="ast-61">'_'</span>)</span><span id="ast-62">&nbsp;for&nbsp;<span id="ast-63" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-64">files</span></span>]</span></span><span id="ast-65"><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-67">conn</span>,&nbsp;<span id="ast-68" class="other_trans">c</span>)</span>&nbsp;=&nbsp;<span id="ast-69"><span id="ast-70">create_match_database</span>(<span id="ast-71"><span id="ast-72">args</span>.db</span>,&nbsp;<span id="ast-73" class="other_trans">organisms</span>,&nbsp;<span id="ast-74" class="other_trans">uces</span>)</span></span><span id="ast-75"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-76"><span id="ast-77">args</span>.dupefile</span>:<span id="ast-78"><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dupes</span>&nbsp;=&nbsp;<span id="ast-80"><span id="ast-81">get_dupes</span>(<span id="ast-82"><span id="ast-83">args</span>.dupefile</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-84"><span id="ast-85"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dupes</span>&nbsp;=&nbsp;<span id="ast-86">None</span></span></span><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-88">f</span>&nbsp;in&nbsp;<span id="ast-89">files</span>:<span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>critter</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96">os</span>.path</span>.splitext</span>(<span id="ast-97"><span id="ast-98"><span id="ast-99"><span id="ast-100"><span id="ast-101"><span id="ast-102"><span id="ast-103" class="other_trans">os</span>.path</span>.basename</span>(<span id="ast-104">f</span>)</span>.split</span>(<span id="ast-105">'-'</span>)</span>[<span id="ast-106"><span id="ast-107">-1</span></span>]</span>)</span>[<span id="ast-108"><span id="ast-109">0</span></span>]</span></span><span id="ast-110"><span id="ast-111"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-112">matches</span>,&nbsp;<span id="ast-113">probes</span>)</span>&nbsp;=&nbsp;<span id="ast-114"><span id="ast-115">get_matches</span>(<span id="ast-116">f</span>,&nbsp;<span id="ast-117"><span id="ast-118">args</span>.splitchar</span>,&nbsp;<span id="ast-119"><span id="ast-120" class="other_trans">args</span>.components</span>)</span></span><span id="ast-121"><span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;=&nbsp;<span id="ast-123">0</span></span><span id="ast-124"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-125">(<span id="ast-126">k</span>,&nbsp;<span id="ast-127">v</span>)</span>&nbsp;in&nbsp;<span id="ast-128"><span id="ast-129"><span id="ast-130" class="other_trans">matches</span>.iteritems</span>()</span>:<span id="ast-131"><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>skip</span>&nbsp;=&nbsp;<span id="ast-133">False</span></span><span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-135">(<span id="ast-136"><span id="ast-137" class="other_trans">len</span>(<span id="ast-138">v</span>)</span><span id="ast-139" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-140">1</span>)</span>:<span id="ast-141"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-142"><span id="ast-143">run_checks</span>(<span id="ast-144" class="incorrect_node">k&nbsp;&rarr;&nbsp;f&nbsp;</span>,&nbsp;<span id="ast-145" class="other_trans">v</span>,&nbsp;<span id="ast-146">probes</span>,&nbsp;<span id="ast-147"><span id="ast-148">args</span>.verbose</span>)</span>:<span id="ast-149"><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>v_sort</span>&nbsp;=&nbsp;<span id="ast-151"><span id="ast-152">sorted</span>(<span id="ast-153" class="other_trans">v</span>,&nbsp;key=<span id="ast-155"><span id="ast-156">itemgetter</span>(<span id="ast-157">2</span>)</span>)</span></span><span id="ast-158"><span id="ast-159"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-160">start</span>,&nbsp;<span id="ast-161" class="other_trans">end</span>)</span>&nbsp;=&nbsp;<span id="ast-162">(<span id="ast-163"><span id="ast-164"><span id="ast-165" class="other_trans">v_sort</span>[<span id="ast-166"><span id="ast-167">0</span></span>]</span>[<span id="ast-168"><span id="ast-169">2</span></span>]</span>,&nbsp;<span id="ast-170"><span id="ast-171"><span id="ast-172" class="other_trans">v_sort</span>[<span id="ast-173"><span id="ast-174">-1</span></span>]</span>[<span id="ast-175"><span id="ast-176">3</span></span>]</span>)</span></span><span id="ast-177"><span id="ast-178" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;=&nbsp;<span id="ast-179">(<span id="ast-180" class="other_trans">end</span>&nbsp;-&nbsp;<span id="ast-182" class="other_trans">start</span>)</span></span><span id="ast-183"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-184">(<span id="ast-185" class="other_trans">diff</span><span id="ast-186" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-187">(<span id="ast-188"><span id="ast-189">probes</span>[<span id="ast-190"><span id="ast-191">k</span></span>]</span>&nbsp;*&nbsp;<span id="ast-193">120</span>)</span>)</span>:<span id="ast-194"><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>skip</span>&nbsp;=&nbsp;<span id="ast-196">True</span></span><span id="ast-197"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-198"><span id="ast-199">args</span>.verbose</span>:<span id="ast-200"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-201">'range&nbsp;longer&nbsp;than&nbsp;expected'</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-202"><span id="ast-203" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>skip</span>&nbsp;=&nbsp;<span id="ast-204">True</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-206">(<span id="ast-208"><span id="ast-209">args</span>.dupefile</span>&nbsp;and&nbsp;<span id="ast-210">(<span id="ast-211" class="other_trans">k</span><span id="ast-212">&nbsp;in&nbsp;</span><span id="ast-213">dupes</span>)</span>)</span>:<span id="ast-214"><span id="ast-215"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>skip</span>&nbsp;=&nbsp;<span id="ast-216">True</span></span><span id="ast-217"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-218"><span id="ast-219">args</span>.verbose</span>:<span id="ast-220"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-221"><span id="ast-222"><span id="ast-223">'{0}&nbsp;is&nbsp;in&nbsp;dupefile'</span>.format</span>(<span id="ast-224">k</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-225"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>pass</span></span><span id="ast-226"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-227">(<span id="ast-228">not</span>&nbsp;<span id="ast-229">skip</span>)</span>:<span id="ast-230"><span id="ast-231"><span id="ast-232"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>store_lastz_results_in_db</span>(<span id="ast-233">c</span>,&nbsp;<span id="ast-234" class="other_trans">critter</span>,&nbsp;<span id="ast-235" class="other_trans">k</span>)</span></span><span id="ast-236"><span id="ast-237" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>count</span>&nbsp;+=&nbsp;<span id="ast-239">1</span></span></span></span><span id="ast-240"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-241"><span id="ast-242"><span id="ast-243">'Entered&nbsp;{}&nbsp;matches&nbsp;for&nbsp;{}'</span>.format</span>(<span id="ast-244" class="other_trans">count</span>,&nbsp;<span id="ast-245">critter</span>)</span></span></span><span id="ast-246"><span id="ast-247"><span id="ast-248"><span id="ast-249"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>conn</span>.commit</span>()</span></span><span id="ast-250"><span id="ast-251"><span id="ast-252"><span id="ast-253" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>c</span>.close</span>()</span></span><span id="ast-254"><span id="ast-255"><span id="ast-256"><span id="ast-257"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>conn</span>.close</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;tag(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">tag</span>,&nbsp;<span id="ast-5">child</span>,&nbsp;<span id="ast-7">enclose</span>,&nbsp;<span id="ast-9">newline</span>,&nbsp;**kwargs</span>):<span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;enclose:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;=&gt;&nbsp;&lt;tag&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;=&gt;&nbsp;&lt;tag/&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;=&gt;&nbsp;&lt;tag&gt;&lt;/tag&gt;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">kwargs</span>.copy</span>()</span></span><span id="ast-18"><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>_class</span>&nbsp;=&nbsp;<span id="ast-20">''</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23">'_class'</span><span id="ast-24">&nbsp;in&nbsp;</span><span id="ast-25" class="other_trans">kw</span>)</span>:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_class</span>&nbsp;=&nbsp;<span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans">kw</span>.pop</span>(<span id="ast-31">'_class'</span>)</span></span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-33">(<span id="ast-34">'class'</span><span id="ast-35">&nbsp;in&nbsp;</span><span id="ast-36" class="other_trans">kw</span>)</span>:<span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_class</span>&nbsp;+=&nbsp;<span id="ast-40">(<span id="ast-41">'&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">kw</span>.pop</span>(<span id="ast-46">'class'</span>)</span>)</span></span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tag_class</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51"><span id="ast-52">self</span>.tag_class</span>.get</span>(<span id="ast-53" class="other_trans">tag</span>,&nbsp;<span id="ast-54">''</span>)</span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">tag_class</span>:<span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-58"><span id="ast-59"><span id="ast-60" class="other_trans">tag_class</span>.startswith</span>(<span id="ast-61">'+'</span>)</span>:<span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-65"><span id="ast-66">'class'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-67">(<span id="ast-68">(<span id="ast-69"><span id="ast-70">tag_class</span>[<span id="ast-71"><span id="ast-72">1</span>:</span>]</span>&nbsp;+&nbsp;<span id="ast-74">'&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-76"><span id="ast-77"><span id="ast-78" class="incorrect_node">_class&nbsp;&rarr;&nbsp;tag_class&nbsp;</span>.lstrip</span>()</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-79"><span id="ast-80"><span id="ast-81" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-82"><span id="ast-83">'class'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86" class="ref_node">_class&nbsp;&rarr;&nbsp;tag_class&nbsp;</span>.lstrip</span>()</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-87"><span id="ast-88"><span id="ast-89"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-90"><span id="ast-91">'class'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-92"><span id="ast-93"><span id="ast-94">_class</span>.lstrip</span>()</span></span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-96">(<span id="ast-97">tag</span><span id="ast-98" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-99">'a'</span>)</span>:<span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-101">(<span id="ast-103"><span id="ast-104"><span id="ast-105"><span id="ast-106" class="other_trans">kw</span>[<span id="ast-107"><span id="ast-108">'href'</span></span>]</span>.startswith</span>(<span id="ast-109">'http:'</span>)</span>&nbsp;or&nbsp;<span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113">kw</span>[<span id="ast-114"><span id="ast-115">'href'</span></span>]</span>.startswith</span>(<span id="ast-116">'https:'</span>)</span>&nbsp;or&nbsp;<span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120">kw</span>[<span id="ast-121"><span id="ast-122">'href'</span></span>]</span>.startswith</span>(<span id="ast-123">'ftp:'</span>)</span>)</span>:<span id="ast-124"><span id="ast-125" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_cls</span>&nbsp;=&nbsp;<span id="ast-126">'outter'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-127"><span id="ast-128"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>_cls</span>&nbsp;=&nbsp;<span id="ast-129">'inner'</span></span></span><span id="ast-130"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-131"><span id="ast-132"><span id="ast-133">kw</span>.get</span>(<span id="ast-134">'class'</span>)</span>:<span id="ast-135"><span id="ast-136"><span id="ast-137" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-138"><span id="ast-139">'class'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-140">(<span id="ast-141">(<span id="ast-142"><span id="ast-143">kw</span>[<span id="ast-144"><span id="ast-145">'class'</span></span>]</span>&nbsp;+&nbsp;<span id="ast-147">'&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-149" class="other_trans">_cls</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-150"><span id="ast-151"><span id="ast-152" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kw</span>[<span id="ast-153"><span id="ast-154">'class'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-155" class="other_trans">_cls</span></span></span></span><span id="ast-156"><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>attrs</span>&nbsp;=&nbsp;<span id="ast-158"><span id="ast-159"><span id="ast-160">'&nbsp;'</span>.join</span>(<span id="ast-161">[<span id="ast-162">(<span id="ast-163">'%s="%s"'</span>&nbsp;%&nbsp;<span id="ast-165">(<span id="ast-166" class="other_trans">x</span>,&nbsp;<span id="ast-167" class="other_trans">y</span>)</span>)</span><span id="ast-168">&nbsp;for&nbsp;<span id="ast-169">(<span id="ast-170">x</span>,&nbsp;<span id="ast-171" class="other_trans">y</span>)</span>&nbsp;in&nbsp;<span id="ast-172"><span id="ast-173"><span id="ast-174" class="other_trans">kw</span>.items</span>()</span>&nbsp;if&nbsp;<span id="ast-175">y</span></span>]</span>)</span></span><span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-177" class="other_trans">attrs</span>:<span id="ast-178"><span id="ast-179" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>attrs</span>&nbsp;=&nbsp;<span id="ast-180">(<span id="ast-181">'&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-183">attrs</span>)</span></span></span><span id="ast-184"><span id="ast-185"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>nline</span>&nbsp;=&nbsp;<span id="ast-186"><span id="ast-188">'\\u000a'</span>&nbsp;if&nbsp;<span id="ast-187" class="other_trans">newline</span>&nbsp;else&nbsp;<span id="ast-189">''</span></span></span><span id="ast-190"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-191">child</span>:<span id="ast-192"><span id="ast-193"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>enclose</span>&nbsp;=&nbsp;<span id="ast-194">2</span></span></span><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-196">(<span id="ast-197" class="other_trans">enclose</span><span id="ast-198" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-199">1</span>)</span>:<span id="ast-200"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-201">(<span id="ast-202">'&lt;%s%s/&gt;%s'</span>&nbsp;%&nbsp;<span id="ast-204">(<span id="ast-205" class="other_trans">tag</span>,&nbsp;<span id="ast-206" class="other_trans">attrs</span>,&nbsp;<span id="ast-207">nline</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-209">(<span id="ast-210">enclose</span><span id="ast-211" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-212">2</span>)</span>:<span id="ast-213"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-214">(<span id="ast-215">'&lt;%s%s&gt;%s&lt;/%s&gt;%s'</span>&nbsp;%&nbsp;<span id="ast-217">(<span id="ast-218" class="other_trans">tag</span>,&nbsp;<span id="ast-219" class="other_trans">attrs</span>,&nbsp;<span id="ast-220">child</span>,&nbsp;<span id="ast-221">tag</span>,&nbsp;<span id="ast-222" class="other_trans">nline</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-223"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-224">(<span id="ast-225">'&lt;%s%s&gt;%s'</span>&nbsp;%&nbsp;<span id="ast-227">(<span id="ast-228" class="other_trans">tag</span>,&nbsp;<span id="ast-229" class="other_trans">attrs</span>,&nbsp;<span id="ast-230">nline</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;download_nybb(<span id="ast-2"></span>):<span id="ast-3"><span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'&nbsp;Returns&nbsp;the&nbsp;path&nbsp;to&nbsp;the&nbsp;NYC&nbsp;boroughs&nbsp;file.&nbsp;Downloads&nbsp;if&nbsp;necessary.&nbsp;'</span></span><span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-7">'nybb_14aav.zip'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>full_path_name</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-14">'examples'</span>,&nbsp;<span id="ast-15" class="other_trans">filename</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-23" class="other_trans">full_path_name</span>)</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">io</span>.open</span>(<span id="ast-28" class="other_trans">full_path_name</span>,&nbsp;<span id="ast-29">'wb'</span>)</span>&nbsp;as&nbsp;<span id="ast-30" class="other_trans">f</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">urlopen</span>(<span id="ast-35"><span id="ast-36"><span id="ast-37">'http://www.nyc.gov/html/dcp/download/bytes/{0}'</span>.format</span>(<span id="ast-38" class="other_trans">filename</span>)</span>)</span></span><span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-43"><span id="ast-44"><span id="ast-45" class="other_trans">response</span>.read</span>()</span>)</span></span></span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-47" class="correct_node">filename&nbsp;&rarr;&nbsp;full_path_name&nbsp;</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;prep_search_value(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">term</span>,&nbsp;<span id="ast-5" class="other_trans">lookup_type</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Coerce&nbsp;the&nbsp;input&nbsp;term&nbsp;to&nbsp;work&nbsp;for&nbsp;the&nbsp;given&nbsp;lookup_type.&nbsp;&nbsp;Returns&nbsp;the&nbsp;coerced&nbsp;term,&nbsp;or\\u000a&nbsp;&nbsp;&nbsp;&nbsp;``None``&nbsp;if&nbsp;the&nbsp;term&nbsp;and&nbsp;lookup_type&nbsp;are&nbsp;incompatible&nbsp;together.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>multi_terms</span>&nbsp;=&nbsp;<span id="ast-10" class="other_trans">None</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">isinstance</span>(<span id="ast-14" class="ref_node">lookup_type&nbsp;&rarr;&nbsp;term&nbsp;</span>,&nbsp;<span id="ast-15"><span id="ast-16" class="other_trans">six</span>.text_type</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-18">(<span id="ast-19" class="other_trans">lookup_type</span><span id="ast-20" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-21">'in'</span>)</span>:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>in_bits</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">re</span>.split</span>(<span id="ast-27">',\\\\s*'</span>,&nbsp;<span id="ast-28" class="other_trans">term</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32" class="other_trans">len</span>(<span id="ast-33" class="other_trans">in_bits</span>)</span><span id="ast-34" class="incorrect_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-35">1</span>)</span>:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>multi_terms</span>&nbsp;=&nbsp;<span id="ast-38" class="other_trans">in_bits</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>term</span>&nbsp;=&nbsp;<span id="ast-41" class="other_trans">None</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;prep(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.tar</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">Package</span>.profile</span>.prefix</span>,&nbsp;<span id="ast-14">'bin'</span>,&nbsp;<span id="ast-15">'tar'</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18">not</span>&nbsp;<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-23"><span id="ast-24">self</span>.tar</span>)</span>)</span>:<span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.tar</span>&nbsp;=&nbsp;<span id="ast-28">'tar'</span></span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-31"><span id="ast-32">self</span>.sources</span><span id="ast-33" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-34" class="other_trans">None</span>)</span>:<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>(<span id="ast-38">1</span>,&nbsp;<span id="ast-39">'&lt;skipping&nbsp;-&nbsp;no&nbsp;sources&nbsp;defined&gt;'</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-42"><span id="ast-43"><span id="ast-44"><span id="ast-45"><span id="ast-46">self</span>.sources</span>[<span id="ast-47"><span id="ast-48">0</span></span>]</span>.endswith</span>(<span id="ast-49">'.gitmirror'</span>)</span>:<span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>dirname</span>&nbsp;=&nbsp;<span id="ast-52"><span id="ast-53"><span id="ast-54"><span id="ast-55" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">os</span>.getcwd</span>()</span>,&nbsp;<span id="ast-59"><span id="ast-60" class="other_trans">expand_macros</span>(<span id="ast-61">'%{name}-%{version}'</span>,&nbsp;<span id="ast-62">self</span>)</span>)</span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65">not</span>&nbsp;<span id="ast-66"><span id="ast-67" class="correct_node">working_clone&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-68" class="other_trans">dirname</span>)</span>)</span>:<span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-74" class="other_trans">dirname</span>)</span>:<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.rmtree</span>(<span id="ast-79" class="other_trans">dirname</span>)</span></span></span><span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sh</span>(<span id="ast-84">(<span id="ast-85">'git&nbsp;clone&nbsp;--local&nbsp;--shared&nbsp;"%s"&nbsp;"%s"'</span>&nbsp;%&nbsp;<span id="ast-87">(<span id="ast-88"><span id="ast-89"><span id="ast-90">self</span>.sources</span>[<span id="ast-91"><span id="ast-92">0</span></span>]</span>,&nbsp;<span id="ast-93" class="other_trans">dirname</span>)</span>)</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;action_is_satisfied(<span id="ast-2"><span id="ast-3" class="other_trans">action</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>num_consumed_args</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7" class="other_trans">getattr</span>(<span id="ast-8" class="other_trans">action</span>,&nbsp;<span id="ast-9">'num_consumed_args'</span>,&nbsp;<span id="ast-10">0</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-14">(<span id="ast-15"><span id="ast-16" class="other_trans">action</span>.nargs</span><span id="ast-17" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-18"><span id="ast-19" class="other_trans">argparse</span>.ONE_OR_MORE</span>)</span>&nbsp;and&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">num_consumed_args</span><span id="ast-22" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-23">1</span>)</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-25">False</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">num_consumed_args</span><span id="ast-30" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-31"><span id="ast-32" class="other_trans">action</span>.nargs</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except:<span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-35">True</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_map_iterable(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'test&nbsp;map&nbsp;on&nbsp;iterables&nbsp;(direct)'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>view</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>.client</span>[<span id="ast-11">:</span>]</span></span><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>arr</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">range</span>(<span id="ast-16">101</span>)</span></span><span id="ast-17"><span id="ast-18" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>it</span>&nbsp;=&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">iter</span>(<span id="ast-21" class="other_trans">arr</span>)</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>r</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26" class="other_trans">view</span>.map_sync</span>(<span id="ast-27">lambda&nbsp;<span id="ast-28"><span id="ast-29" class="other_trans">x</span></span>:&nbsp;<span id="ast-30" class="other_trans">x</span></span>,&nbsp;<span id="ast-31" class="other_trans">it</span>)</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertEqual</span>(<span id="ast-36" class="other_trans">r</span>,&nbsp;<span id="ast-37"><span id="ast-38" class="other_trans">list</span>(<span id="ast-39" class="correct_node">it&nbsp;&rarr;&nbsp;arr&nbsp;</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;dummy_ca(<span id="ast-2"><span id="ast-3" class="other_trans">path</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dirname</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">os</span>.path</span>.dirname</span>(<span id="ast-10" class="other_trans">path</span>)</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13">not</span>&nbsp;<span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-18" class="other_trans">dirname</span>)</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.makedirs</span>(<span id="ast-23" class="other_trans">dirname</span>)</span></span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25"><span id="ast-26"><span id="ast-27" class="other_trans">path</span>.endswith</span>(<span id="ast-28">'.pem'</span>)</span>:<span id="ast-29"><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-31" class="other_trans">basename</span>,&nbsp;<span id="ast-32" class="other_trans">_</span>)</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">os</span>.path</span>.splitext</span>(<span id="ast-37" class="other_trans">path</span>)</span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>basename</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans">os</span>.path</span>.basename</span>(<span id="ast-44" class="other_trans">basename</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>basename</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans">os</span>.path</span>.basename</span>(<span id="ast-51" class="correct_node">basename&nbsp;&rarr;&nbsp;path&nbsp;</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process_atomtype(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">line</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Process&nbsp;a&nbsp;line&nbsp;in&nbsp;the&nbsp;[&nbsp;atomtypes&nbsp;]&nbsp;category.'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">line</span>.split</span>()</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15" class="other_trans">len</span>(<span id="ast-16" class="other_trans">fields</span>)</span><span id="ast-17" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-18">6</span>)</span>:<span id="ast-19"><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.too_few_fields</span>(<span id="ast-23" class="incorrect_node">line&nbsp;&rarr;&nbsp;fields&nbsp;</span>)</span></span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-25">(<span id="ast-26"><span id="ast-27" class="other_trans">len</span>(<span id="ast-28"><span id="ast-29" class="other_trans">fields</span>[<span id="ast-30"><span id="ast-31">3</span></span>]</span>)</span><span id="ast-32" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-33">1</span>)</span>:<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>.insert</span>(<span id="ast-38">1</span>,&nbsp;<span id="ast-39" class="other_trans">None</span>)</span></span><span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>.insert</span>(<span id="ast-44">1</span>,&nbsp;<span id="ast-45" class="other_trans">None</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-47">(<span id="ast-49">(<span id="ast-50"><span id="ast-51" class="other_trans">len</span>(<span id="ast-52"><span id="ast-53" class="other_trans">fields</span>[<span id="ast-54"><span id="ast-55">4</span></span>]</span>)</span><span id="ast-56" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-57">1</span>)</span>&nbsp;and&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60" class="other_trans">len</span>(<span id="ast-61"><span id="ast-62" class="other_trans">fields</span>[<span id="ast-63"><span id="ast-64">5</span></span>]</span>)</span><span id="ast-65" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-66">1</span>)</span>)</span>:<span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72" class="other_trans">fields</span>[<span id="ast-73"><span id="ast-74">1</span></span>]</span>[<span id="ast-75"><span id="ast-76">0</span></span>]</span>.isalpha</span>()</span>:<span id="ast-77"><span id="ast-78"><span id="ast-79"><span id="ast-80" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>.insert</span>(<span id="ast-81">2</span>,&nbsp;<span id="ast-82" class="other_trans">None</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-83"><span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fields</span>.insert</span>(<span id="ast-87">1</span>,&nbsp;<span id="ast-88" class="other_trans">None</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;runAdobeSetup(<span id="ast-2"><span id="ast-3" class="other_trans">dmgpath</span>,&nbsp;<span id="ast-4" class="other_trans">uninstalling</span></span>):<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_status</span>(<span id="ast-10">(<span id="ast-11">'Mounting&nbsp;disk&nbsp;image&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16">os</span>.path</span>.basename</span>(<span id="ast-17" class="other_trans">dmgpath</span>)</span>)</span>)</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mountpoints</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21">mountAdobeDmg</span>(<span id="ast-22">dmgpath</span>)</span></span><span id="ast-23"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-24" class="other_trans">mountpoints</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>setup_path</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28">findSetupApp</span>(<span id="ast-29"><span id="ast-30" class="other_trans">mountpoints</span>[<span id="ast-31"><span id="ast-32">0</span></span>]</span>)</span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34">setup_path</span>:<span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deploymentfile</span>&nbsp;=&nbsp;<span id="ast-37">None</span></span><span id="ast-38"><span id="ast-39" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>installxml</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41"><span id="ast-42"><span id="ast-43">os</span>.path</span>.join</span>(<span id="ast-44"><span id="ast-45">mountpoints</span>[<span id="ast-46"><span id="ast-47">0</span></span>]</span>,&nbsp;<span id="ast-48">'install.xml'</span>)</span></span><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>uninstallxml</span>&nbsp;=&nbsp;<span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-55"><span id="ast-56" class="other_trans">mountpoints</span>[<span id="ast-57"><span id="ast-58">0</span></span>]</span>,&nbsp;<span id="ast-59">'uninstall.xml'</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-61" class="other_trans">uninstalling</span>:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-63"><span id="ast-64"><span id="ast-65"><span id="ast-66">os</span>.path</span>.exists</span>(<span id="ast-67">uninstallxml</span>)</span>:<span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deploymentfile</span>&nbsp;=&nbsp;<span id="ast-70" class="other_trans">uninstallxml</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-71"><span id="ast-72"><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.unmountdmg</span>(<span id="ast-75"><span id="ast-76" class="other_trans">mountpoints</span>[<span id="ast-77"><span id="ast-78">0</span></span>]</span>)</span></span><span id="ast-79"><span id="ast-80"><span id="ast-81"><span id="ast-82" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_error</span>(<span id="ast-83">(<span id="ast-84">"%s&nbsp;doesn't&nbsp;appear&nbsp;to&nbsp;contain&nbsp;uninstall&nbsp;info."</span>&nbsp;%&nbsp;<span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89">os</span>.path</span>.basename</span>(<span id="ast-90" class="other_trans">dmgpath</span>)</span>)</span>)</span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-92">-1</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97">os</span>.path</span>.exists</span>(<span id="ast-98" class="incorrect_node">installxml&nbsp;&rarr;&nbsp;uninstallxml&nbsp;</span>)</span>:<span id="ast-99"><span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deploymentfile</span>&nbsp;=&nbsp;<span id="ast-101" class="ref_node">uninstallxml&nbsp;&rarr;&nbsp;installxml&nbsp;</span></span></span><span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>number_of_payloads</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105" class="other_trans">countPayloads</span>(<span id="ast-106"><span id="ast-107" class="other_trans">mountpoints</span>[<span id="ast-108"><span id="ast-109">0</span></span>]</span>)</span></span><span id="ast-110"><span id="ast-111"><span id="ast-112"><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_status</span>(<span id="ast-114">'Running&nbsp;Adobe&nbsp;Setup'</span>)</span></span><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>adobe_setup</span>&nbsp;=&nbsp;<span id="ast-117">[<span id="ast-118" class="other_trans">setup_path</span>,&nbsp;<span id="ast-119">'--mode=silent'</span>,&nbsp;<span id="ast-120">'--skipProcessCheck=1'</span>]</span></span><span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-122" class="other_trans">deploymentfile</span>:<span id="ast-123"><span id="ast-124"><span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>adobe_setup</span>.append</span>(<span id="ast-127">(<span id="ast-128">'--deploymentFile=%s'</span>&nbsp;%&nbsp;<span id="ast-130">deploymentFile</span>)</span>)</span></span></span><span id="ast-131"><span id="ast-132" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>retcode</span>&nbsp;=&nbsp;<span id="ast-133"><span id="ast-134">runAdobeInstallTool</span>(<span id="ast-135">adobe_setup</span>,&nbsp;<span id="ast-136">number_of_payloads</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-137"><span id="ast-138"><span id="ast-139"><span id="ast-140" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_error</span>(<span id="ast-141">(<span id="ast-142">"%s&nbsp;doesn't&nbsp;appear&nbsp;to&nbsp;contain&nbsp;Adobe&nbsp;Setup."</span>&nbsp;%&nbsp;<span id="ast-144"><span id="ast-145"><span id="ast-146"><span id="ast-147">os</span>.path</span>.basename</span>(<span id="ast-148" class="other_trans">dmgpath</span>)</span>)</span>)</span></span><span id="ast-149"><span id="ast-150" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>retcode</span>&nbsp;=&nbsp;<span id="ast-151">-1</span></span></span><span id="ast-152"><span id="ast-153"><span id="ast-154"><span id="ast-155" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.unmountdmg</span>(<span id="ast-156"><span id="ast-157">mountpoints</span>[<span id="ast-158"><span id="ast-159">0</span></span>]</span>)</span></span><span id="ast-160"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-161" class="other_trans">retcode</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-162"><span id="ast-163"><span id="ast-164"><span id="ast-165"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>munkicommon</span>.display_error</span>(<span id="ast-166">(<span id="ast-167">'No&nbsp;mountable&nbsp;filesystems&nbsp;on&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-169" class="other_trans">dmgpath</span>)</span>)</span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-171">-1</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_level_zero(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">engine</span>,&nbsp;<span id="ast-5" class="other_trans">hostname_backup_name</span>,&nbsp;<span id="ast-6" class="other_trans">recent_to_date</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Gets&nbsp;backups&nbsp;by&nbsp;backup_name&nbsp;and&nbsp;hostname\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;engine:&nbsp;freezer.engine.engine.BackupEngine\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;engine:&nbsp;Search&nbsp;for&nbsp;backups&nbsp;made&nbsp;by&nbsp;specified&nbsp;engine\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;hostname_backup_name:&nbsp;str\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;hostname_backup_name:&nbsp;Search&nbsp;for&nbsp;backup&nbsp;with&nbsp;specified&nbsp;name\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:type&nbsp;recent_to_date:&nbsp;int\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;recent_to_date:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:rtype:&nbsp;list[freezer.storage.base.Backup]\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:return:&nbsp;dictionary&nbsp;of&nbsp;level&nbsp;zero&nbsp;timestamps&nbsp;with&nbsp;attached&nbsp;storage\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14">self</span>.metadata_path</span>(engine=<span id="ast-16" class="other_trans">engine</span>,&nbsp;hostname_backup_name=<span id="ast-18" class="other_trans">hostname_backup_name</span>)</span></span><span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>zeros</span>&nbsp;=&nbsp;<span id="ast-21">[<span id="ast-22"><span id="ast-23"><span id="ast-24">base</span>.Backup</span>(storage=<span id="ast-26">self</span>,&nbsp;engine=<span id="ast-28" class="other_trans">engine</span>,&nbsp;hostname_backup_name=<span id="ast-30" class="other_trans">hostname_backup_name</span>,&nbsp;level_zero_timestamp=<span id="ast-32"><span id="ast-33" class="other_trans">int</span>(<span id="ast-34" class="other_trans">t</span>)</span>,&nbsp;timestamp=<span id="ast-36"><span id="ast-37" class="other_trans">int</span>(<span id="ast-38" class="other_trans">t</span>)</span>,&nbsp;level=<span id="ast-40">0</span>)</span><span id="ast-41">&nbsp;for&nbsp;<span id="ast-42" class="other_trans">t</span>&nbsp;in&nbsp;<span id="ast-43"><span id="ast-44"><span id="ast-45">self</span>.listdir</span>(<span id="ast-46" class="other_trans">path</span>)</span></span>]</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48" class="other_trans">recent_to_date</span>:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>zeros</span>&nbsp;=&nbsp;<span id="ast-51">[<span id="ast-52" class="other_trans">zero</span><span id="ast-53">&nbsp;for&nbsp;<span id="ast-54" class="other_trans">zero</span>&nbsp;in&nbsp;<span id="ast-55" class="other_trans">zeros</span>&nbsp;if&nbsp;<span id="ast-56">(<span id="ast-57"><span id="ast-58" class="other_trans">zero</span>.timestamp</span><span id="ast-59" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;<=,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-60" class="other_trans">recent_to_date</span>)</span></span>]</span></span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-62" class="other_trans">zeros</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;should_exit(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">start</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6"><span id="ast-7">self</span>.max_run_time</span>:<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;=&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">time</span>.time</span>()</span>&nbsp;-&nbsp;<span id="ast-15" class="other_trans">start</span>)</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17">(<span id="ast-18" class="other_trans">diff</span><span id="ast-19" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-20"><span id="ast-21">self</span>.max_run_time</span>)</span>:<span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warning</span>(<span id="ast-26">'Kuyruk&nbsp;run&nbsp;for&nbsp;%s&nbsp;seconds'</span>,&nbsp;<span id="ast-27"><span id="ast-28">self</span>.max_run_time</span>)</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-30">True</span></span></span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34">self</span>.num_tasks</span><span id="ast-35" class="location_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;==,&nbsp;pred:&nbsp;>&nbsp;</span><span id="ast-36"><span id="ast-37">self</span>.max_tasks</span>)</span>:<span id="ast-38"><span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warning</span>(<span id="ast-42">'Kuyruk&nbsp;has&nbsp;processed&nbsp;%s&nbsp;tasks'</span>,&nbsp;<span id="ast-43"><span id="ast-44">self</span>.max_tasks</span>)</span></span><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-46">True</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;record(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">value</span>,&nbsp;<span id="ast-6" class="other_trans">time_ms</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Record&nbsp;a&nbsp;value&nbsp;at&nbsp;a&nbsp;known&nbsp;time.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Arguments:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;(double):&nbsp;The&nbsp;value&nbsp;we&nbsp;are&nbsp;recording\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;time_ms&nbsp;(int):&nbsp;The&nbsp;current&nbsp;POSIX&nbsp;time&nbsp;in&nbsp;milliseconds\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Raises:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;QuotaViolationException:&nbsp;if&nbsp;recording&nbsp;this&nbsp;value&nbsp;moves&nbsp;a\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;metric&nbsp;beyond&nbsp;its&nbsp;configured&nbsp;maximum&nbsp;or&nbsp;minimum&nbsp;bound\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>now</span>&nbsp;=&nbsp;<span id="ast-12">(<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">time</span>.time</span>()</span>&nbsp;*&nbsp;<span id="ast-17">1000</span>)</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20" class="other_trans">time_ms</span><span id="ast-21" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-22" class="other_trans">None</span>)</span>:<span id="ast-23"><span id="ast-24" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time_ms</span>&nbsp;=&nbsp;<span id="ast-25" class="other_trans">now</span></span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._last_record_time</span>&nbsp;=&nbsp;<span id="ast-29" class="ref_node">now&nbsp;&rarr;&nbsp;time_ms&nbsp;</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-31"><span id="ast-32">self</span>._lock</span>:<span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-34" class="other_trans">stat</span>&nbsp;in&nbsp;<span id="ast-35"><span id="ast-36">self</span>._stats</span>:<span id="ast-37"><span id="ast-38"><span id="ast-39"><span id="ast-40" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>stat</span>.record</span>(<span id="ast-41"><span id="ast-42">self</span>._config</span>,&nbsp;<span id="ast-43" class="other_trans">value</span>,&nbsp;<span id="ast-44" class="other_trans">time_ms</span>)</span></span></span><span id="ast-45"><span id="ast-46"><span id="ast-47"><span id="ast-48"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._check_quotas</span>(<span id="ast-49" class="incorrect_node">time_ms&nbsp;&rarr;&nbsp;value&nbsp;</span>)</span></span></span><span id="ast-50"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-51" class="other_trans">parent</span>&nbsp;in&nbsp;<span id="ast-52"><span id="ast-53">self</span>._parents</span>:<span id="ast-54"><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>parent</span>.record</span>(<span id="ast-58" class="other_trans">value</span>,&nbsp;<span id="ast-59" class="other_trans">time_ms</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;send_activation_email(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>import&nbsp;<span id="ast-5">spreedly.settings&nbsp;as&nbsp;spreedly_settings</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9"><span id="ast-10">self</span>.sent_at</span>)</span>:<span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>send_mail</span>(<span id="ast-14"><span id="ast-15" class="other_trans">spreedly_settings</span>.SPREEDLY_GIFT_EMAIL_SUBJECT</span>,&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">render_to_string</span>(<span id="ast-18"><span id="ast-19" class="other_trans">spreedly_settings</span>.SPREEDLY_GIFT_EMAIL</span>,&nbsp;<span id="ast-20">{<span id="ast-21">'message'</span>:&nbsp;<span id="ast-26" class="correct_node">message&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-22">'plan_name'</span>:&nbsp;<span id="ast-27"><span id="ast-28">self</span>.plan_name</span>,&nbsp;<span id="ast-23">'giver'</span>:&nbsp;<span id="ast-29">(<span id="ast-30">'%s&nbsp;(%s)'</span>&nbsp;%&nbsp;<span id="ast-32">(<span id="ast-33"><span id="ast-34">self</span>.from_user</span>,&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37">self</span>.from_user</span>.email</span>)</span>)</span>,&nbsp;<span id="ast-24">'site'</span>:&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">spreedly_settings</span>.SPREEDLY_SITE_URL</span>,&nbsp;<span id="ast-25">'register_url'</span>:&nbsp;<span id="ast-40">(<span id="ast-41">'http://%s%s'</span>&nbsp;%&nbsp;<span id="ast-43">(<span id="ast-44"><span id="ast-45" class="other_trans">spreedly_settings</span>.SPREEDLY_SITE_URL</span>,&nbsp;<span id="ast-46"><span id="ast-47" class="other_trans">reverse</span>(<span id="ast-48">'gift_sign_up'</span>,&nbsp;args=<span id="ast-50">[<span id="ast-51"><span id="ast-52">self</span>.uuid</span>]</span>)</span>)</span>)</span>}</span>)</span>,&nbsp;<span id="ast-53"><span id="ast-54" class="other_trans">settings</span>.DEFAULT_FROM_EMAIL</span>,&nbsp;<span id="ast-55">[<span id="ast-56"><span id="ast-57"><span id="ast-58">self</span>.to_user</span>.email</span>]</span>)</span></span><span id="ast-59"><span id="ast-60"><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sent_at</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans">datetime</span>.today</span>()</span></span><span id="ast-65"><span id="ast-66"><span id="ast-67"><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.save</span>()</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;values(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>values</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8">self</span>._values</span>()</span></span><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12">self</span>.valueNormalizer</span><span id="ast-13" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-14" class="other_trans">None</span>)</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>values</span>&nbsp;=&nbsp;<span id="ast-17">[<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21">self</span>.valueNormalizer</span>.__func__</span>(<span id="ast-22" class="other_trans">value</span>)</span><span id="ast-23">&nbsp;for&nbsp;<span id="ast-24" class="other_trans">value</span>&nbsp;in&nbsp;<span id="ast-25" class="correct_node">value&nbsp;&rarr;&nbsp;values&nbsp;</span></span>]</span></span></span><span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-27" class="other_trans">values</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">soco</span></span>):<span id="ast-6"><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;soco&nbsp;(`SoCo`,&nbsp;optional):&nbsp;A&nbsp;`SoCo`&nbsp;instance&nbsp;to&nbsp;query&nbsp;for&nbsp;music\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;library&nbsp;information.&nbsp;If&nbsp;`None`,&nbsp;or&nbsp;not&nbsp;supplied,&nbsp;a&nbsp;random\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`SoCo`&nbsp;instance&nbsp;will&nbsp;be&nbsp;used.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-8"><span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.soco</span>&nbsp;=&nbsp;<span id="ast-11"><span id="ast-16" class="other_trans">soco</span>&nbsp;if&nbsp;<span id="ast-12">(<span id="ast-13" class="other_trans">soco</span><span id="ast-14" class="incorrect_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-15" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19" class="other_trans">discovery</span>.any_soco</span>()</span></span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.contentDirectory</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="ref_node">soco&nbsp;&rarr;&nbsp;self.&nbsp;</span>.contentDirectory</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;rm(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">file</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Removes&nbsp;all&nbsp;tags&nbsp;from&nbsp;file.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Args:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file:&nbsp;path&nbsp;to&nbsp;file.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;file&nbsp;is&nbsp;not&nbsp;tagged,&nbsp;nothing&nbsp;happens.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;removes&nbsp;all&nbsp;hard&nbsp;links&nbsp;in&nbsp;the&nbsp;library&nbsp;to&nbsp;the&nbsp;file!&nbsp;&nbsp;If&nbsp;no\\u000a&nbsp;&nbsp;&nbsp;&nbsp;other&nbsp;hard&nbsp;links&nbsp;exist,&nbsp;the&nbsp;file&nbsp;is&nbsp;essentially&nbsp;deleted.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-8" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>._liststrictpaths</span>(<span id="ast-12" class="other_trans">file</span>)</span>:<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.debug</span>(<span id="ast-17">'unlinking&nbsp;%r'</span>,&nbsp;<span id="ast-18" class="other_trans">f</span>)</span></span><span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.unlink</span>(<span id="ast-24" class="correct_node">file&nbsp;&rarr;&nbsp;f&nbsp;</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-26" class="other_trans">OSError</span>&nbsp;as&nbsp;<span id="ast-27" class="other_trans">e</span>:<span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logger</span>.warning</span>(<span id="ast-32">'Encountered&nbsp;OSError:&nbsp;%s'</span>,&nbsp;<span id="ast-33" class="other_trans">e</span>)</span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">datacube</span>,&nbsp;<span id="ast-6" class="other_trans">collection</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Set&nbsp;up&nbsp;the&nbsp;ingester&nbsp;object.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;datacube:&nbsp;A&nbsp;datacube&nbsp;instance&nbsp;(which&nbsp;has&nbsp;a&nbsp;database&nbsp;connection&nbsp;and\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tile_type&nbsp;and&nbsp;band&nbsp;dictionaries).&nbsp;If&nbsp;this&nbsp;is&nbsp;None&nbsp;the&nbsp;Ingeseter\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;will&nbsp;create&nbsp;its&nbsp;own&nbsp;datacube&nbsp;instance&nbsp;using&nbsp;the&nbsp;arguments\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;returned&nbsp;by&nbsp;self.parse_args().\\u000a&nbsp;&nbsp;&nbsp;&nbsp;collection:&nbsp;The&nbsp;datacube&nbsp;collection&nbsp;which&nbsp;will&nbsp;accept&nbsp;the&nbsp;ingest.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;this&nbsp;is&nbsp;None&nbsp;the&nbsp;Ingeseter&nbsp;will&nbsp;set&nbsp;up&nbsp;its&nbsp;own&nbsp;collection\\u000a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;self.datacube.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-10"><span id="ast-11"><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.args</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.parse_args</span>()</span></span><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-17"><span id="ast-18"><span id="ast-19">self</span>.args</span>.debug</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23"><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.getLogger</span>()</span>.setLevel</span>(<span id="ast-26"><span id="ast-27" class="other_trans">logging</span>.DEBUG</span>)</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">datacube</span><span id="ast-31" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-32" class="other_trans">None</span>)</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.datacube</span>&nbsp;=&nbsp;<span id="ast-36"><span id="ast-37" class="other_trans">IngesterDataCube</span>(<span id="ast-38"><span id="ast-39">self</span>.args</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.datacube</span>&nbsp;=&nbsp;<span id="ast-43" class="other_trans">datacube</span></span></span><span id="ast-44"><span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.agdc_root</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48" class="ref_node">datacube&nbsp;&rarr;&nbsp;self.&nbsp;</span>.agdc_root</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;test_startapp_is_checked_with_system_check(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-5"><span id="ast-6"><span id="ast-7">patch</span>.object</span>(<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">otree</span>.checks</span>.Rules</span>,&nbsp;<span id="ast-11">'file_exists'</span>)</span>&nbsp;as&nbsp;<span id="ast-12" class="other_trans">file_exists</span>:<span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>file_exists</span>.return_value</span>&nbsp;=&nbsp;<span id="ast-16">True</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">capture_stdout</span>()</span>:<span id="ast-20"><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>call_command</span>(<span id="ast-23">'check'</span>)</span></span></span><span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-28"><span id="ast-29" class="other_trans">file_exists</span>.called</span>)</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>first_run_calls</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33" class="other_trans">file_exists</span>.call_count</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-35"><span id="ast-36">cd</span>(<span id="ast-37"><span id="ast-38">self</span>.tmp_dir</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">capture_stdout</span>()</span>:<span id="ast-42"><span id="ast-43"><span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>call_command</span>(<span id="ast-45">'startapp'</span>,&nbsp;<span id="ast-46">'brokengame'</span>)</span></span></span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_apps</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50" class="other_trans">list</span>(<span id="ast-51"><span id="ast-52" class="other_trans">settings</span>.INSTALLED_APPS</span>)</span></span><span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_otree_apps</span>&nbsp;=&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">list</span>(<span id="ast-57"><span id="ast-58">settings</span>.INSTALLED_OTREE_APPS</span>)</span></span><span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_apps</span>.append</span>(<span id="ast-63">'brokengame'</span>)</span></span><span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>new_otree_apps</span>.append</span>(<span id="ast-68">'brokengame'</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-70"><span id="ast-71">add_path</span>(<span id="ast-72"><span id="ast-73">self</span>.tmp_dir</span>)</span>:<span id="ast-74"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77">self</span>.settings</span>(INSTALLED_APPS=<span id="ast-79" class="other_trans">new_apps</span>,&nbsp;INSTALLED_OTREE_APPS=<span id="ast-81" class="other_trans">new_otree_apps</span>)</span>:<span id="ast-82"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-83"><span id="ast-84"><span id="ast-85" class="other_trans">patch</span>.object</span>(<span id="ast-86"><span id="ast-87"><span id="ast-88">otree</span>.checks</span>.Rules</span>,&nbsp;<span id="ast-89">'file_exists'</span>)</span>&nbsp;as&nbsp;<span id="ast-90" class="other_trans">fexist</span>:<span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fexist</span>.return_value</span>&nbsp;=&nbsp;<span id="ast-94">True</span></span><span id="ast-95"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-96"><span id="ast-97" class="other_trans">capture_stdout</span>()</span>:<span id="ast-98"><span id="ast-99"><span id="ast-100" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>call_command</span>(<span id="ast-101">'check'</span>)</span></span></span><span id="ast-102"><span id="ast-103"><span id="ast-104"><span id="ast-105"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-106"><span id="ast-107" class="other_trans">fexist</span>.called</span>)</span></span><span id="ast-108"><span id="ast-109" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>second_run_calls</span>&nbsp;=&nbsp;<span id="ast-110"><span id="ast-111" class="other_trans">fexist</span>.call_count</span></span><span id="ast-112"><span id="ast-113"><span id="ast-114"><span id="ast-115"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.assertTrue</span>(<span id="ast-116">(<span id="ast-117" class="other_trans">second_run_calls</span><span id="ast-118" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-119" class="other_trans">first_run_calls</span>)</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process_dir(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">imglist</span>,&nbsp;<span id="ast-5" class="other_trans">img_dir</span>,&nbsp;<span id="ast-6" class="other_trans">thumb_dir</span>,&nbsp;<span id="ast-7">bigimg_dir</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'prepare&nbsp;images&nbsp;for&nbsp;a&nbsp;directory'</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-12" class="other_trans">f</span>&nbsp;in&nbsp;<span id="ast-13" class="other_trans">imglist</span>:<span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>filename</span>&nbsp;=&nbsp;<span id="ast-16"><span id="ast-17"><span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">os</span>.path</span>.split</span>(<span id="ast-21" class="other_trans">f</span>)</span>[<span id="ast-22"><span id="ast-23">1</span></span>]</span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>im_name</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28"><span id="ast-29">os</span>.path</span>.join</span>(<span id="ast-30" class="other_trans">img_dir</span>,&nbsp;<span id="ast-31" class="other_trans">filename</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>thumb_name</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36"><span id="ast-37">os</span>.path</span>.join</span>(<span id="ast-38" class="other_trans">thumb_dir</span>,&nbsp;<span id="ast-39">(<span id="ast-40"><span id="ast-41"><span id="ast-42">self</span>.settings</span>[<span id="ast-43"><span id="ast-44">'thumb_prefix'</span></span>]</span>&nbsp;+&nbsp;<span id="ast-46" class="other_trans">filename</span>)</span>)</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-48">(<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">os</span>.path</span>.isfile</span>(<span id="ast-54" class="other_trans">im_name</span>)</span>&nbsp;and&nbsp;<span id="ast-55"><span id="ast-56"><span id="ast-57"><span id="ast-58" class="other_trans">os</span>.path</span>.isfile</span>(<span id="ast-59" class="other_trans">thumb_name</span>)</span>&nbsp;and&nbsp;<span id="ast-60">(<span id="ast-61">not</span>&nbsp;<span id="ast-62"><span id="ast-63">self</span>.force</span>)</span>)</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-65">(<span id="ast-66">'%s&nbsp;exists&nbsp;-&nbsp;skipping'</span>&nbsp;%&nbsp;<span id="ast-68" class="other_trans">filename</span>)</span></span><span id="ast-69"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-71">(<span id="ast-72">'%s'</span>&nbsp;%&nbsp;<span id="ast-74" class="other_trans">filename</span>)</span></span><span id="ast-75"><span id="ast-76" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>img</span>&nbsp;=&nbsp;<span id="ast-77"><span id="ast-78" class="other_trans">Image</span>(<span id="ast-79" class="location_node">filename&nbsp;&rarr;&nbsp;f,&nbsp;pred:&nbsp;thumb_name&nbsp;</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;load_prikey(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">prikey_path</span>,&nbsp;<span id="ast-6" class="other_trans">prikey_password</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"load&nbsp;public&nbsp;key&nbsp;file\\u000a&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;PinkSign(pubkey_path='/my/cert/signCert.der')\\u000a&nbsp;&nbsp;&nbsp;&nbsp;p.load_prikey('/my/cert/signPri.key',&nbsp;prikey_password='Y0u-m@y-n0t-p@ss')\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12"><span id="ast-13">self</span>.pubkey</span><span id="ast-14" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-15" class="other_trans">None</span>)</span>:<span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-17"><span id="ast-18">ValueError</span>(<span id="ast-19">'pubkey&nbsp;should&nbsp;be&nbsp;loaded&nbsp;first.'</span>)</span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-22">not</span>&nbsp;<span id="ast-23"><span id="ast-24">any</span>(<span id="ast-25">[<span id="ast-26"><span id="ast-27">self</span>.prikey_path</span>,&nbsp;<span id="ast-28" class="other_trans">prikey_path</span>]</span>)</span>)</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">ValueError</span>(<span id="ast-32">'prikey_path&nbsp;is&nbsp;not&nbsp;defined.'</span>)</span></span></span><span id="ast-33"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-34">(<span id="ast-35">not</span>&nbsp;<span id="ast-36"><span id="ast-37">any</span>(<span id="ast-38">[<span id="ast-39"><span id="ast-40">self</span>.prikey_password</span>,&nbsp;<span id="ast-41">prikey_password</span>]</span>)</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-43"><span id="ast-44">ValueError</span>(<span id="ast-45">'prikey_password&nbsp;is&nbsp;not&nbsp;defined.'</span>)</span></span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">prikey_path</span><span id="ast-49" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-50" class="other_trans">None</span>)</span>:<span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.prikey_path</span>&nbsp;=&nbsp;<span id="ast-54" class="other_trans">prikey_path</span></span></span><span id="ast-55"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-56">(<span id="ast-57" class="other_trans">prikey_password</span><span id="ast-58" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-59">None</span>)</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.prikey_password</span>&nbsp;=&nbsp;<span id="ast-63" class="other_trans">prikey_password</span></span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>d</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68"><span id="ast-69">open</span>(<span id="ast-70"><span id="ast-71">self</span>.prikey_path</span>,&nbsp;<span id="ast-72">'rb'</span>)</span>.read</span>()</span></span><span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>der</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78">der_decoder</span>.decode</span>(<span id="ast-79" class="other_trans">d</span>)</span>[<span id="ast-80"><span id="ast-81">0</span></span>]</span></span><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>algorithm_type</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans">der</span>[<span id="ast-89"><span id="ast-90">0</span></span>]</span>[<span id="ast-91"><span id="ast-92">0</span></span>]</span>.asTuple</span>()</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-94">(<span id="ast-95" class="other_trans">algorithm_type</span><span id="ast-96">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-97">(<span id="ast-98">id_seed_cbc_with_sha1</span>,&nbsp;<span id="ast-99" class="other_trans">id_seed_cbc</span>)</span>)</span>:<span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-101"><span id="ast-102" class="other_trans">ValueError</span>(<span id="ast-103">'prikey&nbsp;is&nbsp;not&nbsp;correct&nbsp;K-PKI&nbsp;private&nbsp;key&nbsp;file'</span>)</span></span></span><span id="ast-104"><span id="ast-105" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>salt</span>&nbsp;=&nbsp;<span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109"><span id="ast-110"><span id="ast-111" class="other_trans">der</span>[<span id="ast-112"><span id="ast-113">0</span></span>]</span>[<span id="ast-114"><span id="ast-115">1</span></span>]</span>[<span id="ast-116"><span id="ast-117">0</span></span>]</span>.asOctets</span>()</span></span><span id="ast-118"><span id="ast-119" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iter_cnt</span>&nbsp;=&nbsp;<span id="ast-120"><span id="ast-121" class="other_trans">int</span>(<span id="ast-122"><span id="ast-123"><span id="ast-124"><span id="ast-125">der</span>[<span id="ast-126"><span id="ast-127">0</span></span>]</span>[<span id="ast-128"><span id="ast-129">1</span></span>]</span>[<span id="ast-130"><span id="ast-131">1</span></span>]</span>)</span></span><span id="ast-132"><span id="ast-133" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cipher_key</span>&nbsp;=&nbsp;<span id="ast-134"><span id="ast-135"><span id="ast-136"><span id="ast-137" class="other_trans">der</span>[<span id="ast-138"><span id="ast-139">1</span></span>]</span>.asOctets</span>()</span></span><span id="ast-140"><span id="ast-141" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dk</span>&nbsp;=&nbsp;<span id="ast-142"><span id="ast-143">PBKDF1</span>(<span id="ast-144" class="ref_node">prikey_password&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-145" class="other_trans">salt</span>,&nbsp;<span id="ast-146">iter_cnt</span>,&nbsp;<span id="ast-147">20</span>)</span></span><span id="ast-148"><span id="ast-149"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>k</span>&nbsp;=&nbsp;<span id="ast-150"><span id="ast-151" class="other_trans">dk</span>[<span id="ast-152">:<span id="ast-153">16</span></span>]</span></span><span id="ast-154"><span id="ast-155"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>div</span>&nbsp;=&nbsp;<span id="ast-156"><span id="ast-157"><span id="ast-158"><span id="ast-159"><span id="ast-160">hashlib</span>.sha1</span>(<span id="ast-161"><span id="ast-162" class="other_trans">dk</span>[<span id="ast-163"><span id="ast-164">16</span>:<span id="ast-165">20</span></span>]</span>)</span>.digest</span>()</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;calculate_scores(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">han</span>,&nbsp;<span id="ast-5" class="other_trans">fu</span>,&nbsp;<span id="ast-6" class="other_trans">is_tsumo</span>,&nbsp;<span id="ast-7" class="other_trans">is_dealer</span></span>):<span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Calculate&nbsp;how&nbsp;much&nbsp;scores&nbsp;cost&nbsp;a&nbsp;hand&nbsp;with&nbsp;given&nbsp;han&nbsp;and&nbsp;fu\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;han:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;fu:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;is_tsumo:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:param&nbsp;is_dealer:\\u000a&nbsp;&nbsp;&nbsp;&nbsp;:return:&nbsp;a&nbsp;dictionary&nbsp;with&nbsp;main&nbsp;and&nbsp;additional&nbsp;cost\\u000a&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;ron&nbsp;additional&nbsp;cost&nbsp;is&nbsp;always&nbsp;=&nbsp;0\\u000a&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;tsumo&nbsp;main&nbsp;cost&nbsp;is&nbsp;cost&nbsp;for&nbsp;dealer&nbsp;and&nbsp;additional&nbsp;is&nbsp;cost&nbsp;for&nbsp;player\\u000a&nbsp;&nbsp;&nbsp;&nbsp;{'main':&nbsp;1000,&nbsp;'additional':&nbsp;0}\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-11">(<span id="ast-12" class="other_trans">han</span><span id="ast-13" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-14">5</span>)</span>:<span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">han</span><span id="ast-18" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-19">26</span>)</span>:<span id="ast-20"><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rounded</span>&nbsp;=&nbsp;<span id="ast-22">16000</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-24">(<span id="ast-25">han</span><span id="ast-26" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-27">13</span>)</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rounded</span>&nbsp;=&nbsp;<span id="ast-30">8000</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-32">(<span id="ast-33" class="other_trans">han</span><span id="ast-34" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-35">11</span>)</span>:<span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rounded</span>&nbsp;=&nbsp;<span id="ast-38">6000</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-40">(<span id="ast-41" class="other_trans">han</span><span id="ast-42" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-43">8</span>)</span>:<span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rounded</span>&nbsp;=&nbsp;<span id="ast-46">4000</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-48">(<span id="ast-49" class="other_trans">han</span><span id="ast-50" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-51">6</span>)</span>:<span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rounded</span>&nbsp;=&nbsp;<span id="ast-54">3000</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-55"><span id="ast-56" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rounded</span>&nbsp;=&nbsp;<span id="ast-57">2000</span></span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double_rounded</span>&nbsp;=&nbsp;<span id="ast-60">(<span id="ast-61" class="other_trans">rounded</span>&nbsp;*&nbsp;<span id="ast-63">2</span>)</span></span><span id="ast-64"><span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>four_rounded</span>&nbsp;=&nbsp;<span id="ast-66">(<span id="ast-67">double_rounded</span>&nbsp;*&nbsp;<span id="ast-69">2</span>)</span></span><span id="ast-70"><span id="ast-71"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>six_rounded</span>&nbsp;=&nbsp;<span id="ast-72">(<span id="ast-73">double_rounded</span>&nbsp;*&nbsp;<span id="ast-75">3</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-76"><span id="ast-77"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>base_points</span>&nbsp;=&nbsp;<span id="ast-78">(<span id="ast-79" class="other_trans">fu</span>&nbsp;*&nbsp;<span id="ast-81"><span id="ast-82">pow</span>(<span id="ast-83">2</span>,&nbsp;<span id="ast-84">(<span id="ast-85">2</span>&nbsp;+&nbsp;<span id="ast-87">han</span>)</span>)</span>)</span></span><span id="ast-88"><span id="ast-89" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rounded</span>&nbsp;=&nbsp;<span id="ast-90">(<span id="ast-91"><span id="ast-92"><span id="ast-93">math</span>.ceil</span>(<span id="ast-94">(<span id="ast-95" class="other_trans">base_points</span>&nbsp;/&nbsp;<span id="ast-97">100.0</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-99">100</span>)</span></span><span id="ast-100"><span id="ast-101"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double_rounded</span>&nbsp;=&nbsp;<span id="ast-102">(<span id="ast-103"><span id="ast-104"><span id="ast-105" class="other_trans">math</span>.ceil</span>(<span id="ast-106">(<span id="ast-107">(<span id="ast-108">2</span>&nbsp;*&nbsp;<span id="ast-110">base_points</span>)</span>&nbsp;/&nbsp;<span id="ast-112">100.0</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-114">100</span>)</span></span><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>four_rounded</span>&nbsp;=&nbsp;<span id="ast-117">(<span id="ast-118"><span id="ast-119"><span id="ast-120">math</span>.ceil</span>(<span id="ast-121">(<span id="ast-122">(<span id="ast-123">4</span>&nbsp;*&nbsp;<span id="ast-125" class="other_trans">base_points</span>)</span>&nbsp;/&nbsp;<span id="ast-127">100.0</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-129">100</span>)</span></span><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>six_rounded</span>&nbsp;=&nbsp;<span id="ast-132">(<span id="ast-133"><span id="ast-134"><span id="ast-135">math</span>.ceil</span>(<span id="ast-136">(<span id="ast-137">(<span id="ast-138">6</span>&nbsp;*&nbsp;<span id="ast-140" class="incorrect_node">base_points&nbsp;&rarr;&nbsp;double_rounded&nbsp;</span>)</span>&nbsp;/&nbsp;<span id="ast-142">100.0</span>)</span>)</span>&nbsp;*&nbsp;<span id="ast-144">100</span>)</span></span><span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-146">(<span id="ast-147" class="other_trans">rounded</span><span id="ast-148" class="ref_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-149">2000</span>)</span>:<span id="ast-150"><span id="ast-151" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rounded</span>&nbsp;=&nbsp;<span id="ast-152">2000</span></span><span id="ast-153"><span id="ast-154" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>double_rounded</span>&nbsp;=&nbsp;<span id="ast-155">(<span id="ast-156" class="other_trans">rounded</span>&nbsp;*&nbsp;<span id="ast-158">2</span>)</span></span><span id="ast-159"><span id="ast-160" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>four_rounded</span>&nbsp;=&nbsp;<span id="ast-161">(<span id="ast-162" class="other_trans">double_rounded</span>&nbsp;*&nbsp;<span id="ast-164">2</span>)</span></span><span id="ast-165"><span id="ast-166"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>six_rounded</span>&nbsp;=&nbsp;<span id="ast-167">(<span id="ast-168" class="other_trans">double_rounded</span>&nbsp;*&nbsp;<span id="ast-170">3</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;compute(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">features</span>,&nbsp;<span id="ast-5" class="other_trans">clusters</span>,&nbsp;<span id="ast-6" class="other_trans">cluster_groups</span>,&nbsp;<span id="ast-7" class="other_trans">masks</span>,&nbsp;<span id="ast-8" class="other_trans">clusters_selected</span>,&nbsp;<span id="ast-9" class="other_trans">target_next</span>,&nbsp;<span id="ast-11" class="other_trans">similarity_measure</span></span>):<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>log</span>.debug</span>(<span id="ast-17"><span id="ast-18"><span id="ast-19">'Computing&nbsp;correlation&nbsp;for&nbsp;clusters&nbsp;{0:s}.'</span>.format</span>(<span id="ast-20"><span id="ast-21" class="other_trans">str</span>(<span id="ast-22"><span id="ast-23">list</span>(<span id="ast-24" class="other_trans">clusters_selected</span>)</span>)</span>)</span>)</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-26">(<span id="ast-27"><span id="ast-28" class="other_trans">len</span>(<span id="ast-29" class="other_trans">clusters_selected</span>)</span><span id="ast-30" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-31">0</span>)</span>:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-33">{}</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37">self</span>.sm</span><span id="ast-38" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-39" class="other_trans">None</span>)</span>:<span id="ast-40"><span id="ast-41"><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.sm</span>&nbsp;=&nbsp;<span id="ast-43"><span id="ast-44" class="other_trans">SimilarityMatrix</span>(<span id="ast-45" class="other_trans">features</span>,&nbsp;<span id="ast-46" class="other_trans">masks</span>)</span></span></span><span id="ast-47"><span id="ast-48" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>correlations</span>&nbsp;=&nbsp;<span id="ast-49"><span id="ast-50"><span id="ast-51" class="ref_node">sm&nbsp;&rarr;&nbsp;self.&nbsp;</span>.compute_matrix</span>(<span id="ast-52" class="other_trans">clusters</span>,&nbsp;<span id="ast-53" class="incorrect_node">clusters_selected&nbsp;&rarr;&nbsp;masks&nbsp;</span>)</span></span><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-55" class="other_trans">correlations</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_parse(<span id="ast-2"><span id="ast-3" class="other_trans">string</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>&nbsp;=&nbsp;<span id="ast-6">[]</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-8" class="other_trans">match</span>&nbsp;in&nbsp;<span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">PYTHON_FORMAT</span>.finditer</span>(<span id="ast-12" class="other_trans">string</span>)</span>:<span id="ast-13"><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-15" class="other_trans">name</span>,&nbsp;<span id="ast-16" class="other_trans">format</span>,&nbsp;<span id="ast-17" class="other_trans">typechar</span>)</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">match</span>.groups</span>()</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-24">(<span id="ast-25" class="other_trans">typechar</span><span id="ast-26" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-27">'%'</span>)</span>&nbsp;and&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">name</span><span id="ast-30" class="correct_node">&nbsp;is&nbsp;not&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;</span><span id="ast-31" class="other_trans">None</span>)</span>)</span>:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>result</span>.append</span>(<span id="ast-37">(<span id="ast-38" class="other_trans">name</span>,&nbsp;<span id="ast-39"><span id="ast-40" class="other_trans">str</span>(<span id="ast-41" class="other_trans">typechar</span>)</span>)</span>)</span></span></span><span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-43" class="other_trans">result</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">context</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>(<span id="ast-10" class="other_trans">Writer</span>,&nbsp;<span id="ast-11">self</span>)</span>.__init__</span>(<span id="ast-12" class="other_trans">context</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>jc</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">context</span>.getJobConf</span>()</span></span><span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-19">(<span id="ast-20" class="other_trans">HADOOP_VERSION</span><span id="ast-21" class="location_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;!=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-22">(<span id="ast-23">0</span>,&nbsp;<span id="ast-24">21</span>,&nbsp;<span id="ast-25">0</span>)</span>)</span>:<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jc_configure_int</span>(<span id="ast-29">self</span>,&nbsp;<span id="ast-30" class="other_trans">jc</span>,&nbsp;<span id="ast-31">'mapred.task.partition'</span>,&nbsp;<span id="ast-32">'part'</span>)</span></span><span id="ast-33"><span id="ast-34"><span id="ast-35" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jc_configure</span>(<span id="ast-36">self</span>,&nbsp;<span id="ast-37" class="other_trans">jc</span>,&nbsp;<span id="ast-38">'mapred.work.output.dir'</span>,&nbsp;<span id="ast-39">'outdir'</span>)</span></span><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jc_configure</span>(<span id="ast-43">self</span>,&nbsp;<span id="ast-44" class="other_trans">jc</span>,&nbsp;<span id="ast-45">'mapred.textoutputformat.separator'</span>,&nbsp;<span id="ast-46">'sep'</span>,&nbsp;<span id="ast-47">'\\u0009'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-48"><span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jc_configure_int</span>(<span id="ast-51">self</span>,&nbsp;<span id="ast-52" class="other_trans">jc</span>,&nbsp;<span id="ast-53">'mapreduce.task.partition'</span>,&nbsp;<span id="ast-54">'part'</span>)</span></span><span id="ast-55"><span id="ast-56"><span id="ast-57" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jc_configure</span>(<span id="ast-58">self</span>,&nbsp;<span id="ast-59" class="other_trans">jc</span>,&nbsp;<span id="ast-60">'mapreduce.task.output.dir'</span>,&nbsp;<span id="ast-61">'outdir'</span>)</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>jc_configure</span>(<span id="ast-65">self</span>,&nbsp;<span id="ast-66" class="other_trans">jc</span>,&nbsp;<span id="ast-67">'mapreduce.output.textoutputformat.separator'</span>,&nbsp;<span id="ast-68">'sep'</span>,&nbsp;<span id="ast-69">'\\u0009'</span>)</span></span></span><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.outfn</span>&nbsp;=&nbsp;<span id="ast-73">(<span id="ast-74">'%s/part-%05d'</span>&nbsp;%&nbsp;<span id="ast-76">(<span id="ast-77"><span id="ast-78">self</span>.outdir</span>,&nbsp;<span id="ast-79"><span id="ast-80">self</span>.part</span>)</span>)</span></span><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.file</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85"><span id="ast-86" class="other_trans">hdfs</span>.open</span>(<span id="ast-87"><span id="ast-88">self</span>.outfn</span>,&nbsp;<span id="ast-89">'w'</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;generateComment(<span id="ast-2"><span id="ast-3">linkRequests</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>&nbsp;=&nbsp;<span id="ast-6">''</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>nOfRequestedApps</span>&nbsp;=&nbsp;<span id="ast-9">0</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>nOfFoundApps</span>&nbsp;=&nbsp;<span id="ast-12">0</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-14">linkRequest</span>&nbsp;in&nbsp;<span id="ast-15" class="other_trans">linkRequests</span>:<span id="ast-16"><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>appsToLink</span>&nbsp;=&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">linkRequest</span>.split</span>(<span id="ast-21">','</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-23" class="other_trans">app</span>&nbsp;in&nbsp;<span id="ast-24" class="other_trans">appsToLink</span>:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>app</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">app</span>.strip</span>()</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-31">(<span id="ast-33">(<span id="ast-34" class="other_trans">nOfRequestedApps</span><span id="ast-35" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-36"><span id="ast-37" class="other_trans">Config</span>.maxAppsPerComment</span>)</span>&nbsp;and&nbsp;<span id="ast-38">(<span id="ast-39"><span id="ast-40" class="other_trans">len</span>(<span id="ast-41" class="other_trans">app</span>)</span><span id="ast-42" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-43">0</span>)</span>)</span>:<span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>app</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47"><span id="ast-48"><span id="ast-49"><span id="ast-50">HTMLParser</span>.HTMLParser</span>()</span>.unescape</span>(<span id="ast-51" class="other_trans">app</span>)</span></span><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>foundApp</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">findApp</span>(<span id="ast-56" class="other_trans">app</span>)</span></span><span id="ast-57"><span id="ast-58" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nOfRequestedApps</span>&nbsp;+=&nbsp;<span id="ast-60">1</span></span><span id="ast-61"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-62" class="other_trans">foundApp</span>:<span id="ast-63"><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>nOfFoundApps</span>&nbsp;+=&nbsp;<span id="ast-66">1</span></span><span id="ast-67"><span id="ast-68" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>&nbsp;+=&nbsp;<span id="ast-70">(<span id="ast-71">(<span id="ast-72">(<span id="ast-73">(<span id="ast-74">(<span id="ast-75">(<span id="ast-76">(<span id="ast-77">(<span id="ast-78">'[**'</span>&nbsp;+&nbsp;<span id="ast-80"><span id="ast-81" class="other_trans">foundApp</span>.fullName</span>)</span>&nbsp;+&nbsp;<span id="ast-83">'**]('</span>)</span>&nbsp;+&nbsp;<span id="ast-85"><span id="ast-86" class="other_trans">foundApp</span>.link</span>)</span>&nbsp;+&nbsp;<span id="ast-88">')&nbsp;-&nbsp;Price:&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-90"><span id="ast-93">'Free'</span>&nbsp;if&nbsp;<span id="ast-91"><span id="ast-92" class="other_trans">foundApp</span>.free</span>&nbsp;else&nbsp;<span id="ast-94">'Paid'</span></span>)</span>&nbsp;+&nbsp;<span id="ast-96">'&nbsp;-&nbsp;Rating:&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-98"><span id="ast-99" class="other_trans">foundApp</span>.rating</span>)</span>&nbsp;+&nbsp;<span id="ast-101">'/100&nbsp;-&nbsp;'</span>)</span></span><span id="ast-102"><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>&nbsp;+=&nbsp;<span id="ast-105">(<span id="ast-106">(<span id="ast-107">(<span id="ast-108">(<span id="ast-109">'Search&nbsp;for&nbsp;"'</span>&nbsp;+&nbsp;<span id="ast-111"><span id="ast-112" class="other_trans">foundApp</span>.searchName</span>)</span>&nbsp;+&nbsp;<span id="ast-114">'"&nbsp;on&nbsp;the&nbsp;[**Play&nbsp;Store**](https://play.google.com/store/search?q='</span>)</span>&nbsp;+&nbsp;<span id="ast-116"><span id="ast-117"><span id="ast-118" class="other_trans">urllib</span>.quote_plus</span>(<span id="ast-119"><span id="ast-120"><span id="ast-121"><span id="ast-122">foundApp</span>.searchName</span>.encode</span>(<span id="ast-123">'utf-8'</span>)</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-125">')\\u000a\\u000a'</span>)</span></span><span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.info</span>(<span id="ast-130">(<span id="ast-131">(<span id="ast-132">(<span id="ast-133">(<span id="ast-134">(<span id="ast-135">'"'</span>&nbsp;+&nbsp;<span id="ast-137"><span id="ast-138" class="other_trans">foundApp</span>.searchName</span>)</span>&nbsp;+&nbsp;<span id="ast-140">'"&nbsp;found.&nbsp;Full&nbsp;Name:&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-142"><span id="ast-143" class="other_trans">foundApp</span>.fullName</span>)</span>&nbsp;+&nbsp;<span id="ast-145">'&nbsp;-&nbsp;Link:&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-147"><span id="ast-148" class="other_trans">foundApp</span>.link</span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-149"><span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>&nbsp;+=&nbsp;<span id="ast-152">(<span id="ast-153">(<span id="ast-154">'I&nbsp;am&nbsp;sorry,&nbsp;I&nbsp;can\'t&nbsp;find&nbsp;any&nbsp;app&nbsp;named&nbsp;"'</span>&nbsp;+&nbsp;<span id="ast-156">app</span>)</span>&nbsp;+&nbsp;<span id="ast-158">'".\\u000a\\u000a'</span>)</span></span><span id="ast-159"><span id="ast-160"><span id="ast-161"><span id="ast-162"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.info</span>(<span id="ast-163">(<span id="ast-164">(<span id="ast-165">'Can\'t&nbsp;find&nbsp;any&nbsp;app&nbsp;named&nbsp;"'</span>&nbsp;+&nbsp;<span id="ast-167" class="other_trans">app</span>)</span>&nbsp;+&nbsp;<span id="ast-169">'"'</span>)</span>)</span></span></span></span></span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-171">(<span id="ast-172">nOfRequestedApps</span><span id="ast-173" class="correct_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;>&nbsp;</span><span id="ast-174"><span id="ast-175">Config</span>.maxAppsPerComment</span>)</span>:<span id="ast-176"><span id="ast-177" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>&nbsp;=&nbsp;<span id="ast-178">(<span id="ast-179">(<span id="ast-180">(<span id="ast-181">(<span id="ast-182">(<span id="ast-183">'You&nbsp;requested&nbsp;more&nbsp;than&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-185"><span id="ast-186">str</span>(<span id="ast-187"><span id="ast-188" class="other_trans">Config</span>.maxAppsPerComment</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-190">'&nbsp;apps.&nbsp;I&nbsp;will&nbsp;only&nbsp;link&nbsp;to&nbsp;the&nbsp;first&nbsp;'</span>)</span>&nbsp;+&nbsp;<span id="ast-192"><span id="ast-193">str</span>(<span id="ast-194"><span id="ast-195">Config</span>.maxAppsPerComment</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-197">'&nbsp;apps.\\u000a\\u000a'</span>)</span>&nbsp;+&nbsp;<span id="ast-199" class="other_trans">reply</span>)</span></span></span><span id="ast-200"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-201">(<span id="ast-202" class="other_trans">nOfFoundApps</span><span id="ast-203" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-204">0</span>)</span>:<span id="ast-205"><span id="ast-206"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>reply</span>&nbsp;=&nbsp;<span id="ast-207">None</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_get_object_content(<span id="ast-2"><span id="ast-3" class="other_trans">ioctx</span>,&nbsp;<span id="ast-4" class="other_trans">name</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;=&nbsp;<span id="ast-7">0</span></span><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>&nbsp;=&nbsp;<span id="ast-10">''</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-12">True</span>:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>data</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17" class="other_trans">ioctx</span>.read</span>(<span id="ast-18" class="other_trans">name</span>,&nbsp;offset=<span id="ast-20" class="other_trans">offset</span>)</span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-22">(<span id="ast-23">not</span>&nbsp;<span id="ast-24" class="other_trans">data</span>)</span>:<span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span><span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>&nbsp;+=&nbsp;<span id="ast-29" class="other_trans">data</span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>offset</span>&nbsp;+=&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">len</span>(<span id="ast-35" class="correct_node">content&nbsp;&rarr;&nbsp;data&nbsp;</span>)</span></span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-37" class="other_trans">content</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;parse(<span id="ast-2"><span id="ast-3">code</span>,&nbsp;<span id="ast-4" class="other_trans">spacing</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">code</span><span id="ast-9" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-10">''</span>)</span>:<span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-12">(<span id="ast-13">''</span>,&nbsp;<span id="ast-14">''</span>)</span></span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>active_char</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18">code</span>[<span id="ast-19"><span id="ast-20">0</span></span>]</span></span><span id="ast-21"><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>rest_code</span>&nbsp;=&nbsp;<span id="ast-23"><span id="ast-24" class="other_trans">code</span>[<span id="ast-25"><span id="ast-26">1</span>:</span>]</span></span><span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-29" class="other_trans">active_char</span><span id="ast-30">&nbsp;in&nbsp;</span><span id="ast-31">'0123456789'</span>)</span>:<span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-33"><span id="ast-34">num_parse</span>(<span id="ast-35" class="other_trans">active_char</span>,&nbsp;<span id="ast-36" class="other_trans">rest_code</span>)</span></span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">active_char</span><span id="ast-40" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-41">'.'</span>)</span>:<span id="ast-42"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-43">(<span id="ast-44"><span id="ast-45">len</span>(<span id="ast-46">rest_code</span>)</span><span id="ast-47" class="location_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=,&nbsp;pred:&nbsp;==&nbsp;</span><span id="ast-48">1</span>)</span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-50">(<span id="ast-51"><span id="ast-52">rest_code</span>[<span id="ast-53"><span id="ast-54">0</span></span>]</span><span id="ast-55">&nbsp;in&nbsp;</span><span id="ast-56">'0123456789'</span>)</span>:<span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-58"><span id="ast-59">num_parse</span>(<span id="ast-60">active_char</span>,&nbsp;<span id="ast-61" class="other_trans">rest_code</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-62"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-63"><span id="ast-64" class="other_trans">function_parse</span>(<span id="ast-65">(<span id="ast-66" class="other_trans">active_char</span>&nbsp;+&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">rest_code</span>[<span id="ast-70"><span id="ast-71">0</span></span>]</span>)</span>,&nbsp;<span id="ast-72"><span id="ast-73">rest_code</span>[<span id="ast-74"><span id="ast-75">1</span>:</span>]</span>)</span></span></span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77">(<span id="ast-78">active_char</span><span id="ast-79" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-80">'"'</span>)</span>:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">str_parse</span>(<span id="ast-84">active_char</span>,&nbsp;<span id="ast-85" class="other_trans">rest_code</span>)</span></span></span><span id="ast-86"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-87">(<span id="ast-88">active_char</span><span id="ast-89" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-90">'$'</span>)</span>:<span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-92">safe_mode</span>:<span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-94"><span id="ast-95" class="other_trans">UnsafeInputError</span>(<span id="ast-96">active_char</span>,&nbsp;<span id="ast-97">rest_code</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-99"><span id="ast-100">python_parse</span>(<span id="ast-101" class="other_trans">active_char</span>,&nbsp;<span id="ast-102" class="other_trans">rest_code</span>)</span></span></span></span><span id="ast-103"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-104">(<span id="ast-105">active_char</span><span id="ast-106" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-107">')'</span>)</span>:<span id="ast-108"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-109">(<span id="ast-110">''</span>,&nbsp;<span id="ast-111">rest_code</span>)</span></span></span><span id="ast-112"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-113">(<span id="ast-114" class="other_trans">active_char</span><span id="ast-115" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-116">';'</span>)</span>:<span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-118">(<span id="ast-119" class="other_trans">rest_code</span><span id="ast-120" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-121">''</span>)</span>:<span id="ast-122"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-123">(<span id="ast-124">''</span>,&nbsp;<span id="ast-125">''</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-127">(<span id="ast-128">''</span>,&nbsp;<span id="ast-129">(<span id="ast-130">';'</span>&nbsp;+&nbsp;<span id="ast-132" class="other_trans">rest_code</span>)</span>)</span></span></span></span><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-134">(<span id="ast-135" class="other_trans">active_char</span><span id="ast-136">&nbsp;in&nbsp;</span><span id="ast-137">variables</span>)</span>:<span id="ast-138"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-139">(<span id="ast-140">active_char</span>,&nbsp;<span id="ast-141">rest_code</span>)</span></span></span><span id="ast-142"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-143">(<span id="ast-144">active_char</span><span id="ast-145">&nbsp;in&nbsp;</span><span id="ast-146" class="other_trans">replacements</span>)</span>:<span id="ast-147"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-148"><span id="ast-149">replace_parse</span>(<span id="ast-150" class="other_trans">active_char</span>,&nbsp;<span id="ast-151">rest_code</span>,&nbsp;<span id="ast-152">spacing</span>)</span></span></span><span id="ast-153"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-154">(<span id="ast-155" class="other_trans">active_char</span><span id="ast-156">&nbsp;in&nbsp;</span><span id="ast-157">c_to_f</span>)</span>:<span id="ast-158"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-159">(<span id="ast-161">(<span id="ast-162">not</span>&nbsp;<span id="ast-163">(<span id="ast-164"><span id="ast-165" class="other_trans">len</span>(<span id="ast-166">rest_code</span>)</span><span id="ast-167" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-168">0</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-169">(<span id="ast-170"><span id="ast-171" class="other_trans">rest_code</span>[<span id="ast-172"><span id="ast-173">0</span></span>]</span><span id="ast-174" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-175">'='</span>)</span>&nbsp;and&nbsp;<span id="ast-176">(<span id="ast-177">not</span>&nbsp;<span id="ast-178">(<span id="ast-179"><span id="ast-180"><span id="ast-181">c_to_f</span>[<span id="ast-182"><span id="ast-183" class="other_trans">active_char</span></span>]</span>[<span id="ast-184"><span id="ast-185">1</span></span>]</span><span id="ast-186" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-187">0</span>)</span>)</span>)</span>:<span id="ast-188"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-189"><span id="ast-190">parse</span>(<span id="ast-191"><span id="ast-192">augmented_assignment_parse</span>(<span id="ast-193" class="other_trans">active_char</span>,&nbsp;<span id="ast-194" class="other_trans">rest_code</span>)</span>)</span></span></span><span id="ast-195"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-196"><span id="ast-197">function_parse</span>(<span id="ast-198">active_char</span>,&nbsp;<span id="ast-199">rest_code</span>)</span></span></span><span id="ast-200"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-201">(<span id="ast-202" class="other_trans">active_char</span><span id="ast-203">&nbsp;in&nbsp;</span><span id="ast-204">c_to_i</span>)</span>:<span id="ast-205"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-206"><span id="ast-207" class="other_trans">infix_parse</span>(<span id="ast-208" class="other_trans">active_char</span>,&nbsp;<span id="ast-209" class="other_trans">rest_code</span>)</span></span></span><span id="ast-210"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-211">(<span id="ast-212">active_char</span><span id="ast-213">&nbsp;in&nbsp;</span><span id="ast-214">c_to_s</span>)</span>:<span id="ast-215"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-216"><span id="ast-217">statement_parse</span>(<span id="ast-218">active_char</span>,&nbsp;<span id="ast-219" class="other_trans">rest_code</span>,&nbsp;<span id="ast-220" class="other_trans">spacing</span>)</span></span></span><span id="ast-221"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-222"><span id="ast-223">PythParseError</span>(<span id="ast-224">active_char</span>,&nbsp;<span id="ast-225" class="other_trans">rest_code</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_set_file(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">value</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-8">(<span id="ast-9" class="other_trans">value</span><span id="ast-10" class="correct_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-12">(<span id="ast-13">not</span>&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">isinstance</span>(<span id="ast-16" class="other_trans">value</span>,&nbsp;<span id="ast-17" class="other_trans">File</span>)</span>)</span>)</span>:<span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>value</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21" class="other_trans">File</span>(<span id="ast-22" class="other_trans">value</span>)</span></span></span><span id="ast-23"><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._file</span>&nbsp;=&nbsp;<span id="ast-26" class="other_trans">value</span></span><span id="ast-27"><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>._committed</span>&nbsp;=&nbsp;<span id="ast-30">False</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;work(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">response_dict</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>response_dict</span>&nbsp;=&nbsp;<span id="ast-8">(<span id="ast-10">response_dict</span>&nbsp;or&nbsp;<span id="ast-11"><span id="ast-12"><span id="ast-13">self</span>.create_encounter_api_call</span>()</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-15">(<span id="ast-16">not</span>&nbsp;<span id="ast-17" class="other_trans">response_dict</span>)</span>:<span id="ast-18"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-19"><span id="ast-20" class="other_trans">WorkerResult</span>.ERROR</span></span></span><span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>responses</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25" class="other_trans">response_dict</span>[<span id="ast-26"><span id="ast-27">'responses'</span></span>]</span></span><span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>response</span>&nbsp;=&nbsp;<span id="ast-30"><span id="ast-31" class="other_trans">responses</span>[<span id="ast-32"><span id="ast-33"><span id="ast-34">self</span>.response_key</span></span>]</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37"><span id="ast-38" class="other_trans">response</span>[<span id="ast-39"><span id="ast-40"><span id="ast-41">self</span>.response_status_key</span></span>]</span><span id="ast-42" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-43" class="other_trans">ENCOUNTER_STATUS_SUCCESS</span>)</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46"><span id="ast-47" class="other_trans">response</span>[<span id="ast-48"><span id="ast-49"><span id="ast-50">self</span>.response_status_key</span></span>]</span><span id="ast-51" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-52" class="other_trans">ENCOUNTER_STATUS_NOT_IN_RANGE</span>)</span>:<span id="ast-53"><span id="ast-54"><span id="ast-55"><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-57">'pokemon_not_in_range'</span>,&nbsp;formatted=<span id="ast-59">'Pokemon&nbsp;went&nbsp;out&nbsp;of&nbsp;range!'</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-61">(<span id="ast-62"><span id="ast-63" class="other_trans">response</span>[<span id="ast-64"><span id="ast-65"><span id="ast-66">self</span>.response_status_key</span></span>]</span><span id="ast-67" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-68">ENCOUNTER_STATUS_POKEMON_INVENTORY_FULL</span>)</span>:<span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.emit_event</span>(<span id="ast-73">'pokemon_inventory_full'</span>,&nbsp;formatted=<span id="ast-75">'Your&nbsp;Pokemon&nbsp;inventory&nbsp;is&nbsp;full!&nbsp;Could&nbsp;not&nbsp;catch!'</span>)</span></span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-77"><span id="ast-78">WorkerResult</span>.ERROR</span></span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-80">KeyError</span>:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-82"><span id="ast-83" class="other_trans">WorkerResult</span>.ERROR</span></span></span></span><span id="ast-84"><span id="ast-85" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pokemon_data</span>&nbsp;=&nbsp;<span id="ast-86"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans">response</span>[<span id="ast-94"><span id="ast-95">'wild_pokemon'</span></span>]</span>[<span id="ast-96"><span id="ast-97">'pokemon_data'</span></span>]</span>&nbsp;if&nbsp;<span id="ast-87">(<span id="ast-88">'wild_pokemon'</span><span id="ast-89">&nbsp;in&nbsp;</span><span id="ast-90" class="other_trans">response</span>)</span>&nbsp;else&nbsp;<span id="ast-98"><span id="ast-99" class="other_trans">response</span>[<span id="ast-100"><span id="ast-101">'pokemon_data'</span></span>]</span></span></span><span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pokemon</span>&nbsp;=&nbsp;<span id="ast-104"><span id="ast-105" class="other_trans">Pokemon</span>(<span id="ast-106" class="other_trans">pokemon_data</span>)</span></span><span id="ast-107"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-108">(<span id="ast-109">not</span>&nbsp;<span id="ast-110"><span id="ast-111"><span id="ast-112">self</span>._should_catch_pokemon</span>(<span id="ast-113" class="other_trans">pokemon</span>)</span>)</span>:<span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-115"><span id="ast-116">WorkerResult</span>.SUCCESS</span></span></span><span id="ast-117"><span id="ast-118" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>is_vip</span>&nbsp;=&nbsp;<span id="ast-119"><span id="ast-120"><span id="ast-121">self</span>._is_vip_pokemon</span>(<span id="ast-122" class="other_trans">pokemon</span>)</span></span><span id="ast-123"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-124">(<span id="ast-125"><span id="ast-126"><span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130">inventory</span>.items</span>()</span>.get</span>(<span id="ast-131" class="other_trans">ITEM_POKEBALL</span>)</span>.count</span><span id="ast-132" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-133">1</span>)</span>:<span id="ast-134"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-135">(<span id="ast-136"><span id="ast-137"><span id="ast-138"><span id="ast-139"><span id="ast-140"><span id="ast-141">inventory</span>.items</span>()</span>.get</span>(<span id="ast-142" class="other_trans">ITEM_GREATBALL</span>)</span>.count</span><span id="ast-143" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-144">1</span>)</span>:<span id="ast-145"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-146">(<span id="ast-147"><span id="ast-148"><span id="ast-149"><span id="ast-150"><span id="ast-151"><span id="ast-152" class="other_trans">inventory</span>.items</span>()</span>.get</span>(<span id="ast-153">ITEM_ULTRABALL</span>)</span>.count</span><span id="ast-154" class="incorrect_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-155">1</span>)</span>:<span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-157"><span id="ast-158" class="other_trans">WorkerResult</span>.SUCCESS</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-160">(<span id="ast-162">(<span id="ast-163">not</span>&nbsp;<span id="ast-164" class="other_trans">is_vip</span>)</span>&nbsp;and&nbsp;<span id="ast-165">(<span id="ast-166"><span id="ast-167"><span id="ast-168"><span id="ast-169"><span id="ast-170"><span id="ast-171" class="other_trans">inventory</span>.items</span>()</span>.get</span>(<span id="ast-172" class="other_trans">ITEM_ULTRABALL</span>)</span>.count</span><span id="ast-173" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-174"><span id="ast-175">self</span>.min_ultraball_to_keep</span>)</span>)</span>:<span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-177"><span id="ast-178">WorkerResult</span>.SUCCESS</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;set_players(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">players</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10">self</span>._pmenu_lists</span>[<span id="ast-11"><span id="ast-12">0</span></span>]</span>[<span id="ast-13"><span id="ast-14">1</span></span>]</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>diff</span>&nbsp;=&nbsp;<span id="ast-17">lambda&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">a</span>,&nbsp;<span id="ast-20" class="other_trans">b</span></span>:&nbsp;<span id="ast-21">[<span id="ast-22">[<span id="ast-23" class="other_trans">e</span><span id="ast-24">&nbsp;for&nbsp;<span id="ast-25">e</span>&nbsp;in&nbsp;<span id="ast-26" class="other_trans">d</span>&nbsp;if&nbsp;<span id="ast-27">(<span id="ast-28">not</span>&nbsp;<span id="ast-29">(<span id="ast-30" class="other_trans">e</span><span id="ast-31">&nbsp;in&nbsp;</span><span id="ast-32">c</span>)</span>)</span></span>]</span><span id="ast-33">&nbsp;for&nbsp;<span id="ast-34">(<span id="ast-35" class="other_trans">c</span>,&nbsp;<span id="ast-36">d</span>)</span>&nbsp;in&nbsp;<span id="ast-37">(<span id="ast-38">(<span id="ast-39">a</span>,&nbsp;<span id="ast-40" class="other_trans">b</span>)</span>,&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">b</span>,&nbsp;<span id="ast-43" class="other_trans">a</span>)</span>)</span></span>]</span></span></span><span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-46" class="other_trans">add</span>,&nbsp;<span id="ast-47">remove</span>)</span>&nbsp;=&nbsp;<span id="ast-48"><span id="ast-49" class="other_trans">diff</span>(<span id="ast-50">[<span id="ast-51"><span id="ast-52"><span id="ast-53" class="other_trans">b</span>.original_widget</span>.label</span><span id="ast-54">&nbsp;for&nbsp;<span id="ast-55">b</span>&nbsp;in&nbsp;<span id="ast-56"><span id="ast-57" class="other_trans">list</span>(<span id="ast-58">content</span>)</span></span>]</span>,&nbsp;<span id="ast-59" class="other_trans">players</span>)</span></span><span id="ast-60"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-61">b</span>&nbsp;in&nbsp;<span id="ast-62"><span id="ast-63" class="other_trans">list</span>(<span id="ast-64">content</span>)</span>:<span id="ast-65"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-66">(<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">b</span>.original_widget</span>.label</span><span id="ast-70">&nbsp;in&nbsp;</span><span id="ast-71" class="other_trans">remove</span>)</span>:<span id="ast-72"><span id="ast-73"><span id="ast-74"><span id="ast-75" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>.remove</span>(<span id="ast-76">b</span>)</span></span></span></span><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;=&nbsp;<span id="ast-79">0</span></span><span id="ast-80"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-81">(<span id="ast-82"><span id="ast-83">len</span>(<span id="ast-84" class="other_trans">add</span>)</span><span id="ast-85" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-86">0</span>)</span>:<span id="ast-87"><span id="ast-88"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>a</span>&nbsp;=&nbsp;<span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans">add</span>.pop</span>(<span id="ast-92">0</span>)</span></span><span id="ast-93"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-94">(<span id="ast-96">(<span id="ast-97" class="other_trans">i</span><span id="ast-98" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-99">(<span id="ast-100"><span id="ast-101" class="other_trans">len</span>(<span id="ast-102">content</span>)</span>&nbsp;-&nbsp;<span id="ast-104">1</span>)</span>)</span>&nbsp;and&nbsp;<span id="ast-105">(<span id="ast-106"><span id="ast-107"><span id="ast-108"><span id="ast-109" class="other_trans">content</span>[<span id="ast-110"><span id="ast-111">i</span></span>]</span>.original_widget</span>.label</span><span id="ast-112" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-113" class="other_trans">a</span>)</span>)</span>:<span id="ast-114"><span id="ast-115" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-117">1</span></span></span><span id="ast-118"><span id="ast-119"><span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>content</span>.insert</span>(<span id="ast-122">i</span>,&nbsp;<span id="ast-123"><span id="ast-124"><span id="ast-125">urwid</span>.AttrMap</span>(<span id="ast-126"><span id="ast-127">PMenuButton</span>(<span id="ast-128" class="other_trans">a</span>,&nbsp;<span id="ast-129"><span id="ast-130">self</span>.next</span>,&nbsp;<span id="ast-131">a</span>)</span>,&nbsp;<span id="ast-132">'menu_item'</span>,&nbsp;<span id="ast-133">'menu_item_focus'</span>)</span>)</span></span><span id="ast-134"><span id="ast-135"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>i</span>&nbsp;+=&nbsp;<span id="ast-137">1</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;restoreImage(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dmgs_to_restore</span>&nbsp;=&nbsp;<span id="ast-6">[<span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans">item</span>.get</span>(<span id="ast-10">'url'</span>)</span><span id="ast-11">&nbsp;for&nbsp;<span id="ast-12" class="other_trans">item</span>&nbsp;in&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15">self</span>.selectedWorkflow</span>[<span id="ast-16"><span id="ast-17">'components'</span></span>]</span>&nbsp;if&nbsp;<span id="ast-18">(<span id="ast-20">(<span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans">item</span>.get</span>(<span id="ast-24">'type'</span>)</span><span id="ast-25" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-26">'image'</span>)</span>&nbsp;and&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">item</span>.get</span>(<span id="ast-30">'url'</span>)</span>)</span></span>]</span></span><span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-32" class="other_trans">dmgs_to_restore</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Clone&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-36"><span id="ast-37" class="other_trans">dmgs_to_restore</span>[<span id="ast-38"><span id="ast-39">0</span></span>]</span>,&nbsp;<span id="ast-40"><span id="ast-41">self</span>.targetVolume</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;get_interface_descriptor(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">dev</span>,&nbsp;<span id="ast-5" class="other_trans">intf</span>,&nbsp;<span id="ast-6" class="other_trans">alt</span>,&nbsp;<span id="ast-7" class="other_trans">config</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>cfgdesc</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12">self</span>.get_configuration_descriptor</span>(<span id="ast-13" class="other_trans">dev</span>,&nbsp;<span id="ast-14" class="other_trans">config</span>)</span></span><span id="ast-15"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-16">(<span id="ast-17" class="other_trans">intf</span><span id="ast-18" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-19"><span id="ast-20" class="other_trans">cfgdesc</span>.bNumInterfaces</span>)</span>:<span id="ast-21"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-22"><span id="ast-23" class="other_trans">IndexError</span>(<span id="ast-24">(<span id="ast-25">'Invalid&nbsp;interface&nbsp;index&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">str</span>(<span id="ast-29" class="correct_node">interface&nbsp;&rarr;&nbsp;intf&nbsp;</span>)</span>)</span>)</span></span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>interface</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans">cfgdesc</span>.interface</span>[<span id="ast-35"><span id="ast-36" class="other_trans">intf</span></span>]</span></span><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-38">(<span id="ast-39" class="other_trans">alt</span><span id="ast-40" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-41"><span id="ast-42" class="other_trans">interface</span>.num_altsetting</span>)</span>:<span id="ast-43"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-44"><span id="ast-45">IndexError</span>(<span id="ast-46">(<span id="ast-47">'Invalid&nbsp;alternate&nbsp;setting&nbsp;index&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-49"><span id="ast-50">str</span>(<span id="ast-51" class="other_trans">alt</span>)</span>)</span>)</span></span></span><span id="ast-52"><span id="ast-53" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>intf_desc</span>&nbsp;=&nbsp;<span id="ast-54"><span id="ast-55"><span id="ast-56" class="other_trans">interface</span>.altsetting</span>[<span id="ast-57"><span id="ast-58" class="other_trans">alt</span></span>]</span></span><span id="ast-59"><span id="ast-60"><span id="ast-61" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>intf_desc</span>.extra_descriptors</span>&nbsp;=&nbsp;<span id="ast-62"><span id="ast-63"><span id="ast-64">intf_desc</span>.extra</span>[<span id="ast-65">:<span id="ast-66"><span id="ast-67" class="other_trans">intf_desc</span>.extralen</span></span>]</span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-69" class="other_trans">intf_desc</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;resize(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">width</span>,&nbsp;<span id="ast-5" class="other_trans">height</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>image</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9">self</span>.image</span></span><span id="ast-10"><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-12" class="other_trans">old_w</span>,&nbsp;<span id="ast-13">old_h</span>)</span>&nbsp;=&nbsp;<span id="ast-14"><span id="ast-15" class="other_trans">image</span>.size</span></span><span id="ast-16"><span id="ast-17" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>keep_height</span>&nbsp;=&nbsp;<span id="ast-18">(<span id="ast-20">(<span id="ast-22">(<span id="ast-23" class="other_trans">old_w</span><span id="ast-24" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-25" class="other_trans">old_h</span>)</span>&nbsp;and&nbsp;<span id="ast-26">(<span id="ast-27">width</span><span id="ast-28" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-29" class="other_trans">height</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-30">(<span id="ast-32">(<span id="ast-33" class="other_trans">old_w</span><span id="ast-34" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-35" class="other_trans">old_h</span>)</span>&nbsp;and&nbsp;<span id="ast-36">(<span id="ast-37" class="other_trans">width</span><span id="ast-38" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-39" class="other_trans">height</span>)</span>)</span>)</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41" class="other_trans">keep_height</span>:<span id="ast-42"><span id="ast-43" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;=&nbsp;<span id="ast-44">(<span id="ast-45">(<span id="ast-46">(<span id="ast-47" class="other_trans">old_w</span>&nbsp;*&nbsp;<span id="ast-49">height</span>)</span>&nbsp;/&nbsp;<span id="ast-51" class="incorrect_node">old_h&nbsp;&rarr;&nbsp;width&nbsp;</span>)</span>,&nbsp;<span id="ast-52" class="other_trans">height</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-53"><span id="ast-54" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>size</span>&nbsp;=&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">width</span>,&nbsp;<span id="ast-57">(<span id="ast-58">(<span id="ast-59" class="other_trans">old_h</span>&nbsp;*&nbsp;<span id="ast-61">width</span>)</span>&nbsp;/&nbsp;<span id="ast-63" class="other_trans">old_w</span>)</span>)</span></span></span><span id="ast-64"><span id="ast-65" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>image</span>&nbsp;=&nbsp;<span id="ast-66"><span id="ast-67"><span id="ast-68" class="other_trans">image</span>.resize</span>(<span id="ast-69" class="other_trans">size</span>,&nbsp;<span id="ast-70"><span id="ast-71" class="other_trans">PILImage</span>.ANTIALIAS</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;send_request(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">query</span></span>):<span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-6">(<span id="ast-8"><span id="ast-9">self</span>.connection</span>&nbsp;and&nbsp;<span id="ast-10"><span id="ast-11">self</span>.cursor</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>rows</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17"><span id="ast-18">self</span>.cursor</span>.execute</span>(<span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">query</span>.strip</span>()</span>)</span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23" class="other_trans">rows</span>:<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cursor&nbsp;&rarr;&nbsp;self.&nbsp;</span>.fetchall</span>()</span></span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-29">True</span></span><span id="ast-30"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-31" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-32" class="other_trans">e</span>:<span id="ast-33"><span id="ast-34"><span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.error</span>(<span id="ast-37">(<span id="ast-38">'%s'</span>&nbsp;%&nbsp;<span id="ast-40" class="other_trans">e</span>)</span>)</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;admin_command(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">admin_command</span>,&nbsp;<span id="ast-5" class="other_trans">quiet</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>tries</span>&nbsp;=&nbsp;<span id="ast-9">0</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>status</span>&nbsp;=&nbsp;<span id="ast-12" class="other_trans">None</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-14">(<span id="ast-16">(<span id="ast-17">not</span>&nbsp;<span id="ast-18" class="other_trans">status</span>)</span>&nbsp;and&nbsp;<span id="ast-19">(<span id="ast-20" class="other_trans">tries</span><span id="ast-21" class="other_trans">&nbsp;&lt;&nbsp;</span><span id="ast-22"><span id="ast-23">self</span>.retries</span>)</span>)</span>:<span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-25"><span id="ast-26" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>status</span>&nbsp;=&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30"><span id="ast-31">self</span>._conn</span>[<span id="ast-32"><span id="ast-33">'admin'</span></span>]</span>.command</span>(<span id="ast-34" class="other_trans">admin_command</span>)</span></span><span id="ast-35"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-36">(<span id="ast-37">not</span>&nbsp;<span id="ast-38" class="other_trans">status</span>)</span>:<span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-40" class="incorrect_node">e&nbsp;&rarr;&nbsp;status&nbsp;</span></span></span><span id="ast-41"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-42" class="other_trans">Exception</span>&nbsp;as&nbsp;<span id="ast-43" class="other_trans">e</span>:<span id="ast-44"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-45">(<span id="ast-46">not</span>&nbsp;<span id="ast-47" class="other_trans">quiet</span>)</span>:<span id="ast-48"><span id="ast-49"><span id="ast-50"><span id="ast-51" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>logging</span>.error</span>(<span id="ast-52">(<span id="ast-53">"Error&nbsp;running&nbsp;admin&nbsp;command&nbsp;'%s':&nbsp;%s"</span>&nbsp;%&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">admin_command</span>,&nbsp;<span id="ast-57" class="other_trans">e</span>)</span>)</span>)</span></span></span><span id="ast-58"><span id="ast-59" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tries</span>&nbsp;+=&nbsp;<span id="ast-61">1</span></span><span id="ast-62"><span id="ast-63"><span id="ast-64" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sleep</span>(<span id="ast-65">1</span>)</span></span></span></span></span><span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-67">(<span id="ast-68">not</span>&nbsp;<span id="ast-69" class="other_trans">status</span>)</span>:<span id="ast-70"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-71" class="other_trans">Exception</span>,&nbsp;<span id="ast-72">(<span id="ast-73">"Could&nbsp;not&nbsp;get&nbsp;output&nbsp;from&nbsp;command:&nbsp;'%s'&nbsp;after&nbsp;%i&nbsp;retries!"</span>&nbsp;%&nbsp;<span id="ast-75">(<span id="ast-76" class="other_trans">admin_command</span>,&nbsp;<span id="ast-77" class="ref_node">retries&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span>,&nbsp;<span id="ast-78">None</span></span></span><span id="ast-79"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-80" class="other_trans">status</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;unpack_name(<span id="ast-2"><span id="ast-3" class="other_trans">buf</span>,&nbsp;<span id="ast-4" class="other_trans">off</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>&nbsp;=&nbsp;<span id="ast-7">[]</span></span><span id="ast-8"><span id="ast-9"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>name_length</span>&nbsp;=&nbsp;<span id="ast-10">0</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>saved_off</span>&nbsp;=&nbsp;<span id="ast-13">0</span></span><span id="ast-14"><span id="ast-15" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>start_off</span>&nbsp;=&nbsp;<span id="ast-16">off</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>while&nbsp;<span id="ast-18">True</span>:<span id="ast-19"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-20">(<span id="ast-21">off</span><span id="ast-22" class="ref_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-23"><span id="ast-24">len</span>(<span id="ast-25" class="other_trans">buf</span>)</span>)</span>:<span id="ast-26"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-27"><span id="ast-28"><span id="ast-29" class="other_trans">dpkt</span>.NeedData</span>()</span></span></span><span id="ast-30"><span id="ast-31" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>n</span>&nbsp;=&nbsp;<span id="ast-32"><span id="ast-33">ord</span>(<span id="ast-34"><span id="ast-35">buf</span>[<span id="ast-36"><span id="ast-37">off</span></span>]</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-39">(<span id="ast-40">n</span><span id="ast-41" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-42">0</span>)</span>:<span id="ast-43"><span id="ast-44" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>off</span>&nbsp;+=&nbsp;<span id="ast-46">1</span></span><span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-49">(<span id="ast-50">(<span id="ast-51" class="other_trans">n</span>&nbsp;&amp;&nbsp;<span id="ast-53">192</span>)</span><span id="ast-54" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-55">192</span>)</span>:<span id="ast-56"><span id="ast-57"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ptr</span>&nbsp;=&nbsp;<span id="ast-58">(<span id="ast-59"><span id="ast-60"><span id="ast-61"><span id="ast-62">struct</span>.unpack</span>(<span id="ast-63">'&gt;H'</span>,&nbsp;<span id="ast-64"><span id="ast-65" class="other_trans">buf</span>[<span id="ast-66"><span id="ast-67">off</span>:<span id="ast-68">(<span id="ast-69" class="other_trans">off</span>&nbsp;+&nbsp;<span id="ast-71">2</span>)</span></span>]</span>)</span>[<span id="ast-72"><span id="ast-73">0</span></span>]</span>&nbsp;&amp;&nbsp;<span id="ast-75">16383</span>)</span></span><span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77">(<span id="ast-78">ptr</span><span id="ast-79" class="incorrect_node">&nbsp;&gt;=&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-80" class="other_trans">start_off</span>)</span>:<span id="ast-81"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-82"><span id="ast-83"><span id="ast-84" class="other_trans">dpkt</span>.UnpackError</span>(<span id="ast-85">'Invalid&nbsp;label&nbsp;compression&nbsp;pointer'</span>)</span></span></span><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>off</span>&nbsp;+=&nbsp;<span id="ast-89">2</span></span><span id="ast-90"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-91">(<span id="ast-92">not</span>&nbsp;<span id="ast-93">saved_off</span>)</span>:<span id="ast-94"><span id="ast-95" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>saved_off</span>&nbsp;=&nbsp;<span id="ast-96" class="other_trans">off</span></span></span><span id="ast-97"><span id="ast-98" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>start_off</span>,&nbsp;<span id="ast-99" class="other_trans">off</span>&nbsp;=&nbsp;<span id="ast-100">ptr</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-102">(<span id="ast-103">(<span id="ast-104" class="other_trans">n</span>&nbsp;&amp;&nbsp;<span id="ast-106">192</span>)</span><span id="ast-107" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-108">0</span>)</span>:<span id="ast-109"><span id="ast-110"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>off</span>&nbsp;+=&nbsp;<span id="ast-112">1</span></span><span id="ast-113"><span id="ast-114"><span id="ast-115"><span id="ast-116"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>name</span>.append</span>(<span id="ast-117"><span id="ast-118" class="other_trans">buf</span>[<span id="ast-119"><span id="ast-120">off</span>:<span id="ast-121">(<span id="ast-122">off</span>&nbsp;+&nbsp;<span id="ast-124" class="other_trans">n</span>)</span></span>]</span>)</span></span><span id="ast-125"><span id="ast-126"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>name_length</span>&nbsp;+=&nbsp;<span id="ast-128">(<span id="ast-129" class="other_trans">n</span>&nbsp;+&nbsp;<span id="ast-131">1</span>)</span></span><span id="ast-132"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-133">(<span id="ast-134" class="other_trans">name_length</span><span id="ast-135" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-136">255</span>)</span>:<span id="ast-137"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-138"><span id="ast-139"><span id="ast-140" class="other_trans">dpkt</span>.UnpackError</span>(<span id="ast-141">'name&nbsp;longer&nbsp;than&nbsp;255&nbsp;bytes'</span>)</span></span></span><span id="ast-142"><span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>off</span>&nbsp;+=&nbsp;<span id="ast-145" class="other_trans">n</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-146"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-147"><span id="ast-148"><span id="ast-149" class="other_trans">dpkt</span>.UnpackError</span>(<span id="ast-150">(<span id="ast-151">'Invalid&nbsp;label&nbsp;length&nbsp;%02x'</span>&nbsp;%&nbsp;<span id="ast-153" class="other_trans">n</span>)</span>)</span></span></span></span><span id="ast-154"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-155">(<span id="ast-156">not</span>&nbsp;<span id="ast-157" class="other_trans">saved_off</span>)</span>:<span id="ast-158"><span id="ast-159" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>saved_off</span>&nbsp;=&nbsp;<span id="ast-160" class="other_trans">off</span></span></span><span id="ast-161"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-162">(<span id="ast-163"><span id="ast-164"><span id="ast-165">'.'</span>.join</span>(<span id="ast-166" class="other_trans">name</span>)</span>,&nbsp;<span id="ast-167" class="other_trans">saved_off</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;is_valid_vlan_id(<span id="ast-2"><span id="ast-3" class="other_trans">seg_id</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-6" class="other_trans">None</span></span><span id="ast-7"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>try:<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>int_seg_id</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11" class="other_trans">int</span>(<span id="ast-12" class="other_trans">seg_id</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>except&nbsp;<span id="ast-14" class="other_trans">ValueError</span>:<span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-17"><span id="ast-18" class="other_trans">_</span>(<span id="ast-19">'segmentation_id&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;integer'</span>)</span></span></span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-21">(<span id="ast-23">(<span id="ast-24" class="other_trans">int_seg_id</span><span id="ast-25" class="correct_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-26">0</span>)</span>&nbsp;or&nbsp;<span id="ast-27">(<span id="ast-28" class="other_trans">int_seg_id</span><span id="ast-29" class="other_trans">&nbsp;&gt;=&nbsp;</span><span id="ast-30">4095</span>)</span>)</span>:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>msg</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34" class="other_trans">_</span>(<span id="ast-35">'Segmentation&nbsp;id&nbsp;is&nbsp;out&nbsp;of&nbsp;range'</span>)</span></span></span><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-37" class="other_trans">msg</span>:<span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">exceptions</span>.InvalidInput</span>(error_message=<span id="ast-43" class="other_trans">msg</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;apply_subrs(<span id="ast-2"><span id="ast-3">top_dict</span>,&nbsp;<span id="ast-4">encoding</span>,&nbsp;<span id="ast-5">gsubrs</span>,&nbsp;<span id="ast-6" class="other_trans">lsubrs</span></span>):<span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>multi_font</span>&nbsp;=&nbsp;<span id="ast-9"><span id="ast-10">hasattr</span>(<span id="ast-11">top_dict</span>,&nbsp;<span id="ast-12">'FDArray'</span>)</span></span><span id="ast-13"><span id="ast-14" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>gbias</span>&nbsp;=&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">psCharStrings</span>.calcSubrBias</span>(<span id="ast-18" class="other_trans">gsubrs</span>)</span></span><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>lbias</span>&nbsp;=&nbsp;<span id="ast-21">[<span id="ast-22"><span id="ast-23"><span id="ast-24">psCharStrings</span>.calcSubrBias</span>(<span id="ast-25">subrs</span>)</span><span id="ast-26">&nbsp;for&nbsp;<span id="ast-27">subrs</span>&nbsp;in&nbsp;<span id="ast-28">lsubrs</span></span>]</span></span><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">multi_font</span>:<span id="ast-31"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-32" class="other_trans">g</span>&nbsp;in&nbsp;<span id="ast-33"><span id="ast-34">top_dict</span>.charset</span>:<span id="ast-35"><span id="ast-36"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-37" class="other_trans">charstring</span>,&nbsp;<span id="ast-38" class="other_trans">sel</span>)</span>&nbsp;=&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41"><span id="ast-42" class="other_trans">top_dict</span>.CharStrings</span>.getItemAndSelector</span>(<span id="ast-43">g</span>)</span></span><span id="ast-44"><span id="ast-45" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>enc</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47">encoding</span>[<span id="ast-48"><span id="ast-49">g</span></span>]</span></span><span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Compreffor</span>.collapse_hintmask</span>(<span id="ast-54"><span id="ast-55">charstring</span>.program</span>)</span></span><span id="ast-56"><span id="ast-57"><span id="ast-58"><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Compreffor</span>.update_program</span>(<span id="ast-60"><span id="ast-61" class="other_trans">charstring</span>.program</span>,&nbsp;<span id="ast-62" class="other_trans">enc</span>,&nbsp;<span id="ast-63">gbias</span>,&nbsp;<span id="ast-64" class="other_trans">lbias</span>,&nbsp;<span id="ast-65">sel</span>)</span></span><span id="ast-66"><span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Compreffor</span>.expand_hintmask</span>(<span id="ast-70"><span id="ast-71">charstring</span>.program</span>)</span></span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-73">fd</span>&nbsp;in&nbsp;<span id="ast-74"><span id="ast-75">top_dict</span>.FDArray</span>:<span id="ast-76"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-77">(<span id="ast-78">not</span>&nbsp;<span id="ast-79"><span id="ast-80">hasattr</span>(<span id="ast-81"><span id="ast-82">fd</span>.Private</span>,&nbsp;<span id="ast-83">'Subrs'</span>)</span>)</span>:<span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fd</span>.Private</span>.Subrs</span>&nbsp;=&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90">cffLib</span>.SubrsIndex</span>()</span></span></span></span><span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-92">(<span id="ast-93">subrs</span>,&nbsp;<span id="ast-94">subrs_index</span>)</span>&nbsp;in&nbsp;<span id="ast-95"><span id="ast-96" class="other_trans">zip</span>(<span id="ast-97"><span id="ast-98"><span id="ast-99" class="other_trans">itertools</span>.chain</span>(<span id="ast-100">[<span id="ast-101" class="other_trans">gsubrs</span>]</span>,&nbsp;<span id="ast-102">lsubrs</span>)</span>,&nbsp;<span id="ast-103"><span id="ast-104"><span id="ast-105">itertools</span>.chain</span>(<span id="ast-106">[<span id="ast-107"><span id="ast-108">top_dict</span>.GlobalSubrs</span>]</span>,&nbsp;<span id="ast-109">[<span id="ast-110"><span id="ast-111"><span id="ast-112" class="other_trans">fd</span>.Private</span>.Subrs</span><span id="ast-113">&nbsp;for&nbsp;<span id="ast-114">fd</span>&nbsp;in&nbsp;<span id="ast-115"><span id="ast-116">top_dict</span>.FDArray</span></span>]</span>)</span>)</span>:<span id="ast-117"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-118">subr</span>&nbsp;in&nbsp;<span id="ast-119" class="other_trans">subrs</span>:<span id="ast-120"><span id="ast-121" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;=&nbsp;<span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans">psCharStrings</span>.T2CharString</span>(program=<span id="ast-126"><span id="ast-127" class="other_trans">subr</span>._program</span>)</span></span><span id="ast-128"><span id="ast-129"><span id="ast-130"><span id="ast-131"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>subrs_index</span>.append</span>(<span id="ast-132" class="other_trans">item</span>)</span></span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-134">(<span id="ast-135">glyph</span>,&nbsp;<span id="ast-136" class="other_trans">enc</span>)</span>&nbsp;in&nbsp;<span id="ast-137"><span id="ast-138"><span id="ast-139">encoding</span>.iteritems</span>()</span>:<span id="ast-140"><span id="ast-141" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>charstring</span>&nbsp;=&nbsp;<span id="ast-142"><span id="ast-143"><span id="ast-144">top_dict</span>.CharStrings</span>[<span id="ast-145"><span id="ast-146">glyph</span></span>]</span></span><span id="ast-147"><span id="ast-148"><span id="ast-149"><span id="ast-150" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Compreffor</span>.collapse_hintmask</span>(<span id="ast-151"><span id="ast-152" class="other_trans">charstring</span>.program</span>)</span></span><span id="ast-153"><span id="ast-154"><span id="ast-155"><span id="ast-156"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Compreffor</span>.update_program</span>(<span id="ast-157"><span id="ast-158" class="other_trans">charstring</span>.program</span>,&nbsp;<span id="ast-159">enc</span>,&nbsp;<span id="ast-160">gbias</span>,&nbsp;<span id="ast-161" class="other_trans">lbias</span>,&nbsp;<span id="ast-162">0</span>)</span></span><span id="ast-163"><span id="ast-164"><span id="ast-165"><span id="ast-166"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Compreffor</span>.expand_hintmask</span>(<span id="ast-167"><span id="ast-168">charstring</span>.program</span>)</span></span></span><span id="ast-169"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>assert&nbsp;<span id="ast-170">(<span id="ast-171"><span id="ast-172">len</span>(<span id="ast-173" class="other_trans">lsubrs</span>)</span><span id="ast-174" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-175">1</span>)</span></span><span id="ast-176"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-177">(<span id="ast-178">not</span>&nbsp;<span id="ast-179"><span id="ast-180">hasattr</span>(<span id="ast-181"><span id="ast-182" class="other_trans">top_dict</span>.Private</span>,&nbsp;<span id="ast-183">'Subrs'</span>)</span>)</span>:<span id="ast-184"><span id="ast-185"><span id="ast-186"><span id="ast-187" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>fd&nbsp;&rarr;&nbsp;top_dict&nbsp;</span>.Private</span>.Subrs</span>&nbsp;=&nbsp;<span id="ast-188"><span id="ast-189"><span id="ast-190" class="other_trans">cffLib</span>.SubrsIndex</span>()</span></span></span><span id="ast-191"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-192" class="other_trans">subr</span>&nbsp;in&nbsp;<span id="ast-193"><span id="ast-194" class="other_trans">lsubrs</span>[<span id="ast-195"><span id="ast-196">0</span></span>]</span>:<span id="ast-197"><span id="ast-198"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>item</span>&nbsp;=&nbsp;<span id="ast-199"><span id="ast-200"><span id="ast-201">psCharStrings</span>.T2CharString</span>(program=<span id="ast-203"><span id="ast-204" class="other_trans">subr</span>._program</span>)</span></span><span id="ast-205"><span id="ast-206"><span id="ast-207"><span id="ast-208"><span id="ast-209"><span id="ast-210"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>top_dict</span>.Private</span>.Subrs</span>.append</span>(<span id="ast-211" class="other_trans">item</span>)</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;generate_features(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4">api</span>,&nbsp;<span id="ast-5">version</span>,&nbsp;<span id="ast-6">profile</span>,&nbsp;<span id="ast-7">features</span></span>):<span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>fpath</span>&nbsp;=&nbsp;<span id="ast-10"><span id="ast-11"><span id="ast-12"><span id="ast-13" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-14"><span id="ast-15">self</span>.path</span>,&nbsp;<span id="ast-16">'glad'</span>,&nbsp;<span id="ast-17">'glfuncs.d'</span>)</span></span><span id="ast-18"><span id="ast-19"><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>makefiledir</span>(<span id="ast-21" class="other_trans">fpath</span>)</span></span><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>epath</span>&nbsp;=&nbsp;<span id="ast-24"><span id="ast-25"><span id="ast-26"><span id="ast-27">os</span>.path</span>.join</span>(<span id="ast-28"><span id="ast-29">self</span>.path</span>,&nbsp;<span id="ast-30">'glad'</span>,&nbsp;<span id="ast-31">'glenums.d'</span>)</span></span><span id="ast-32"><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>makefiledir</span>(<span id="ast-35">epath</span>)</span></span><span id="ast-36"><span id="ast-37" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>removed</span>&nbsp;=&nbsp;<span id="ast-38"><span id="ast-39">set</span>()</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42">profile</span><span id="ast-43" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-44">'core'</span>)</span>:<span id="ast-45"><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>removed</span>&nbsp;=&nbsp;<span id="ast-47"><span id="ast-48">set</span>(<span id="ast-49"><span id="ast-50"><span id="ast-51">chain</span>.from_iterable</span>(<span id="ast-52">(<span id="ast-53"><span id="ast-54">feature</span>.remove</span><span id="ast-55">&nbsp;for&nbsp;<span id="ast-56">feature</span>&nbsp;in&nbsp;<span id="ast-57" class="other_trans">features</span></span>)</span>)</span>)</span></span></span><span id="ast-58"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-59"><span id="ast-60">open</span>(<span id="ast-61" class="other_trans">fpath</span>,&nbsp;<span id="ast-62">'w'</span>)</span>&nbsp;as&nbsp;<span id="ast-63">f</span>:<span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-65"><span id="ast-66" class="other_trans">open</span>(<span id="ast-67">epath</span>,&nbsp;<span id="ast-68">'w'</span>)</span>&nbsp;as&nbsp;<span id="ast-69" class="other_trans">e</span>:<span id="ast-70"><span id="ast-71"><span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-74">'module&nbsp;glad.glfuncs;\\u000a\\u000a\\u000a'</span>)</span></span><span id="ast-75"><span id="ast-76"><span id="ast-77"><span id="ast-78" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-79">'private&nbsp;import&nbsp;glad.gltypes;\\u000a\\u000a'</span>)</span></span><span id="ast-80"><span id="ast-81"><span id="ast-82"><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>.write</span>(<span id="ast-84">'module&nbsp;glad.glenums;\\u000a\\u000a\\u000a'</span>)</span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span id="ast-88" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>.write</span>(<span id="ast-89">'enum&nbsp;:&nbsp;ubyte&nbsp;{\\u000a\\u0009GL_FALSE&nbsp;=&nbsp;0,\\u000a\\u0009GL_TRUE&nbsp;=&nbsp;1\\u000a}\\u000a\\u000a'</span>)</span></span><span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>.write</span>(<span id="ast-94">'enum&nbsp;uint&nbsp;GL_INVALID_INDEX&nbsp;=&nbsp;0xFFFFFFFF;\\u000a'</span>)</span></span><span id="ast-95"><span id="ast-96"><span id="ast-97"><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>.write</span>(<span id="ast-99">'enum&nbsp;ulong&nbsp;GL_TIMEOUT_IGNORED&nbsp;=&nbsp;0xFFFFFFFFFFFFFFFF;\\u000a'</span>)</span></span><span id="ast-100"><span id="ast-101"><span id="ast-102"><span id="ast-103" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>.write</span>(<span id="ast-104">'enum&nbsp;ulong&nbsp;GL_TIMEOUT_IGNORED_APPLE&nbsp;=&nbsp;0xFFFFFFFFFFFFFFFF;\\u000a\\u000a'</span>)</span></span><span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>.write</span>(<span id="ast-109">'enum&nbsp;:&nbsp;uint&nbsp;{\\u000a'</span>)</span></span><span id="ast-110"><span id="ast-111" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>written</span>&nbsp;=&nbsp;<span id="ast-112"><span id="ast-113">set</span>()</span></span><span id="ast-114"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-115">feature</span>&nbsp;in&nbsp;<span id="ast-116">features</span>:<span id="ast-117"><span id="ast-118"><span id="ast-119" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>feature</span>.profile</span>&nbsp;=&nbsp;<span id="ast-120">'profile'</span></span><span id="ast-121"><span id="ast-122"><span id="ast-123"><span id="ast-124" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-125"><span id="ast-126"><span id="ast-127">'//&nbsp;{}\\u000a'</span>.format</span>(<span id="ast-128"><span id="ast-129" class="other_trans">feature</span>.name</span>)</span>)</span></span><span id="ast-130"><span id="ast-131"><span id="ast-132"><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-134"><span id="ast-135"><span id="ast-136">'bool&nbsp;{};\\u000a'</span>.format</span>(<span id="ast-137"><span id="ast-138" class="other_trans">feature</span>.name</span>)</span>)</span></span><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-140" class="other_trans">func</span>&nbsp;in&nbsp;<span id="ast-141"><span id="ast-142" class="other_trans">feature</span>.functions</span>:<span id="ast-143"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-144">(<span id="ast-145">not</span>&nbsp;<span id="ast-146">(<span id="ast-147" class="other_trans">func</span><span id="ast-148">&nbsp;in&nbsp;</span><span id="ast-149" class="other_trans">removed</span>)</span>)</span>:<span id="ast-150"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-151">(<span id="ast-152" class="other_trans">func</span><span id="ast-153">&nbsp;in&nbsp;</span><span id="ast-154" class="other_trans">written</span>)</span>:<span id="ast-155"><span id="ast-156"><span id="ast-157"><span id="ast-158" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f</span>.write</span>(<span id="ast-159">'//&nbsp;'</span>)</span></span></span><span id="ast-160"><span id="ast-161"><span id="ast-162" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>write_d_func</span>(<span id="ast-163">f</span>,&nbsp;<span id="ast-164" class="incorrect_node">func&nbsp;&rarr;&nbsp;enum&nbsp;</span>)</span></span><span id="ast-165"><span id="ast-166"><span id="ast-167"><span id="ast-168"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>written</span>.add</span>(<span id="ast-169">func</span>)</span></span></span></span><span id="ast-170"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-171">enum</span>&nbsp;in&nbsp;<span id="ast-172"><span id="ast-173" class="other_trans">feature</span>.enums</span>:<span id="ast-174"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-175">(<span id="ast-177">(<span id="ast-178"><span id="ast-179" class="other_trans">enum</span>.group</span><span id="ast-180" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-181">'SpecialNumbers'</span>)</span>&nbsp;or&nbsp;<span id="ast-182">(<span id="ast-183">enum</span><span id="ast-184">&nbsp;in&nbsp;</span><span id="ast-185">removed</span>)</span>)</span>:<span id="ast-186"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>continue</span></span><span id="ast-187"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-188">(<span id="ast-189" class="other_trans">enum</span><span id="ast-190">&nbsp;in&nbsp;</span><span id="ast-191" class="other_trans">written</span>)</span>:<span id="ast-192"><span id="ast-193"><span id="ast-194"><span id="ast-195" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>f&nbsp;&rarr;&nbsp;e&nbsp;</span>.write</span>(<span id="ast-196">'//&nbsp;'</span>)</span></span></span><span id="ast-197"><span id="ast-198"><span id="ast-199"><span id="ast-200"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>e</span>.write</span>(<span id="ast-201"><span id="ast-202"><span id="ast-203">'\\u0009{}&nbsp;=&nbsp;{},\\u000a'</span>.format</span>(<span id="ast-204"><span id="ast-205" class="other_trans">enum</span>.name</span>,&nbsp;<span id="ast-206"><span id="ast-207" class="other_trans">enum</span>.value</span>)</span>)</span></span><span id="ast-208"><span id="ast-209"><span id="ast-210"><span id="ast-211"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>written</span>.add</span>(<span id="ast-212">enum</span>)</span></span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__getattr__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">method</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>method</span>&nbsp;=&nbsp;<span id="ast-7">(<span id="ast-8">'%s.%s'</span>&nbsp;%&nbsp;<span id="ast-10">(<span id="ast-11"><span id="ast-12">self</span>.method</span>,&nbsp;<span id="ast-13" class="other_trans">method</span>)</span>)</span></span><span id="ast-14"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.__class__</span>(<span id="ast-18"><span id="ast-19">self</span>.url</span>,&nbsp;<span id="ast-20" class="other_trans">method</span>,&nbsp;<span id="ast-21" class="correct_node">auth&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;colored_time(<span id="ast-2"><span id="ast-3" class="other_trans">time_taken</span>,&nbsp;<span id="ast-4" class="other_trans">options</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'Get&nbsp;colored&nbsp;string&nbsp;for&nbsp;a&nbsp;given&nbsp;time&nbsp;taken.'</span></span><span id="ast-7"><span id="ast-8" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>time_taken_ms</span>&nbsp;=&nbsp;<span id="ast-9">(<span id="ast-10" class="other_trans">time_taken</span>&nbsp;*&nbsp;<span id="ast-12">1000</span>)</span></span><span id="ast-13"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-14">(<span id="ast-15" class="other_trans">time_taken_ms</span><span id="ast-16" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-17"><span id="ast-18" class="other_trans">options</span>.timer_ok</span>)</span>:<span id="ast-19"><span id="ast-20" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>color</span>&nbsp;=&nbsp;<span id="ast-21">'green'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-23">(<span id="ast-24" class="other_trans">time_taken_ms</span><span id="ast-25" class="incorrect_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-26"><span id="ast-27" class="other_trans">options</span>.timer_warning</span>)</span>:<span id="ast-28"><span id="ast-29" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>color</span>&nbsp;=&nbsp;<span id="ast-30">'yellow'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>color</span>&nbsp;=&nbsp;<span id="ast-33">'red'</span></span></span><span id="ast-34"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-35"><span id="ast-36"><span id="ast-37" class="other_trans">termcolor</span>.colored</span>(<span id="ast-38"><span id="ast-39"><span id="ast-40">'{0:0.4f}s'</span>.format</span>(<span id="ast-41" class="ref_node">time_taken_ms&nbsp;&rarr;&nbsp;time_taken&nbsp;</span>)</span>,&nbsp;<span id="ast-42" class="other_trans">color</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;debug_start(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">launch</span>,&nbsp;<span id="ast-5" class="other_trans">breakpoints</span>,&nbsp;<span id="ast-6" class="other_trans">on_complete</span></span>):<span id="ast-8"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-9"><span id="ast-10" class="ref_node">debug_kickoff&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-11" class="other_trans">breakpoints</span>,&nbsp;<span id="ast-12"><span id="ast-13" class="incorrect_node">bind&nbsp;&rarr;&nbsp;self.&nbsp;</span>(<span id="ast-14"><span id="ast-15">self</span>._debug_start</span>,&nbsp;<span id="ast-16"><span id="ast-17" class="other_trans">launch</span>.command_line</span>)</span>,&nbsp;<span id="ast-18" class="other_trans">on_complete</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;process_file(<span id="ast-2"><span id="ast-3" class="other_trans">raw_path</span>,&nbsp;<span id="ast-4" class="other_trans">file_name</span></span>):<span id="ast-5"><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>exe_path</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10">os</span>.path</span>.join</span>(<span id="ast-11">PE_DIR</span>,&nbsp;<span id="ast-12">(<span id="ast-13">'%s.exe'</span>&nbsp;%&nbsp;<span id="ast-15">(<span id="ast-16" class="other_trans">file_name</span>)</span>)</span>)</span></span><span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-18">'raw_file'</span>,&nbsp;<span id="ast-19" class="other_trans">raw_path</span></span><span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-21">'exe_path'</span>,&nbsp;<span id="ast-22" class="other_trans">exe_path</span></span><span id="ast-23"><span id="ast-24"><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>pe_extract</span>(<span id="ast-26">raw_path</span>,&nbsp;<span id="ast-27" class="other_trans">exe_path</span>)</span></span><span id="ast-28"><span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-30" class="other_trans">sha1</span>,&nbsp;<span id="ast-31">md5</span>,&nbsp;<span id="ast-32">file_size</span>)</span>&nbsp;=&nbsp;<span id="ast-33"><span id="ast-34">get_file_hashes</span>(<span id="ast-35">exe_path</span>)</span></span><span id="ast-36"><span id="ast-37"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-38" class="other_trans">dump_id</span>,&nbsp;<span id="ast-39">corrupt_pe</span>)</span>&nbsp;=&nbsp;<span id="ast-40"><span id="ast-41" class="other_trans">db_pe_dumps</span>(<span id="ast-42">raw_path</span>,&nbsp;<span id="ast-43" class="other_trans">sha1</span>,&nbsp;<span id="ast-44" class="other_trans">md5</span>,&nbsp;<span id="ast-45">file_size</span>)</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48">not</span>&nbsp;<span id="ast-49">corrupt_pe</span>)</span>:<span id="ast-50"><span id="ast-51"><span id="ast-52"><span id="ast-53"><span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Process</span>(target=<span id="ast-56">process_timeout</span>,&nbsp;args=<span id="ast-58">(<span id="ast-59">db_virus_total</span>,&nbsp;<span id="ast-60">(<span id="ast-61" class="other_trans">dump_id</span>)</span>,&nbsp;<span id="ast-62">VT_TIMEOUT</span>)</span>)</span>.start</span>()</span></span></span><span id="ast-63"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-64">(<span id="ast-65">vts_config</span><span id="ast-66" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-67">'manual'</span>)</span>:<span id="ast-68"><span id="ast-69"><span id="ast-70"><span id="ast-71"><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Process</span>(target=<span id="ast-74">process_timeout</span>,&nbsp;args=<span id="ast-76">(<span id="ast-77">manual_download</span>,&nbsp;<span id="ast-78">(<span id="ast-79" class="ref_node">dump_id&nbsp;&rarr;&nbsp;sha1&nbsp;</span>)</span>,&nbsp;<span id="ast-80">MD_TIMEOUT</span>)</span>)</span>.start</span>()</span></span></span><span id="ast-81"><span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>ip2asn</span>(<span id="ast-84">dump_id</span>)</span></span><span id="ast-85"><span id="ast-86"><span id="ast-87"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>get_feature_vector</span>(<span id="ast-88" class="other_trans">dump_id</span>)</span></span><span id="ast-89"><span id="ast-90"><span id="ast-91" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>classify_dump</span>(<span id="ast-92" class="other_trans">dump_id</span>)</span></span><span id="ast-93"><span id="ast-94"><span id="ast-95"><span id="ast-96"><span id="ast-97"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>Process</span>(target=<span id="ast-99">db_syslog</span>,&nbsp;args=<span id="ast-101">(<span id="ast-102" class="other_trans">dump_id</span>)</span>)</span>.start</span>()</span></span><span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>sha1_path</span>&nbsp;=&nbsp;<span id="ast-105"><span id="ast-106"><span id="ast-107"><span id="ast-108" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-109" class="other_trans">PE_DIR</span>,&nbsp;<span id="ast-110">(<span id="ast-111">'%s.exe'</span>&nbsp;%&nbsp;<span id="ast-113">(<span id="ast-114">sha1</span>)</span>)</span>)</span></span><span id="ast-115"><span id="ast-116" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>md5_path</span>&nbsp;=&nbsp;<span id="ast-117"><span id="ast-118"><span id="ast-119"><span id="ast-120" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-121" class="other_trans">PE_DIR</span>,&nbsp;<span id="ast-122">(<span id="ast-123">'%s.exe'</span>&nbsp;%&nbsp;<span id="ast-125">(<span id="ast-126">md5</span>)</span>)</span>)</span></span><span id="ast-127"><span id="ast-128"><span id="ast-129"><span id="ast-130" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>shutil</span>.move</span>(<span id="ast-131" class="other_trans">exe_path</span>,&nbsp;<span id="ast-132" class="incorrect_node">sha1_path&nbsp;&rarr;&nbsp;md5_path&nbsp;</span>)</span></span><span id="ast-133"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-134">'sha1_path'</span>,&nbsp;<span id="ast-135">sha1_path</span></span><span id="ast-136"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-137">'md5_path'</span>,&nbsp;<span id="ast-138">md5_path</span></span><span id="ast-139"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-140">(<span id="ast-141">not</span>&nbsp;<span id="ast-142"><span id="ast-143"><span id="ast-144"><span id="ast-145">os</span>.path</span>.exists</span>(<span id="ast-146" class="other_trans">md5_path</span>)</span>)</span>:<span id="ast-147"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-148">'os.path.exists(md5_path)'</span>,&nbsp;<span id="ast-149"><span id="ast-150"><span id="ast-151"><span id="ast-152">os</span>.path</span>.exists</span>(<span id="ast-153" class="other_trans">md5_path</span>)</span></span><span id="ast-154"><span id="ast-155"><span id="ast-156"><span id="ast-157"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.symlink</span>(<span id="ast-158">(<span id="ast-159">'%s.exe'</span>&nbsp;%&nbsp;<span id="ast-161">(<span id="ast-162">sha1</span>)</span>)</span>,&nbsp;<span id="ast-163" class="other_trans">md5_path</span>)</span></span></span><span id="ast-164"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-165">(<span id="ast-166">'Done&nbsp;processing&nbsp;file:&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-168">(<span id="ast-169" class="other_trans">raw_path</span>)</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;in_cache(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>(<span id="ast-6" class="other_trans">first</span>,&nbsp;<span id="ast-7" class="other_trans">last</span>)</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11">self</span>.paginator</span>.cached_page_indices</span>()</span></span><span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-13">(<span id="ast-14" class="other_trans">first</span><span id="ast-15" class="other_trans">&nbsp;&lt;=&nbsp;</span><span id="ast-17"><span id="ast-18">self</span>.number</span><span id="ast-16" class="correct_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-19" class="other_trans">last</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;transform_fragment(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">i</span>,&nbsp;<span id="ast-5" class="other_trans">f</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9">self</span>.clock_domains</span><span id="ast-10" class="incorrect_node">&nbsp;is&nbsp;&nbsp;&rarr;&nbsp;is&nbsp;not&nbsp;</span><span id="ast-11" class="other_trans">None</span>)</span>:<span id="ast-12"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-13">(<span id="ast-14"><span id="ast-15">len</span>(<span id="ast-16"><span id="ast-17" class="other_trans">f</span>.sync</span>)</span><span id="ast-18" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-19">1</span>)</span>:<span id="ast-20"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-21"><span id="ast-22" class="other_trans">ValueError</span>(<span id="ast-23">'Control&nbsp;signal&nbsp;clock&nbsp;domains&nbsp;must&nbsp;be&nbsp;specified&nbsp;when&nbsp;module&nbsp;has&nbsp;more&nbsp;than&nbsp;one&nbsp;domain'</span>)</span></span></span><span id="ast-24"><span id="ast-25" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>cdn</span>&nbsp;=&nbsp;<span id="ast-26"><span id="ast-27"><span id="ast-28" class="other_trans">list</span>(<span id="ast-29"><span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans">f</span>.sync</span>.keys</span>()</span>)</span>[<span id="ast-33"><span id="ast-34">0</span></span>]</span></span><span id="ast-35"><span id="ast-36" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>to_insert</span>&nbsp;=&nbsp;<span id="ast-37">[<span id="ast-38">(<span id="ast-39"><span id="ast-40" class="other_trans">getattr</span>(<span id="ast-41" class="other_trans">i</span>,&nbsp;<span id="ast-42"><span id="ast-43">self</span>.control_name</span>)</span>,&nbsp;<span id="ast-44" class="other_trans">cdn</span>)</span>]</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-45"><span id="ast-46" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>to_insert</span>&nbsp;=&nbsp;<span id="ast-47">[<span id="ast-48">(<span id="ast-49"><span id="ast-50" class="other_trans">getattr</span>(<span id="ast-51" class="other_trans">i</span>,&nbsp;<span id="ast-52">(<span id="ast-53">(<span id="ast-54"><span id="ast-55">self</span>.control_name</span>&nbsp;+&nbsp;<span id="ast-57">'_'</span>)</span>&nbsp;+&nbsp;<span id="ast-59" class="other_trans">cdn</span>)</span>)</span>,&nbsp;<span id="ast-60" class="other_trans">cdn</span>)</span><span id="ast-61">&nbsp;for&nbsp;<span id="ast-62" class="other_trans">cdn</span>&nbsp;in&nbsp;<span id="ast-63" class="ref_node">clock_domains&nbsp;&rarr;&nbsp;self.&nbsp;</span></span>]</span></span></span><span id="ast-64"><span id="ast-65"><span id="ast-66"><span id="ast-67"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.transform_fragment_insert</span>(<span id="ast-68" class="other_trans">i</span>,&nbsp;<span id="ast-69" class="other_trans">f</span>,&nbsp;<span id="ast-70" class="other_trans">to_insert</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;update_current(<span id="ast-2"><span id="ast-3" class="other_trans">cls</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Set&nbsp;next&nbsp;theme\\u000a&nbsp;&nbsp;&nbsp;&nbsp;'</span></span><span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8"><span id="ast-9" class="other_trans">cls</span>.next_change</span><span id="ast-10" class="other_trans">&nbsp;is&nbsp;not&nbsp;</span><span id="ast-11">None</span>)</span>:<span id="ast-12"><span id="ast-13" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>closest</span>&nbsp;=&nbsp;<span id="ast-14" class="other_trans">None</span></span><span id="ast-15"><span id="ast-16" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>greatest</span>&nbsp;=&nbsp;<span id="ast-17">None</span></span><span id="ast-18"><span id="ast-19" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>seconds</span>&nbsp;=&nbsp;<span id="ast-20"><span id="ast-21"><span id="ast-22">get_current_time</span>()</span>[<span id="ast-23"><span id="ast-24">0</span></span>]</span></span><span id="ast-25"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-26" class="other_trans">t</span>&nbsp;in&nbsp;<span id="ast-27"><span id="ast-28" class="other_trans">cls</span>.themes</span>:<span id="ast-29"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-30">(<span id="ast-32">(<span id="ast-33"><span id="ast-34" class="other_trans">t</span>.time</span><span id="ast-35" class="ref_node">&nbsp;&lt;&nbsp;&nbsp;&rarr;&nbsp;<=&nbsp;</span><span id="ast-36" class="other_trans">seconds</span>)</span>&nbsp;and&nbsp;<span id="ast-37">(<span id="ast-39">(<span id="ast-40" class="other_trans">closest</span><span id="ast-41" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-42" class="other_trans">None</span>)</span>&nbsp;or&nbsp;<span id="ast-43">(<span id="ast-44"><span id="ast-45" class="other_trans">t</span>.time</span><span id="ast-46" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-47"><span id="ast-48" class="other_trans">closest</span>.time</span>)</span>)</span>)</span>:<span id="ast-49"><span id="ast-50" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>closest</span>&nbsp;=&nbsp;<span id="ast-51" class="other_trans">t</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-53">(<span id="ast-55">(<span id="ast-56" class="other_trans">greatest</span><span id="ast-57" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-58" class="other_trans">None</span>)</span>&nbsp;or&nbsp;<span id="ast-59">(<span id="ast-60"><span id="ast-61" class="other_trans">t</span>.time</span><span id="ast-62" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-63"><span id="ast-64" class="incorrect_node">greatest&nbsp;&rarr;&nbsp;cls&nbsp;</span>.time</span>)</span>)</span>:<span id="ast-65"><span id="ast-66" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>greatest</span>&nbsp;=&nbsp;<span id="ast-67" class="other_trans">t</span></span></span></span><span id="ast-68"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-69">(<span id="ast-70" class="other_trans">closest</span><span id="ast-71" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-72">None</span>)</span>:<span id="ast-73"><span id="ast-74" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>closest</span>&nbsp;=&nbsp;<span id="ast-75"><span id="ast-80"><span id="ast-81" class="other_trans">cls</span>.next_change</span>&nbsp;if&nbsp;<span id="ast-76">(<span id="ast-77" class="other_trans">greatest</span><span id="ast-78" class="other_trans">&nbsp;is&nbsp;</span><span id="ast-79" class="other_trans">None</span>)</span>&nbsp;else&nbsp;<span id="ast-82" class="other_trans">greatest</span></span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_setup_service(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">env_value</span></span>):<span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>path</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10"><span id="ast-11" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-12"><span id="ast-13" class="other_trans">env</span>.git_working_dir</span>,&nbsp;<span id="ast-14">'deploy'</span>,&nbsp;<span id="ast-15">'gunicorn'</span>,&nbsp;<span id="ast-16">(<span id="ast-17">'%s.xml'</span>&nbsp;%&nbsp;<span id="ast-19"><span id="ast-20">self</span>.gunicorn_name</span>)</span>)</span></span><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>run</span>(<span id="ast-24">(<span id="ast-25">'svccfg&nbsp;import&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-27" class="other_trans">path</span>)</span>)</span></span><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-29" class="other_trans">env_value</span>:<span id="ast-30"><span id="ast-31"><span id="ast-32" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>run</span>(<span id="ast-33">(<span id="ast-34">'svccfg&nbsp;-s&nbsp;%s&nbsp;setenv&nbsp;%s&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-36">(<span id="ast-37" class="correct_node">gunicorn_name&nbsp;&rarr;&nbsp;self.&nbsp;</span>,&nbsp;<span id="ast-38"><span id="ast-39" class="other_trans">env</span>.project_env_var</span>,&nbsp;<span id="ast-40" class="other_trans">env_value</span>)</span>)</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;latest_episode(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>'returns&nbsp;the&nbsp;latest&nbsp;episode&nbsp;that&nbsp;has&nbsp;aired&nbsp;already'</span></span><span id="ast-6"><span id="ast-7" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>today</span>&nbsp;=&nbsp;<span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">date</span>.today</span>()</span></span><span id="ast-11"><span id="ast-12" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>eps</span>&nbsp;=&nbsp;<span id="ast-13"><span id="ast-14"><span id="ast-15"><span id="ast-16"><span id="ast-17">self</span>.season</span>(<span id="ast-18"><span id="ast-19">self</span>.seasons</span>)</span>.values</span>()</span></span><span id="ast-20"><span id="ast-21"><span id="ast-22"><span id="ast-23" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>eps</span>.reverse</span>()</span></span><span id="ast-24"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-25" class="other_trans">e</span>&nbsp;in&nbsp;<span id="ast-26" class="other_trans">eps</span>:<span id="ast-27"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-28">(<span id="ast-30">(<span id="ast-31"><span id="ast-32" class="other_trans">e</span>.airdate</span><span id="ast-33" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-34" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-35">(<span id="ast-36"><span id="ast-37" class="other_trans">e</span>.airdate</span><span id="ast-38" class="location_node">&nbsp;&lt;=&nbsp;&nbsp;&rarr;&nbsp;<,&nbsp;pred:&nbsp;!=&nbsp;</span><span id="ast-39" class="other_trans">today</span>)</span>)</span>:<span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-41" class="other_trans">e</span></span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;_multi_calendar_select_callback(<span id="ast-2"><span id="ast-3" class="other_trans">ctx</span>,&nbsp;<span id="ast-4" class="other_trans">option</span>,&nbsp;<span id="ast-5" class="other_trans">calendars</span></span>):<span id="ast-6"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-7">(<span id="ast-8">not</span>&nbsp;<span id="ast-9" class="other_trans">calendars</span>)</span>:<span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>return</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-13">'calendar_selection'</span><span id="ast-14">&nbsp;in&nbsp;</span><span id="ast-15"><span id="ast-16" class="other_trans">ctx</span>.obj</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-18"><span id="ast-19"><span id="ast-20" class="other_trans">click</span>.UsageError</span>(<span id="ast-21">"Can't&nbsp;use&nbsp;both&nbsp;-a&nbsp;and&nbsp;-d."</span>)</span></span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23">(<span id="ast-24">not</span>&nbsp;<span id="ast-25"><span id="ast-26">isinstance</span>(<span id="ast-27" class="other_trans">calendars</span>,&nbsp;<span id="ast-28">tuple</span>)</span>)</span>:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>calendars</span>&nbsp;=&nbsp;<span id="ast-31">(<span id="ast-32" class="other_trans">calendars</span>)</span></span></span><span id="ast-33"><span id="ast-34" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>mode</span>&nbsp;=&nbsp;<span id="ast-35"><span id="ast-36" class="other_trans">option</span>.name</span></span><span id="ast-37"><span id="ast-38" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>selection</span>,&nbsp;<span id="ast-39"><span id="ast-40"><span id="ast-41" class="other_trans">ctx</span>.obj</span>[<span id="ast-42"><span id="ast-43">'calendar_selection'</span></span>]</span>&nbsp;=&nbsp;<span id="ast-44"><span id="ast-45">set</span>()</span></span><span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-47">(<span id="ast-48" class="other_trans">mode</span><span id="ast-49" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-50">'include_calendar'</span>)</span>:<span id="ast-51"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-52" class="other_trans">cal_name</span>&nbsp;in&nbsp;<span id="ast-53">calendars</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-55">(<span id="ast-56" class="other_trans">cal_name</span><span id="ast-57">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-58"><span id="ast-59"><span id="ast-60"><span id="ast-61">ctx</span>.obj</span>[<span id="ast-62"><span id="ast-63">'conf'</span></span>]</span>[<span id="ast-64"><span id="ast-65">'calendars'</span></span>]</span>)</span>:<span id="ast-66"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-67"><span id="ast-68"><span id="ast-69" class="other_trans">click</span>.BadParameter</span>(<span id="ast-70"><span id="ast-71"><span id="ast-72">'Unknown&nbsp;calendar&nbsp;{},&nbsp;run&nbsp;`khal&nbsp;printcalendars`&nbsp;to&nbsp;get&nbsp;a&nbsp;list&nbsp;of&nbsp;all&nbsp;configured&nbsp;calendars.'</span>.format</span>(<span id="ast-73">cal_name</span>)</span>)</span></span></span></span><span id="ast-74"><span id="ast-75"><span id="ast-76"><span id="ast-77" class="incorrect_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selection&nbsp;&rarr;&nbsp;ctx&nbsp;</span>.update</span>(<span id="ast-78" class="other_trans">calendars</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-80">(<span id="ast-81" class="other_trans">mode</span><span id="ast-82" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-83">'exclude_calendar'</span>)</span>:<span id="ast-84"><span id="ast-85"><span id="ast-86"><span id="ast-87" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>selection</span>.update</span>(<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91"><span id="ast-92"><span id="ast-93" class="other_trans">ctx</span>.obj</span>[<span id="ast-94"><span id="ast-95">'conf'</span></span>]</span>[<span id="ast-96"><span id="ast-97">'calendars'</span></span>]</span>.keys</span>()</span>)</span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-99" class="other_trans">value</span>&nbsp;in&nbsp;<span id="ast-100">calendars</span>:<span id="ast-101"><span id="ast-102"><span id="ast-103"><span id="ast-104" class="ref_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>calendars&nbsp;&rarr;&nbsp;selection&nbsp;</span>.remove</span>(<span id="ast-105" class="other_trans">value</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-106"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-107"><span id="ast-108" class="other_trans">ValueError</span>(<span id="ast-109" class="other_trans">mode</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;icon(<span id="ast-2"><span id="ast-3">self</span></span>):<span id="ast-4"><span id="ast-5" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>now</span>&nbsp;=&nbsp;<span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9"><span id="ast-10" class="other_trans">datetime</span>.now</span>()</span>.time</span>()</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12">(<span id="ast-14">(<span id="ast-15" class="other_trans">now</span><span id="ast-16" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;<&nbsp;</span><span id="ast-17"><span id="ast-18" class="other_trans">time</span>(<span id="ast-19">7</span>)</span>)</span>&nbsp;or&nbsp;<span id="ast-20">(<span id="ast-21" class="other_trans">now</span><span id="ast-22" class="other_trans">&nbsp;&gt;&nbsp;</span><span id="ast-23"><span id="ast-24" class="other_trans">time</span>(<span id="ast-25">21</span>)</span>)</span>)</span>:<span id="ast-26"><span id="ast-27" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>night</span>&nbsp;=&nbsp;<span id="ast-28">'_night'</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>night</span>&nbsp;=&nbsp;<span id="ast-31">''</span></span></span><span id="ast-32"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>return&nbsp;<span id="ast-33">(<span id="ast-34"><span id="ast-35"><span id="ast-36" class="other_trans">OUTLOOK_TO_ICON</span>.get</span>(<span id="ast-37"><span id="ast-38">self</span>.outlook</span>,&nbsp;<span id="ast-39">'dunno'</span>)</span>&nbsp;%&nbsp;<span id="ast-41">{<span id="ast-42">'night'</span>:&nbsp;<span id="ast-43" class="other_trans">night</span>}</span>)</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;__init__(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">params</span></span>):<span id="ast-5"><span id="ast-6"><span id="ast-7"><span id="ast-8"><span id="ast-9" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>super</span>()</span>.__init__</span>(<span id="ast-10" class="other_trans">params</span>)</span></span><span id="ast-11"><span id="ast-12" class="correct_node"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>module_name&nbsp;&rarr;&nbsp;self.&nbsp;</span>&nbsp;=&nbsp;<span id="ast-13">'axi_adder'</span></span><span id="ast-14"><span id="ast-15"><span id="ast-16"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.simple_filenames</span>&nbsp;=&nbsp;<span id="ast-17">[<span id="ast-18"><span id="ast-19"><span id="ast-20"><span id="ast-21" class="other_trans">os</span>.path</span>.join</span>(<span id="ast-22"><span id="ast-23" class="other_trans">config</span>.hdldir</span>,&nbsp;<span id="ast-24">'test'</span>,&nbsp;<span id="ast-25">'axi_adder.vhd'</span>)</span>]</span></span><span id="ast-26"><span id="ast-27"><span id="ast-28"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>self</span>.packages</span>&nbsp;=&nbsp;<span id="ast-29">[<span id="ast-30">'axi_utils'</span>]</span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;main(<span id="ast-2"><span id="ast-3" class="other_trans">num_epochs</span></span>):<span id="ast-5"><span id="ast-6" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>dataset</span>&nbsp;=&nbsp;<span id="ast-7"><span id="ast-8" class="other_trans">load_data</span>(<span id="ast-9">'mnist.pkl.gz'</span>)</span></span><span id="ast-10"><span id="ast-11" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>output_layer</span>&nbsp;=&nbsp;<span id="ast-12"><span id="ast-13" class="other_trans">build_model</span>(input_width=<span id="ast-15"><span id="ast-16" class="other_trans">dataset</span>[<span id="ast-17"><span id="ast-18">'input_width'</span></span>]</span>,&nbsp;input_height=<span id="ast-20"><span id="ast-21" class="other_trans">dataset</span>[<span id="ast-22"><span id="ast-23">'input_width'</span></span>]</span>,&nbsp;output_dim=<span id="ast-25"><span id="ast-26" class="other_trans">dataset</span>[<span id="ast-27"><span id="ast-28">'output_dim'</span></span>]</span>)</span></span><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>iter_funcs</span>&nbsp;=&nbsp;<span id="ast-31"><span id="ast-32" class="other_trans">create_iter_functions</span>(<span id="ast-33" class="other_trans">dataset</span>,&nbsp;<span id="ast-34" class="other_trans">output_layer</span>,&nbsp;X_tensor_type=<span id="ast-36"><span id="ast-37">T</span>.tensor4</span>)</span></span><span id="ast-38"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-39">'Starting&nbsp;training...'</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-41" class="other_trans">epoch</span>&nbsp;in&nbsp;<span id="ast-42"><span id="ast-43" class="other_trans">train</span>(<span id="ast-44" class="other_trans">iter_funcs</span>,&nbsp;<span id="ast-45" class="other_trans">dataset</span>)</span>:<span id="ast-46"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-47">(<span id="ast-48">'Epoch&nbsp;%d&nbsp;of&nbsp;%d'</span>&nbsp;%&nbsp;<span id="ast-50">(<span id="ast-51"><span id="ast-52" class="other_trans">epoch</span>[<span id="ast-53"><span id="ast-54">'number'</span></span>]</span>,&nbsp;<span id="ast-55" class="other_trans">num_epochs</span>)</span>)</span></span><span id="ast-56"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-57">(<span id="ast-58">'&nbsp;&nbsp;training&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-60"><span id="ast-61" class="other_trans">epoch</span>[<span id="ast-62"><span id="ast-63">'train_loss'</span></span>]</span>)</span></span><span id="ast-64"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-65">(<span id="ast-66">'&nbsp;&nbsp;validation&nbsp;loss:\\u0009\\u0009%.6f'</span>&nbsp;%&nbsp;<span id="ast-68"><span id="ast-69" class="other_trans">epoch</span>[<span id="ast-70"><span id="ast-71">'valid_loss'</span></span>]</span>)</span></span><span id="ast-72"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>print&nbsp;<span id="ast-73">(<span id="ast-74">'&nbsp;&nbsp;validation&nbsp;accuracy:\\u0009\\u0009%.2f&nbsp;%%'</span>&nbsp;%&nbsp;<span id="ast-76">(<span id="ast-77"><span id="ast-78" class="other_trans">epoch</span>[<span id="ast-79"><span id="ast-80">'valid_accuracy'</span></span>]</span>&nbsp;*&nbsp;<span id="ast-82">100</span>)</span>)</span></span><span id="ast-83"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-84">(<span id="ast-85"><span id="ast-86" class="other_trans">epoch</span>[<span id="ast-87"><span id="ast-88">'number'</span></span>]</span><span id="ast-89" class="correct_node">&nbsp;&gt;&nbsp;&nbsp;&rarr;&nbsp;>=&nbsp;</span><span id="ast-90" class="other_trans">num_epochs</span>)</span>:<span id="ast-91"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>break</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;create_asg(<span id="ast-2"><span id="ast-3">self</span>,&nbsp;<span id="ast-4" class="other_trans">layer_name</span>,&nbsp;<span id="ast-5" class="other_trans">instance_profile</span>,&nbsp;<span id="ast-6">instance_type</span>,&nbsp;<span id="ast-8">ami_name</span>,&nbsp;<span id="ast-10" class="other_trans">ec2_key</span>,&nbsp;<span id="ast-12" class="other_trans">user_data</span>,&nbsp;<span id="ast-14" class="other_trans">default_instance_type</span>,&nbsp;<span id="ast-16">security_groups</span>,&nbsp;<span id="ast-18" class="other_trans">min_size</span>,&nbsp;<span id="ast-20" class="other_trans">max_size</span>,&nbsp;<span id="ast-22">root_volume_size</span>,&nbsp;<span id="ast-24">include_ephemerals</span>,&nbsp;<span id="ast-26">number_ephemeral_vols</span>,&nbsp;<span id="ast-28">ebs_data_volumes</span>,&nbsp;<span id="ast-30" class="other_trans">custom_tags</span>,&nbsp;<span id="ast-32">load_balancer</span>,&nbsp;<span id="ast-34">instance_monitoring</span>,&nbsp;<span id="ast-36" class="other_trans">subnet_type</span></span>):<span id="ast-38"><span id="ast-39"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Wrapper&nbsp;method&nbsp;used&nbsp;to&nbsp;create&nbsp;an&nbsp;EC2&nbsp;Launch&nbsp;Configuration&nbsp;and&nbsp;Auto&nbsp;Scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;layer_name&nbsp;[string]&nbsp;friendly&nbsp;name&nbsp;of&nbsp;the&nbsp;set&nbsp;of&nbsp;instances&nbsp;being&nbsp;created&nbsp;-&nbsp;will&nbsp;be&nbsp;set&nbsp;as&nbsp;the&nbsp;name&nbsp;for&nbsp;instances&nbsp;deployed\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;instance_profile&nbsp;[Troposphere.iam.InstanceProfile]&nbsp;IAM&nbsp;Instance&nbsp;Profile&nbsp;object&nbsp;to&nbsp;be&nbsp;applied&nbsp;to&nbsp;instances&nbsp;launched&nbsp;within&nbsp;this&nbsp;Auto&nbsp;Scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;instance_type&nbsp;[Troposphere.Parameter&nbsp;|&nbsp;string]&nbsp;Reference&nbsp;to&nbsp;the&nbsp;AWS&nbsp;EC2&nbsp;Instance&nbsp;Type&nbsp;to&nbsp;deploy.&nbsp;&nbsp;\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;ami_name&nbsp;[string]&nbsp;Name&nbsp;of&nbsp;the&nbsp;AMI&nbsp;to&nbsp;deploy&nbsp;as&nbsp;defined&nbsp;within&nbsp;the&nbsp;RegionMap&nbsp;lookup&nbsp;for&nbsp;the&nbsp;deployed&nbsp;region\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;ec2_key&nbsp;[Troposphere.Parameter&nbsp;|&nbsp;Troposphere.Ref(Troposphere.Parameter)]&nbsp;Input&nbsp;parameter&nbsp;used&nbsp;to&nbsp;gather&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;EC2&nbsp;key&nbsp;to&nbsp;use&nbsp;to&nbsp;secure&nbsp;access&nbsp;to&nbsp;instances&nbsp;launched&nbsp;within&nbsp;this&nbsp;Auto&nbsp;Scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;user_data&nbsp;[string[]]&nbsp;Array&nbsp;of&nbsp;strings&nbsp;(lines&nbsp;of&nbsp;bash&nbsp;script)&nbsp;to&nbsp;be&nbsp;set&nbsp;as&nbsp;the&nbsp;user&nbsp;data&nbsp;as&nbsp;a&nbsp;bootstrap&nbsp;script&nbsp;for&nbsp;instances&nbsp;launched&nbsp;within&nbsp;this&nbsp;Auto&nbsp;Scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;default_instance_type&nbsp;[string&nbsp;-&nbsp;AWS&nbsp;Instance&nbsp;Type]&nbsp;AWS&nbsp;instance&nbsp;type&nbsp;to&nbsp;set&nbsp;as&nbsp;the&nbsp;default&nbsp;for&nbsp;the&nbsp;input&nbsp;parameter&nbsp;defining&nbsp;the&nbsp;instance&nbsp;type&nbsp;for&nbsp;this&nbsp;layer_name\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;security_groups&nbsp;[Troposphere.ec2.SecurityGroup[]]&nbsp;array&nbsp;of&nbsp;security&nbsp;groups&nbsp;to&nbsp;be&nbsp;applied&nbsp;to&nbsp;instances&nbsp;within&nbsp;this&nbsp;Auto&nbsp;Scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;min_size&nbsp;[int]&nbsp;value&nbsp;to&nbsp;set&nbsp;as&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;instances&nbsp;for&nbsp;the&nbsp;Auto&nbsp;Scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;max_size&nbsp;[int]&nbsp;value&nbsp;to&nbsp;set&nbsp;as&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;instances&nbsp;for&nbsp;the&nbsp;Auto&nbsp;Scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;root_volume_size&nbsp;[int]&nbsp;size&nbsp;(in&nbsp;GiB)&nbsp;to&nbsp;assign&nbsp;to&nbsp;the&nbsp;root&nbsp;volume&nbsp;of&nbsp;the&nbsp;launched&nbsp;instance\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;include_ephemerals&nbsp;[Boolean]&nbsp;indicates&nbsp;that&nbsp;ephemeral&nbsp;volumes&nbsp;should&nbsp;be&nbsp;included&nbsp;in&nbsp;the&nbsp;block&nbsp;device&nbsp;mapping&nbsp;of&nbsp;the&nbsp;Launch&nbsp;Configuration\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;number_ephemeral_vols&nbsp;[int]&nbsp;number&nbsp;of&nbsp;ephemeral&nbsp;volumes&nbsp;to&nbsp;attach&nbsp;within&nbsp;the&nbsp;block&nbsp;device&nbsp;mapping&nbsp;Launch&nbsp;Configuration\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;ebs_data_volumes&nbsp;[list]&nbsp;dictionary&nbsp;pair&nbsp;of&nbsp;size&nbsp;and&nbsp;type&nbsp;data&nbsp;properties&nbsp;in&nbsp;a&nbsp;list&nbsp;used&nbsp;to&nbsp;create&nbsp;ebs&nbsp;volume&nbsp;attachments\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;custom_tags&nbsp;[Troposphere.autoscaling.Tag[]]&nbsp;Collection&nbsp;of&nbsp;Auto&nbsp;Scaling&nbsp;tags&nbsp;to&nbsp;be&nbsp;assigned&nbsp;to&nbsp;the&nbsp;Auto&nbsp;Scaling&nbsp;Group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;load_balancer&nbsp;[Troposphere.elasticloadbalancing.LoadBalancer]&nbsp;Object&nbsp;reference&nbsp;to&nbsp;an&nbsp;ELB&nbsp;to&nbsp;be&nbsp;assigned&nbsp;to&nbsp;this&nbsp;auto&nbsp;scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;instance_monitoring&nbsp;[Boolean]&nbsp;indicates&nbsp;that&nbsp;detailed&nbsp;monitoring&nbsp;should&nbsp;be&nbsp;turned&nbsp;on&nbsp;for&nbsp;all&nbsp;instnaces&nbsp;launched&nbsp;within&nbsp;this&nbsp;Auto&nbsp;Scaling&nbsp;group\\u000a&nbsp;&nbsp;&nbsp;&nbsp;@param&nbsp;subnet_type&nbsp;[string&nbsp;{'public',&nbsp;'private'}]&nbsp;string&nbsp;indicating&nbsp;which&nbsp;type&nbsp;of&nbsp;subnet&nbsp;(public&nbsp;or&nbsp;private)&nbsp;instances&nbsp;should&nbsp;be&nbsp;launched&nbsp;into\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-40"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-41">(<span id="ast-42" class="other_trans">subnet_type</span><span id="ast-43">&nbsp;not&nbsp;in&nbsp;</span><span id="ast-44">[<span id="ast-45">'public'</span>,&nbsp;<span id="ast-46">'private'</span>]</span>)</span>:<span id="ast-47"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-48"><span id="ast-49">RuntimeError</span>(<span id="ast-50">(<span id="ast-51">(<span id="ast-52">'Unable&nbsp;to&nbsp;determine&nbsp;which&nbsp;type&nbsp;of&nbsp;subnet&nbsp;instances&nbsp;should&nbsp;be&nbsp;launched&nbsp;into.&nbsp;'</span>&nbsp;+&nbsp;<span id="ast-54"><span id="ast-55" class="other_trans">str</span>(<span id="ast-56" class="incorrect_node">subnet_type&nbsp;&rarr;&nbsp;self.&nbsp;</span>)</span>)</span>&nbsp;+&nbsp;<span id="ast-58">'&nbsp;is&nbsp;not&nbsp;one&nbsp;of&nbsp;["public",&nbsp;"private"].'</span>)</span>)</span></span></span><span id="ast-59"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-60">(<span id="ast-62">(<span id="ast-63" class="other_trans">ec2_key</span><span id="ast-64" class="other_trans">&nbsp;!=&nbsp;</span><span id="ast-65" class="other_trans">None</span>)</span>&nbsp;and&nbsp;<span id="ast-66">(<span id="ast-67"><span id="ast-68">type</span>(<span id="ast-69" class="other_trans">ec2_key</span>)</span><span id="ast-70" class="ref_node">&nbsp;==&nbsp;&nbsp;&rarr;&nbsp;!=&nbsp;</span><span id="ast-71" class="other_trans">Ref</span>)</span>)</span>:<span id="ast-72"><span id="ast-73" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ec2_key</span>&nbsp;=&nbsp;<span id="ast-74"><span id="ast-75">Ref</span>(<span id="ast-76" class="other_trans">ec2_key</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>elif&nbsp;<span id="ast-78">(<span id="ast-79" class="other_trans">ec2_key</span><span id="ast-80" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-81" class="other_trans">None</span>)</span>:<span id="ast-82"><span id="ast-83" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ec2_key</span>&nbsp;=&nbsp;<span id="ast-84"><span id="ast-85">Ref</span>(<span id="ast-86"><span id="ast-87"><span id="ast-88"><span id="ast-89">self</span>.template</span>.parameters</span>[<span id="ast-90"><span id="ast-91">'ec2Key'</span></span>]</span>)</span></span></span></span></span></span><br /><br /><hr />
<span id="ast" class="ast"><span id="ast-0"><span id="ast-1">def&nbsp;copy(<span id="ast-2"><span id="ast-3" class="other_trans">source_path</span>,&nbsp;<span id="ast-4" class="other_trans">dest_path</span>,&nbsp;<span id="ast-5">follow_symlinks</span>,&nbsp;<span id="ast-7">exclude_patterns</span></span>):<span id="ast-9"><span id="ast-10"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>"\\u000a&nbsp;&nbsp;&nbsp;&nbsp;source_path&nbsp;can&nbsp;be&nbsp;a&nbsp;list&nbsp;of&nbsp;files,&nbsp;in&nbsp;which&nbsp;case&nbsp;we&nbsp;need&nbsp;to&nbsp;create&nbsp;a\\u000a&nbsp;&nbsp;&nbsp;&nbsp;directory&nbsp;first.&nbsp;&nbsp;Assume&nbsp;dest_path&nbsp;doesn't&nbsp;exist.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;Don't&nbsp;copy&nbsp;things&nbsp;that&nbsp;match&nbsp;|exclude_patterns|.\\u000a&nbsp;&nbsp;&nbsp;&nbsp;"</span></span><span id="ast-11"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-12"><span id="ast-13"><span id="ast-14"><span id="ast-15" class="other_trans">os</span>.path</span>.exists</span>(<span id="ast-16" class="other_trans">dest_path</span>)</span>:<span id="ast-17"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-18"><span id="ast-19" class="other_trans">path_error</span>(<span id="ast-20">'already&nbsp;exists'</span>,&nbsp;<span id="ast-21" class="other_trans">dest_path</span>)</span></span></span><span id="ast-22"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-23"><span id="ast-24">isinstance</span>(<span id="ast-25" class="other_trans">source_path</span>,&nbsp;<span id="ast-26">list</span>)</span>:<span id="ast-27"><span id="ast-28"><span id="ast-29"><span id="ast-30" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>os</span>.mkdir</span>(<span id="ast-31" class="other_trans">dest_path</span>)</span></span><span id="ast-32"><span id="ast-33" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>source</span>&nbsp;=&nbsp;<span id="ast-34"><span id="ast-35"><span id="ast-36">'&nbsp;'</span>.join</span>(<span id="ast-37">(<span id="ast-38"><span id="ast-39">quote_arg</span>(<span id="ast-40">p</span>)</span><span id="ast-41">&nbsp;for&nbsp;<span id="ast-42">p</span>&nbsp;in&nbsp;<span id="ast-43" class="other_trans">source_path</span></span>)</span>)</span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-44"><span id="ast-45"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>source</span>&nbsp;=&nbsp;<span id="ast-46"><span id="ast-47">quote_arg</span>(<span id="ast-48" class="other_trans">source_path</span>)</span></span></span><span id="ast-49"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-50">(<span id="ast-51" class="other_trans">source_path</span><span id="ast-52" class="other_trans">&nbsp;==&nbsp;</span><span id="ast-53">'/dev/stdin'</span>)</span>:<span id="ast-54"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>with&nbsp;<span id="ast-55"><span id="ast-56" class="other_trans">open</span>(<span id="ast-57" class="other_trans">dest_path</span>,&nbsp;<span id="ast-58">'wb'</span>)</span>&nbsp;as&nbsp;<span id="ast-59" class="other_trans">dest</span>:<span id="ast-60"><span id="ast-61"><span id="ast-62"><span id="ast-63" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>file_util</span>.copy</span>(<span id="ast-64"><span id="ast-65" class="other_trans">sys</span>.stdin</span>,&nbsp;<span id="ast-66">dest</span>,&nbsp;autoflush=<span id="ast-68">False</span>,&nbsp;print_status=<span id="ast-70">(<span id="ast-71">'Copying&nbsp;%s&nbsp;to&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-73">(<span id="ast-74" class="other_trans">source_path</span>,&nbsp;<span id="ast-75" class="other_trans">dest_path</span>)</span>)</span>)</span></span></span><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;</span>else:<span id="ast-76"><span id="ast-77" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>command</span>&nbsp;=&nbsp;<span id="ast-78">(<span id="ast-79">'rsync&nbsp;-pr%s&nbsp;%s%s&nbsp;%s'</span>&nbsp;%&nbsp;<span id="ast-81">(<span id="ast-82"><span id="ast-84">'L'</span>&nbsp;if&nbsp;<span id="ast-83" class="other_trans">follow_symlinks</span>&nbsp;else&nbsp;<span id="ast-85">'l'</span></span>,&nbsp;<span id="ast-86" class="other_trans">source</span>,&nbsp;<span id="ast-87"><span id="ast-93">'/'</span>&nbsp;if&nbsp;<span id="ast-88"><span id="ast-89"><span id="ast-90"><span id="ast-91">os</span>.path</span>.isdir</span>(<span id="ast-92" class="ref_node">source&nbsp;&rarr;&nbsp;source_path&nbsp;</span>)</span>&nbsp;else&nbsp;<span id="ast-94">''</span></span>,&nbsp;<span id="ast-95"><span id="ast-96" class="other_trans">quote_arg</span>(<span id="ast-97" class="other_trans">dest_path</span>)</span>)</span>)</span></span><span id="ast-98"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-99" class="other_trans">exclude_patterns</span>:<span id="ast-100"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>for&nbsp;<span id="ast-101">pattern</span>&nbsp;in&nbsp;<span id="ast-102">exclude_patterns</span>:<span id="ast-103"><span id="ast-104" class="other_trans"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>command</span>&nbsp;+=&nbsp;<span id="ast-106">(<span id="ast-107">(<span id="ast-108">'&nbsp;--exclude&nbsp;"'</span>&nbsp;+&nbsp;<span id="ast-110" class="other_trans">pattern</span>)</span>&nbsp;+&nbsp;<span id="ast-112">'"'</span>)</span></span></span></span><span id="ast-113"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>if&nbsp;<span id="ast-114">(<span id="ast-115"><span id="ast-116"><span id="ast-117" class="other_trans">os</span>.system</span>(<span id="ast-118" class="other_trans">command</span>)</span><span id="ast-119" class="incorrect_node">&nbsp;!=&nbsp;&nbsp;&rarr;&nbsp;==&nbsp;</span><span id="ast-120">0</span>)</span>:<span id="ast-121"><span class="whitespace"><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>raise&nbsp;<span id="ast-122"><span id="ast-123" class="other_trans">path_error</span>(<span id="ast-124">(<span id="ast-125">'Unable&nbsp;to&nbsp;copy&nbsp;%s&nbsp;to'</span>&nbsp;%&nbsp;<span id="ast-127" class="other_trans">source_path</span>)</span>,&nbsp;<span id="ast-128" class="other_trans">dest_path</span>)</span></span></span></span></span></span></span><br /><br /><hr />
</body></html>
